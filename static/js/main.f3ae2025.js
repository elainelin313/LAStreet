/*! For license information please see main.f3ae2025.js.LICENSE.txt */
!function(){var e={6075:function(e,t,n){"use strict";n.r(t),n.d(t,{buildQueries:function(){return mt},configure:function(){return Pe},createEvent:function(){return Wn},findAllByAltText:function(){return un},findAllByDisplayValue:function(){return Jt},findAllByLabelText:function(){return Mt},findAllByPlaceholderText:function(){return Dt},findAllByRole:function(){return Sn},findAllByTestId:function(){return Rn},findAllByText:function(){return Vt},findAllByTitle:function(){return mn},findByAltText:function(){return ln},findByDisplayValue:function(){return Qt},findByLabelText:function(){return Ct},findByPlaceholderText:function(){return zt},findByRole:function(){return Mn},findByTestId:function(){return On},findByText:function(){return Ht},findByTitle:function(){return gn},fireEvent:function(){return Hn},getAllByAltText:function(){return on},getAllByDisplayValue:function(){return Xt},getAllByLabelText:function(){return Tt},getAllByPlaceholderText:function(){return Ot},getAllByRole:function(){return wn},getAllByTestId:function(){return Ln},getAllByText:function(){return qt},getAllByTitle:function(){return pn},getByAltText:function(){return sn},getByDisplayValue:function(){return Kt},getByLabelText:function(){return Et},getByPlaceholderText:function(){return Nt},getByRole:function(){return kn},getByTestId:function(){return In},getByText:function(){return Ut},getByTitle:function(){return vn},getConfig:function(){return Ae},getDefaultNormalizer:function(){return Be},getElementError:function(){return ot},getMultipleElementsFoundError:function(){return st},getNodeText:function(){return qe},getQueriesForElement:function(){return Dn},getRoles:function(){return Ye},getSuggestedQuery:function(){return rt},isInaccessible:function(){return Ge},logDOM:function(){return Ce},logRoles:function(){return Ke},makeFindQuery:function(){return ft},makeGetAllQuery:function(){return dt},makeSingleQuery:function(){return ct},prettyDOM:function(){return Me},prettyFormat:function(){return a},queries:function(){return Nn},queryAllByAltText:function(){return nn},queryAllByAttribute:function(){return ut},queryAllByDisplayValue:function(){return Gt},queryAllByLabelText:function(){return Pt},queryAllByPlaceholderText:function(){return Lt},queryAllByRole:function(){return yn},queryAllByTestId:function(){return En},queryAllByText:function(){return Bt},queryAllByTitle:function(){return hn},queryByAltText:function(){return an},queryByAttribute:function(){return lt},queryByDisplayValue:function(){return Yt},queryByLabelText:function(){return kt},queryByPlaceholderText:function(){return Rt},queryByRole:function(){return xn},queryByTestId:function(){return An},queryByText:function(){return $t},queryByTitle:function(){return fn},queryHelpers:function(){return gt},screen:function(){return Yn},waitFor:function(){return at},waitForElementToBeRemoved:function(){return Bn},within:function(){return Dn},wrapAllByQueryWithSuggestion:function(){return vt},wrapSingleQueryWithSuggestion:function(){return pt}});var r=n(7462),i=n(3366),a=n(7220),o=Object.prototype.toString;function s(e){return"function"===typeof e||"[object Function]"===o.call(e)}var u=Math.pow(2,53)-1;function l(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),u)}function c(e,t){var n=Array,r=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");if("undefined"!==typeof t&&!s(t))throw new TypeError("Array.from: when provided, the second argument must be a function");for(var i,a=l(r.length),o=s(n)?Object(new n(a)):new Array(a),u=0;u<a;)i=r[u],o[u]=t?t(i,u):i,u+=1;return o.length=a,o}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];h(this,e),f(this,"items",void 0),this.items=t}var t,n,r;return t=e,(n=[{key:"add",value:function(e){return!1===this.has(e)&&this.items.push(e),this}},{key:"clear",value:function(){this.items=[]}},{key:"delete",value:function(e){var t=this.items.length;return this.items=this.items.filter((function(t){return t!==e})),t!==this.items.length}},{key:"forEach",value:function(e){var t=this;this.items.forEach((function(n){e(n,n,t)}))}},{key:"has",value:function(e){return-1!==this.items.indexOf(e)}},{key:"size",get:function(){return this.items.length}}])&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),v="undefined"===typeof Set?Set:p;function m(e){var t;return null!==(t=e.localName)&&void 0!==t?t:e.tagName.toLowerCase()}var g={article:"article",aside:"complementary",button:"button",datalist:"listbox",dd:"definition",details:"group",dialog:"dialog",dt:"term",fieldset:"group",figure:"figure",form:"form",footer:"contentinfo",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading",header:"banner",hr:"separator",html:"document",legend:"legend",li:"listitem",math:"math",main:"main",menu:"list",nav:"navigation",ol:"list",optgroup:"group",option:"option",output:"status",progress:"progressbar",section:"region",summary:"button",table:"table",tbody:"rowgroup",textarea:"textbox",tfoot:"rowgroup",td:"cell",th:"columnheader",thead:"rowgroup",tr:"row",ul:"list"},_={caption:new Set(["aria-label","aria-labelledby"]),code:new Set(["aria-label","aria-labelledby"]),deletion:new Set(["aria-label","aria-labelledby"]),emphasis:new Set(["aria-label","aria-labelledby"]),generic:new Set(["aria-label","aria-labelledby","aria-roledescription"]),insertion:new Set(["aria-label","aria-labelledby"]),paragraph:new Set(["aria-label","aria-labelledby"]),presentation:new Set(["aria-label","aria-labelledby"]),strong:new Set(["aria-label","aria-labelledby"]),subscript:new Set(["aria-label","aria-labelledby"]),superscript:new Set(["aria-label","aria-labelledby"])};function y(e,t){return function(e,t){return["aria-atomic","aria-busy","aria-controls","aria-current","aria-describedby","aria-details","aria-dropeffect","aria-flowto","aria-grabbed","aria-hidden","aria-keyshortcuts","aria-label","aria-labelledby","aria-live","aria-owns","aria-relevant","aria-roledescription"].some((function(n){var r;return e.hasAttribute(n)&&!(null!==(r=_[t])&&void 0!==r&&r.has(n))}))}(e,t)}function b(e){var t=function(e){var t=e.getAttribute("role");if(null!==t){var n=t.trim().split(" ")[0];if(n.length>0)return n}return null}(e);if(null===t||"presentation"===t){var n=function(e){var t=g[m(e)];if(void 0!==t)return t;switch(m(e)){case"a":case"area":case"link":if(e.hasAttribute("href"))return"link";break;case"img":return""!==e.getAttribute("alt")||y(e,"img")?"img":"presentation";case"input":var n=e.type;switch(n){case"button":case"image":case"reset":case"submit":return"button";case"checkbox":case"radio":return n;case"range":return"slider";case"email":case"tel":case"text":case"url":return e.hasAttribute("list")?"combobox":"textbox";case"search":return e.hasAttribute("list")?"combobox":"searchbox";case"number":return"spinbutton";default:return null}case"select":return e.hasAttribute("multiple")||e.size>1?"listbox":"combobox"}return null}(e);if("presentation"!==t||y(e,n||""))return n}return t}function x(e){return null!==e&&e.nodeType===e.ELEMENT_NODE}function w(e){return x(e)&&"caption"===m(e)}function k(e){return x(e)&&"input"===m(e)}function S(e){return x(e)&&"optgroup"===m(e)}function M(e){return x(e)&&"table"===m(e)}function C(e){var t=(null===e.ownerDocument?e:e.ownerDocument).defaultView;if(null===t)throw new TypeError("no window available");return t}function T(e){return x(e)&&"fieldset"===m(e)}function E(e){return x(e)&&"legend"===m(e)}function P(e){return x(e)&&"slot"===m(e)}function A(e){return x(e)&&"svg"===m(e)}function L(e){return function(e){return x(e)&&void 0!==e.ownerSVGElement}(e)&&"title"===m(e)}function I(e,t){if(x(e)&&e.hasAttribute(t)){var n=e.getAttribute(t).split(" "),r=e.getRootNode?e.getRootNode():e.ownerDocument;return n.map((function(e){return r.getElementById(e)})).filter((function(e){return null!==e}))}return[]}function R(e,t){return!!x(e)&&-1!==t.indexOf(b(e))}function O(e){return e.trim().replace(/\s\s+/g," ")}function N(e,t){if(!x(e))return!1;if(e.hasAttribute("hidden")||"true"===e.getAttribute("aria-hidden"))return!0;var n=t(e);return"none"===n.getPropertyValue("display")||"hidden"===n.getPropertyValue("visibility")}function D(e){return R(e,["button","combobox","listbox","textbox"])||z(e,"range")}function z(e,t){if(!x(e))return!1;if("range"===t)return R(e,["meter","progressbar","scrollbar","slider","spinbutton"]);throw new TypeError("No knowledge about abstract role '".concat(t,"'. This is likely a bug :("))}function j(e,t){var n=c(e.querySelectorAll(t));return I(e,"aria-owns").forEach((function(e){n.push.apply(n,c(e.querySelectorAll(t)))})),n}function B(e){return x(t=e)&&"select"===m(t)?e.selectedOptions||j(e,"[selected]"):j(e,'[aria-selected="true"]');var t}function F(e){return R(e,["none","presentation"])}function $(e){return w(e)}function q(e){return R(e,["button","cell","checkbox","columnheader","gridcell","heading","label","legend","link","menuitem","menuitemcheckbox","menuitemradio","option","radio","row","rowheader","switch","tab","tooltip","treeitem"])}function U(e){return k(e)||x(t=e)&&"textarea"===m(t)?e.value:e.textContent||"";var t}function V(e){var t=e.getPropertyValue("content");return/^["'].*["']$/.test(t)?t.slice(1,-1):""}function H(e){var t=m(e);return"button"===t||"input"===t&&"hidden"!==e.getAttribute("type")||"meter"===t||"output"===t||"progress"===t||"select"===t||"textarea"===t}function W(e){if(H(e))return e;var t=null;return e.childNodes.forEach((function(e){if(null===t&&x(e)){var n=W(e);null!==n&&(t=n)}})),t}function G(e){if(void 0!==e.control)return e.control;var t=e.getAttribute("for");return null!==t?e.ownerDocument.getElementById(t):W(e)}function Z(e){var t=e.labels;return null===t?t:void 0!==t?c(t):H(e)?c(e.ownerDocument.querySelectorAll("label")).filter((function(t){return G(t)===e})):null}function Y(e){var t=e.assignedNodes();return 0===t.length?c(e.childNodes):t}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new v,r=C(e),i=t.compute,a=void 0===i?"name":i,o=t.computedStyleSupportsPseudoElements,s=void 0===o?void 0!==t.getComputedStyle:o,u=t.getComputedStyle,l=void 0===u?r.getComputedStyle.bind(r):u,h=t.hidden,d=void 0!==h&&h;function f(e,t){var n="";if(x(e)&&s){var r=V(l(e,"::before"));n="".concat(r," ").concat(n)}if((P(e)?Y(e):c(e.childNodes).concat(I(e,"aria-owns"))).forEach((function(e){var r=g(e,{isEmbeddedInLabel:t.isEmbeddedInLabel,isReferenced:!1,recursion:!0}),i="inline"!==(x(e)?l(e).getPropertyValue("display"):"inline")?" ":"";n+="".concat(i).concat(r).concat(i)})),x(e)&&s){var i=V(l(e,"::after"));n="".concat(n," ").concat(i)}return n.trim()}function p(e){if(!x(e))return null;function t(e,t){var r=e.getAttributeNode(t);return null===r||n.has(r)||""===r.value.trim()?null:(n.add(r),r.value)}if(T(e)){n.add(e);for(var r=c(e.childNodes),i=0;i<r.length;i+=1){var a=r[i];if(E(a))return g(a,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(M(e)){n.add(e);for(var o=c(e.childNodes),s=0;s<o.length;s+=1){var u=o[s];if(w(u))return g(u,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else{if(A(e)){n.add(e);for(var l=c(e.childNodes),h=0;h<l.length;h+=1){var d=l[h];if(L(d))return d.textContent}return null}if("img"===m(e)||"area"===m(e)){var p=t(e,"alt");if(null!==p)return p}else if(S(e)){var v=t(e,"label");if(null!==v)return v}}if(k(e)&&("button"===e.type||"submit"===e.type||"reset"===e.type)){var _=t(e,"value");if(null!==_)return _;if("submit"===e.type)return"Submit";if("reset"===e.type)return"Reset"}var y=Z(e);if(null!==y&&0!==y.length)return n.add(e),c(y).map((function(e){return g(e,{isEmbeddedInLabel:!0,isReferenced:!1,recursion:!0})})).filter((function(e){return e.length>0})).join(" ");if(k(e)&&"image"===e.type){var b=t(e,"alt");if(null!==b)return b;var C=t(e,"title");return null!==C?C:"Submit Query"}if(R(e,["button"])){var P=f(e,{isEmbeddedInLabel:!1,isReferenced:!1});return""!==P?P:t(e,"title")}return t(e,"title")}function g(e,t){if(n.has(e))return"";if(!d&&N(e,l)&&!t.isReferenced)return n.add(e),"";var r=I(e,"aria-labelledby");if("name"===a&&!t.isReferenced&&r.length>0)return r.map((function(e){return g(e,{isEmbeddedInLabel:t.isEmbeddedInLabel,isReferenced:!0,recursion:!1})})).join(" ");var i=t.recursion&&D(e)&&"name"===a;if(!i){var o=(x(e)&&e.getAttribute("aria-label")||"").trim();if(""!==o&&"name"===a)return n.add(e),o;if(!F(e)){var s=p(e);if(null!==s)return n.add(e),s}}if(R(e,["menu"]))return n.add(e),"";if(i||t.isEmbeddedInLabel||t.isReferenced){if(R(e,["combobox","listbox"])){n.add(e);var u=B(e);return 0===u.length?k(e)?e.value:"":c(u).map((function(e){return g(e,{isEmbeddedInLabel:t.isEmbeddedInLabel,isReferenced:!1,recursion:!0})})).join(" ")}if(z(e,"range"))return n.add(e),e.hasAttribute("aria-valuetext")?e.getAttribute("aria-valuetext"):e.hasAttribute("aria-valuenow")?e.getAttribute("aria-valuenow"):e.getAttribute("value")||"";if(R(e,["textbox"]))return n.add(e),U(e)}if(q(e)||x(e)&&t.isReferenced||$(e))return n.add(e),f(e,{isEmbeddedInLabel:t.isEmbeddedInLabel,isReferenced:!1});if(e.nodeType===e.TEXT_NODE)return n.add(e),e.textContent||"";if(t.recursion)return n.add(e),f(e,{isEmbeddedInLabel:t.isEmbeddedInLabel,isReferenced:!1});return n.add(e),""}return O(g(e,{isEmbeddedInLabel:!1,isReferenced:"description"===a,recursion:!1}))}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=I(e,"aria-describedby").map((function(e){return X(e,J(J({},t),{},{compute:"description"}))})).join(" ");if(""===n){var r=e.getAttribute("title");n=null===r?"":r}return n}function te(e){return R(e,["caption","code","deletion","emphasis","generic","insertion","paragraph","presentation","strong","subscript","superscript"])}function ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return te(e)?"":X(e,t)}var re=n(294),ie=n(5861),ae=n(4687),oe=n.n(ae),se=n(4235);function ue(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}e=n.hmd(e);var le=function(e,t){var n=t.colors.content;return n.open+ue(e)+n.close},ce=/^((HTML|SVG)\w*)?Element$/;function he(e){return 11===e.nodeType}function de(e){return{test:function(e){var t;return(null==e||null==(t=e.constructor)?void 0:t.name)&&function(e){var t=e.constructor.name,n=e.nodeType,r=e.tagName,i="string"===typeof r&&r.includes("-")||"function"===typeof e.hasAttribute&&e.hasAttribute("is");return 1===n&&(ce.test(t)||i)||3===n&&"Text"===t||8===n&&"Comment"===t||11===n&&"DocumentFragment"===t}(e)},serialize:function(t,n,r,i,a,o){if(function(e){return 3===e.nodeType}(t))return le(t.data,n);if(function(e){return 8===e.nodeType}(t))return function(e,t){var n=t.colors.comment;return n.open+"\x3c!--"+ue(e)+"--\x3e"+n.close}(t.data,n);var s=he(t)?"DocumentFragment":t.tagName.toLowerCase();return++i>n.maxDepth?function(e,t){var n=t.colors.tag;return n.open+"<"+e+n.close+" \u2026"+n.open+" />"+n.close}(s,n):function(e,t,n,r,i){var a=r.colors.tag;return a.open+"<"+e+(t&&a.close+t+r.spacingOuter+i+a.open)+(n?">"+a.close+n+r.spacingOuter+i+a.open+"</"+e:(t&&!r.min?"":" ")+"/")+">"+a.close}(s,function(e,t,n,r,i,a,o){var s=r+n.indent,u=n.colors;return e.map((function(e){var l=t[e],c=o(l,n,s,i,a);return"string"!==typeof l&&(-1!==c.indexOf("\n")&&(c=n.spacingOuter+s+c+n.spacingOuter+r),c="{"+c+"}"),n.spacingInner+r+u.prop.open+e+u.prop.close+"="+u.value.open+c+u.value.close})).join("")}(he(t)?[]:Array.from(t.attributes).map((function(e){return e.name})).sort(),he(t)?{}:Array.from(t.attributes).reduce((function(e,t){return e[t.name]=t.value,e}),{}),n,r+n.indent,i,a,o),function(e,t,n,r,i,a){return e.map((function(e){var o="string"===typeof e?le(e,t):a(e,t,n,r,i);return""===o&&"object"===typeof e&&null!==e&&3!==e.nodeType?"":t.spacingOuter+n+o})).join("")}(Array.prototype.slice.call(t.childNodes||t.children).filter(e),n,r+n.indent,i,a,o),n,r)}}}var fe=null,pe=null,ve=null;try{var me=e&&e.require;pe=me.call(e,"fs").readFileSync,ve=me.call(e,"@babel/code-frame").codeFrameColumns,fe=me.call(e,"chalk")}catch(Xn){}function ge(){return pe&&ve?function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),r=e.slice(t,n),i=r.split(":"),a=[i[0],parseInt(i[1],10),parseInt(i[2],10)],o=a[0],s=a[1],u=a[2],l="";try{l=pe(o,"utf-8")}catch(h){return""}var c=ve(l,{start:{line:s,column:u}},{highlightCode:!0,linesBelow:0});return fe.dim(r)+"\n"+c+"\n"}((new Error).stack.split("\n").slice(1).find((function(e){return!e.includes("node_modules/")}))):""}function _e(){return"undefined"!==typeof jest&&null!==jest&&(!0===setTimeout._isMockFunction||Object.prototype.hasOwnProperty.call(setTimeout,"clock"))}function ye(){if("undefined"===typeof window)throw new Error("Could not find default container");return window.document}function be(e){if(e.defaultView)return e.defaultView;if(e.ownerDocument&&e.ownerDocument.defaultView)return e.ownerDocument.defaultView;if(e.window)return e.window;throw e.ownerDocument&&null===e.ownerDocument.defaultView?new Error("It looks like the window object is not available for the provided node."):e.then instanceof Function?new Error("It looks like you passed a Promise object instead of a DOM node. Did you do something like `fireEvent.click(screen.findBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`, or await the findBy query `fireEvent.click(await screen.findBy...`?"):Array.isArray(e)?new Error("It looks like you passed an Array instead of a DOM node. Did you do something like `fireEvent.click(screen.getAllBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`?"):"function"===typeof e.debug&&"function"===typeof e.logTestingPlaygroundURL?new Error("It looks like you passed a `screen` object. Did you do something like `fireEvent.click(screen, ...` when you meant to use a query, e.g. `fireEvent.click(screen.getBy..., `?"):new Error("The given node is not an Element, the node type is: "+typeof e+".")}function xe(e){if(!e||"function"!==typeof e.querySelector||"function"!==typeof e.querySelectorAll)throw new TypeError("Expected container to be an Element, a Document or a DocumentFragment but got "+function(e){if("object"===typeof e)return null===e?"null":e.constructor.name;return typeof e}(e)+".")}var we=["filterNode"],ke=a.plugins.DOMCollection;function Se(e){return 8!==e.nodeType&&(1!==e.nodeType||!e.matches(Ae().defaultIgnore))}function Me(e,t,n){if(void 0===n&&(n={}),e||(e=ye().body),"number"!==typeof t&&(t="undefined"!==typeof process&&{NODE_ENV:"production",PUBLIC_URL:"/LAStreet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG_PRINT_LIMIT||7e3),0===t)return"";e.documentElement&&(e=e.documentElement);var o=typeof e;if("object"===o?o=e.constructor.name:e={},!("outerHTML"in e))throw new TypeError("Expected an element or document but got "+o);var s=n,u=s.filterNode,l=void 0===u?Se:u,c=(0,i.Z)(s,we),h=a.format(e,(0,r.Z)({plugins:[de(l),ke],printFunctionName:!1,highlight:"undefined"!==typeof process&&void 0!==process.versions&&void 0!==process.versions.node},c));return void 0!==t&&e.outerHTML.length>t?h.slice(0,t)+"...":h}var Ce=function(){var e=ge();e?console.log(Me.apply(void 0,arguments)+"\n\n"+e):console.log(Me.apply(void 0,arguments))},Te={testIdAttribute:"data-testid",asyncUtilTimeout:1e3,asyncWrapper:function(e){return e()},unstable_advanceTimersWrapper:function(e){return e()},eventWrapper:function(e){return e()},defaultHidden:!1,defaultIgnore:"script, style",showOriginalStackTrace:!1,throwSuggestions:!1,getElementError:function(e,t){var n=Me(t),r=new Error([e,"Ignored nodes: comments, <script />, <style />\n"+n].filter(Boolean).join("\n\n"));return r.name="TestingLibraryElementError",r},_disableExpensiveErrorDiagnostics:!1,computedStyleSupportsPseudoElements:!1};function Ee(e){try{return Te._disableExpensiveErrorDiagnostics=!0,e()}finally{Te._disableExpensiveErrorDiagnostics=!1}}function Pe(e){"function"===typeof e&&(e=e(Te)),Te=(0,r.Z)({},Te,e)}function Ae(){return Te}var Le=["button","meter","output","progress","select","textarea","input"];function Ie(e){return Le.includes(e.nodeName.toLowerCase())?"":3===e.nodeType?e.textContent:Array.from(e.childNodes).map((function(e){return Ie(e)})).join("")}function Re(e){return"label"===e.tagName.toLowerCase()?Ie(e):e.value||e.textContent}function Oe(e){var t;if(void 0!==e.labels)return null!=(t=e.labels)?t:[];if(!function(e){return/BUTTON|METER|OUTPUT|PROGRESS|SELECT|TEXTAREA/.test(e.tagName)||"INPUT"===e.tagName&&"hidden"!==e.getAttribute("type")}(e))return[];var n=e.ownerDocument.querySelectorAll("label");return Array.from(n).filter((function(t){return t.control===e}))}function Ne(e,t,n){var r=(void 0===n?{}:n).selector,i=void 0===r?"*":r,a=t.getAttribute("aria-labelledby"),o=a?a.split(" "):[];return o.length?o.map((function(t){var n=e.querySelector('[id="'+t+'"]');return n?{content:Re(n),formControl:null}:{content:"",formControl:null}})):Array.from(Oe(t)).map((function(e){return{content:Re(e),formControl:Array.from(e.querySelectorAll("button, input, meter, output, progress, select, textarea")).filter((function(e){return e.matches(i)}))[0]}}))}function De(e){if(null===e||void 0===e)throw new Error("It looks like "+e+" was passed instead of a matcher. Did you do something like getByText("+e+")?")}function ze(e,t,n,r){if("string"!==typeof e)return!1;De(n);var i=r(e);return"string"===typeof n||"number"===typeof n?i.toLowerCase().includes(n.toString().toLowerCase()):"function"===typeof n?n(i,t):$e(n,i)}function je(e,t,n,r){if("string"!==typeof e)return!1;De(n);var i=r(e);return n instanceof Function?n(i,t):n instanceof RegExp?$e(n,i):i===String(n)}function Be(e){var t=void 0===e?{}:e,n=t.trim,r=void 0===n||n,i=t.collapseWhitespace,a=void 0===i||i;return function(e){var t=e;return t=r?t.trim():t,t=a?t.replace(/\s+/g," "):t}}function Fe(e){var t=e.trim,n=e.collapseWhitespace,r=e.normalizer;if(!r)return Be({trim:t,collapseWhitespace:n});if("undefined"!==typeof t||"undefined"!==typeof n)throw new Error('trim and collapseWhitespace are not supported with a normalizer. If you want to use the default trim and collapseWhitespace logic in your normalizer, use "getDefaultNormalizer({trim, collapseWhitespace})" and compose that into your normalizer');return r}function $e(e,t){var n=e.test(t);return e.global&&0!==e.lastIndex&&(console.warn("To match all elements we had to reset the lastIndex of the RegExp because the global flag is enabled. We encourage to remove the global flag from the RegExp."),e.lastIndex=0),n}function qe(e){return e.matches("input[type=submit], input[type=button], input[type=reset]")?e.value:Array.from(e.childNodes).filter((function(e){return 3===e.nodeType&&Boolean(e.textContent)})).map((function(e){return e.textContent})).join("")}function Ue(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ve(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var He=function(e){function t(e){var t=e.attributes;return(void 0===t?[]:t).length}function n(e){return function(t){var n,i=e.attributes,a=void 0===i?[]:i,o=a.findIndex((function(e){return e.value&&"type"===e.name&&"text"===e.value}));return!(o>=0&&(a=[].concat(a.slice(0,o),a.slice(o+1)),"text"!==t.type))&&t.matches(""+(n=(0,r.Z)({},e,{attributes:a})).name+n.attributes.map((function(e){var t=e.name,n=e.value,r=e.constraints;return-1!==(void 0===r?[]:r).indexOf("undefined")?":not(["+t+"])":n?"["+t+'="'+n+'"]':"["+t+"]"})).join(""))}}for(var i,a=[],o=Ue(e.entries());!(i=o()).done;){var s=i.value,u=s[0],l=s[1];a=[].concat(a,[{match:n(u),roles:Array.from(l),specificity:t(u)}])}return a.sort((function(e,t){var n=e.specificity;return t.specificity-n}))}(re.Qv);function We(e){return!0===e.hidden||("true"===e.getAttribute("aria-hidden")||"none"===e.ownerDocument.defaultView.getComputedStyle(e).display)}function Ge(e,t){void 0===t&&(t={});var n=t.isSubtreeInaccessible,r=void 0===n?We:n;if("hidden"===e.ownerDocument.defaultView.getComputedStyle(e).visibility)return!0;for(var i=e;i;){if(r(i))return!0;i=i.parentElement}return!1}function Ze(e){for(var t,n=Ue(He);!(t=n()).done;){var r=t.value,i=r.match,a=r.roles;if(i(e))return[].concat(a)}return[]}function Ye(e,t){var n=(void 0===t?{}:t).hidden,i=void 0!==n&&n;return function e(t){return[t].concat(Array.from(t.children).reduce((function(t,n){return[].concat(t,e(n))}),[]))}(e).filter((function(e){return!1!==i||!1===Ge(e)})).reduce((function(e,t){return(t.hasAttribute("role")?t.getAttribute("role").split(" ").slice(0,1):Ze(t)).reduce((function(e,n){var i,a;return Array.isArray(e[n])?(0,r.Z)({},e,((i={})[n]=[].concat(e[n],[t]),i)):(0,r.Z)({},e,((a={})[n]=[t],a))}),e)}),{})}function Xe(e,t){var n=t.hidden,r=t.includeDescription,i=Ye(e,{hidden:n});return Object.entries(i).filter((function(e){return"generic"!==e[0]})).map((function(e){var t=e[0],n=e[1],i="-".repeat(50);return t+":\n\n"+n.map((function(e){var t='Name "'+ne(e,{computedStyleSupportsPseudoElements:Ae().computedStyleSupportsPseudoElements})+'":\n',n=Me(e.cloneNode(!1));return r?""+t+('Description "'+ee(e,{computedStyleSupportsPseudoElements:Ae().computedStyleSupportsPseudoElements})+'":\n')+n:""+t+n})).join("\n\n")+"\n\n"+i})).join("\n")}var Ke=function(e,t){var n=(void 0===t?{}:t).hidden,r=void 0!==n&&n;return console.log(Xe(e,{hidden:r}))};function Je(e,t){var n=e.getAttribute(t);return"true"===n||"false"!==n&&void 0}var Qe=Be();function et(e){return new RegExp(function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}(e.toLowerCase()),"i")}function tt(e,t,n,r){var i=r.variant,a=r.name,o="",s={},u=[["Role","TestId"].includes(e)?n:et(n)];a&&(s.name=et(a)),"Role"===e&&Ge(t)&&(s.hidden=!0,o="Element is inaccessible. This means that the element and all its children are invisible to screen readers.\n    If you are using the aria-hidden prop, make sure this is the right choice for your case.\n    "),Object.keys(s).length>0&&u.push(s);var l=i+"By"+e;return{queryName:e,queryMethod:l,queryArgs:u,variant:i,warning:o,toString:function(){o&&console.warn(o);var e=u[0],t=u[1];return e="string"===typeof e?"'"+e+"'":e,t=t?", { "+Object.entries(t).map((function(e){return e[0]+": "+e[1]})).join(", ")+" }":"",l+"("+e+t+")"}}}function nt(e,t,n){return n&&(!t||t.toLowerCase()===e.toLowerCase())}function rt(e,t,n){var r,i;if(void 0===t&&(t="get"),!e.matches(Ae().defaultIgnore)){var a=null!=(r=e.getAttribute("role"))?r:null==(i=Ze(e))?void 0:i[0];if("generic"!==a&&nt("Role",n,a))return tt("Role",e,a,{variant:t,name:ne(e,{computedStyleSupportsPseudoElements:Ae().computedStyleSupportsPseudoElements})});var o=Ne(document,e).map((function(e){return e.content})).join(" ");if(nt("LabelText",n,o))return tt("LabelText",e,o,{variant:t});var s=e.getAttribute("placeholder");if(nt("PlaceholderText",n,s))return tt("PlaceholderText",e,s,{variant:t});var u=Qe(qe(e));if(nt("Text",n,u))return tt("Text",e,u,{variant:t});if(nt("DisplayValue",n,e.value))return tt("DisplayValue",e,Qe(e.value),{variant:t});var l=e.getAttribute("alt");if(nt("AltText",n,l))return tt("AltText",e,l,{variant:t});var c=e.getAttribute("title");if(nt("Title",n,c))return tt("Title",e,c,{variant:t});var h=e.getAttribute(Ae().testIdAttribute);return nt("TestId",n,h)?tt("TestId",e,h,{variant:t}):void 0}}function it(e,t){e.stack=t.stack.replace(t.message,e.message)}function at(e,t){var n=new Error("STACK_TRACE_MESSAGE");return Ae().asyncWrapper((function(){return function(e,t){var n=t.container,r=void 0===n?ye():n,i=t.timeout,a=void 0===i?Ae().asyncUtilTimeout:i,o=t.showOriginalStackTrace,s=void 0===o?Ae().showOriginalStackTrace:o,u=t.stackTraceError,l=t.interval,c=void 0===l?50:l,h=t.onTimeout,d=void 0===h?function(e){return e.message=Ae().getElementError(e.message,r).message,e}:h,f=t.mutationObserverOptions,p=void 0===f?{subtree:!0,childList:!0,attributes:!0,characterData:!0}:f;if("function"!==typeof e)throw new TypeError("Received `callback` arg must be a function");return new Promise(function(){var t=(0,ie.Z)(oe().mark((function t(n,i){var o,l,h,f,v,m,g,_,y,b,x,w,k,S,M,C;return oe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(C=function(){var e;o?(e=o,s||"TestingLibraryElementError"!==e.name||it(e,u)):(e=new Error("Timed out in waitFor."),s||it(e,u)),k(d(e),null)},M=function(){if("pending"!==v)try{var t=Ee(e);"function"===typeof(null==t?void 0:t.then)?(v="pending",t.then((function(e){v="resolved",k(null,e)}),(function(e){v="rejected",o=e}))):k(null,t)}catch(b){o=b}},S=function(){if(_e()){var e=new Error("Changed from using real timers to fake timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to fake timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");return s||it(e,u),i(e)}return M()},k=function(e,t){f=!0,clearTimeout(m),g||(clearInterval(l),h.disconnect()),e?i(e):n(t)},f=!1,v="idle",m=setTimeout(C,a),!(g=_e())){t.next=27;break}_=Ae(),y=_.unstable_advanceTimersWrapper,M();case 11:if(f){t.next=25;break}if(_e()){t.next=17;break}return b=new Error("Changed from using fake timers to real timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to real timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830"),s||it(b,u),i(b),t.abrupt("return");case 17:if(y((function(){jest.advanceTimersByTime(c)})),M(),!f){t.next=21;break}return t.abrupt("break",25);case 21:return t.next=23,y((0,ie.Z)(oe().mark((function e(){return oe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,0),jest.advanceTimersByTime(0)}));case 2:case"end":return e.stop()}}),e)}))));case 23:t.next=11;break;case 25:t.next=40;break;case 27:t.prev=27,xe(r),t.next=35;break;case 31:return t.prev=31,t.t0=t.catch(27),i(t.t0),t.abrupt("return");case 35:l=setInterval(S,c),x=be(r),w=x.MutationObserver,(h=new w(S)).observe(r,p),M();case 40:case"end":return t.stop()}}),t,null,[[27,31]])})));return function(e,n){return t.apply(this,arguments)}}())}(e,(0,r.Z)({stackTraceError:n},t))}))}function ot(e,t){return Ae().getElementError(e,t)}function st(e,t){return ot(e+"\n\n(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).",t)}function ut(e,t,n,r){var i=void 0===r?{}:r,a=i.exact,o=void 0===a||a,s=i.collapseWhitespace,u=i.trim,l=i.normalizer,c=o?je:ze,h=Fe({collapseWhitespace:s,trim:u,normalizer:l});return Array.from(t.querySelectorAll("["+e+"]")).filter((function(t){return c(t.getAttribute(e),t,n,h)}))}function lt(e,t,n,r){var i=ut(e,t,n,r);if(i.length>1)throw st("Found multiple elements by ["+e+"="+n+"]",t);return i[0]||null}function ct(e,t){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=e.apply(void 0,[n].concat(i));if(o.length>1){var s=o.map((function(e){return ot(null,e).message})).join("\n\n");throw st(t.apply(void 0,[n].concat(i))+"\n\nHere are the matching elements:\n\n"+s,n)}return o[0]||null}}function ht(e,t){return Ae().getElementError("A better query is available, try this:\n"+e.toString()+"\n",t)}function dt(e,t){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=e.apply(void 0,[n].concat(i));if(!o.length)throw Ae().getElementError(t.apply(void 0,[n].concat(i)),n);return o}}function ft(e){return function(t,n,i,a){return at((function(){return e(t,n,i)}),(0,r.Z)({container:t},a))}}var pt=function(e,t,n){return function(r){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=e.apply(void 0,[r].concat(a)),u=a.slice(-1),l=u[0],c=(l=void 0===l?{}:l).suggest,h=void 0===c?Ae().throwSuggestions:c;if(s&&h){var d=rt(s,n);if(d&&!t.endsWith(d.queryName))throw ht(d.toString(),r)}return s}},vt=function(e,t,n){return function(r){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=e.apply(void 0,[r].concat(a)),u=a.slice(-1),l=u[0],c=(l=void 0===l?{}:l).suggest,h=void 0===c?Ae().throwSuggestions:c;if(s.length&&h){var d=[].concat(new Set(s.map((function(e){var t;return null==(t=rt(e,n))?void 0:t.toString()}))));if(1===d.length&&!t.endsWith(rt(s[0],n).queryName))throw ht(d[0],r)}return s}};function mt(e,t,n){var r=pt(ct(e,t),e.name,"query"),i=dt(e,n),a=ct(i,t),o=pt(a,e.name,"get");return[r,vt(i,e.name.replace("query","get"),"getAll"),o,ft(vt(i,e.name,"findAll")),ft(pt(a,e.name,"find"))]}var gt=Object.freeze({__proto__:null,getElementError:ot,wrapAllByQueryWithSuggestion:vt,wrapSingleQueryWithSuggestion:pt,getMultipleElementsFoundError:st,queryAllByAttribute:ut,queryByAttribute:lt,makeSingleQuery:ct,makeGetAllQuery:dt,makeFindQuery:ft,buildQueries:mt});var _t=function(e,t,n){var r=void 0===n?{}:n,i=r.exact,a=void 0===i||i,o=r.trim,s=r.collapseWhitespace,u=r.normalizer,l=a?je:ze,c=Fe({collapseWhitespace:s,trim:o,normalizer:u}),h=function(e){return Array.from(e.querySelectorAll("label,input")).map((function(e){return{node:e,textToMatch:Re(e)}})).filter((function(e){return null!==e.textToMatch}))}(e);return h.filter((function(e){var n=e.node,r=e.textToMatch;return l(r,n,t,c)})).map((function(e){return e.node}))},yt=function(e,t,n){var r=void 0===n?{}:n,i=r.selector,a=void 0===i?"*":i,o=r.exact,s=void 0===o||o,u=r.collapseWhitespace,l=r.trim,c=r.normalizer;xe(e);var h=s?je:ze,d=Fe({collapseWhitespace:u,trim:l,normalizer:c}),f=Array.from(e.querySelectorAll("*")).filter((function(e){return Oe(e).length||e.hasAttribute("aria-labelledby")})).reduce((function(n,r){var i=Ne(e,r,{selector:a});i.filter((function(e){return Boolean(e.formControl)})).forEach((function(e){h(e.content,e.formControl,t,d)&&e.formControl&&n.push(e.formControl)}));var o=i.filter((function(e){return Boolean(e.content)})).map((function(e){return e.content}));return h(o.join(" "),r,t,d)&&n.push(r),o.length>1&&o.forEach((function(e,i){h(e,r,t,d)&&n.push(r);var a=[].concat(o);a.splice(i,1),a.length>1&&h(a.join(" "),r,t,d)&&n.push(r)})),n}),[]).concat(ut("aria-label",e,t,{exact:s,normalizer:d}));return Array.from(new Set(f)).filter((function(e){return e.matches(a)}))},bt=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=yt.apply(void 0,[e,t].concat(r));if(!a.length){var o=_t.apply(void 0,[e,t].concat(r));if(o.length){var s=o.map((function(t){return xt(e,t)})).filter((function(e){return!!e}));throw s.length?Ae().getElementError(s.map((function(e){return"Found a label with the text of: "+t+", however the element associated with this label (<"+e+" />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <"+e+" />, you can use aria-label or aria-labelledby instead."})).join("\n\n"),e):Ae().getElementError("Found a label with the text of: "+t+', however no form control was found associated to that label. Make sure you\'re using the "for" attribute or "aria-labelledby" attribute correctly.',e)}throw Ae().getElementError("Unable to find a label with the text of: "+t,e)}return a};function xt(e,t){var n=t.getAttribute("for");if(!n)return null;var r=e.querySelector('[id="'+n+'"]');return r?r.tagName.toLowerCase():null}var wt=function(e,t){return"Found multiple elements with the text of: "+t},kt=pt(ct(yt,wt),yt.name,"query"),St=ct(bt,wt),Mt=ft(vt(bt,bt.name,"findAll")),Ct=ft(pt(St,bt.name,"find")),Tt=vt(bt,bt.name,"getAll"),Et=pt(St,bt.name,"get"),Pt=vt(yt,yt.name,"queryAll"),At=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return xe(t[0]),ut.apply(void 0,["placeholder"].concat(t))},Lt=vt(At,At.name,"queryAll"),It=mt(At,(function(e,t){return"Found multiple elements with the placeholder text of: "+t}),(function(e,t){return"Unable to find an element with the placeholder text of: "+t})),Rt=It[0],Ot=It[1],Nt=It[2],Dt=It[3],zt=It[4],jt=function(e,t,n){var r=void 0===n?{}:n,i=r.selector,a=void 0===i?"*":i,o=r.exact,s=void 0===o||o,u=r.collapseWhitespace,l=r.trim,c=r.ignore,h=void 0===c?Ae().defaultIgnore:c,d=r.normalizer;xe(e);var f=s?je:ze,p=Fe({collapseWhitespace:u,trim:l,normalizer:d}),v=[];return"function"===typeof e.matches&&e.matches(a)&&(v=[e]),[].concat(v,Array.from(e.querySelectorAll(a))).filter((function(e){return!h||!e.matches(h)})).filter((function(e){return f(qe(e),e,t,p)}))},Bt=vt(jt,jt.name,"queryAll"),Ft=mt(jt,(function(e,t){return"Found multiple elements with the text: "+t}),(function(e,t,n){void 0===n&&(n={});var r=n,i=Fe({collapseWhitespace:r.collapseWhitespace,trim:r.trim,normalizer:r.normalizer})(t.toString());return"Unable to find an element with the text: "+(i!==t.toString()?i+" (normalized from '"+t+"')":t)+". This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible."})),$t=Ft[0],qt=Ft[1],Ut=Ft[2],Vt=Ft[3],Ht=Ft[4],Wt=function(e,t,n){var r=void 0===n?{}:n,i=r.exact,a=void 0===i||i,o=r.collapseWhitespace,s=r.trim,u=r.normalizer;xe(e);var l=a?je:ze,c=Fe({collapseWhitespace:o,trim:s,normalizer:u});return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){return"SELECT"===e.tagName?Array.from(e.options).filter((function(e){return e.selected})).some((function(e){return l(qe(e),e,t,c)})):l(e.value,e,t,c)}))},Gt=vt(Wt,Wt.name,"queryAll"),Zt=mt(Wt,(function(e,t){return"Found multiple elements with the display value: "+t+"."}),(function(e,t){return"Unable to find an element with the display value: "+t+"."})),Yt=Zt[0],Xt=Zt[1],Kt=Zt[2],Jt=Zt[3],Qt=Zt[4],en=/^(img|input|area|.+-.+)$/i,tn=function(e,t,n){return void 0===n&&(n={}),xe(e),ut("alt",e,t,n).filter((function(e){return en.test(e.tagName)}))},nn=vt(tn,tn.name,"queryAll"),rn=mt(tn,(function(e,t){return"Found multiple elements with the alt text: "+t}),(function(e,t){return"Unable to find an element with the alt text: "+t})),an=rn[0],on=rn[1],sn=rn[2],un=rn[3],ln=rn[4],cn=function(e,t,n){var r=void 0===n?{}:n,i=r.exact,a=void 0===i||i,o=r.collapseWhitespace,s=r.trim,u=r.normalizer;xe(e);var l=a?je:ze,c=Fe({collapseWhitespace:o,trim:s,normalizer:u});return Array.from(e.querySelectorAll("[title], svg > title")).filter((function(e){return l(e.getAttribute("title"),e,t,c)||function(e){var t;return"title"===e.tagName.toLowerCase()&&"svg"===(null==(t=e.parentElement)?void 0:t.tagName.toLowerCase())}(e)&&l(qe(e),e,t,c)}))},hn=vt(cn,cn.name,"queryAll"),dn=mt(cn,(function(e,t){return"Found multiple elements with the title: "+t+"."}),(function(e,t){return"Unable to find an element with the title: "+t+"."})),fn=dn[0],pn=dn[1],vn=dn[2],mn=dn[3],gn=dn[4];function _n(e,t,n){var r=void 0===n?{}:n,i=r.exact,a=void 0===i||i,o=r.collapseWhitespace,s=r.hidden,u=void 0===s?Ae().defaultHidden:s,l=r.name,c=r.description,h=r.trim,d=r.normalizer,f=r.queryFallbacks,p=void 0!==f&&f,v=r.selected,m=r.checked,g=r.pressed,_=r.current,y=r.level,b=r.expanded;xe(e);var x,w,k,S,M,C=a?je:ze,T=Fe({collapseWhitespace:o,trim:h,normalizer:d});if(void 0!==v&&void 0===(null==(x=re.uJ.get(t))?void 0:x.props["aria-selected"]))throw new Error('"aria-selected" is not supported on role "'+t+'".');if(void 0!==m&&void 0===(null==(w=re.uJ.get(t))?void 0:w.props["aria-checked"]))throw new Error('"aria-checked" is not supported on role "'+t+'".');if(void 0!==g&&void 0===(null==(k=re.uJ.get(t))?void 0:k.props["aria-pressed"]))throw new Error('"aria-pressed" is not supported on role "'+t+'".');if(void 0!==_&&void 0===(null==(S=re.uJ.get(t))?void 0:S.props["aria-current"]))throw new Error('"aria-current" is not supported on role "'+t+'".');if(void 0!==y&&"heading"!==t)throw new Error('Role "'+t+'" cannot have "level" property.');if(void 0!==b&&void 0===(null==(M=re.uJ.get(t))?void 0:M.props["aria-expanded"]))throw new Error('"aria-expanded" is not supported on role "'+t+'".');var E=new WeakMap;function P(e){return E.has(e)||E.set(e,We(e)),E.get(e)}return Array.from(e.querySelectorAll(function(e,t,n){var r;if("string"!==typeof e)return"*";var i=t&&!n?'*[role~="'+e+'"]':"*[role]",a=null!=(r=re.UN.get(e))?r:new Set,o=new Set(Array.from(a).map((function(e){return e.name})));return[i].concat(Array.from(o)).join(",")}(t,a,d?T:void 0))).filter((function(e){if(e.hasAttribute("role")){var n=e.getAttribute("role");if(p)return n.split(" ").filter(Boolean).some((function(n){return C(n,e,t,T)}));if(d)return C(n,e,t,T);var r=n.split(" ")[0];return C(r,e,t,T)}return Ze(e).some((function(n){return C(n,e,t,T)}))})).filter((function(e){return void 0!==v?v===function(e){return"OPTION"===e.tagName?e.selected:Je(e,"aria-selected")}(e):void 0!==m?m===function(e){if(!("indeterminate"in e)||!e.indeterminate)return"checked"in e?e.checked:Je(e,"aria-checked")}(e):void 0!==g?g===function(e){return Je(e,"aria-pressed")}(e):void 0!==_?_===function(e){var t,n;return null!=(t=null!=(n=Je(e,"aria-current"))?n:e.getAttribute("aria-current"))&&t}(e):void 0!==b?b===function(e){return Je(e,"aria-expanded")}(e):void 0===y||y===function(e){return e.getAttribute("aria-level")&&Number(e.getAttribute("aria-level"))||{H1:1,H2:2,H3:3,H4:4,H5:5,H6:6}[e.tagName]}(e)})).filter((function(e){return void 0===l||je(ne(e,{computedStyleSupportsPseudoElements:Ae().computedStyleSupportsPseudoElements}),e,l,(function(e){return e}))})).filter((function(e){return void 0===c||je(ee(e,{computedStyleSupportsPseudoElements:Ae().computedStyleSupportsPseudoElements}),e,c,(function(e){return e}))})).filter((function(e){return!1!==u||!1===Ge(e,{isSubtreeInaccessible:P})}))}var yn=vt(_n,_n.name,"queryAll"),bn=mt(_n,(function(e,t,n){var r=(void 0===n?{}:n).name;return'Found multiple elements with the role "'+t+'"'+(void 0===r?"":"string"===typeof r?' and name "'+r+'"':" and name `"+r+"`")}),(function(e,t,n){var r=void 0===n?{}:n,i=r.hidden,a=void 0===i?Ae().defaultHidden:i,o=r.name,s=r.description;if(Ae()._disableExpensiveErrorDiagnostics)return'Unable to find role="'+t+'"';var u,l="";Array.from(e.children).forEach((function(e){l+=Xe(e,{hidden:a,includeDescription:void 0!==s})})),u=0===l.length?!1===a?"There are no accessible roles. But there might be some inaccessible roles. If you wish to access them, then set the `hidden` option to `true`. Learn more about this here: https://testing-library.com/docs/dom-testing-library/api-queries#byrole":"There are no available roles.":("\nHere are the "+(!1===a?"accessible":"available")+" roles:\n\n  "+l.replace(/\n/g,"\n  ").replace(/\n\s\s\n/g,"\n\n")+"\n").trim();return("\nUnable to find an "+(!1===a?"accessible ":"")+'element with the role "'+t+'"'+(void 0===o?"":"string"===typeof o?' and name "'+o+'"':" and name `"+o+"`")+(void 0===s?"":"string"===typeof s?' and description "'+s+'"':" and description `"+s+"`")+"\n\n"+u).trim()})),xn=bn[0],wn=bn[1],kn=bn[2],Sn=bn[3],Mn=bn[4],Cn=function(){return Ae().testIdAttribute},Tn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return xe(t[0]),ut.apply(void 0,[Cn()].concat(t))},En=vt(Tn,Tn.name,"queryAll"),Pn=mt(Tn,(function(e,t){return"Found multiple elements by: ["+Cn()+'="'+t+'"]'}),(function(e,t){return"Unable to find an element by: ["+Cn()+'="'+t+'"]'})),An=Pn[0],Ln=Pn[1],In=Pn[2],Rn=Pn[3],On=Pn[4],Nn=Object.freeze({__proto__:null,queryAllByLabelText:Pt,queryByLabelText:kt,getAllByLabelText:Tt,getByLabelText:Et,findAllByLabelText:Mt,findByLabelText:Ct,queryByPlaceholderText:Rt,queryAllByPlaceholderText:Lt,getByPlaceholderText:Nt,getAllByPlaceholderText:Ot,findAllByPlaceholderText:Dt,findByPlaceholderText:zt,queryByText:$t,queryAllByText:Bt,getByText:Ut,getAllByText:qt,findAllByText:Vt,findByText:Ht,queryByDisplayValue:Yt,queryAllByDisplayValue:Gt,getByDisplayValue:Kt,getAllByDisplayValue:Xt,findAllByDisplayValue:Jt,findByDisplayValue:Qt,queryByAltText:an,queryAllByAltText:nn,getByAltText:sn,getAllByAltText:on,findAllByAltText:un,findByAltText:ln,queryByTitle:fn,queryAllByTitle:hn,getByTitle:vn,getAllByTitle:pn,findAllByTitle:mn,findByTitle:gn,queryByRole:xn,queryAllByRole:yn,getAllByRole:wn,getByRole:kn,findAllByRole:Sn,findByRole:Mn,queryByTestId:An,queryAllByTestId:En,getByTestId:In,getAllByTestId:Ln,findAllByTestId:Rn,findByTestId:On});function Dn(e,t,n){return void 0===t&&(t=Nn),void 0===n&&(n={}),Object.keys(t).reduce((function(n,r){var i=t[r];return n[r]=i.bind(null,e),n}),n)}var zn=function(e){return!e||Array.isArray(e)&&!e.length};function jn(e){if(zn(e))throw new Error("The element(s) given to waitForElementToBeRemoved are already removed. waitForElementToBeRemoved requires that the element(s) exist(s) before waiting for removal.")}function Bn(e,t){return Fn.apply(this,arguments)}function Fn(){return(Fn=(0,ie.Z)(oe().mark((function e(t,n){var r,i,a;return oe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Error("Timed out in waitForElementToBeRemoved."),"function"!==typeof t&&(jn(t),i=Array.isArray(t)?t:[t],a=i.map((function(e){var t=e.parentElement;if(null===t)return function(){return null};for(;t.parentElement;)t=t.parentElement;return function(){return t.contains(e)?e:null}})),t=function(){return a.map((function(e){return e()})).filter(Boolean)}),jn(t()),e.abrupt("return",at((function(){var e;try{e=t()}catch(n){if("TestingLibraryElementError"===n.name)return;throw n}if(!zn(e))throw r}),n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $n={copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionEnd:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionStart:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionUpdate:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyDown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyPress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyUp:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusIn:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusOut:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},invalid:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!0}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},reset:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},click:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,button:0,composed:!0}},contextMenu:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblClick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drag:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragEnd:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragEnter:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragExit:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragLeave:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragOver:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragStart:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drop:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseDown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseEnter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseLeave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseMove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOut:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOver:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseUp:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},select:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},touchCancel:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},touchEnd:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchMove:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchStart:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},resize:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},scroll:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},wheel:{EventType:"WheelEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},abort:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlay:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlayThrough:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},durationChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},emptied:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},encrypted:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},ended:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedData:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedMetadata:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadStart:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},pause:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},play:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},playing:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},progress:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},rateChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeked:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeking:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},stalled:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},suspend:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},timeUpdate:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},volumeChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},waiting:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},load:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},error:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},animationStart:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationEnd:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationIteration:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionCancel:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionEnd:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},transitionRun:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionStart:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},pointerOver:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerEnter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerDown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerMove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerUp:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerCancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerOut:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerLeave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},gotPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},lostPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},popState:{EventType:"PopStateEvent",defaultInit:{bubbles:!0,cancelable:!1}}},qn={doubleClick:"dblClick"},Un=["value","files"],Vn=["bubbles","cancelable","detail"];function Hn(e,t){return Ae().eventWrapper((function(){if(!t)throw new Error("Unable to fire an event - please provide an event object.");if(!e)throw new Error('Unable to fire a "'+t.type+'" event - please provide a DOM element.');return e.dispatchEvent(t)}))}function Wn(e,t,n,a){var o=void 0===a?{}:a,s=o.EventType,u=void 0===s?"Event":s,l=o.defaultInit,c=void 0===l?{}:l;if(!t)throw new Error('Unable to fire a "'+e+'" event - please provide a DOM element.');var h=(0,r.Z)({},c,n),d=h.target,f=(d=void 0===d?{}:d).value,p=d.files,v=(0,i.Z)(d,Un);void 0!==f&&function(e,t){var n=(Object.getOwnPropertyDescriptor(e,"value")||{}).set,r=Object.getPrototypeOf(e),i=(Object.getOwnPropertyDescriptor(r,"value")||{}).set;if(i&&n!==i)i.call(e,t);else{if(!n)throw new Error("The given element does not have a value setter");n.call(e,t)}}(t,f),void 0!==p&&Object.defineProperty(t,"files",{configurable:!0,enumerable:!0,writable:!0,value:p}),Object.assign(t,v);var m,g=be(t),_=g[u]||g.Event;if("function"===typeof _)m=new _(e,h);else{m=g.document.createEvent(u);var y=h.bubbles,b=h.cancelable,x=h.detail,w=(0,i.Z)(h,Vn);m.initEvent(e,y,b,x),Object.keys(w).forEach((function(e){m[e]=w[e]}))}return["dataTransfer","clipboardData"].forEach((function(e){var t=h[e];"object"===typeof t&&("function"===typeof g.DataTransfer?Object.defineProperty(m,e,{value:Object.getOwnPropertyNames(t).reduce((function(e,n){return Object.defineProperty(e,n,{value:t[n]}),e}),new g.DataTransfer)}):Object.defineProperty(m,e,{value:t}))})),m}function Gn(e){return"https://testing-playground.com/#markup="+(t=e,(0,se.compressToEncodedURIComponent)(t.replace(/[ \t]*[\n][ \t]*/g,"\n")));var t}Object.keys($n).forEach((function(e){var t=$n[e],n=t.EventType,r=t.defaultInit,i=e.toLowerCase();Wn[e]=function(e,t){return Wn(i,e,t,{EventType:n,defaultInit:r})},Hn[e]=function(t,n){return Hn(t,Wn[e](t,n))}})),Object.keys(qn).forEach((function(e){var t=qn[e];Hn[e]=function(){return Hn[t].apply(Hn,arguments)}}));var Zn={debug:function(e,t,n){return Array.isArray(e)?e.forEach((function(e){return Ce(e,t,n)})):Ce(e,t,n)},logTestingPlaygroundURL:function(e){void 0===e&&(e=ye().body),e&&"innerHTML"in e?e.innerHTML?console.log("Open this URL in your browser\n\n"+Gn(e.innerHTML)):console.log("The provided element doesn't have any children."):console.log("The element you're providing isn't a valid DOM element.")}},Yn="undefined"!==typeof document&&document.body?Dn(document.body,Nn,Zn):Object.keys(Nn).reduce((function(e,t){return e[t]=function(){throw new TypeError("For queries bound to document.body a global document has to be available... Learn more: https://testing-library.com/s/screen-global-error")},e}),Zn)},3980:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_NODE=void 0,t.checkContainerType=function(e){if(!e||"function"!==typeof e.querySelector||"function"!==typeof e.querySelectorAll)throw new TypeError("Expected container to be an Element, a Document or a DocumentFragment but got ".concat(function(e){if("object"===typeof e)return null===e?"null":e.constructor.name;return typeof e}(e),"."))},t.getDocument=function(){if("undefined"===typeof window)throw new Error("Could not find default container");return window.document},t.getWindowFromNode=function(e){if(e.defaultView)return e.defaultView;if(e.ownerDocument&&e.ownerDocument.defaultView)return e.ownerDocument.defaultView;if(e.window)return e.window;throw e.ownerDocument&&null===e.ownerDocument.defaultView?new Error("It looks like the window object is not available for the provided node."):e.then instanceof Function?new Error("It looks like you passed a Promise object instead of a DOM node. Did you do something like `fireEvent.click(screen.findBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`, or await the findBy query `fireEvent.click(await screen.findBy...`?"):Array.isArray(e)?new Error("It looks like you passed an Array instead of a DOM node. Did you do something like `fireEvent.click(screen.getAllBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`?"):"function"===typeof e.debug&&"function"===typeof e.logTestingPlaygroundURL?new Error("It looks like you passed a `screen` object. Did you do something like `fireEvent.click(screen, ...` when you meant to use a query, e.g. `fireEvent.click(screen.getBy..., `?"):new Error("The given node is not an Element, the node type is: ".concat(typeof e,"."))},t.jestFakeTimersAreEnabled=function(){if("undefined"!==typeof jest&&null!==jest)return!0===setTimeout._isMockFunction||Object.prototype.hasOwnProperty.call(setTimeout,"clock");return!1};t.TEXT_NODE=3},8892:function(e,t){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=[["aria-activedescendant",{type:"id"}],["aria-atomic",{type:"boolean"}],["aria-autocomplete",{type:"token",values:["inline","list","both","none"]}],["aria-busy",{type:"boolean"}],["aria-checked",{type:"tristate"}],["aria-colcount",{type:"integer"}],["aria-colindex",{type:"integer"}],["aria-colspan",{type:"integer"}],["aria-controls",{type:"idlist"}],["aria-current",{type:"token",values:["page","step","location","date","time",!0,!1]}],["aria-describedby",{type:"idlist"}],["aria-details",{type:"id"}],["aria-disabled",{type:"boolean"}],["aria-dropeffect",{type:"tokenlist",values:["copy","execute","link","move","none","popup"]}],["aria-errormessage",{type:"id"}],["aria-expanded",{type:"boolean",allowundefined:!0}],["aria-flowto",{type:"idlist"}],["aria-grabbed",{type:"boolean",allowundefined:!0}],["aria-haspopup",{type:"token",values:[!1,!0,"menu","listbox","tree","grid","dialog"]}],["aria-hidden",{type:"boolean",allowundefined:!0}],["aria-invalid",{type:"token",values:["grammar",!1,"spelling",!0]}],["aria-keyshortcuts",{type:"string"}],["aria-label",{type:"string"}],["aria-labelledby",{type:"idlist"}],["aria-level",{type:"integer"}],["aria-live",{type:"token",values:["assertive","off","polite"]}],["aria-modal",{type:"boolean"}],["aria-multiline",{type:"boolean"}],["aria-multiselectable",{type:"boolean"}],["aria-orientation",{type:"token",values:["vertical","undefined","horizontal"]}],["aria-owns",{type:"idlist"}],["aria-placeholder",{type:"string"}],["aria-posinset",{type:"integer"}],["aria-pressed",{type:"tristate"}],["aria-readonly",{type:"boolean"}],["aria-relevant",{type:"tokenlist",values:["additions","all","removals","text"]}],["aria-required",{type:"boolean"}],["aria-roledescription",{type:"string"}],["aria-rowcount",{type:"integer"}],["aria-rowindex",{type:"integer"}],["aria-rowspan",{type:"integer"}],["aria-selected",{type:"boolean",allowundefined:!0}],["aria-setsize",{type:"integer"}],["aria-sort",{type:"token",values:["ascending","descending","none","other"]}],["aria-valuemax",{type:"number"}],["aria-valuemin",{type:"number"}],["aria-valuenow",{type:"number"}],["aria-valuetext",{type:"string"}]],a={entries:function(){return i},get:function(e){var t=i.find((function(t){return t[0]===e}));return t&&t[1]},has:function(e){return!!this.get(e)},keys:function(){return i.map((function(e){return n(e,1)[0]}))},values:function(){return i.map((function(e){return n(e,2)[1]}))}};t.default=a},9188:function(e,t){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=[["a",{reserved:!1}],["abbr",{reserved:!1}],["acronym",{reserved:!1}],["address",{reserved:!1}],["applet",{reserved:!1}],["area",{reserved:!1}],["article",{reserved:!1}],["aside",{reserved:!1}],["audio",{reserved:!1}],["b",{reserved:!1}],["base",{reserved:!0}],["bdi",{reserved:!1}],["bdo",{reserved:!1}],["big",{reserved:!1}],["blink",{reserved:!1}],["blockquote",{reserved:!1}],["body",{reserved:!1}],["br",{reserved:!1}],["button",{reserved:!1}],["canvas",{reserved:!1}],["caption",{reserved:!1}],["center",{reserved:!1}],["cite",{reserved:!1}],["code",{reserved:!1}],["col",{reserved:!0}],["colgroup",{reserved:!0}],["content",{reserved:!1}],["data",{reserved:!1}],["datalist",{reserved:!1}],["dd",{reserved:!1}],["del",{reserved:!1}],["details",{reserved:!1}],["dfn",{reserved:!1}],["dialog",{reserved:!1}],["dir",{reserved:!1}],["div",{reserved:!1}],["dl",{reserved:!1}],["dt",{reserved:!1}],["em",{reserved:!1}],["embed",{reserved:!1}],["fieldset",{reserved:!1}],["figcaption",{reserved:!1}],["figure",{reserved:!1}],["font",{reserved:!1}],["footer",{reserved:!1}],["form",{reserved:!1}],["frame",{reserved:!1}],["frameset",{reserved:!1}],["h1",{reserved:!1}],["h2",{reserved:!1}],["h3",{reserved:!1}],["h4",{reserved:!1}],["h5",{reserved:!1}],["h6",{reserved:!1}],["head",{reserved:!0}],["header",{reserved:!1}],["hgroup",{reserved:!1}],["hr",{reserved:!1}],["html",{reserved:!0}],["i",{reserved:!1}],["iframe",{reserved:!1}],["img",{reserved:!1}],["input",{reserved:!1}],["ins",{reserved:!1}],["kbd",{reserved:!1}],["keygen",{reserved:!1}],["label",{reserved:!1}],["legend",{reserved:!1}],["li",{reserved:!1}],["link",{reserved:!0}],["main",{reserved:!1}],["map",{reserved:!1}],["mark",{reserved:!1}],["marquee",{reserved:!1}],["menu",{reserved:!1}],["menuitem",{reserved:!1}],["meta",{reserved:!0}],["meter",{reserved:!1}],["nav",{reserved:!1}],["noembed",{reserved:!0}],["noscript",{reserved:!0}],["object",{reserved:!1}],["ol",{reserved:!1}],["optgroup",{reserved:!1}],["option",{reserved:!1}],["output",{reserved:!1}],["p",{reserved:!1}],["param",{reserved:!0}],["picture",{reserved:!0}],["pre",{reserved:!1}],["progress",{reserved:!1}],["q",{reserved:!1}],["rp",{reserved:!1}],["rt",{reserved:!1}],["rtc",{reserved:!1}],["ruby",{reserved:!1}],["s",{reserved:!1}],["samp",{reserved:!1}],["script",{reserved:!0}],["section",{reserved:!1}],["select",{reserved:!1}],["small",{reserved:!1}],["source",{reserved:!0}],["spacer",{reserved:!1}],["span",{reserved:!1}],["strike",{reserved:!1}],["strong",{reserved:!1}],["style",{reserved:!0}],["sub",{reserved:!1}],["summary",{reserved:!1}],["sup",{reserved:!1}],["table",{reserved:!1}],["tbody",{reserved:!1}],["td",{reserved:!1}],["textarea",{reserved:!1}],["tfoot",{reserved:!1}],["th",{reserved:!1}],["thead",{reserved:!1}],["time",{reserved:!1}],["title",{reserved:!0}],["tr",{reserved:!1}],["track",{reserved:!0}],["tt",{reserved:!1}],["u",{reserved:!1}],["ul",{reserved:!1}],["var",{reserved:!1}],["video",{reserved:!1}],["wbr",{reserved:!1}],["xmp",{reserved:!1}]],a={entries:function(){return i},get:function(e){var t=i.find((function(t){return t[0]===e}));return t&&t[1]},has:function(e){return!!this.get(e)},keys:function(){return i.map((function(e){return n(e,1)[0]}))},values:function(){return i.map((function(e){return n(e,2)[1]}))}};t.default=a},7444:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(48))&&r.__esModule?r:{default:r};function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}for(var s=[],u=i.default.keys(),l=0;l<u.length;l++){var c=u[l],h=i.default.get(c);if(h)for(var d=[].concat(h.baseConcepts,h.relatedConcepts),f=0;f<d.length;f++){var p=d[f];if("HTML"===p.module){var v=p.concept;v&&function(){var e=JSON.stringify(v),t=s.find((function(t){return JSON.stringify(t[0])===e})),n=void 0;n=t?t[1]:[];for(var r=!0,i=0;i<n.length;i++)if(n[i]===c){r=!1;break}r&&n.push(c),s.push([v,n])}()}}}var m={entries:function(){return s},get:function(e){var t=s.find((function(t){return JSON.stringify(t[0])===JSON.stringify(e)}));return t&&t[1]},has:function(e){return!!this.get(e)},keys:function(){return s.map((function(e){return a(e,1)[0]}))},values:function(){return s.map((function(e){return a(e,2)[1]}))}};t.default=m},170:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]};t.default=n},5520:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]};t.default=n},972:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null},relatedConcepts:[{concept:{name:"input"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]};t.default=n},5298:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},4197:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},1508:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{"aria-atomic":null,"aria-busy":null,"aria-controls":null,"aria-current":null,"aria-describedby":null,"aria-details":null,"aria-dropeffect":null,"aria-flowto":null,"aria-grabbed":null,"aria-hidden":null,"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-live":null,"aria-owns":null,"aria-relevant":null,"aria-roledescription":null},relatedConcepts:[{concept:{name:"rel"},module:"HTML"},{concept:{name:"role"},module:"XHTML"},{concept:{name:"type"},module:"Dublin Core"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]};t.default=n},2166:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"frontmatter"},module:"DTB"},{concept:{name:"level"},module:"DTB"},{concept:{name:"level"},module:"SMIL"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},4298:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},3635:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","group"]]};t.default=n},6825:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]};t.default=n},2195:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]};t.default=n},723:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-modal":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]};t.default=n},2202:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=v(n(170)),i=v(n(5520)),a=v(n(972)),o=v(n(5298)),s=v(n(4197)),u=v(n(1508)),l=v(n(2166)),c=v(n(4298)),h=v(n(3635)),d=v(n(6825)),f=v(n(2195)),p=v(n(723));function v(e){return e&&e.__esModule?e:{default:e}}var m=[["command",r.default],["composite",i.default],["input",a.default],["landmark",o.default],["range",s.default],["roletype",u.default],["section",l.default],["sectionhead",c.default],["select",h.default],["structure",d.default],["widget",f.default],["window",p.default]];t.default=m},3132:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=q(n(4334)),i=q(n(8373)),a=q(n(8541)),o=q(n(9014)),s=q(n(1901)),u=q(n(183)),l=q(n(1715)),c=q(n(7578)),h=q(n(6359)),d=q(n(2850)),f=q(n(2666)),p=q(n(3909)),v=q(n(2240)),m=q(n(1192)),g=q(n(6451)),_=q(n(8887)),y=q(n(3505)),b=q(n(1157)),x=q(n(80)),w=q(n(7083)),k=q(n(4120)),S=q(n(8705)),M=q(n(6964)),C=q(n(6953)),T=q(n(8945)),E=q(n(9449)),P=q(n(6211)),A=q(n(415)),L=q(n(6480)),I=q(n(236)),R=q(n(4812)),O=q(n(4101)),N=q(n(9345)),D=q(n(8572)),z=q(n(4123)),j=q(n(109)),B=q(n(1700)),F=q(n(5326)),$=q(n(8878));function q(e){return e&&e.__esModule?e:{default:e}}var U=[["doc-abstract",r.default],["doc-acknowledgments",i.default],["doc-afterword",a.default],["doc-appendix",o.default],["doc-backlink",s.default],["doc-biblioentry",u.default],["doc-bibliography",l.default],["doc-biblioref",c.default],["doc-chapter",h.default],["doc-colophon",d.default],["doc-conclusion",f.default],["doc-cover",p.default],["doc-credit",v.default],["doc-credits",m.default],["doc-dedication",g.default],["doc-endnote",_.default],["doc-endnotes",y.default],["doc-epigraph",b.default],["doc-epilogue",x.default],["doc-errata",w.default],["doc-example",k.default],["doc-footnote",S.default],["doc-foreword",M.default],["doc-glossary",C.default],["doc-glossref",T.default],["doc-index",E.default],["doc-introduction",P.default],["doc-noteref",A.default],["doc-notice",L.default],["doc-pagebreak",I.default],["doc-pagelist",R.default],["doc-part",O.default],["doc-preface",N.default],["doc-prologue",D.default],["doc-pullquote",z.default],["doc-qna",j.default],["doc-subtitle",B.default],["doc-tip",F.default],["doc-toc",$.default]];t.default=U},102:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=Le(n(4671)),i=Le(n(8592)),a=Le(n(741)),o=Le(n(2796)),s=Le(n(1849)),u=Le(n(9069)),l=Le(n(1930)),c=Le(n(8853)),h=Le(n(1661)),d=Le(n(5185)),f=Le(n(4219)),p=Le(n(5430)),v=Le(n(4397)),m=Le(n(9196)),g=Le(n(2147)),_=Le(n(1202)),y=Le(n(603)),b=Le(n(6352)),x=Le(n(4379)),w=Le(n(6684)),k=Le(n(2478)),S=Le(n(6258)),M=Le(n(6198)),C=Le(n(1104)),T=Le(n(4600)),E=Le(n(2857)),P=Le(n(9648)),A=Le(n(1223)),L=Le(n(1997)),I=Le(n(5608)),R=Le(n(5098)),O=Le(n(6853)),N=Le(n(672)),D=Le(n(203)),z=Le(n(4847)),j=Le(n(511)),B=Le(n(2082)),F=Le(n(8681)),$=Le(n(5866)),q=Le(n(3900)),U=Le(n(9531)),V=Le(n(9083)),H=Le(n(235)),W=Le(n(7754)),G=Le(n(3315)),Z=Le(n(1396)),Y=Le(n(2845)),X=Le(n(595)),K=Le(n(5073)),J=Le(n(7783)),Q=Le(n(6294)),ee=Le(n(7623)),te=Le(n(6323)),ne=Le(n(229)),re=Le(n(9461)),ie=Le(n(1994)),ae=Le(n(746)),oe=Le(n(1458)),se=Le(n(1150)),ue=Le(n(9529)),le=Le(n(4420)),ce=Le(n(5733)),he=Le(n(3286)),de=Le(n(5798)),fe=Le(n(9651)),pe=Le(n(3917)),ve=Le(n(6994)),me=Le(n(3615)),ge=Le(n(7600)),_e=Le(n(8392)),ye=Le(n(7203)),be=Le(n(3098)),xe=Le(n(7555)),we=Le(n(8268)),ke=Le(n(6838)),Se=Le(n(3691)),Me=Le(n(2921)),Ce=Le(n(7501)),Te=Le(n(4079)),Ee=Le(n(2e3)),Pe=Le(n(4033)),Ae=Le(n(6380));function Le(e){return e&&e.__esModule?e:{default:e}}var Ie=[["alert",r.default],["alertdialog",i.default],["application",a.default],["article",o.default],["banner",s.default],["blockquote",u.default],["button",l.default],["caption",c.default],["cell",h.default],["checkbox",d.default],["code",f.default],["columnheader",p.default],["combobox",v.default],["complementary",m.default],["contentinfo",g.default],["definition",_.default],["deletion",y.default],["dialog",b.default],["directory",x.default],["document",w.default],["emphasis",k.default],["feed",S.default],["figure",M.default],["form",C.default],["generic",T.default],["grid",E.default],["gridcell",P.default],["group",A.default],["heading",L.default],["img",I.default],["insertion",R.default],["link",O.default],["list",N.default],["listbox",D.default],["listitem",z.default],["log",j.default],["main",B.default],["marquee",F.default],["math",$.default],["menu",q.default],["menubar",U.default],["menuitem",V.default],["menuitemcheckbox",H.default],["menuitemradio",W.default],["meter",G.default],["navigation",Z.default],["none",Y.default],["note",X.default],["option",K.default],["paragraph",J.default],["presentation",Q.default],["progressbar",ee.default],["radio",te.default],["radiogroup",ne.default],["region",re.default],["row",ie.default],["rowgroup",ae.default],["rowheader",oe.default],["scrollbar",se.default],["search",ue.default],["searchbox",le.default],["separator",ce.default],["slider",he.default],["spinbutton",de.default],["status",fe.default],["strong",pe.default],["subscript",ve.default],["superscript",me.default],["switch",ge.default],["tab",_e.default],["table",ye.default],["tablist",be.default],["tabpanel",xe.default],["term",we.default],["textbox",ke.default],["time",Se.default],["timer",Me.default],["toolbar",Ce.default],["tooltip",Te.default],["tree",Ee.default],["treegrid",Pe.default],["treeitem",Ae.default]];t.default=Ie},4334:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"abstract [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},8373:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"acknowledgments [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},8541:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"afterword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},9014:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"appendix [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},1901:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","content"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"referrer [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};t.default=n},183:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"EPUB biblioentry [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-bibliography"],requiredContextRole:["doc-bibliography"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]};t.default=n},1715:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"bibliography [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-biblioentry"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},7578:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"biblioref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};t.default=n},6359:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"chapter [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},2850:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"colophon [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},2666:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"conclusion [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},3909:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"cover [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]};t.default=n},2240:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credit [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},1192:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credits [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},6451:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"dedication [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},8887:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-endnotes"],requiredContextRole:["doc-endnotes"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]};t.default=n},3505:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnotes [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-endnote"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},1157:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epigraph [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},80:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epilogue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},7083:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"errata [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},4120:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},8705:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"footnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6964:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"foreword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},6953:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossary [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["definition"],["term"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},8945:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};t.default=n},9449:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"index [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]};t.default=n},6211:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"introduction [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},415:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"noteref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};t.default=n},6480:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"notice [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]};t.default=n},236:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"pagebreak [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","separator"]]};t.default=n},4812:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"page-list [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]};t.default=n},4101:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"part [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},9345:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"preface [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},8572:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"prologue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},4123:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"pullquote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["none"]]};t.default=n},109:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"qna [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},1700:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"subtitle [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"]]};t.default=n},5326:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"help [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]};t.default=n},8878:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"toc [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]};t.default=n},4671:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"assertive"},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},8592:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","alert"],["roletype","window","dialog"]]};t.default=n},741:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},2796:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"article"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]};t.default=n},1849:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["direct descendant of document"],name:"header"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},9069:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},1930:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-pressed":null},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-pressed"},{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"aria-expanded",value:"false"}],name:"summary"},module:"HTML"},{concept:{attributes:[{name:"aria-expanded",value:"true"}],constraints:["direct descendant of details element with the open attribute defined"],name:"summary"},module:"HTML"},{concept:{attributes:[{name:"type",value:"button"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"image"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"reset"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"submit"}],name:"input"},module:"HTML"},{concept:{name:"button"},module:"HTML"},{concept:{name:"trigger"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]};t.default=n},8853:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:["figure","grid","table"],requiredContextRole:["figure","grid","table"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},1661:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-colspan":null,"aria-rowindex":null,"aria-rowspan":null},relatedConcepts:[{concept:{constraints:["descendant of table"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},5185:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]};t.default=n},4219:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},5430:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{attributes:[{name:"scope",value:"col"}],concept:{name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]};t.default=n},4397:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-expanded":"false","aria-haspopup":"listbox"},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{constraints:["undefined"],name:"size"}],name:"select"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{name:"size",value:1}],name:"select"},module:"HTML"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-expanded":"false"},superClass:[["roletype","widget","input"]]};t.default=n},9196:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"aside"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},2147:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["direct descendant of document"],name:"footer"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},1202:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dd"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},603:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6352:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dialog"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","window"]]};t.default=n},4379:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{module:"DAISY Guide"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","list"]]};t.default=n},6684:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}},{concept:{name:"body"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},2478:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6258:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["article"]],requiredProps:{},superClass:[["roletype","structure","section","list"]]};t.default=n},6198:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"figure"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},1104:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"name"}],name:"form"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},4600:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"span"},module:"HTML"},{concept:{name:"div"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},2857:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-multiselectable":null,"aria-readonly":null},relatedConcepts:[{concept:{attributes:[{name:"role",value:"grid"}],name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","table"]]};t.default=n},9648:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-selected":null},relatedConcepts:[{concept:{attributes:[{name:"role",value:"gridcell"}],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","widget"]]};t.default=n},1223:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[{concept:{name:"details"},module:"HTML"},{concept:{name:"fieldset"},module:"HTML"},{concept:{name:"optgroup"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},1997:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-level":"2"},relatedConcepts:[{concept:{name:"h1"},module:"HTML"},{concept:{name:"h2"},module:"HTML"},{concept:{name:"h3"},module:"HTML"},{concept:{name:"h4"},module:"HTML"},{concept:{name:"h5"},module:"HTML"},{concept:{name:"h6"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-level":"2"},superClass:[["roletype","structure","sectionhead"]]};t.default=n},5608:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"alt"}],name:"img"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"alt"}],name:"img"},module:"HTML"},{concept:{name:"imggroup"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},5098:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6853:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[{concept:{attributes:[{name:"href"}],name:"a"},module:"HTML"},{concept:{attributes:[{name:"href"}],name:"area"},module:"HTML"},{concept:{attributes:[{name:"href"}],name:"link"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]};t.default=n},672:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menu"},module:"HTML"},{concept:{name:"ol"},module:"HTML"},{concept:{name:"ul"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["listitem"]],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},203:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-multiselectable":null,"aria-readonly":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[{concept:{attributes:[{constraints:[">1"],name:"size"},{name:"multiple"}],name:"select"},module:"HTML"},{concept:{attributes:[{constraints:[">1"],name:"size"}],name:"select"},module:"HTML"},{concept:{attributes:[{name:"multiple"}],name:"select"},module:"HTML"},{concept:{name:"datalist"},module:"HTML"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["option","group"],["option"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};t.default=n},4847:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{constraints:["direct descendant of ol, ul or menu"],name:"li"},module:"HTML"},{concept:{name:"item"},module:"XForms"}],requireContextRole:["directory","list"],requiredContextRole:["directory","list"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},511:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-live":"polite"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},2082:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"main"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},8681:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},5866:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"math"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},3900:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"vertical"},relatedConcepts:[{concept:{name:"MENU"},module:"JAPI"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"},{concept:{name:"sidebar"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};t.default=n},9531:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"toolbar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select","menu"],["roletype","structure","section","group","select","menu"]]};t.default=n},9083:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"MENU_ITEM"},module:"JAPI"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"menuitem"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]};t.default=n},235:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"],["roletype","widget","command","menuitem"]]};t.default=n},7754:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox","menuitemcheckbox"],["roletype","widget","command","menuitem","menuitemcheckbox"],["roletype","widget","input","radio"]]};t.default=n},3315:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null,"aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","structure","range"]]};t.default=n},1396:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"nav"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},2845:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]};t.default=n},595:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},5073:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[{concept:{name:"item"},module:"XForms"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-selected":"false"},superClass:[["roletype","widget","input"]]};t.default=n},7783:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6294:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},7623:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null},relatedConcepts:[{concept:{name:"progress"},module:"HTML"},{concept:{name:"status"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","range"],["roletype","widget"]]};t.default=n},6323:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"radio"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]};t.default=n},229:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{name:"list"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["radio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};t.default=n},9461:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"section"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"section"},module:"HTML"},{concept:{name:"Device Independence Glossart perceivable unit"}},{concept:{name:"frame"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},1994:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-expanded":null,"aria-level":null,"aria-posinset":null,"aria-rowindex":null,"aria-selected":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"tr"},module:"HTML"}],requireContextRole:["grid","rowgroup","table","treegrid"],requiredContextRole:["grid","rowgroup","table","treegrid"],requiredOwnedElements:[["cell"],["columnheader"],["gridcell"],["rowheader"]],requiredProps:{},superClass:[["roletype","structure","section","group"],["roletype","widget"]]};t.default=n},746:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"tbody"},module:"HTML"},{concept:{name:"tfoot"},module:"HTML"},{concept:{name:"thead"},module:"HTML"}],requireContextRole:["grid","table","treegrid"],requiredContextRole:["grid","table","treegrid"],requiredOwnedElements:[["row"]],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},1458:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{attributes:[{name:"scope",value:"row"}],name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]};t.default=n},1150:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-valuetext":null,"aria-orientation":"vertical","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-valuenow":null},superClass:[["roletype","structure","range"],["roletype","widget"]]};t.default=n},9529:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};t.default=n},4420:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input","textbox"]]};t.default=n},5733:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":null,"aria-valuetext":null},relatedConcepts:[{concept:{name:"hr"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};t.default=n},3286:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-valuetext":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"range"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","widget","input"],["roletype","structure","range"]]};t.default=n},5798:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-valuetext":null,"aria-valuenow":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"number"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","widget","input"],["roletype","structure","range"]]};t.default=n},9651:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"polite"},relatedConcepts:[{concept:{name:"output"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},3917:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6994:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},3615:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},7600:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"button"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"]]};t.default=n},8392:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[],requireContextRole:["tablist"],requiredContextRole:["tablist"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"],["roletype","widget"]]};t.default=n},7203:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-colcount":null,"aria-rowcount":null},relatedConcepts:[{concept:{name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},3098:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-multiselectable":null,"aria-orientation":"horizontal"},relatedConcepts:[{module:"DAISY",concept:{name:"guide"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["tab"]],requiredProps:{},superClass:[["roletype","widget","composite"]]};t.default=n},7555:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},8268:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dfn"},module:"HTML"},{concept:{name:"dt"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},6838:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-multiline":null,"aria-placeholder":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"type"},{constraints:["undefined"],name:"list"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{name:"input"},module:"XForms"},{concept:{name:"textarea"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input"]]};t.default=n},3691:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},2921:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","status"]]};t.default=n},7501:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"menubar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]};t.default=n},4079:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};t.default=n},2e3:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-multiselectable":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["treeitem","group"],["treeitem"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};t.default=n},4033:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite","grid"],["roletype","structure","section","table","grid"],["roletype","widget","composite","select","tree"],["roletype","structure","section","group","select","tree"]]};t.default=n},6380:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[],requireContextRole:["group","tree"],requiredContextRole:["group","tree"],requiredOwnedElements:[],requiredProps:{"aria-selected":null},superClass:[["roletype","structure","section","listitem"],["roletype","widget","input","option"]]};t.default=n},294:function(e,t,n){"use strict";t.UN=t.Qv=t.uJ=void 0;var r=u(n(8892)),i=u(n(9188)),a=u(n(48)),o=u(n(7444)),s=u(n(8922));function u(e){return e&&e.__esModule?e:{default:e}}r.default,i.default;var l=a.default;t.uJ=l;var c=o.default;t.Qv=c;var h=s.default;t.UN=h},8922:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(48))&&r.__esModule?r:{default:r};function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}for(var s=[],u=i.default.keys(),l=function(e){var t=u[e],n=i.default.get(t);if(n)for(var r=[].concat(n.baseConcepts,n.relatedConcepts),a=0;a<r.length;a++){var o=r[a];if("HTML"===o.module){var l=o.concept;if(l){var c=s.find((function(e){return e[0]===t})),h=void 0;(h=c?c[1]:[]).push(l),s.push([t,h])}}}},c=0;c<u.length;c++)l(c);var h={entries:function(){return s},get:function(e){var t=s.find((function(t){return t[0]===e}));return t&&t[1]},has:function(e){return!!this.get(e)},keys:function(){return s.map((function(e){return a(e,1)[0]}))},values:function(){return s.map((function(e){return a(e,2)[1]}))}};t.default=h},48:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(2202)),i=o(n(102)),a=o(n(3132));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h=[].concat(r.default,i.default,a.default);h.forEach((function(e){var t,n=u(e,2)[1],r=s(n.superClass);try{for(r.s();!(t=r.n()).done;){var i,a=s(t.value);try{var o=function(){var e,t,r,a=i.value,o=h.find((function(e){return u(e,1)[0]===a}));if(o)for(var s=o[1],l=0,c=Object.keys(s.props);l<c.length;l++){var d=c[l];Object.prototype.hasOwnProperty.call(n.props,d)||Object.assign(n.props,(e={},t=d,r=s.props[d],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e))}};for(a.s();!(i=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}}}catch(l){r.e(l)}finally{r.f()}}));var d={entries:function(){return h},get:function(e){var t=h.find((function(t){return t[0]===e}));return t&&t[1]},has:function(e){return!!this.get(e)},keys:function(){return h.map((function(e){return u(e,1)[0]}))},values:function(){return h.map((function(e){return u(e,2)[1]}))}};t.default=d},9351:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blur=function(e){if(!(0,r.isFocusable)(e))return;if((0,r.getActiveElement)(e.ownerDocument)!==e)return;(0,r.eventWrapper)((function(){return e.blur()}))};var r=n(6395)},6354:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.click=h,t.dblClick=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.skipPointerEventsCheck,s=void 0!==o&&o;if(!s&&!(0,i.hasPointerEvents)(e))throw new Error('unable to double-click element as it has or inherits pointer-events set to "none".');(0,a.hover)(e,t,{skipPointerEventsCheck:s}),h(e,t,{skipHover:!0,clickCount:0,skipPointerEventsCheck:s}),h(e,t,{skipHover:!0,clickCount:1,skipPointerEventsCheck:s}),r.fireEvent.dblClick(e,(0,i.getMouseEventOptions)("dblclick",t,2))};var r=n(6075),i=n(6395),a=n(7720),o=n(9351),s=n(4748);function u(e,t,n){var a=n.clickCount;(0,i.isLabelWithInternallyDisabledControl)(e)||(r.fireEvent.pointerDown(e,t),r.fireEvent.mouseDown(e,(0,i.getMouseEventOptions)("mousedown",t,a)),r.fireEvent.pointerUp(e,t),r.fireEvent.mouseUp(e,(0,i.getMouseEventOptions)("mouseup",t,a)),d(e,(0,i.getMouseEventOptions)("click",t,a)),e.control&&(0,s.focus)(e.control))}function l(e,t,n){var a=n.clickCount;r.fireEvent.pointerDown(e,t),e.disabled||r.fireEvent.mouseDown(e,(0,i.getMouseEventOptions)("mousedown",t,a)),(0,s.focus)(e),r.fireEvent.pointerUp(e,t),e.disabled||(r.fireEvent.mouseUp(e,(0,i.getMouseEventOptions)("mouseup",t,a)),d(e,(0,i.getMouseEventOptions)("click",t,a)))}function c(e,t,n){var a=n.clickCount,u=function(e){var t=e.ownerDocument.activeElement;return t&&t!==e.ownerDocument.body&&t!==e?t:null}(e);if((r.fireEvent.pointerDown(e,t),!(0,i.isDisabled)(e))&&r.fireEvent.mouseDown(e,(0,i.getMouseEventOptions)("mousedown",t,a))){var l=function(e,t){var n=e;do{if(t(n))return n;n=n.parentElement}while(n&&n!==e.ownerDocument.body);return}(e,i.isFocusable);u&&!l?(0,o.blur)(u):l&&(0,s.focus)(l)}if(r.fireEvent.pointerUp(e,t),!(0,i.isDisabled)(e)){r.fireEvent.mouseUp(e,(0,i.getMouseEventOptions)("mouseup",t,a)),d(e,(0,i.getMouseEventOptions)("click",t,a));var c=e.closest("label");null!=c&&c.control&&(0,s.focus)(c.control)}}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHover,o=void 0!==r&&r,s=n.clickCount,h=void 0===s?0:s,d=n.skipPointerEventsCheck,f=void 0!==d&&d;if(!f&&!(0,i.hasPointerEvents)(e))throw new Error('unable to click element as it has or inherits pointer-events set to "none".');o||(0,a.hover)(e,t,{skipPointerEventsCheck:!0}),(0,i.isElementType)(e,"label")?u(e,t,{clickCount:h}):(0,i.isElementType)(e,"input")&&("checkbox"===e.type||"radio"===e.type)?l(e,t,{clickCount:h}):c(e,t,{clickCount:h})}function d(e,t){2===t.button?r.fireEvent.contextMenu(e,t):r.fireEvent.click(e,t)}},4748:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.focus=function(e){if(!(0,r.isFocusable)(e))return;if((0,r.getActiveElement)(e.ownerDocument)===e)return;(0,r.eventWrapper)((function(){return e.focus()}))};var r=n(6395)},7720:function(e,t,n){"use strict";var r=n(4704).default;Object.defineProperty(t,"__esModule",{value:!0}),t.hover=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.skipPointerEventsCheck,u=void 0!==s&&s;if(!u&&!(0,a.hasPointerEvents)(e))throw new Error('unable to hover element as it has or inherits pointer-events set to "none".');if((0,a.isLabelWithInternallyDisabledControl)(e))return;var l=o(e).reverse();i.fireEvent.pointerOver(e,t);var c,h=r(l);try{for(h.s();!(c=h.n()).done;){var d=c.value;i.fireEvent.pointerEnter(d,t)}}catch(m){h.e(m)}finally{h.f()}if(!(0,a.isDisabled)(e)){i.fireEvent.mouseOver(e,(0,a.getMouseEventOptions)("mouseover",t));var f,p=r(l);try{for(p.s();!(f=p.n()).done;){var v=f.value;i.fireEvent.mouseEnter(v,(0,a.getMouseEventOptions)("mouseenter",t))}}catch(m){p.e(m)}finally{p.f()}}i.fireEvent.pointerMove(e,t),(0,a.isDisabled)(e)||i.fireEvent.mouseMove(e,(0,a.getMouseEventOptions)("mousemove",t))},t.unhover=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.skipPointerEventsCheck,u=void 0!==s&&s;if(!u&&!(0,a.hasPointerEvents)(e))throw new Error('unable to unhover element as it has or inherits pointer-events set to "none".');if((0,a.isLabelWithInternallyDisabledControl)(e))return;var l=o(e);i.fireEvent.pointerMove(e,t),(0,a.isDisabled)(e)||i.fireEvent.mouseMove(e,(0,a.getMouseEventOptions)("mousemove",t));i.fireEvent.pointerOut(e,t);var c,h=r(l);try{for(h.s();!(c=h.n()).done;){var d=c.value;i.fireEvent.pointerLeave(d,t)}}catch(m){h.e(m)}finally{h.f()}if(!(0,a.isDisabled)(e)){i.fireEvent.mouseOut(e,(0,a.getMouseEventOptions)("mouseout",t));var f,p=r(l);try{for(p.s();!(f=p.n()).done;){var v=f.value;i.fireEvent.mouseLeave(v,(0,a.getMouseEventOptions)("mouseleave",t))}}catch(m){p.e(m)}finally{p.f()}}};var i=n(6075),a=n(6395);function o(e){for(var t=[e],n=e;null!=(n=n.parentElement);)t.push(n);return t}},2549:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyEventProps=function(e,t){var n,r;return{key:e.key,code:e.code,altKey:t.modifiers.alt,ctrlKey:t.modifiers.ctrl,metaKey:t.modifiers.meta,shiftKey:t.modifiers.shift,keyCode:null!=(n=e.keyCode)?n:1===(null==(r=e.key)?void 0:r.length)?e.key.charCodeAt(0):void 0}},t.getMouseEventProps=function(e){return{altKey:e.modifiers.alt,ctrlKey:e.modifiers.ctrl,metaKey:e.modifiers.meta,shiftKey:e.modifiers.shift}}},8703:function(e,t,n){"use strict";var r,i,a,o=n(2122).default,s=n(8416).default;function u(e,t,n){if(!e)throw new Error(h("key descriptor",t[n],t))}function l(e,t){return e[t]}function c(e,t,n,r){return n?"/"===n:!r&&("{"!==e||!l(i,t.toLowerCase()))}function h(e,t,n){return"Expected ".concat(e,' but found "').concat(null!=t?t:"",'" in "').concat(n,'"\n    See https://github.com/testing-library/user-event/blob/main/README.md#keyboardtext-options\n    for more information about how userEvent parses your input.')}Object.defineProperty(t,"__esModule",{value:!0}),t.getNextKeyDef=function(e,t){var n,i=function(e){var t=0,n=e[t]in r?e[t]:"";t+=n.length;var i=n?e.match(new RegExp("^\\".concat(n,"+")))[0].length:0,a=2===i||"{"===n&&i>3?"":n;return o({type:a},""===a?function(e,t){var n=e[t];return u(n,e,t),{consumedLength:t+=n.length,descriptor:n,releasePrevious:!1,releaseSelf:!0,repeat:1}}(e,t):function(e,t,n){var i,a,o,s="/"===e[t]?"/":"";t+=s.length;var l=null==(i=e.slice(t).match(/^\w+/))?void 0:i[0];u(l,e,t),t+=l.length;var d=null!=(a=null==(o=e.slice(t).match(/^>\d+/))?void 0:o[0])?a:"";t+=d.length;var f="/"===e[t]||!d&&">"===e[t]?e[t]:"";t+=f.length;var p=r[n],v=e[t]===p?p:"";if(!v)throw new Error(h([!d&&"repeat modifier",!f&&"release modifier",'"'.concat(p,'"')].filter(Boolean).join(" or "),e[t],e));return{consumedLength:t+=v.length,descriptor:l,releasePrevious:!!s,repeat:d?Math.max(Number(d.substr(1)),1):1,releaseSelf:c(n,l,f,d)}}(e,t,a))}(e),d=i.type,f=i.descriptor,p=i.consumedLength,v=i.releasePrevious,m=i.releaseSelf,g=i.repeat;return{keyDef:null!=(n=t.keyboardMap.find((function(e){var t;if("["===d)return(null==(t=e.code)?void 0:t.toLowerCase())===f.toLowerCase();if("{"===d){var n,r=function(e){var t;return null!=(t=l(a,e))?t:e}(f);return(null==(n=e.key)?void 0:n.toLowerCase())===r.toLowerCase()}return e.key===f})))?n:s({key:"Unknown",code:"Unknown"},"["===d?"code":"key",f),consumedLength:p,releasePrevious:v,releaseSelf:m,repeat:g}},function(e){e["{"]="}",e["["]="]"}(r||(r={})),function(e){e.alt="alt",e.ctrl="ctrl",e.meta="meta",e.shift="shift"}(i||(i={})),function(e){e.ctrl="Control",e.del="Delete",e.esc="Escape",e.space=" "}(a||(a={}))},6185:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyboard=function(e,t){var n,i=s(e,t),a=i.promise,o=i.state;return(null!=(n=null==t?void 0:t.delay)?n:0)>0?(0,r.getConfig)().asyncWrapper((function(){return a.then((function(){return o}))})):(a.catch(console.error),o)},t.keyboardImplementationWrapper=s,Object.defineProperty(t,"specialCharMap",{enumerable:!0,get:function(){return o.specialCharMap}});var r=n(6075),i=n(5980),a=n(9572),o=n(7777);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.keyboardState,r=void 0===n?{activeElement:null,pressed:[],carryChar:"",modifiers:{alt:!1,caps:!1,ctrl:!1,meta:!1,shift:!1}}:n,o=t.delay,s=void 0===o?0:o,u=t.document,l=void 0===u?document:u,c=t.autoModify,h=void 0!==c&&c,d=t.keyboardMap,f=void 0===d?a.defaultKeyMap:d,p={delay:s,document:l,autoModify:h,keyboardMap:f};return{promise:(0,i.keyboardImplementation)(e,p,r),state:r,releaseAllKeys:function(){return(0,i.releaseAllKeys)(p,r)}}}},9572:function(e,t,n){"use strict";var r=n(861).default;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultKeyMap=void 0;var i=n(1917),a=[].concat(r("0123456789".split("").map((function(e){return{code:"Digit".concat(e),key:e}}))),r(")!@#$%^&*(".split("").map((function(e,t){return{code:"Digit".concat(t),key:e,shiftKey:!0}}))),r("abcdefghijklmnopqrstuvwxyz".split("").map((function(e){return{code:"Key".concat(e.toUpperCase()),key:e}}))),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map((function(e){return{code:"Key".concat(e),key:e,shiftKey:!0}}))),[{code:"Space",key:" "},{code:"AltLeft",key:"Alt",location:i.DOM_KEY_LOCATION.LEFT,keyCode:18},{code:"AltRight",key:"Alt",location:i.DOM_KEY_LOCATION.RIGHT,keyCode:18},{code:"ShiftLeft",key:"Shift",location:i.DOM_KEY_LOCATION.LEFT,keyCode:16},{code:"ShiftRight",key:"Shift",location:i.DOM_KEY_LOCATION.RIGHT,keyCode:16},{code:"ControlLeft",key:"Control",location:i.DOM_KEY_LOCATION.LEFT,keyCode:17},{code:"ControlRight",key:"Control",location:i.DOM_KEY_LOCATION.RIGHT,keyCode:17},{code:"MetaLeft",key:"Meta",location:i.DOM_KEY_LOCATION.LEFT,keyCode:93},{code:"MetaRight",key:"Meta",location:i.DOM_KEY_LOCATION.RIGHT,keyCode:93},{code:"OSLeft",key:"OS",location:i.DOM_KEY_LOCATION.LEFT,keyCode:91},{code:"OSRight",key:"OS",location:i.DOM_KEY_LOCATION.RIGHT,keyCode:91},{code:"CapsLock",key:"CapsLock",keyCode:20},{code:"Backspace",key:"Backspace",keyCode:8},{code:"Enter",key:"Enter",keyCode:13},{code:"Escape",key:"Escape",keyCode:27},{code:"ArrowUp",key:"ArrowUp",keyCode:38},{code:"ArrowDown",key:"ArrowDown",keyCode:40},{code:"ArrowLeft",key:"ArrowLeft",keyCode:37},{code:"ArrowRight",key:"ArrowRight",keyCode:39},{code:"Home",key:"Home",keyCode:36},{code:"End",key:"End",keyCode:35},{code:"Delete",key:"Delete",keyCode:46},{code:"PageUp",key:"PageUp",keyCode:33},{code:"PageDown",key:"PageDown",keyCode:34}]);t.defaultKeyMap=a},5980:function(e,t,n){"use strict";var r=n(7061).default,i=n(4704).default,a=n(7156).default;Object.defineProperty(t,"__esModule",{value:!0}),t.keyboardImplementation=d,t.releaseAllKeys=function(e,t){var n,r=function(){return p(e.document)},a=i(t.pressed);try{for(a.s();!(n=a.n()).done;){var o=n.value;g(o.keyDef,r,e,t,o.unpreventedDefault)}}catch(s){a.e(s)}finally{a.f()}};var o=n(6075),s=n(6395),u=n(8703),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(5031)),c=n(2549);function h(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function d(e,t,n){return f.apply(this,arguments)}function f(){return(f=a(r().mark((function e(t,n,i){var a,o,c,h,f,b,x,w,k,S,M;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.document,c=function(){return p(o)},h=null!=(a=i.repeatKey)?a:(0,u.getNextKeyDef)(t,n),f=h.keyDef,b=h.consumedLength,x=h.releasePrevious,w=h.releaseSelf,k=h.repeat,_(l.replaceBehavior,f,c(),n,i)||((S=i.pressed.find((function(e){return e.keyDef===f})))&&!i.repeatKey&&g(f,c,n,i,S.unpreventedDefault),x||((M=v(f,c,n,i))&&y(f,i)&&m(f,c,n,i),w&&k<=1&&g(f,c,n,i,M))),k>1?i.repeatKey={consumedLength:0,keyDef:f,releasePrevious:x,releaseSelf:w,repeat:k-1}:delete i.repeatKey,!(t.length>b||k>1)){e.next=11;break}if(!(n.delay>0)){e.next=10;break}return e.next=10,(0,s.wait)(n.delay);case 10:return e.abrupt("return",d(t.slice(b),n,i));case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){var t;return null!=(t=(0,s.getActiveElement)(e))?t:e.body}function v(e,t,n,r){var i=t();i!==r.activeElement&&(r.carryValue=void 0,r.carryChar=""),r.activeElement=i,_(l.preKeydownBehavior,e,i,n,r);var a=o.fireEvent.keyDown(i,(0,c.getKeyEventProps)(e,r));return r.pressed.push({keyDef:e,unpreventedDefault:a}),a&&_(l.keydownBehavior,e,t(),n,r),a}function m(e,t,n,r){var i=t();o.fireEvent.keyPress(i,(0,c.getKeyEventProps)(e,r))&&_(l.keypressBehavior,e,t(),n,r)}function g(e,t,n,r,i){var a=t();_(l.preKeyupBehavior,e,a,n,r);var s=o.fireEvent.keyUp(a,(0,c.getKeyEventProps)(e,r));i&&s&&_(l.keyupBehavior,e,t(),n,r),r.pressed=r.pressed.filter((function(t){return t.keyDef!==e})),_(l.postKeyupBehavior,e,a,n,r)}function _(e,t,n,r,i){var a=e.find((function(e){return e.matches(t,n,r,i)}));return a&&a.handle(t,n,r,i),!!a}function y(e,t){var n;return(1===(null==(n=e.key)?void 0:n.length)||"Enter"===e.key)&&!t.modifiers.ctrl&&!t.modifiers.alt}},8148:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keydownBehavior=void 0;var r=n(6395),i=[{matches:function(e,t){return("ArrowLeft"===e.key||"ArrowRight"===e.key)&&(0,r.isElementType)(t,["input","textarea"])},handle:function(e,t){var n,i=(0,r.getSelectionRange)(t),a=i.selectionStart,o=i.selectionEnd,s="ArrowLeft"===e.key?-1:1,u=null!=(n=a===o?(null!=a?a:0)+s:s<0?a:o)?n:0;(0,r.setSelectionRange)(t,u,u)}}];t.keydownBehavior=i},4672:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keypressBehavior=void 0;var r=n(6075),i=n(1093),a=n(6395),o=[{matches:function(e,t){var n;return 1===(null==(n=e.key)?void 0:n.length)&&(0,a.isElementType)(t,"input",{type:"time",readOnly:!1})},handle:function(e,t,n,r){var o,s=e.key,u=(null!=(o=r.carryValue)?o:"")+s,l=(0,a.buildTimeValue)(u);(0,a.isValidInputTimeValue)(t,l)&&(s=l);var c=(0,a.calculateNewValue)(s,t),h=c.newValue,d=c.newSelectionStart,f=(0,a.getValue)(t);f!==h&&(0,i.fireInputEvent)(t,{newValue:h,newSelectionStart:d,eventOverrides:{data:e.key,inputType:"insertText"}}),(0,i.fireChangeForInputTimeIfValid)(t,f,l),r.carryValue=u}},{matches:function(e,t){var n;return 1===(null==(n=e.key)?void 0:n.length)&&(0,a.isElementType)(t,"input",{type:"date",readOnly:!1})},handle:function(e,t,n,o){var s,u=e.key,l=(null!=(s=o.carryValue)?s:"")+u,c=(0,a.isValidDateValue)(t,l);c&&(u=l);var h=(0,a.calculateNewValue)(u,t),d=h.newValue,f=h.newSelectionStart;(0,a.getValue)(t)!==d&&(0,i.fireInputEvent)(t,{newValue:d,newSelectionStart:f,eventOverrides:{data:e.key,inputType:"insertText"}}),c&&r.fireEvent.change(t,{target:{value:l}}),o.carryValue=l}},{matches:function(e,t){var n;return 1===(null==(n=e.key)?void 0:n.length)&&(0,a.isElementType)(t,"input",{type:"number",readOnly:!1})},handle:function(e,t,n,r){var o,s,u,l;if(/[\d.\-e]/.test(e.key)){var c=null!=(o=null!=(s=r.carryValue)?s:(0,a.getValue)(t))?o:"",h=(0,a.calculateNewValue)(e.key,t,c),d=h.newValue,f=h.newSelectionStart,p=d.split("e",2);if(!(Number(null==(u=d.match(/-/g))?void 0:u.length)>2||Number(null==(l=d.match(/\./g))?void 0:l.length)>1||p[1]&&!/^-?\d*$/.test(p[1]))){(0,i.fireInputEvent)(t,{newValue:d,newSelectionStart:f,eventOverrides:{data:e.key,inputType:"insertText"}});var v=(0,a.getValue)(t);r.carryValue=v===d?void 0:d}}}},{matches:function(e,t){var n;return 1===(null==(n=e.key)?void 0:n.length)&&((0,a.isElementType)(t,["input","textarea"],{readOnly:!1})&&!(0,a.isClickableInput)(t)||(0,a.isContentEditable)(t))&&0!==(0,a.getSpaceUntilMaxLength)(t)},handle:function(e,t){var n=(0,a.calculateNewValue)(e.key,t),r=n.newValue,o=n.newSelectionStart;(0,i.fireInputEvent)(t,{newValue:r,newSelectionStart:o,eventOverrides:{data:e.key,inputType:"insertText"}})}},{matches:function(e,t){return"Enter"===e.key&&((0,a.isElementType)(t,"textarea",{readOnly:!1})||(0,a.isContentEditable)(t))&&0!==(0,a.getSpaceUntilMaxLength)(t)},handle:function(e,t,n,r){var o=(0,a.calculateNewValue)("\n",t),s=o.newValue,u=o.newSelectionStart,l=(0,a.isContentEditable)(t)&&!r.modifiers.shift?"insertParagraph":"insertLineBreak";(0,i.fireInputEvent)(t,{newValue:s,newSelectionStart:u,eventOverrides:{inputType:l}})}}];t.keypressBehavior=o},8720:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keydownBehavior=void 0;var r=n(6395),i=n(1093),a=[{matches:function(e,t){return("Home"===e.key||"End"===e.key)&&((0,r.isElementType)(t,["input","textarea"])||(0,r.isContentEditable)(t))},handle:function(e,t){if("Home"===e.key)(0,r.setSelectionRange)(t,0,0);else{var n,i,a=null!=(n=null==(i=(0,r.getValue)(t))?void 0:i.length)?n:0;(0,r.setSelectionRange)(t,a,a)}}},{matches:function(e,t){return("PageUp"===e.key||"PageDown"===e.key)&&(0,r.isElementType)(t,["input"])},handle:function(e,t){if("PageUp"===e.key)(0,r.setSelectionRange)(t,0,0);else{var n,i,a=null!=(n=null==(i=(0,r.getValue)(t))?void 0:i.length)?n:0;(0,r.setSelectionRange)(t,a,a)}}},{matches:function(e,t){return"Delete"===e.key&&(0,r.isEditable)(t)&&!(0,r.isCursorAtEnd)(t)},handle:function(e,t,n,a){var o=(0,r.calculateNewValue)("",t,a.carryValue,void 0,"forward"),s=o.newValue,u=o.newSelectionStart;(0,i.fireInputEvent)(t,{newValue:s,newSelectionStart:u,eventOverrides:{inputType:"deleteContentForward"}}),(0,i.carryValue)(t,a,s)}}];t.keydownBehavior=a},9904:function(e,t,n){"use strict";var r=n(7424).default,i=n(861).default;Object.defineProperty(t,"__esModule",{value:!0}),t.preKeyupBehavior=t.preKeydownBehavior=t.postKeyupBehavior=t.keyupBehavior=t.keypressBehavior=t.keydownBehavior=void 0;var a=n(6075),o=n(6395),s=n(2549),u=n(1093),l={Alt:"alt",Control:"ctrl",Shift:"shift",Meta:"meta"},c=[].concat(i(Object.entries(l).map((function(e){var t=r(e,2),n=t[0],i=t[1];return{matches:function(e){return e.key===n},handle:function(e,t,n,r){r.modifiers[i]=!0}}}))),[{matches:function(e){return"AltGraph"===e.key},handle:function(e,t,n,r){var i,o=null!=(i=n.keyboardMap.find((function(e){return"Control"===e.key})))?i:{key:"Control",code:"Control"};a.fireEvent.keyDown(t,(0,s.getKeyEventProps)(o,r))}}]);t.preKeydownBehavior=c;var h=[{matches:function(e){return"CapsLock"===e.key},handle:function(e,t,n,r){r.modifiers.caps=!r.modifiers.caps}},{matches:function(e,t){return"Backspace"===e.key&&(0,o.isEditable)(t)&&!(0,o.isCursorAtStart)(t)},handle:function(e,t,n,r){var i=(0,o.calculateNewValue)("",t,r.carryValue,void 0,"backward"),a=i.newValue,s=i.newSelectionStart;(0,u.fireInputEvent)(t,{newValue:a,newSelectionStart:s,eventOverrides:{inputType:"deleteContentBackward"}}),(0,u.carryValue)(t,r,a)}}];t.keydownBehavior=h;var d=[{matches:function(e,t){return"Enter"===e.key&&(0,o.isElementType)(t,"input")&&["checkbox","radio"].includes(t.type)},handle:function(e,t){var n=t.form;(0,o.hasFormSubmit)(n)&&a.fireEvent.submit(n)}},{matches:function(e,t){return"Enter"===e.key&&((0,o.isClickableInput)(t)||(0,o.isElementType)(t,"a")&&Boolean(t.href))},handle:function(e,t,n,r){a.fireEvent.click(t,(0,s.getMouseEventProps)(r))}},{matches:function(e,t){return"Enter"===e.key&&(0,o.isElementType)(t,"input")},handle:function(e,t){var n=t.form;n&&(1===n.querySelectorAll("input").length||(0,o.hasFormSubmit)(n))&&a.fireEvent.submit(n)}}];t.keypressBehavior=d;var f=i(Object.entries(l).map((function(e){var t=r(e,2),n=t[0],i=t[1];return{matches:function(e){return e.key===n},handle:function(e,t,n,r){r.modifiers[i]=!1}}})));t.preKeyupBehavior=f;var p=[{matches:function(e,t){return" "===e.key&&(0,o.isClickableInput)(t)},handle:function(e,t,n,r){a.fireEvent.click(t,(0,s.getMouseEventProps)(r))}}];t.keyupBehavior=p;var v=[{matches:function(e){return"AltGraph"===e.key},handle:function(e,t,n,r){var i,o=null!=(i=n.keyboardMap.find((function(e){return"Control"===e.key})))?i:{key:"Control",code:"Control"};a.fireEvent.keyUp(t,(0,s.getKeyEventProps)(o,r))}}];t.postKeyupBehavior=v},5031:function(e,t,n){"use strict";var r=n(861).default;Object.defineProperty(t,"__esModule",{value:!0}),t.replaceBehavior=t.preKeyupBehavior=t.preKeydownBehavior=t.postKeyupBehavior=t.keyupBehavior=t.keypressBehavior=t.keydownBehavior=void 0;var i=n(6395),a=c(n(8148)),o=c(n(8720)),s=c(n(4672)),u=c(n(9904));function l(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}var h=[{matches:function(e,t){return"selectall"===e.key&&(0,i.isElementType)(t,["input","textarea"])},handle:function(e,t,n,r){var a;(0,i.setSelectionRange)(t,0,(null!=(a=r.carryValue)?a:t.value).length)}}];t.replaceBehavior=h;var d=r(u.preKeydownBehavior);t.preKeydownBehavior=d;var f=[].concat(r(a.keydownBehavior),r(o.keydownBehavior),r(u.keydownBehavior));t.keydownBehavior=f;var p=[].concat(r(u.keypressBehavior),r(s.keypressBehavior));t.keypressBehavior=p;var v=r(u.preKeyupBehavior);t.preKeyupBehavior=v;var m=r(u.keyupBehavior);t.keyupBehavior=m;var g=r(u.postKeyupBehavior);t.postKeyupBehavior=g},3368:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.carryValue=function(e,t,n){var i=(0,r.getValue)(e);t.carryValue=i!==n&&""===i&&(0,r.hasUnreliableEmptyValue)(e)?n:void 0};var r=n(6395)},2782:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fireChangeForInputTimeIfValid=function(e,t,n){(0,i.isValidInputTimeValue)(e,n)&&t!==n&&r.fireEvent.change(e,{target:{value:n}})};var r=n(6075),i=n(6395)},8979:function(e,t,n){"use strict";var r=n(2122).default;Object.defineProperty(t,"__esModule",{value:!0}),t.fireInputEvent=function(e,t){var n=t.newValue,o=t.newSelectionStart,s=t.eventOverrides;if((0,a.isContentEditable)(e))u(e,"textContent",n);else{if(!(0,a.isElementType)(e,["input","textarea"]))throw new Error("Invalid Element");u(e,"value",n)}(function(e,t){(0,a.setSelectionRange)(e,t,t)})(e,o),i.fireEvent.input(e,r({},s)),function(e,t,n){var r=(0,a.getValue)(e);if((""!==r||!(0,a.hasUnreliableEmptyValue)(e))&&r===t){(0,a.getSelectionRange)(e).selectionStart===r.length&&(0,a.setSelectionRange)(e,n,n)}}(e,n,o)};var i=n(6075),a=n(6395);var o=Symbol("initial input value/textContent"),s=Symbol("onBlur");function u(e,t,n){var r,a=Object.getOwnPropertyDescriptor(e,t),u=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);(a&&u&&Object.defineProperty(e,t,u),void 0===e[o]&&(e[o]=String(e[t])),e[t]=n,e[s])||(null==(r=e.ownerDocument.defaultView)||r.addEventListener("blur",e[s]=function(){var n=e[o];delete e[s],delete e[o],String(e[t])!==n&&i.fireEvent.change(e)},{capture:!0,once:!0}));a&&Object.defineProperty(e,t,a)}},1093:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3368);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n(2782);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=n(8979);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},7777:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.specialCharMap=void 0;t.specialCharMap={arrowLeft:"{arrowleft}",arrowRight:"{arrowright}",arrowDown:"{arrowdown}",arrowUp:"{arrowup}",enter:"{enter}",escape:"{esc}",delete:"{del}",backspace:"{backspace}",home:"{home}",end:"{end}",selectAll:"{selectall}",space:"{space}",whitespace:" ",pageUp:"{pageUp}",pageDown:"{pageDown}"}},1917:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.DOM_KEY_LOCATION=void 0,t.DOM_KEY_LOCATION=n,function(e){e[e.STANDARD=0]="STANDARD",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.NUMPAD=3]="NUMPAD"}(n||(t.DOM_KEY_LOCATION=n={}))},5803:function(e,t,n){"use strict";var r=n(2122).default,i=n(215).default,a=["delay"];var o=n(6075),s=n(498)},498:function(e,t,n){"use strict";var r=n(7061).default,i=n(7156).default;Object.defineProperty(t,"__esModule",{value:!0}),t.typeImplementation=function(e,t,n){return u.apply(this,arguments)};var a=n(6395),o=n(6354),s=n(6185);function u(){return(u=i(r().mark((function e(t,n,i){var u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=i.delay,l=i.skipClick,c=void 0!==l&&l,h=i.skipAutoClose,d=void 0!==h&&h,f=i.initialSelectionStart,p=void 0===f?void 0:f,v=i.initialSelectionEnd,m=void 0===v?void 0:v,!t.disabled){e.next=3;break}return e.abrupt("return");case 3:if(c||(0,o.click)(t),g=function(){return(0,a.getActiveElement)(t.ownerDocument)},_=(0,a.getValue)(g()),y=(0,a.getSelectionRange)(t),b=y.selectionStart,x=y.selectionEnd,null==_||null!==b&&0!==b||null!==x&&0!==x||(0,a.setSelectionRange)(g(),null!=p?p:_.length,null!=m?m:_.length),w=(0,s.keyboardImplementationWrapper)(n,{delay:u,document:t.ownerDocument}),k=w.promise,S=w.releaseAllKeys,!(u>0)){e.next=12;break}return e.next=12,k;case 12:return d||S(),e.abrupt("return",k);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},4062:function(e,t,n){"use strict";var r=n(2122).default,i=n(7424).default;function a(e){return"mousedown"===e||"mouseup"===e||"click"===e||"dblclick"===e}Object.defineProperty(t,"__esModule",{value:!0}),t.getMouseEventOptions=function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t=null!=(n=t)?n:{},r(r({},t),{},{detail:"mousedown"===e||"mouseup"===e||"click"===e?1+i:i,buttons:l(e,t,"buttons"),button:l(e,t,"button")})};var o={none:0,primary:1,secondary:2,auxiliary:4},s={primary:0,auxiliary:1,secondary:2};function u(e,t){var n,r=i("button"===t?[s,o]:[o,s],2),a=r[0],u=r[1],l=null==(n=Object.entries(a).find((function(t){return i(t,2)[1]===e})))?void 0:n[0];return l&&Object.prototype.hasOwnProperty.call(u,l)?u[l]:0}function l(e,t,n){return a(e)?"number"===typeof t[n]?t[n]:"button"===n&&"number"===typeof t.buttons?u(t.buttons,"buttons"):"buttons"===n&&"number"===typeof t.button?u(t.button,"button"):"button"!=n&&a(e)?1:0:0}},682:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isClickableInput=function(e){return(0,r.isElementType)(e,"button")||(0,r.isElementType)(e,"input")&&i.includes(e.type)};var r=n(1786),i=["button","color","file","image","reset","submit","checkbox","radio"]},1603:function(e,t){"use strict";function n(e,t){var n=e.slice(0,t),r=Math.min(parseInt(n,10),23),i=e.slice(t),a=parseInt(i,10),o=Math.min(a,59);return"".concat(r.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0"))}Object.defineProperty(t,"__esModule",{value:!0}),t.buildTimeValue=function(e){var t=e.replace(/\D/g,"");if(t.length<2)return e;var r=parseInt(t[0],10),i=parseInt(t[1],10);if(r>=3||2===r&&i>=4){return n(t,r>=3?1:2)}if(2===e.length)return e;return n(t,2)}},344:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateNewValue=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){var e;return null!=(e=(0,i.getValue)(t))?e:""}(),s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,r.getSelectionRange)(t),u=arguments.length>4?arguments[4]:void 0,l=null===s.selectionStart?n.length:s.selectionStart,c=null===s.selectionEnd?n.length:s.selectionEnd,h=Math.max(0,l===c&&"backward"===u?l-1:l),d=n.substring(0,h),f=Math.min(n.length,l===c&&"forward"===u?c+1:c),p=n.substring(f,n.length),v="".concat(d).concat(e).concat(p),m=h+e.length;"date"!==t.type||(0,a.isValidDateValue)(t,v)||(v=n);"time"!==t.type||(0,o.isValidInputTimeValue)(t,v)||(v=(0,o.isValidInputTimeValue)(t,e)?e:n);return{newValue:v,newSelectionStart:m}};var r=n(4909),i=n(1513),a=n(816),o=n(7267)},1145:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCursorAtEnd=function(e){var t,n=(0,r.getSelectionRange)(e),a=n.selectionStart,o=n.selectionEnd;return a===o&&(null!=a?a:0)===(null!=(t=(0,i.getValue)(e))?t:"").length},t.isCursorAtStart=function(e){var t=(0,r.getSelectionRange)(e),n=t.selectionStart,i=t.selectionEnd;return n===i&&0===(null!=n?n:0)};var r=n(4909),i=n(1513)},1513:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValue=function(e){if(!e)return null;if((0,r.isContentEditable)(e))return e.textContent;return e.value};var r=n(5641)},1275:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasUnreliableEmptyValue=function(e){return(0,i.isElementType)(e,"input")&&Boolean(r[e.type])};var r,i=n(1786);!function(e){e.number="number"}(r||(r={}))},5641:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isContentEditable=function(e){return e.hasAttribute("contenteditable")&&("true"==e.getAttribute("contenteditable")||""==e.getAttribute("contenteditable"))}},1654:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editableInputTypes=void 0,t.isEditable=function(e){return o(e)||(0,i.isElementType)(e,"textarea",{readOnly:!1})||(0,a.isContentEditable)(e)},t.isEditableInput=o;var r,i=n(1786),a=n(5641);function o(e){return(0,i.isElementType)(e,"input",{readOnly:!1})&&Boolean(r[e.type])}t.editableInputTypes=r,function(e){e.text="text",e.date="date",e["datetime-local"]="datetime-local",e.email="email",e.month="month",e.number="number",e.password="password",e.search="search",e.tel="tel",e.time="time",e.url="url",e.week="week"}(r||(t.editableInputTypes=r={}))},816:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidDateValue=function(e,t){var n=e.cloneNode();return n.value=t,n.value===t}},7267:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidInputTimeValue=function(e,t){var n=e.cloneNode();return n.value=t,n.value===t}},4929:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpaceUntilMaxLength=function(e){var t=(0,a.getValue)(e);if(null===t)return;var n=function(e){var t;if(!function(e){return(0,i.isElementType)(e,"textarea")||(0,i.isElementType)(e,"input")&&Boolean(r[e.type])}(e))return;var n=null!=(t=e.getAttribute("maxlength"))?t:"";return/^\d+$/.test(n)&&Number(n)>=0?Number(n):void 0}(e);return n?n-t.length:void 0};var r,i=n(1786),a=n(1513);!function(e){e.email="email",e.password="password",e.search="search",e.telephone="telephone",e.text="text",e.url="url"}(r||(r={}))},4909:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectionRange=s,t.hasSelectionSupport=o,t.setSelectionRange=function(e,t,n){var r=s(e),u=r.selectionStart,l=r.selectionEnd;if(u===t&&l===n)return;o(e)&&e.setSelectionRange(t,n);(0,i.isElementType)(e,"input")&&(e[a]={selectionStart:t,selectionEnd:n});if((0,i.isElementType)(e,"input")||(0,i.isElementType)(e,"textarea"))return;var c=e.ownerDocument.createRange();c.selectNodeContents(e),e.firstChild&&(c.setStart(e.firstChild,t),c.setEnd(e.firstChild,n));var h=e.ownerDocument.getSelection();h&&(h.removeAllRanges(),h.addRange(c))};var r,i=n(1786);!function(e){e.text="text",e.search="search",e.url="url",e.tel="tel",e.password="password"}(r||(r={}));var a=Symbol("inputSelection");function o(e){return(0,i.isElementType)(e,"textarea")||(0,i.isElementType)(e,"input")&&Boolean(r[e.type])}function s(e){if(o(e))return{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd};var t;if((0,i.isElementType)(e,"input"))return null!=(t=e[a])?t:{selectionStart:null,selectionEnd:null};var n=e.ownerDocument.getSelection();if(null!=n&&n.rangeCount&&e.contains(n.focusNode)){var r=n.getRangeAt(0);return{selectionStart:r.startOffset,selectionEnd:r.endOffset}}return{selectionStart:null,selectionEnd:null}}},3113:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getActiveElement=function e(t){var n=t.activeElement;return null!=n&&n.shadowRoot?e(n.shadowRoot):(0,r.isDisabled)(n)?t.ownerDocument?t.ownerDocument.body:t.body:n};var r=n(9649)},9863:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFocusable=function(e){return!(0,r.isLabelWithInternallyDisabledControl)(e)&&e.matches(i.FOCUSABLE_SELECTOR)};var r=n(299),i=n(6821)},6821:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FOCUSABLE_SELECTOR=void 0;var n=["input:not([type=hidden]):not([disabled])","button:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[contenteditable=""]','[contenteditable="true"]',"a[href]","[tabindex]:not([disabled])"].join(", ");t.FOCUSABLE_SELECTOR=n},6395:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4062);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n(682);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=n(1603);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var o=n(344);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var s=n(1145);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var u=n(1513);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var l=n(1275);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(5641);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var h=n(1654);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var d=n(816);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var f=n(7267);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var p=n(4929);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var v=n(4909);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var m=n(3113);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(9863);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var _=n(6821);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var y=n(3059);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var b=n(1786);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var x=n(299);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var w=n(9239);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var k=n(9649);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var S=n(5153);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var M=n(5140);Object.keys(M).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===M[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return M[e]}}))}));var C=n(5969);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var T=n(1606);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}))},3059:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventWrapper=function(e){var t;return(0,r.getConfig)().eventWrapper((function(){t=e()})),t};var r=n(6075)},1606:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasFormSubmit=void 0;t.hasFormSubmit=function(e){return!(!e||!e.querySelector('input[type="submit"]')&&!e.querySelector('button[type="submit"]'))}},5969:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasPointerEvents=function(e){for(var t=(0,r.getWindowFromNode)(e),n=e;null!=(i=n)&&i.ownerDocument;n=n.parentElement){var i,a=t.getComputedStyle(n).pointerEvents;if(a&&!["inherit","unset"].includes(a))return"none"!==a}return!0};var r=n(3980)},9649:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDisabled=function(e){return Boolean(e&&e.disabled)}},5153:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDocument=function(e){return e.nodeType===e.DOCUMENT_NODE}},1786:function(e,t,n){"use strict";var r=n(7424).default;Object.defineProperty(t,"__esModule",{value:!0}),t.isElementType=function(e,t,n){if(e.namespaceURI&&"http://www.w3.org/1999/xhtml"!==e.namespaceURI)return!1;if(!(t=Array.isArray(t)?t:[t]).includes(e.tagName.toLowerCase()))return!1;if(n)return Object.entries(n).every((function(t){var n=r(t,2),i=n[0],a=n[1];return e[i]===a}));return!0}},299:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLabelWithInternallyDisabledControl=function(e){if(!(0,i.isElementType)(e,"label"))return!1;var t=e.control;return Boolean(t&&e.contains(t)&&(0,r.isDisabled)(t))};var r=n(9649),i=n(1786)},9239:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVisible=function(e){for(var t=(0,r.getWindowFromNode)(e),n=e;null!=(i=n)&&i.ownerDocument;n=n.parentElement){var i;if("none"===t.getComputedStyle(n).display)return!1}return!0};var r=n(3980)},5140:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wait=function(e){return new Promise((function(t){return setTimeout((function(){return t()}),e)}))}},5442:function(e){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onlyFirst,n=void 0!==t&&t,r=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(r,n?void 0:"g")}},8559:function(e,t){!function(e){"use strict";var t="1.8.0";function n(e){var t,n,r,i;for(n=1,r=arguments.length;n<r;n++)for(t in i=arguments[n])e[t]=i[t];return e}var r=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function i(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var r=n.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(n.call(arguments)):arguments)}}var a=0;function o(e){return"_leaflet_id"in e||(e._leaflet_id=++a),e._leaflet_id}function s(e,t,n){var r,i,a,o;return o=function(){r=!1,i&&(a.apply(n,i),i=!1)},a=function(){r?i=arguments:(e.apply(n,arguments),setTimeout(o,t),r=!0)},a}function u(e,t,n){var r=t[1],i=t[0],a=r-i;return e===r&&n?e:((e-i)%a+a)%a+i}function l(){return!1}function c(e,t){if(!1===t)return e;var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function h(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function d(e){return h(e).split(/\s+/)}function f(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?r(e.options):{}),t)e.options[n]=t[n];return e.options}function p(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function m(e,t){return e.replace(v,(function(e,n){var r=t[n];if(void 0===r)throw new Error("No value provided for variable "+e);return"function"===typeof r&&(r=r(t)),r}))}var g=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function _(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var x=0;function w(e){var t=+new Date,n=Math.max(0,16-(t-x));return x=t+n,window.setTimeout(e,n)}var k=window.requestAnimationFrame||b("RequestAnimationFrame")||w,S=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function M(e,t,n){if(!n||k!==w)return k.call(window,i(e,t));e.call(t)}function C(e){e&&S.call(window,e)}var T={__proto__:null,extend:n,create:r,bind:i,get lastId(){return a},stamp:o,throttle:s,wrapNum:u,falseFn:l,formatNum:c,trim:h,splitWords:d,setOptions:f,getParamString:p,template:m,isArray:g,indexOf:_,emptyImageUrl:y,requestFn:k,cancelFn:S,requestAnimFrame:M,cancelAnimFrame:C};function E(){}function P(e){if("undefined"!==typeof L&&L&&L.Mixin){e=g(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}E.extend=function(e){var t=function(){f(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=t.__super__=this.prototype,a=r(i);for(var o in a.constructor=t,t.prototype=a,this)Object.prototype.hasOwnProperty.call(this,o)&&"prototype"!==o&&"__super__"!==o&&(t[o]=this[o]);return e.statics&&n(t,e.statics),e.includes&&(P(e.includes),n.apply(null,[a].concat(e.includes))),n(a,e),delete a.statics,delete a.includes,a.options&&(a.options=i.options?r(i.options):{},n(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=a._initHooks.length;e<t;e++)a._initHooks[e].call(this)}},t},E.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},E.mergeOptions=function(e){return n(this.prototype.options,e),this},E.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var A={on:function(e,t,n){if("object"===typeof e)for(var r in e)this._on(r,e[r],t);else for(var i=0,a=(e=d(e)).length;i<a;i++)this._on(e[i],t,n);return this},off:function(e,t,n){if(arguments.length)if("object"===typeof e)for(var r in e)this._off(r,e[r],t);else{e=d(e);for(var i=1===arguments.length,a=0,o=e.length;a<o;a++)i?this._off(e[a]):this._off(e[a],t,n)}else delete this._events;return this},_on:function(e,t,n){if("function"===typeof t){this._events=this._events||{};var r=this._events[e];r||(r=[],this._events[e]=r),n===this&&(n=void 0);for(var i={fn:t,ctx:n},a=r,o=0,s=a.length;o<s;o++)if(a[o].fn===t&&a[o].ctx===n)return;a.push(i)}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,n){var r,i,a;if(this._events&&(r=this._events[e]))if(1!==arguments.length)if(n===this&&(n=void 0),"function"===typeof t){for(i=0,a=r.length;i<a;i++){var o=r[i];if(o.ctx===n&&o.fn===t)return this._firingCount&&(o.fn=l,this._events[e]=r=r.slice()),void r.splice(i,1)}console.warn("listener not found")}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(i=0,a=r.length;i<a;i++)r[i].fn=l;delete this._events[e]}},fire:function(e,t,r){if(!this.listens(e,r))return this;var i=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var a=this._events[e];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var u=a[o];u.fn.call(u.ctx||this,i)}this._firingCount--}}return r&&this._propagateEvent(i),this},listens:function(e,t){"string"!==typeof e&&console.warn('"string" type argument expected');var n=this._events&&this._events[e];if(n&&n.length)return!0;if(t)for(var r in this._eventParents)if(this._eventParents[r].listens(e,t))return!0;return!1},once:function(e,t,n){if("object"===typeof e){for(var r in e)this.once(r,e[r],t);return this}var a=i((function(){this.off(e,t,n).off(e,a,n)}),this);return this.on(e,t,n).on(e,a,n)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[o(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[o(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};A.addEventListener=A.on,A.removeEventListener=A.clearAllEventListeners=A.off,A.addOneTimeEventListener=A.once,A.fireEvent=A.fire,A.hasEventListeners=A.listens;var I=E.extend(A);function R(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var O=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function N(e,t,n){return e instanceof R?e:g(e)?new R(e[0],e[1]):void 0===e||null===e?e:"object"===typeof e&&"x"in e&&"y"in e?new R(e.x,e.y):new R(e,t,n)}function D(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}function z(e,t){return!e||e instanceof D?e:new D(e,t)}function j(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}function B(e,t){return e instanceof j?e:new j(e,t)}function F(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function $(e,t,n){return e instanceof F?e:g(e)&&"object"!==typeof e[0]?3===e.length?new F(e[0],e[1],e[2]):2===e.length?new F(e[0],e[1]):null:void 0===e||null===e?e:"object"===typeof e&&"lat"in e?new F(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new F(e,t,n)}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(e){return this.clone()._add(N(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(N(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new R(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new R(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=O(this.x),this.y=O(this.y),this},distanceTo:function(e){var t=(e=N(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=N(e)).x===this.x&&e.y===this.y},contains:function(e){return e=N(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+c(this.x)+", "+c(this.y)+")"}},D.prototype={extend:function(e){return e=N(e),this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},getCenter:function(e){return new R((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new R(this.min.x,this.max.y)},getTopRight:function(){return new R(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"===typeof e[0]||e instanceof R?N(e):z(e))instanceof D?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=z(e);var t=this.min,n=this.max,r=e.min,i=e.max,a=i.x>=t.x&&r.x<=n.x,o=i.y>=t.y&&r.y<=n.y;return a&&o},overlaps:function(e){e=z(e);var t=this.min,n=this.max,r=e.min,i=e.max,a=i.x>t.x&&r.x<n.x,o=i.y>t.y&&r.y<n.y;return a&&o},isValid:function(){return!(!this.min||!this.max)}},j.prototype={extend:function(e){var t,n,r=this._southWest,i=this._northEast;if(e instanceof F)t=e,n=e;else{if(!(e instanceof j))return e?this.extend($(e)||B(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return r||i?(r.lat=Math.min(t.lat,r.lat),r.lng=Math.min(t.lng,r.lng),i.lat=Math.max(n.lat,i.lat),i.lng=Math.max(n.lng,i.lng)):(this._southWest=new F(t.lat,t.lng),this._northEast=new F(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,r=Math.abs(t.lat-n.lat)*e,i=Math.abs(t.lng-n.lng)*e;return new j(new F(t.lat-r,t.lng-i),new F(n.lat+r,n.lng+i))},getCenter:function(){return new F((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new F(this.getNorth(),this.getWest())},getSouthEast:function(){return new F(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"===typeof e[0]||e instanceof F||"lat"in e?$(e):B(e);var t,n,r=this._southWest,i=this._northEast;return e instanceof j?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=r.lat&&n.lat<=i.lat&&t.lng>=r.lng&&n.lng<=i.lng},intersects:function(e){e=B(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),a=i.lat>=t.lat&&r.lat<=n.lat,o=i.lng>=t.lng&&r.lng<=n.lng;return a&&o},overlaps:function(e){e=B(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),a=i.lat>t.lat&&r.lat<n.lat,o=i.lng>t.lng&&r.lng<n.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=B(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},F.prototype={equals:function(e,t){return!!e&&(e=$(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+c(this.lat,e)+", "+c(this.lng,e)+")"},distanceTo:function(e){return U.distance(this,$(e))},wrap:function(){return U.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return B([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new F(this.lat,this.lng,this.alt)}};var q={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new D(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?u(e.lng,this.wrapLng,!0):e.lng;return new F(this.wrapLat?u(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),r=t.lat-n.lat,i=t.lng-n.lng;if(0===r&&0===i)return e;var a=e.getSouthWest(),o=e.getNorthEast();return new j(new F(a.lat-r,a.lng-i),new F(o.lat-r,o.lng-i))}},U=n({},q,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,r=e.lat*n,i=t.lat*n,a=Math.sin((t.lat-e.lat)*n/2),o=Math.sin((t.lng-e.lng)*n/2),s=a*a+Math.cos(r)*Math.cos(i)*o*o,u=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*u}}),V=6378137,H={R:V,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),i=Math.sin(r*t);return new R(this.R*e.lng*t,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(e){var t=180/Math.PI;return new F((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=V*Math.PI;return new D([-e,-e],[e,e])}()};function W(e,t,n,r){if(g(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=r}function G(e,t,n,r){return new W(e,t,n,r)}W.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new R((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var Z=n({},U,{code:"EPSG:3857",projection:H,transformation:function(){var e=.5/(Math.PI*H.R);return G(e,.5,-e,.5)}()}),Y=n({},Z,{code:"EPSG:900913"});function X(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function K(e,t){var n,r,i,a,o,s,u="";for(n=0,i=e.length;n<i;n++){for(r=0,a=(o=e[n]).length;r<a;r++)u+=(r?"L":"M")+(s=o[r]).x+" "+s.y;u+=t?Oe.svg?"z":"x":""}return u||"M0 0"}var J=document.documentElement.style,Q="ActiveXObject"in window,ee=Q&&!document.addEventListener,te="msLaunchUri"in navigator&&!("documentMode"in document),ne=Re("webkit"),re=Re("android"),ie=Re("android 2")||Re("android 3"),ae=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),oe=re&&Re("Google")&&ae<537&&!("AudioNode"in window),se=!!window.opera,ue=!te&&Re("chrome"),le=Re("gecko")&&!ne&&!se&&!Q,ce=!ue&&Re("safari"),he=Re("phantom"),de="OTransition"in J,fe=0===navigator.platform.indexOf("Win"),pe=Q&&"transition"in J,ve="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ie,me="MozPerspective"in J,ge=!window.L_DISABLE_3D&&(pe||ve||me)&&!de&&!he,_e="undefined"!==typeof orientation||Re("mobile"),ye=_e&&ne,be=_e&&ve,xe=!window.PointerEvent&&window.MSPointerEvent,we=!(!window.PointerEvent&&!xe),ke="ontouchstart"in window||!!window.TouchEvent,Se=!window.L_NO_TOUCH&&(ke||we),Me=_e&&se,Ce=_e&&le,Te=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ee=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",l,t),window.removeEventListener("testPassiveEventSupport",l,t)}catch(n){}return e}(),Pe=!!document.createElement("canvas").getContext,Ae=!(!document.createElementNS||!X("svg").createSVGRect),Le=!!Ae&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(e.firstChild&&e.firstChild.namespaceURI)}(),Ie=!Ae&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(n){return!1}}();function Re(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Oe={ie:Q,ielt9:ee,edge:te,webkit:ne,android:re,android23:ie,androidStock:oe,opera:se,chrome:ue,gecko:le,safari:ce,phantom:he,opera12:de,win:fe,ie3d:pe,webkit3d:ve,gecko3d:me,any3d:ge,mobile:_e,mobileWebkit:ye,mobileWebkit3d:be,msPointer:xe,pointer:we,touch:Se,touchNative:ke,mobileOpera:Me,mobileGecko:Ce,retina:Te,passiveEvents:Ee,canvas:Pe,svg:Ae,vml:Ie,inlineSvg:Le},Ne=Oe.msPointer?"MSPointerDown":"pointerdown",De=Oe.msPointer?"MSPointerMove":"pointermove",ze=Oe.msPointer?"MSPointerUp":"pointerup",je=Oe.msPointer?"MSPointerCancel":"pointercancel",Be={touchstart:Ne,touchmove:De,touchend:ze,touchcancel:je},Fe={touchstart:Xe,touchmove:Ye,touchend:Ye,touchcancel:Ye},$e={},qe=!1;function Ue(e,t,n){return"touchstart"===t&&Ze(),Fe[t]?(n=Fe[t].bind(this,n),e.addEventListener(Be[t],n,!1),n):(console.warn("wrong event specified:",t),L.Util.falseFn)}function Ve(e,t,n){Be[t]?e.removeEventListener(Be[t],n,!1):console.warn("wrong event specified:",t)}function He(e){$e[e.pointerId]=e}function We(e){$e[e.pointerId]&&($e[e.pointerId]=e)}function Ge(e){delete $e[e.pointerId]}function Ze(){qe||(document.addEventListener(Ne,He,!0),document.addEventListener(De,We,!0),document.addEventListener(ze,Ge,!0),document.addEventListener(je,Ge,!0),qe=!0)}function Ye(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in t.touches=[],$e)t.touches.push($e[n]);t.changedTouches=[t],e(t)}}function Xe(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Ht(t),Ye(e,t)}function Ke(e){var t,n,r={};for(n in e)t=e[n],r[n]=t&&t.bind?t.bind(e):t;return e=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var Je=200;function Qe(e,t){e.addEventListener("dblclick",t);var n,r=0;function i(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var i=Date.now();i-r<=Je?2===++n&&t(Ke(e)):n=1,r=i}}else n=e.detail}return e.addEventListener("click",i),{dblclick:t,simDblclick:i}}function et(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var tt,nt,rt,it,at,ot=kt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),st=kt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ut="webkitTransition"===st||"OTransition"===st?st+"End":"transitionend";function lt(e){return"string"===typeof e?document.getElementById(e):e}function ct(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return"auto"===n?null:n}function ht(e,t,n){var r=document.createElement(e);return r.className=t||"",n&&n.appendChild(r),r}function dt(e){var t=e.parentNode;t&&t.removeChild(e)}function ft(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function pt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function vt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function mt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=bt(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function gt(e,t){if(void 0!==e.classList)for(var n=d(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!mt(e,t)){var a=bt(e);yt(e,(a?a+" ":"")+t)}}function _t(e,t){void 0!==e.classList?e.classList.remove(t):yt(e,h((" "+bt(e)+" ").replace(" "+t+" "," ")))}function yt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function bt(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function xt(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&wt(e,t)}function wt(e,t){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(r)}catch(i){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}function kt(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function St(e,t,n){var r=t||new R(0,0);e.style[ot]=(Oe.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(n?" scale("+n+")":"")}function Mt(e,t){e._leaflet_pos=t,Oe.any3d?St(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Ct(e){return e._leaflet_pos||new R(0,0)}if("onselectstart"in document)tt=function(){Nt(window,"selectstart",Ht)},nt=function(){zt(window,"selectstart",Ht)};else{var Tt=kt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);tt=function(){if(Tt){var e=document.documentElement.style;rt=e[Tt],e[Tt]="none"}},nt=function(){Tt&&(document.documentElement.style[Tt]=rt,rt=void 0)}}function Et(){Nt(window,"dragstart",Ht)}function Pt(){zt(window,"dragstart",Ht)}function At(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(Lt(),it=e,at=e.style.outline,e.style.outline="none",Nt(window,"keydown",Lt))}function Lt(){it&&(it.style.outline=at,it=void 0,at=void 0,zt(window,"keydown",Lt))}function It(e){do{e=e.parentNode}while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Rt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Ot={__proto__:null,TRANSFORM:ot,TRANSITION:st,TRANSITION_END:ut,get:lt,getStyle:ct,create:ht,remove:dt,empty:ft,toFront:pt,toBack:vt,hasClass:mt,addClass:gt,removeClass:_t,setClass:yt,getClass:bt,setOpacity:xt,testProp:kt,setTransform:St,setPosition:Mt,getPosition:Ct,get disableTextSelection(){return tt},get enableTextSelection(){return nt},disableImageDrag:Et,enableImageDrag:Pt,preventOutline:At,restoreOutline:Lt,getSizedParentNode:It,getScale:Rt};function Nt(e,t,n,r){if(t&&"object"===typeof t)for(var i in t)Ft(e,i,t[i],n);else for(var a=0,o=(t=d(t)).length;a<o;a++)Ft(e,t[a],n,r);return this}var Dt="_leaflet_events";function zt(e,t,n,r){if(1===arguments.length)jt(e),delete e[Dt];else if(t&&"object"===typeof t)for(var i in t)$t(e,i,t[i],n);else if(t=d(t),2===arguments.length)jt(e,(function(e){return-1!==_(t,e)}));else for(var a=0,o=t.length;a<o;a++)$t(e,t[a],n,r);return this}function jt(e,t){for(var n in e[Dt]){var r=n.split(/\d/)[0];t&&!t(r)||$t(e,r,null,null,n)}}var Bt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ft(e,t,n,r){var i=t+o(n)+(r?"_"+o(r):"");if(e[Dt]&&e[Dt][i])return this;var a=function(t){return n.call(r||e,t||window.event)},s=a;!Oe.touchNative&&Oe.pointer&&0===t.indexOf("touch")?a=Ue(e,t,a):Oe.touch&&"dblclick"===t?a=Qe(e,a):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(Bt[t]||t,a,!!Oe.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(a=function(t){t=t||window.event,Xt(e,t)&&s(t)},e.addEventListener(Bt[t],a,!1)):e.addEventListener(t,s,!1):e.attachEvent("on"+t,a),e[Dt]=e[Dt]||{},e[Dt][i]=a}function $t(e,t,n,r,i){i=i||t+o(n)+(r?"_"+o(r):"");var a=e[Dt]&&e[Dt][i];if(!a)return this;!Oe.touchNative&&Oe.pointer&&0===t.indexOf("touch")?Ve(e,t,a):Oe.touch&&"dblclick"===t?et(e,a):"removeEventListener"in e?e.removeEventListener(Bt[t]||t,a,!1):e.detachEvent("on"+t,a),e[Dt][i]=null}function qt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Ut(e){return Ft(e,"wheel",qt),this}function Vt(e){return Nt(e,"mousedown touchstart dblclick contextmenu",qt),e._leaflet_disable_click=!0,this}function Ht(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Wt(e){return Ht(e),qt(e),this}function Gt(e,t){if(!t)return new R(e.clientX,e.clientY);var n=Rt(t),r=n.boundingClientRect;return new R((e.clientX-r.left)/n.x-t.clientLeft,(e.clientY-r.top)/n.y-t.clientTop)}var Zt=Oe.win&&Oe.chrome?2*window.devicePixelRatio:Oe.gecko?window.devicePixelRatio:1;function Yt(e){return Oe.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Zt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function Xt(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(r){return!1}return n!==e}var Kt={__proto__:null,on:Nt,off:zt,stopPropagation:qt,disableScrollPropagation:Ut,disableClickPropagation:Vt,preventDefault:Ht,stop:Wt,getMousePosition:Gt,getWheelDelta:Yt,isExternalTarget:Xt,addListener:Nt,removeListener:zt},Jt=I.extend({run:function(e,t,n,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Ct(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=M(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),Mt(this._el,n),this.fire("step")},_complete:function(){C(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),Qt=I.extend({options:{crs:Z,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=f(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView($(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=st&&Oe.any3d&&!Oe.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Nt(this._proxy,ut,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,r){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter($(e),t,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=n({animate:r.animate},r.zoom),r.pan=n({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom):this._tryAnimatedPan(e,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(Oe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(Oe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var r=this.getZoomScale(t),i=this.getSize().divideBy(2),a=(e instanceof R?e:this.latLngToContainerPoint(e)).subtract(i).multiplyBy(1-1/r),o=this.containerPointToLatLng(i.add(a));return this.setView(o,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():B(e);var n=N(t.paddingTopLeft||t.padding||[0,0]),r=N(t.paddingBottomRight||t.padding||[0,0]),i=this.getBoundsZoom(e,!1,n.add(r));if((i="number"===typeof t.maxZoom?Math.min(t.maxZoom,i):i)===1/0)return{center:e.getCenter(),zoom:i};var a=r.subtract(n).divideBy(2),o=this.project(e.getSouthWest(),i),s=this.project(e.getNorthEast(),i);return{center:this.unproject(o.add(s).divideBy(2).add(a),i),zoom:i}},fitBounds:function(e,t){if(!(e=B(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=N(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Jt,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){gt(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!Oe.any3d)return this.setView(e,t,n);this._stop();var r=this.project(this.getCenter()),i=this.project(e),a=this.getSize(),o=this._zoom;e=$(e),t=void 0===t?o:t;var s=Math.max(a.x,a.y),u=s*this.getZoomScale(o,t),l=i.distanceTo(r)||1,c=1.42,h=c*c;function d(e){var t=(u*u-s*s+(e?-1:1)*h*h*l*l)/(2*(e?u:s)*h*l),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function f(e){return(Math.exp(e)-Math.exp(-e))/2}function p(e){return(Math.exp(e)+Math.exp(-e))/2}function v(e){return f(e)/p(e)}var m=d(0);function g(e){return s*(p(m)/p(m+c*e))}function _(e){return s*(p(m)*v(m+c*e)-f(m))/h}function y(e){return 1-Math.pow(1-e,1.5)}var b=Date.now(),x=(d(1)-m)/c,w=n.duration?1e3*n.duration:1e3*x*.8;function k(){var n=(Date.now()-b)/w,a=y(n)*x;n<=1?(this._flyToFrame=M(k,this),this._move(this.unproject(r.add(i.subtract(r).multiplyBy(_(a)/l)),o),this.getScaleZoom(s/g(a),o),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),k.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return(e=B(e)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),r=this._limitCenter(n,this._zoom,B(e));return n.equals(r)||this.panTo(r,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=N((t=t||{}).paddingTopLeft||t.padding||[0,0]),r=N(t.paddingBottomRight||t.padding||[0,0]),i=this.project(this.getCenter()),a=this.project(e),o=this.getPixelBounds(),s=z([o.min.add(n),o.max.subtract(r)]),u=s.getSize();if(!s.contains(a)){this._enforcingBounds=!0;var l=a.subtract(s.getCenter()),c=s.extend(a).getSize().subtract(u);i.x+=l.x<0?-c.x:c.x,i.y+=l.y<0?-c.y:c.y,this.panTo(this.unproject(i),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),a=t.divideBy(2).round(),o=r.divideBy(2).round(),s=a.subtract(o);return s.x||s.y?(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,r,e):navigator.geolocation.getCurrentPosition(t,r,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new F(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),r=this._locateOptions;if(r.setView){var i=this.getBoundsZoom(n);this.setView(t,r.maxZoom?Math.min(i,r.maxZoom):i)}var a={latlng:t,bounds:n,timestamp:e.timestamp};for(var o in e.coords)"number"===typeof e.coords[o]&&(a[o]=e.coords[o]);this.fire("locationfound",a)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),dt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(C(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)dt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=ht("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new j(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=B(e),n=N(n||[0,0]);var r=this.getZoom()||0,i=this.getMinZoom(),a=this.getMaxZoom(),o=e.getNorthWest(),s=e.getSouthEast(),u=this.getSize().subtract(n),l=z(this.project(s,r),this.project(o,r)).getSize(),c=Oe.any3d?this.options.zoomSnap:1,h=u.x/l.x,d=u.y/l.y,f=t?Math.max(h,d):Math.min(h,d);return r=this.getScaleZoom(f,r),c&&(r=Math.round(r/(c/100))*(c/100),r=t?Math.ceil(r/c)*c:Math.floor(r/c)*c),Math.max(i,Math.min(a,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new R(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new D(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"===typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var r=n.zoom(e*n.scale(t));return isNaN(r)?1/0:r},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint($(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(N(e),t)},layerPointToLatLng:function(e){var t=N(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project($(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng($(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(B(e))},distance:function(e,t){return this.options.crs.distance($(e),$(t))},containerPointToLayerPoint:function(e){return N(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return N(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(N(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint($(e)))},mouseEventToContainerPoint:function(e){return Gt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=lt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");Nt(t,"scroll",this._onScroll,this),this._containerId=o(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Oe.any3d,gt(e,"leaflet-container"+(Oe.touch?" leaflet-touch":"")+(Oe.retina?" leaflet-retina":"")+(Oe.ielt9?" leaflet-oldie":"")+(Oe.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ct(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Mt(this._mapPane,new R(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(gt(e.markerPane,"leaflet-zoom-hide"),gt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t){Mt(this._mapPane,new R(0,0));var n=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var r=this._zoom!==t;this._moveStart(r,!1)._move(e,t)._moveEnd(r),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n,r){void 0===t&&(t=this._zoom);var i=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),r?n&&n.pinch&&this.fire("zoom",n):((i||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return C(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Mt(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[o(this._container)]=this;var t=e?zt:Nt;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Oe.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){C(this._resizeRequest),this._resizeRequest=M((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,r=[],i="mouseout"===t||"mouseover"===t,a=e.target||e.srcElement,s=!1;a;){if((n=this._targets[o(a)])&&("click"===t||"preclick"===t)&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(t,!0)){if(i&&!Xt(a,e))break;if(r.push(n),i)break}if(a===this._container)break;a=a.parentNode}return r.length||s||i||!this.listens(t,!0)||(r=[this]),r},_isClickDisabled:function(e){for(;e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var n=e.type;"mousedown"===n&&At(t),this._fireDOMEvent(e,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,r){if("click"===e.type){var i=n({},e);i.type="preclick",this._fireDOMEvent(i,i.type,r)}var a=this._findEventTargets(e,t);if(r){for(var o=[],s=0;s<r.length;s++)r[s].listens(t,!0)&&o.push(r[s]);a=o.concat(a)}if(a.length){"contextmenu"===t&&Ht(e);var u=a[0],l={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var c=u.getLatLng&&(!u._radius||u._radius<=10);l.containerPoint=c?this.latLngToContainerPoint(u.getLatLng()):this.mouseEventToContainerPoint(e),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=c?u.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(s=0;s<a.length;s++)if(a[s].fire(t,l,!0),l.originalEvent._stopped||!1===a[s].options.bubblingMouseEvents&&-1!==_(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Ct(this._mapPane)||new R(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(r)},_latLngBoundsToNewLayerBounds:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return z([this.project(e.getSouthWest(),t)._subtract(r),this.project(e.getNorthWest(),t)._subtract(r),this.project(e.getSouthEast(),t)._subtract(r),this.project(e.getNorthEast(),t)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var r=this.project(e,t),i=this.getSize().divideBy(2),a=new D(r.subtract(i),r.add(i)),o=this._getBoundsOffset(a,n,t);return o.round().equals([0,0])?e:this.unproject(r.add(o),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),r=new D(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(r,t))},_getBoundsOffset:function(e,t,n){var r=z(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),i=r.min.subtract(e.min),a=r.max.subtract(e.max);return new R(this._rebound(i.x,-a.x),this._rebound(i.y,-a.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),r=Oe.any3d?this.options.zoomSnap:1;return r&&(e=Math.round(e/r)*r),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){_t(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n))&&(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=ht("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",(function(e){var t=ot,n=this._proxy.style[t];St(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){dt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();St(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r);return!(!0!==n.animate&&!this.getSize().contains(i))&&(M((function(){this._moveStart(!0,!1)._animateZoom(e,t,!0)}),this),!0)},_animateZoom:function(e,t,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,gt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&_t(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function en(e,t){return new Qt(e,t)}var tn=E.extend({options:{position:"topright"},initialize:function(e){f(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),r=e._controlCorners[n];return gt(t,"leaflet-control"),-1!==n.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(dt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),nn=function(e){return new tn(e)};Qt.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=ht("div",t+"control-container",this._container);function r(r,i){var a=t+r+" "+t+i;e[r+i]=ht("div",a,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)dt(this._controlCorners[e]);dt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var rn=tn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,r){return n<r?-1:r<n?1:0}},initialize:function(e,t,n){for(var r in f(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,e)this._addLayer(e[r],r);for(r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return tn.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(o(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){gt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(gt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):_t(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return _t(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=ht("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Vt(t),Ut(t);var r=this._section=ht("section",e+"-list");n&&(this._map.on("click",this.collapse,this),Nt(t,{mouseenter:function(){Nt(r,"click",Ht),this.expand(),setTimeout((function(){zt(r,"click",Ht)}))},mouseleave:this.collapse},this));var i=this._layersLink=ht("a",e+"-toggle",t);i.href="#",i.title="Layers",i.setAttribute("role","button"),Nt(i,"click",Ht),Nt(i,"focus",this.expand,this),n||this.expand(),this._baseLayersList=ht("div",e+"-base",r),this._separator=ht("div",e+"-separator",r),this._overlaysList=ht("div",e+"-overlays",r),t.appendChild(r)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&o(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(i((function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)}),this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ft(this._baseLayersList),ft(this._overlaysList),this._layerControlInputs=[];var e,t,n,r,i=0;for(n=0;n<this._layers.length;n++)r=this._layers[n],this._addItem(r),t=t||r.overlay,e=e||!r.overlay,i+=r.overlay?0:1;return this.options.hideSingleBase&&(e=e&&i>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(o(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(e){var t,n=document.createElement("label"),r=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=r):t=this._createRadioElement("leaflet-base-layers_"+o(this),r),this._layerControlInputs.push(t),t.layerId=o(e.layer),Nt(t,"click",this._onInputClick,this);var i=document.createElement("span");i.innerHTML=" "+e.name;var a=document.createElement("span");return n.appendChild(a),a.appendChild(t),a.appendChild(i),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var e,t,n=this._layerControlInputs,r=[],i=[];this._handlingClick=!0;for(var a=n.length-1;a>=0;a--)e=n[a],t=this._getLayer(e.layerId).layer,e.checked?r.push(t):e.checked||i.push(t);for(a=0;a<i.length;a++)this._map.hasLayer(i[a])&&this._map.removeLayer(i[a]);for(a=0;a<r.length;a++)this._map.hasLayer(r[a])||this._map.addLayer(r[a]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,r=this._map.getZoom(),i=n.length-1;i>=0;i--)e=n[i],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&r<t.options.minZoom||void 0!==t.options.maxZoom&&r>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this}}),an=function(e,t,n){return new rn(e,t,n)},on=tn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=ht("div",t+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,r,i){var a=ht("a",n,r);return a.innerHTML=e,a.href="#",a.title=t,a.setAttribute("role","button"),a.setAttribute("aria-label",t),Vt(a),Nt(a,"click",Wt),Nt(a,"click",i,this),Nt(a,"click",this._refocusOnMap,this),a},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";_t(this._zoomInButton,t),_t(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(gt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(gt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});Qt.mergeOptions({zoomControl:!0}),Qt.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new on,this.addControl(this.zoomControl))}));var sn=function(e){return new on(e)},un=tn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=ht("div",t),r=this.options;return this._addScales(r,t+"-line",n),e.on(r.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=ht("div",t,n)),e.imperial&&(this._iScale=ht("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(r=this._getRoundNum(i),this._updateScale(this._iScale,r+" ft",r/i))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),ln=function(e){return new un(e)},cn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',hn=tn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Oe.inlineSvg?cn+" ":"")+"Leaflet</a>"},initialize:function(e){f(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=ht("div","leaflet-control-attribution"),Vt(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",(function(){this.removeAttribution(e.layer.getAttribution())}),this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});Qt.mergeOptions({attributionControl:!0}),Qt.addInitHook((function(){this.options.attributionControl&&(new hn).addTo(this)}));var dn=function(e){return new hn(e)};tn.Layers=rn,tn.Zoom=on,tn.Scale=un,tn.Attribution=hn,nn.layers=an,nn.zoom=sn,nn.scale=ln,nn.attribution=dn;var fn=E.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});fn.addTo=function(e,t){return e.addHandler(t,this),this};var pn,vn={Events:A},mn=Oe.touch?"touchstart mousedown":"mousedown",gn=I.extend({options:{clickTolerance:3},initialize:function(e,t,n,r){f(this,r),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(Nt(this._dragStartTarget,mn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(gn._dragging===this&&this.finishDrag(!0),zt(this._dragStartTarget,mn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!mt(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)gn._dragging===this&&this.finishDrag();else if(!(gn._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)&&(gn._dragging=this,this._preventOutline&&At(this._element),Et(),tt(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,n=It(this._element);this._startPoint=new R(t.clientX,t.clientY),this._startPos=Ct(this._element),this._parentScale=Rt(n);var r="mousedown"===e.type;Nt(document,r?"mousemove":"touchmove",this._onMove,this),Nt(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new R(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Ht(e),this._moved||(this.fire("dragstart"),this._moved=!0,gt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),gt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Mt(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){_t(document.body,"leaflet-dragging"),this._lastTarget&&(_t(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),zt(document,"mousemove touchmove",this._onMove,this),zt(document,"mouseup touchend touchcancel",this._onUp,this),Pt(),nt(),this._moved&&this._moving&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,gn._dragging=!1}});function _n(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=xn(e=kn(e,n),n)}function yn(e,t,n){return Math.sqrt(En(e,t,n,!0))}function bn(e,t,n){return En(e,t,n)}function xn(e,t){var n=e.length,r=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);r[0]=r[n-1]=1,wn(e,r,t,0,n-1);var i,a=[];for(i=0;i<n;i++)r[i]&&a.push(e[i]);return a}function wn(e,t,n,r,i){var a,o,s,u=0;for(o=r+1;o<=i-1;o++)(s=En(e[o],e[r],e[i],!0))>u&&(a=o,u=s);u>n&&(t[a]=1,wn(e,t,n,r,a),wn(e,t,n,a,i))}function kn(e,t){for(var n=[e[0]],r=1,i=0,a=e.length;r<a;r++)Tn(e[r],e[i])>t&&(n.push(e[r]),i=r);return i<a-1&&n.push(e[a-1]),n}function Sn(e,t,n,r,i){var a,o,s,u=r?pn:Cn(e,n),l=Cn(t,n);for(pn=l;;){if(!(u|l))return[e,t];if(u&l)return!1;s=Cn(o=Mn(e,t,a=u||l,n,i),n),a===u?(e=o,u=s):(t=o,l=s)}}function Mn(e,t,n,r,i){var a,o,s=t.x-e.x,u=t.y-e.y,l=r.min,c=r.max;return 8&n?(a=e.x+s*(c.y-e.y)/u,o=c.y):4&n?(a=e.x+s*(l.y-e.y)/u,o=l.y):2&n?(a=c.x,o=e.y+u*(c.x-e.x)/s):1&n&&(a=l.x,o=e.y+u*(l.x-e.x)/s),new R(a,o,i)}function Cn(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function Tn(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function En(e,t,n,r){var i,a=t.x,o=t.y,s=n.x-a,u=n.y-o,l=s*s+u*u;return l>0&&((i=((e.x-a)*s+(e.y-o)*u)/l)>1?(a=n.x,o=n.y):i>0&&(a+=s*i,o+=u*i)),s=e.x-a,u=e.y-o,r?s*s+u*u:new R(a,o)}function Pn(e){return!g(e[0])||"object"!==typeof e[0][0]&&"undefined"!==typeof e[0][0]}function An(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Pn(e)}var Ln={__proto__:null,simplify:_n,pointToSegmentDistance:yn,closestPointOnSegment:bn,clipSegment:Sn,_getEdgeIntersection:Mn,_getBitCode:Cn,_sqClosestPointOnSegment:En,isFlat:Pn,_flat:An};function In(e,t,n){var r,i,a,o,s,u,l,c,h,d=[1,4,2,8];for(i=0,l=e.length;i<l;i++)e[i]._code=Cn(e[i],t);for(o=0;o<4;o++){for(c=d[o],r=[],i=0,a=(l=e.length)-1;i<l;a=i++)s=e[i],u=e[a],s._code&c?u._code&c||((h=Mn(u,s,c,t,n))._code=Cn(h,t),r.push(h)):(u._code&c&&((h=Mn(u,s,c,t,n))._code=Cn(h,t),r.push(h)),r.push(s));e=r}return e}var Rn={__proto__:null,clipPolygon:In},On={project:function(e){return new R(e.lng,e.lat)},unproject:function(e){return new F(e.y,e.x)},bounds:new D([-180,-90],[180,90])},Nn={R:6378137,R_MINOR:6356752.314245179,bounds:new D([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,r=e.lat*t,i=this.R_MINOR/n,a=Math.sqrt(1-i*i),o=a*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/Math.pow((1-o)/(1+o),a/2);return r=-n*Math.log(Math.max(s,1e-10)),new R(e.lng*t*n,r)},unproject:function(e){for(var t,n=180/Math.PI,r=this.R,i=this.R_MINOR/r,a=Math.sqrt(1-i*i),o=Math.exp(-e.y/r),s=Math.PI/2-2*Math.atan(o),u=0,l=.1;u<15&&Math.abs(l)>1e-7;u++)t=a*Math.sin(s),t=Math.pow((1-t)/(1+t),a/2),s+=l=Math.PI/2-2*Math.atan(o*t)-s;return new F(s*n,e.x*n/r)}},Dn={__proto__:null,LonLat:On,Mercator:Nn,SphericalMercator:H},zn=n({},U,{code:"EPSG:3395",projection:Nn,transformation:function(){var e=.5/(Math.PI*Nn.R);return G(e,.5,-e,.5)}()}),jn=n({},U,{code:"EPSG:4326",projection:On,transformation:G(1/180,1,-1/180,.5)}),Bn=n({},q,{projection:On,transformation:G(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0});q.Earth=U,q.EPSG3395=zn,q.EPSG3857=Z,q.EPSG900913=Y,q.EPSG4326=jn,q.Simple=Bn;var Fn=I.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[o(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[o(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",(function(){t.off(n,this)}),this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});Qt.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=o(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=o(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return o(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?g(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[o(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=o(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var r in this._zoomBoundLayers){var i=this._zoomBoundLayers[r].options;e=void 0===i.minZoom?e:Math.min(e,i.minZoom),t=void 0===i.maxZoom?t:Math.max(t,i.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var $n=Fn.extend({initialize:function(e,t){var n,r;if(f(this,t),this._layers={},e)for(n=0,r=e.length;n<r;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"===typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,r=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,r);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return o(e)}}),qn=function(e,t){return new $n(e,t)},Un=$n.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),$n.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),$n.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new j;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),Vn=function(e,t){return new Un(e,t)},Hn=E.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){f(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(r,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(e,t){var n=this.options,r=n[t+"Size"];"number"===typeof r&&(r=[r,r]);var i=N(r),a=N("shadow"===t&&n.shadowAnchor||n.iconAnchor||i&&i.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),a&&(e.style.marginLeft=-a.x+"px",e.style.marginTop=-a.y+"px"),i&&(e.style.width=i.x+"px",e.style.height=i.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return Oe.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Wn(e){return new Hn(e)}var Gn=Hn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!==typeof Gn.imagePath&&(Gn.imagePath=this._detectIconPath()),(this.options.imagePath||Gn.imagePath)+Hn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var r=t.exec(e);return r&&r[n]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=ht("div","leaflet-default-icon-path",document.body),t=ct(e,"background-image")||ct(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-"leaflet.css".length-1):""}}),Zn=fn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new gn(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),gt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&_t(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,r=this._marker.options.autoPanSpeed,i=this._marker.options.autoPanPadding,a=Ct(t._icon),o=n.getPixelBounds(),s=n.getPixelOrigin(),u=z(o.min._subtract(s).add(i),o.max._subtract(s).subtract(i));if(!u.contains(a)){var l=N((Math.max(u.max.x,a.x)-u.max.x)/(o.max.x-u.max.x)-(Math.min(u.min.x,a.x)-u.min.x)/(o.min.x-u.min.x),(Math.max(u.max.y,a.y)-u.max.y)/(o.max.y-u.max.y)-(Math.min(u.min.y,a.y)-u.min.y)/(o.min.y-u.min.y)).multiplyBy(r);n.panBy(l,{animate:!1}),this._draggable._newPos._add(l),this._draggable._startPos._add(l),Mt(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=M(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(C(this._panRequest),this._panRequest=M(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,r=Ct(t._icon),i=t._map.layerPointToLatLng(r);n&&Mt(n,r),t._latlng=i,e.latlng=i,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){C(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Yn=Fn.extend({options:{icon:new Gn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){f(this,t),this._latlng=$(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=$(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),r=!1;n!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),gt(n,t),e.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Nt(n,"focus",this._panOnFocus,this);var i=e.icon.createShadow(this._shadow),a=!1;i!==this._shadow&&(this._removeShadow(),a=!0),i&&(gt(i,t),i.alt=""),this._shadow=i,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),i&&a&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&zt(this._icon,"focus",this._panOnFocus,this),dt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&dt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Mt(this._icon,e),this._shadow&&Mt(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(gt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Zn)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Zn(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&xt(this._icon,e),this._shadow&&xt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?N(t.iconSize):N(0,0),r=t.iconAnchor?N(t.iconAnchor):N(0,0);e.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:n.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Xn(e,t){return new Yn(e,t)}var Kn=Fn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return f(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Jn=Kn.extend({options:{fill:!0,radius:10},initialize:function(e,t){f(this,t),this._latlng=$(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=$(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return Kn.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),r=[e+n,t+n];this._pxBounds=new D(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Qn(e,t){return new Jn(e,t)}var er=Jn.extend({initialize:function(e,t,r){if("number"===typeof t&&(t=n({},r,{radius:t})),f(this,t),this._latlng=$(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new j(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Kn.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,r=n.options.crs;if(r.distance===U.distance){var i=Math.PI/180,a=this._mRadius/U.R/i,o=n.project([t+a,e]),s=n.project([t-a,e]),u=o.add(s).divideBy(2),l=n.unproject(u).lat,c=Math.acos((Math.cos(a*i)-Math.sin(t*i)*Math.sin(l*i))/(Math.cos(t*i)*Math.cos(l*i)))/i;(isNaN(c)||0===c)&&(c=a/Math.cos(Math.PI/180*t)),this._point=u.subtract(n.getPixelOrigin()),this._radius=isNaN(c)?0:u.x-n.project([l,e-c]).x,this._radiusY=u.y-o.y}else{var h=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}});function tr(e,t,n){return new er(e,t,n)}var nr=Kn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){f(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,r=1/0,i=null,a=En,o=0,s=this._parts.length;o<s;o++)for(var u=this._parts[o],l=1,c=u.length;l<c;l++){var h=a(e,t=u[l-1],n=u[l],!0);h<r&&(r=h,i=a(e,t,n))}return i&&(i.distance=Math.sqrt(r)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,n,r,i,a,o,s=this._rings[0],u=s.length;if(!u)return null;for(e=0,t=0;e<u-1;e++)t+=s[e].distanceTo(s[e+1])/2;if(0===t)return this._map.layerPointToLatLng(s[0]);for(e=0,r=0;e<u-1;e++)if(i=s[e],a=s[e+1],(r+=n=i.distanceTo(a))>t)return o=(r-t)/n,this._map.layerPointToLatLng([a.x-o*(a.x-i.x),a.y-o*(a.y-i.y)])},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=$(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new j,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Pn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=Pn(e),r=0,i=e.length;r<i;r++)n?(t[r]=$(e[r]),this._bounds.extend(t[r])):t[r]=this._convertLatLngs(e[r]);return t},_project:function(){var e=new D;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new R(e,e);this._rawPxBounds&&(this._pxBounds=new D([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var r,i,a=e[0]instanceof F,o=e.length;if(a){for(i=[],r=0;r<o;r++)i[r]=this._map.latLngToLayerPoint(e[r]),n.extend(i[r]);t.push(i)}else for(r=0;r<o;r++)this._projectLatlngs(e[r],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,r,i,a,o,s,u=this._parts;for(t=0,r=0,i=this._rings.length;t<i;t++)for(n=0,a=(s=this._rings[t]).length;n<a-1;n++)(o=Sn(s[n],s[n+1],e,n,!0))&&(u[r]=u[r]||[],u[r].push(o[0]),o[1]===s[n+1]&&n!==a-2||(u[r].push(o[1]),r++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,r=e.length;n<r;n++)e[n]=_n(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,r,i,a,o,s,u=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,a=this._parts.length;n<a;n++)for(r=0,i=(o=(s=this._parts[n]).length)-1;r<o;i=r++)if((t||0!==r)&&yn(e,s[i],s[r])<=u)return!0;return!1}});function rr(e,t){return new nr(e,t)}nr._flat=An;var ir=nr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,n,r,i,a,o,s,u,l=this._rings[0],c=l.length;if(!c)return null;for(a=o=s=0,e=0,t=c-1;e<c;t=e++)n=l[e],r=l[t],i=n.y*r.x-r.y*n.x,o+=(n.x+r.x)*i,s+=(n.y+r.y)*i,a+=3*i;return u=0===a?l[0]:[o/a,s/a],this._map.layerPointToLatLng(u)},_convertLatLngs:function(e){var t=nr.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof F&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){nr.prototype._setLatLngs.call(this,e),Pn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Pn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new R(t,t);if(e=new D(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var r,i=0,a=this._rings.length;i<a;i++)(r=In(this._rings[i],e,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,r,i,a,o,s,u,l=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,s=this._parts.length;i<s;i++)for(a=0,o=(u=(t=this._parts[i]).length)-1;a<u;o=a++)n=t[a],r=t[o],n.y>e.y!==r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(l=!l);return l||nr.prototype._containsPoint.call(this,e,!0)}});function ar(e,t){return new ir(e,t)}var or=Un.extend({initialize:function(e,t){f(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,r,i=g(e)?e:e.features;if(i){for(t=0,n=i.length;t<n;t++)((r=i[t]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var a=this.options;if(a.filter&&!a.filter(e))return this;var o=sr(e,a);return o?(o.feature=pr(e),o.defaultOptions=o.options,this.resetStyle(o),a.onEachFeature&&a.onEachFeature(e,o),this.addLayer(o)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer((function(t){this._setLayerStyle(t,e)}),this)},_setLayerStyle:function(e,t){e.setStyle&&("function"===typeof t&&(t=t(e.feature)),e.setStyle(t))}});function sr(e,t){var n,r,i,a,o="Feature"===e.type?e.geometry:e,s=o?o.coordinates:null,u=[],l=t&&t.pointToLayer,c=t&&t.coordsToLatLng||lr;if(!s&&!o)return null;switch(o.type){case"Point":return ur(l,e,n=c(s),t);case"MultiPoint":for(i=0,a=s.length;i<a;i++)n=c(s[i]),u.push(ur(l,e,n,t));return new Un(u);case"LineString":case"MultiLineString":return r=cr(s,"LineString"===o.type?0:1,c),new nr(r,t);case"Polygon":case"MultiPolygon":return r=cr(s,"Polygon"===o.type?1:2,c),new ir(r,t);case"GeometryCollection":for(i=0,a=o.geometries.length;i<a;i++){var h=sr({geometry:o.geometries[i],type:"Feature",properties:e.properties},t);h&&u.push(h)}return new Un(u);default:throw new Error("Invalid GeoJSON object.")}}function ur(e,t,n,r){return e?e(t,n):new Yn(n,r&&r.markersInheritOptions&&r)}function lr(e){return new F(e[1],e[0],e[2])}function cr(e,t,n){for(var r,i=[],a=0,o=e.length;a<o;a++)r=t?cr(e[a],t-1,n):(n||lr)(e[a]),i.push(r);return i}function hr(e,t){return void 0!==(e=$(e)).alt?[c(e.lng,t),c(e.lat,t),c(e.alt,t)]:[c(e.lng,t),c(e.lat,t)]}function dr(e,t,n,r){for(var i=[],a=0,o=e.length;a<o;a++)i.push(t?dr(e[a],t-1,n,r):hr(e[a],r));return!t&&n&&i.push(i[0]),i}function fr(e,t){return e.feature?n({},e.feature,{geometry:t}):pr(t)}function pr(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var vr={toGeoJSON:function(e){return fr(this,{type:"Point",coordinates:hr(this.getLatLng(),e)})}};function mr(e,t){return new or(e,t)}Yn.include(vr),er.include(vr),Jn.include(vr),nr.include({toGeoJSON:function(e){var t=!Pn(this._latlngs);return fr(this,{type:(t?"Multi":"")+"LineString",coordinates:dr(this._latlngs,t?1:0,!1,e)})}}),ir.include({toGeoJSON:function(e){var t=!Pn(this._latlngs),n=t&&!Pn(this._latlngs[0]),r=dr(this._latlngs,n?2:t?1:0,!0,e);return t||(r=[r]),fr(this,{type:(n?"Multi":"")+"Polygon",coordinates:r})}}),$n.include({toMultiPoint:function(e){var t=[];return this.eachLayer((function(n){t.push(n.toGeoJSON(e).geometry.coordinates)})),fr(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,r=[];return this.eachLayer((function(t){if(t.toGeoJSON){var i=t.toGeoJSON(e);if(n)r.push(i.geometry);else{var a=pr(i);"FeatureCollection"===a.type?r.push.apply(r,a.features):r.push(a)}}})),n?fr(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var gr=mr,_r=Fn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=B(t),f(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(gt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){dt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&pt(this._image),this},bringToBack:function(){return this._map&&vt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=B(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:ht("img");gt(t,"leaflet-image-layer"),this._zoomAnimated&&gt(t,"leaflet-zoom-animated"),this.options.className&&gt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onload=i(this.fire,this,"load"),t.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;St(this._image,n,t)},_reset:function(){var e=this._image,t=new D(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();Mt(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){xt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),yr=function(e,t,n){return new _r(e,t,n)},br=_r.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:ht("video");if(gt(t,"leaflet-image-layer"),this._zoomAnimated&&gt(t,"leaflet-zoom-animated"),this.options.className&&gt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onloadeddata=i(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),r=[],a=0;a<n.length;a++)r.push(n[a].src);this._url=n.length>0?r:[t.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var o=0;o<this._url.length;o++){var s=ht("source");s.src=this._url[o],t.appendChild(s)}}}});function xr(e,t,n){return new br(e,t,n)}var wr=_r.extend({_initImage:function(){var e=this._image=this._url;gt(e,"leaflet-image-layer"),this._zoomAnimated&&gt(e,"leaflet-zoom-animated"),this.options.className&&gt(e,this.options.className),e.onselectstart=l,e.onmousemove=l}});function kr(e,t,n){return new wr(e,t,n)}var Sr=Fn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0},initialize:function(e,t){f(this,e),this._source=t},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&xt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&xt(this._container,1),this.bringToFront(),this.options.interactive&&(gt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(xt(this._container,0),this._removeTimeout=setTimeout(i(dt,void 0,this._container),200)):dt(this._container),this.options.interactive&&(_t(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=$(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&pt(this._container),this},bringToBack:function(){return this._map&&vt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Un){t=null;var n=this._source._layers;for(var r in n)if(n[r]._map){t=n[r];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=N(this.options.offset),n=this._getAnchor();this._zoomAnimated?Mt(this._container,e.add(n)):t=t.add(e).add(n);var r=this._containerBottom=-t.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=r+"px",this._container.style.left=i+"px"}},_getAnchor:function(){return[0,0]}});Qt.include({_initOverlay:function(e,t,n,r){var i=t;return i instanceof e||(i=new e(r).setContent(t)),n&&i.setLatLng(n),i}}),Fn.include({_initOverlay:function(e,t,n,r){var i=n;return i instanceof e?(f(i,r),i._source=this):(i=t&&!r?t:new e(r,this)).setContent(n),i}});var Mr=Sr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Sr.prototype.openOn.call(this,e)},onAdd:function(e){Sr.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Kn||this._source.on("preclick",qt))},onRemove:function(e){Sr.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Kn||this._source.off("preclick",qt))},getEvents:function(){var e=Sr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=ht("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=ht("div",e+"-content-wrapper",t);if(this._contentNode=ht("div",e+"-content",n),Vt(t),Ut(this._contentNode),Nt(t,"contextmenu",qt),this._tipContainer=ht("div",e+"-tip-container",t),this._tip=ht("div",e+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=ht("a",e+"-close-button",t);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',Nt(r,"click",this.close,this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var r=e.offsetHeight,i=this.options.maxHeight,a="leaflet-popup-scrolled";i&&r>i?(t.height=i+"px",gt(e,a)):_t(e,a),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();Mt(this._container,t.add(n))},_adjustPan:function(e){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var t=this._map,n=parseInt(ct(this._container,"marginBottom"),10)||0,r=this._container.offsetHeight+n,i=this._containerWidth,a=new R(this._containerLeft,-r-this._containerBottom);a._add(Ct(this._container));var o=t.layerPointToContainerPoint(a),s=N(this.options.autoPanPadding),u=N(this.options.autoPanPaddingTopLeft||s),l=N(this.options.autoPanPaddingBottomRight||s),c=t.getSize(),h=0,d=0;o.x+i+l.x>c.x&&(h=o.x+i-c.x+l.x),o.x-h-u.x<0&&(h=o.x-u.x),o.y+r+l.y>c.y&&(d=o.y+r-c.y+l.y),o.y-d-u.y<0&&(d=o.y-u.y),(h||d)&&t.fire("autopanstart").panBy([h,d],{animate:e&&"moveend"===e.type})}},_getAnchor:function(){return N(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Cr=function(e,t){return new Mr(e,t)};Qt.mergeOptions({closePopupOnClick:!0}),Qt.include({openPopup:function(e,t,n){return this._initOverlay(Mr,e,t,n).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),Fn.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Mr,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&this._popup._prepareOpen(e)&&this._popup.openOn(this._map),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Wt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof Kn?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Tr=Sr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Sr.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Sr.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Sr.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ht("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,r=this._map,i=this._container,a=r.latLngToContainerPoint(r.getCenter()),o=r.layerPointToContainerPoint(e),s=this.options.direction,u=i.offsetWidth,l=i.offsetHeight,c=N(this.options.offset),h=this._getAnchor();"top"===s?(t=u/2,n=l):"bottom"===s?(t=u/2,n=0):"center"===s?(t=u/2,n=l/2):"right"===s?(t=0,n=l/2):"left"===s?(t=u,n=l/2):o.x<a.x?(s="right",t=0,n=l/2):(s="left",t=u+2*(c.x+h.x),n=l/2),e=e.subtract(N(t,n,!0)).add(c).add(h),_t(i,"leaflet-tooltip-right"),_t(i,"leaflet-tooltip-left"),_t(i,"leaflet-tooltip-top"),_t(i,"leaflet-tooltip-bottom"),gt(i,"leaflet-tooltip-"+s),Mt(i,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&xt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return N(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Er=function(e,t){return new Tr(e,t)};Qt.include({openTooltip:function(e,t,n){return this._initOverlay(Tr,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Fn.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Tr,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&this._tooltip._prepareOpen(e)&&this._tooltip.openOn(this._map),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_openTooltip:function(e){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0))},_moveTooltip:function(e){var t,n,r=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),r=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(r)}});var Pr=Hn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(ft(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var r=N(n.bgPos);t.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Ar(e){return new Pr(e)}Hn.Default=Gn;var Lr=Fn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Oe.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){f(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),dt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(pt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(vt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof R?e:new R(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,r=-e(-1/0,1/0),i=0,a=n.length;i<a;i++)t=n[i].style.zIndex,n[i]!==this._container&&t&&(r=e(r,+t));isFinite(r)&&(this.options.zIndex=r+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Oe.ielt9){xt(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var r in this._tiles){var i=this._tiles[r];if(i.current&&i.loaded){var a=Math.min(1,(e-i.loaded)/200);xt(i.el,a),a<1?t=!0:(i.active?n=!0:this._onOpaqueTile(i),i.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(C(this._fadeFrame),this._fadeFrame=M(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=ht("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(dt(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var r=this._levels[e],i=this._map;return r||((r=this._levels[e]={}).el=ht("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=t,r.origin=i.project(i.unproject(i.getPixelOrigin()),e).round(),r.zoom=e,this._setZoomTransform(r,i.getCenter(),i.getZoom()),l(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var r=t.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)dt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,r){var i=Math.floor(e/2),a=Math.floor(t/2),o=n-1,s=new R(+i,+a);s.z=+o;var u=this._tileCoordsToKey(s),l=this._tiles[u];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),o>r&&this._retainParent(i,a,o,r))},_retainChildren:function(e,t,n,r){for(var i=2*e;i<2*e+2;i++)for(var a=2*t;a<2*t+2;a++){var o=new R(i,a);o.z=n+1;var s=this._tileCoordsToKey(o),u=this._tiles[s];u&&u.active?u.retain=!0:(u&&u.loaded&&(u.retain=!0),n+1<r&&this._retainChildren(i,a,n+1,r))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,r){var i=Math.round(t);i=void 0!==this.options.maxZoom&&i>this.options.maxZoom||void 0!==this.options.minZoom&&i<this.options.minZoom?void 0:this._clampZoom(i);var a=this.options.updateWhenZooming&&i!==this._tileZoom;r&&!a||(this._tileZoom=i,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==i&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var r=this._map.getZoomScale(n,e.zoom),i=e.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(t,n)).round();Oe.any3d?St(e.el,i,r):Mt(e.el,i)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),r=this._tileZoom,i=this._map.getPixelWorldBounds(this._tileZoom);i&&(this._globalTileRange=this._pxBoundsToTileRange(i)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],r).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],r).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],r).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],r).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),r=t.getZoomScale(n,this._tileZoom),i=t.project(e,this._tileZoom).floor(),a=t.getSize().divideBy(2*r);return new D(i.subtract(a),i.add(a))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(e),i=this._pxBoundsToTileRange(r),a=i.getCenter(),o=[],s=this.options.keepBuffer,u=new D(i.getBottomLeft().subtract([s,-s]),i.getTopRight().add([s,-s]));if(!(isFinite(i.min.x)&&isFinite(i.min.y)&&isFinite(i.max.x)&&isFinite(i.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var l in this._tiles){var c=this._tiles[l].coords;c.z===this._tileZoom&&u.contains(new R(c.x,c.y))||(this._tiles[l].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var h=i.min.y;h<=i.max.y;h++)for(var d=i.min.x;d<=i.max.x;d++){var f=new R(d,h);if(f.z=this._tileZoom,this._isValidTile(f)){var p=this._tiles[this._tileCoordsToKey(f)];p?p.current=!0:o.push(f)}}if(o.sort((function(e,t){return e.distanceTo(a)-t.distanceTo(a)})),0!==o.length){this._loading||(this._loading=!0,this.fire("loading"));var v=document.createDocumentFragment();for(d=0;d<o.length;d++)this._addTile(o[d],v);this._level.el.appendChild(v)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(e);return B(this.options.bounds).overlaps(r)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),r=e.scaleBy(n),i=r.add(n);return[t.unproject(r,e.z),t.unproject(i,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new j(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new R(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(dt(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){gt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=l,e.onmousemove=l,Oe.ielt9&&this.options.opacity<1&&xt(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),r=this._tileCoordsToKey(e),a=this.createTile(this._wrapCoords(e),i(this._tileReady,this,e));this._initTile(a),this.createTile.length<2&&M(i(this._tileReady,this,e,null,a)),Mt(a,n),this._tiles[r]={el:a,coords:e,current:!0},t.appendChild(a),this.fire("tileloadstart",{tile:a,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var r=this._tileCoordsToKey(e);(n=this._tiles[r])&&(n.loaded=+new Date,this._map._fadeAnimated?(xt(n.el,0),C(this._fadeFrame),this._fadeFrame=M(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(gt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Oe.ielt9||!this._map._fadeAnimated?M(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new R(this._wrapX?u(e.x,this._wrapX):e.x,this._wrapY?u(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new D(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Ir(e){return new Lr(e)}var Rr=Lr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=f(this,t)).detectRetina&&Oe.retina&&t.maxZoom>0&&(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom++):(t.zoomOffset++,t.maxZoom--),t.minZoom=Math.max(0,t.minZoom)),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return Nt(n,"load",i(this._tileOnLoad,this,t,n)),Nt(n,"error",i(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:Oe.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=r),t["-y"]=r}return m(this._url,n(t,this.options))},_tileOnLoad:function(e,t){Oe.ielt9?setTimeout(i(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var r=this.options.errorTileUrl;r&&t.getAttribute("src")!==r&&(t.src=r),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=l,t.onerror=l,!t.complete)){t.src=y;var n=this._tiles[e].coords;dt(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",y),Lr.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==y))return Lr.prototype._tileReady.call(this,e,t,n)}});function Or(e,t){return new Rr(e,t)}var Nr=Rr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var r=n({},this.defaultWmsParams);for(var i in t)i in this.options||(r[i]=t[i]);var a=(t=f(this,t)).detectRetina&&Oe.retina?2:1,o=this.getTileSize();r.width=o.x*a,r.height=o.y*a,this.wmsParams=r},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Rr.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,r=z(n.project(t[0]),n.project(t[1])),i=r.min,a=r.max,o=(this._wmsVersion>=1.3&&this._crs===jn?[i.y,i.x,a.y,a.x]:[i.x,i.y,a.x,a.y]).join(","),s=Rr.prototype.getTileUrl.call(this,e);return s+p(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function Dr(e,t){return new Nr(e,t)}Rr.WMS=Nr,Or.wms=Dr;var zr=Fn.extend({options:{padding:.1},initialize:function(e){f(this,e),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&gt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),i=this._map.project(this._center,t),a=r.multiplyBy(-n).add(i).subtract(this._map._getNewPixelOrigin(e,t));Oe.any3d?St(this._container,a,n):Mt(this._container,a)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new D(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),jr=zr.extend({options:{tolerance:0},getEvents:function(){var e=zr.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Nt(e,"mousemove",this._onMouseMove,this),Nt(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Nt(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){C(this._redrawRequest),delete this._ctx,dt(this._container),zt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){zr.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),r=Oe.retina?2:1;Mt(t,e.min),t.width=r*n.x,t.height=r*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",Oe.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){zr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[o(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,r=t.prev;n?n.prev=r:this._drawLast=r,r?r.next=n:this._drawFirst=n,delete e._order,delete this._layers[o(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"===typeof e.options.dashArray){var t,n,r=e.options.dashArray.split(/[, ]+/),i=[];for(n=0;n<r.length;n++){if(t=Number(r[n]),isNaN(t))return;i.push(t)}e.options._dashArray=i}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||M(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new D,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)e=r.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,r,i,a,o=e._parts,s=o.length,u=this._ctx;if(s){for(u.beginPath(),n=0;n<s;n++){for(r=0,i=o[n].length;r<i;r++)a=o[n][r],u[r?"lineTo":"moveTo"](a.x,a.y);t&&u.closePath()}this._fillStroke(u,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,r=Math.max(Math.round(e._radius),1),i=(Math.max(Math.round(e._radiusY),1)||r)/r;1!==i&&(n.save(),n.scale(1,i)),n.beginPath(),n.arc(t.x,t.y/i,r,0,2*Math.PI,!1),1!==i&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,r=this._map.mouseEventToLayerPoint(e),i=this._drawFirst;i;i=i.next)(t=i.layer).options.interactive&&t._containsPoint(r)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(n=t);this._fireEvent(!!n&&[n],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(_t(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,r,a=this._drawFirst;a;a=a.next)(n=a.layer).options.interactive&&n._containsPoint(t)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(e),r&&(gt(this._container,"leaflet-interactive"),this._fireEvent([r],e,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(i((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;n&&(n.prev=r,r?r.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;r&&(r.next=n,n?n.prev=r:r&&(this._drawLast=r),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function Br(e){return Oe.canvas?new jr(e):null}var Fr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),$r={_initContainer:function(){this._container=ht("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zr.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=Fr("shape");gt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=Fr("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;dt(t),e.removeInteractiveTarget(t),delete this._layers[o(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,r=e.options,i=e._container;i.stroked=!!r.stroke,i.filled=!!r.fill,r.stroke?(t||(t=e._stroke=Fr("stroke")),i.appendChild(t),t.weight=r.weight+"px",t.color=r.color,t.opacity=r.opacity,r.dashArray?t.dashStyle=g(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=r.lineCap.replace("butt","flat"),t.joinstyle=r.lineJoin):t&&(i.removeChild(t),e._stroke=null),r.fill?(n||(n=e._fill=Fr("fill")),i.appendChild(n),n.color=r.fillColor||r.color,n.opacity=r.fillOpacity):n&&(i.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),r=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+r+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){pt(e._container)},_bringToBack:function(e){vt(e._container)}},qr=Oe.vml?Fr:X,Ur=zr.extend({_initContainer:function(){this._container=qr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=qr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){dt(this._container),zt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){zr.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),Mt(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=qr("path");e.options.className&&gt(t,e.options.className),e.options.interactive&&gt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){dt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[o(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,K(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),r="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",i=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+r+2*n+",0 "+r+2*-n+",0 ";this._setPath(e,i)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){pt(e._path)},_bringToBack:function(e){vt(e._path)}});function Vr(e){return Oe.svg||Oe.vml?new Ur(e):null}Oe.vml&&Ur.include($r),Qt.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Br(e)||Vr(e)}});var Hr=ir.extend({initialize:function(e,t){ir.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=B(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Wr(e,t){return new Hr(e,t)}Ur.create=qr,Ur.pointsToPath=K,or.geometryToLayer=sr,or.coordsToLatLng=lr,or.coordsToLatLngs=cr,or.latLngToCoords=hr,or.latLngsToCoords=dr,or.getFeature=fr,or.asFeature=pr,Qt.mergeOptions({boxZoom:!0});var Gr=fn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Nt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){zt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){dt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),tt(),Et(),this._startPoint=this._map.mouseEventToContainerPoint(e),Nt(document,{contextmenu:Wt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=ht("div","leaflet-zoom-box",this._container),gt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new D(this._point,this._startPoint),n=t.getSize();Mt(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(dt(this._box),_t(this._container,"leaflet-crosshair")),nt(),Pt(),zt(document,{contextmenu:Wt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var t=new j(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Qt.addInitHook("addHandler","boxZoom",Gr),Qt.mergeOptions({doubleClickZoom:!0});var Zr=fn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),r=t.options.zoomDelta,i=e.originalEvent.shiftKey?n-r:n+r;"center"===t.options.doubleClickZoom?t.setZoom(i):t.setZoomAround(e.containerPoint,i)}});Qt.addInitHook("addHandler","doubleClickZoom",Zr),Qt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Yr=fn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new gn(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}gt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){_t(this._map._container,"leaflet-grab"),_t(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=B(this._map.options.maxBounds);this._offsetLimit=z(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,a=(r+t+n)%e-t-n,o=Math.abs(i+n)<Math.abs(a+n)?i:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,n=t.options,r=!n.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),r)t.fire("moveend");else{this._prunePositions(+new Date);var i=this._lastPos.subtract(this._positions[0]),a=(this._lastTime-this._times[0])/1e3,o=n.easeLinearity,s=i.multiplyBy(o/a),u=s.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,u),c=s.multiplyBy(l/u),h=l/(n.inertiaDeceleration*o),d=c.multiplyBy(-h/2).round();d.x||d.y?(d=t._limitOffset(d,t.options.maxBounds),M((function(){t.panBy(d,{duration:h,easeLinearity:o,noMoveStart:!0,animate:!0})}))):t.fire("moveend")}}});Qt.addInitHook("addHandler","dragging",Yr),Qt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Xr=fn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Nt(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),zt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,r=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(r,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,r=this._panKeys={},i=this.keyCodes;for(t=0,n=i.left.length;t<n;t++)r[i.left[t]]=[-1*e,0];for(t=0,n=i.right.length;t<n;t++)r[i.right[t]]=[e,0];for(t=0,n=i.down.length;t<n;t++)r[i.down[t]]=[0,e];for(t=0,n=i.up.length;t<n;t++)r[i.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,r=this._zoomKeys={},i=this.keyCodes;for(t=0,n=i.zoomIn.length;t<n;t++)r[i.zoomIn[t]]=e;for(t=0,n=i.zoomOut.length;t<n;t++)r[i.zoomOut[t]]=-e},_addHooks:function(){Nt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){zt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,r=this._map;if(n in this._panKeys)r._panAnim&&r._panAnim._inProgress||(t=this._panKeys[n],e.shiftKey&&(t=N(t).multiplyBy(3)),r.panBy(t),r.options.maxBounds&&r.panInsideBounds(r.options.maxBounds));else if(n in this._zoomKeys)r.setZoom(r.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}Wt(e)}}});Qt.addInitHook("addHandler","keyboard",Xr),Qt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Kr=fn.extend({addHooks:function(){Nt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){zt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Yt(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),Wt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),i=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,a=n?Math.ceil(i/n)*n:i,o=e._limitZoom(t+(this._delta>0?a:-a))-t;this._delta=0,this._startTime=null,o&&("center"===e.options.scrollWheelZoom?e.setZoom(t+o):e.setZoomAround(this._lastMousePos,t+o))}});Qt.addInitHook("addHandler","scrollWheelZoom",Kr);var Jr=600;Qt.mergeOptions({tapHold:Oe.touchNative&&Oe.safari&&Oe.mobile,tapTolerance:15});var Qr=fn.extend({addHooks:function(){Nt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){zt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new R(t.clientX,t.clientY),this._holdTimeout=setTimeout(i((function(){this._cancel(),this._isTapValid()&&(Nt(document,"touchend",Ht),Nt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))}),this),Jr),Nt(document,"touchend touchcancel contextmenu",this._cancel,this),Nt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){zt(document,"touchend",Ht),zt(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),zt(document,"touchend touchcancel contextmenu",this._cancel,this),zt(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new R(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});Qt.addInitHook("addHandler","tapHold",Qr),Qt.mergeOptions({touchZoom:Oe.touch,bounceAtZoomLimits:!0});var ei=fn.extend({addHooks:function(){gt(this._map._container,"leaflet-touch-zoom"),Nt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){_t(this._map._container,"leaflet-touch-zoom"),zt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(r)._divideBy(2))),this._startDist=n.distanceTo(r),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Nt(document,"touchmove",this._onTouchMove,this),Nt(document,"touchend touchcancel",this._onTouchEnd,this),Ht(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]),a=n.distanceTo(r)/this._startDist;if(this._zoom=t.getScaleZoom(a,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&a<1||this._zoom>t.getMaxZoom()&&a>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===a)return}else{var o=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===a&&0===o.x&&0===o.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),C(this._animRequest);var s=i(t._move,t,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=M(s,this,!0),Ht(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,C(this._animRequest),zt(document,"touchmove",this._onTouchMove,this),zt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Qt.addInitHook("addHandler","touchZoom",ei),Qt.BoxZoom=Gr,Qt.DoubleClickZoom=Zr,Qt.Drag=Yr,Qt.Keyboard=Xr,Qt.ScrollWheelZoom=Kr,Qt.TapHold=Qr,Qt.TouchZoom=ei,e.Bounds=D,e.Browser=Oe,e.CRS=q,e.Canvas=jr,e.Circle=er,e.CircleMarker=Jn,e.Class=E,e.Control=tn,e.DivIcon=Pr,e.DivOverlay=Sr,e.DomEvent=Kt,e.DomUtil=Ot,e.Draggable=gn,e.Evented=I,e.FeatureGroup=Un,e.GeoJSON=or,e.GridLayer=Lr,e.Handler=fn,e.Icon=Hn,e.ImageOverlay=_r,e.LatLng=F,e.LatLngBounds=j,e.Layer=Fn,e.LayerGroup=$n,e.LineUtil=Ln,e.Map=Qt,e.Marker=Yn,e.Mixin=vn,e.Path=Kn,e.Point=R,e.PolyUtil=Rn,e.Polygon=ir,e.Polyline=nr,e.Popup=Mr,e.PosAnimation=Jt,e.Projection=Dn,e.Rectangle=Hr,e.Renderer=zr,e.SVG=Ur,e.SVGOverlay=wr,e.TileLayer=Rr,e.Tooltip=Tr,e.Transformation=W,e.Util=T,e.VideoOverlay=br,e.bind=i,e.bounds=z,e.canvas=Br,e.circle=tr,e.circleMarker=Qn,e.control=nn,e.divIcon=Ar,e.extend=n,e.featureGroup=Vn,e.geoJSON=mr,e.geoJson=gr,e.gridLayer=Ir,e.icon=Wn,e.imageOverlay=yr,e.latLng=$,e.latLngBounds=B,e.layerGroup=qn,e.map=en,e.marker=Xn,e.point=N,e.polygon=ar,e.polyline=rr,e.popup=Cr,e.rectangle=Wr,e.setOptions=f,e.stamp=o,e.svg=Vr,e.svgOverlay=kr,e.tileLayer=Or,e.tooltip=Er,e.transformation=G,e.version=t,e.videoOverlay=xr;var ti=window.L;e.noConflict=function(){return window.L=ti,this},window.L=e}(t)},4235:function(e,t,n){var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var a={compressToBase64:function(e){if(null==e)return"";var n=a._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:a._decompress(e.length,32,(function(n){return i(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":a._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:a._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=a.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var o=t.charCodeAt(r);n[2*r]=o>>>8,n[2*r+1]=o%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return a.decompress(t);for(var n=new Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var o=[];return n.forEach((function(t){o.push(e(t))})),a.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),a._decompress(e.length,32,(function(t){return i(n,e.charAt(t))})))},compress:function(t){return a._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var r,i,a,o={},s={},u="",l="",c="",h=2,d=3,f=2,p=[],v=0,m=0;for(a=0;a<e.length;a+=1)if(u=e.charAt(a),Object.prototype.hasOwnProperty.call(o,u)||(o[u]=d++,s[u]=!0),l=c+u,Object.prototype.hasOwnProperty.call(o,l))c=l;else{if(Object.prototype.hasOwnProperty.call(s,c)){if(c.charCodeAt(0)<256){for(r=0;r<f;r++)v<<=1,m==t-1?(m=0,p.push(n(v)),v=0):m++;for(i=c.charCodeAt(0),r=0;r<8;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1}else{for(i=1,r=0;r<f;r++)v=v<<1|i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i=0;for(i=c.charCodeAt(0),r=0;r<16;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1}0==--h&&(h=Math.pow(2,f),f++),delete s[c]}else for(i=o[c],r=0;r<f;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1;0==--h&&(h=Math.pow(2,f),f++),o[l]=d++,c=String(u)}if(""!==c){if(Object.prototype.hasOwnProperty.call(s,c)){if(c.charCodeAt(0)<256){for(r=0;r<f;r++)v<<=1,m==t-1?(m=0,p.push(n(v)),v=0):m++;for(i=c.charCodeAt(0),r=0;r<8;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1}else{for(i=1,r=0;r<f;r++)v=v<<1|i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i=0;for(i=c.charCodeAt(0),r=0;r<16;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1}0==--h&&(h=Math.pow(2,f),f++),delete s[c]}else for(i=o[c],r=0;r<f;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(i=2,r=0;r<f;r++)v=v<<1|1&i,m==t-1?(m=0,p.push(n(v)),v=0):m++,i>>=1;for(;;){if(v<<=1,m==t-1){p.push(n(v));break}m++}return p.join("")},decompress:function(e){return null==e?"":""==e?null:a._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,r){var i,a,o,s,u,l,c,h=[],d=4,f=4,p=3,v="",m=[],g={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)h[i]=i;for(o=0,u=Math.pow(2,2),l=1;l!=u;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),o|=(s>0?1:0)*l,l<<=1;switch(o){case 0:for(o=0,u=Math.pow(2,8),l=1;l!=u;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),o|=(s>0?1:0)*l,l<<=1;c=e(o);break;case 1:for(o=0,u=Math.pow(2,16),l=1;l!=u;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),o|=(s>0?1:0)*l,l<<=1;c=e(o);break;case 2:return""}for(h[3]=c,a=c,m.push(c);;){if(g.index>t)return"";for(o=0,u=Math.pow(2,p),l=1;l!=u;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),o|=(s>0?1:0)*l,l<<=1;switch(c=o){case 0:for(o=0,u=Math.pow(2,8),l=1;l!=u;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),o|=(s>0?1:0)*l,l<<=1;h[f++]=e(o),c=f-1,d--;break;case 1:for(o=0,u=Math.pow(2,16),l=1;l!=u;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),o|=(s>0?1:0)*l,l<<=1;h[f++]=e(o),c=f-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,p),p++),h[c])v=h[c];else{if(c!==f)return null;v=a+a.charAt(0)}m.push(v),h[f++]=a+v.charAt(0),a=v,0==--d&&(d=Math.pow(2,p),p++)}}};return a}();void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)},216:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.printIteratorEntries=function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:": ",s="",u=e.next();if(!u.done){s+=t.spacingOuter;for(var l=n+t.indent;!u.done;){var c=a(u.value[0],t,l,r,i),h=a(u.value[1],t,l,r,i);s+=l+c+o+h,(u=e.next()).done?t.min||(s+=","):s+=","+t.spacingInner}s+=t.spacingOuter+n}return s},t.printIteratorValues=function(e,t,n,r,i,a){var o="",s=e.next();if(!s.done){o+=t.spacingOuter;for(var u=n+t.indent;!s.done;)o+=u+a(s.value,t,u,r,i),(s=e.next()).done?t.min||(o+=","):o+=","+t.spacingInner;o+=t.spacingOuter+n}return o},t.printListItems=function(e,t,n,r,i,a){var o="";if(e.length){o+=t.spacingOuter;for(var s=n+t.indent,u=0;u<e.length;u++)o+=s,u in e&&(o+=a(e[u],t,s,r,i)),u<e.length-1?o+=","+t.spacingInner:t.min||(o+=",");o+=t.spacingOuter+n}return o},t.printObjectProperties=function(e,t,n,r,i,a){var o="",s=function(e,t){var n=Object.keys(e).sort(t);Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach((function(t){Object.getOwnPropertyDescriptor(e,t).enumerable&&n.push(t)}));return n}(e,t.compareKeys);if(s.length){o+=t.spacingOuter;for(var u=n+t.indent,l=0;l<s.length;l++){var c=s[l],h=a(c,t,u,r,i),d=a(e[c],t,u,r,i);o+=u+h+": "+d,l<s.length-1?o+=","+t.spacingInner:t.min||(o+=",")}o+=t.spacingOuter+n}return o}},7220:function(e,t,n){"use strict";var r=n(9728).default,i=n(6690).default,a=n(1655).default,o=n(6389).default,s=n(3496).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.DEFAULT_OPTIONS=void 0,t.format=q,t.plugins=void 0;var u=g(n(4348)),l=n(216),c=g(n(6406)),h=g(n(4157)),d=g(n(5882)),f=g(n(9593)),p=g(n(2979)),v=g(n(4260)),m=g(n(3591));function g(e){return e&&e.__esModule?e:{default:e}}var _=Object.prototype.toString,y=Date.prototype.toISOString,b=Error.prototype.toString,x=RegExp.prototype.toString,w=function(e){return"function"===typeof e.constructor&&e.constructor.name||"Object"},k=/^Symbol\((.*)\)(.*)$/,S=/\n/gi,M=function(e){a(n,e);var t=o(n);function n(e,r){var a;return i(this,n),(a=t.call(this,e)).stack=r,a.name=a.constructor.name,a}return r(n)}(s(Error));function C(e,t){return t?"[Function "+(e.name||"anonymous")+"]":"[Function]"}function T(e){return String(e).replace(k,"Symbol($1)")}function E(e){return"["+b.call(e)+"]"}function P(e,t,n,r){if(!0===e||!1===e)return""+e;if(void 0===e)return"undefined";if(null===e)return"null";var i=typeof e;if("number"===i)return function(e){return Object.is(e,-0)?"-0":String(e)}(e);if("bigint"===i)return function(e){return String("".concat(e,"n"))}(e);if("string"===i)return r?'"'+e.replace(/"|\\/g,"\\$&")+'"':'"'+e+'"';if("function"===i)return C(e,t);if("symbol"===i)return T(e);var a=_.call(e);return"[object WeakMap]"===a?"WeakMap {}":"[object WeakSet]"===a?"WeakSet {}":"[object Function]"===a||"[object GeneratorFunction]"===a?C(e,t):"[object Symbol]"===a?T(e):"[object Date]"===a?isNaN(+e)?"Date { NaN }":y.call(e):"[object Error]"===a?E(e):"[object RegExp]"===a?n?x.call(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"):x.call(e):e instanceof Error?E(e):null}function A(e,t,n,r,i,a){if(-1!==i.indexOf(e))return"[Circular]";(i=i.slice()).push(e);var o=++r>t.maxDepth,s=t.min;if(t.callToJSON&&!o&&e.toJSON&&"function"===typeof e.toJSON&&!a)return R(e.toJSON(),t,n,r,i,!0);var u=_.call(e);return"[object Arguments]"===u?o?"[Arguments]":(s?"":"Arguments ")+"["+(0,l.printListItems)(e,t,n,r,i,R)+"]":function(e){return"[object Array]"===e||"[object ArrayBuffer]"===e||"[object DataView]"===e||"[object Float32Array]"===e||"[object Float64Array]"===e||"[object Int8Array]"===e||"[object Int16Array]"===e||"[object Int32Array]"===e||"[object Uint8Array]"===e||"[object Uint8ClampedArray]"===e||"[object Uint16Array]"===e||"[object Uint32Array]"===e}(u)?o?"["+e.constructor.name+"]":(s?"":t.printBasicPrototype||"Array"!==e.constructor.name?e.constructor.name+" ":"")+"["+(0,l.printListItems)(e,t,n,r,i,R)+"]":"[object Map]"===u?o?"[Map]":"Map {"+(0,l.printIteratorEntries)(e.entries(),t,n,r,i,R," => ")+"}":"[object Set]"===u?o?"[Set]":"Set {"+(0,l.printIteratorValues)(e.values(),t,n,r,i,R)+"}":o||function(e){return"undefined"!==typeof window&&e===window}(e)?"["+w(e)+"]":(s?"":t.printBasicPrototype||"Object"!==w(e)?w(e)+" ":"")+"{"+(0,l.printObjectProperties)(e,t,n,r,i,R)+"}"}function L(e,t,n,r,i,a){var o;try{o=function(e){return null!=e.serialize}(e)?e.serialize(t,n,r,i,a,R):e.print(t,(function(e){return R(e,n,r,i,a)}),(function(e){var t=r+n.indent;return t+e.replace(S,"\n"+t)}),{edgeSpacing:n.spacingOuter,min:n.min,spacing:n.spacingInner},n.colors)}catch(s){throw new M(s.message,s.stack)}if("string"!==typeof o)throw new Error('pretty-format: Plugin must return type "string" but instead returned "'.concat(typeof o,'".'));return o}function I(e,t){for(var n=0;n<e.length;n++)try{if(e[n].test(t))return e[n]}catch(r){throw new M(r.message,r.stack)}return null}function R(e,t,n,r,i,a){var o=I(t.plugins,e);if(null!==o)return L(o,e,t,n,r,i);var s=P(e,t.printFunctionName,t.escapeRegex,t.escapeString);return null!==s?s:A(e,t,n,r,i,a)}var O={comment:"gray",content:"reset",prop:"yellow",tag:"cyan",value:"green"},N=Object.keys(O),D={callToJSON:!0,compareKeys:void 0,escapeRegex:!1,escapeString:!0,highlight:!1,indent:2,maxDepth:1/0,min:!1,plugins:[],printBasicPrototype:!0,printFunctionName:!0,theme:O};t.DEFAULT_OPTIONS=D;var z=function(e){return N.reduce((function(t,n){var r=e.theme&&void 0!==e.theme[n]?e.theme[n]:O[n],i=r&&u.default[r];if(!i||"string"!==typeof i.close||"string"!==typeof i.open)throw new Error('pretty-format: Option "theme" has a key "'.concat(n,'" whose value "').concat(r,'" is undefined in ansi-styles.'));return t[n]=i,t}),Object.create(null))},j=function(e){return e&&void 0!==e.printFunctionName?e.printFunctionName:D.printFunctionName},B=function(e){return e&&void 0!==e.escapeRegex?e.escapeRegex:D.escapeRegex},F=function(e){return e&&void 0!==e.escapeString?e.escapeString:D.escapeString},$=function(e){var t,n;return{callToJSON:e&&void 0!==e.callToJSON?e.callToJSON:D.callToJSON,colors:e&&e.highlight?z(e):N.reduce((function(e,t){return e[t]={close:"",open:""},e}),Object.create(null)),compareKeys:e&&"function"===typeof e.compareKeys?e.compareKeys:D.compareKeys,escapeRegex:B(e),escapeString:F(e),indent:e&&e.min?"":(n=e&&void 0!==e.indent?e.indent:D.indent,new Array(n+1).join(" ")),maxDepth:e&&void 0!==e.maxDepth?e.maxDepth:D.maxDepth,min:e&&void 0!==e.min?e.min:D.min,plugins:e&&void 0!==e.plugins?e.plugins:D.plugins,printBasicPrototype:null===(t=null===e||void 0===e?void 0:e.printBasicPrototype)||void 0===t||t,printFunctionName:j(e),spacingInner:e&&e.min?" ":"\n",spacingOuter:e&&e.min?"":"\n"}};function q(e,t){if(t&&(function(e){if(Object.keys(e).forEach((function(e){if(!D.hasOwnProperty(e))throw new Error('pretty-format: Unknown option "'.concat(e,'".'))})),e.min&&void 0!==e.indent&&0!==e.indent)throw new Error('pretty-format: Options "min" and "indent" cannot be used together.');if(void 0!==e.theme){if(null===e.theme)throw new Error('pretty-format: Option "theme" must not be null.');if("object"!==typeof e.theme)throw new Error('pretty-format: Option "theme" must be of type "object" but instead received "'.concat(typeof e.theme,'".'))}}(t),t.plugins)){var n=I(t.plugins,e);if(null!==n)return L(n,e,$(t),"",0,[])}var r=P(e,j(t),B(t),F(t));return null!==r?r:A(e,$(t),"",0,[])}var U={AsymmetricMatcher:c.default,ConvertAnsi:h.default,DOMCollection:d.default,DOMElement:f.default,Immutable:p.default,ReactElement:v.default,ReactTestComponent:m.default};t.plugins=U;var V=q;t.default=V},6406:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var r=n(216),i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof i?i:"undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")(),a=i["jest-symbol-do-not-touch"]||i.Symbol,o="function"===typeof a&&a.for?a.for("jest.asymmetricMatcher"):1267621,s=" ",u=function(e,t,n,i,a,o){var u=e.toString();return"ArrayContaining"===u||"ArrayNotContaining"===u?++i>t.maxDepth?"["+u+"]":u+s+"["+(0,r.printListItems)(e.sample,t,n,i,a,o)+"]":"ObjectContaining"===u||"ObjectNotContaining"===u?++i>t.maxDepth?"["+u+"]":u+s+"{"+(0,r.printObjectProperties)(e.sample,t,n,i,a,o)+"}":"StringMatching"===u||"StringNotMatching"===u||"StringContaining"===u||"StringNotContaining"===u?u+s+o(e.sample,t,n,i,a):e.toAsymmetricMatcher()};t.serialize=u;var l=function(e){return e&&e.$$typeof===o};t.test=l;var c={serialize:u,test:l};t.default=c},4157:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var r=a(n(5442)),i=a(n(4348));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(e){return"string"===typeof e&&!!e.match((0,r.default)())};t.test=o;var s=function(e,t,n,a,o,s){return s(e.replace((0,r.default)(),(function(e){switch(e){case i.default.red.close:case i.default.green.close:case i.default.cyan.close:case i.default.gray.close:case i.default.white.close:case i.default.yellow.close:case i.default.bgRed.close:case i.default.bgGreen.close:case i.default.bgYellow.close:case i.default.inverse.close:case i.default.dim.close:case i.default.bold.close:case i.default.reset.open:case i.default.reset.close:return"</>";case i.default.red.open:return"<red>";case i.default.green.open:return"<green>";case i.default.cyan.open:return"<cyan>";case i.default.gray.open:return"<gray>";case i.default.white.open:return"<white>";case i.default.yellow.open:return"<yellow>";case i.default.bgRed.open:return"<bgRed>";case i.default.bgGreen.open:return"<bgGreen>";case i.default.bgYellow.open:return"<bgYellow>";case i.default.inverse.open:return"<inverse>";case i.default.dim.open:return"<dim>";case i.default.bold.open:return"<bold>";default:return""}})),t,n,a,o)};t.serialize=s;var u={serialize:s,test:o};t.default=u},5882:function(e,t,n){"use strict";var r=n(2122).default;Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var i=n(216),a=["DOMStringMap","NamedNodeMap"],o=/^(HTML\w*Collection|NodeList)$/,s=function(e){return e&&e.constructor&&!!e.constructor.name&&(t=e.constructor.name,-1!==a.indexOf(t)||o.test(t));var t};t.test=s;var u=function(e,t,n,o,s,u){var l=e.constructor.name;return++o>t.maxDepth?"["+l+"]":(t.min?"":l+" ")+(-1!==a.indexOf(l)?"{"+(0,i.printObjectProperties)(function(e){return"NamedNodeMap"===e.constructor.name}(e)?Array.from(e).reduce((function(e,t){return e[t.name]=t.value,e}),{}):r({},e),t,n,o,s,u)+"}":"["+(0,i.printListItems)(Array.from(e),t,n,o,s,u)+"]")};t.serialize=u;var l={serialize:u,test:s};t.default=l},9593:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var r=n(9355),i=/^((HTML|SVG)\w*)?Element$/,a=function(e){var t;return(null===e||void 0===e||null===(t=e.constructor)||void 0===t?void 0:t.name)&&function(e){var t=e.constructor.name,n=e.nodeType,r=e.tagName,a="string"===typeof r&&r.includes("-")||function(e){try{return"function"===typeof e.hasAttribute&&e.hasAttribute("is")}catch(t){return!1}}(e);return 1===n&&(i.test(t)||a)||3===n&&"Text"===t||8===n&&"Comment"===t||11===n&&"DocumentFragment"===t}(e)};function o(e){return 11===e.nodeType}t.test=a;var s=function(e,t,n,i,a,s){if(function(e){return 3===e.nodeType}(e))return(0,r.printText)(e.data,t);if(function(e){return 8===e.nodeType}(e))return(0,r.printComment)(e.data,t);var u=o(e)?"DocumentFragment":e.tagName.toLowerCase();return++i>t.maxDepth?(0,r.printElementAsLeaf)(u,t):(0,r.printElement)(u,(0,r.printProps)(o(e)?[]:Array.from(e.attributes).map((function(e){return e.name})).sort(),o(e)?{}:Array.from(e.attributes).reduce((function(e,t){return e[t.name]=t.value,e}),{}),t,n+t.indent,i,a,s),(0,r.printChildren)(Array.prototype.slice.call(e.childNodes||e.children),t,n+t.indent,i,a,s),t,n)};t.serialize=s;var u={serialize:s,test:a};t.default=u},2979:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var r=n(216),i="@@__IMMUTABLE_ORDERED__@@",a=function(e){return"Immutable."+e},o=function(e){return"["+e+"]"},s=" ";var u=function(e,t,n,i,u,l,c){return++i>t.maxDepth?o(a(c)):a(c)+s+"["+(0,r.printIteratorValues)(e.values(),t,n,i,u,l)+"]"},l=function(e,t,n,l,c,h){return e["@@__IMMUTABLE_MAP__@@"]?function(e,t,n,i,u,l,c){return++i>t.maxDepth?o(a(c)):a(c)+s+"{"+(0,r.printIteratorEntries)(e.entries(),t,n,i,u,l)+"}"}(e,t,n,l,c,h,e[i]?"OrderedMap":"Map"):e["@@__IMMUTABLE_LIST__@@"]?u(e,t,n,l,c,h,"List"):e["@@__IMMUTABLE_SET__@@"]?u(e,t,n,l,c,h,e[i]?"OrderedSet":"Set"):e["@@__IMMUTABLE_STACK__@@"]?u(e,t,n,l,c,h,"Stack"):e["@@__IMMUTABLE_SEQ__@@"]?function(e,t,n,i,u,l){var c=a("Seq");return++i>t.maxDepth?o(c):e["@@__IMMUTABLE_KEYED__@@"]?c+s+"{"+(e._iter||e._object?(0,r.printIteratorEntries)(e.entries(),t,n,i,u,l):"\u2026")+"}":c+s+"["+(e._iter||e._array||e._collection||e._iterable?(0,r.printIteratorValues)(e.values(),t,n,i,u,l):"\u2026")+"]"}(e,t,n,l,c,h):function(e,t,n,i,u,l){var c=a(e._name||"Record");return++i>t.maxDepth?o(c):c+s+"{"+(0,r.printIteratorEntries)(function(e){var t=0;return{next:function(){if(t<e._keys.length){var n=e._keys[t++];return{done:!1,value:[n,e.get(n)]}}return{done:!0,value:void 0}}}}(e),t,n,i,u,l)+"}"}(e,t,n,l,c,h)};t.serialize=l;var c=function(e){return e&&(!0===e["@@__IMMUTABLE_ITERABLE__@@"]||!0===e["@@__IMMUTABLE_RECORD__@@"])};t.test=c;var h={serialize:l,test:c};t.default=h},4260:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(7441)),i=n(9355);function a(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}var o=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(t)?t.forEach((function(t){e(t,n)})):null!=t&&!1!==t&&n.push(t),n},s=function(e){var t=e.type;if("string"===typeof t)return t;if("function"===typeof t)return t.displayName||t.name||"Unknown";if(r.isFragment(e))return"React.Fragment";if(r.isSuspense(e))return"React.Suspense";if("object"===typeof t&&null!==t){if(r.isContextProvider(e))return"Context.Provider";if(r.isContextConsumer(e))return"Context.Consumer";if(r.isForwardRef(e)){if(t.displayName)return t.displayName;var n=t.render.displayName||t.render.name||"";return""!==n?"ForwardRef("+n+")":"ForwardRef"}if(r.isMemo(e)){var i=t.displayName||t.type.displayName||t.type.name||"";return""!==i?"Memo("+i+")":"Memo"}}return"UNDEFINED"},u=function(e,t,n,r,a,u){return++r>t.maxDepth?(0,i.printElementAsLeaf)(s(e),t):(0,i.printElement)(s(e),(0,i.printProps)(function(e){var t=e.props;return Object.keys(t).filter((function(e){return"children"!==e&&void 0!==t[e]})).sort()}(e),e.props,t,n+t.indent,r,a,u),(0,i.printChildren)(o(e.props.children),t,n+t.indent,r,a,u),t,n)};t.serialize=u;var l=function(e){return null!=e&&r.isElement(e)};t.test=l;var c={serialize:u,test:l};t.default=c},3591:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.serialize=t.default=void 0;var r=n(9355),i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof i?i:"undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")(),a=i["jest-symbol-do-not-touch"]||i.Symbol,o="function"===typeof a&&a.for?a.for("react.test.json"):245830487,s=function(e,t,n,i,a,o){return++i>t.maxDepth?(0,r.printElementAsLeaf)(e.type,t):(0,r.printElement)(e.type,e.props?(0,r.printProps)(function(e){var t=e.props;return t?Object.keys(t).filter((function(e){return void 0!==t[e]})).sort():[]}(e),e.props,t,n+t.indent,i,a,o):"",e.children?(0,r.printChildren)(e.children,t,n+t.indent,i,a,o):"",t,n)};t.serialize=s;var u=function(e){return e&&e.$$typeof===o};t.test=u;var l={serialize:s,test:u};t.default=l},2109:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}},9355:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.printText=t.printProps=t.printElementAsLeaf=t.printElement=t.printComment=t.printChildren=void 0;var r,i=(r=n(2109))&&r.__esModule?r:{default:r};t.printProps=function(e,t,n,r,i,a,o){var s=r+n.indent,u=n.colors;return e.map((function(e){var l=t[e],c=o(l,n,s,i,a);return"string"!==typeof l&&(-1!==c.indexOf("\n")&&(c=n.spacingOuter+s+c+n.spacingOuter+r),c="{"+c+"}"),n.spacingInner+r+u.prop.open+e+u.prop.close+"="+u.value.open+c+u.value.close})).join("")};t.printChildren=function(e,t,n,r,i,o){return e.map((function(e){return t.spacingOuter+n+("string"===typeof e?a(e,t):o(e,t,n,r,i))})).join("")};var a=function(e,t){var n=t.colors.content;return n.open+(0,i.default)(e)+n.close};t.printText=a;t.printComment=function(e,t){var n=t.colors.comment;return n.open+"\x3c!--"+(0,i.default)(e)+"--\x3e"+n.close};t.printElement=function(e,t,n,r,i){var a=r.colors.tag;return a.open+"<"+e+(t&&a.close+t+r.spacingOuter+i+a.open)+(n?">"+a.close+n+r.spacingOuter+i+a.open+"</"+e:(t&&!r.min?"":" ")+"/")+">"+a.close};t.printElementAsLeaf=function(e,t){var n=t.colors.tag;return n.open+"<"+e+n.close+" \u2026"+n.open+" />"+n.close}},4348:function(e,t,n){"use strict";e=n.nmd(e);var r=n(861).default,i=n(3344).default,a=n(7424).default,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return"\x1b[".concat(38+e,";5;").concat(t,"m")}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t,n,r){return"\x1b[".concat(38+e,";2;").concat(t,";").concat(n,";").concat(r,"m")}};Object.defineProperty(e,"exports",{enumerable:!0,get:function(){var e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(var n=0,u=Object.entries(t);n<u.length;n++){for(var l=a(u[n],2),c=l[0],h=l[1],d=0,f=Object.entries(h);d<f.length;d++){var p=a(f[d],2),v=p[0],m=p[1];t[v]={open:"\x1b[".concat(m[0],"m"),close:"\x1b[".concat(m[1],"m")},h[v]=t[v],e.set(m[0],m[1])}Object.defineProperty(t,c,{value:h,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=o(),t.color.ansi16m=s(),t.bgColor.ansi256=o(10),t.bgColor.ansi16m=s(10),Object.defineProperties(t,{rgbToAnsi256:{value:function(e,t,n){return e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5)},enumerable:!1},hexToRgb:{value:function(e){var t=i(/([a-f\d]{6}|[a-f\d]{3})/i,{colorString:1}).exec(e.toString(16));if(!t)return[0,0,0];var n=t.groups.colorString;3===n.length&&(n=n.split("").map((function(e){return e+e})).join(""));var r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:function(e){return t.rgbToAnsi256.apply(t,r(t.hexToRgb(e)))},enumerable:!1}}),t}})},4463:function(e,t,n){"use strict";var r=n(2791),i=n(5296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function v(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function y(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,_);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,_);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,_);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),T=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var D,z=Object.assign;function j(e){if(void 0===D)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);D=t&&t[1]||""}return"\n"+D+e}var B=!1;function F(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var u="\n"+i[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?j(e):""}function $(e){switch(e.tag){case 5:return j(e.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case k:return"Fragment";case w:return"Portal";case M:return"Profiler";case S:return"StrictMode";case P:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case L:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return q(e(t))}catch(n){}}return null}function U(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function J(e,t){K(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Z(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ce,he=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ge=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _e(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,ke=null,Se=null;function Me(e){if(e=yi(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=xi(t),we(e.stateNode,e.type,t))}}function Ce(e){ke?Se?Se.push(e):Se=[e]:ke=e}function Te(){if(ke){var e=ke,t=Se;if(Se=ke=null,Me(e),t)for(e=0;e<t.length;e++)Me(t[e])}}function Ee(e,t){return e(t)}function Pe(){}var Ae=!1;function Le(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ee(e,t,n)}finally{Ae=!1,(null!==ke||null!==Se)&&(Pe(),Te())}}function Ie(e,t){var n=e.stateNode;if(null===n)return null;var r=xi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Re=!1;if(c)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Re=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ce){Re=!1}function Ne(e,t,n,r,i,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var De=!1,ze=null,je=!1,Be=null,Fe={onError:function(e){De=!0,ze=e}};function $e(e,t,n,r,i,a,o,s,u){De=!1,ze=null,Ne.apply(Fe,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ue(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(qe(e)!==e)throw Error(a(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Ve(i),e;if(o===r)return Ve(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ge=i.unstable_scheduleCallback,Ze=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Ke=i.unstable_now,Je=i.unstable_getCurrentPriorityLevel,Qe=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var lt=64,ct=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=ht(s):0!==(a&=o)&&(r=ht(a))}else 0!==(o=n&~i)?r=ht(o):0!==a&&(r=ht(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function _t(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var yt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,kt,St,Mt,Ct=!1,Tt=[],Et=null,Pt=null,At=null,Lt=new Map,It=new Map,Rt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Dt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=yi(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function zt(e){var t=_i(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ue(n)))return e.blockedOn=t,void Mt(e.priority,(function(){kt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function jt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yi(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Bt(e,t,n){jt(e)&&n.delete(t)}function Ft(){Ct=!1,null!==Et&&jt(Et)&&(Et=null),null!==Pt&&jt(Pt)&&(Pt=null),null!==At&&jt(At)&&(At=null),Lt.forEach(Bt),It.forEach(Bt)}function $t(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ft)))}function qt(e){function t(t){return $t(t,e)}if(0<Tt.length){$t(Tt[0],e);for(var n=1;n<Tt.length;n++){var r=Tt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&$t(Et,e),null!==Pt&&$t(Pt,e),null!==At&&$t(At,e),Lt.forEach(t),It.forEach(t),n=0;n<Rt.length;n++)(r=Rt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)zt(n),null===n.blockedOn&&Rt.shift()}var Ut=b.ReactCurrentBatchConfig,Vt=!0;function Ht(e,t,n,r){var i=yt,a=Ut.transition;Ut.transition=null;try{yt=1,Gt(e,t,n,r)}finally{yt=i,Ut.transition=a}}function Wt(e,t,n,r){var i=yt,a=Ut.transition;Ut.transition=null;try{yt=4,Gt(e,t,n,r)}finally{yt=i,Ut.transition=a}}function Gt(e,t,n,r){if(Vt){var i=Yt(e,t,n,r);if(null===i)Vr(e,t,r,Zt,n),Nt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Et=Dt(Et,e,t,n,r,i),!0;case"dragenter":return Pt=Dt(Pt,e,t,n,r,i),!0;case"mouseover":return At=Dt(At,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Lt.set(a,Dt(Lt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,It.set(a,Dt(It.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var a=yi(i);if(null!==a&&xt(a),null===(a=Yt(e,t,n,r))&&Vr(e,t,r,Zt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Zt=null;function Yt(e,t,n,r){if(Zt=null,null!==(e=_i(e=xe(r))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ue(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Kt=null,Jt=null,Qt=null;function en(){if(Qt)return Qt;var e,t,n=Jt,r=n.length,i="value"in Kt?Kt.value:Kt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Qt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=an(ln),hn=z({},ln,{view:0,detail:0}),dn=an(hn),fn=z({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(fn),vn=an(z({},fn,{dataTransfer:0})),mn=an(z({},hn,{relatedTarget:0})),gn=an(z({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),_n=z({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(_n),bn=an(z({},ln,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function Mn(){return Sn}var Cn=z({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=an(Cn),En=an(z({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=an(z({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mn})),An=an(z({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ln=z({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),In=an(Ln),Rn=[9,13,27,32],On=c&&"CompositionEvent"in window,Nn=null;c&&"documentMode"in document&&(Nn=document.documentMode);var Dn=c&&"TextEvent"in window&&!Nn,zn=c&&(!On||Nn&&8<Nn&&11>=Nn),jn=String.fromCharCode(32),Bn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $n(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Un[e.type]:"textarea"===t}function Hn(e,t,n,r){Ce(r),0<(t=Wr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Gn=null;function Zn(e){jr(e,0)}function Yn(e){if(G(bi(e)))return e}function Xn(e,t){if("change"===e)return t}var Kn=!1;if(c){var Jn;if(c){var Qn="oninput"in document;if(!Qn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Qn="function"===typeof er.oninput}Jn=Qn}else Jn=!1;Kn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Gn=Wn=null)}function nr(e){if("value"===e.propertyName&&Yn(Gn)){var t=[];Hn(t,Gn,e,xe(e)),Le(Zn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Gn)}function ar(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Z((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=cr(n,a);var o=cr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=c&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,_r=null,yr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==mr||mr!==Z(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},_r&&ur(_r,r)||(_r=r,0<(r=Wr(gr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},kr={},Sr={};function Mr(e){if(kr[e])return kr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return kr[e]=n[t];return e}c&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Cr=Mr("animationend"),Tr=Mr("animationiteration"),Er=Mr("animationstart"),Pr=Mr("transitionend"),Ar=new Map,Lr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ir(e,t){Ar.set(e,t),u(t,[e])}for(var Rr=0;Rr<Lr.length;Rr++){var Or=Lr[Rr];Ir(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Ir(Cr,"onAnimationEnd"),Ir(Tr,"onAnimationIteration"),Ir(Er,"onAnimationStart"),Ir("dblclick","onDoubleClick"),Ir("focusin","onFocus"),Ir("focusout","onBlur"),Ir(Pr,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function zr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,u,l){if($e.apply(this,arguments),De){if(!De)throw Error(a(198));var c=ze;De=!1,ze=null,je||(je=!0,Be=c)}}(r,t,void 0,e),e.currentTarget=null}function jr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&i.isPropagationStopped())break e;zr(i,s,l),a=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,l=s.currentTarget,s=s.listener,u!==a&&i.isPropagationStopped())break e;zr(i,s,l),a=u}}}if(je)throw e=Be,je=!1,Be=null,e}function Br(e,t){var n=t[vi];void 0===n&&(n=t[vi]=new Set);var r=e+"__bubble";n.has(r)||(Ur(t,e,2,!1),n.add(r))}function Fr(e,t,n){var r=0;t&&(r|=4),Ur(n,e,r,t)}var $r="_reactListening"+Math.random().toString(36).slice(2);function qr(e){if(!e[$r]){e[$r]=!0,o.forEach((function(t){"selectionchange"!==t&&(Dr.has(t)||Fr(t,!1,e),Fr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[$r]||(t[$r]=!0,Fr("selectionchange",!1,t))}}function Ur(e,t,n,r){switch(Xt(t)){case 1:var i=Ht;break;case 4:i=Wt;break;default:i=Gt}n=i.bind(null,t,n,e),i=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=_i(s)))return;if(5===(u=o.tag)||6===u){r=a=o;continue e}s=s.parentNode}}r=r.return}Le((function(){var r=a,i=xe(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var u=cn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Tn;break;case"focusin":l="focus",u=mn;break;case"focusout":l="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Pn;break;case Cr:case Tr:case Er:u=gn;break;case Pr:u=An;break;case"scroll":u=dn;break;case"wheel":u=In;break;case"copy":case"cut":case"paste":u=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=En}var c=0!==(4&t),h=!c&&"scroll"===e,d=c?null!==s?s+"Capture":null:s;c=[];for(var f,p=r;null!==p;){var v=(f=p).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==d&&(null!=(v=Ie(p,d))&&c.push(Hr(p,v,f)))),h)break;p=p.return}0<c.length&&(s=new u(s,l,null,n,i),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(l=n.relatedTarget||n.fromElement)||!_i(l)&&!l[pi])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?_i(l):null)&&(l!==(h=qe(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=pn,v="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=En,v="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==u?s:bi(u),f=null==l?s:bi(l),(s=new c(v,p+"leave",u,n,i)).target=h,s.relatedTarget=f,v=null,_i(i)===r&&((c=new c(d,p+"enter",l,n,i)).target=f,c.relatedTarget=h,v=c),h=v,u&&l)e:{for(d=l,p=0,f=c=u;f;f=Gr(f))p++;for(f=0,v=d;v;v=Gr(v))f++;for(;0<p-f;)c=Gr(c),p--;for(;0<f-p;)d=Gr(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=Gr(c),d=Gr(d)}c=null}else c=null;null!==u&&Zr(o,s,u,c,!1),null!==l&&null!==h&&Zr(o,h,l,c,!0)}if("select"===(u=(s=r?bi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Xn;else if(Vn(s))if(Kn)m=or;else{m=ir;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ar);switch(m&&(m=m(e,r))?Hn(o,m,n,i):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?bi(r):window,e){case"focusin":(Vn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,_r=null);break;case"focusout":_r=gr=mr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,br(o,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":br(o,n,i)}var _;if(On)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else qn?Fn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(zn&&"ko"!==n.locale&&(qn||"onCompositionStart"!==y?"onCompositionEnd"===y&&qn&&(_=en()):(Jt="value"in(Kt=i)?Kt.value:Kt.textContent,qn=!0)),0<(g=Wr(r,y)).length&&(y=new bn(y,e,null,n,i),o.push({event:y,listeners:g}),_?y.data=_:null!==(_=$n(n))&&(y.data=_))),(_=Dn?function(e,t){switch(e){case"compositionend":return $n(t);case"keypress":return 32!==t.which?null:(Bn=!0,jn);case"textInput":return(e=t.data)===jn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!On&&Fn(e,t)?(e=en(),Qt=Jt=Kt=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=_))}jr(o,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Ie(e,n))&&r.unshift(Hr(e,a,i)),null!=(a=Ie(e,t))&&r.push(Hr(e,a,i))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==l&&(s=l,i?null!=(u=Ie(n,a))&&o.unshift(Hr(n,u,s)):i||null!=(u=Ie(n,a))&&o.push(Hr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Kr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Xr,"")}function Jr(e,t,n){if(t=Kr(t),Kr(e)!==t&&n)throw Error(a(425))}function Qr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,oi="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout((function(){throw e}))}function ui(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void qt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);qt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ci(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,fi="__reactProps$"+hi,pi="__reactContainer$"+hi,vi="__reactEvents$"+hi,mi="__reactListeners$"+hi,gi="__reactHandles$"+hi;function _i(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ci(e);null!==e;){if(n=e[di])return n;e=ci(e)}return t}n=(e=n).parentNode}return null}function yi(e){return!(e=e[di]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function xi(e){return e[fi]||null}var wi=[],ki=-1;function Si(e){return{current:e}}function Mi(e){0>ki||(e.current=wi[ki],wi[ki]=null,ki--)}function Ci(e,t){ki++,wi[ki]=e.current,e.current=t}var Ti={},Ei=Si(Ti),Pi=Si(!1),Ai=Ti;function Li(e,t){var n=e.type.contextTypes;if(!n)return Ti;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ii(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ri(){Mi(Pi),Mi(Ei)}function Oi(e,t,n){if(Ei.current!==Ti)throw Error(a(168));Ci(Ei,t),Ci(Pi,n)}function Ni(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,U(e)||"Unknown",i));return z({},n,r)}function Di(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ti,Ai=Ei.current,Ci(Ei,e),Ci(Pi,Pi.current),!0}function zi(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Ni(e,t,Ai),r.__reactInternalMemoizedMergedChildContext=e,Mi(Pi),Mi(Ei),Ci(Ei,e)):Mi(Pi),Ci(Pi,n)}var ji=null,Bi=!1,Fi=!1;function $i(e){null===ji?ji=[e]:ji.push(e)}function qi(){if(!Fi&&null!==ji){Fi=!0;var e=0,t=yt;try{var n=ji;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}ji=null,Bi=!1}catch(i){throw null!==ji&&(ji=ji.slice(e+1)),Ge(Qe,qi),i}finally{yt=t,Fi=!1}}return null}var Ui=[],Vi=0,Hi=null,Wi=0,Gi=[],Zi=0,Yi=null,Xi=1,Ki="";function Ji(e,t){Ui[Vi++]=Wi,Ui[Vi++]=Hi,Hi=e,Wi=t}function Qi(e,t,n){Gi[Zi++]=Xi,Gi[Zi++]=Ki,Gi[Zi++]=Yi,Yi=e;var r=Xi;e=Ki;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var a=32-ot(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Xi=1<<32-ot(t)+i|n<<i|r,Ki=a+e}else Xi=1<<a|n<<i|r,Ki=e}function ea(e){null!==e.return&&(Ji(e,1),Qi(e,1,0))}function ta(e){for(;e===Hi;)Hi=Ui[--Vi],Ui[Vi]=null,Wi=Ui[--Vi],Ui[Vi]=null;for(;e===Yi;)Yi=Gi[--Zi],Gi[Zi]=null,Ki=Gi[--Zi],Gi[Zi]=null,Xi=Gi[--Zi],Gi[Zi]=null}var na=null,ra=null,ia=!1,aa=null;function oa(e,t){var n=Ll(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yi?{id:Xi,overflow:Ki}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ll(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function ua(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function la(e){if(ia){var t=ra;if(t){var n=t;if(!sa(e,t)){if(ua(e))throw Error(a(418));t=li(n.nextSibling);var r=na;t&&sa(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(ua(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function ca(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ha(e){if(e!==na)return!1;if(!ia)return ca(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(ua(e))throw da(),Error(a(418));for(;t;)oa(e,t),t=li(t.nextSibling)}if(ca(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?li(e.stateNode.nextSibling):null;return!0}function da(){for(var e=ra;e;)e=li(e.nextSibling)}function fa(){ra=na=null,ia=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var va=b.ReactCurrentBatchConfig;function ma(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ga=Si(null),_a=null,ya=null,ba=null;function xa(){ba=ya=_a=null}function wa(e){var t=ga.current;Mi(ga),e._currentValue=t}function ka(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Sa(e,t){_a=e,ba=ya=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Ma(e){var t=e._currentValue;if(ba!==e)if(e={context:e,memoizedValue:t,next:null},null===ya){if(null===_a)throw Error(a(308));ya=e,_a.dependencies={lanes:0,firstContext:e}}else ya=ya.next=e;return t}var Ca=null;function Ta(e){null===Ca?Ca=[e]:Ca.push(e)}function Ea(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ta(t)):(n.next=i.next,i.next=n),t.interleaved=n,Pa(e,r)}function Pa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Aa=!1;function La(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ia(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ra(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Eu)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Pa(e,n)}return null===(i=r.interleaved)?(t.next=t,Ta(r)):(t.next=i.next,i.next=t),r.interleaved=t,Pa(e,n)}function Na(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,_t(e,n)}}function Da(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function za(e,t,n,r){var i=e.updateQueue;Aa=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var u=s,l=u.next;u.next=null,null===o?a=l:o.next=l,o=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var h=i.baseState;for(o=0,c=l=u=null,s=a;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==c&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(d=t,f=n,v.tag){case 1:if("function"===typeof(p=v.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=v.payload)?p.call(f,h,d):p)||void 0===d)break e;h=z({},h,d);break e;case 2:Aa=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=f,u=h):c=c.next=f,o|=d;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(d=s).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===c&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Du|=o,e.lanes=o,e.memoizedState=h}}function ja(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var Ba=(new r.Component).refs;function Fa(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var $a={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),a=Ra(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(nl(t,e,i,r),Na(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),a=Ra(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(nl(t,e,i,r),Na(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),r=tl(e),i=Ra(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Oa(e,i,r))&&(nl(t,e,r,n),Na(t,e,r))}};function qa(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,a))}function Ua(e,t,n){var r=!1,i=Ti,a=t.contextType;return"object"===typeof a&&null!==a?a=Ma(a):(i=Ii(t)?Ai:Ei.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Li(e,i):Ti),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=$a,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Va(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&$a.enqueueReplaceState(t,t.state,null)}function Ha(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Ba,La(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Ma(a):(a=Ii(t)?Ai:Ei.current,i.context=Li(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(Fa(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&$a.enqueueReplaceState(i,i.state,null),za(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Wa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;t===Ba&&(t=i.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ga(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Za(e){return(0,e._init)(e._payload)}function Ya(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Rl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=zl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===k?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===I&&Za(a)===t.type)?((r=i(t,n.props)).ref=Wa(e,t,n),r.return=e,r):((r=Ol(n.type,n.key,n.props,null,e.mode,r)).ref=Wa(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=jl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Nl(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Ol(t.type,t.key,t.props,null,e.mode,n)).ref=Wa(e,null,t),n.return=e,n;case w:return(t=jl(t,e.mode,n)).return=e,t;case I:return d(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Nl(t,e.mode,n,null)).return=e,t;Ga(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?l(e,t,n,r):null;case w:return n.key===i?c(e,t,n,r):null;case I:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||N(n))return null!==i?null:h(e,t,n,r,null);Ga(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case I:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||N(r))return h(t,e=e.get(n)||null,r,i,null);Ga(t,r)}return null}function v(i,a,s,u){for(var l=null,c=null,h=a,v=a=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=f(i,h,s[v],u);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(i,h),a=o(g,a,v),null===c?l=g:c.sibling=g,c=g,h=m}if(v===s.length)return n(i,h),ia&&Ji(i,v),l;if(null===h){for(;v<s.length;v++)null!==(h=d(i,s[v],u))&&(a=o(h,a,v),null===c?l=h:c.sibling=h,c=h);return ia&&Ji(i,v),l}for(h=r(i,h);v<s.length;v++)null!==(m=p(h,i,v,s[v],u))&&(e&&null!==m.alternate&&h.delete(null===m.key?v:m.key),a=o(m,a,v),null===c?l=m:c.sibling=m,c=m);return e&&h.forEach((function(e){return t(i,e)})),ia&&Ji(i,v),l}function m(i,s,u,l){var c=N(u);if("function"!==typeof c)throw Error(a(150));if(null==(u=c.call(u)))throw Error(a(151));for(var h=c=null,v=s,m=s=0,g=null,_=u.next();null!==v&&!_.done;m++,_=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var y=f(i,v,_.value,l);if(null===y){null===v&&(v=g);break}e&&v&&null===y.alternate&&t(i,v),s=o(y,s,m),null===h?c=y:h.sibling=y,h=y,v=g}if(_.done)return n(i,v),ia&&Ji(i,m),c;if(null===v){for(;!_.done;m++,_=u.next())null!==(_=d(i,_.value,l))&&(s=o(_,s,m),null===h?c=_:h.sibling=_,h=_);return ia&&Ji(i,m),c}for(v=r(i,v);!_.done;m++,_=u.next())null!==(_=p(v,i,m,_.value,l))&&(e&&null!==_.alternate&&v.delete(null===_.key?m:_.key),s=o(_,s,m),null===h?c=_:h.sibling=_,h=_);return e&&v.forEach((function(e){return t(i,e)})),ia&&Ji(i,m),c}return function e(r,a,o,u){if("object"===typeof o&&null!==o&&o.type===k&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case x:e:{for(var l=o.key,c=a;null!==c;){if(c.key===l){if((l=o.type)===k){if(7===c.tag){n(r,c.sibling),(a=i(c,o.props.children)).return=r,r=a;break e}}else if(c.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===I&&Za(l)===c.type){n(r,c.sibling),(a=i(c,o.props)).ref=Wa(r,c,o),a.return=r,r=a;break e}n(r,c);break}t(r,c),c=c.sibling}o.type===k?((a=Nl(o.props.children,r.mode,u,o.key)).return=r,r=a):((u=Ol(o.type,o.key,o.props,null,r.mode,u)).ref=Wa(r,a,o),u.return=r,r=u)}return s(r);case w:e:{for(c=o.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=jl(o,r.mode,u)).return=r,r=a}return s(r);case I:return e(r,a,(c=o._init)(o._payload),u)}if(te(o))return v(r,a,o,u);if(N(o))return m(r,a,o,u);Ga(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=zl(o,r.mode,u)).return=r,r=a),s(r)):n(r,a)}}var Xa=Ya(!0),Ka=Ya(!1),Ja={},Qa=Si(Ja),eo=Si(Ja),to=Si(Ja);function no(e){if(e===Ja)throw Error(a(174));return e}function ro(e,t){switch(Ci(to,t),Ci(eo,e),Ci(Qa,Ja),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Mi(Qa),Ci(Qa,t)}function io(){Mi(Qa),Mi(eo),Mi(to)}function ao(e){no(to.current);var t=no(Qa.current),n=ue(t,e.type);t!==n&&(Ci(eo,e),Ci(Qa,n))}function oo(e){eo.current===e&&(Mi(Qa),Mi(eo))}var so=Si(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lo=[];function co(){for(var e=0;e<lo.length;e++)lo[e]._workInProgressVersionPrimary=null;lo.length=0}var ho=b.ReactCurrentDispatcher,fo=b.ReactCurrentBatchConfig,po=0,vo=null,mo=null,go=null,_o=!1,yo=!1,bo=0,xo=0;function wo(){throw Error(a(321))}function ko(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function So(e,t,n,r,i,o){if(po=o,vo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:us,e=n(r,i),yo){o=0;do{if(yo=!1,bo=0,25<=o)throw Error(a(301));o+=1,go=mo=null,t.updateQueue=null,ho.current=ls,e=n(r,i)}while(yo)}if(ho.current=os,t=null!==mo&&null!==mo.next,po=0,go=mo=vo=null,_o=!1,t)throw Error(a(300));return e}function Mo(){var e=0!==bo;return bo=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?vo.memoizedState=go=e:go=go.next=e,go}function To(){if(null===mo){var e=vo.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===go?vo.memoizedState:go.next;if(null!==t)go=t,mo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===go?vo.memoizedState=go=e:go=go.next=e}return go}function Eo(e,t){return"function"===typeof t?t(e):t}function Po(e){var t=To(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=mo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var u=s=null,l=null,c=o;do{var h=c.lane;if((po&h)===h)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=d,s=r):l=l.next=d,vo.lanes|=h,Du|=h}c=c.next}while(null!==c&&c!==o);null===l?s=r:l.next=u,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,vo.lanes|=o,Du|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=To(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(bs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Lo(){}function Io(e,t){var n=vo,r=To(),i=t(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,bs=!0),r=r.queue,Vo(No.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Bo(9,Oo.bind(null,n,r,i,t),void 0,null),null===Pu)throw Error(a(349));0!==(30&po)||Ro(n,t,i)}return i}function Ro(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Oo(e,t,n,r){t.value=n,t.getSnapshot=r,Do(t)&&zo(e)}function No(e,t,n){return n((function(){Do(t)&&zo(e)}))}function Do(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function zo(e){var t=Pa(e,1);null!==t&&nl(t,e,1,-1)}function jo(e){var t=Co();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eo,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,vo,e),[t.memoizedState,e]}function Bo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Fo(){return To().memoizedState}function $o(e,t,n,r){var i=Co();vo.flags|=e,i.memoizedState=Bo(1|t,n,void 0,void 0===r?null:r)}function qo(e,t,n,r){var i=To();r=void 0===r?null:r;var a=void 0;if(null!==mo){var o=mo.memoizedState;if(a=o.destroy,null!==r&&ko(r,o.deps))return void(i.memoizedState=Bo(t,n,a,r))}vo.flags|=e,i.memoizedState=Bo(1|t,n,a,r)}function Uo(e,t){return $o(8390656,8,e,t)}function Vo(e,t){return qo(2048,8,e,t)}function Ho(e,t){return qo(4,2,e,t)}function Wo(e,t){return qo(4,4,e,t)}function Go(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Zo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,qo(4,4,Go.bind(null,t,e),n)}function Yo(){}function Xo(e,t){var n=To();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ko(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ko(e,t){var n=To();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ko(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Jo(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),vo.lanes|=n,Du|=n,e.baseState=!0),t)}function Qo(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{yt=n,fo.transition=r}}function es(){return To().memoizedState}function ts(e,t,n){var r=tl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))is(t,n);else if(null!==(n=Ea(e,t,n,r))){nl(n,e,r,el()),as(n,t,r)}}function ns(e,t,n){var r=tl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))is(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(i.next=i,Ta(t)):(i.next=u.next,u.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=Ea(e,t,i,r))&&(nl(n,e,r,i=el()),as(n,t,r))}}function rs(e){var t=e.alternate;return e===vo||null!==t&&t===vo}function is(e,t){yo=_o=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,_t(e,n)}}var os={readContext:Ma,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ma,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:Ma,useEffect:Uo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,$o(4194308,4,Go.bind(null,t,e),n)},useLayoutEffect:function(e,t){return $o(4194308,4,e,t)},useInsertionEffect:function(e,t){return $o(4,2,e,t)},useMemo:function(e,t){var n=Co();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Co();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,vo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:jo,useDebugValue:Yo,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=jo(!1),t=e[0];return e=Qo.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=vo,i=Co();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Pu)throw Error(a(349));0!==(30&po)||Ro(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Uo(No.bind(null,r,o,e),[e]),r.flags|=2048,Bo(9,Oo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Co(),t=Pu.identifierPrefix;if(ia){var n=Ki;t=":"+t+"R"+(n=(Xi&~(1<<32-ot(Xi)-1)).toString(32)+n),0<(n=bo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=xo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Ma,useCallback:Xo,useContext:Ma,useEffect:Vo,useImperativeHandle:Zo,useInsertionEffect:Ho,useLayoutEffect:Wo,useMemo:Ko,useReducer:Po,useRef:Fo,useState:function(){return Po(Eo)},useDebugValue:Yo,useDeferredValue:function(e){return Jo(To(),mo.memoizedState,e)},useTransition:function(){return[Po(Eo)[0],To().memoizedState]},useMutableSource:Lo,useSyncExternalStore:Io,useId:es,unstable_isNewReconciler:!1},ls={readContext:Ma,useCallback:Xo,useContext:Ma,useEffect:Vo,useImperativeHandle:Zo,useInsertionEffect:Ho,useLayoutEffect:Wo,useMemo:Ko,useReducer:Ao,useRef:Fo,useState:function(){return Ao(Eo)},useDebugValue:Yo,useDeferredValue:function(e){var t=To();return null===mo?t.memoizedState=e:Jo(t,mo.memoizedState,e)},useTransition:function(){return[Ao(Eo)[0],To().memoizedState]},useMutableSource:Lo,useSyncExternalStore:Io,useId:es,unstable_isNewReconciler:!1};function cs(e,t){try{var n="",r=t;do{n+=$(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Ra(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vu||(Vu=!0,Hu=r),ds(0,t)},n}function vs(e,t,n){(n=Ra(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ds(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Wu?Wu=new Set([this]):Wu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Ml.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _s(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ra(-1,1)).tag=2,Oa(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ys=b.ReactCurrentOwner,bs=!1;function xs(e,t,n,r){t.child=null===e?Ka(t,null,n,r):Xa(t,e.child,n,r)}function ws(e,t,n,r,i){n=n.render;var a=t.ref;return Sa(t,i),r=So(e,t,n,r,a,i),n=Mo(),null===e||bs?(ia&&n&&ea(t),t.flags|=1,xs(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vs(e,t,i))}function ks(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Il(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ol(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ss(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return Vs(e,t,i)}return t.flags|=1,(e=Rl(a,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ur(a,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Vs(e,t,i);0!==(131072&e.flags)&&(bs=!0)}}return Ts(e,t,n,r,i)}function Ms(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ci(Ru,Iu),Iu|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ci(Ru,Iu),Iu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ci(Ru,Iu),Iu|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ci(Ru,Iu),Iu|=r;return xs(e,t,i,n),t.child}function Cs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ts(e,t,n,r,i){var a=Ii(n)?Ai:Ei.current;return a=Li(t,a),Sa(t,i),n=So(e,t,n,r,a,i),r=Mo(),null===e||bs?(ia&&r&&ea(t),t.flags|=1,xs(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vs(e,t,i))}function Es(e,t,n,r,i){if(Ii(n)){var a=!0;Di(t)}else a=!1;if(Sa(t,i),null===t.stateNode)Us(e,t),Ua(t,n,r),Ha(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ma(l):l=Li(t,l=Ii(n)?Ai:Ei.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==l)&&Va(t,o,r,l),Aa=!1;var d=t.memoizedState;o.state=d,za(t,r,o,i),u=t.memoizedState,s!==r||d!==u||Pi.current||Aa?("function"===typeof c&&(Fa(t,n,c,r),u=t.memoizedState),(s=Aa||qa(t,n,s,r,d,u,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Ia(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ma(t.type,s),o.props=l,h=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ma(u):u=Li(t,u=Ii(n)?Ai:Ei.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==u)&&Va(t,o,r,u),Aa=!1,d=t.memoizedState,o.state=d,za(t,r,o,i);var p=t.memoizedState;s!==h||d!==p||Pi.current||Aa?("function"===typeof f&&(Fa(t,n,f,r),p=t.memoizedState),(l=Aa||qa(t,n,l,r,d,p,u)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ps(e,t,n,r,a,i)}function Ps(e,t,n,r,i,a){Cs(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&zi(t,n,!1),Vs(e,t,a);r=t.stateNode,ys.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Xa(t,e.child,null,a),t.child=Xa(t,null,s,a)):xs(e,t,s,a),t.memoizedState=r.state,i&&zi(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),ro(e,t.containerInfo)}function Ls(e,t,n,r,i){return fa(),pa(i),t.flags|=256,xs(e,t,n,r),t.child}var Is,Rs,Os,Ns={dehydrated:null,treeContext:null,retryLane:0};function Ds(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var r,i=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ci(so,1&o),null===e)return la(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=i.children,e=i.fallback,s?(i=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Dl(u,i,0,null),e=Nl(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ds(n),t.memoizedState=Ns,e):js(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=hs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Dl({mode:"visible",children:r.children},i,0,null),(o=Nl(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Xa(t,e.child,null,s),t.child.memoizedState=Ds(s),t.memoizedState=Ns,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var u=r.dgst;return r=u,Bs(e,t,s,r=hs(o=Error(a(419)),r,void 0))}if(u=0!==(s&e.childLanes),bs||u){if(null!==(r=Pu)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Pa(e,i),nl(r,e,i,-1))}return vl(),Bs(e,t,s,r=hs(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Tl.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ra=li(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(Gi[Zi++]=Xi,Gi[Zi++]=Ki,Gi[Zi++]=Yi,Xi=e.id,Ki=e.overflow,Yi=t),(t=js(t,r.children)).flags|=4096,t)}(e,t,u,i,r,o,n);if(s){s=i.fallback,u=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&u)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Rl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Rl(r,s):(s=Nl(s,u,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,u=null===(u=e.child.memoizedState)?Ds(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ns,i}return e=(s=e.child).sibling,i=Rl(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function js(e,t){return(t=Dl({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&pa(r),Xa(t,e.child,null,n),(e=js(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ka(e.return,t,n)}function $s(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function qs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(xs(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fs(e,n,t);else if(19===e.tag)Fs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ci(so,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),$s(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===uo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}$s(t,!0,n,null,a);break;case"together":$s(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Us(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Du|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Rl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ws(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Gs(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(t),null;case 1:case 17:return Ii(t.type)&&Ri(),Ws(t),null;case 3:return r=t.stateNode,io(),Mi(Pi),Mi(Ei),co(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ol(aa),aa=null))),Ws(t),null;case 5:oo(t);var i=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Rs(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Ws(t),null}if(e=no(Qa.current),ha(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[di]=t,r[fi]=o,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Nr.length;i++)Br(Nr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":X(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ie(r,o),Br("invalid",r)}for(var u in _e(n,o),i=null,o)if(o.hasOwnProperty(u)){var l=o[u];"children"===u?"string"===typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,l,e),i=["children",""+l]):s.hasOwnProperty(u)&&null!=l&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":W(r),Q(r,o,!0);break;case"textarea":W(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Qr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[di]=t,e[fi]=r,Is(e,t),t.stateNode=e;e:{switch(u=ye(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<Nr.length;i++)Br(Nr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":X(e,r),i=Y(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=z({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(o in _e(n,i),l=i)if(l.hasOwnProperty(o)){var c=l[o];"style"===o?me(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===o?"string"===typeof c?("textarea"!==n||""!==c)&&de(e,c):"number"===typeof c&&de(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=c&&"onScroll"===o&&Br("scroll",e):null!=c&&y(e,o,c,u))}switch(n){case"input":W(e),Q(e,r,!1);break;case"textarea":W(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Qr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ws(t),null;case 6:if(e&&null!=t.stateNode)Os(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=no(to.current),no(Qa.current),ha(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(o=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return Ws(t),null;case 13:if(Mi(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))da(),fa(),t.flags|=98560,o=!1;else if(o=ha(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[di]=t}else fa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ws(t),o=!1}else null!==aa&&(ol(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Ou&&(Ou=3):vl())),null!==t.updateQueue&&(t.flags|=4),Ws(t),null);case 4:return io(),null===e&&qr(t.stateNode.containerInfo),Ws(t),null;case 10:return wa(t.type._context),Ws(t),null;case 19:if(Mi(so),null===(o=t.memoizedState))return Ws(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)Hs(o,!1);else{if(0!==Ou||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,Hs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ci(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Ke()>qu&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ia)return Ws(t),null}else 2*Ke()-o.renderingStartTime>qu&&1073741824!==n&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ke(),t.sibling=null,n=so.current,Ci(so,r?1&n|2:1&n),t):(Ws(t),null);case 22:case 23:return hl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Iu)&&(Ws(t),6&t.subtreeFlags&&(t.flags|=8192)):Ws(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Zs(e,t){switch(ta(t),t.tag){case 1:return Ii(t.type)&&Ri(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return io(),Mi(Pi),Mi(Ei),co(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Mi(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));fa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Mi(so),null;case 4:return io(),null;case 10:return wa(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Is=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Rs=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,no(Qa.current);var a,o=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),o=[];break;case"select":i=z({},i,{value:void 0}),r=z({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Qr)}for(c in _e(n,r),n=null,i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&null!=i[c])if("style"===c){var u=i[c];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(u=null!=i?i[c]:void 0,r.hasOwnProperty(c)&&l!==u&&(null!=l||null!=u))if("style"===c)if(u){for(a in u)!u.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&u[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(o=o||[]).push(c,l)):"children"===c?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Br("scroll",e),o||u===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ys=!1,Xs=!1,Ks="function"===typeof WeakSet?WeakSet:Set,Js=null;function Qs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sl(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){Sl(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&eu(t,n,a)}i=i.next}while(i!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[di],delete t[fi],delete t[vi],delete t[mi],delete t[gi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ou(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ou(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Qr));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var cu=null,hu=!1;function du(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Xs||Qs(n,t);case 6:var r=cu,i=hu;cu=null,du(e,t,n),hu=i,null!==(cu=r)&&(hu?(e=cu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cu.removeChild(n.stateNode));break;case 18:null!==cu&&(hu?(e=cu,n=n.stateNode,8===e.nodeType?ui(e.parentNode,n):1===e.nodeType&&ui(e,n),qt(e)):ui(cu,n.stateNode));break;case 4:r=cu,i=hu,cu=n.stateNode.containerInfo,hu=!0,du(e,t,n),cu=r,hu=i;break;case 0:case 11:case 14:case 15:if(!Xs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&eu(n,t,o),i=i.next}while(i!==r)}du(e,t,n);break;case 1:if(!Xs&&(Qs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Sl(n,t,s)}du(e,t,n);break;case 21:du(e,t,n);break;case 22:1&n.mode?(Xs=(r=Xs)||null!==n.memoizedState,du(e,t,n),Xs=r):du(e,t,n);break;default:du(e,t,n)}}function pu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ks),t.forEach((function(t){var r=El.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:cu=u.stateNode,hu=!1;break e;case 3:case 4:cu=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===cu)throw Error(a(160));fu(o,s,i),cu=null,hu=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(c){Sl(i,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mu(t,e),t=t.sibling}function mu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),gu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(m){Sl(e,e.return,m)}try{nu(5,e,e.return)}catch(m){Sl(e,e.return,m)}}break;case 1:vu(t,e),gu(e),512&r&&null!==n&&Qs(n,n.return);break;case 5:if(vu(t,e),gu(e),512&r&&null!==n&&Qs(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(m){Sl(e,e.return,m)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===u&&"radio"===o.type&&null!=o.name&&K(i,o),ye(u,s);var c=ye(u,o);for(s=0;s<l.length;s+=2){var h=l[s],d=l[s+1];"style"===h?me(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):y(i,h,d,c)}switch(u){case"input":J(i,o);break;case"textarea":ae(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(i,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[fi]=o}catch(m){Sl(e,e.return,m)}}break;case 6:if(vu(t,e),gu(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(m){Sl(e,e.return,m)}}break;case 3:if(vu(t,e),gu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(m){Sl(e,e.return,m)}break;case 4:default:vu(t,e),gu(e);break;case 13:vu(t,e),gu(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||($u=Ke())),4&r&&pu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Xs=(c=Xs)||h,vu(t,e),Xs=c):vu(t,e),gu(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&0!==(1&e.mode))for(Js=e,h=e.child;null!==h;){for(d=Js=h;null!==Js;){switch(p=(f=Js).child,f.tag){case 0:case 11:case 14:case 15:nu(4,f,f.return);break;case 1:Qs(f,f.return);var v=f.stateNode;if("function"===typeof v.componentWillUnmount){r=f,n=f.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){Sl(r,n,m)}}break;case 5:Qs(f,f.return);break;case 22:if(null!==f.memoizedState){xu(d);continue}}null!==p?(p.return=f,Js=p):xu(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,c?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=d.stateNode,s=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,u.style.display=ve("display",s))}catch(m){Sl(e,e.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){Sl(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:vu(t,e),gu(e),4&r&&pu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ou(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),lu(e,su(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;uu(e,su(e),o);break;default:throw Error(a(161))}}catch(s){Sl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _u(e,t,n){Js=e,yu(e,t,n)}function yu(e,t,n){for(var r=0!==(1&e.mode);null!==Js;){var i=Js,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Ys;if(!o){var s=i.alternate,u=null!==s&&null!==s.memoizedState||Xs;s=Ys;var l=Xs;if(Ys=o,(Xs=u)&&!l)for(Js=i;null!==Js;)u=(o=Js).child,22===o.tag&&null!==o.memoizedState?wu(i):null!==u?(u.return=o,Js=u):wu(i);for(;null!==a;)Js=a,yu(a,t,n),a=a.sibling;Js=i,Ys=s,Xs=l}bu(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,Js=a):bu(e)}}function bu(e){for(;null!==Js;){var t=Js;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xs||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xs)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ma(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&ja(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}ja(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&qt(d)}}}break;default:throw Error(a(163))}Xs||512&t.flags&&iu(t)}catch(f){Sl(t,t.return,f)}}if(t===e){Js=null;break}if(null!==(n=t.sibling)){n.return=t.return,Js=n;break}Js=t.return}}function xu(e){for(;null!==Js;){var t=Js;if(t===e){Js=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Js=n;break}Js=t.return}}function wu(e){for(;null!==Js;){var t=Js;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){Sl(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(u){Sl(t,i,u)}}var a=t.return;try{iu(t)}catch(u){Sl(t,a,u)}break;case 5:var o=t.return;try{iu(t)}catch(u){Sl(t,o,u)}}}catch(u){Sl(t,t.return,u)}if(t===e){Js=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Js=s;break}Js=t.return}}var ku,Su=Math.ceil,Mu=b.ReactCurrentDispatcher,Cu=b.ReactCurrentOwner,Tu=b.ReactCurrentBatchConfig,Eu=0,Pu=null,Au=null,Lu=0,Iu=0,Ru=Si(0),Ou=0,Nu=null,Du=0,zu=0,ju=0,Bu=null,Fu=null,$u=0,qu=1/0,Uu=null,Vu=!1,Hu=null,Wu=null,Gu=!1,Zu=null,Yu=0,Xu=0,Ku=null,Ju=-1,Qu=0;function el(){return 0!==(6&Eu)?Ke():-1!==Ju?Ju:Ju=Ke()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Eu)&&0!==Lu?Lu&-Lu:null!==va.transition?(0===Qu&&(Qu=vt()),Qu):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nl(e,t,n,r){if(50<Xu)throw Xu=0,Ku=null,Error(a(185));gt(e,n,r),0!==(2&Eu)&&e===Pu||(e===Pu&&(0===(2&Eu)&&(zu|=n),4===Ou&&sl(e,Lu)),rl(e,r),1===n&&0===Eu&&0===(1&t.mode)&&(qu=Ke()+500,Bi&&qi()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,u=i[o];-1===u?0!==(s&n)&&0===(s&r)||(i[o]=ft(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=dt(e,e===Pu?Lu:0);if(0===r)null!==n&&Ze(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ze(n),1===t)0===e.tag?function(e){Bi=!0,$i(e)}(ul.bind(null,e)):$i(ul.bind(null,e)),oi((function(){0===(6&Eu)&&qi()})),n=null;else{switch(bt(r)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pl(n,il.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function il(e,t){if(Ju=-1,Qu=0,0!==(6&Eu))throw Error(a(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var r=dt(e,e===Pu?Lu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=ml(e,r);else{t=r;var i=Eu;Eu|=2;var o=pl();for(Pu===e&&Lu===t||(Uu=null,qu=Ke()+500,dl(e,t));;)try{_l();break}catch(u){fl(e,u)}xa(),Mu.current=o,Eu=i,null!==Au?t=0:(Pu=null,Lu=0,t=Ou)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=al(e,i))),1===t)throw n=Nu,dl(e,0),sl(e,r),rl(e,Ke()),n;if(6===t)sl(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=ml(e,r))&&(0!==(o=pt(e))&&(r=o,t=al(e,o))),1===t))throw n=Nu,dl(e,0),sl(e,r),rl(e,Ke()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:xl(e,Fu,Uu);break;case 3:if(sl(e,r),(130023424&r)===r&&10<(t=$u+500-Ke())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){el(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xl.bind(null,e,Fu,Uu),t);break}xl(e,Fu,Uu);break;case 4:if(sl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Ke()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Su(r/1960))-r)){e.timeoutHandle=ri(xl.bind(null,e,Fu,Uu),r);break}xl(e,Fu,Uu);break;default:throw Error(a(329))}}}return rl(e,Ke()),e.callbackNode===n?il.bind(null,e):null}function al(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(dl(e,t).flags|=256),2!==(e=ml(e,t))&&(t=Fu,Fu=n,null!==t&&ol(t)),e}function ol(e){null===Fu?Fu=e:Fu.push.apply(Fu,e)}function sl(e,t){for(t&=~ju,t&=~zu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function ul(e){if(0!==(6&Eu))throw Error(a(327));wl();var t=dt(e,0);if(0===(1&t))return rl(e,Ke()),null;var n=ml(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=al(e,r))}if(1===n)throw n=Nu,dl(e,0),sl(e,t),rl(e,Ke()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xl(e,Fu,Uu),rl(e,Ke()),null}function ll(e,t){var n=Eu;Eu|=1;try{return e(t)}finally{0===(Eu=n)&&(qu=Ke()+500,Bi&&qi())}}function cl(e){null!==Zu&&0===Zu.tag&&0===(6&Eu)&&wl();var t=Eu;Eu|=1;var n=Tu.transition,r=yt;try{if(Tu.transition=null,yt=1,e)return e()}finally{yt=r,Tu.transition=n,0===(6&(Eu=t))&&qi()}}function hl(){Iu=Ru.current,Mi(Ru)}function dl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Au)for(n=Au.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ri();break;case 3:io(),Mi(Pi),Mi(Ei),co();break;case 5:oo(r);break;case 4:io();break;case 13:case 19:Mi(so);break;case 10:wa(r.type._context);break;case 22:case 23:hl()}n=n.return}if(Pu=e,Au=e=Rl(e.current,null),Lu=Iu=t,Ou=0,Nu=null,ju=zu=Du=0,Fu=Bu=null,null!==Ca){for(t=0;t<Ca.length;t++)if(null!==(r=(n=Ca[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}Ca=null}return e}function fl(e,t){for(;;){var n=Au;try{if(xa(),ho.current=os,_o){for(var r=vo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}_o=!1}if(po=0,go=mo=vo=null,yo=!1,bo=0,Cu.current=null,null===n||null===n.return){Ou=1,Nu=t,Au=null;break}e:{var o=e,s=n.return,u=n,l=t;if(t=Lu,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,_s(p,s,u,0,t),1&p.mode&&ms(o,c,t),l=c;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(l),t.updateQueue=m}else v.add(l);break e}if(0===(1&t)){ms(o,c,t),vl();break e}l=Error(a(426))}else if(ia&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),_s(g,s,u,0,t),pa(cs(l,u));break e}}o=l=cs(l,u),4!==Ou&&(Ou=2),null===Bu?Bu=[o]:Bu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Da(o,ps(0,l,t));break e;case 1:u=l;var _=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof _.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Wu||!Wu.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Da(o,vs(o,u,t));break e}}o=o.return}while(null!==o)}bl(n)}catch(b){t=b,Au===n&&null!==n&&(Au=n=n.return);continue}break}}function pl(){var e=Mu.current;return Mu.current=os,null===e?os:e}function vl(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===Pu||0===(268435455&Du)&&0===(268435455&zu)||sl(Pu,Lu)}function ml(e,t){var n=Eu;Eu|=2;var r=pl();for(Pu===e&&Lu===t||(Uu=null,dl(e,t));;)try{gl();break}catch(i){fl(e,i)}if(xa(),Eu=n,Mu.current=r,null!==Au)throw Error(a(261));return Pu=null,Lu=0,Ou}function gl(){for(;null!==Au;)yl(Au)}function _l(){for(;null!==Au&&!Ye();)yl(Au)}function yl(e){var t=ku(e.alternate,e,Iu);e.memoizedProps=e.pendingProps,null===t?bl(e):Au=t,Cu.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Gs(n,t,Iu)))return void(Au=n)}else{if(null!==(n=Zs(n,t)))return n.flags&=32767,void(Au=n);if(null===e)return Ou=6,void(Au=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Au=t);Au=t=e}while(null!==t);0===Ou&&(Ou=5)}function xl(e,t,n){var r=yt,i=Tu.transition;try{Tu.transition=null,yt=1,function(e,t,n,r){do{wl()}while(null!==Zu);if(0!==(6&Eu))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===Pu&&(Au=Pu=null,Lu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gu||(Gu=!0,Pl(tt,(function(){return wl(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Tu.transition,Tu.transition=null;var s=yt;yt=1;var u=Eu;Eu|=4,Cu.current=null,function(e,t){if(ei=Vt,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(x){n=null;break e}var s=0,u=-1,l=-1,c=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(u=s+i),d!==o||0!==r&&3!==d.nodeType||(l=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++c===i&&(u=s),f===o&&++h===r&&(l=s),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Vt=!1,Js=t;null!==Js;)if(e=(t=Js).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Js=e;else for(;null!==Js;){t=Js;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,_=t.stateNode,y=_.getSnapshotBeforeUpdate(t.elementType===t.type?m:ma(t.type,m),g);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(x){Sl(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Js=e;break}Js=t.return}v=tu,tu=!1}(e,n),mu(n,e),pr(ti),Vt=!!ei,ti=ei=null,e.current=n,_u(n,e,i),Xe(),Eu=u,yt=s,Tu.transition=o}else e.current=n;if(Gu&&(Gu=!1,Zu=e,Yu=i),0===(o=e.pendingLanes)&&(Wu=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,Ke()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Vu)throw Vu=!1,e=Hu,Hu=null,e;0!==(1&Yu)&&0!==e.tag&&wl(),0!==(1&(o=e.pendingLanes))?e===Ku?Xu++:(Xu=0,Ku=e):Xu=0,qi()}(e,t,n,r)}finally{Tu.transition=i,yt=r}return null}function wl(){if(null!==Zu){var e=bt(Yu),t=Tu.transition,n=yt;try{if(Tu.transition=null,yt=16>e?16:e,null===Zu)var r=!1;else{if(e=Zu,Zu=null,Yu=0,0!==(6&Eu))throw Error(a(331));var i=Eu;for(Eu|=4,Js=e.current;null!==Js;){var o=Js,s=o.child;if(0!==(16&Js.flags)){var u=o.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for(Js=c;null!==Js;){var h=Js;switch(h.tag){case 0:case 11:case 15:nu(8,h,o)}var d=h.child;if(null!==d)d.return=h,Js=d;else for(;null!==Js;){var f=(h=Js).sibling,p=h.return;if(au(h),h===c){Js=null;break}if(null!==f){f.return=p,Js=f;break}Js=p}}}var v=o.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Js=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Js=s;else e:for(;null!==Js;){if(0!==(2048&(o=Js).flags))switch(o.tag){case 0:case 11:case 15:nu(9,o,o.return)}var _=o.sibling;if(null!==_){_.return=o.return,Js=_;break e}Js=o.return}}var y=e.current;for(Js=y;null!==Js;){var b=(s=Js).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,Js=b;else e:for(s=y;null!==Js;){if(0!==(2048&(u=Js).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(w){Sl(u,u.return,w)}if(u===s){Js=null;break e}var x=u.sibling;if(null!==x){x.return=u.return,Js=x;break e}Js=u.return}}if(Eu=i,qi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(w){}r=!0}return r}finally{yt=n,Tu.transition=t}}return!1}function kl(e,t,n){e=Oa(e,t=ps(0,t=cs(n,t),1),1),t=el(),null!==e&&(gt(e,1,t),rl(e,t))}function Sl(e,t,n){if(3===e.tag)kl(e,e,n);else for(;null!==t;){if(3===t.tag){kl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wu||!Wu.has(r))){t=Oa(t,e=vs(t,e=cs(n,e),1),1),e=el(),null!==t&&(gt(t,1,e),rl(t,e));break}}t=t.return}}function Ml(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Pu===e&&(Lu&n)===n&&(4===Ou||3===Ou&&(130023424&Lu)===Lu&&500>Ke()-$u?dl(e,0):ju|=n),rl(e,t)}function Cl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=el();null!==(e=Pa(e,t))&&(gt(e,t,n),rl(e,n))}function Tl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cl(e,n)}function El(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Cl(e,n)}function Pl(e,t){return Ge(e,t)}function Al(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ll(e,t,n,r){return new Al(e,t,n,r)}function Il(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rl(e,t){var n=e.alternate;return null===n?((n=Ll(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ol(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Il(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case k:return Nl(n.children,i,o,t);case S:s=8,i|=8;break;case M:return(e=Ll(12,n,t,2|i)).elementType=M,e.lanes=o,e;case P:return(e=Ll(13,n,t,i)).elementType=P,e.lanes=o,e;case A:return(e=Ll(19,n,t,i)).elementType=A,e.lanes=o,e;case R:return Dl(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:s=10;break e;case T:s=9;break e;case E:s=11;break e;case L:s=14;break e;case I:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ll(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Nl(e,t,n,r){return(e=Ll(7,e,r,t)).lanes=n,e}function Dl(e,t,n,r){return(e=Ll(22,e,r,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function zl(e,t,n){return(e=Ll(6,e,null,t)).lanes=n,e}function jl(e,t,n){return(t=Ll(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Fl(e,t,n,r,i,a,o,s,u){return e=new Bl(e,t,n,s,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Ll(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},La(a),e}function $l(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function ql(e){if(!e)return Ti;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ii(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ii(n))return Ni(e,n,t)}return t}function Ul(e,t,n,r,i,a,o,s,u){return(e=Fl(n,r,!0,e,0,a,0,s,u)).context=ql(null),n=e.current,(a=Ra(r=el(),i=tl(n))).callback=void 0!==t&&null!==t?t:null,Oa(n,a,i),e.current.lanes=i,gt(e,i,r),rl(e,r),e}function Vl(e,t,n,r){var i=t.current,a=el(),o=tl(i);return n=ql(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ra(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Oa(i,t,o))&&(nl(e,i,o,a),Na(e,i,o)),o}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gl(e,t){Wl(e,t),(e=e.alternate)&&Wl(e,t)}ku=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pi.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:As(t),fa();break;case 5:ao(t);break;case 1:Ii(t.type)&&Di(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ci(ga,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ci(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?zs(e,t,n):(Ci(so,1&so.current),null!==(e=Vs(e,t,n))?e.sibling:null);Ci(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return qs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ci(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Ms(e,t,n)}return Vs(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,ia&&0!==(1048576&t.flags)&&Qi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Us(e,t),e=t.pendingProps;var i=Li(t,Ei.current);Sa(t,n),i=So(null,t,r,e,i,n);var o=Mo();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ii(r)?(o=!0,Di(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,La(t),i.updater=$a,t.stateNode=i,i._reactInternals=t,Ha(t,r,e,n),t=Ps(null,t,r,!0,o,n)):(t.tag=0,ia&&o&&ea(t),xs(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Us(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Il(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===L)return 14}return 2}(r),e=ma(r,e),i){case 0:t=Ts(null,t,r,e,n);break e;case 1:t=Es(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=ks(null,t,r,ma(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ts(e,t,r,i=t.elementType===r?i:ma(r,i),n);case 1:return r=t.type,i=t.pendingProps,Es(e,t,r,i=t.elementType===r?i:ma(r,i),n);case 3:e:{if(As(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,Ia(e,t),za(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ls(e,t,r,n,i=cs(Error(a(423)),t));break e}if(r!==i){t=Ls(e,t,r,n,i=cs(Error(a(424)),t));break e}for(ra=li(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=Ka(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fa(),r===i){t=Vs(e,t,n);break e}xs(e,t,r,n)}t=t.child}return t;case 5:return ao(t),null===e&&la(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==o&&ni(r,o)&&(t.flags|=32),Cs(e,t),xs(e,t,s,n),t.child;case 6:return null===e&&la(t),null;case 13:return zs(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Xa(t,null,r,n):xs(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ws(e,t,r,i=t.elementType===r?i:ma(r,i),n);case 7:return xs(e,t,t.pendingProps,n),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Ci(ga,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Pi.current){t=Vs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var l=u.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=Ra(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),ka(o.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),ka(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}xs(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Sa(t,n),r=r(i=Ma(i)),t.flags|=1,xs(e,t,r,n),t.child;case 14:return i=ma(r=t.type,t.pendingProps),ks(e,t,r,i=ma(r.type,i),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ma(r,i),Us(e,t),t.tag=1,Ii(r)?(e=!0,Di(t)):e=!1,Sa(t,n),Ua(t,r,i),Ha(t,r,i,n),Ps(null,t,r,!0,e,n);case 19:return qs(e,t,n);case 22:return Ms(e,t,n)}throw Error(a(156,t.tag))};var Zl="function"===typeof reportError?reportError:function(e){console.error(e)};function Yl(e){this._internalRoot=e}function Xl(e){this._internalRoot=e}function Kl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function ec(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=Hl(o);s.call(e)}}Vl(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=Hl(o);a.call(e)}}var o=Ul(t,r,e,0,null,!1,0,"",Ql);return e._reactRootContainer=o,e[pi]=o.current,qr(8===e.nodeType?e.parentNode:e),cl(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=Hl(u);s.call(e)}}var u=Fl(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=u,e[pi]=u.current,qr(8===e.nodeType?e.parentNode:e),cl((function(){Vl(t,u,n,r)})),u}(n,t,e,i,r);return Hl(o)}Xl.prototype.render=Yl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Vl(e,t,null,null)},Xl.prototype.unmount=Yl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cl((function(){Vl(null,e,null,null)})),t[pi]=null}},Xl.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&zt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(_t(t,1|n),rl(t,Ke()),0===(6&Eu)&&(qu=Ke()+500,qi()))}break;case 13:cl((function(){var t=Pa(e,1);if(null!==t){var n=el();nl(t,e,1,n)}})),Gl(e,1)}},wt=function(e){if(13===e.tag){var t=Pa(e,134217728);if(null!==t)nl(t,e,134217728,el());Gl(e,134217728)}},kt=function(e){if(13===e.tag){var t=tl(e),n=Pa(e,t);if(null!==n)nl(n,e,t,el());Gl(e,t)}},St=function(){return yt},Mt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=xi(r);if(!i)throw Error(a(90));G(r),J(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=ll,Pe=cl;var tc={usingClientEntryPoint:!1,Events:[yi,bi,xi,Ce,Te,ll]},nc={findFiberByHostInstance:_i,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rc={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{it=ic.inject(rc),at=ic}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kl(t))throw Error(a(200));return $l(e,t,null,n)},t.createRoot=function(e,t){if(!Kl(e))throw Error(a(299));var n=!1,r="",i=Zl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Fl(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,qr(8===e.nodeType?e.parentNode:e),new Yl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return cl(e)},t.hydrate=function(e,t,n){if(!Jl(t))throw Error(a(200));return ec(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kl(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=Zl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Ul(t,null,e,1,null!=n?n:null,i,0,o,s),e[pi]=t.current,qr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xl(t)},t.render=function(e,t,n){if(!Jl(t))throw Error(a(200));return ec(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jl(e))throw Error(a(40));return!!e._reactRootContainer&&(cl((function(){ec(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ec(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var r=n(4164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},1372:function(e,t){"use strict";var n=60103,r=60106,i=60107,a=60108,o=60114,s=60109,u=60110,l=60112,c=60113,h=60120,d=60115,f=60116,p=60121,v=60122,m=60117,g=60129,_=60131;if("function"===typeof Symbol&&Symbol.for){var y=Symbol.for;n=y("react.element"),r=y("react.portal"),i=y("react.fragment"),a=y("react.strict_mode"),o=y("react.profiler"),s=y("react.provider"),u=y("react.context"),l=y("react.forward_ref"),c=y("react.suspense"),h=y("react.suspense_list"),d=y("react.memo"),f=y("react.lazy"),p=y("react.block"),v=y("react.server.block"),m=y("react.fundamental"),g=y("react.debug_trace_mode"),_=y("react.legacy_hidden")}function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case i:case o:case a:case c:case h:return e;default:switch(e=e&&e.$$typeof){case u:case l:case f:case d:case s:return e;default:return t}}case r:return t}}}var x=s,w=n,k=l,S=i,M=f,C=d,T=r,E=o,P=a,A=c;t.ContextConsumer=u,t.ContextProvider=x,t.Element=w,t.ForwardRef=k,t.Fragment=S,t.Lazy=M,t.Memo=C,t.Portal=T,t.Profiler=E,t.StrictMode=P,t.Suspense=A,t.isAsyncMode=function(){return!1},t.isConcurrentMode=function(){return!1},t.isContextConsumer=function(e){return b(e)===u},t.isContextProvider=function(e){return b(e)===s},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return b(e)===l},t.isFragment=function(e){return b(e)===i},t.isLazy=function(e){return b(e)===f},t.isMemo=function(e){return b(e)===d},t.isPortal=function(e){return b(e)===r},t.isProfiler=function(e){return b(e)===o},t.isStrictMode=function(e){return b(e)===a},t.isSuspense=function(e){return b(e)===c},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===i||e===o||e===g||e===a||e===c||e===h||e===_||"object"===typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===d||e.$$typeof===s||e.$$typeof===u||e.$$typeof===l||e.$$typeof===m||e.$$typeof===p||e[0]===v)},t.typeOf=b},7441:function(e,t,n){"use strict";e.exports=n(1372)},6374:function(e,t,n){"use strict";var r=n(2791),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,c=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},9117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function _(){}function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=g.prototype;var b=y.prototype=new _;b.constructor=y,v(b,g.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,k={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,i)&&!S.hasOwnProperty(i)&&(a[i]=t[i]);var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(i in u=e.defaultProps)void 0===a[i]&&(a[i]=u[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:k.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===a?"."+E(u,0):a,x(o)?(i="",null!=e&&(i=e.replace(T,"$&/")+"/"),P(o,t,i,"",(function(e){return e}))):null!=o&&(C(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(T,"$&/")+"/")+e)),t.push(o)),1;if(u=0,a=""===a?".":a+":",x(e))for(var l=0;l<e.length;l++){var c=a+E(s=e[l],l);u+=P(s,t,i,c,o)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=P(s=s.value,t,i,c=a+E(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function A(e,t,n){if(null==e)return e;var r=[],i=0;return P(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function L(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},R={transition:null},O={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:R,ReactCurrentOwner:k};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=v({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=k.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)w.call(t,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){u=Array(l);for(var c=0;c<l;c++)u[c]=arguments[c+2];i.children=u}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=M,t.createFactory=function(e){var t=M.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:L}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,n){return I.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,n){return I.current.useReducer(e,t,n)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return I.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return I.current.useTransition()},t.version="18.2.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<i&&0>a(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<i&&0>a(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],h=1,d=null,f=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,_="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(c);null!==t;){if(null===t.callback)i(c);else{if(!(t.startTime<=e))break;i(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function x(e){if(m=!1,b(e),!v)if(null!==r(l))v=!0,R(w);else{var t=r(c);null!==t&&O(x,t.startTime-e)}}function w(e,n){v=!1,m&&(m=!1,_(C),C=-1),p=!0;var a=f;try{for(b(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&i(l),b(n)}else i(l);d=r(l)}if(null!==d)var u=!0;else{var h=r(c);null!==h&&O(x,h.startTime-n),u=!1}return u}finally{d=null,f=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,S=!1,M=null,C=-1,T=5,E=-1;function P(){return!(t.unstable_now()-E<T)}function A(){if(null!==M){var e=t.unstable_now();E=e;var n=!0;try{n=M(!0,e)}finally{n?k():(S=!1,M=null)}}else S=!1}if("function"===typeof y)k=function(){y(A)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,I=L.port2;L.port1.onmessage=A,k=function(){I.postMessage(null)}}else k=function(){g(A,0)};function R(e){M=e,S||(S=!0,k())}function O(e,n){C=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,R(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===r(l)&&e===r(c)&&(m?(_(C),C=-1):m=!0,O(x,a-o))):(e.sortIndex=s,n(l,e),v||p||(v=!0,R(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},3897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},5372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3405:function(e,t,n){var r=n(3897);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},7156:function(e){function t(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,u,"next",e)}function u(e){t(o,i,a,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},6690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},3515:function(e,t,n){var r=n(6015),i=n(9617);function a(t,n,o){return i()?(e.exports=a=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&r(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(null,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},9728:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4704:function(e,t,n){var r=n(6116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},6389:function(e,t,n){var r=n(3808),i=n(9617),a=n(4993);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return a(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},8416:function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},3808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},1655:function(e,t,n){var r=n(6015);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},6035:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},9617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},9498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}},e.exports.__esModule=!0,e.exports.default=e.exports},2218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2122:function(e,t,n){var r=n(8416);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},215:function(e,t,n){var r=n(7071);e.exports=function(e,t){if(null==e)return{};var n,i,a=r(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a},e.exports.__esModule=!0,e.exports.default=e.exports},7071:function(e){e.exports=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},4993:function(e,t,n){var r=n(8698).default,i=n(6115);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7061:function(e,t,n){var r=n(8698).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(P){c=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),o=new C(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return E()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=d(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(P){return{type:"throw",arg:P}}}t.wrap=h;var f={};function p(){}function v(){}function m(){}var g={};c(g,s,(function(){return this}));var _=Object.getPrototypeOf,y=_&&_(_(T([])));y&&y!==n&&a.call(y,s)&&(g=y);var b=m.prototype=p.prototype=Object.create(g);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=d(e[i],e,o);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==r(h)&&a.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function k(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=d(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function T(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:E}}function E(){return{value:void 0,done:!0}}return v.prototype=m,c(b,"constructor",m),c(m,"constructor",v),v.displayName=c(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,l,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},x(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new w(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(b),c(b,l,"Generator"),c(b,s,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6015:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7424:function(e,t,n){var r=n(5372),i=n(8872),a=n(6116),o=n(2218);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var r=n(3405),i=n(9498),a=n(6116),o=n(2281);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},6116:function(e,t,n){var r=n(3897);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},3496:function(e,t,n){var r=n(3808),i=n(6015),a=n(6035),o=n(3515);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!a(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return o(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},3344:function(e,t,n){var r=n(8698).default,i=n(6015),a=n(1655);function o(){e.exports=o=function(e,t){return new s(e,void 0,t)},e.exports.__esModule=!0,e.exports.default=e.exports;var t=RegExp.prototype,n=new WeakMap;function s(e,t,r){var a=new RegExp(e,t);return n.set(a,r||n.get(e)),i(a,s.prototype)}function u(e,t){var r=n.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return a(s,RegExp),s.prototype.exec=function(e){var n=t.exec.call(this,e);return n&&(n.groups=u(n,this)),n},s.prototype[Symbol.replace]=function(e,i){if("string"==typeof i){var a=n.get(this);return t[Symbol.replace].call(this,e,i.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+a[t]})))}if("function"==typeof i){var o=this;return t[Symbol.replace].call(this,e,(function(){var e=arguments;return"object"!=r(e[e.length-1])&&(e=[].slice.call(e)).push(u(e,o)),i.apply(this,e)}))}return t[Symbol.replace].call(this,e,i)},o.apply(this,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},4687:function(e,t,n){var r=n(7061)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},5861:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return i}})},7462:function(e,t,n){"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}n.d(t,{Z:function(){return r}})},3366:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,{Z:function(){return r}})}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){"use strict";var e={};n.r(e),n.d(e,{clientPoint:function(){return lr},create:function(){return Oc},creator:function(){return Ut},customEvent:function(){return tn},event:function(){return Yt},local:function(){return Dc},matcher:function(){return nt},mouse:function(){return hr},namespace:function(){return ct},namespaces:function(){return lt},select:function(){return cn},selectAll:function(){return jc},selection:function(){return ln},selector:function(){return Qe},selectorAll:function(){return tt},style:function(){return xt},touch:function(){return cr},touches:function(){return Bc},window:function(){return gt}});var t=n(2791),r=n(1250);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(CO){s=!0,i=CO}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var s,u=n(7462);!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(s||(s={}));var l=function(e){return e};var c="beforeunload",h="popstate";function d(e){e.preventDefault(),e.returnValue=""}function f(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function p(){return Math.random().toString(36).substr(2,8)}function v(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,i=void 0===r?"":r,a=e.hash,o=void 0===a?"":a;return i&&"?"!==i&&(n+="?"===i.charAt(0)?i:"?"+i),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function m(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var g=(0,t.createContext)(null);var _=(0,t.createContext)(null);var y=(0,t.createContext)({outlet:null,matches:[]});function b(e,t){if(!e)throw new Error(t)}function x(e,t,n){void 0===n&&(n="/");var r=P(("string"===typeof t?m(t):t).pathname||"/",n);if(null==r)return null;var i=w(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(i);for(var a=null,o=0;null==a&&o<i.length;++o)a=C(i[o],r);return a}function w(e,t,n,r){return void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=""),e.forEach((function(e,i){var a={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(a.relativePath.startsWith(r)||b(!1),a.relativePath=a.relativePath.slice(r.length));var o=A([r,a.relativePath]),s=n.concat(a);e.children&&e.children.length>0&&(!0===e.index&&b(!1),w(e.children,t,s,o)),(null!=e.path||e.index)&&t.push({path:o,score:M(o,e.index),routesMeta:s})})),t}var k=/^:\w+$/,S=function(e){return"*"===e};function M(e,t){var n=e.split("/"),r=n.length;return n.some(S)&&(r+=-2),t&&(r+=2),n.filter((function(e){return!S(e)})).reduce((function(e,t){return e+(k.test(t)?3:""===t?1:10)}),r)}function C(e,t){for(var n=e.routesMeta,r={},i="/",a=[],o=0;o<n.length;++o){var s=n[o],u=o===n.length-1,l="/"===i?t:t.slice(i.length)||"/",c=T({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},l);if(!c)return null;Object.assign(r,c.params);var h=s.route;a.push({params:r,pathname:A([i,c.pathname]),pathnameBase:L(A([i,c.pathnameBase])),route:h}),"/"!==c.pathnameBase&&(i=A([i,c.pathnameBase]))}return a}function T(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);var r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(function(e,t){return r.push(t),"([^\\/]+)"}));e.endsWith("*")?(r.push("*"),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i+=n?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(i,t?void 0:"i"),r]}(e.path,e.caseSensitive,e.end),r=o(n,2),i=r[0],a=r[1],s=t.match(i);if(!s)return null;var u=s[0],l=u.replace(/(.)\/+$/,"$1"),c=s.slice(1),h=a.reduce((function(e,t,n){if("*"===t){var r=c[n]||"";l=u.slice(0,u.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return e}}(c[n]||""),e}),{});return{params:h,pathname:u,pathnameBase:l,pattern:e}}function E(e,t,n){var r,i="string"===typeof e?m(e):e,a=""===e||""===i.pathname?"/":i.pathname;if(null==a)r=n;else{var o=t.length-1;if(a.startsWith("..")){for(var s=a.split("/");".."===s[0];)s.shift(),o-=1;i.pathname=s.join("/")}r=o>=0?t[o]:"/"}var u=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?m(e):e,r=n.pathname,i=n.search,a=void 0===i?"":i,o=n.hash,s=void 0===o?"":o,u=r?r.startsWith("/")?r:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(r,t):t;return{pathname:u,search:I(a),hash:R(s)}}(i,r);return a&&"/"!==a&&a.endsWith("/")&&!u.pathname.endsWith("/")&&(u.pathname+="/"),u}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=e.charAt(t.length);return n&&"/"!==n?null:e.slice(t.length)||"/"}var A=function(e){return e.join("/").replace(/\/\/+/g,"/")},L=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},I=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},R=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""};function O(e){N()||b(!1);var n=(0,t.useContext)(g),r=n.basename,i=n.navigator,a=j(e),o=a.hash,s=a.pathname,u=a.search,l=s;if("/"!==r){var c=function(e){return""===e||""===e.pathname?"/":"string"===typeof e?m(e).pathname:e.pathname}(e),h=null!=c&&c.endsWith("/");l="/"===s?r+(h?"/":""):A([r,s])}return i.createHref({pathname:l,search:u,hash:o})}function N(){return null!=(0,t.useContext)(_)}function D(){return N()||b(!1),(0,t.useContext)(_).location}function z(){N()||b(!1);var e=(0,t.useContext)(g),n=e.basename,r=e.navigator,i=(0,t.useContext)(y).matches,a=D().pathname,o=JSON.stringify(i.map((function(e){return e.pathnameBase}))),s=(0,t.useRef)(!1);return(0,t.useEffect)((function(){s.current=!0})),(0,t.useCallback)((function(e,t){if(void 0===t&&(t={}),s.current)if("number"!==typeof e){var i=E(e,JSON.parse(o),a);"/"!==n&&(i.pathname=A([n,i.pathname])),(t.replace?r.replace:r.push)(i,t.state)}else r.go(e)}),[n,r,o,a])}function j(e){var n=(0,t.useContext)(y).matches,r=D().pathname,i=JSON.stringify(n.map((function(e){return e.pathnameBase})));return(0,t.useMemo)((function(){return E(e,JSON.parse(i),r)}),[e,i,r])}function B(e,n){return void 0===n&&(n=[]),null==e?null:e.reduceRight((function(r,i,a){return(0,t.createElement)(y.Provider,{children:void 0!==i.route.element?i.route.element:r,value:{outlet:r,matches:n.concat(e.slice(0,a+1))}})}),null)}function F(e){b(!1)}function $(e){var n=e.basename,r=void 0===n?"/":n,i=e.children,a=void 0===i?null:i,o=e.location,u=e.navigationType,l=void 0===u?s.Pop:u,c=e.navigator,h=e.static,d=void 0!==h&&h;N()&&b(!1);var f=L(r),p=(0,t.useMemo)((function(){return{basename:f,navigator:c,static:d}}),[f,c,d]);"string"===typeof o&&(o=m(o));var v=o,y=v.pathname,x=void 0===y?"/":y,w=v.search,k=void 0===w?"":w,S=v.hash,M=void 0===S?"":S,C=v.state,T=void 0===C?null:C,E=v.key,A=void 0===E?"default":E,I=(0,t.useMemo)((function(){var e=P(x,f);return null==e?null:{pathname:e,search:k,hash:M,state:T,key:A}}),[f,x,k,M,T,A]);return null==I?null:(0,t.createElement)(g.Provider,{value:p},(0,t.createElement)(_.Provider,{children:a,value:{location:I,navigationType:l}}))}function q(e){var n=e.children,r=e.location;return function(e,n){N()||b(!1);var r,i=(0,t.useContext)(y).matches,a=i[i.length-1],o=a?a.params:{},s=(a&&a.pathname,a?a.pathnameBase:"/"),u=(a&&a.route,D());if(n){var l,c="string"===typeof n?m(n):n;"/"===s||(null==(l=c.pathname)?void 0:l.startsWith(s))||b(!1),r=c}else r=u;var h=r.pathname||"/",d=x(e,{pathname:"/"===s?h:h.slice(s.length)||"/"});return B(d&&d.map((function(e){return Object.assign({},e,{params:Object.assign({},o,e.params),pathname:A([s,e.pathname]),pathnameBase:"/"===e.pathnameBase?s:A([s,e.pathnameBase])})})),i)}(U(n),r)}function U(e){var n=[];return t.Children.forEach(e,(function(e){if((0,t.isValidElement)(e))if(e.type!==t.Fragment){e.type!==F&&b(!1);var r={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(r.children=U(e.props.children)),n.push(r)}else n.push.apply(n,U(e.props.children))})),n}function V(){return V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V.apply(this,arguments)}function H(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}var W=["onClick","reloadDocument","replace","state","target","to"],G=["aria-current","caseSensitive","className","end","style","to","children"];function Z(e){var n=e.basename,r=e.children,i=e.window,a=(0,t.useRef)();null==a.current&&(a.current=function(e){void 0===e&&(e={});var t=e.window,n=void 0===t?document.defaultView:t,r=n.history;function i(){var e=n.location,t=e.pathname,i=e.search,a=e.hash,o=r.state||{};return[o.idx,l({pathname:t,search:i,hash:a,state:o.usr||null,key:o.key||"default"})]}var a=null;n.addEventListener(h,(function(){if(a)x.call(a),a=null;else{var e=s.Pop,t=i(),n=t[0],r=t[1];if(x.length){if(null!=n){var o=_-n;o&&(a={action:e,location:r,retry:function(){T(-1*o)}},T(o))}}else C(e)}}));var o=s.Pop,g=i(),_=g[0],y=g[1],b=f(),x=f();function w(e){return"string"===typeof e?e:v(e)}function k(e,t){return void 0===t&&(t=null),l((0,u.Z)({pathname:y.pathname,hash:"",search:""},"string"===typeof e?m(e):e,{state:t,key:p()}))}function S(e,t){return[{usr:e.state,key:e.key,idx:t},w(e)]}function M(e,t,n){return!x.length||(x.call({action:e,location:t,retry:n}),!1)}function C(e){o=e;var t=i();_=t[0],y=t[1],b.call({action:o,location:y})}function T(e){r.go(e)}null==_&&(_=0,r.replaceState((0,u.Z)({},r.state,{idx:_}),""));var E={get action(){return o},get location(){return y},createHref:w,push:function e(t,i){var a=s.Push,o=k(t,i);if(M(a,o,(function(){e(t,i)}))){var u=S(o,_+1),l=u[0],c=u[1];try{r.pushState(l,"",c)}catch(h){n.location.assign(c)}C(a)}},replace:function e(t,n){var i=s.Replace,a=k(t,n);if(M(i,a,(function(){e(t,n)}))){var o=S(a,_),u=o[0],l=o[1];r.replaceState(u,"",l),C(i)}},go:T,back:function(){T(-1)},forward:function(){T(1)},listen:function(e){return b.push(e)},block:function(e){var t=x.push(e);return 1===x.length&&n.addEventListener(c,d),function(){t(),x.length||n.removeEventListener(c,d)}}};return E}({window:i}));var g=a.current,_=o((0,t.useState)({action:g.action,location:g.location}),2),y=_[0],b=_[1];return(0,t.useLayoutEffect)((function(){return g.listen(b)}),[g]),(0,t.createElement)($,{basename:n,children:r,location:y.location,navigationType:y.action,navigator:g})}var Y=(0,t.forwardRef)((function(e,n){var r=e.onClick,i=e.reloadDocument,a=e.replace,o=void 0!==a&&a,s=e.state,u=e.target,l=e.to,c=H(e,W),h=O(l),d=function(e,n){var r=void 0===n?{}:n,i=r.target,a=r.replace,o=r.state,s=z(),u=D(),l=j(e);return(0,t.useCallback)((function(t){if(0===t.button&&(!i||"_self"===i)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(t)){t.preventDefault();var n=!!a||v(u)===v(l);s(e,{replace:n,state:o})}}),[u,s,l,a,o,i,e])}(l,{replace:o,state:s,target:u});return(0,t.createElement)("a",V({},c,{href:h,onClick:function(e){r&&r(e),e.defaultPrevented||i||d(e)},ref:n,target:u}))}));var X=(0,t.forwardRef)((function(e,n){var r=e["aria-current"],i=void 0===r?"page":r,a=e.caseSensitive,o=void 0!==a&&a,s=e.className,u=void 0===s?"":s,l=e.end,c=void 0!==l&&l,h=e.style,d=e.to,f=e.children,p=H(e,G),v=D(),m=j(d),g=v.pathname,_=m.pathname;o||(g=g.toLowerCase(),_=_.toLowerCase());var y,b=g===_||!c&&g.startsWith(_)&&"/"===g.charAt(_.length),x=b?i:void 0;y="function"===typeof u?u({isActive:b}):[u,b?"active":null].filter(Boolean).join(" ");var w="function"===typeof h?h({isActive:b}):h;return(0,t.createElement)(Y,V({},p,{"aria-current":x,className:y,ref:n,style:w,to:d}),"function"===typeof f?f({isActive:b}):f)}));var K=function(){return K=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},K.apply(this,arguments)};var J="",Q=null,ee=null,te=null;function ne(){J="",null!==Q&&Q.disconnect(),null!==ee&&(window.clearTimeout(ee),ee=null)}function re(e){return["BUTTON","INPUT","SELECT","TEXTAREA"].includes(e.tagName)&&!e.hasAttribute("disabled")||["A","AREA"].includes(e.tagName)&&e.hasAttribute("href")}function ie(){var e=null;if("#"===J)e=document.body;else{var t=J.replace("#","");null===(e=document.getElementById(t))&&"#top"===J&&(e=document.body)}if(null!==e){te(e);var n=e.getAttribute("tabindex");return null!==n||re(e)||e.setAttribute("tabindex",-1),e.focus({preventScroll:!0}),null!==n||re(e)||(e.blur(),e.removeAttribute("tabindex")),ne(),!0}return!1}function ae(e){return t.forwardRef((function(n,r){var i="";"string"===typeof n.to&&n.to.includes("#")?i="#"+n.to.split("#").slice(1).join("#"):"object"===typeof n.to&&"string"===typeof n.to.hash&&(i=n.to.hash);var a={};e===X&&(a.isActive=function(e,t){return e&&e.isExact&&t.hash===i});var o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(n,["scroll","smooth","timeout","elementId"]);return t.createElement(e,K({},a,o,{onClick:function(e){ne(),J=n.elementId?"#"+n.elementId:i,n.onClick&&n.onClick(e),""===J||e.defaultPrevented||0!==e.button||n.target&&"_self"!==n.target||e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(te=n.scroll||function(e){return n.smooth?e.scrollIntoView({behavior:"smooth"}):e.scrollIntoView()},function(e){window.setTimeout((function(){!1===ie()&&(null===Q&&(Q=new MutationObserver(ie)),Q.observe(document,{attributes:!0,childList:!0,subtree:!0}),ee=window.setTimeout((function(){ne()}),e||1e4))}),0)}(n.timeout))},ref:r}),n.children)}))}var oe=ae(Y),se=(ae(X),n(184)),ue=["btn--primary","btn--outline","btn--clear","btn--gray"],le=["btn--medium","btn--large"],ce=function(e){var t=e.children,n=e.type,r=e.onClick,i=e.buttonStyle,a=e.buttonSize,o=ue.includes(i)?i:ue[0],s=le.includes(a)?a:le[0];return(0,se.jsx)(Y,{to:"/application",className:"btn-mobile",children:(0,se.jsx)("button",{className:"btn ".concat(o," ").concat(s),onClick:r,type:n,children:t})})};var he=function(){var e=o((0,t.useState)(!1),2),n=e[0],r=e[1],i=o((0,t.useState)(!0),2),a=i[0],s=i[1],u=function(){return r(!1)},l=function(){window.innerWidth<=960?s(!1):s(!0)};return(0,t.useEffect)((function(){l()}),[]),window.addEventListener("resize",l),(0,se.jsx)(se.Fragment,{children:(0,se.jsx)("nav",{className:"navbar",children:(0,se.jsxs)("div",{className:"navbar-container",children:[(0,se.jsx)(oe,{to:"/",className:"navbar-logo",onClick:u,children:"HSPA"}),(0,se.jsx)("div",{className:"menu-icon",onClick:function(){return r(!n)},children:(0,se.jsx)("i",{className:n?"fas fa-times":"fas fa-bars"})}),(0,se.jsxs)("ul",{className:n?"nav-menu active":"nav-menu",children:[(0,se.jsx)("li",{className:"nav-item",children:(0,se.jsx)(oe,{smooth:!0,to:"/#home",className:"nav-links",onClick:u,children:"Home"})}),(0,se.jsx)("li",{className:"nav-item",children:(0,se.jsx)(oe,{smooth:!0,to:"/application",className:"nav-links",onClick:u,children:"Application"})}),(0,se.jsx)("li",{className:"nav-item",children:(0,se.jsx)(oe,{smooth:!0,to:"/#documentation",className:"nav-links",onClick:u,children:"Documentation"})})]}),a&&(0,se.jsx)(ce,{buttonStyle:"btn--outline",children:"GET STARTED"})]})})})};var de=function(){var e=o((0,t.useState)(0),2),n=(e[0],e[1]),r=function(){return n(window.pageYOffset)};return(0,t.useEffect)((function(){return window.addEventListener("scroll",r),function(){return window.removeEventListener("scroll",r)}}),[]),(0,se.jsx)("div",{className:"hero-background",children:(0,se.jsxs)("div",{className:"hero-container",children:[(0,se.jsx)("h1",{children:"Hillside Street"}),(0,se.jsx)("p",{children:"Prioritization Application"}),(0,se.jsxs)("div",{className:"description-box",children:[(0,se.jsx)("div",{className:"textbox",children:"This application shows prioritized streets in terms of capital improvement given user input data and boundaries"}),(0,se.jsx)("div",{className:"hero-btns",children:(0,se.jsx)(ce,{className:"btns",buttonStyle:"btn--clear",buttonSize:"btn--large",children:"START"})})]})]})})};var fe=function(){return(0,se.jsx)(se.Fragment,{children:(0,se.jsx)("div",{className:"backgroundContainer",children:(0,se.jsxs)("div",{className:"backgroundBox",children:[(0,se.jsx)("h1",{children:"Background"}),(0,se.jsx)("p",{children:"This web application is developed as part of the LA Streets project by City of Los Angeles and UCLA. The following documentation provides background information on the Hillside Street Prioritization Application (HSPA). The LA Streets project aims for maximizing capital improvement by repairing and upgrading streets in the Los Angeles Hillside areas. In the first stage of the project, publicly available data is used to prioritize streets by a combination of rating and importance. The web application enables the user to give weights to specific options and filter out desired streets."})]})})})};var pe=function(){return(0,se.jsx)("div",{className:"docContainer",children:(0,se.jsxs)("div",{className:"docBox",children:[(0,se.jsx)("h1",{children:"Documentation"}),(0,se.jsx)("p",{children:"Following the data crawling and processing will be explained:"}),(0,se.jsx)("h2",{children:"Condition Rating"}),(0,se.jsx)("p",{children:'Condition rating is performed by comparing the condition and features of the streets with the required conditions and features, based on the street designation. The required features based on designation are taken from "City of Los Angeles Complete Street Design Guide". The following images show the standard design for local streets and local hillside streets in Los Angeles.'}),(0,se.jsx)("br",{}),(0,se.jsx)("h4",{children:"Standard Design:"}),(0,se.jsxs)("div",{className:"streetDesign",children:[(0,se.jsx)("h1",{children:"Hillside Local"}),(0,se.jsxs)("div",{className:"designInfo",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Hillside local design.png",alt:"Hillside Local Design",width:"350px"}),(0,se.jsxs)("p",{children:["Roadway Width: 36 ft. min ",(0,se.jsx)("br",{}),"Right-of-Way Width: 44ft",(0,se.jsx)("br",{}),"On-Street Parking: both sides of street",(0,se.jsx)("br",{}),"Target Operating Speed: 15mph"]})]})]}),(0,se.jsxs)("div",{className:"streetDesign",children:[(0,se.jsx)("h1",{children:"Local Street Standard"}),(0,se.jsxs)("div",{className:"designInfo",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Local street design.png",alt:"Local Street Design",width:"270px"}),(0,se.jsxs)("p",{children:["Roadway Width: 36 ft.",(0,se.jsx)("br",{}),"Right-of-Way Width: 60ft",(0,se.jsx)("br",{}),"Typical Number of Lanes: 1 lane in each direction",(0,se.jsx)("br",{}),"Typical Sidewalk/Border Width: 12 ft",(0,se.jsx)("br",{}),"Target Operating Speed: 20mph"]})]})]}),(0,se.jsx)("br",{}),(0,se.jsx)("h2",{children:"Condition Data Requisition"}),(0,se.jsx)("p",{children:"The data for describing the actual street condition is mainly pulled from four different GIS databases."}),(0,se.jsx)("div",{className:"greyBox",style:{marginLeft:"70px"},children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:"StreetsLA GeoHub Street Inventory as a base dataset"}),(0,se.jsx)("li",{children:"StreetsLA GeoHub PCI for adding PCI information"}),(0,se.jsx)("li",{children:"Street Centerline (data.lacity.org) for adding designation information"}),(0,se.jsx)("li",{children:"Hillside Ordinance Geohub for geometric information of hillside ordinance layers"})]})}),(0,se.jsx)("br",{}),(0,se.jsxs)("div",{className:"designInfo",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Hillside Ordinance Layer.png",alt:"Hillside Ordinance Layer",width:"27%"}),(0,se.jsx)("p",{children:"As the project is only focusing on streets located in the Hillside Ordinance layer, only these streets will be analyzed in terms of a condition rating. The Hillside Ordinance layer can be viewed in the following figure."})]}),(0,se.jsx)("p1",{children:"Hillside Ordinance layer on Los Angeles GeouHub [2]"}),(0,se.jsx)("br",{}),(0,se.jsx)("h3",{children:"Dataset fusion is performed by matching the SECT_IDs across the GIS databases. The following GIS databases are used to receive feature information for all sections:"}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("div",{className:"greyBox",children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:"Sidewalks Geohub for Sidewalk existence"}),(0,se.jsx)("li",{children:"Curbs Geohub for curb existence"})]})}),(0,se.jsx)("img",{src:"/LAStreet/images/Sidewalk Layers.png",alt:"Sidewalk Layers",width:"500px"}),(0,se.jsx)("p1",{children:"Sidewalk layers on Los Angeles GeoHub [2]"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("h3",{children:"As the sidewalks and curbs are not allocated to any SECT_ID, a manual allocation has to be performed. In the GIS databases, the street geometry is described using line elements, whereas the sidewalk and curb geometries are described as polygon elements. The allocation process for sidewalks/curbs to street segments is described as follows:"}),(0,se.jsx)("div",{className:"greenBox",children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:"Interpolate additional points in 1 m distance for all street geometries"}),(0,se.jsx)("li",{children:"Build a KD-tree of all the street points and keep knowledge of associated SECT IDs"}),(0,se.jsx)("li",{children:"For every curb or sidewalk polygon corner point, search the closest street point"}),(0,se.jsx)("li",{children:"If the street points are closer than 0.75 x street width, associate the point to the SECT ID"})]})}),(0,se.jsx)("h3",{children:"This procedure makes sure that every curb/sidewalk is matched to a certain SECT_ID, if the closest point of the SECT_ID is not too far away. If curbs and sidewalks are missing in the GIS database, they will not be accounted for in this procedure."}),(0,se.jsx)("h3",{children:"In communication with CityLA, the following required street widths have been set:"}),(0,se.jsxs)("table",{id:"myTable",children:[(0,se.jsxs)("tr",{children:[(0,se.jsx)("th",{children:"Designation"}),(0,se.jsx)("th",{children:"Required Width"}),(0,se.jsx)("th",{children:"Designation"}),(0,se.jsx)("th",{children:"Required Width"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Avenue I"}),(0,se.jsx)("td",{children:"70"}),(0,se.jsx)("td",{children:"Modified Avenue III"}),(0,se.jsx)("td",{children:"46"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Avenue II"}),(0,se.jsx)("td",{children:"56"}),(0,se.jsx)("td",{children:"Modified Boulevard II"}),(0,se.jsx)("td",{children:"80"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Avenue III"}),(0,se.jsx)("td",{children:"46"}),(0,se.jsx)("td",{children:"Modified Collector"}),(0,se.jsx)("td",{children:"40"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Boulevard I"}),(0,se.jsx)("td",{children:"100"}),(0,se.jsx)("td",{children:"Modified Local Street Standard"}),(0,se.jsx)("td",{children:"28"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Boulevard II"}),(0,se.jsx)("td",{children:"80"}),(0,se.jsx)("td",{children:"Modified Scenic Arterial Mountain"}),(0,se.jsx)("td",{children:"28"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Collector"}),(0,se.jsx)("td",{children:"40"}),(0,se.jsx)("td",{children:"Mountain Collector"}),(0,se.jsx)("td",{children:"40"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Hillside Collector"}),(0,se.jsx)("td",{children:"40"}),(0,se.jsx)("td",{children:"None"}),(0,se.jsx)("td",{children:"28"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Local Street - Standard"}),(0,se.jsx)("td",{children:"28"}),(0,se.jsx)("td",{children:"Private"}),(0,se.jsx)("td",{children:"20"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Modified Avenue I"}),(0,se.jsx)("td",{children:"70"}),(0,se.jsx)("td",{children:"Scenic Parkway"}),(0,se.jsx)("td",{children:"20"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Modified Avenue II"}),(0,se.jsx)("td",{children:"56"}),(0,se.jsx)("td",{children:"Unidentified"}),(0,se.jsx)("td",{children:"28"})]})]}),(0,se.jsx)("h2",{children:"Sub Condition Rating"}),(0,se.jsx)("p",{children:"The rating process contains 4 different categories: Width, PCI, Sidewalks, and Curbs. For every category, a score from 0.1 to 1 is assigned."}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Following, the four sub-rating categories are described:"}),(0,se.jsxs)("div",{className:"conditionRating",children:[(0,se.jsxs)("div",{className:"rating",children:[(0,se.jsx)("div",{className:"ratingTitle",children:"Width Rating"}),(0,se.jsx)("div",{className:"ratingDescription",children:"The width rating is dependent on the ratio between the actual street width and the designated street width, which can be seen in the table above. If the ratio is below 0.5, the street section gets the minimum sub-score of 0.1. If the actual width is equal to or greater than the designated width, the street section gets the maximum score of 1.0. The scores in between are connected by a second-order polynomial."})]}),(0,se.jsxs)("div",{className:"rating",children:[(0,se.jsx)("div",{className:"ratingTitle",children:"Curb and Sidewalk Rating"}),(0,se.jsx)("div",{className:"ratingDescription",children:"The curb and sidewalk rating is dependent on the ratio of designated curb or sidewalk points to section length. Street sections get a top score of 1.0 if the desired ratio is equal to or above the average ratio of all sections, excluding the sections with 0 designated sidewalks or curbs. Street sections get the minimum score of 0.1 if the ratio is 0. The scores in between are connected by a second-order polynomial."})]}),(0,se.jsxs)("div",{className:"rating",children:[(0,se.jsx)("div",{className:"ratingTitle",children:"PCI Rating"}),(0,se.jsx)("div",{className:"ratingDescription",children:"The PCI rating can be described as the square of the PCI divided by 100."})]}),(0,se.jsx)("br",{}),(0,se.jsx)("h3",{children:"The following figure shows the rating curves for all sub-ratings except PCI:"}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("img",{src:"/LAStreet/images/Sub-ratings.jpg",alt:"Sub-Ratings for Street Width, Sidewalk, and Curb",width:"80%"})]}),(0,se.jsx)("h2",{children:"Condition (Combined Rating)"}),(0,se.jsx)("p",{children:"The overall rating is a linear combination of all 4 categories and can be viewed in the following formula. The ratings R are precalculated, whereas the weights w are free to choose in the Hillside Street Prioritization Application. The more weight is assigned to a certain sub-rating category, compared to the other ones, the more important this sub-category becomes."}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"For Example: If the width rating weight is chosen to be 1 and all other rating weights are chosen to be 0, the full rating will just be based on the width of the street compared to its designated width."}),(0,se.jsx)("div",{className:"formula",children:(0,se.jsxs)("h3",{children:["Condition=R",(0,se.jsx)("span",{id:"sub",children:"width"}),"*w",(0,se.jsx)("span",{id:"sub",children:"width"}),"+R",(0,se.jsxs)("span",{id:"sub",children:["PCI",(0,se.jsx)("span",{id:"super",children:"2"})]}),"*w",(0,se.jsx)("span",{id:"sub",children:"PCI"}),"+R",(0,se.jsx)("span",{id:"sub",children:"Curb"}),"*w",(0,se.jsx)("span",{id:"sub",children:"Curb"}),"+R",(0,se.jsx)("span",{id:"sub",children:"Sidewalk"}),"*w",(0,se.jsx)("span",{id:"sub",children:"Sidewalk"})]})}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("h2",{children:"Importance Rating"}),(0,se.jsx)("p",{children:"In the following paragraph, the importance metric will be described. To analyze the whole network from a mathematical perspective, we have transformed the transportation network into a graph system. In this graph, all the road intersections are considered nodes or vertices, and the roads are considered edges or links."}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"The nodes and edges of this transportation graph satisfy the following criteria:"}),(0,se.jsx)("div",{className:"greyBox",style:{marginLeft:"70px"},children:(0,se.jsxs)("ol",{children:[(0,se.jsx)("li",{children:"The vertices must occur where more than 2 edges meet"}),(0,se.jsx)("li",{children:"The endpoints of edges are vertices/nodes"}),(0,se.jsx)("li",{children:"Nodes/vertices can occur in the middle of a link (then that link is separated into two links)"})]})}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Small Sample.jpg",alt:"Small Sample",width:"350px"}),(0,se.jsx)("p",{children:"Small sample graph to demonstrate the criteria"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"The LA Streets Network in graph representation contains 50924 Nodes and 70983 Edges. The graph representation of the LA Streets Network is displayed in the following figure."}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/LA Streets Network.jpg",alt:"LA Street Network",width:"550px"}),(0,se.jsx)("p",{children:"Graph representation of the LA Streets Network complete (left) and zoomed in (right) with nodes (red) and edges (blue)"})]}),(0,se.jsx)("h2",{children:"Definition of Importance"}),(0,se.jsx)("p",{children:"The objective here is to find out the importance of roads -- in terms of graph theory, the importance of edges. One good metric to find out important edges is \u201cedge betweenness centrality\u201d [4]."}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"In graph theory, edge betweenness centrality is a measure of importance or centrality of edges in a graph based on shortest paths. For every pair of nodes in a connected graph, there exists at least one shortest path between the nodes/vertices such that either the number of edges that the path passes through (for unweighted graphs) or the sum of the costs of the edges (for weighted graphs) is minimized. The edge betweenness centrality for each edge is directly related to the number of the shortest paths that pass through this specific edge. [5]"}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"One example of edge betweenness centrality is shown in the following Figure. In this graph, the most important link is highlighted in red as the most shortest paths pass through this link/edge."}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Example Network.jpg",alt:"Example Network",width:"550px"}),(0,se.jsx)("p",{children:"Example Network: The most important edge is highlighted"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"The mathematical expression for edge betweenness centrality is as follows:"}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Betweenness centrality of an edge e is the sum of the fraction of all-pairs shortest paths that pass through e. In other words, we find the shortest path from every node to every node in the whole network and for every edge, we count how many shortest paths pass through it. The edges with more shortest paths passing through it are getting a higher betweenness centrality value and hence, are more important."}),(0,se.jsx)("div",{className:"thingsInColumn",children:(0,se.jsx)("img",{src:"/LAStreet/images/Centrality Of An Edge.jpg",alt:"Centrality of An Edge",width:"550px"})}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"The following two figures highlight some of the most important streets in the LA street network, when importance is purely defined by betweenness centrality."}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/LA Road Network.jpg",alt:"LA Road Network",width:"250px"}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Important streets in Los Angeles based on betweenness centrality"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Important Streets.jpg",alt:"Important streets in LA based on betweenness centrality",width:"450px"}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Important streets in Los Angeles based on betweenness centrality in Google Maps [6]"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Following, we briefly discuss the concept of the shortest path \u2013 which is the basis of calculating the edge betweenness centrality. Assuming we have a graph like it's shown in the following figure. Each edge in this graph has an assigned cost that can be described for example by distance or travel time. The shortest path from node i to node j will always be the path that accumulates the least costs while traveling."}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Weighted Graph.jpg",alt:"Weighted Graph",width:"350px"}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Weighted graph (graph with assigned costs for every edge)"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"The following table shows the costs for different paths from node A to node B. From this table, it can be seen that the A-D-C-B accumulates the least amount of cost when traveling from node A to B. So, path A-D-C-B is considered to be the shortest path. To get more information to algorithmically find the shortest paths in a network, please refer to [7]."}),(0,se.jsxs)("table",{id:"myTable",children:[(0,se.jsxs)("tr",{children:[(0,se.jsx)("th",{children:"Path"}),(0,se.jsx)("th",{children:"Cost"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"A-B"}),(0,se.jsx)("td",{children:"6 miles"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"A-D-B"}),(0,se.jsx)("td",{children:"7 miles"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"A-D-C-B"}),(0,se.jsx)("td",{children:"5 miles"})]})]}),(0,se.jsx)("h2",{children:"Types of Costs"}),(0,se.jsx)("p",{children:"Converting the LA Streets Network to a graph initially leads to receiving an unweighted graph (that has no costs assigned to any edges). The graph representation of the LA Streets Network contains 50924 Nodes and 70983 Edges. To assign costs to the edges, the following quantities are used:"}),(0,se.jsxs)("div",{className:"typesOfCosts",children:[(0,se.jsxs)("div",{className:"quantities",children:[(0,se.jsx)("div",{className:"quantityTitle",children:"Distance"}),(0,se.jsx)("div",{className:"quantityDescription",children:"The most intuitive way to describe the cost of traveling from one point to another might be the distance. This distance can be measured for example in feet, meters, miles, or kilometers. The cost will be proportionally dependent on the distance."})]}),(0,se.jsxs)("div",{className:"quantities",children:[(0,se.jsx)("div",{className:"quantityTitle",children:"Travel Time:"}),(0,se.jsx)("div",{className:"quantityDescription",children:"As the pure distance does not consider any traffic information or maximum speed limit, travel time can be used as a cost in the network. A cost assigned by travel time will serve well for daily traffic flow. The travel time can be measured for example in seconds or minutes. The assigned cost is proportionally dependent on the travel time."})]}),(0,se.jsxs)("div",{className:"quantities",children:[(0,se.jsx)("div",{className:"quantityTitle",children:"Street Width"}),(0,se.jsx)("div",{className:"quantityDescription",children:"The street width is the only metric that is included in both, condition rating and importance rating. The street width is measured for example in feet. When using the street width as a cost, wider streets get assigned lower costs. In other words, street width and assigned cost behave inversely proportional."})]}),(0,se.jsxs)("div",{className:"quantities",children:[(0,se.jsx)("div",{className:"quantityTitle",children:"Population:"}),(0,se.jsx)("div",{className:"quantityDescription",children:"Another approach is to use population information as costs. Each edge has population information assigned that can be inverted to get a cost. Same as with width, population information and assigned cost will behave proportionally. So, streets with a high population will have low costs. This metric can be used to focus more on streets that are located in population-dense areas."})]})]}),(0,se.jsx)("h2",{children:"Importance Data Acquisition"}),(0,se.jsx)("p",{children:"Following, the data acquisition for all importance metrics is described."}),(0,se.jsx)("div",{className:"importanceMetrics",children:(0,se.jsxs)("div",{className:"metrics",children:[(0,se.jsx)("div",{className:"metricTitle",children:"Distance and Travel Time:"}),(0,se.jsx)("div",{className:"metricDescription",children:"Distance and travel time information was collected by using Google Distance Matrix API [8]. In total, 70983 requests have been made, to receive travel time and distance information for every edge in the graph, using the two connecting node coordinates of each edge as an input. This procedure is equivalent to asking Google Maps to give travel time information from every intersection in Los Angeles to its neighboring intersections. The following figure shows the output for one particular request, compared to an equivalent google maps request."}),(0,se.jsx)("br",{}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Google Maps Request.jpg",alt:"Google Maps Request",width:"850px"}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Google Maps [6] request (left) and Google Distance Matrix API [8] request (right)"})]})]})}),(0,se.jsx)("div",{className:"importanceMetrics",children:(0,se.jsxs)("div",{className:"metrics",children:[(0,se.jsx)("div",{className:"metricTitle",children:"Street Width"}),(0,se.jsx)("div",{className:"metricDescription",children:"Street width information is taken from StreetsLA GeoHub."})]})}),(0,se.jsx)("div",{className:"importanceMetrics",children:(0,se.jsxs)("div",{className:"metrics",children:[(0,se.jsx)("div",{className:"metricTitle",children:"Population"}),(0,se.jsx)("div",{className:"metricDescription",children:"Population information is pulled from Census Blocks 2020 GIS dataset on Los Angeles Geohub. The dataset provides spatial population information in form of polygons. The edges of these polygons usually overlap with the road network as shown in the following image."}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Census Blocks Layer.jpg",alt:"Google Maps Request",width:"750px"}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Census Blocks Layer on Los Angeles Geohub [2]"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("div",{className:"metricDescription",children:"To allocate population values to certain street sections, additional points in a 1-meter distance were added to each polygon edge. Then, for each point, the closest street section was found. The total population is then divided into the neighboring sections, based on the number of closest points for each section. A sample calculation can be viewed in the following image. In this example, there are only two polygons containing the population. The total population is assigned to the neighboring street segments, whereas longer edges receive larger shares of the total population. Street sections can receive population shares from several polygons. These shares will be summed up."}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("img",{src:"/LAStreet/images/Population Allocation.jpg",alt:"Population allocation to street sections",width:"650px"}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Population allocation to street sections"})]})]})}),(0,se.jsx)("h2",{children:"Importance (Combined Centrality)"}),(0,se.jsx)("p",{children:"Same as the combined condition rating, the combined importance rating is a linear combination of sub-centralities. For every cost type (distance, travel time, width, population) a full centrality analysis is performed. Based on these sub-centralities C and chosen weights w, the combined centrality can be calculated by the following formula. We denote this combined centrality as importance."}),(0,se.jsx)("div",{className:"formula",children:(0,se.jsxs)("h3",{children:["Importance=C",(0,se.jsx)("span",{id:"sub",children:"distance"}),"*w",(0,se.jsx)("span",{id:"sub",children:"distance"}),"+C",(0,se.jsx)("span",{id:"sub",children:"time"}),"*w",(0,se.jsx)("span",{id:"sub",children:"time"}),"+C",(0,se.jsx)("span",{id:"sub",children:"width"}),"*w",(0,se.jsx)("span",{id:"sub",children:"width"}),"+C",(0,se.jsx)("span",{id:"sub",children:"population"}),"*w",(0,se.jsx)("span",{id:"sub",children:"population"})]})}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"As described earlier, the weights are free to choose based on the user's preferences. For example, if the everyday traffic flow is important for the user, weights for travel time and population should be high. Whereas, if police or ambulance operations are important for the user, weights for distance and width should be high."}),(0,se.jsx)("h2",{children:"Combining all information"}),(0,se.jsx)("p",{children:"Hillside Street Prioritization Application shows a scatter plot to the user. Every point of this scatter plot represents a street section. The location of the point indicates the street section's condition and importance, whereas the condition is described by the x-axis, and the importance is described by the y-axis. This scatter plot is changing when the user changes weights (Condition weights or Importance Weights). The street sections in the top left corner can be described as the street sections with the highest importance and the worst condition."}),(0,se.jsx)("h2",{children:"Instructions:"}),(0,se.jsx)("div",{className:"instructions",style:{marginLeft:"70px",marginTop:"-50px"},children:(0,se.jsxs)("ol",{children:[(0,se.jsx)("li",{children:'Select target designations that you want to investigate in the "Select Designations"-option. For example: If you are only focusing on local streets, just select "Local Street-Standard" as a designation. You\'ll only receive local streets in the output.'}),(0,se.jsx)("li",{children:"Select a target area. This can either be the northern, central, or southern part of Los Angeles. You are to select multiple areas."}),(0,se.jsx)("li",{children:"Select weights for all subcategories for importance and condition. For more information on the weights, see the documentation."}),(0,se.jsx)("li",{children:"Review the scatter plot in Tooltip mode, and draw your region of interest in Brush Mode"}),(0,se.jsx)("li",{children:"After setting up your region of interest, check the result on the LA Streets Network plot on the right. You can change anything you want iteratively."})]})}),(0,se.jsx)("h2",{children:"References"}),(0,se.jsx)("div",{className:"instructions",style:{marginLeft:"70px",marginTop:"-50px"},children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:"https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwi7s4DI7cv3AhW6IUQIHSdUAy4QFnoECA0QAQ&url=https%3A%2F%2Fplanning.lacity.org%2Fodocument%2Fc9596f05-0f3a-4ada-93aa-e70bbde68b0b%2FComplete_Street_Design_Guide.pdf&usg=AOvVaw2U1LY5i-CNH7cVImvTVj-W",children:"[1]"})}),(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:" https://geohub.lacity.org/",children:"[2]"})}),(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:" http://webspace.ship.edu/pgmarr/TransMeth/Lec%201-Network%20Measurements.pdf",children:"[3]"})}),(0,se.jsx)("li",{children:'Freeman, Linton C. "A set of measures of centrality based on betweenness." Sociometry (1977): 35-41.'}),(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:"  https://en.wikipedia.org/wiki/Betweenness_centrality",children:"[5]"})}),(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:" https://www.google.com/maps",children:"[6]"})}),(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:"  https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm",children:"[7]"})}),(0,se.jsx)("li",{children:(0,se.jsx)("a",{href:"  https://developers.google.com/maps/documentation/distance-matrix",children:"[8]"})})]})})]})})};var ve=function(){var e=o((0,t.useState)(0),2),n=(e[0],e[1]),r=function(){return n(window.pageYOffset)};return(0,t.useEffect)((function(){return window.addEventListener("scroll",r),function(){return window.removeEventListener("scroll",r)}}),[]),(0,se.jsxs)("div",{children:[(0,se.jsx)("div",{className:"section",id:"home",children:(0,se.jsx)(de,{})}),(0,se.jsx)("div",{className:"section",id:"infoBox",children:(0,se.jsx)(fe,{})}),(0,se.jsx)("div",{className:"section",id:"documentation",children:(0,se.jsx)(pe,{})})]})};function me(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ge(e){var t;return 1===e.length&&(t=e,e=function(e,n){return me(t(e),n)}),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var a=r+i>>>1;e(t[a],n)<0?r=a+1:i=a}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var a=r+i>>>1;e(t[a],n)>0?i=a:r=a+1}return r}}}var _e=ge(me),ye=_e.right,be=(_e.left,ye),xe=Array.prototype,we=(xe.slice,xe.map,Math.sqrt(50)),ke=Math.sqrt(10),Se=Math.sqrt(2);function Me(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=Ce(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(e=Math.floor(e*o),t=Math.ceil(t*o),a=new Array(i=Math.ceil(e-t+1));++s<i;)a[s]=(e-s)/o;return r&&a.reverse(),a}function Ce(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=we?10:a>=ke?5:a>=Se?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=we?10:a>=ke?5:a>=Se?2:1)}function Te(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=we?i*=10:a>=ke?i*=5:a>=Se&&(i*=2),t<e?-i:i}function Ee(e,t){var n,r,i=e.length,a=-1;if(null==t){for(;++a<i;)if(null!=(n=e[a])&&n>=n)for(r=n;++a<i;)null!=(n=e[a])&&n>r&&(r=n)}else for(;++a<i;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=n;++a<i;)null!=(n=t(e[a],a,e))&&n>r&&(r=n);return r}function Pe(e){for(var t,n,r,i=e.length,a=-1,o=0;++a<i;)o+=e[a].length;for(n=new Array(o);--i>=0;)for(t=(r=e[i]).length;--t>=0;)n[--o]=r[t];return n}function Ae(e,t){var n,r,i=e.length,a=-1;if(null==t){for(;++a<i;)if(null!=(n=e[a])&&n>=n)for(r=n;++a<i;)null!=(n=e[a])&&r>n&&(r=n)}else for(;++a<i;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=n;++a<i;)null!=(n=t(e[a],a,e))&&r>n&&(r=n);return r}function Le(e,t){if(n=e.length){var n,r,i=0,a=0,o=e[a];for(null==t&&(t=me);++i<n;)(t(r=e[i],o)<0||0!==t(o,o))&&(o=r,a=i);return 0===t(o,o)?a:void 0}}var Ie=Array.prototype.slice;function Re(e){return e}var Oe=1e-6;function Ne(e){return"translate("+(e+.5)+",0)"}function De(e){return"translate(0,"+(e+.5)+")"}function ze(e){return function(t){return+e(t)}}function je(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(n){return+e(n)+t}}function Be(){return!this.__axis}function Fe(e,t){var n=[],r=null,i=null,a=6,o=6,s=3,u=1===e||4===e?-1:1,l=4===e||2===e?"x":"y",c=1===e||3===e?Ne:De;function h(h){var d=null==r?t.ticks?t.ticks.apply(t,n):t.domain():r,f=null==i?t.tickFormat?t.tickFormat.apply(t,n):Re:i,p=Math.max(a,0)+s,v=t.range(),m=+v[0]+.5,g=+v[v.length-1]+.5,_=(t.bandwidth?je:ze)(t.copy()),y=h.selection?h.selection():h,b=y.selectAll(".domain").data([null]),x=y.selectAll(".tick").data(d,t).order(),w=x.exit(),k=x.enter().append("g").attr("class","tick"),S=x.select("line"),M=x.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(k),S=S.merge(k.append("line").attr("stroke","currentColor").attr(l+"2",u*a)),M=M.merge(k.append("text").attr("fill","currentColor").attr(l,u*p).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),h!==y&&(b=b.transition(h),x=x.transition(h),S=S.transition(h),M=M.transition(h),w=w.transition(h).attr("opacity",Oe).attr("transform",(function(e){return isFinite(e=_(e))?c(e):this.getAttribute("transform")})),k.attr("opacity",Oe).attr("transform",(function(e){var t=this.parentNode.__axis;return c(t&&isFinite(t=t(e))?t:_(e))}))),w.remove(),b.attr("d",4===e||2==e?o?"M"+u*o+","+m+"H0.5V"+g+"H"+u*o:"M0.5,"+m+"V"+g:o?"M"+m+","+u*o+"V0.5H"+g+"V"+u*o:"M"+m+",0.5H"+g),x.attr("opacity",1).attr("transform",(function(e){return c(_(e))})),S.attr(l+"2",u*a),M.attr(l,u*p).text(f),y.filter(Be).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),y.each((function(){this.__axis=_}))}return h.scale=function(e){return arguments.length?(t=e,h):t},h.ticks=function(){return n=Ie.call(arguments),h},h.tickArguments=function(e){return arguments.length?(n=null==e?[]:Ie.call(e),h):n.slice()},h.tickValues=function(e){return arguments.length?(r=null==e?null:Ie.call(e),h):r&&r.slice()},h.tickFormat=function(e){return arguments.length?(i=e,h):i},h.tickSize=function(e){return arguments.length?(a=o=+e,h):a},h.tickSizeInner=function(e){return arguments.length?(a=+e,h):a},h.tickSizeOuter=function(e){return arguments.length?(o=+e,h):o},h.tickPadding=function(e){return arguments.length?(s=+e,h):s},h}function $e(e){return Fe(1,e)}function qe(e){return Fe(2,e)}function Ue(e){return Fe(3,e)}function Ve(e){return Fe(4,e)}var He={value:function(){}};function We(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Ge(r)}function Ge(e){this._=e}function Ze(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function Ye(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function Xe(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=He,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Ge.prototype=We.prototype={constructor:Ge,on:function(e,t){var n,r=this._,i=Ze(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=Xe(r[n],e.name,t);else if(null==t)for(n in r)r[n]=Xe(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=Ye(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ge(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var Ke=We;function Je(){}function Qe(e){return null==e?Je:function(){return this.querySelector(e)}}function et(){return[]}function tt(e){return null==e?et:function(){return this.querySelectorAll(e)}}function nt(e){return function(){return this.matches(e)}}function rt(e){return new Array(e.length)}function it(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}it.prototype={constructor:it,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function at(e,t,n,r,i,a){for(var o,s=0,u=t.length,l=a.length;s<l;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new it(e,a[s]);for(;s<u;++s)(o=t[s])&&(i[s]=o)}function ot(e,t,n,r,i,a,o){var s,u,l,c={},h=t.length,d=a.length,f=new Array(h);for(s=0;s<h;++s)(u=t[s])&&(f[s]=l="$"+o.call(u,u.__data__,s,t),l in c?i[s]=u:c[l]=u);for(s=0;s<d;++s)(u=c[l="$"+o.call(e,a[s],s,a)])?(r[s]=u,u.__data__=a[s],c[l]=null):n[s]=new it(e,a[s]);for(s=0;s<h;++s)(u=t[s])&&c[f[s]]===u&&(i[s]=u)}function st(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var ut="http://www.w3.org/1999/xhtml",lt={svg:"http://www.w3.org/2000/svg",xhtml:ut,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ct(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),lt.hasOwnProperty(t)?{space:lt[t],local:e}:e}function ht(e){return function(){this.removeAttribute(e)}}function dt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ft(e,t){return function(){this.setAttribute(e,t)}}function pt(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function vt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function mt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function gt(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function _t(e){return function(){this.style.removeProperty(e)}}function yt(e,t,n){return function(){this.style.setProperty(e,t,n)}}function bt(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function xt(e,t){return e.style.getPropertyValue(t)||gt(e).getComputedStyle(e,null).getPropertyValue(t)}function wt(e){return function(){delete this[e]}}function kt(e,t){return function(){this[e]=t}}function St(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Mt(e){return e.trim().split(/^|\s+/)}function Ct(e){return e.classList||new Tt(e)}function Tt(e){this._node=e,this._names=Mt(e.getAttribute("class")||"")}function Et(e,t){for(var n=Ct(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Pt(e,t){for(var n=Ct(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function At(e){return function(){Et(this,e)}}function Lt(e){return function(){Pt(this,e)}}function It(e,t){return function(){(t.apply(this,arguments)?Et:Pt)(this,e)}}function Rt(){this.textContent=""}function Ot(e){return function(){this.textContent=e}}function Nt(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Dt(){this.innerHTML=""}function zt(e){return function(){this.innerHTML=e}}function jt(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Bt(){this.nextSibling&&this.parentNode.appendChild(this)}function Ft(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function $t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ut&&t.documentElement.namespaceURI===ut?t.createElement(e):t.createElementNS(n,e)}}function qt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Ut(e){var t=ct(e);return(t.local?qt:$t)(t)}function Vt(){return null}function Ht(){var e=this.parentNode;e&&e.removeChild(this)}function Wt(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Gt(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}Tt.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Zt={},Yt=null;"undefined"!==typeof document&&("onmouseenter"in document.documentElement||(Zt={mouseenter:"mouseover",mouseleave:"mouseout"}));function Xt(e,t,n){return e=Kt(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function Kt(e,t,n){return function(r){var i=Yt;Yt=r;try{e.call(this,this.__data__,t,n)}finally{Yt=i}}}function Jt(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function Qt(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?t.length=i:delete this.__on}}}function en(e,t,n){var r=Zt.hasOwnProperty(e.type)?Xt:Kt;return function(i,a,o){var s,u=this.__on,l=r(t,a,o);if(u)for(var c=0,h=u.length;c<h;++c)if((s=u[c]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=t);this.addEventListener(e.type,l,n),s={type:e.type,name:e.name,value:t,listener:l,capture:n},u?u.push(s):this.__on=[s]}}function tn(e,t,n,r){var i=Yt;e.sourceEvent=Yt,Yt=e;try{return t.apply(n,r)}finally{Yt=i}}function nn(e,t,n){var r=gt(e),i=r.CustomEvent;"function"===typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function rn(e,t){return function(){return nn(this,e,t)}}function an(e,t){return function(){return nn(this,e,t.apply(this,arguments))}}var on=[null];function sn(e,t){this._groups=e,this._parents=t}function un(){return new sn([[document.documentElement]],on)}sn.prototype=un.prototype={constructor:sn,select:function(e){"function"!==typeof e&&(e=Qe(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],u=s.length,l=r[i]=new Array(u),c=0;c<u;++c)(a=s[c])&&(o=e.call(a,a.__data__,c,s))&&("__data__"in a&&(o.__data__=a.__data__),l[c]=o);return new sn(r,this._parents)},selectAll:function(e){"function"!==typeof e&&(e=tt(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],u=s.length,l=0;l<u;++l)(o=s[l])&&(r.push(e.call(o,o.__data__,l,s)),i.push(o));return new sn(r,i)},filter:function(e){"function"!==typeof e&&(e=nt(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new sn(r,this._parents)},data:function(e,t){if(!e)return f=new Array(this.size()),l=-1,this.each((function(e){f[++l]=e})),f;var n=t?ot:at,r=this._parents,i=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=r[l],h=i[l],d=h.length,f=e.call(c,c&&c.__data__,l,r),p=f.length,v=s[l]=new Array(p),m=o[l]=new Array(p);n(c,h,v,m,u[l]=new Array(d),f,t);for(var g,_,y=0,b=0;y<p;++y)if(g=v[y]){for(y>=b&&(b=y+1);!(_=m[b])&&++b<p;);g._next=_||null}}return(o=new sn(o,r))._enter=s,o._exit=u,o},enter:function(){return new sn(this._enter||this._groups.map(rt),this._parents)},exit:function(){return new sn(this._exit||this._groups.map(rt),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,a=this.exit();return r="function"===typeof e?e(r):r.append(e+""),null!=t&&(i=t(i)),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,l=t[s],c=n[s],h=l.length,d=o[s]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(d[f]=u);for(;s<r;++s)o[s]=t[s];return new sn(o,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=st);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],u=s.length,l=i[a]=new Array(u),c=0;c<u;++c)(o=s[c])&&(l[c]=o);l.sort(t)}return new sn(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=ct(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?dt:ht:"function"===typeof t?n.local?mt:vt:n.local?pt:ft)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?_t:"function"===typeof t?bt:yt)(e,t,null==n?"":n)):xt(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?wt:"function"===typeof t?St:kt)(e,t)):this.node()[e]},classed:function(e,t){var n=Mt(e+"");if(arguments.length<2){for(var r=Ct(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"===typeof t?It:t?At:Lt)(n,t))},text:function(e){return arguments.length?this.each(null==e?Rt:("function"===typeof e?Nt:Ot)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Dt:("function"===typeof e?jt:zt)(e)):this.node().innerHTML},raise:function(){return this.each(Bt)},lower:function(){return this.each(Ft)},append:function(e){var t="function"===typeof e?e:Ut(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"===typeof e?e:Ut(e),r=null==t?Vt:"function"===typeof t?t:Qe(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Ht)},clone:function(e){return this.select(e?Gt:Wt)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=Jt(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?en:Qt,null==n&&(n=!1),r=0;r<o;++r)this.each(s(a[r],t,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(r=0,u=s[l];r<o;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"===typeof t?an:rn)(e,t))}};var ln=un;function cn(e){return"string"===typeof e?new sn([[document.querySelector(e)]],[document.documentElement]):new sn([[e]],on)}function hn(){Yt.stopImmediatePropagation()}function dn(){Yt.preventDefault(),Yt.stopImmediatePropagation()}function fn(e){var t=e.document.documentElement,n=cn(e).on("dragstart.drag",dn,!0);"onselectstart"in t?n.on("selectstart.drag",dn,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function pn(e,t){var n=e.document.documentElement,r=cn(e).on("dragstart.drag",null);t&&(r.on("click.drag",dn,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function vn(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function mn(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function gn(){}var _n=.7,yn=1/_n,bn="\\s*([+-]?\\d+)\\s*",xn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",wn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kn=/^#([0-9a-f]{3,8})$/,Sn=new RegExp("^rgb\\("+[bn,bn,bn]+"\\)$"),Mn=new RegExp("^rgb\\("+[wn,wn,wn]+"\\)$"),Cn=new RegExp("^rgba\\("+[bn,bn,bn,xn]+"\\)$"),Tn=new RegExp("^rgba\\("+[wn,wn,wn,xn]+"\\)$"),En=new RegExp("^hsl\\("+[xn,wn,wn]+"\\)$"),Pn=new RegExp("^hsla\\("+[xn,wn,wn,xn]+"\\)$"),An={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ln(){return this.rgb().formatHex()}function In(){return this.rgb().formatRgb()}function Rn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=kn.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?On(t):3===n?new jn(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Nn(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Nn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Sn.exec(e))?new jn(t[1],t[2],t[3],1):(t=Mn.exec(e))?new jn(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Cn.exec(e))?Nn(t[1],t[2],t[3],t[4]):(t=Tn.exec(e))?Nn(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=En.exec(e))?qn(t[1],t[2]/100,t[3]/100,1):(t=Pn.exec(e))?qn(t[1],t[2]/100,t[3]/100,t[4]):An.hasOwnProperty(e)?On(An[e]):"transparent"===e?new jn(NaN,NaN,NaN,0):null}function On(e){return new jn(e>>16&255,e>>8&255,255&e,1)}function Nn(e,t,n,r){return r<=0&&(e=t=n=NaN),new jn(e,t,n,r)}function Dn(e){return e instanceof gn||(e=Rn(e)),e?new jn((e=e.rgb()).r,e.g,e.b,e.opacity):new jn}function zn(e,t,n,r){return 1===arguments.length?Dn(e):new jn(e,t,n,null==r?1:r)}function jn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Bn(){return"#"+$n(this.r)+$n(this.g)+$n(this.b)}function Fn(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function $n(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function qn(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Vn(e,t,n,r)}function Un(e){if(e instanceof Vn)return new Vn(e.h,e.s,e.l,e.opacity);if(e instanceof gn||(e=Rn(e)),!e)return new Vn;if(e instanceof Vn)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new Vn(o,s,u,e.opacity)}function Vn(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Hn(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Wn(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function Gn(e){return function(){return e}}function Zn(e,t){return function(n){return e+n*t}}function Yn(e){return 1===(e=+e)?Xn:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Gn(isNaN(t)?n:t)}}function Xn(e,t){var n=t-e;return n?Zn(e,n):Gn(isNaN(e)?t:e)}vn(gn,Rn,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Ln,formatHex:Ln,formatHsl:function(){return Un(this).formatHsl()},formatRgb:In,toString:In}),vn(jn,zn,mn(gn,{brighter:function(e){return e=null==e?yn:Math.pow(yn,e),new jn(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?_n:Math.pow(_n,e),new jn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bn,formatHex:Bn,formatRgb:Fn,toString:Fn})),vn(Vn,(function(e,t,n,r){return 1===arguments.length?Un(e):new Vn(e,t,n,null==r?1:r)}),mn(gn,{brighter:function(e){return e=null==e?yn:Math.pow(yn,e),new Vn(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?_n:Math.pow(_n,e),new Vn(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new jn(Hn(e>=240?e-240:e+120,i,r),Hn(e,i,r),Hn(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var Kn=function e(t){var n=Yn(t);function r(e,t){var r=n((e=zn(e)).r,(t=zn(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Xn(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function Jn(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=zn(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}Jn((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return Wn((n-r/t)*t,o,i,a,s)}})),Jn((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return Wn((n-r/t)*t,i,a,o,s)}}));function Qn(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=sr(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function er(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function tr(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function nr(e,t){var n,r={},i={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?r[n]=sr(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var rr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ir=new RegExp(rr.source,"g");function ar(e,t){var n,r,i,a=rr.lastIndex=ir.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=rr.exec(e))&&(r=ir.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:tr(n,r)})),a=ir.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function or(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function sr(e,t){var n,r=typeof t;return null==t||"boolean"===r?Gn(t):("number"===r?tr:"string"===r?(n=Rn(t))?(t=n,Kn):ar:t instanceof Rn?Kn:t instanceof Date?er:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?or:Array.isArray(t)?Qn:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?nr:tr)(e,t)}function ur(){for(var e,t=Yt;e=t.sourceEvent;)t=e;return t}function lr(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function cr(e,t,n){arguments.length<3&&(n=t,t=ur().changedTouches);for(var r,i=0,a=t?t.length:0;i<a;++i)if((r=t[i]).identifier===n)return lr(e,r);return null}function hr(e){var t=ur();return t.changedTouches&&(t=t.changedTouches[0]),lr(e,t)}var dr,fr,pr=0,vr=0,mr=0,gr=0,_r=0,yr=0,br="object"===typeof performance&&performance.now?performance:Date,xr="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function wr(){return _r||(xr(kr),_r=br.now()+yr)}function kr(){_r=0}function Sr(){this._call=this._time=this._next=null}function Mr(e,t,n){var r=new Sr;return r.restart(e,t,n),r}function Cr(){_r=(gr=br.now())+yr,pr=vr=0;try{!function(){wr(),++pr;for(var e,t=dr;t;)(e=_r-t._time)>=0&&t._call.call(null,e),t=t._next;--pr}()}finally{pr=0,function(){var e,t,n=dr,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:dr=t);fr=e,Er(r)}(),_r=0}}function Tr(){var e=br.now(),t=e-gr;t>1e3&&(yr-=t,gr=e)}function Er(e){pr||(vr&&(vr=clearTimeout(vr)),e-_r>24?(e<1/0&&(vr=setTimeout(Cr,e-br.now()-yr)),mr&&(mr=clearInterval(mr))):(mr||(gr=br.now(),mr=setInterval(Tr,1e3)),pr=1,xr(Cr)))}function Pr(e,t,n){var r=new Sr;return t=null==t?0:+t,r.restart((function(n){r.stop(),e(n+t)}),t,n),r}Sr.prototype=Mr.prototype={constructor:Sr,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?wr():+n)+(null==t?0:+t),this._next||fr===this||(fr?fr._next=this:dr=this,fr=this),this._call=e,this._time=n,Er()},stop:function(){this._call&&(this._call=null,this._time=1/0,Er())}};var Ar=Ke("start","end","cancel","interrupt"),Lr=[];function Ir(e,t,n,r,i,a){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function a(e){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=e&&o(e-n.delay)}function o(a){var l,c,h,d;if(1!==n.state)return u();for(l in i)if((d=i[l]).name===n.name){if(3===d.state)return Pr(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete i[l]):+l<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete i[l])}if(Pr((function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(a))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),l=0,c=-1;l<h;++l)(d=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=d);r.length=c+1}}function s(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(u),n.state=5,1),a=-1,o=r.length;++a<o;)r[a].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=Mr(a,0,n.time)}(e,n,{name:t,index:r,group:i,on:Ar,tween:Lr,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function Rr(e,t){var n=Nr(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Or(e,t){var n=Nr(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Nr(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Dr(e,t){var n,r,i,a=e.__transition,o=!0;if(a){for(i in t=null==t?null:t+"",a)(n=a[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[i]):o=!1;o&&delete e.__transition}}var zr,jr,Br,Fr,$r=180/Math.PI,qr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ur(e,t,n,r,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*$r,skewX:Math.atan(u)*$r,scaleX:o,scaleY:s}}function Vr(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],u=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var u=o.push("translate(",null,t,null,n);s.push({i:u-4,x:tr(e,i)},{i:u-2,x:tr(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:tr(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,u),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:tr(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,u),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:tr(e,n)},{i:s-2,x:tr(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(e){for(var t,n=-1,r=u.length;++n<r;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var Hr=Vr((function(e){return"none"===e?qr:(zr||(zr=document.createElement("DIV"),jr=document.documentElement,Br=document.defaultView),zr.style.transform=e,e=Br.getComputedStyle(jr.appendChild(zr),null).getPropertyValue("transform"),jr.removeChild(zr),Ur(+(e=e.slice(7,-1).split(","))[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}),"px, ","px)","deg)"),Wr=Vr((function(e){return null==e?qr:(Fr||(Fr=document.createElementNS("http://www.w3.org/2000/svg","g")),Fr.setAttribute("transform",e),(e=Fr.transform.baseVal.consolidate())?Ur((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):qr)}),", ",")",")");function Gr(e,t){var n,r;return function(){var i=Or(this,e),a=i.tween;if(a!==n)for(var o=0,s=(r=n=a).length;o<s;++o)if(r[o].name===t){(r=r.slice()).splice(o,1);break}i.tween=r}}function Zr(e,t,n){var r,i;if("function"!==typeof n)throw new Error;return function(){var a=Or(this,e),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:t,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function Yr(e,t,n){var r=e._id;return e.each((function(){var e=Or(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return Nr(e,r).value[t]}}function Xr(e,t){var n;return("number"===typeof t?tr:t instanceof Rn?Kn:(n=Rn(t))?(t=n,Kn):ar)(e,t)}function Kr(e){return function(){this.removeAttribute(e)}}function Jr(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Qr(e,t,n){var r,i,a=n+"";return function(){var o=this.getAttribute(e);return o===a?null:o===r?i:i=t(r=o,n)}}function ei(e,t,n){var r,i,a=n+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===r?i:i=t(r=o,n)}}function ti(e,t,n){var r,i,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttribute(e))===(s=u+"")?null:o===r&&s===i?a:(i=s,a=t(r=o,u));this.removeAttribute(e)}}function ni(e,t,n){var r,i,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttributeNS(e.space,e.local))===(s=u+"")?null:o===r&&s===i?a:(i=s,a=t(r=o,u));this.removeAttributeNS(e.space,e.local)}}function ri(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ii(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ai(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&ii(e,i)),n}return i._value=t,i}function oi(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&ri(e,i)),n}return i._value=t,i}function si(e,t){return function(){Rr(this,e).delay=+t.apply(this,arguments)}}function ui(e,t){return t=+t,function(){Rr(this,e).delay=t}}function li(e,t){return function(){Or(this,e).duration=+t.apply(this,arguments)}}function ci(e,t){return t=+t,function(){Or(this,e).duration=t}}function hi(e,t){if("function"!==typeof t)throw new Error;return function(){Or(this,e).ease=t}}function di(e,t,n){var r,i,a=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?Rr:Or;return function(){var o=a(this,e),s=o.on;s!==r&&(i=(r=s).copy()).on(t,n),o.on=i}}var fi=ln.prototype.constructor;function pi(e){return function(){this.style.removeProperty(e)}}function vi(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function mi(e,t,n){var r,i;function a(){var a=t.apply(this,arguments);return a!==i&&(r=(i=a)&&vi(e,a,n)),r}return a._value=t,a}function gi(e){return function(t){this.textContent=e.call(this,t)}}function _i(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&gi(r)),t}return r._value=e,r}var yi=0;function bi(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function xi(){return++yi}var wi=ln.prototype;bi.prototype=function(e){return ln().transition(e)}.prototype={constructor:bi,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=Qe(e));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s,u,l=r[o],c=l.length,h=a[o]=new Array(c),d=0;d<c;++d)(s=l[d])&&(u=e.call(s,s.__data__,d,l))&&("__data__"in s&&(u.__data__=s.__data__),h[d]=u,Ir(h[d],t,n,d,h,Nr(s,n)));return new bi(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=tt(e));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var u,l=r[s],c=l.length,h=0;h<c;++h)if(u=l[h]){for(var d,f=e.call(u,u.__data__,h,l),p=Nr(u,n),v=0,m=f.length;v<m;++v)(d=f[v])&&Ir(d,t,n,v,f,p);a.push(f),o.push(u)}return new bi(a,o,t,n)},filter:function(e){"function"!==typeof e&&(e=nt(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new bi(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,l=t[s],c=n[s],h=l.length,d=o[s]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(d[f]=u);for(;s<r;++s)o[s]=t[s];return new bi(o,this._parents,this._name,this._id)},selection:function(){return new fi(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=xi(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],u=s.length,l=0;l<u;++l)if(o=s[l]){var c=Nr(o,t);Ir(o,e,n,l,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new bi(r,this._parents,e,n)},call:wi.call,nodes:wi.nodes,node:wi.node,size:wi.size,empty:wi.empty,each:wi.each,on:function(e,t){var n=this._id;return arguments.length<2?Nr(this.node(),n).on.on(e):this.each(di(n,e,t))},attr:function(e,t){var n=ct(e),r="transform"===n?Wr:Xr;return this.attrTween(e,"function"===typeof t?(n.local?ni:ti)(n,r,Yr(this,"attr."+e,t)):null==t?(n.local?Jr:Kr)(n):(n.local?ei:Qr)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var r=ct(e);return this.tween(n,(r.local?ai:oi)(r,t))},style:function(e,t,n){var r="transform"===(e+="")?Hr:Xr;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var a=xt(this,e),o=(this.style.removeProperty(e),xt(this,e));return a===o?null:a===n&&o===r?i:i=t(n=a,r=o)}}(e,r)).on("end.style."+e,pi(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var r,i,a;return function(){var o=xt(this,e),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(e),u=s=xt(this,e)),o===u?null:o===r&&u===i?a:(i=u,a=t(r=o,s))}}(e,r,Yr(this,"style."+e,t))).each(function(e,t){var n,r,i,a,o="style."+t,s="end."+o;return function(){var u=Or(this,e),l=u.on,c=null==u.value[o]?a||(a=pi(t)):void 0;l===n&&i===c||(r=(n=l).copy()).on(s,i=c),u.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,a=n+"";return function(){var o=xt(this,e);return o===a?null:o===r?i:i=t(r=o,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!==typeof t)throw new Error;return this.tween(r,mi(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(Yr(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,_i(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=Nr(this.node(),n).tween,a=0,o=i.length;a<o;++a)if((r=i[a]).name===e)return r.value;return null}return this.each((null==t?Gr:Zr)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?si:ui)(t,e)):Nr(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?li:ci)(t,e)):Nr(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(hi(t,e)):Nr(this.node(),t).ease},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise((function(a,o){var s={value:o},u={value:function(){0===--i&&a()}};n.each((function(){var n=Or(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),n.on=t}))}))}};var ki={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Si(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return ki.time=wr(),ki;return n}ln.prototype.interrupt=function(e){return this.each((function(){Dr(this,e)}))},ln.prototype.transition=function(e){var t,n;e instanceof bi?(t=e._id,e=e._name):(t=xi(),(n=ki).time=wr(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],u=s.length,l=0;l<u;++l)(o=s[l])&&Ir(o,e,t,l,s,n||Si(o,t));return new bi(r,this._parents,e,t)};function Mi(e){return function(){return e}}function Ci(e,t,n){this.target=e,this.type=t,this.selection=n}function Ti(){Yt.stopImmediatePropagation()}function Ei(){Yt.preventDefault(),Yt.stopImmediatePropagation()}var Pi={name:"drag"},Ai={name:"space"},Li={name:"handle"},Ii={name:"center"};function Ri(e){return[+e[0],+e[1]]}function Oi(e){return[Ri(e[0]),Ri(e[1])]}function Ni(e){return function(t){return cr(t,Yt.touches,e)}}var Di={name:"x",handles:["w","e"].map(Vi),input:function(e,t){return null==e?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},zi={name:"y",handles:["n","s"].map(Vi),input:function(e,t){return null==e?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},ji={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Vi),input:function(e){return null==e?null:Oi(e)},output:function(e){return e}},Bi={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Fi={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},$i={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},qi={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Ui={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function Vi(e){return{type:e}}function Hi(){return!Yt.ctrlKey&&!Yt.button}function Wi(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function Gi(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zi(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function Yi(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function Xi(){return Ki(ji)}function Ki(e){var t,n=Wi,r=Hi,i=Gi,a=!0,o=Ke("start","brush","end"),s=6;function u(t){var n=t.property("__brush",v).selectAll(".overlay").data([Vi("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Bi.overlay).merge(n).each((function(){var e=Zi(this).extent;cn(this).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])})),t.selectAll(".selection").data([Vi("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Bi.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=t.selectAll(".handle").data(e.handles,(function(e){return e.type}));r.exit().remove(),r.enter().append("rect").attr("class",(function(e){return"handle handle--"+e.type})).attr("cursor",(function(e){return Bi[e.type]})),t.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(i).on("touchstart.brush",d).on("touchmove.brush",f).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function l(){var e=cn(this),t=Zi(this).selection;t?(e.selectAll(".selection").style("display",null).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1]),e.selectAll(".handle").style("display",null).attr("x",(function(e){return"e"===e.type[e.type.length-1]?t[1][0]-s/2:t[0][0]-s/2})).attr("y",(function(e){return"s"===e.type[0]?t[1][1]-s/2:t[0][1]-s/2})).attr("width",(function(e){return"n"===e.type||"s"===e.type?t[1][0]-t[0][0]+s:s})).attr("height",(function(e){return"e"===e.type||"w"===e.type?t[1][1]-t[0][1]+s:s}))):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(e,t,n){var r=e.__brush.emitter;return!r||n&&r.clean?new h(e,t,n):r}function h(e,t,n){this.that=e,this.args=t,this.state=e.__brush,this.active=0,this.clean=n}function d(){if((!t||Yt.touches)&&r.apply(this,arguments)){var n,i,o,s,u,h,d,f,p,v,m,g=this,_=Yt.target.__data__.type,y="selection"===(a&&Yt.metaKey?_="overlay":_)?Pi:a&&Yt.altKey?Ii:Li,b=e===zi?null:qi[_],x=e===Di?null:Ui[_],w=Zi(g),k=w.extent,S=w.selection,M=k[0][0],C=k[0][1],T=k[1][0],E=k[1][1],P=0,A=0,L=b&&x&&a&&Yt.shiftKey,I=Yt.touches?Ni(Yt.changedTouches[0].identifier):hr,R=I(g),O=R,N=c(g,arguments,!0).beforestart();"overlay"===_?(S&&(p=!0),w.selection=S=[[n=e===zi?M:R[0],o=e===Di?C:R[1]],[u=e===zi?T:n,d=e===Di?E:o]]):(n=S[0][0],o=S[0][1],u=S[1][0],d=S[1][1]),i=n,s=o,h=u,f=d;var D=cn(g).attr("pointer-events","none"),z=D.selectAll(".overlay").attr("cursor",Bi[_]);if(Yt.touches)N.moved=B,N.ended=$;else{var j=cn(Yt.view).on("mousemove.brush",B,!0).on("mouseup.brush",$,!0);a&&j.on("keydown.brush",q,!0).on("keyup.brush",U,!0),fn(Yt.view)}Ti(),Dr(g),l.call(g),N.start()}function B(){var e=I(g);!L||v||m||(Math.abs(e[0]-O[0])>Math.abs(e[1]-O[1])?m=!0:v=!0),O=e,p=!0,Ei(),F()}function F(){var e;switch(P=O[0]-R[0],A=O[1]-R[1],y){case Ai:case Pi:b&&(P=Math.max(M-n,Math.min(T-u,P)),i=n+P,h=u+P),x&&(A=Math.max(C-o,Math.min(E-d,A)),s=o+A,f=d+A);break;case Li:b<0?(P=Math.max(M-n,Math.min(T-n,P)),i=n+P,h=u):b>0&&(P=Math.max(M-u,Math.min(T-u,P)),i=n,h=u+P),x<0?(A=Math.max(C-o,Math.min(E-o,A)),s=o+A,f=d):x>0&&(A=Math.max(C-d,Math.min(E-d,A)),s=o,f=d+A);break;case Ii:b&&(i=Math.max(M,Math.min(T,n-P*b)),h=Math.max(M,Math.min(T,u+P*b))),x&&(s=Math.max(C,Math.min(E,o-A*x)),f=Math.max(C,Math.min(E,d+A*x)))}h<i&&(b*=-1,e=n,n=u,u=e,e=i,i=h,h=e,_ in Fi&&z.attr("cursor",Bi[_=Fi[_]])),f<s&&(x*=-1,e=o,o=d,d=e,e=s,s=f,f=e,_ in $i&&z.attr("cursor",Bi[_=$i[_]])),w.selection&&(S=w.selection),v&&(i=S[0][0],h=S[1][0]),m&&(s=S[0][1],f=S[1][1]),S[0][0]===i&&S[0][1]===s&&S[1][0]===h&&S[1][1]===f||(w.selection=[[i,s],[h,f]],l.call(g),N.brush())}function $(){if(Ti(),Yt.touches){if(Yt.touches.length)return;t&&clearTimeout(t),t=setTimeout((function(){t=null}),500)}else pn(Yt.view,p),j.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);D.attr("pointer-events","all"),z.attr("cursor",Bi.overlay),w.selection&&(S=w.selection),Yi(S)&&(w.selection=null,l.call(g)),N.end()}function q(){switch(Yt.keyCode){case 16:L=b&&x;break;case 18:y===Li&&(b&&(u=h-P*b,n=i+P*b),x&&(d=f-A*x,o=s+A*x),y=Ii,F());break;case 32:y!==Li&&y!==Ii||(b<0?u=h-P:b>0&&(n=i-P),x<0?d=f-A:x>0&&(o=s-A),y=Ai,z.attr("cursor",Bi.selection),F());break;default:return}Ei()}function U(){switch(Yt.keyCode){case 16:L&&(v=m=L=!1,F());break;case 18:y===Ii&&(b<0?u=h:b>0&&(n=i),x<0?d=f:x>0&&(o=s),y=Li,F());break;case 32:y===Ai&&(Yt.altKey?(b&&(u=h-P*b,n=i+P*b),x&&(d=f-A*x,o=s+A*x),y=Ii):(b<0?u=h:b>0&&(n=i),x<0?d=f:x>0&&(o=s),y=Li),z.attr("cursor",Bi[_]),F());break;default:return}Ei()}}function f(){c(this,arguments).moved()}function p(){c(this,arguments).ended()}function v(){var t=this.__brush||{selection:null};return t.extent=Oi(n.apply(this,arguments)),t.dim=e,t}return u.move=function(t,n){t.selection?t.on("start.brush",(function(){c(this,arguments).beforestart().start()})).on("interrupt.brush end.brush",(function(){c(this,arguments).end()})).tween("brush",(function(){var t=this,r=t.__brush,i=c(t,arguments),a=r.selection,o=e.input("function"===typeof n?n.apply(this,arguments):n,r.extent),s=sr(a,o);function u(e){r.selection=1===e&&null===o?null:s(e),l.call(t),i.brush()}return null!==a&&null!==o?u:u(1)})):t.each((function(){var t=this,r=arguments,i=t.__brush,a=e.input("function"===typeof n?n.apply(t,r):n,i.extent),o=c(t,r).beforestart();Dr(t),i.selection=null===a?null:a,l.call(t),o.start().brush().end()}))},u.clear=function(e){u.move(e,null)},h.prototype={beforestart:function(){return 1===++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0===--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){tn(new Ci(u,t,e.output(this.state.selection)),o.apply,o,[t,this.that,this.args])}},u.extent=function(e){return arguments.length?(n="function"===typeof e?e:Mi(Oi(e)),u):n},u.filter=function(e){return arguments.length?(r="function"===typeof e?e:Mi(!!e),u):r},u.touchable=function(e){return arguments.length?(i="function"===typeof e?e:Mi(!!e),u):i},u.handleSize=function(e){return arguments.length?(s=+e,u):s},u.keyModifiers=function(e){return arguments.length?(a=!!e,u):a},u.on=function(){var e=o.on.apply(o,arguments);return e===o?u:e},u}Math.cos,Math.sin,Math.PI,Math.max;Array.prototype.slice;var Ji="$";function Qi(){}function ea(e,t){var n=new Qi;if(e instanceof Qi)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,a=e.length;if(null==t)for(;++i<a;)n.set(i,e[i]);else for(;++i<a;)n.set(t(r=e[i],i,e),r)}else if(e)for(var o in e)n.set(o,e[o]);return n}function ta(){}Qi.prototype=ea.prototype={constructor:Qi,has:function(e){return Ji+e in this},get:function(e){return this[Ji+e]},set:function(e,t){return this[Ji+e]=t,this},remove:function(e){var t=Ji+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Ji&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Ji&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Ji&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Ji&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Ji&&++e;return e},empty:function(){for(var e in this)if(e[0]===Ji)return!1;return!0},each:function(e){for(var t in this)t[0]===Ji&&e(this[t],t.slice(1),this)}};var na=ea.prototype;function ra(e,t){var n=new ta;if(e instanceof ta)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}ta.prototype=ra.prototype={constructor:ta,has:na.has,add:function(e){return this[Ji+(e+="")]=e,this},remove:na.remove,clear:na.clear,values:na.keys,size:na.size,empty:na.empty,each:na.each};Array.prototype.slice;function ia(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(204!==e.status&&205!==e.status)return e.json()}Math.PI,Math.sqrt(5);function aa(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function oa(e){return(e=aa(Math.abs(e)))?e[1]:NaN}var sa,ua=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function la(e){if(!(t=ua.exec(e)))throw new Error("invalid format: "+e);var t;return new ca({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ca(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function ha(e,t){var n=aa(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}la.prototype=ca.prototype,ca.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var da={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return ha(100*e,t)},r:ha,s:function(e,t){var n=aa(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(sa=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+aa(e,Math.max(0,t+a-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function fa(e){return e}var pa,va,ma,ga=Array.prototype.map,_a=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function ya(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?fa:(t=ga.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?fa:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(ga.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=la(e)).fill,n=e.align,h=e.sign,d=e.symbol,f=e.zero,p=e.width,v=e.comma,m=e.precision,g=e.trim,_=e.type;"n"===_?(v=!0,_="g"):da[_]||(void 0===m&&(m=12),g=!0,_="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var y="$"===d?i:"#"===d&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",b="$"===d?a:/[%p]/.test(_)?u:"",x=da[_],w=/[defgprs%]/.test(_);function k(e){var i,a,u,d=y,k=b;if("c"===_)k=x(e)+k,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),m),g&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0===+e&&"+"!==h&&(S=!1),d=(S?"("===h?h:l:"-"===h||"("===h?"":h)+d,k=("s"===_?_a[8+sa/3]:"")+k+(S&&"("===h?")":""),w)for(i=-1,a=e.length;++i<a;)if(48>(u=e.charCodeAt(i))||u>57){k=(46===u?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}v&&!f&&(e=r(e,1/0));var M=d.length+e.length+k.length,C=M<p?new Array(p-M+1).join(t):"";switch(v&&f&&(e=r(C+e,C.length?p-k.length:1/0),C=""),n){case"<":e=d+e+k+C;break;case"=":e=d+C+e+k;break;case"^":e=C.slice(0,M=C.length>>1)+d+e+k+C.slice(M);break;default:e=C+d+e+k}return s(e)}return m=void 0===m?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return e+""},k}return{format:h,formatPrefix:function(e,t){var n=h(((e=la(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(oa(t)/3))),i=Math.pow(10,-r),a=_a[8+r/3];return function(e){return n(i*e)+a}}}}function ba(e){return e}function xa(e,t){e&&ka.hasOwnProperty(e.type)&&ka[e.type](e,t)}pa=ya({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),va=pa.format,ma=pa.formatPrefix;var wa={Feature:function(e,t){xa(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)xa(n[r].geometry,t)}},ka={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Sa(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Sa(n[r],t,0)},Polygon:function(e,t){Ma(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Ma(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)xa(n[r],t)}};function Sa(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function Ma(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Sa(e[n],t,1);t.polygonEnd()}function Ca(e,t){e&&wa.hasOwnProperty(e.type)?wa[e.type](e,t):xa(e,t)}function Ta(){return new Ea}function Ea(){this.reset()}Ea.prototype={constructor:Ea,reset:function(){this.s=this.t=0},add:function(e){Aa(Pa,e,this.t),Aa(this,Pa.s,this.s),this.s?this.t+=Pa.t:this.s=Pa.t},valueOf:function(){return this.s}};var Pa=new Ea;function Aa(e,t,n){var r=e.s=t+n,i=r-t,a=r-i;e.t=t-a+(n-i)}var La=1e-6,Ia=Math.PI,Ra=Ia/2,Oa=Ia/4,Na=2*Ia,Da=180/Ia,za=Ia/180,ja=Math.abs,Ba=Math.atan,Fa=Math.atan2,$a=Math.cos,qa=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),Ua=Math.sign||function(e){return e>0?1:e<0?-1:0},Va=Math.sqrt;Math.tan;function Ha(e){return e>1?Ra:e<-1?-Ra:Math.asin(e)}function Wa(){}var Ga,Za,Ya,Xa,Ka=Ta(),Ja=Ta(),Qa={point:Wa,lineStart:Wa,lineEnd:Wa,polygonStart:function(){Qa.lineStart=eo,Qa.lineEnd=ro},polygonEnd:function(){Qa.lineStart=Qa.lineEnd=Qa.point=Wa,Ka.add(ja(Ja)),Ja.reset()},result:function(){var e=Ka/2;return Ka.reset(),e}};function eo(){Qa.point=to}function to(e,t){Qa.point=no,Ga=Ya=e,Za=Xa=t}function no(e,t){Ja.add(Xa*e-Ya*t),Ya=e,Xa=t}function ro(){no(Ga,Za)}var io=Qa,ao=1/0,oo=ao,so=-ao,uo=so,lo={point:function(e,t){e<ao&&(ao=e);e>so&&(so=e);t<oo&&(oo=t);t>uo&&(uo=t)},lineStart:Wa,lineEnd:Wa,polygonStart:Wa,polygonEnd:Wa,result:function(){var e=[[ao,oo],[so,uo]];return so=uo=-(oo=ao=1/0),e}};var co,ho,fo,po,vo=lo,mo=0,go=0,_o=0,yo=0,bo=0,xo=0,wo=0,ko=0,So=0,Mo={point:Co,lineStart:To,lineEnd:Ao,polygonStart:function(){Mo.lineStart=Lo,Mo.lineEnd=Io},polygonEnd:function(){Mo.point=Co,Mo.lineStart=To,Mo.lineEnd=Ao},result:function(){var e=So?[wo/So,ko/So]:xo?[yo/xo,bo/xo]:_o?[mo/_o,go/_o]:[NaN,NaN];return mo=go=_o=yo=bo=xo=wo=ko=So=0,e}};function Co(e,t){mo+=e,go+=t,++_o}function To(){Mo.point=Eo}function Eo(e,t){Mo.point=Po,Co(fo=e,po=t)}function Po(e,t){var n=e-fo,r=t-po,i=Va(n*n+r*r);yo+=i*(fo+e)/2,bo+=i*(po+t)/2,xo+=i,Co(fo=e,po=t)}function Ao(){Mo.point=Co}function Lo(){Mo.point=Ro}function Io(){Oo(co,ho)}function Ro(e,t){Mo.point=Oo,Co(co=fo=e,ho=po=t)}function Oo(e,t){var n=e-fo,r=t-po,i=Va(n*n+r*r);yo+=i*(fo+e)/2,bo+=i*(po+t)/2,xo+=i,wo+=(i=po*e-fo*t)*(fo+e),ko+=i*(po+t),So+=3*i,Co(fo=e,po=t)}var No=Mo;function Do(e){this._context=e}Do.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Na)}},result:Wa};var zo,jo,Bo,Fo,$o,qo=Ta(),Uo={point:Wa,lineStart:function(){Uo.point=Vo},lineEnd:function(){zo&&Ho(jo,Bo),Uo.point=Wa},polygonStart:function(){zo=!0},polygonEnd:function(){zo=null},result:function(){var e=+qo;return qo.reset(),e}};function Vo(e,t){Uo.point=Ho,jo=Fo=e,Bo=$o=t}function Ho(e,t){Fo-=e,$o-=t,qo.add(Va(Fo*Fo+$o*$o)),Fo=e,$o=t}var Wo=Uo;function Go(){this._string=[]}function Zo(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Yo(e,t){var n,r,i=4.5;function a(e){return e&&("function"===typeof i&&r.pointRadius(+i.apply(this,arguments)),Ca(e,n(r))),r.result()}return a.area=function(e){return Ca(e,n(io)),io.result()},a.measure=function(e){return Ca(e,n(Wo)),Wo.result()},a.bounds=function(e){return Ca(e,n(vo)),vo.result()},a.centroid=function(e){return Ca(e,n(No)),No.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,ba):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new Go):new Do(t=e),"function"!==typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"===typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function Xo(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:Wa,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Ko(e,t){return ja(e[0]-t[0])<La&&ja(e[1]-t[1])<La}function Jo(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Qo(e,t,n,r,i){var a,o,s=[],u=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(Ko(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new Jo(r,e,null,!0)),u.push(n.o=new Jo(r,null,n,!1)),s.push(n=new Jo(o,e,null,!1)),u.push(n.o=new Jo(o,null,n,!0))}})),s.length){for(u.sort(t),es(s),es(u),a=0,o=u.length;a<o;++a)u[a].e=n=!n;for(var l,c,h=s[0];;){for(var d=h,f=!0;d.v;)if((d=d.n)===h)return;l=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(a=0,o=l.length;a<o;++a)i.point((c=l[a])[0],c[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(f)for(l=d.p.z,a=l.length-1;a>=0;--a)i.point((c=l[a])[0],c[1]);else r(d.x,d.p.x,-1,i);d=d.p}l=(d=d.o).z,f=!f}while(!d.v);i.lineEnd()}}}function es(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function ts(e){return[Fa(e[1],e[0]),Ha(e[2])]}function ns(e){var t=e[0],n=e[1],r=$a(n);return[r*$a(t),r*qa(t),qa(n)]}function rs(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function is(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function as(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function os(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function ss(e){var t=Va(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}Go.prototype={_radius:4.5,_circle:Zo(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=Zo(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var us=Ta();function ls(e){return ja(e[0])<=Ia?e[0]:Ua(e[0])*((ja(e[0])+Ia)%Na-Ia)}function cs(e,t,n,r){return function(i){var a,o,s,u=t(i),l=Xo(),c=t(l),h=!1,d={point:f,lineStart:v,lineEnd:m,polygonStart:function(){d.point=g,d.lineStart=_,d.lineEnd=y,o=[],a=[]},polygonEnd:function(){d.point=f,d.lineStart=v,d.lineEnd=m,o=Pe(o);var e=function(e,t){var n=ls(t),r=t[1],i=qa(r),a=[qa(n),-$a(n),0],o=0,s=0;us.reset(),1===i?r=Ra+La:-1===i&&(r=-Ra-La);for(var u=0,l=e.length;u<l;++u)if(h=(c=e[u]).length)for(var c,h,d=c[h-1],f=ls(d),p=d[1]/2+Oa,v=qa(p),m=$a(p),g=0;g<h;++g,f=y,v=x,m=w,d=_){var _=c[g],y=ls(_),b=_[1]/2+Oa,x=qa(b),w=$a(b),k=y-f,S=k>=0?1:-1,M=S*k,C=M>Ia,T=v*x;if(us.add(Fa(T*S*qa(M),m*w+T*$a(M))),o+=C?k+S*Na:k,C^f>=n^y>=n){var E=is(ns(d),ns(_));ss(E);var P=is(a,E);ss(P);var A=(C^k>=0?-1:1)*Ha(P[2]);(r>A||r===A&&(E[0]||E[1]))&&(s+=C^k>=0?1:-1)}}return(o<-1e-6||o<La&&us<-1e-6)^1&s}(a,r);o.length?(h||(i.polygonStart(),h=!0),Qo(o,ds,e,n,i)):e&&(h||(i.polygonStart(),h=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),h&&(i.polygonEnd(),h=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function f(t,n){e(t,n)&&i.point(t,n)}function p(e,t){u.point(e,t)}function v(){d.point=p,u.lineStart()}function m(){d.point=f,u.lineEnd()}function g(e,t){s.push([e,t]),c.point(e,t)}function _(){c.lineStart(),s=[]}function y(){g(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,u=c.clean(),d=l.result(),f=d.length;if(s.pop(),a.push(s),s=null,f)if(1&u){if((t=(n=d[0]).length-1)>0){for(h||(i.polygonStart(),h=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else f>1&&2&u&&d.push(d.pop().concat(d.shift())),o.push(d.filter(hs))}return d}}function hs(e){return e.length>1}function ds(e,t){return((e=e.x)[0]<0?e[1]-Ra-La:Ra-e[1])-((t=t.x)[0]<0?t[1]-Ra-La:Ra-t[1])}var fs=cs((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Ia:-Ia,u=ja(a-n);ja(u-Ia)<La?(e.point(n,r=(r+o)/2>0?Ra:-Ra),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&u>=Ia&&(ja(n-i)<La&&(n-=i*La),ja(a-s)<La&&(a-=s*La),r=function(e,t,n,r){var i,a,o=qa(e-n);return ja(o)>La?Ba((qa(t)*(a=$a(r))*qa(n)-qa(r)*(i=$a(t))*qa(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*Ra,r.point(-Ia,i),r.point(0,i),r.point(Ia,i),r.point(Ia,0),r.point(Ia,-i),r.point(0,-i),r.point(-Ia,-i),r.point(-Ia,0),r.point(-Ia,i);else if(ja(e[0]-t[0])>La){var a=e[0]<t[0]?Ia:-Ia;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-Ia,-Ra]);function ps(e,t,n,r,i,a){if(n){var o=$a(t),s=qa(t),u=r*n;null==i?(i=t+r*Na,a=t-u/2):(i=vs(o,i),a=vs(o,a),(r>0?i<a:i>a)&&(i+=r*Na));for(var l,c=i;r>0?c>a:c<a;c-=u)l=ts([o,-s*$a(c),-s*qa(c)]),e.point(l[0],l[1])}}function vs(e,t){(t=ns(t))[0]-=e,ss(t);var n=function(e){return e>1?0:e<-1?Ia:Math.acos(e)}(-t[1]);return((-t[2]<0?-n:n)+Na-La)%Na}function ms(e){var t=$a(e),n=6*za,r=t>0,i=ja(t)>La;function a(e,n){return $a(e)*$a(n)>t}function o(e,n,r){var i=[1,0,0],a=is(ns(e),ns(n)),o=rs(a,a),s=a[0],u=o-s*s;if(!u)return!r&&e;var l=t*o/u,c=-t*s/u,h=is(i,a),d=os(i,l);as(d,os(a,c));var f=h,p=rs(d,f),v=rs(f,f),m=p*p-v*(rs(d,d)-1);if(!(m<0)){var g=Va(m),_=os(f,(-p-g)/v);if(as(_,d),_=ts(_),!r)return _;var y,b=e[0],x=n[0],w=e[1],k=n[1];x<b&&(y=b,b=x,x=y);var S=x-b,M=ja(S-Ia)<La;if(!M&&k<w&&(y=w,w=k,k=y),M||S<La?M?w+k>0^_[1]<(ja(_[0]-b)<La?w:k):w<=_[1]&&_[1]<=k:S>Ia^(b<=_[0]&&_[0]<=x)){var C=os(f,(-p+g)/v);return as(C,d),[_,ts(C)]}}}function s(t,n){var i=r?e:Ia-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return cs(a,(function(e){var t,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(h,d){var f,p=[h,d],v=a(h,d),m=r?v?0:s(h,d):v?s(h+(h<0?Ia:-Ia),d):0;if(!t&&(l=u=v)&&e.lineStart(),v!==u&&(!(f=o(t,p))||Ko(t,f)||Ko(p,f))&&(p[2]=1),v!==u)c=0,v?(e.lineStart(),f=o(p,t),e.point(f[0],f[1])):(f=o(t,p),e.point(f[0],f[1],2),e.lineEnd()),t=f;else if(i&&t&&r^v){var g;m&n||!(g=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1],3)))}!v||t&&Ko(t,p)||e.point(p[0],p[1]),t=p,u=v,n=m},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return c|(l&&u)<<1}}}),(function(t,r,i,a){ps(a,e,n,i,t,r)}),r?[0,-e]:[-Ia,e-Ia])}var gs=1e9,_s=-gs;function ys(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,l){var c=0,h=0;if(null==i||(c=o(i,s))!==(h=o(a,s))||u(i,a)<0^s>0)do{l.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==h);else l.point(a[0],a[1])}function o(r,i){return ja(r[0]-e)<La?i>0?0:3:ja(r[0]-n)<La?i>0?2:1:ja(r[1]-t)<La?i>0?1:0:i>0?3:2}function s(e,t){return u(e.x,t.x)}function u(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var u,l,c,h,d,f,p,v,m,g,_,y=o,b=Xo(),x={point:w,lineStart:function(){x.point=k,l&&l.push(c=[]);g=!0,m=!1,p=v=NaN},lineEnd:function(){u&&(k(h,d),f&&m&&b.rejoin(),u.push(b.result()));x.point=w,m&&y.lineEnd()},polygonStart:function(){y=b,u=[],l=[],_=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=l.length;n<i;++n)for(var a,o,s=l[n],u=1,c=s.length,h=s[0],d=h[0],f=h[1];u<c;++u)a=d,o=f,d=(h=s[u])[0],f=h[1],o<=r?f>r&&(d-a)*(r-o)>(f-o)*(e-a)&&++t:f<=r&&(d-a)*(r-o)<(f-o)*(e-a)&&--t;return t}(),n=_&&t,i=(u=Pe(u)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&Qo(u,s,t,a,o),o.polygonEnd());y=o,u=l=c=null}};function w(e,t){i(e,t)&&y.point(e,t)}function k(a,o){var s=i(a,o);if(l&&c.push([a,o]),g)h=a,d=o,f=s,g=!1,s&&(y.lineStart(),y.point(a,o));else if(s&&m)y.point(a,o);else{var u=[p=Math.max(_s,Math.min(gs,p)),v=Math.max(_s,Math.min(gs,v))],b=[a=Math.max(_s,Math.min(gs,a)),o=Math.max(_s,Math.min(gs,o))];!function(e,t,n,r,i,a){var o,s=e[0],u=e[1],l=0,c=1,h=t[0]-s,d=t[1]-u;if(o=n-s,h||!(o>0)){if(o/=h,h<0){if(o<l)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>l&&(l=o)}if(o=i-s,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>l&&(l=o)}else if(h>0){if(o<l)return;o<c&&(c=o)}if(o=r-u,d||!(o>0)){if(o/=d,d<0){if(o<l)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>l&&(l=o)}if(o=a-u,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>l&&(l=o)}else if(d>0){if(o<l)return;o<c&&(c=o)}return l>0&&(e[0]=s+l*h,e[1]=u+l*d),c<1&&(t[0]=s+c*h,t[1]=u+c*d),!0}}}}}(u,b,e,t,n,r)?s&&(y.lineStart(),y.point(a,o),_=!1):(m||(y.lineStart(),y.point(u[0],u[1])),y.point(b[0],b[1]),s||y.lineEnd(),_=!1)}p=a,v=o,m=s}return x}}function bs(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function xs(e,t){return[ja(e)>Ia?e+Math.round(-e/Na)*Na:e,t]}function ws(e,t,n){return(e%=Na)?t||n?bs(Ss(e),Ms(t,n)):Ss(e):t||n?Ms(t,n):xs}function ks(e){return function(t,n){return[(t+=e)>Ia?t-Na:t<-Ia?t+Na:t,n]}}function Ss(e){var t=ks(e);return t.invert=ks(-e),t}function Ms(e,t){var n=$a(e),r=qa(e),i=$a(t),a=qa(t);function o(e,t){var o=$a(t),s=$a(e)*o,u=qa(e)*o,l=qa(t),c=l*n+s*r;return[Fa(u*i-c*a,s*n-l*r),Ha(c*i+u*a)]}return o.invert=function(e,t){var o=$a(t),s=$a(e)*o,u=qa(e)*o,l=qa(t),c=l*i-u*a;return[Fa(u*i+l*a,s*n+c*r),Ha(c*n-s*r)]},o}function Cs(e){return{stream:Ts(e)}}function Ts(e){return function(t){var n=new Es;for(var r in e)n[r]=e[r];return n.stream=t,n}}function Es(){}function Ps(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),Ca(n,e.stream(vo)),t(vo.result()),null!=r&&e.clipExtent(r),e}function As(e,t,n){return Ps(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}xs.invert=xs,Es.prototype={constructor:Es,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Ls=$a(30*za);function Is(e,t){return+t?function(e,t){function n(r,i,a,o,s,u,l,c,h,d,f,p,v,m){var g=l-r,_=c-i,y=g*g+_*_;if(y>4*t&&v--){var b=o+d,x=s+f,w=u+p,k=Va(b*b+x*x+w*w),S=Ha(w/=k),M=ja(ja(w)-1)<La||ja(a-h)<La?(a+h)/2:Fa(x,b),C=e(M,S),T=C[0],E=C[1],P=T-r,A=E-i,L=_*P-g*A;(L*L/y>t||ja((g*P+_*A)/y-.5)>.3||o*d+s*f+u*p<Ls)&&(n(r,i,a,o,s,u,T,E,M,b/=k,x/=k,w,v,m),m.point(T,E),n(T,E,M,b,x,w,l,c,h,d,f,p,v,m))}}return function(t){var r,i,a,o,s,u,l,c,h,d,f,p,v={point:m,lineStart:g,lineEnd:y,polygonStart:function(){t.polygonStart(),v.lineStart=b},polygonEnd:function(){t.polygonEnd(),v.lineStart=g}};function m(n,r){n=e(n,r),t.point(n[0],n[1])}function g(){c=NaN,v.point=_,t.lineStart()}function _(r,i){var a=ns([r,i]),o=e(r,i);n(c,h,l,d,f,p,c=o[0],h=o[1],l=r,d=a[0],f=a[1],p=a[2],16,t),t.point(c,h)}function y(){v.point=m,t.lineEnd()}function b(){g(),v.point=x,v.lineEnd=w}function x(e,t){_(r=e,t),i=c,a=h,o=d,s=f,u=p,v.point=_}function w(){n(c,h,l,d,f,p,i,a,r,o,s,u,16,t),v.lineEnd=y,y()}return v}}(e,t):function(e){return Ts({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var Rs=Ts({point:function(e,t){this.stream.point(e*za,t*za)}});function Os(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}function Ns(e,t,n,r,i,a){var o=$a(a),s=qa(a),u=o*e,l=s*e,c=o/e,h=s/e,d=(s*n-o*t)/e,f=(s*t+o*n)/e;function p(e,a){return[u*(e*=r)-l*(a*=i)+t,n-l*e-u*a]}return p.invert=function(e,t){return[r*(c*e-h*t+d),i*(f-h*e-c*t)]},p}function Ds(e){return function(e){var t,n,r,i,a,o,s,u,l,c,h=150,d=480,f=250,p=0,v=0,m=0,g=0,_=0,y=0,b=1,x=1,w=null,k=fs,S=null,M=ba,C=.5;function T(e){return u(e[0]*za,e[1]*za)}function E(e){return(e=u.invert(e[0],e[1]))&&[e[0]*Da,e[1]*Da]}function P(){var e=Ns(h,0,0,b,x,y).apply(null,t(p,v)),r=(y?Ns:Os)(h,d-e[0],f-e[1],b,x,y);return n=ws(m,g,_),s=bs(t,r),u=bs(n,s),o=Is(s,C),A()}function A(){return l=c=null,T}return T.stream=function(e){return l&&c===e?l:l=Rs(function(e){return Ts({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(M(c=e)))))},T.preclip=function(e){return arguments.length?(k=e,w=void 0,A()):k},T.postclip=function(e){return arguments.length?(M=e,S=r=i=a=null,A()):M},T.clipAngle=function(e){return arguments.length?(k=+e?ms(w=e*za):(w=null,fs),A()):w*Da},T.clipExtent=function(e){return arguments.length?(M=null==e?(S=r=i=a=null,ba):ys(S=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),A()):null==S?null:[[S,r],[i,a]]},T.scale=function(e){return arguments.length?(h=+e,P()):h},T.translate=function(e){return arguments.length?(d=+e[0],f=+e[1],P()):[d,f]},T.center=function(e){return arguments.length?(p=e[0]%360*za,v=e[1]%360*za,P()):[p*Da,v*Da]},T.rotate=function(e){return arguments.length?(m=e[0]%360*za,g=e[1]%360*za,_=e.length>2?e[2]%360*za:0,P()):[m*Da,g*Da,_*Da]},T.angle=function(e){return arguments.length?(y=e%360*za,P()):y*Da},T.reflectX=function(e){return arguments.length?(b=e?-1:1,P()):b<0},T.reflectY=function(e){return arguments.length?(x=e?-1:1,P()):x<0},T.precision=function(e){return arguments.length?(o=Is(s,C=e*e),A()):Va(C)},T.fitExtent=function(e,t){return As(T,e,t)},T.fitSize=function(e,t){return function(e,t,n){return As(e,[[0,0],t],n)}(T,e,t)},T.fitWidth=function(e,t){return function(e,t,n){return Ps(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}(T,e,t)},T.fitHeight=function(e,t){return function(e,t,n){return Ps(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}(T,e,t)},function(){return t=e.apply(this,arguments),T.invert=t.invert&&E,P()}}((function(){return e}))()}function zs(e,t){return[e,t]}function js(){return Ds(zs).scale(152.63)}function Bs(){return Math.random()}zs.invert=zs;(function e(t){function n(e,n){return e=null==e?0:+e,n=null==n?1:+n,1===arguments.length?(n=e,e=0):n-=e,function(){return t()*n+e}}return n.source=e,n})(Bs);var Fs=function e(t){function n(e,n){var r,i;return e=null==e?0:+e,n=null==n?1:+n,function(){var a;if(null!=r)a=r,r=null;else do{r=2*t()-1,a=2*t()-1,i=r*r+a*a}while(!i||i>1);return e+n*a*Math.sqrt(-2*Math.log(i)/i)}}return n.source=e,n}(Bs),$s=(function e(t){function n(){var e=Fs.source(t).apply(this,arguments);return function(){return Math.exp(e())}}return n.source=e,n}(Bs),function e(t){function n(e){return function(){for(var n=0,r=0;r<e;++r)n+=t();return n}}return n.source=e,n}(Bs)),qs=(function e(t){function n(e){var n=$s.source(t)(e);return function(){return n()/e}}return n.source=e,n}(Bs),function e(t){function n(e){return function(){return-Math.log(1-t())/e}}return n.source=e,n}(Bs),Array.prototype),Us=qs.map,Vs=qs.slice;function Hs(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Ws(e){return+e}var Gs=[0,1];function Zs(e){return e}function Ys(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Xs(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function Ks(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=Ys(i,r),a=n(o,a)):(r=Ys(r,i),a=n(a,o)),function(e){return a(r(e))}}function Js(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=Ys(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=be(e,t,1,r)-1;return a[n](i[n](t))}}function Qs(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function eu(){var e,t,n,r,i,a,o=Gs,s=Gs,u=sr,l=Zs;function c(){return r=Math.min(o.length,s.length)>2?Js:Ks,i=a=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((a||(a=r(s,o.map(e),tr)))(n)))},h.domain=function(e){return arguments.length?(o=Us.call(e,Ws),l===Zs||(l=Xs(o)),c()):o.slice()},h.range=function(e){return arguments.length?(s=Vs.call(e),c()):s.slice()},h.rangeRound=function(e){return s=Vs.call(e),u=Hs,c()},h.clamp=function(e){return arguments.length?(l=e?Xs(o):Zs,h):l!==Zs},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}function tu(e,t){return eu()(e,t)}function nu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function ru(e,t,n,r){var i,a=Te(e,t,n);switch((r=la(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(oa(t)/3)))-oa(Math.abs(e)))}(a,o))||(r.precision=i),ma(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,oa(t)-oa(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-oa(Math.abs(e)))}(a))||(r.precision=i-2*("%"===r.type))}return va(r)}function iu(e){var t=e.domain;return e.ticks=function(e){var n=t();return Me(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return ru(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),a=0,o=i.length-1,s=i[a],u=i[o];return u<s&&(r=s,s=u,u=r,r=a,a=o,o=r),(r=Ce(s,u,n))>0?r=Ce(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=Ce(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[a]=Math.floor(s/r)*r,i[o]=Math.ceil(u/r)*r,t(i)):r<0&&(i[a]=Math.ceil(s*r)/r,i[o]=Math.floor(u*r)/r,t(i)),e},e}function au(){var e=tu(Zs,Zs);return e.copy=function(){return Qs(e,au())},nu.apply(e,arguments),iu(e)}function ou(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function su(e){return Math.log(e)}function uu(e){return Math.exp(e)}function lu(e){return-Math.log(-e)}function cu(e){return-Math.exp(-e)}function hu(e){return isFinite(e)?+("1e"+e):e<0?0:e}function du(e){return function(t){return-e(-t)}}function fu(e){var t,n,r=e(su,uu),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?hu:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=du(t),n=du(n),e(lu,cu)):e(su,uu),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],u=o[o.length-1];(r=u<s)&&(d=s,s=u,u=d);var l,c,h,d=t(s),f=t(u),p=null==e?10:+e,v=[];if(!(a%1)&&f-d<p){if(d=Math.round(d)-1,f=Math.round(f)+1,s>0){for(;d<f;++d)for(c=1,l=n(d);c<a;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;d<f;++d)for(c=a-1,l=n(d);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=Me(d,f,Math.min(f-d,p)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!==typeof i&&(i=va(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(ou(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function pu(){var e=fu(eu()).domain([1,10]);return e.copy=function(){return Qs(e,pu()).base(e.base())},nu.apply(e,arguments),e}var vu=new Date,mu=new Date;function gu(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r)||!(a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return gu((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return vu.setTime(+t),mu.setTime(+r),e(vu),e(mu),Math.floor(n(vu,mu))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e===0}:function(t){return i.count(0,t)%e===0}):i:null}),i}var _u=gu((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));_u.every=function(e){return isFinite(e=Math.floor(e))&&e>0?gu((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var yu=_u,bu=(_u.range,gu((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),xu=bu,wu=(bu.range,1e3),ku=6e4,Su=36e5,Mu=864e5,Cu=6048e5;function Tu(e){return gu((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ku)/Cu}))}var Eu=Tu(0),Pu=Tu(1),Au=Tu(2),Lu=Tu(3),Iu=Tu(4),Ru=Tu(5),Ou=Tu(6),Nu=(Eu.range,Pu.range,Au.range,Lu.range,Iu.range,Ru.range,Ou.range,gu((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ku)/Mu}),(function(e){return e.getDate()-1}))),Du=Nu,zu=(Nu.range,gu((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wu-e.getMinutes()*ku)}),(function(e,t){e.setTime(+e+t*Su)}),(function(e,t){return(t-e)/Su}),(function(e){return e.getHours()}))),ju=zu,Bu=(zu.range,gu((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wu)}),(function(e,t){e.setTime(+e+t*ku)}),(function(e,t){return(t-e)/ku}),(function(e){return e.getMinutes()}))),Fu=Bu,$u=(Bu.range,gu((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*wu)}),(function(e,t){return(t-e)/wu}),(function(e){return e.getUTCSeconds()}))),qu=$u,Uu=($u.range,gu((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e})));Uu.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?gu((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Uu:null};var Vu=Uu;Uu.range;function Hu(e){return gu((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Cu}))}var Wu=Hu(0),Gu=Hu(1),Zu=Hu(2),Yu=Hu(3),Xu=Hu(4),Ku=Hu(5),Ju=Hu(6),Qu=(Wu.range,Gu.range,Zu.range,Yu.range,Xu.range,Ku.range,Ju.range,gu((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Mu}),(function(e){return e.getUTCDate()-1}))),el=Qu,tl=(Qu.range,gu((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));tl.every=function(e){return isFinite(e=Math.floor(e))&&e>0?gu((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var nl=tl;tl.range;function rl(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function il(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function al(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var ol,sl,ul={"-":"",_:" ",0:"0"},ll=/^\s*\d+/,cl=/^%/,hl=/[\\^$*+?|[\]().{}]/g;function dl(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function fl(e){return e.replace(hl,"\\$&")}function pl(e){return new RegExp("^(?:"+e.map(fl).join("|")+")","i")}function vl(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function ml(e,t,n){var r=ll.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function gl(e,t,n){var r=ll.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function _l(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function yl(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function bl(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function xl(e,t,n){var r=ll.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function wl(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function kl(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Sl(e,t,n){var r=ll.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Ml(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Cl(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Tl(e,t,n){var r=ll.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function El(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Pl(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Al(e,t,n){var r=ll.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Ll(e,t,n){var r=ll.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Il(e,t,n){var r=ll.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Rl(e,t,n){var r=cl.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Ol(e,t,n){var r=ll.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Nl(e,t,n){var r=ll.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Dl(e,t){return dl(e.getDate(),t,2)}function zl(e,t){return dl(e.getHours(),t,2)}function jl(e,t){return dl(e.getHours()%12||12,t,2)}function Bl(e,t){return dl(1+Du.count(yu(e),e),t,3)}function Fl(e,t){return dl(e.getMilliseconds(),t,3)}function $l(e,t){return Fl(e,t)+"000"}function ql(e,t){return dl(e.getMonth()+1,t,2)}function Ul(e,t){return dl(e.getMinutes(),t,2)}function Vl(e,t){return dl(e.getSeconds(),t,2)}function Hl(e){var t=e.getDay();return 0===t?7:t}function Wl(e,t){return dl(Eu.count(yu(e)-1,e),t,2)}function Gl(e){var t=e.getDay();return t>=4||0===t?Iu(e):Iu.ceil(e)}function Zl(e,t){return e=Gl(e),dl(Iu.count(yu(e),e)+(4===yu(e).getDay()),t,2)}function Yl(e){return e.getDay()}function Xl(e,t){return dl(Pu.count(yu(e)-1,e),t,2)}function Kl(e,t){return dl(e.getFullYear()%100,t,2)}function Jl(e,t){return dl((e=Gl(e)).getFullYear()%100,t,2)}function Ql(e,t){return dl(e.getFullYear()%1e4,t,4)}function ec(e,t){var n=e.getDay();return dl((e=n>=4||0===n?Iu(e):Iu.ceil(e)).getFullYear()%1e4,t,4)}function tc(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+dl(t/60|0,"0",2)+dl(t%60,"0",2)}function nc(e,t){return dl(e.getUTCDate(),t,2)}function rc(e,t){return dl(e.getUTCHours(),t,2)}function ic(e,t){return dl(e.getUTCHours()%12||12,t,2)}function ac(e,t){return dl(1+el.count(nl(e),e),t,3)}function oc(e,t){return dl(e.getUTCMilliseconds(),t,3)}function sc(e,t){return oc(e,t)+"000"}function uc(e,t){return dl(e.getUTCMonth()+1,t,2)}function lc(e,t){return dl(e.getUTCMinutes(),t,2)}function cc(e,t){return dl(e.getUTCSeconds(),t,2)}function hc(e){var t=e.getUTCDay();return 0===t?7:t}function dc(e,t){return dl(Wu.count(nl(e)-1,e),t,2)}function fc(e){var t=e.getUTCDay();return t>=4||0===t?Xu(e):Xu.ceil(e)}function pc(e,t){return e=fc(e),dl(Xu.count(nl(e),e)+(4===nl(e).getUTCDay()),t,2)}function vc(e){return e.getUTCDay()}function mc(e,t){return dl(Gu.count(nl(e)-1,e),t,2)}function gc(e,t){return dl(e.getUTCFullYear()%100,t,2)}function _c(e,t){return dl((e=fc(e)).getUTCFullYear()%100,t,2)}function yc(e,t){return dl(e.getUTCFullYear()%1e4,t,4)}function bc(e,t){var n=e.getUTCDay();return dl((e=n>=4||0===n?Xu(e):Xu.ceil(e)).getUTCFullYear()%1e4,t,4)}function xc(){return"+0000"}function wc(){return"%"}function kc(e){return+e}function Sc(e){return Math.floor(+e/1e3)}!function(e){ol=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,u=e.shortMonths,l=pl(i),c=vl(i),h=pl(a),d=vl(a),f=pl(o),p=vl(o),v=pl(s),m=vl(s),g=pl(u),_=vl(u),y={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Dl,e:Dl,f:$l,g:Jl,G:ec,H:zl,I:jl,j:Bl,L:Fl,m:ql,M:Ul,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:kc,s:Sc,S:Vl,u:Hl,U:Wl,V:Zl,w:Yl,W:Xl,x:null,X:null,y:Kl,Y:Ql,Z:tc,"%":wc},b={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:nc,e:nc,f:sc,g:_c,G:bc,H:rc,I:ic,j:ac,L:oc,m:uc,M:lc,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:kc,s:Sc,S:cc,u:hc,U:dc,V:pc,w:vc,W:mc,x:null,X:null,y:gc,Y:yc,Z:xc,"%":wc},x={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=_[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return S(e,t,n,r)},d:Cl,e:Cl,f:Il,g:wl,G:xl,H:El,I:El,j:Tl,L:Ll,m:Ml,M:Pl,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:Sl,Q:Ol,s:Nl,S:Al,u:gl,U:_l,V:yl,w:ml,W:bl,x:function(e,t,r){return S(e,n,t,r)},X:function(e,t,n){return S(e,r,t,n)},y:wl,Y:xl,Z:kl,"%":Rl};function w(e,t){return function(n){var r,i,a,o=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(i=ul[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=al(1900,void 0,1);if(S(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=il(al(a.y,0,1))).getUTCDay(),r=i>4||0===i?Gu.ceil(r):Gu(r),r=el.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=rl(al(a.y,0,1))).getDay(),r=i>4||0===i?Pu.ceil(r):Pu(r),r=Du.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?il(al(a.y,0,1)).getUTCDay():rl(al(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,il(a)):rl(a)}}function S(e,t,n,r){for(var i,a,o=0,s=t.length,u=n.length;o<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=x[i in ul?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return y.x=w(n,y),y.X=w(r,y),y.c=w(t,y),b.x=w(n,b),b.X=w(r,b),b.c=w(t,b),{format:function(e){var t=w(e+="",y);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}(e),sl=ol.format,ol.parse,ol.utcFormat,ol.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Mc=1e3,Cc=6e4,Tc=36e5,Ec=864e5,Pc=2592e6,Ac=31536e6;function Lc(e){return new Date(e)}function Ic(e){return e instanceof Date?+e:+new Date(+e)}function Rc(e,t,n,r,i,a,o,s,u){var l=tu(Zs,Zs),c=l.invert,h=l.domain,d=u(".%L"),f=u(":%S"),p=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),g=u("%b %d"),_=u("%B"),y=u("%Y"),b=[[o,1,Mc],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,Cc],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,Tc],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,Ec],[r,2,1728e5],[n,1,6048e5],[t,1,Pc],[t,3,7776e6],[e,1,Ac]];function x(s){return(o(s)<s?d:a(s)<s?f:i(s)<s?p:r(s)<s?v:t(s)<s?n(s)<s?m:g:e(s)<s?_:y)(s)}function w(t,n,r,i){if(null==t&&(t=10),"number"===typeof t){var a=Math.abs(r-n)/t,o=ge((function(e){return e[2]})).right(b,a);o===b.length?(i=Te(n/Ac,r/Ac,t),t=e):o?(i=(o=b[a/b[o-1][2]<b[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(Te(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?h(Us.call(e,Ic)):h().map(Lc)},l.ticks=function(e,t){var n,r=h(),i=r[0],a=r[r.length-1],o=a<i;return o&&(n=i,i=a,a=n),n=(n=w(e,i,a,t))?n.range(i,a+1):[],o?n.reverse():n},l.tickFormat=function(e,t){return null==t?x:u(t)},l.nice=function(e,t){var n=h();return(e=w(e,n[0],n[n.length-1],t))?h(ou(n,e)):l},l.copy=function(){return Qs(l,Rc(e,t,n,r,i,a,o,s,u))},l}function Oc(e){return cn(Ut(e).call(document.documentElement))}var Nc=0;function Dc(){return new zc}function zc(){this._="@"+(++Nc).toString(36)}function jc(e){return"string"===typeof e?new sn([document.querySelectorAll(e)],[document.documentElement]):new sn([null==e?[]:e],on)}function Bc(e,t){null==t&&(t=ur().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=lr(e,t[n]);return i}function Fc(){this._=null}function $c(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function qc(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Uc(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function Vc(e){for(;e.L;)e=e.L;return e}zc.prototype=Dc.prototype={constructor:zc,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}},Fc.prototype={constructor:Fc,insert:function(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=Vc(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(qc(this,n),n=(e=n).U),n.C=!1,r.C=!0,Uc(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(Uc(this,n),n=(e=n).U),n.C=!1,r.C=!0,qc(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,i=e.U,a=e.L,o=e.R;if(n=a?o?Vc(o):a:o,i?i.L===e?i.L=n:i.R=n:this._=n,a&&o?(r=n.C,n.C=e.C,n.L=a,a.U=n,n!==o?(i=n.U,n.U=e.U,e=n.R,i.L=e,n.R=o,o.U=n):(n.U=i,i=n,e=n.R)):(r=e.C,e=n),e&&(e.U=i),!r)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===i.L){if((t=i.R).C&&(t.C=!1,i.C=!0,qc(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Uc(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,qc(this,i),e=this._;break}}else if((t=i.L).C&&(t.C=!1,i.C=!0,Uc(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,qc(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,Uc(this,i),e=this._;break}t.C=!0,e=i,i=i.U}while(!e.C);e&&(e.C=!1)}}};var Hc=Fc;function Wc(e,t,n,r){var i=[null,null],a=mh.push(i)-1;return i.left=e,i.right=t,n&&Zc(i,e,t,n),r&&Zc(i,t,e,r),ph[e.index].halfedges.push(a),ph[t.index].halfedges.push(a),i}function Gc(e,t,n){var r=[t,n];return r.left=e,r}function Zc(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function Yc(e,t,n,r,i){var a,o=e[0],s=e[1],u=o[0],l=o[1],c=0,h=1,d=s[0]-u,f=s[1]-l;if(a=t-u,d||!(a>0)){if(a/=d,d<0){if(a<c)return;a<h&&(h=a)}else if(d>0){if(a>h)return;a>c&&(c=a)}if(a=r-u,d||!(a<0)){if(a/=d,d<0){if(a>h)return;a>c&&(c=a)}else if(d>0){if(a<c)return;a<h&&(h=a)}if(a=n-l,f||!(a>0)){if(a/=f,f<0){if(a<c)return;a<h&&(h=a)}else if(f>0){if(a>h)return;a>c&&(c=a)}if(a=i-l,f||!(a<0)){if(a/=f,f<0){if(a>h)return;a>c&&(c=a)}else if(f>0){if(a<c)return;a<h&&(h=a)}return!(c>0||h<1)||(c>0&&(e[0]=[u+c*d,l+c*f]),h<1&&(e[1]=[u+h*d,l+h*f]),!0)}}}}}function Xc(e,t,n,r,i){var a=e[1];if(a)return!0;var o,s,u=e[0],l=e.left,c=e.right,h=l[0],d=l[1],f=c[0],p=c[1],v=(h+f)/2,m=(d+p)/2;if(p===d){if(v<t||v>=r)return;if(h>f){if(u){if(u[1]>=i)return}else u=[v,n];a=[v,i]}else{if(u){if(u[1]<n)return}else u=[v,i];a=[v,n]}}else if(s=m-(o=(h-f)/(p-d))*v,o<-1||o>1)if(h>f){if(u){if(u[1]>=i)return}else u=[(n-s)/o,n];a=[(i-s)/o,i]}else{if(u){if(u[1]<n)return}else u=[(i-s)/o,i];a=[(n-s)/o,n]}else if(d<p){if(u){if(u[0]>=r)return}else u=[t,o*t+s];a=[r,o*r+s]}else{if(u){if(u[0]<t)return}else u=[r,o*r+s];a=[t,o*t+s]}return e[0]=u,e[1]=a,!0}function Kc(e,t){var n=e.site,r=t.left,i=t.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=t[1],i=t[0]):(r=t[0],i=t[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function Jc(e,t){return t[+(t.left!==e.site)]}function Qc(e,t){return t[+(t.left===e.site)]}var eh,th=[];function nh(){$c(this),this.x=this.y=this.arc=this.site=this.cy=null}function rh(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,a=n.site;if(r!==a){var o=i[0],s=i[1],u=r[0]-o,l=r[1]-s,c=a[0]-o,h=a[1]-s,d=2*(u*h-l*c);if(!(d>=-_h)){var f=u*u+l*l,p=c*c+h*h,v=(h*f-l*p)/d,m=(u*p-c*f)/d,g=th.pop()||new nh;g.arc=e,g.site=i,g.x=v+o,g.y=(g.cy=m+s)+Math.sqrt(v*v+m*m),e.circle=g;for(var _=null,y=vh._;y;)if(g.y<y.y||g.y===y.y&&g.x<=y.x){if(!y.L){_=y.P;break}y=y.L}else{if(!y.R){_=y;break}y=y.R}vh.insert(_,g),_||(eh=g)}}}}function ih(e){var t=e.circle;t&&(t.P||(eh=t.N),vh.remove(t),th.push(t),$c(t),e.circle=null)}var ah=[];function oh(){$c(this),this.edge=this.site=this.circle=null}function sh(e){var t=ah.pop()||new oh;return t.site=e,t}function uh(e){ih(e),fh.remove(e),ah.push(e),$c(e)}function lh(e){var t=e.circle,n=t.x,r=t.cy,i=[n,r],a=e.P,o=e.N,s=[e];uh(e);for(var u=a;u.circle&&Math.abs(n-u.circle.x)<gh&&Math.abs(r-u.circle.cy)<gh;)a=u.P,s.unshift(u),uh(u),u=a;s.unshift(u),ih(u);for(var l=o;l.circle&&Math.abs(n-l.circle.x)<gh&&Math.abs(r-l.circle.cy)<gh;)o=l.N,s.push(l),uh(l),l=o;s.push(l),ih(l);var c,h=s.length;for(c=1;c<h;++c)l=s[c],u=s[c-1],Zc(l.edge,u.site,l.site,i);u=s[0],(l=s[h-1]).edge=Wc(u.site,l.site,null,i),rh(u),rh(l)}function ch(e){for(var t,n,r,i,a=e[0],o=e[1],s=fh._;s;)if((r=hh(s,o)-a)>gh)s=s.L;else{if(!((i=a-dh(s,o))>gh)){r>-gh?(t=s.P,n=s):i>-gh?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}!function(e){ph[e.index]={site:e,halfedges:[]}}(e);var u=sh(e);if(fh.insert(t,u),t||n){if(t===n)return ih(t),n=sh(t.site),fh.insert(u,n),u.edge=n.edge=Wc(t.site,u.site),rh(t),void rh(n);if(n){ih(t),ih(n);var l=t.site,c=l[0],h=l[1],d=e[0]-c,f=e[1]-h,p=n.site,v=p[0]-c,m=p[1]-h,g=2*(d*m-f*v),_=d*d+f*f,y=v*v+m*m,b=[(m*_-f*y)/g+c,(d*y-v*_)/g+h];Zc(n.edge,l,p,b),u.edge=Wc(l,e,null,b),n.edge=Wc(e,p,null,b),rh(t),rh(n)}else u.edge=Wc(t.site,u.site)}}function hh(e,t){var n=e.site,r=n[0],i=n[1],a=i-t;if(!a)return r;var o=e.P;if(!o)return-1/0;var s=(n=o.site)[0],u=n[1],l=u-t;if(!l)return s;var c=s-r,h=1/a-1/l,d=c/l;return h?(-d+Math.sqrt(d*d-2*h*(c*c/(-2*l)-u+l/2+i-a/2)))/h+r:(r+s)/2}function dh(e,t){var n=e.N;if(n)return hh(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var fh,ph,vh,mh,gh=1e-6,_h=1e-12;function yh(e,t){return t[1]-e[1]||t[0]-e[0]}function bh(e,t){var n,r,i,a=e.sort(yh).pop();for(mh=[],ph=new Array(e.length),fh=new Hc,vh=new Hc;;)if(i=eh,a&&(!i||a[1]<i.y||a[1]===i.y&&a[0]<i.x))a[0]===n&&a[1]===r||(ch(a),n=a[0],r=a[1]),a=e.pop();else{if(!i)break;lh(i.arc)}if(function(){for(var e,t,n,r,i=0,a=ph.length;i<a;++i)if((e=ph[i])&&(r=(t=e.halfedges).length)){var o=new Array(r),s=new Array(r);for(n=0;n<r;++n)o[n]=n,s[n]=Kc(e,mh[t[n]]);for(o.sort((function(e,t){return s[t]-s[e]})),n=0;n<r;++n)s[n]=t[o[n]];for(n=0;n<r;++n)t[n]=s[n]}}(),t){var o=+t[0][0],s=+t[0][1],u=+t[1][0],l=+t[1][1];!function(e,t,n,r){for(var i,a=mh.length;a--;)Xc(i=mh[a],e,t,n,r)&&Yc(i,e,t,n,r)&&(Math.abs(i[0][0]-i[1][0])>gh||Math.abs(i[0][1]-i[1][1])>gh)||delete mh[a]}(o,s,u,l),function(e,t,n,r){var i,a,o,s,u,l,c,h,d,f,p,v,m=ph.length,g=!0;for(i=0;i<m;++i)if(a=ph[i]){for(o=a.site,s=(u=a.halfedges).length;s--;)mh[u[s]]||u.splice(s,1);for(s=0,l=u.length;s<l;)p=(f=Qc(a,mh[u[s]]))[0],v=f[1],h=(c=Jc(a,mh[u[++s%l]]))[0],d=c[1],(Math.abs(p-h)>gh||Math.abs(v-d)>gh)&&(u.splice(s,0,mh.push(Gc(o,f,Math.abs(p-e)<gh&&r-v>gh?[e,Math.abs(h-e)<gh?d:r]:Math.abs(v-r)<gh&&n-p>gh?[Math.abs(d-r)<gh?h:n,r]:Math.abs(p-n)<gh&&v-t>gh?[n,Math.abs(h-n)<gh?d:t]:Math.abs(v-t)<gh&&p-e>gh?[Math.abs(d-t)<gh?h:e,t]:null))-1),++l);l&&(g=!1)}if(g){var _,y,b,x=1/0;for(i=0,g=null;i<m;++i)(a=ph[i])&&(b=(_=(o=a.site)[0]-e)*_+(y=o[1]-t)*y)<x&&(x=b,g=a);if(g){var w=[e,t],k=[e,r],S=[n,r],M=[n,t];g.halfedges.push(mh.push(Gc(o=g.site,w,k))-1,mh.push(Gc(o,k,S))-1,mh.push(Gc(o,S,M))-1,mh.push(Gc(o,M,w))-1)}}for(i=0;i<m;++i)(a=ph[i])&&(a.halfedges.length||delete ph[i])}(o,s,u,l)}this.edges=mh,this.cells=ph,fh=vh=mh=ph=null}bh.prototype={constructor:bh,polygons:function(){var e=this.edges;return this.cells.map((function(t){var n=t.halfedges.map((function(n){return Jc(t,e[n])}));return n.data=t.site.data,n}))},triangles:function(){var e=[],t=this.edges;return this.cells.forEach((function(n,r){if(a=(i=n.halfedges).length)for(var i,a,o,s,u,l,c=n.site,h=-1,d=t[i[a-1]],f=d.left===c?d.right:d.left;++h<a;)o=f,f=(d=t[i[h]]).left===c?d.right:d.left,o&&f&&r<o.index&&r<f.index&&(u=o,l=f,((s=c)[0]-l[0])*(u[1]-s[1])-(s[0]-u[0])*(l[1]-s[1])<0)&&e.push([c.data,o.data,f.data])})),e},links:function(){return this.edges.filter((function(e){return e.right})).map((function(e){return{source:e.left.data,target:e.right.data}}))},find:function(e,t,n){for(var r,i,a=this,o=a._found||0,s=a.cells.length;!(i=a.cells[o]);)if(++o>=s)return null;var u=e-i.site[0],l=t-i.site[1],c=u*u+l*l;do{i=a.cells[r=o],o=null,i.halfedges.forEach((function(n){var r=a.edges[n],s=r.left;if(s!==i.site&&s||(s=r.right)){var u=e-s[0],l=t-s[1],h=u*u+l*l;h<c&&(c=h,o=s.index)}}))}while(null!==o);return a._found=r,null==n||c<=n*n?i.site:null}};var xh=Math.SQRT2;function wh(e){return((e=Math.exp(e))+1/e)/2}function kh(e,t){var n,r,i=e[0],a=e[1],o=e[2],s=t[0],u=t[1],l=t[2],c=s-i,h=u-a,d=c*c+h*h;if(d<1e-12)r=Math.log(l/o)/xh,n=function(e){return[i+e*c,a+e*h,o*Math.exp(xh*e*r)]};else{var f=Math.sqrt(d),p=(l*l-o*o+4*d)/(2*o*2*f),v=(l*l-o*o-4*d)/(2*l*2*f),m=Math.log(Math.sqrt(p*p+1)-p),g=Math.log(Math.sqrt(v*v+1)-v);r=(g-m)/xh,n=function(e){var t=e*r,n=wh(m),s=o/(2*f)*(n*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(xh*t+m)-function(e){return((e=Math.exp(e))-1/e)/2}(m));return[i+s*c,a+s*h,o*n/wh(xh*t+m)]}}return n.duration=1e3*r,n}function Sh(e){return function(){return e}}function Mh(e,t,n){this.target=e,this.type=t,this.transform=n}function Ch(e,t,n){this.k=e,this.x=t,this.y=n}Ch.prototype={constructor:Ch,scale:function(e){return 1===e?this:new Ch(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Ch(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Th=new Ch(1,0,0);function Eh(){Yt.stopImmediatePropagation()}function Ph(){Yt.preventDefault(),Yt.stopImmediatePropagation()}function Ah(){return!Yt.ctrlKey&&!Yt.button}function Lh(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Ih(){return this.__zoom||Th}function Rh(){return-Yt.deltaY*(1===Yt.deltaMode?.05:Yt.deltaMode?1:.002)}function Oh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Nh(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],a=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function Dh(){var e,t,n=Ah,r=Lh,i=Nh,a=Rh,o=Oh,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],l=250,c=kh,h=Ke("start","zoom","end"),d=500,f=0;function p(e){e.property("__zoom",Ih).on("wheel.zoom",x).on("mousedown.zoom",w).on("dblclick.zoom",k).filter(o).on("touchstart.zoom",S).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(e,t){return(t=Math.max(s[0],Math.min(s[1],t)))===e.k?e:new Ch(t,e.x,e.y)}function m(e,t,n){var r=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return r===e.x&&i===e.y?e:new Ch(e.k,r,i)}function g(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function _(e,t,n){e.on("start.zoom",(function(){y(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){y(this,arguments).end()})).tween("zoom",(function(){var e=this,i=arguments,a=y(e,i),o=r.apply(e,i),s=null==n?g(o):"function"===typeof n?n.apply(e,i):n,u=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),l=e.__zoom,h="function"===typeof t?t.apply(e,i):t,d=c(l.invert(s).concat(u/l.k),h.invert(s).concat(u/h.k));return function(e){if(1===e)e=h;else{var t=d(e),n=u/t[2];e=new Ch(n,s[0]-t[0]*n,s[1]-t[1]*n)}a.zoom(null,e)}}))}function y(e,t,n){return!n&&e.__zooming||new b(e,t)}function b(e,t){this.that=e,this.args=t,this.active=0,this.extent=r.apply(e,t),this.taps=0}function x(){if(n.apply(this,arguments)){var e=y(this,arguments),t=this.__zoom,r=Math.max(s[0],Math.min(s[1],t.k*Math.pow(2,a.apply(this,arguments)))),o=hr(this);if(e.wheel)e.mouse[0][0]===o[0]&&e.mouse[0][1]===o[1]||(e.mouse[1]=t.invert(e.mouse[0]=o)),clearTimeout(e.wheel);else{if(t.k===r)return;e.mouse=[o,t.invert(o)],Dr(this),e.start()}Ph(),e.wheel=setTimeout(l,150),e.zoom("mouse",i(m(v(t,r),e.mouse[0],e.mouse[1]),e.extent,u))}function l(){e.wheel=null,e.end()}}function w(){if(!t&&n.apply(this,arguments)){var e=y(this,arguments,!0),r=cn(Yt.view).on("mousemove.zoom",l,!0).on("mouseup.zoom",c,!0),a=hr(this),o=Yt.clientX,s=Yt.clientY;fn(Yt.view),Eh(),e.mouse=[a,this.__zoom.invert(a)],Dr(this),e.start()}function l(){if(Ph(),!e.moved){var t=Yt.clientX-o,n=Yt.clientY-s;e.moved=t*t+n*n>f}e.zoom("mouse",i(m(e.that.__zoom,e.mouse[0]=hr(e.that),e.mouse[1]),e.extent,u))}function c(){r.on("mousemove.zoom mouseup.zoom",null),pn(Yt.view,e.moved),Ph(),e.end()}}function k(){if(n.apply(this,arguments)){var e=this.__zoom,t=hr(this),a=e.invert(t),o=e.k*(Yt.shiftKey?.5:2),s=i(m(v(e,o),t,a),r.apply(this,arguments),u);Ph(),l>0?cn(this).transition().duration(l).call(_,s,t):cn(this).call(p.transform,s)}}function S(){if(n.apply(this,arguments)){var t,r,i,a,o=Yt.touches,s=o.length,u=y(this,arguments,Yt.changedTouches.length===s);for(Eh(),r=0;r<s;++r)a=[a=cr(this,o,(i=o[r]).identifier),this.__zoom.invert(a),i.identifier],u.touch0?u.touch1||u.touch0[2]===a[2]||(u.touch1=a,u.taps=0):(u.touch0=a,t=!0,u.taps=1+!!e);e&&(e=clearTimeout(e)),t&&(u.taps<2&&(e=setTimeout((function(){e=null}),d)),Dr(this),u.start())}}function M(){if(this.__zooming){var t,n,r,a,o=y(this,arguments),s=Yt.changedTouches,l=s.length;for(Ph(),e&&(e=clearTimeout(e)),o.taps=0,t=0;t<l;++t)r=cr(this,s,(n=s[t]).identifier),o.touch0&&o.touch0[2]===n.identifier?o.touch0[0]=r:o.touch1&&o.touch1[2]===n.identifier&&(o.touch1[0]=r);if(n=o.that.__zoom,o.touch1){var c=o.touch0[0],h=o.touch0[1],d=o.touch1[0],f=o.touch1[1],p=(p=d[0]-c[0])*p+(p=d[1]-c[1])*p,g=(g=f[0]-h[0])*g+(g=f[1]-h[1])*g;n=v(n,Math.sqrt(p/g)),r=[(c[0]+d[0])/2,(c[1]+d[1])/2],a=[(h[0]+f[0])/2,(h[1]+f[1])/2]}else{if(!o.touch0)return;r=o.touch0[0],a=o.touch0[1]}o.zoom("touch",i(m(n,r,a),o.extent,u))}}function C(){if(this.__zooming){var e,n,r=y(this,arguments),i=Yt.changedTouches,a=i.length;for(Eh(),t&&clearTimeout(t),t=setTimeout((function(){t=null}),d),e=0;e<a;++e)n=i[e],r.touch0&&r.touch0[2]===n.identifier?delete r.touch0:r.touch1&&r.touch1[2]===n.identifier&&delete r.touch1;if(r.touch1&&!r.touch0&&(r.touch0=r.touch1,delete r.touch1),r.touch0)r.touch0[1]=this.__zoom.invert(r.touch0[0]);else if(r.end(),2===r.taps){var o=cn(this).on("dblclick.zoom");o&&o.apply(this,arguments)}}}return p.transform=function(e,t,n){var r=e.selection?e.selection():e;r.property("__zoom",Ih),e!==r?_(e,t,n):r.interrupt().each((function(){y(this,arguments).start().zoom(null,"function"===typeof t?t.apply(this,arguments):t).end()}))},p.scaleBy=function(e,t,n){p.scaleTo(e,(function(){var e=this.__zoom.k,n="function"===typeof t?t.apply(this,arguments):t;return e*n}),n)},p.scaleTo=function(e,t,n){p.transform(e,(function(){var e=r.apply(this,arguments),a=this.__zoom,o=null==n?g(e):"function"===typeof n?n.apply(this,arguments):n,s=a.invert(o),l="function"===typeof t?t.apply(this,arguments):t;return i(m(v(a,l),o,s),e,u)}),n)},p.translateBy=function(e,t,n){p.transform(e,(function(){return i(this.__zoom.translate("function"===typeof t?t.apply(this,arguments):t,"function"===typeof n?n.apply(this,arguments):n),r.apply(this,arguments),u)}))},p.translateTo=function(e,t,n,a){p.transform(e,(function(){var e=r.apply(this,arguments),o=this.__zoom,s=null==a?g(e):"function"===typeof a?a.apply(this,arguments):a;return i(Th.translate(s[0],s[1]).scale(o.k).translate("function"===typeof t?-t.apply(this,arguments):-t,"function"===typeof n?-n.apply(this,arguments):-n),e,u)}),a)},b.prototype={start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){tn(new Mh(p,e,this.that.__zoom),h.apply,h,[e,this.that,this.args])}},p.wheelDelta=function(e){return arguments.length?(a="function"===typeof e?e:Sh(+e),p):a},p.filter=function(e){return arguments.length?(n="function"===typeof e?e:Sh(!!e),p):n},p.touchable=function(e){return arguments.length?(o="function"===typeof e?e:Sh(!!e),p):o},p.extent=function(e){return arguments.length?(r="function"===typeof e?e:Sh([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),p):r},p.scaleExtent=function(e){return arguments.length?(s[0]=+e[0],s[1]=+e[1],p):[s[0],s[1]]},p.translateExtent=function(e){return arguments.length?(u[0][0]=+e[0][0],u[1][0]=+e[1][0],u[0][1]=+e[0][1],u[1][1]=+e[1][1],p):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},p.constrain=function(e){return arguments.length?(i=e,p):i},p.duration=function(e){return arguments.length?(l=+e,p):l},p.interpolate=function(e){return arguments.length?(c=e,p):c},p.on=function(){var e=h.on.apply(h,arguments);return e===h?p:e},p.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,p):Math.sqrt(f)},p}Ch.prototype;var zh="event";function jh(t){var n=!(zh in e);return function(r,i){n?t.call(this,r,i):t.call(this,e.event,r)}}function Bh(e){return function(){return e}}function Fh(e,t,n,r,i,a,o,s,u,l){this.target=e,this.type=t,this.subject=n,this.identifier=r,this.active=i,this.x=a,this.y=o,this.dx=s,this.dy=u,this._=l}function $h(){return!Yt.ctrlKey&&!Yt.button}function qh(){return this.parentNode}function Uh(e){return null==e?{x:Yt.x,y:Yt.y}:e}function Vh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Hh(e){return e*(2-e)}Fh.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Wh(e){return"translate("+e+",0)"}function Gh(e){return"translate(0,"+e+")"}function Zh(e,t){t="undefined"!==typeof t?t.copy():null;var n=[0],r=[0],i=[0,10],a=100,o=100,s=!0,u="M-5.5,-5.5v10l6,5.5l6,-5.5v-10z",l=null,c=null,h=3,d=null,f=null,p=null,v=null,m=null,g=Ke("onchange","start","end","drag"),_=null,y=null,b=null,x=1===e||4===e?-1:1,w=4===e||2===e?-1:1,k=4===e||2===e?"y":"x",S=4===e||2===e?"x":"y",M=1===e||3===e?Wh:Gh,C=1===e||3===e?Gh:Wh,T=null;switch(e){case 1:T=$e;break;case 2:T=qe;break;case 3:T=Ue;break;case 4:T=Ve}var E=null,P=null,A=null;function L(r){_=r.selection?r.selection():r,t||(t=i[0]instanceof Date?function(){return nu.apply(Rc(yu,xu,Eu,Du,ju,Fu,qu,Vu,sl).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}():au(),t=t.domain(i).range(1===e||3===e?[0,a]:[o,0]).clamp(!0)),y=au().range(t.range()).domain(t.range()).clamp(!0),n=n.map((function(e){return au().range(i).domain(i).clamp(!0)(e)})),f=f||t.tickFormat(),v=v||f||t.tickFormat(),_.selectAll(".axis").data([null]).enter().append("g").attr("transform",C(7*x)).attr("class","axis");var D=_.selectAll(".slider").data([null]),z=D.enter().append("g").attr("class","slider").attr("cursor",1===e||3===e?"ew-resize":"ns-resize").call(function(){var e,t,n,r,i=$h,a=qh,o=Uh,s=Vh,u={},l=Ke("start","drag","end"),c=0,h=0;function d(e){e.on("mousedown.drag",f).filter(s).on("touchstart.drag",m).on("touchmove.drag",g).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(){if(!r&&i.apply(this,arguments)){var o=y("mouse",a.apply(this,arguments),hr,this,arguments);o&&(cn(Yt.view).on("mousemove.drag",p,!0).on("mouseup.drag",v,!0),fn(Yt.view),hn(),n=!1,e=Yt.clientX,t=Yt.clientY,o("start"))}}function p(){if(dn(),!n){var r=Yt.clientX-e,i=Yt.clientY-t;n=r*r+i*i>h}u.mouse("drag")}function v(){cn(Yt.view).on("mousemove.drag mouseup.drag",null),pn(Yt.view,n),dn(),u.mouse("end")}function m(){if(i.apply(this,arguments)){var e,t,n=Yt.changedTouches,r=a.apply(this,arguments),o=n.length;for(e=0;e<o;++e)(t=y(n[e].identifier,r,cr,this,arguments))&&(hn(),t("start"))}}function g(){var e,t,n=Yt.changedTouches,r=n.length;for(e=0;e<r;++e)(t=u[n[e].identifier])&&(dn(),t("drag"))}function _(){var e,t,n=Yt.changedTouches,i=n.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<i;++e)(t=u[n[e].identifier])&&(hn(),t("end"))}function y(e,t,n,r,i){var a,s,h,f=n(t,e),p=l.copy();if(tn(new Fh(d,"beforestart",a,e,c,f[0],f[1],0,0,p),(function(){return null!=(Yt.subject=a=o.apply(r,i))&&(s=a.x-f[0]||0,h=a.y-f[1]||0,!0)})))return function o(l){var v,m=f;switch(l){case"start":u[e]=o,v=c++;break;case"end":delete u[e],--c;case"drag":f=n(t,e),v=c}tn(new Fh(d,l,a,e,v,f[0]+s,f[1]+h,f[0]-m[0],f[1]-m[1],p),p.apply,p,[l,r,i])}}return d.filter=function(e){return arguments.length?(i="function"===typeof e?e:Bh(!!e),d):i},d.container=function(e){return arguments.length?(a="function"===typeof e?e:Bh(e),d):a},d.subject=function(e){return arguments.length?(o="function"===typeof e?e:Bh(e),d):o},d.touchable=function(e){return arguments.length?(s="function"===typeof e?e:Bh(!!e),d):s},d.on=function(){var e=l.on.apply(l,arguments);return e===l?d:e},d.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,d):Math.sqrt(h)},d}().on("start",jh((function(r){cn(this).classed("active",!0);var a=y(3===e||1===e?r.x:r.y);b=n[0]===i[0]&&n[1]===i[0]?1:n[0]===i[1]&&n[1]===i[1]?0:Le(n.map((function(e){return Math.abs(e-R(t.invert(a)))})));var o=n.map((function(e,n){return n===b?R(t.invert(a)):e}));N(o),g.call("start",D,1===o.length?o[0]:o),O(o,!0)}))).on("drag",jh((function(t){var n=B(y(3===e||1===e?t.x:t.y));N(n),g.call("drag",D,1===n.length?n[0]:n),O(n,!0)}))).on("end",jh((function(t){cn(this).classed("active",!1);var n=B(y(3===e||1===e?t.x:t.y));N(n),g.call("end",D,1===n.length?n[0]:n),O(n,!0),b=null}))));z.append("line").attr("class","track").attr(k+"1",t.range()[0]-8*w).attr("stroke","#bbb").attr("stroke-width",6).attr("stroke-linecap","round"),z.append("line").attr("class","track-inset").attr(k+"1",t.range()[0]-8*w).attr("stroke","#eee").attr("stroke-width",4).attr("stroke-linecap","round"),m&&z.append("line").attr("class","track-fill").attr(k+"1",1===n.length?t.range()[0]-8*w:t(n[0])).attr("stroke",m).attr("stroke-width",4).attr("stroke-linecap","round"),z.append("line").attr("class","track-overlay").attr(k+"1",t.range()[0]-8*w).attr("stroke","transparent").attr("stroke-width",40).attr("stroke-linecap","round").merge(D.select(".track-overlay")),E=z.selectAll(".parameter-value").data(n.map((function(e,t){return{value:e,index:t}})));var j=E.enter().append("g").attr("class","parameter-value").attr("transform",(function(e){return M(t(e.value))})).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle");function B(e){var r=R(t.invert(e));return n.map((function(e,t){return 2===n.length?t===b?0===b?Math.min(r,R(n[1])):Math.max(r,R(n[0])):e:t===b?r:e}))}j.append("path").attr("transform","rotate("+90*(e+1)+")").attr("d",u).attr("class","handle").attr("aria-label","handle").attr("aria-valuemax",i[1]).attr("aria-valuemin",i[0]).attr("aria-valuenow",(function(e){return e.value})).attr("aria-orientation",4===e||2===e?"vertical":"horizontal").attr("focusable","true").attr("tabindex",0).attr("fill","white").attr("stroke","#777").on("keydown",jh((function(e,t){var r=l||(i[1]-i[0])/100,a=d?Le(d.map((function(e){return Math.abs(n[t.index]-e)}))):null;function o(e){return n.map((function(r,i){return 2===n.length?i===t.index?0===t.index?Math.min(e,R(n[1])):Math.max(e,R(n[0])):r:i===t.index?e:r}))}switch(e.key){case"ArrowLeft":case"ArrowDown":d?L.value(o(d[Math.max(0,a-1)])):L.value(o(+n[t.index]-r)),e.preventDefault();break;case"PageDown":d?L.value(o(d[Math.max(0,a-2)])):L.value(o(+n[t.index]-2*r)),e.preventDefault();break;case"ArrowRight":case"ArrowUp":d?L.value(o(d[Math.min(d.length-1,a+1)])):L.value(o(+n[t.index]+r)),e.preventDefault();break;case"PageUp":d?L.value(o(d[Math.min(d.length-1,a+2)])):L.value(o(+n[t.index]+2*r)),e.preventDefault();break;case"Home":L.value(o(i[0])),e.preventDefault();break;case"End":L.value(o(i[1])),e.preventDefault()}}))),s&&j.append("text").attr("font-size",10).attr(S,x*(24+h)).attr("dy",1===e?"0em":3===e?".71em":".32em").attr("transform",n.length>1?"translate(0,0)":null).text((function(e,t){return v(n[t])})),r.select(".track").attr(k+"2",t.range()[1]+8*w),r.select(".track-inset").attr(k+"2",t.range()[1]+8*w),m&&r.select(".track-fill").attr(k+"2",1===n.length?t(n[0]):t(n[1])),r.select(".track-overlay").attr(k+"2",t.range()[1]+8*w),r.select(".axis").call(T(t).tickFormat(f).ticks(p).tickValues(c).tickPadding(h)),_.select(".axis").select(".domain").remove(),r.select(".axis").attr("transform",C(7*x)),r.selectAll(".axis text").attr("fill","#aaa").attr(S,x*(17+h)).attr("dy",1===e?"0em":3===e?".71em":".32em").attr("text-anchor",2===e?"start":4===e?"end":"middle"),r.selectAll(".axis line").attr("stroke","#aaa"),r.selectAll(".parameter-value").attr("transform",(function(e){return M(t(e.value))})),I(),A=_.selectAll(".parameter-value text"),P=_.select(".track-fill")}function I(){if(_&&s){var e=[];if(n.forEach((function(t){var n=[];_.selectAll(".axis .tick").each((function(e){n.push(Math.abs(e-t))})),e.push(Le(n))})),_.selectAll(".axis .tick text").attr("opacity",(function(t,n){return~e.indexOf(n)?0:1})),A&&n.length>1){var t,r,i=[],a=[];A.nodes().forEach((function(e,n){t=e.getBoundingClientRect(),r=e.getAttribute("transform").split(/[()]/)[1].split(",")["x"===k?0:1],i[n]=t[k]-parseFloat(r),a[n]=t["x"===k?"width":"height"]})),"x"===k?(r=Math.max(0,(i[0]+a[0]-i[1])/2),A.attr("transform",(function(e,t){return"translate("+(1===t?r:-r)+",0)"}))):(r=Math.max(0,(i[1]+a[1]-i[0])/2),A.attr("transform",(function(e,t){return"translate(0,"+(1===t?-r:r)+")"})))}}}function R(e){if(d){var t=Le(d.map((function(t){return Math.abs(e-t)})));return d[t]}if(l){var n=(e-i[0])%l,r=e-n;return 2*n>l&&(r+=l),e instanceof Date?new Date(r):r}return e}function O(e,t){(n[0]!==e[0]||n.length>1&&n[1]!==e[1])&&(n=e,t&&g.call("onchange",L,1===e.length?e[0]:e),I())}function N(e,r){_&&((r="undefined"!==typeof r&&r)?(_.selectAll(".parameter-value").data(e.map((function(e,t){return{value:e,index:t}}))).transition().ease(Hh).duration(200).attr("transform",(function(e){return M(t(e.value))})).select(".handle").attr("aria-valuenow",(function(e){return e.value})),m&&P.transition().ease(Hh).duration(200).attr(k+"1",1===n.length?t.range()[0]-8*x:t(e[0])).attr(k+"2",1===n.length?t(e[0]):t(e[1]))):(_.selectAll(".parameter-value").data(e.map((function(e,t){return{value:e,index:t}}))).attr("transform",(function(e){return M(t(e.value))})).select(".handle").attr("aria-valuenow",(function(e){return e.value})),m&&P.attr(k+"1",1===n.length?t.range()[0]-8*x:t(e[0])).attr(k+"2",1===n.length?t(e[0]):t(e[1]))),s&&A.text((function(t,n){return v(e[n])})))}return t&&(i=[Ae(t.domain()),Ee(t.domain())],1===e||3===e?a=Ee(t.range())-Ae(t.range()):o=Ee(t.range())-Ae(t.range()),t=t.clamp(!0)),L.min=function(e){return arguments.length?(i[0]=e,t&&t.domain(i),L):i[0]},L.max=function(e){return arguments.length?(i[1]=e,t&&t.domain(i),L):i[1]},L.domain=function(e){return arguments.length?(i=e,t&&t.domain(i),L):i},L.width=function(e){return arguments.length?(a=e,t&&t.range([t.range()[0],t.range()[0]+a]),L):a},L.height=function(e){return arguments.length?(o=e,t&&t.range([t.range()[0],t.range()[0]+o]),L):o},L.tickFormat=function(e){return arguments.length?(f=e,L):f},L.displayFormat=function(e){return arguments.length?(v=e,L):v},L.ticks=function(e){return arguments.length?(p=e,L):p},L.value=function(e){if(!arguments.length)return 1===n.length?n[0]:n;var r=Array.isArray(e)?e:[e];if(r.sort((function(e,t){return e-t})),t){var i=r.map(t).map(y),a=i.map(t.invert).map(R);N(a,!0),O(a,!0)}else n=r;return L},L.silentValue=function(e){if(!arguments.length)return 1===n.length?n[0]:n;var r=Array.isArray(e)?e:[e];if(r.sort((function(e,t){return e-t})),t){var i=r.map(t).map(y),a=i.map(t.invert).map(R);N(a,!1),O(a,!1)}else n=r;return L},L.default=function(e){if(!arguments.length)return 1===r.length?r[0]:r;var t=Array.isArray(e)?e:[e];return t.sort((function(e,t){return e-t})),r=t,n=t,L},L.step=function(e){return arguments.length?(l=e,L):l},L.tickValues=function(e){return arguments.length?(c=e,L):c},L.tickPadding=function(e){return arguments.length?(h=e,L):h},L.marks=function(e){return arguments.length?(d=e,L):d},L.handle=function(e){return arguments.length?(u=e,L):u},L.displayValue=function(e){return arguments.length?(s=e,L):s},L.fill=function(e){return arguments.length?(m=e,L):m},L.on=function(){var e=g.on.apply(g,arguments);return e===g?L:e},L}function Yh(e){return Zh(3,e)}function Xh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kh(Object(n),!0).forEach((function(t){Xh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qh=(0,t.createContext)(null),ed=Qh.Provider;function td(){var e=(0,t.useContext)(Qh);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function nd(){return td().map}var rd=n(8559),id=n.n(rd);n(5803);var ad=function(){function e(e){return fetch(e).then((function(e){return e.json()}))}return(0,t.useEffect)((function(){!function(){cn("#mapContainer").select("svg").remove(),cn("#mapContainer").select("button").remove(),cn("#mapResetButton").append("button").attr("id","resetButton").text("Reset Zoom").on("click",(function(){cn("#mapContainer").select("svg").call(o.transform,Th.scale(1))}));var e=500,t=600,n=cn("#mapContainer").append("svg").attr("width",e).attr("height",t).attr("style","outline: thick solid lightgrey"),r=(n.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",e).attr("height",t).attr("x",0).attr("y",0),js().scale(100*e).center([-118.4,34.03]).translate([e/2,t/2])),i=Yo().projection(r),a=cn("#mapContainer").append("div").attr("class","tooltip").style("opacity",0);(function(e,t){return fetch(e,t).then(ia)})("/LAStreet/lacounty.geojson").then((function(e){n.append("g").selectAll("path").data(e.features).join("path").attr("fill","none").style("stroke","black").style("stroke-width","0.2px").attr("d",i).on("mouseover",(function(e,t){cn(this).transition().duration("100").style("stroke","#C6ECFF").style("stroke-width","0.2px"),a.transition().duration(100).style("opacity",1),console.log(e),a.html("Street Name: "+e.properties.ST_NAME+" ").style("left",Yt.pageX+15+"px").style("top",Yt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("100").style("stroke","black"),a.transition().duration("200").style("opacity",0)}))}));var o=Dh().filter((function(){return!Yt.button})).scaleExtent([.8,20]).extent([[0,0],[e,t]]).on("zoom",(function(){n.selectAll("g").attr("transform",Yt.transform)}));cn("#mapContainer").select("svg").call(o).call(o.transform,Th.scale(1))}()}),[]),e("/LAStreet/hillside_inventory_LA_centrality_full.geojson").then((function(e){e.features.forEach((function(e){var t,n=e.properties.width_ratio;t=n>1?1:n<.5?.1:3.6*Math.pow(n-.5,2)+.1,t=Math.round(1e4*t)/1e4,e.properties.width_rating=t;var r,i=e.properties.pci;r=Math.pow(i/100,2),r=Math.round(1e4*r)/1e4,e.properties.pci_rating=r;var a,o=e.properties.sidewalk_ratio;a=o>.19?1:o<0?.1:24.931*Math.pow(o,2)+.1,a=Math.round(1e4*a)/1e4,e.properties.sidewalk_rating=a;var s,u=e.properties.curb_ratio;s=u>.25?1:u<0?.1:14.4*Math.pow(u,2)+.1,s=Math.round(1e4*s)/1e4,e.properties.curb_rating=s}));var t=e.features,n=[];t.forEach((function(e){n.push(e.properties)})),console.log(t);var r={widthRW:.33,pciRW:.33,curbRW:.26,sidewalkRW:.07,distanceW:.25,populationW:.25,timeW:.25,widthW:.25};function i(e){return n.forEach((function(t){var n=t.width_rating,r=t.pci_rating,i=t.curb_rating,a=t.sidewalk_rating;console.log(e.widthRW),console.log(e.pciRW);var o=e.widthRW+e.pciRW+e.curbRW+e.sidewalkRW;console.log(o);var s=n*e.widthRW/o+r*e.pciRW/o+i*e.curbRW/o+a*e.sidewalkRW/o;t.condition=s;var u=t.centrality_distance,l=t.centrality_time,c=t.centrality_width,h=t.centrality_population,d=u*e.distanceW+l*e.timeW+c*e.widthW+h*e.populationW;t.importance=d})),n}i(r),console.log(n),cn("#container").select("svg").remove(),cn("#container").select("button").remove(),cn("#container").append("button").attr("id","resetButton").text("Reset Zoom").on("click",(function(){cn("#container").select("svg").call(xe.transform,Th.scale(1))}));var a,o,s={top:20,right:20,bottom:30,left:40},u=750-s.left-s.right,l=550-s.top-s.bottom,c=u/l,h=window.innerWidth;h/window.innerHeight>c?(a=l,o=u):(s.left=40,a=(o=h-40)/c);var d=o-50-s.right,f=a-s.top-s.bottom,p=cn("#container").append("svg").attr("width",d).attr("height",f).attr("overflow","visible").attr("style","outline: thick solid lightgrey").style("background","white"),v=au().domain([0,1]).range([0,d]),m=pu().domain([1e-10,1]).range([f,0]),g=p.append("g").attr("transform","translate(0, ".concat(f,")")).attr("class","axis").call(Ue(v).ticks(5)),_=p.append("g").attr("class","axis").call(Ve(m).ticks(5));p.append("text").attr("class","label").attr("x",d/2-30).attr("y",f+50).text("Condition"),p.append("text").attr("class","label").attr("y",f-500).attr("x",-250).attr("transform","rotate(-90)").text("Importance");p.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",d).attr("height",f).attr("x",0).attr("y",0);var y=p.append("g").attr("clip-path","url(#clip)").attr("id","scatter"),b=cn("#container").append("div").attr("class","tooltip").style("opacity",0);y.selectAll().data(n).enter().append("circle").attr("id","dots").attr("cx",(function(e){return v(e.condition)})).attr("cy",(function(e){return m(e.importance)})).attr("r",5).attr("class","non_brushed").on("mouseover",(function(e,t){cn(this).transition().duration("100").attr("r",7),b.transition().duration(100).style("opacity",1),b.html("Street Name: "+e.ST_NAME+" Condition: "+Math.round(1e4*e.condition)/1e4+" Importance: "+Math.round(1e4*e.importance)/1e4).style("left",Yt.pageX+15+"px").style("top",Yt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("200").attr("r",5),b.transition().duration("200").style("opacity",0)}));cn("#multiselect1").select("#selectBox1").remove(),cn("#multiselect2").select("#selectBox2").remove(),cn("#multiselect3").select("#selectBox3").remove(),cn("#multiselect4").select("#selectBox4").remove(),cn("#multiselect5").select("#selectBox5").remove(),cn("#multiselect6").select("#selectBox6").remove();var x=!1;function w(e){var t=document.getElementById(e);x?(t.style.display="none",x=!1):(t.style.display="block",x=!0)}cn("#multiselect1").append("div").attr("id","selectBox1").on("click",(function(){w("checkboxes1")}));var k=cn("#selectBox1").append("select");k.append("option").text("Select community...");cn("#selectBox1").append("div").attr("id","overSelect");var S=cn("#multiselect1").append("div").attr("id","checkboxes1");S.append("label").text("Non disadvantage Community ").append("input").attr("type","checkbox").attr("value","nondisadvantage"),S.append("label").text("Disadvantage Community ").append("input").attr("type","checkbox").attr("value","disadvantage"),S.append("label").text("Low Income ").append("input").attr("type","checkbox").attr("value","lowincome"),S.on("change",(function(e){k.style("background-color","#C6ECFF");var t=[];jc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(N(n,D,z,t,B,F,$),!1)}));cn("#multiselect2").append("div").attr("id","selectBox2").on("click",(function(){w("checkboxes2")}));var M=cn("#selectBox2").append("select");M.append("option").text("Select withdrawn...");cn("#selectBox2").append("div").attr("id","overSelect");var C=cn("#multiselect2").append("div").attr("id","checkboxes2");C.append("label").text("Withdrawn ").append("input").attr("type","checkbox").attr("value","withdrawn"),C.append("label").text("Not Withdrawn").append("input").attr("type","checkbox").attr("value","notwithdrawn"),C.on("change",(function(e){M.style("background-color","#C6ECFF");var t=[];jc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(N(n,D,z,j,B,t,$),!1)}));cn("#multiselect3").append("div").attr("id","selectBox3").on("click",(function(){w("checkboxes3")}));var T=cn("#selectBox3").append("select");T.append("option").text("Select maintain...");cn("#selectBox3").append("div").attr("id","overSelect");var E=cn("#multiselect3").append("div").attr("id","checkboxes3");E.append("label").text("Maintained ").append("input").attr("type","checkbox").attr("value","maintain"),E.append("label").text("Not Maintained").append("input").attr("type","checkbox").attr("value","notmaintain"),E.on("change",(function(e){T.style("background-color","#C6ECFF");var t=[];jc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(N(n,D,z,j,B,F,t),!1)}));cn("#multiselect4").append("div").attr("id","selectBox4").on("click",(function(){w("checkboxes4")}));var P=cn("#selectBox4").append("select");P.append("option").text("Select Location...");cn("#selectBox4").append("div").attr("id","overSelect");var A=cn("#multiselect4").append("div").attr("id","checkboxes4");A.append("label").text("North Los Angeles ").append("input").attr("type","checkbox").attr("value","northla"),A.append("label").text("Central Los Angeles ").append("input").attr("type","checkbox").attr("value","centralla"),A.append("label").text("South Los Angeles ").append("input").attr("type","checkbox").attr("value","southla"),A.on("change",(function(e){P.style("background-color","#C6ECFF");var t=[];jc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(N(n,D,t,j,B,F,$),!1)}));cn("#multiselect5").append("div").attr("id","selectBox5").on("click",(function(){w("checkboxes5")}));var L=cn("#selectBox5").append("select");L.append("option").text("Select Council District...");cn("#selectBox5").append("div").attr("id","overSelect");var I=cn("#multiselect5").append("div").attr("id","checkboxes5");I.append("label").text("1 ").append("input").attr("type","checkbox").attr("value","1"),I.append("label").text("2 ").append("input").attr("type","checkbox").attr("value","2"),I.append("label").text("3 ").append("input").attr("type","checkbox").attr("value","3"),I.append("label").text("4 ").append("input").attr("type","checkbox").attr("value","4"),I.append("label").text("5 ").append("input").attr("type","checkbox").attr("value","5"),I.append("label").text("6 ").append("input").attr("type","checkbox").attr("value","6"),I.append("label").text("7 ").append("input").attr("type","checkbox").attr("value","7"),I.append("label").text("11 ").append("input").attr("type","checkbox").attr("value","11"),I.append("label").text("12 ").append("input").attr("type","checkbox").attr("value","12"),I.append("label").text("13 ").append("input").attr("type","checkbox").attr("value","13"),I.append("label").text("14 ").append("input").attr("type","checkbox").attr("value","14"),I.append("label").text("15 ").append("input").attr("type","checkbox").attr("value","15"),I.on("change",(function(e){L.style("background-color","#C6ECFF");var t=[];jc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(N(n,D,z,j,t,F,$),!1)}));cn("#multiselect6").append("div").attr("id","selectBox6").on("click",(function(){w("checkboxes6")}));var R=cn("#selectBox6").append("select");R.append("option").text("Select Designation...");cn("#selectBox6").append("div").attr("id","overSelect");var O=cn("#multiselect6").append("div").attr("id","checkboxes6");function N(e,t,n,r,i,a,o){var s=[],u=q(t,e),l=U(n,e),c=V(r,e),h=H(i,e),d=W(a,e),f=G(o,e);return u.forEach((function(e){l.includes(e)&&c.includes(e)&&h.includes(e)&&d.includes(e)&&f.includes(e)&&s.push(e)})),s}O.append("label").text("Avenue I ").append("input").attr("type","checkbox").attr("value","Avenue I"),O.append("label").text("Avenue II ").append("input").attr("type","checkbox").attr("value","Avenue II"),O.append("label").text("Avenue III ").append("input").attr("type","checkbox").attr("value","Avenue III"),O.append("label").text("Boulevard I ").append("input").attr("type","checkbox").attr("value","Boulevard I"),O.append("label").text("Boulevard II ").append("input").attr("type","checkbox").attr("value","Boulevard II"),O.append("label").text("Collector ").append("input").attr("type","checkbox").attr("value","Collector"),O.append("label").text("Hillside Collector ").append("input").attr("type","checkbox").attr("value","Hillside Collector"),O.append("label").text("Local Street - Standard ").append("input").attr("type","checkbox").attr("value","Local Street - Standard"),O.append("label").text("Modified Avenue I ").append("input").attr("type","checkbox").attr("value","Modified Avenue I"),O.append("label").text("Modified Avenue II ").append("input").attr("type","checkbox").attr("value","Modified Avenue II"),O.append("label").text("Modified Avenue III ").append("input").attr("type","checkbox").attr("value","Modified Avenue III"),O.append("label").text("Modified Boulevard II ").append("input").attr("type","checkbox").attr("value","Modified Boulevard II"),O.append("label").text("Modified Collector ").append("input").attr("type","checkbox").attr("value","Modified Collector"),O.append("label").text("Modified Local Street Standard ").append("input").attr("type","checkbox").attr("value","Modified Local Street Standard"),O.append("label").text("Modified Scenic Arterial Mountain ").append("input").attr("type","checkbox").attr("value","Modified Scenic Arterial Mountain"),O.append("label").text("Mountain Collector ").append("input").attr("type","checkbox").attr("value","Mountain Collector"),O.append("label").text("Private ").append("input").attr("type","checkbox").attr("value","Private"),O.append("label").text("Scenic Parkway ").append("input").attr("type","checkbox").attr("value","Scenic Parkway"),O.append("label").text("Unidentified ").append("input").attr("type","checkbox").attr("value","Unidentified"),O.on("change",(function(e){R.style("background-color","#C6ECFF");var t=[];jc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(N(n,t,z,j,B,F,$),!1)}));var D=["Avenue I","Avenue II","Avenue III","Boulevard I","Boulevard II","Collector","Hillside Collector","Local Street - Standard","Modified Avenue I","Modified Avenue II","Modified Avenue III","Modified Boulevard II","Modified Collector","Modified Local Street Standard","Modified Scenic Arterial Mountain","Mountain Collector","Private","Scenic Parkway","Unidentified"],z=["northla","centralla","southla"],j=["lowincome","disadvantage","nondisadvantage"],B=["1","2","3","4","5","6","7","11","12","13","14","15"],F=["withdrawn","notwithdrawn"],$=["maintain","notmaintain"];function q(e,t){var n=[];return e.indexOf("Avenue I")>-1&&t.forEach((function(e){"Avenue I"==e.Street_Designation&&n.push(e)})),e.indexOf("Avenue II")>-1&&t.forEach((function(e){"Avenue II"==e.Street_Designation&&n.push(e)})),e.indexOf("Avenue III")>-1&&t.forEach((function(e){"Avenue III"==e.Street_Designation&&n.push(e)})),e.indexOf("Boulevard I")>-1&&t.forEach((function(e){"Boulevard I"==e.Street_Designation&&n.push(e)})),e.indexOf("Boulevard II")>-1&&t.forEach((function(e){"Boulevard II"==e.Street_Designation&&n.push(e)})),e.indexOf("Collector")>-1&&t.forEach((function(e){"Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Hillside Collector")>-1&&t.forEach((function(e){"Hillside Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Local Street - Standard")>-1&&t.forEach((function(e){"Local Street - Standard"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Avenue I")>-1&&t.forEach((function(e){"Modified Avenue I"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Avenue II")>-1&&t.forEach((function(e){"Modified Avenue II"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Avenue III")>-1&&t.forEach((function(e){"Modified Avenue III"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Boulevard II")>-1&&t.forEach((function(e){"Modified Boulevard II"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Collector")>-1&&t.forEach((function(e){"Modified Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Local Street Standard")>-1&&t.forEach((function(e){"Modified Local Street Standard"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Scenic Arterial Mountain")>-1&&t.forEach((function(e){"Modified Scenic Arterial Mountain"==e.Street_Designation&&n.push(e)})),e.indexOf("Mountain Collector")>-1&&t.forEach((function(e){"Mountain Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Private")>-1&&t.forEach((function(e){"Private"==e.Street_Designation&&n.push(e)})),e.indexOf("Scenic Parkway")>-1&&t.forEach((function(e){"Scenic Parkway"==e.Street_Designation&&n.push(e)})),e.indexOf("Unidentified")>-1&&t.forEach((function(e){"Unidentified"==e.Street_Designation&&n.push(e)})),n}function U(e,t){var n=[];return e.indexOf("northla")>-1&&t.forEach((function(e){e.centroid_lat>34.1935&&n.push(e)})),e.indexOf("centralla")>-1&&t.forEach((function(e){e.centroid_lat>33.911&&e.centroid_lat<34.1935&&n.push(e)})),e.indexOf("southla")>-1&&t.forEach((function(e){e.centroid_lat<33.911&&n.push(e)})),n}function V(e,t){var n=[];return e.indexOf("disadvantage")>-1&&t.forEach((function(e){1==e.DAC&&n.push(e)})),e.indexOf("nondisadvantage")>-1&&t.forEach((function(e){0==e.DAC&&n.push(e)})),e.indexOf("lowincome")>-1&&t.forEach((function(e){1==e.lowincome&&n.push(e)})),n}function H(e,t){var n=[];return e.indexOf("1")>-1&&t.forEach((function(e){1==e.CD&&n.push(e)})),e.indexOf("2")>-1&&t.forEach((function(e){2==e.CD&&n.push(e)})),e.indexOf("3")>-1&&t.forEach((function(e){3==e.CD&&n.push(e)})),e.indexOf("4")>-1&&t.forEach((function(e){4==e.CD&&n.push(e)})),e.indexOf("5")>-1&&t.forEach((function(e){5==e.CD&&n.push(e)})),e.indexOf("6")>-1&&t.forEach((function(e){6==e.CD&&n.push(e)})),e.indexOf("7")>-1&&t.forEach((function(e){7==e.CD&&n.push(e)})),e.indexOf("11")>-1&&t.forEach((function(e){11==e.CD&&n.push(e)})),e.indexOf("12")>-1&&t.forEach((function(e){12==e.CD&&n.push(e)})),e.indexOf("13")>-1&&t.forEach((function(e){13==e.CD&&n.push(e)})),e.indexOf("14")>-1&&t.forEach((function(e){14==e.CD&&n.push(e)})),e.indexOf("15")>-1&&t.forEach((function(e){15==e.CD&&n.push(e)})),n}function W(e,t){var n=[];return e.indexOf("withdrawn")>-1&&t.forEach((function(e){1==e.withdrawn&&n.push(e)})),e.indexOf("notwithdrawn")>-1&&t.forEach((function(e){0==e.withdrawn&&n.push(e)})),n}function G(e,t){var n=[];return e.indexOf("maintain")>-1&&t.forEach((function(e){0==e.Not_maintained&&n.push(e)})),e.indexOf("notmaintain")>-1&&t.forEach((function(e){1==e.Not_maintained&&n.push(e)})),n}var Z=[],Y=q(D,n),X=U(z,n),K=V(j,n),J=H(B,n),Q=W(F,n),ee=G($,n);function te(e,t){cn("#container").selectAll('[id="dots"]').remove(),cn("#container").select('[id="scatter"]').selectAll("circle").data(e).enter().append("circle").attr("id","dots").attr("cx",(function(e){return v(e.condition)})).attr("cy",(function(e){return m(e.importance)})).attr("r",5).attr("class","non_brushed").on("mouseover",(function(e,t){cn(this).transition().duration("100").attr("r",7),b.transition().duration(100).style("opacity",1),b.html("Street Name: "+e.ST_NAME+" Condition: "+Math.round(1e4*e.condition)/1e4+" Importance: "+Math.round(1e4*e.importance)/1e4).style("left",Yt.pageX+15+"px").style("top",Yt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("200").attr("r",5),b.transition().duration("200").style("opacity",0)})),1==t&&ye()}Y.forEach((function(e){X.includes(e)&&K.includes(e)&&J.includes(e)&&Q.includes(e)&&ee.includes(e)&&Z.push(e)})),cn("#sliderContainer1").select("svg").remove(),cn("#sliderContainer2").select("svg").remove(),cn("#sliderContainer3").select("svg").remove(),cn("#sliderContainer4").select("svg").remove(),cn("#sliderContainer5").select("svg").remove(),cn("#sliderContainer6").select("svg").remove(),cn("#sliderContainer7").select("svg").remove(),cn("#sliderContainer8").select("svg").remove(),cn("#sliderValueOne").select("g").remove(),cn("#sliderValueTwo").select("g").remove(),cn("#sliderValueThree").select("g").remove(),cn("#sliderValueFour").select("g").remove(),cn("#sliderValueFive").select("g").remove(),cn("#sliderValueSix").select("g").remove(),cn("#sliderValueSeven").select("g").remove(),cn("#sliderValueEight").select("g").remove();var ne=Yh().min(0).max(1).width(100).ticks(5).default(.33).on("onchange",(function(e){ce.text(va(".2")(e)),r.widthRW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),re=Yh().min(0).max(1).width(100).ticks(5).default(.33).on("onchange",(function(e){he.text(va(".2")(e)),r.pciRW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),ie=Yh().min(0).max(1).width(100).ticks(5).default(.26).on("onchange",(function(e){de.text(va(".2")(e)),r.curbRW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),ae=Yh().min(0).max(1).width(100).ticks(5).default(.07).on("onchange",(function(e){fe.text(va(".2")(e)),r.sidewalkRW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),oe=Yh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){pe.text(va(".2")(e)),r.distanceW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),se=Yh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){ve.text(va(".2")(e)),r.timeW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),ue=Yh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){me.text(va(".2")(e)),r.widthW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),le=Yh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){ge.text(va(".2")(e)),r.populationW=e,p.selectAll('[id="dots"]').remove(),console.log(r),te(N(i(r),D,z,j,B,F,$),!0)})),ce=cn("#sliderValueOne").append("g").append("text"),he=cn("#sliderValueTwo").append("g").append("text"),de=cn("#sliderValueThree").append("g").append("text"),fe=cn("#sliderValueFour").append("g").append("text"),pe=cn("#sliderValueFive").append("g").append("text"),ve=cn("#sliderValueSix").append("g").append("text"),me=cn("#sliderValueSeven").append("g").append("text"),ge=cn("#sliderValueEight").append("g").append("text");cn("#sliderContainer1").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(ne),cn("#sliderContainer2").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(re),cn("#sliderContainer3").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(ie),cn("#sliderContainer4").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(ae),cn("#sliderContainer5").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(oe),cn("#sliderContainer6").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(se),cn("#sliderContainer7").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(ue),cn("#sliderContainer8").append("svg").attr("width",150).attr("height",70).append("g").attr("transform","translate(30,30)").call(le);var _e=Xi().on("brush",(function(){if(null!=Yt.selection){var e=cn("#container").selectAll('[id="dots"]');e.attr("class","non_brushed");var t=function(e){var t=e.__brush;return t?t.dim.output(t.selection):null}(this);e.filter((function(){var e=cn(this).attr("cx"),n=cn(this).attr("cy");return function(e,t,n){var r=e[0][0],i=e[1][0],a=e[0][1],o=e[1][1];return r<=t&&t<=i&&a<=n&&n<=o}(t,e,n)})).attr("class","brushed")}})).on("end",(function(){var t=[],n=[],r=[];if(Yt.selection){cn(this).call(_e.move,null);var i=[],a=[],o=0;jc(".brushed").data().filter((function(e){a.push(e.OBJECTID),o+=parseFloat(e.Shape__Length),o=Math.round(1e4*o)/1e4,i.push("Total selected miles: "+Math.round(o/5280*100)/100),i.push("Number of selected street sections: "+a.length)})),console.log(i);var s=[];a.forEach((function(t){var n=e.features.map((function(e){return{OBJECTID:e.properties.OBJECTID,geometry:e.geometry,ST_NAME:e.properties.ST_NAME}}));n.forEach((function(e){if(e.OBJECTID===t){var n={OBJECTID:e.OBJECTID,geometry:e.geometry,ST_NAME:e.ST_NAME};s.push(n)}}))})),console.log(s);var u=js().scale(5e4).center([-118.4,34.03]).translate([250,300]),l=Yo().projection(u);if(s.length>0){t=[],n=[],s.forEach((function(e){return t.push(e)})),s.forEach((function(e){var t=e.ST_NAME;e.geometry.ST_NAME=t})),s.forEach((function(e){return n.push(e.geometry)})),cn("#mapContainer").select('[id="selected_streets"]').remove(),jc("path[class*='street']").style("stroke","none"),console.log(t),console.log(n);var c=[];n.forEach((function(e){console.log(e);var t={longitude:e.coordinates[0][1],latitude:e.coordinates[0][0]};c.push(t)})),cn("#mapContainer").select("svg").append("g").attr("id","selected_streets").selectAll("circle").data(c).enter().append("circle").attr("cx",(function(e){return u([e.latitude,e.longitude])[0]})).attr("cy",(function(e){return u([e.latitude,e.longitude])[1]})).attr("r",8).style("opacity",.5).style("fill","#B8EC87");var h=cn("#mapContainer").append("div").attr("class","tooltip").style("opacity",0),p=cn("#leafletTooltip").append("div").attr("class","tooltipTwo").style("opacity",0);console.log(n),cn('[id="selected_streets"]').selectAll("path").data(n).join("path").attr("fill","none").style("stroke","blue").style("r",5).style("stroke-width","0.2px").attr("d",l).on("mouseover",(function(e,t){cn(this).transition().duration("100").style("stroke","grey").style("stroke-width","0.3px"),h.transition().duration(100).style("opacity",1),console.log(e),h.html("Street Name: "+e.ST_NAME+" ").style("left",Yt.pageX+15+"px").style("top",Yt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("100").style("stroke","blue").style("stroke-width","0.2px"),h.transition().duration("200").style("opacity",0)})),t.forEach((function(t){console.log(t.OBJECTID),cn(".street"+t.OBJECTID).style("stroke","blue").attr("fill","none").style("pointer-events","visible").style("stroke-width","20px").style("stroke-opacity",.7).on("click",(function(){console.log(cn(this).attr("class"))})).on("mouseover",(function(t,n){cn(this).transition().duration("100").style("stroke","red").style("stroke-width","20px"),p.transition().duration(100).style("opacity",1);var r,i=cn(this).attr("class"),a=i.slice(6,i.length);e.features.forEach((function(e){e.properties.OBJECTID==a&&(r=e.properties.ST_NAME)})),p.html("Street name: "+r).attr("x",d-50).attr("y",f)})).on("mouseout",(function(e,t){cn(this).transition().duration("100").style("stroke","blue").style("stroke-width","20px"),p.transition().duration("200").style("opacity",0)}))}))}else t=[],cn("#mapContainer").select('[id="selected_streets"]').remove(),jc("path[class*='street']").style("stroke","none");i.length>0?((r=[]).push(i[i.length-1]),r.push(i[i.length-2]),cn("#selected_regions_title").select("text").remove(),cn("#selected_regions_title").append("text").attr("x",0).attr("y",f+80).html(r.join(", "))):(r=[],cn("#selected_regions_title").select("text").remove())}}));function ye(e){1==e?p.append("g").attr("id","brushrect").call(_e):cn("#brushrect").remove()}var be=!1;cn("#switchModeButton").on("click",(function(e){be?(cn("#switchModeButton").text("Tooltip mode"),be=!1,ye(!1)):(cn("#switchModeButton").text("Brush mode"),ye(!0),be=!0)})),cn("#container").select("svg").append("g").attr("id","selected_regions_title").append("text").style("fill","grey").attr("x",0).attr("y",f+80).html("Brush to select:");var xe=Dh().filter((function(){return!Yt.button})).scaleExtent([.5,20]).extent([[0,0],[d,f]]).on("zoom",(function(){var e=Yt.transform.rescaleX(v),t=Yt.transform.rescaleY(m);g.call(Ue(e)),_.call(Ve(t)),y.selectAll("circle").attr("cx",(function(t){return e(t.condition)})).attr("cy",(function(e){return t(e.importance)}))}));cn("#container").select("svg").call(xe).call(xe.transform,Th.scale(1))})),id().icon({iconSize:[25,41],iconAnchor:[10,41],popupAnchor:[2,-40],iconUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-shadow.png"}),(0,se.jsxs)("div",{id:"bigcontainer",children:[(0,se.jsx)("div",{id:"scrollable-div",children:(0,se.jsxs)("div",{id:"scrollable-content",children:[(0,se.jsx)("div",{id:"sliderFamily",children:(0,se.jsxs)("div",{id:"sliderFirstRow",children:[(0,se.jsxs)("div",{id:"sliderContainer1",children:[(0,se.jsx)("p",{children:"Width Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueOne"})]}),(0,se.jsxs)("div",{id:"sliderContainer2",children:[(0,se.jsx)("p",{children:"PCI Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueTwo"})]}),(0,se.jsxs)("div",{id:"sliderContainer3",children:[(0,se.jsx)("p",{children:"Curb Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueThree"})]}),(0,se.jsxs)("div",{id:"sliderContainer4",children:[(0,se.jsx)("p",{children:"Sidewalk Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueFour"})]}),(0,se.jsxs)("div",{id:"sliderContainer5",children:[(0,se.jsx)("p",{children:"Importance Distance Weight"}),(0,se.jsx)("div",{id:"sliderValueFive"})]}),(0,se.jsxs)("div",{id:"sliderContainer6",children:[(0,se.jsx)("p",{children:"Importance Population Weight"}),(0,se.jsx)("div",{id:"sliderValueSix"})]}),(0,se.jsxs)("div",{id:"sliderContainer7",children:[(0,se.jsx)("p",{children:"Importance Time Weight"}),(0,se.jsx)("div",{id:"sliderValueSeven"})]}),(0,se.jsxs)("div",{id:"sliderContainer8",children:[(0,se.jsx)("p",{children:"Importance Width Weight"}),(0,se.jsx)("div",{id:"sliderValueEight"})]})]})}),(0,se.jsxs)("div",{id:"filterFamily",children:[(0,se.jsxs)("div",{id:"filterFirstRow",children:[(0,se.jsx)("div",{id:"multiselect1"}),(0,se.jsx)("div",{id:"multiselect2"}),(0,se.jsx)("div",{id:"multiselect3"})]}),(0,se.jsxs)("div",{id:"filterSecondRow",children:[(0,se.jsx)("div",{id:"multiselect4"}),(0,se.jsx)("div",{id:"multiselect5"}),(0,se.jsx)("div",{id:"multiselect6"})]})]})]})}),(0,se.jsx)("button",{id:"switchModeButton",children:"Tooltip mode"}),(0,se.jsxs)("div",{id:"chartAndMap",children:[(0,se.jsx)("div",{id:"container"}),(0,se.jsx)("div",{id:"mapResetButton"}),(0,se.jsx)("div",{id:"mapContainer"})]})]})},od=n(3366);function sd(e,t){if(null==e)return{};var n,r,i=(0,od.Z)(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var ud=["bounds","boundsOptions","center","children","className","id","placeholder","style","whenReady","zoom"];function ld(){return ld=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ld.apply(this,arguments)}function cd(e,n){var r=e.bounds,i=e.boundsOptions,a=e.center,s=e.children,u=e.className,l=e.id,c=e.placeholder,h=e.style,d=e.whenReady,f=e.zoom,p=sd(e,ud),v=o((0,t.useState)({className:u,id:l,style:h}),1)[0],m=o((0,t.useState)(null),2),g=m[0],_=m[1];(0,t.useImperativeHandle)(n,(function(){var e;return null!==(e=null===g||void 0===g?void 0:g.map)&&void 0!==e?e:null}),[g]);var y=(0,t.useCallback)((function(e){if(null!==e&&null===g){var t=new rd.Map(e,p);null!=a&&null!=f?t.setView(a,f):null!=r&&t.fitBounds(r,i),null!=d&&t.whenReady(d),_(function(e){return Object.freeze({__version:1,map:e})}(t))}}),[]);(0,t.useEffect)((function(){return function(){null===g||void 0===g||g.map.remove()}}),[g]);var b=g?t.createElement(ed,{value:g},s):null!==c&&void 0!==c?c:null;return t.createElement("div",ld({},v,{ref:y}),b)}var hd=(0,t.forwardRef)(cd);n(4164);function dd(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function fd(e,n){return null==n?function(n,r){var i=(0,t.useRef)();return i.current||(i.current=e(n,r)),i}:function(r,i){var a=(0,t.useRef)();a.current||(a.current=e(r,i));var o=(0,t.useRef)(r),s=a.current.instance;return(0,t.useEffect)((function(){o.current!==r&&(n(s,r,o.current),o.current=r)}),[s,r,i]),a}}function pd(e,t){var n,r=null!==(n=e.pane)&&void 0!==n?n:t.pane;return r?Jh(Jh({},e),{},{pane:r}):e}function vd(e){return function(n){var r=td(),i=e(pd(n,r),r);return function(e,n){var r=(0,t.useRef)(n);(0,t.useEffect)((function(){n!==r.current&&null!=e.attributionControl&&(null!=r.current&&e.attributionControl.removeAttribution(r.current),null!=n&&e.attributionControl.addAttribution(n)),r.current=n}),[e,n])}(r.map,n.attribution),function(e,n){var r=(0,t.useRef)();(0,t.useEffect)((function(){return null!=n&&e.instance.on(n),r.current=n,function(){null!=r.current&&e.instance.off(r.current),r.current=null}}),[e,n])}(i.current,n.eventHandlers),function(e,n){(0,t.useEffect)((function(){var t;return(null!==(t=n.layerContainer)&&void 0!==t?t:n.map).addLayer(e.instance),function(){var t;null===(t=n.layerContainer)||void 0===t||t.removeLayer(e.instance),n.map.removeLayer(e.instance)}}),[n,e])}(i.current,r),i}}var md=["children"],gd=function(e,n){return function(e){function n(n,r){var i=e(n).current,a=i.instance,o=i.context;return(0,t.useImperativeHandle)(r,(function(){return a})),null==n.children?null:t.createElement(ed,{value:o},n.children)}return(0,t.forwardRef)(n)}(vd(fd(e,n)))}((function(e,t){e.children;var n,r,i=sd(e,md),a=new rd.LayerGroup([],i);return dd(a,(n=t,r={layerContainer:a},Object.freeze(Jh(Jh({},n),r))))}));var _d=["url"],yd=function(e,n){return function(e){function n(n,r){var i=e(n).current.instance;return(0,t.useImperativeHandle)(r,(function(){return i})),null}return(0,t.forwardRef)(n)}(vd(fd(e,n)))}((function(e,t){var n=e.url,r=sd(e,_d);return dd(new rd.TileLayer(n,pd(r,t)),t)}),(function(e,t,n){var r=t.opacity,i=t.zIndex;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=i&&i!==n.zIndex&&e.setZIndex(i)}));var bd=function(){function e(){var e,t=nd();console.log("map center: ",t.getCenter()),(e="/LAStreet/hillside_inventory_LA_centrality_full.geojson",fetch(e).then((function(e){return e.json()}))).then((function(e){var n=cn(t.getPanes().overlayPane).append("svg").attr("id","svgleaflet"),r=n.append("g").attr("class","leaflet-zoom-hide"),i=Cs({point:function(e,n){var r=t.latLngToLayerPoint(new(id().LatLng)(n,e));this.stream.point(r.x,r.y)}}),a=Yo().projection(i);t.on("click",(function(e){var t=e.latlng;console.log(t.lng+" "+t.lat),cn(".mapillary-attribution-container").select("a").attr("xlink:href","https://www.mapillary.com/app/?pKey=259103735961077&focus=photo")}));var o=r.selectAll("path").data(e.features).enter().append("path").attr("class",(function(e){return"street"+e.properties.OBJECTID})).style("fill-opacity",.7).attr("fill","none").style("stroke","none");function s(){var t=a.bounds(e),i=t[0],s=t[1];n.attr("width",s[0]-i[0]).attr("height",s[1]-i[1]).style("left",i[0]+"px").style("top",i[1]+"px"),r.attr("transform","translate("+-i[0]+","+-i[1]+")"),o.attr("d",a)}t.on("zoom",s),s()}))}return(0,se.jsxs)(hd,{center:[34.03,-118.26],zoom:10,style:{height:"700px",width:"40%"},children:[(0,se.jsx)(e,{}),(0,se.jsx)(gd,{}),(0,se.jsx)(yd,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})]})};id().icon({iconSize:[25,41],iconAnchor:[10,41],popupAnchor:[2,-40],iconUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-shadow.png"});function xd(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wd(e){return wd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wd(e)}function kd(e,t){return kd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kd(e,t)}function Sd(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Md(e,t,n){return Md=Sd()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&kd(i,n.prototype),i},Md.apply(null,arguments)}function Cd(e){var t="function"===typeof Map?new Map:void 0;return Cd=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Md(e,arguments,wd(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),kd(r,e)},Cd(e)}var Td,Ed,Pd=n(5861);function Ad(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function Ld(e){return Ld="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ld(e)}function Id(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rd(e,t){if(t&&("object"===Ld(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Id(e)}function Od(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wd(e)););return e}function Nd(){return Nd="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Od(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Nd.apply(this,arguments)}function Dd(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kd(e,t)}function zd(e){var t=Sd();return function(){var n,r=wd(e);if(t){var i=wd(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Rd(this,n)}}function jd(){jd=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(CO){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),o=new k(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return M()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=b(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(CO){return{type:"throw",arg:CO}}}e.wrap=u;var c={};function h(){}function d(){}function f(){}var p={};s(p,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(S([])));m&&m!==t&&n.call(m,i)&&(p=m);var g=f.prototype=h.prototype=Object.create(p);function _(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function r(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Ld(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=f,s(g,"constructor",f),s(f,"constructor",d),d.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},_(y.prototype),s(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new y(u(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}function Bd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $d(e,t,n){return t&&Fd(e.prototype,t),n&&Fd(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var qd=function(e,t){return qd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},qd(e,t)};function Ud(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}qd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Vd(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(t){a(t)}}function s(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function Hd(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Wd(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gd(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function Zd(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}function Yd(e){return this instanceof Yd?(this.v=e,this):new Yd(e)}function Xd(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=i[e](t)).value instanceof Yd?Promise.resolve(n.value.v).then(u,l):c(a[0][2],n)}catch(r){c(a[0][3],r)}var n}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function Kd(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Wd(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function Jd(e){return"function"===typeof e}function Qd(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ef=Qd((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function tf(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var nf=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Wd(a),s=o.next();!s.done;s=o.next()){s.value.remove(this)}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(Jd(u))try{u()}catch(p){i=p instanceof ef?p.errors:[p]}var l=this._teardowns;if(l){this._teardowns=null;try{for(var c=Wd(l),h=c.next();!h.done;h=c.next()){var d=h.value;try{of(d)}catch(CO){i=null!==i&&void 0!==i?i:[],CO instanceof ef?i=Zd(Zd([],Gd(i)),Gd(CO.errors)):i.push(CO)}}}catch(v){n={error:v}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}if(i)throw new ef(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)of(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&tf(t,e)},e.prototype.remove=function(t){var n=this._teardowns;n&&tf(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),rf=nf.EMPTY;function af(e){return e instanceof nf||e&&"closed"in e&&Jd(e.remove)&&Jd(e.add)&&Jd(e.unsubscribe)}function of(e){Jd(e)?e():e.unsubscribe()}var sf={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},uf={setTimeout:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=uf.delegate;return((null===n||void 0===n?void 0:n.setTimeout)||setTimeout).apply(void 0,Zd([],Gd(e)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=uf.delegate;return((null===t||void 0===t?void 0:t.clearTimeout)||clearTimeout)(e)})),delegate:void 0};function lf(e){uf.setTimeout((function(){throw e}))}function cf(){}var hf=df("C",void 0,void 0);function df(e,t,n){return{kind:e,value:t,error:n}}var ff=null;function pf(e){if(sf.useDeprecatedSynchronousErrorHandling){var t=!ff;if(t&&(ff={errorThrown:!1,error:null}),e(),t){var n=ff,r=n.errorThrown,i=n.error;if(ff=null,r)throw i}}else e()}var vf=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,af(t)&&t.add(n)):n.destination=bf,n}return Ud(t,e),t.create=function(e,t,n){return new mf(e,t,n)},t.prototype.next=function(e){this.isStopped?yf(function(e){return df("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?yf(df("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?yf(hf,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(nf),mf=function(e){function t(t,n,r){var i,a=e.call(this)||this;if(Jd(t))i=t;else if(t){var o;i=t.next,n=t.error,r=t.complete,a&&sf.useDeprecatedNextContext?(o=Object.create(t)).unsubscribe=function(){return a.unsubscribe()}:o=t,i=null===i||void 0===i?void 0:i.bind(o),n=null===n||void 0===n?void 0:n.bind(o),r=null===r||void 0===r?void 0:r.bind(o)}return a.destination={next:i?gf(i):cf,error:gf(null!==n&&void 0!==n?n:_f),complete:r?gf(r):cf},a}return Ud(t,e),t}(vf);function gf(e,t){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{e.apply(void 0,Zd([],Gd(t)))}catch(CO){lf(CO)}}}function _f(e){throw e}function yf(e,t){var n=sf.onStoppedNotification;n&&uf.setTimeout((function(){return n(e,t)}))}var bf={closed:!0,next:cf,error:_f,complete:cf},xf="function"===typeof Symbol&&Symbol.observable||"@@observable";function wf(e){return e}function kf(e){return 0===e.length?wf:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Sf=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=function(e){return e&&e instanceof vf||function(e){return e&&Jd(e.next)&&Jd(e.error)&&Jd(e.complete)}(e)&&af(e)}(e)?e:new mf(e,t,n);return pf((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(CO){e.error(CO)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Mf(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(CO){r(CO),null===i||void 0===i||i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[xf]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return kf(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Mf(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Mf(e){var t;return null!==(t=null!==e&&void 0!==e?e:sf.Promise)&&void 0!==t?t:Promise}function Cf(e){return Jd(null===e||void 0===e?void 0:e.lift)}function Tf(e){return function(t){if(Cf(t))return t.lift((function(t){try{return e(t,this)}catch(CO){this.error(CO)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Ef=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;return o.onFinalize=a,o._next=n?function(e){try{n(e)}catch(CO){t.error(CO)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=r?function(){try{r()}catch(CO){t.error(CO)}finally{this.unsubscribe()}}:e.prototype._complete,o}return Ud(t,e),t.prototype.unsubscribe=function(){var t,n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))},t}(vf);function Pf(){return Tf((function(e,t){var n=null;e._refCount++;var r=new Ef(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,i=n;n=null,!r||i&&r!==i||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(n=e.connect())}))}var Af=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._subject=null,r._refCount=0,r._connection=null,Cf(t)&&(r.lift=t.lift),r}return Ud(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null===e||void 0===e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new nf;var n=this.getSubject();t.add(this.source.subscribe(new Ef(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=nf.EMPTY)}return t},t.prototype.refCount=function(){return Pf()(this)},t}(Sf),Lf=Qd((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),If=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ud(t,e),t.prototype.lift=function(e){var t=new Rf(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Lf},t.prototype.next=function(e){var t=this;pf((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){var i=t.observers.slice();try{for(var a=Wd(i),o=a.next();!o.done;o=a.next()){o.value.next(e)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;pf((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;pf((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=t.hasError,r=t.isStopped,i=t.observers;return n||r?rf:(i.push(e),new nf((function(){return tf(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Sf;return e.source=this,e},t.create=function(e,t){return new Rf(e,t)},t}(Sf),Rf=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Ud(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:rf},t}(If),Of=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Ud(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(If),Nf={now:function(){return(Nf.delegate||Date).now()},delegate:void 0},Df=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=Nf);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return Ud(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,s=n._windowTime;r||(i.push(t),!a&&i.push(o.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,a=(i?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!i){for(var o=n.now(),s=0,u=1;u<r.length&&r[u]<=o;u+=2)s=u;s&&r.splice(0,s+1)}},t}(If),zf=function(e){function t(t,n){return e.call(this)||this}return Ud(t,e),t.prototype.schedule=function(e,t){return this},t}(nf),jf={setInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=jf.delegate;return((null===n||void 0===n?void 0:n.setInterval)||setInterval).apply(void 0,Zd([],Gd(e)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=jf.delegate;return((null===t||void 0===t?void 0:t.clearInterval)||clearInterval)(e)})),delegate:void 0},Bf=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Ud(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),jf.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;jf.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(i){r=!0,n=!!i&&i||new Error(i)}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,tf(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(zf),Ff=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Nf.now,e}(),$f=function(e){function t(t,n){void 0===n&&(n=Ff.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return Ud(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Ff),qf=new $f(Bf),Uf=qf,Vf=new Sf((function(e){return e.complete()}));function Hf(e){return e?function(e){return new Sf((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Vf}function Wf(e,t){return new Sf((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}var Gf=function(e){return e&&"number"===typeof e.length&&"function"!==typeof e};function Zf(e){return Jd(null===e||void 0===e?void 0:e.then)}var Yf="function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Xf(e,t,n,r){void 0===r&&(r=0);var i=t.schedule((function(){try{n.call(this)}catch(CO){e.error(CO)}}),r);return e.add(i),i}function Kf(e,t){if(!e)throw new Error("Iterable cannot be null");return new Sf((function(n){var r=new nf;return r.add(t.schedule((function(){var i=e[Symbol.asyncIterator]();r.add(t.schedule((function(){var e=this;i.next().then((function(t){t.done?n.complete():(n.next(t.value),e.schedule())}))})))}))),r}))}function Jf(e){return Jd(e[xf])}function Qf(e){return Jd(null===e||void 0===e?void 0:e[Yf])}function ep(e){return Symbol.asyncIterator&&Jd(null===e||void 0===e?void 0:e[Symbol.asyncIterator])}function tp(e){return new TypeError("You provided "+(null!==e&&"object"===typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function np(e){return Xd(this,arguments,(function(){var t,n,r;return Hd(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,Yd(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,Yd(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,Yd(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function rp(e){return Jd(null===e||void 0===e?void 0:e.getReader)}function ip(e,t){if(null!=e){if(Jf(e))return function(e,t){return new Sf((function(n){var r=new nf;return r.add(t.schedule((function(){var i=e[xf]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(Gf(e))return Wf(e,t);if(Zf(e))return function(e,t){return new Sf((function(n){return t.schedule((function(){return e.then((function(e){n.add(t.schedule((function(){n.next(e),n.add(t.schedule((function(){return n.complete()})))})))}),(function(e){n.add(t.schedule((function(){return n.error(e)})))}))}))}))}(e,t);if(ep(e))return Kf(e,t);if(Qf(e))return function(e,t){return new Sf((function(n){var r;return n.add(t.schedule((function(){r=e[Yf](),Xf(n,t,(function(){var e=r.next(),t=e.value;e.done?n.complete():(n.next(t),this.schedule())}))}))),function(){return Jd(null===r||void 0===r?void 0:r.return)&&r.return()}}))}(e,t);if(rp(e))return function(e,t){return Kf(np(e),t)}(e,t)}throw tp(e)}function ap(e,t){return t?ip(e,t):op(e)}function op(e){if(e instanceof Sf)return e;if(null!=e){if(Jf(e))return r=e,new Sf((function(e){var t=r[xf]();if(Jd(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Gf(e))return sp(e);if(Zf(e))return n=e,new Sf((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,lf)}));if(ep(e))return up(e);if(Qf(e))return t=e,new Sf((function(e){var n,r;try{for(var i=Wd(t),a=i.next();!a.done;a=i.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(s){n={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}));if(rp(e))return up(np(e))}var t,n,r;throw tp(e)}function sp(e){return new Sf((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function up(e){return new Sf((function(t){(function(e,t){var n,r,i,a;return Vd(this,void 0,void 0,(function(){var o,s;return Hd(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=Kd(e),u.label=1;case 1:return[4,n.next()];case 2:if((r=u.sent()).done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),i={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function lp(e,t){return t?Wf(e,t):sp(e)}function cp(e){return e&&Jd(e.schedule)}function hp(e){return e[e.length-1]}function dp(e){return Jd(hp(e))?e.pop():void 0}function fp(e){return cp(hp(e))?e.pop():void 0}function pp(e,t){return"number"===typeof hp(e)?e.pop():t}function vp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=fp(e);return n?Wf(e,n):lp(e)}function mp(e,t){var n=Jd(e)?e:function(){return e},r=function(e){return e.error(n())};return new Sf(t?function(e){return t.schedule(r,0,e)}:r)}var gp=Qd((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function _p(e){return e instanceof Date&&!isNaN(e)}var yp=Qd((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function bp(e,t){var n=_p(e)?{first:e}:"number"===typeof e?{each:e}:e,r=n.first,i=n.each,a=n.with,o=void 0===a?xp:a,s=n.scheduler,u=void 0===s?null!==t&&void 0!==t?t:qf:s,l=n.meta,c=void 0===l?null:l;if(null==r&&null==i)throw new TypeError("No timeout provided.");return Tf((function(e,t){var n,a,s=null,l=0,h=function(e){a=Xf(t,u,(function(){n.unsubscribe(),op(o({meta:c,lastValue:s,seen:l})).subscribe(t)}),e)};n=e.subscribe(new Ef(t,(function(e){null===a||void 0===a||a.unsubscribe(),l++,t.next(s=e),i>0&&h(i)}),void 0,void 0,(function(){(null===a||void 0===a?void 0:a.closed)||null===a||void 0===a||a.unsubscribe(),s=null}))),h(null!=r?"number"===typeof r?r:+r-u.now():i)}))}function xp(e){throw new yp(e)}function wp(e,t){return Tf((function(n,r){var i=0;n.subscribe(new Ef(r,(function(n){r.next(e.call(t,n,i++))})))}))}var kp=Array.isArray;function Sp(e){return wp((function(t){return function(e,t){return kp(t)?e.apply(void 0,Zd([],Gd(t))):e(t)}(e,t)}))}var Mp=Array.isArray,Cp=Object.getPrototypeOf,Tp=Object.prototype,Ep=Object.keys;function Pp(e){if(1===e.length){var t=e[0];if(Mp(t))return{args:t,keys:null};if((r=t)&&"object"===typeof r&&Cp(r)===Tp){var n=Ep(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}function Ap(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}function Lp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=fp(e),r=dp(e),i=Pp(e),a=i.args,o=i.keys;if(0===a.length)return ap([],n);var s=new Sf(Ip(a,n,o?function(e){return Ap(o,e)}:wf));return r?s.pipe(Sp(r)):s}function Ip(e,t,n){return void 0===n&&(n=wf),function(r){Rp(t,(function(){for(var i=e.length,a=new Array(i),o=i,s=i,u=function(i){Rp(t,(function(){var u=ap(e[i],t),l=!1;u.subscribe(new Ef(r,(function(e){a[i]=e,l||(l=!0,s--),s||r.next(n(a.slice()))}),(function(){--o||r.complete()})))}),r)},l=0;l<i;l++)u(l)}),r)}}function Rp(e,t,n){e?n.add(e.schedule(t)):t()}function Op(e,t,n,r,i,a,o,s){var u=[],l=0,c=0,h=!1,d=function(){!h||u.length||l||t.complete()},f=function(e){return l<r?p(e):u.push(e)},p=function e(s){a&&t.next(s),l++;var h=!1;op(n(s,c++)).subscribe(new Ef(t,(function(e){null===i||void 0===i||i(e),a?f(e):t.next(e)}),(function(){h=!0}),void 0,(function(){if(h)try{l--;for(var n=function(){var n=u.shift();o?t.add(o.schedule((function(){return e(n)}))):e(n)};u.length&&l<r;)n();d()}catch(CO){t.error(CO)}})))};return e.subscribe(new Ef(t,f,(function(){h=!0,d()}))),function(){null===s||void 0===s||s()}}function Np(e,t,n){return void 0===n&&(n=1/0),Jd(t)?Np((function(n,r){return wp((function(e,i){return t(n,e,r,i)}))(op(e(n,r)))}),n):("number"===typeof t&&(n=t),Tf((function(t,r){return Op(t,r,e,n)})))}function Dp(e){return void 0===e&&(e=1/0),Np(wf,e)}function zp(){return Dp(1)}function jp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zp()(lp(e,fp(e)))}var Bp=["addListener","removeListener"],Fp=["addEventListener","removeEventListener"],$p=["on","off"];function qp(e,t,n,r){if(Jd(n)&&(r=n,n=void 0),r)return qp(e,t,n).pipe(Sp(r));var i=Gd(function(e){return Jd(e.addEventListener)&&Jd(e.removeEventListener)}(e)?Fp.map((function(r){return function(i){return e[r](t,i,n)}})):function(e){return Jd(e.addListener)&&Jd(e.removeListener)}(e)?Bp.map(Up(e,t)):function(e){return Jd(e.on)&&Jd(e.off)}(e)?$p.map(Up(e,t)):[],2),a=i[0],o=i[1];if(!a&&Gf(e))return Np((function(e){return qp(e,t,n)}))(lp(e));if(!a)throw new TypeError("Invalid event target");return new Sf((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return a(t),function(){return o(t)}}))}function Up(e,t){return function(n){return function(r){return e[n](t,r)}}}function Vp(e,t,n){void 0===e&&(e=0),void 0===n&&(n=Uf);var r=-1;return null!=t&&(cp(t)?n=t:r=t),new Sf((function(t){var i=_p(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule((function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function Hp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=fp(e),r=pp(e,1/0),i=e;return i.length?1===i.length?op(i[0]):Dp(r)(lp(i,n)):Vf}var Wp=Array.isArray;function Gp(e){return 1===e.length&&Wp(e[0])?e[0]:e}function Zp(e,t){return Tf((function(n,r){var i=0;n.subscribe(new Ef(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function Yp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dp(e),r=Gp(e);return r.length?new Sf((function(e){var t=r.map((function(){return[]})),i=r.map((function(){return!1}));e.add((function(){t=i=null}));for(var a=function(a){op(r[a]).subscribe(new Ef(e,(function(r){if(t[a].push(r),t.every((function(e){return e.length}))){var o=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,Zd([],Gd(o))):o),t.some((function(e,t){return!e.length&&i[t]}))&&e.complete()}}),(function(){i[a]=!0,!t[a].length&&e.complete()})))},o=0;!e.closed&&o<r.length;o++)a(o);return function(){t=i=null}})):Vf}function Xp(e,t){return void 0===t&&(t=Uf),n=function(){return Vp(e,t)},Tf((function(e,t){var r=!1,i=null,a=null,o=!1,s=function(){if(null===a||void 0===a||a.unsubscribe(),a=null,r){r=!1;var e=i;i=null,t.next(e)}o&&t.complete()},u=function(){a=null,o&&t.complete()};e.subscribe(new Ef(t,(function(e){r=!0,i=e,a||op(n(e)).subscribe(a=new Ef(t,s,u))}),(function(){o=!0,(!r||!a||a.closed)&&t.complete()})))}));var n}function Kp(e,t){return void 0===t&&(t=null),t=null!==t&&void 0!==t?t:e,Tf((function(n,r){var i=[],a=0;n.subscribe(new Ef(r,(function(n){var o,s,u,l,c=null;a++%t===0&&i.push([]);try{for(var h=Wd(i),d=h.next();!d.done;d=h.next()){(v=d.value).push(n),e<=v.length&&(c=null!==c&&void 0!==c?c:[]).push(v)}}catch(m){o={error:m}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}if(c)try{for(var f=Wd(c),p=f.next();!p.done;p=f.next()){var v=p.value;tf(i,v),r.next(v)}}catch(g){u={error:g}}finally{try{p&&!p.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}}),(function(){var e,t;try{for(var n=Wd(i),a=n.next();!a.done;a=n.next()){var o=a.value;r.next(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.complete()}),void 0,(function(){i=null})))}))}function Jp(e){return Tf((function(t,n){var r,i=null,a=!1;i=t.subscribe(new Ef(n,void 0,void 0,(function(o){r=op(e(o,Jp(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):a=!0}))),a&&(i.unsubscribe(),i=null,r.subscribe(n))}))}function Qp(e,t,n,r,i){return function(a,o){var s=n,u=t,l=0;a.subscribe(new Ef(o,(function(t){var n=l++;u=s?e(u,t,n):(s=!0,t),r&&o.next(u)}),i&&function(){s&&o.next(u),o.complete()}))}}function ev(e,t){return Tf(Qp(e,t,arguments.length>=2,!1,!0))}function tv(e,t){return Jd(t)?Np(e,t,1):Np(e,1)}var nv={connector:function(){return new If}};function rv(e,t){void 0===t&&(t=nv);var n=t.connector;return Tf((function(t,r){var i,a=n();ap(e((i=a,new Sf((function(e){return i.subscribe(e)}))))).subscribe(r),r.add(t.subscribe(a))}))}function iv(e,t){return void 0===t&&(t=qf),Tf((function(n,r){var i=null,a=null,o=null,s=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,r.next(e)}};function u(){var n=o+e,a=t.now();if(a<n)return i=this.schedule(void 0,n-a),void r.add(i);s()}n.subscribe(new Ef(r,(function(n){a=n,o=t.now(),i||(i=t.schedule(u,e),r.add(i))}),(function(){s(),r.complete()}),void 0,(function(){a=i=null})))}))}function av(e){return Tf((function(t,n){var r=!1;t.subscribe(new Ef(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))}function ov(e){return e<=0?function(){return Vf}:Tf((function(t,n){var r=0;t.subscribe(new Ef(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function sv(e,t){return void 0===t&&(t=wf),e=null!==e&&void 0!==e?e:uv,Tf((function(n,r){var i,a=!0;n.subscribe(new Ef(r,(function(n){var o=t(n);!a&&e(i,o)||(a=!1,i=o,r.next(n))})))}))}function uv(e,t){return e===t}function lv(e){return void 0===e&&(e=cv),Tf((function(t,n){var r=!1;t.subscribe(new Ef(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))}function cv(){return new gp}function hv(e,t,n){return void 0===t&&(t=1/0),t=(t||0)<1?1/0:t,Tf((function(r,i){return Op(r,i,e,t,void 0,!0,n)}))}function dv(e){return Tf((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))}function fv(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Zp((function(t,n){return e(t,n,r)})):wf,ov(1),n?av(t):lv((function(){return new gp})))}}function pv(e){return e<=0?function(){return Vf}:Tf((function(t,n){var r=[];t.subscribe(new Ef(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var i=Wd(r),a=i.next();!a.done;a=i.next()){var o=a.value;n.next(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))}function vv(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Zp((function(t,n){return e(t,n,r)})):wf,pv(1),n?av(t):lv((function(){return new gp})))}}function mv(e,t){var n=Jd(e)?e:function(){return e};return Jd(t)?rv(t,{connector:n}):function(e){return new Af(e,n)}}function gv(){return Tf((function(e,t){var n,r=!1;e.subscribe(new Ef(t,(function(e){var i=n;n=e,r&&t.next([i,e]),r=!0})))}))}function _v(e){return e?function(t){return rv(e)(t)}:function(e){return mv(new If)(e)}}function yv(e,t,n,r){n&&!Jd(n)&&(r=n);var i=Jd(n)?n:void 0;return function(n){return mv(new Df(e,t,r),i)(n)}}function bv(e){var t;void 0===e&&(e=1/0);var n=(t=e&&"object"===typeof e?e:{count:e}).count,r=void 0===n?1/0:n,i=t.delay,a=t.resetOnSuccess,o=void 0!==a&&a;return r<=0?wf:Tf((function(e,t){var n,a=0;!function s(){var u=!1;n=e.subscribe(new Ef(t,(function(e){o&&(a=0),t.next(e)}),void 0,(function(e){if(a++<r){var o=function(){n?(n.unsubscribe(),n=null,s()):u=!0};if(null!=i){var l="number"===typeof i?Vp(i):op(i(e,a)),c=new Ef(t,(function(){c.unsubscribe(),o()}),(function(){t.complete()}));l.subscribe(c)}else o()}else t.error(e)}))),u&&(n.unsubscribe(),n=null,s())}()}))}function xv(e,t){return Tf(Qp(e,t,arguments.length>=2,!0))}function wv(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new If}:t,r=e.resetOnError,i=void 0===r||r,a=e.resetOnComplete,o=void 0===a||a,s=e.resetOnRefCountZero,u=void 0===s||s;return function(e){var t=null,r=null,a=null,s=0,l=!1,c=!1,h=function(){null===r||void 0===r||r.unsubscribe(),r=null},d=function(){h(),t=a=null,l=c=!1},f=function(){var e=t;d(),null===e||void 0===e||e.unsubscribe()};return Tf((function(e,p){s++,c||l||h();var v=a=null!==a&&void 0!==a?a:n();p.add((function(){0!==--s||c||l||(r=kv(f,u))})),v.subscribe(p),t||(t=new mf({next:function(e){return v.next(e)},error:function(e){c=!0,h(),r=kv(d,i,e),v.error(e)},complete:function(){l=!0,h(),r=kv(d,o),v.complete()}}),ap(e).subscribe(t))}))(e)}}function kv(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return!0===t?(e(),null):!1===t?null:t.apply(void 0,Zd([],Gd(n))).pipe(ov(1)).subscribe((function(){return e()}))}function Sv(e){return Zp((function(t,n){return e<=n}))}function Mv(e){return Tf((function(t,n){var r=!1,i=0;t.subscribe(new Ef(n,(function(t){return(r||(r=!e(t,i++)))&&n.next(t)})))}))}function Cv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=fp(e);return Tf((function(t,r){(n?jp(e,t,n):jp(e,t)).subscribe(r)}))}function Tv(e,t){return Tf((function(n,r){var i=null,a=0,o=!1,s=function(){return o&&!i&&r.complete()};n.subscribe(new Ef(r,(function(n){null===i||void 0===i||i.unsubscribe();var o=0,u=a++;op(e(n,u)).subscribe(i=new Ef(r,(function(e){return r.next(t?t(n,e,u,o++):e)}),(function(){i=null,s()})))}),(function(){o=!0,s()})))}))}function Ev(e){return Tf((function(t,n){op(e).subscribe(new Ef(n,(function(){return n.complete()}),cf)),!n.closed&&t.subscribe(n)}))}function Pv(e,t){return void 0===t&&(t=!1),Tf((function(n,r){var i=0;n.subscribe(new Ef(r,(function(n){var a=e(n,i++);(a||t)&&r.next(n),!a&&r.complete()})))}))}function Av(e,t,n){var r=Jd(e)||t||n?{next:e,error:t,complete:n}:e;return r?Tf((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(new Ef(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):wf}function Lv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dp(e);return Tf((function(t,r){for(var i=e.length,a=new Array(i),o=e.map((function(){return!1})),s=!1,u=function(t){op(e[t]).subscribe(new Ef(r,(function(e){a[t]=e,s||o[t]||(o[t]=!0,(s=o.every(wf))&&(o=null))}),cf))},l=0;l<i;l++)u(l);t.subscribe(new Ef(r,(function(e){if(s){var t=Zd([e],Gd(a));r.next(n?n.apply(void 0,Zd([],Gd(t))):t)}})))}))}for(var Iv=function(){function e(){Bd(this,e)}return $d(e,[{key:"createFilter",value:function(e){return new Function("node","return "+this._compile(e)+";")}},{key:"_compile",value:function(e){if(null==e||e.length<=1)return"true";var t=e[0];return"("+("=="===t?this._compileComparisonOp("===",e[1],e[2],!1):"!="===t?this._compileComparisonOp("!==",e[1],e[2],!1):">"===t||">="===t||"<"===t||"<="===t?this._compileComparisonOp(t,e[1],e[2],!0):"in"===t?this._compileInOp(e[1],e.slice(2)):"!in"===t?this._compileNegation(this._compileInOp(e[1],e.slice(2))):"all"===t?this._compileLogicalOp(e.slice(1),"&&"):"true")+")"}},{key:"_compare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"_compileComparisonOp",value:function(e,t,n,r){var i=this._compilePropertyReference(t),a=JSON.stringify(n);return(r?"typeof "+i+"===typeof "+a+"&&":"")+i+e+a}},{key:"_compileInOp",value:function(e,t){var n=this._compare;return JSON.stringify(t.sort(n))+".indexOf("+this._compilePropertyReference(e)+")!==-1"}},{key:"_compileLogicalOp",value:function(e,t){var n=this._compile.bind(this);return e.map(n).join(t)}},{key:"_compileNegation",value:function(e){return"!("+e+")"}},{key:"_compilePropertyReference",value:function(e){return"node["+JSON.stringify(e)+"]"}}]),e}(),Rv=100,Ov=301,Nv=302,Dv=306,zv=1e3,jv=1001,Bv=1002,Fv=1003,$v=1006,qv=1008,Uv=1009,Vv=1012,Hv=1014,Wv=1015,Gv=1016,Zv=1020,Yv=1022,Xv=1023,Kv=1026,Jv=1027,Qv=2300,em=2301,tm=2302,nm=2400,rm=2401,im=2402,am=2500,om=2501,sm=3e3,um=3001,lm=3007,cm=3002,hm=7680,dm=35044,fm=35048,pm="300 es",vm=function(){function e(){Bd(this,e)}return $d(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e);e.target=null}}}}]),e}(),mm=1234567,gm=Math.PI/180,_m=180/Math.PI,ym=[],bm=0;bm<256;bm++)ym[bm]=(bm<16?"0":"")+bm.toString(16);var xm="undefined"!==typeof crypto&&"randomUUID"in crypto;function wm(){if(xm)return crypto.randomUUID().toUpperCase();var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ym[255&e]+ym[e>>8&255]+ym[e>>16&255]+ym[e>>24&255]+"-"+ym[255&t]+ym[t>>8&255]+"-"+ym[t>>16&15|64]+ym[t>>24&255]+"-"+ym[63&n|128]+ym[n>>8&255]+"-"+ym[n>>16&255]+ym[n>>24&255]+ym[255&r]+ym[r>>8&255]+ym[r>>16&255]+ym[r>>24&255]).toUpperCase()}function km(e,t,n){return Math.max(t,Math.min(n,e))}function Sm(e,t){return(e%t+t)%t}function Mm(e,t,n){return(1-n)*e+n*t}function Cm(e){return 0===(e&e-1)&&0!==e}function Tm(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Em=Object.freeze({__proto__:null,DEG2RAD:gm,RAD2DEG:_m,generateUUID:wm,clamp:km,euclideanModulo:Sm,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Mm,damp:function(e,t,n,r){return Mm(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Sm(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(mm=e%2147483647),((mm=16807*mm%2147483647)-1)/2147483646},degToRad:function(e){return e*gm},radToDeg:function(e){return e*_m},isPowerOfTwo:Cm,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:Tm,setQuaternionFromProperEuler:function(e,t,n,r,i){var a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),l=a((t+r)/2),c=o((t+r)/2),h=a((t-r)/2),d=o((t-r)/2),f=a((r-t)/2),p=o((r-t)/2);switch(i){case"XYX":e.set(s*c,u*h,u*d,s*l);break;case"YZY":e.set(u*d,s*c,u*h,s*l);break;case"ZXZ":e.set(u*h,u*d,s*c,s*l);break;case"XZX":e.set(s*c,u*p,u*f,s*l);break;case"YXY":e.set(u*f,s*c,u*p,s*l);break;case"ZYZ":e.set(u*p,u*f,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}}),Pm=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Bd(this,t),this.x=e,this.y=n}return $d(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:jd().mark((function e(){return jd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}();Pm.prototype.isVector2=!0;var Am,Lm=function(){function e(){Bd(this,e),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return $d(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u){var l=this.elements;return l[0]=e,l[1]=r,l[2]=o,l[3]=t,l[4]=i,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=r[0],v=r[3],m=r[6],g=r[1],_=r[4],y=r[7],b=r[2],x=r[5],w=r[8];return i[0]=a*p+o*g+s*b,i[3]=a*v+o*_+s*x,i[6]=a*m+o*y+s*w,i[1]=u*p+l*g+c*b,i[4]=u*v+l*_+c*x,i[7]=u*m+l*y+c*w,i[2]=h*p+d*g+f*b,i[5]=h*v+d*_+f*x,i[8]=h*m+d*y+f*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*i*l+n*o*s+r*i*u-r*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*a-o*u,h=o*s-l*i,d=u*i-a*s,f=t*c+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=c*p,e[1]=(r*u-l*n)*p,e[2]=(o*n-r*a)*p,e[3]=h*p,e[4]=(l*t-r*s)*p,e[5]=(r*i-o*t)*p,e[6]=d*p,e[7]=(n*s-u*t)*p,e[8]=(a*t-n*i)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,o){var s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-r*u,r*s,-r*(-u*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],u=r[4],l=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*u,r[6]=t*o+n*l,r[1]=-n*i+t*s,r[4]=-n*a+t*u,r[7]=-n*o+t*l,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function Im(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}function Rm(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Om(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=3735928559^n,i=1103547991^n,a=0;a<e.length;a++)t=e.charCodeAt(a),r=Math.imul(r^t,2654435761),i=Math.imul(i^t,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&(i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909)))+(r>>>0)}Lm.prototype.isMatrix3=!0;var Nm=function(){function e(){Bd(this,e)}return $d(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Am&&(Am=Rm("canvas")),Am.width=e.width,Am.height=e.height;var n=Am.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Am}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}]),e}(),Dm=0,zm=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jv,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:jv,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$v,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:qv,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Xv,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Uv,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:sm;return Bd(this,n),e=t.call(this),Object.defineProperty(Id(e),"id",{value:Dm++}),e.uuid=wm(),e.name="",e.image=r,e.mipmaps=[],e.mapping=i,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=h,e.format=l,e.internalFormat=null,e.type=c,e.offset=new Pm(0,0),e.repeat=new Pm(1,1),e.center=new Pm(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new Lm,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=d,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e}return $d(n,[{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=wm()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var a=0,o=r.length;a<o;a++)r[a].isDataTexture?i.push(jm(r[a].image)):i.push(jm(r[a]))}else i=jm(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zv:e.x=e.x-Math.floor(e.x);break;case jv:e.x=e.x<0?0:1;break;case Bv:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case zv:e.y=e.y-Math.floor(e.y);break;case jv:e.y=e.y<0?0:1;break;case Bv:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(vm);function jm(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Nm.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}zm.DEFAULT_IMAGE=void 0,zm.DEFAULT_MAPPING=300,zm.prototype.isTexture=!0;var Bm=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Bd(this,t),this.x=e,this.y=n,this.z=r,this.w=i}return $d(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],d=s[5],f=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(l-h)<a&&Math.abs(c-p)<a&&Math.abs(f-v)<a){if(Math.abs(l+h)<o&&Math.abs(c+p)<o&&Math.abs(f+v)<o&&Math.abs(u+d+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,_=(d+1)/2,y=(m+1)/2,b=(l+h)/4,x=(c+p)/4,w=(f+v)/4;return g>_&&g>y?g<a?(n=0,r=.707106781,i=.707106781):(r=b/(n=Math.sqrt(g)),i=x/n):_>y?_<a?(n=.707106781,r=0,i=.707106781):(n=b/(r=Math.sqrt(_)),i=w/r):y<a?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(y)),r=w/i),this.set(n,r,i,t),this}var k=Math.sqrt((v-f)*(v-f)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(k)<.001&&(k=1),this.x=(v-f)/k,this.y=(c-p)/k,this.z=(h-l)/k,this.w=Math.acos((u+d+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:jd().mark((function e(){return jd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}();Bm.prototype.isVector4=!0;var Fm=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Bd(this,n),(i=t.call(this)).width=e,i.height=r,i.depth=1,i.scissor=new Bm(0,0,e,r),i.scissorTest=!1,i.viewport=new Bm(0,0,e,r),i.texture=new zm(void 0,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),i.texture.isRenderTargetTexture=!0,i.texture.image={width:e,height:r,depth:1},i.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,i.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,i.texture.minFilter=void 0!==a.minFilter?a.minFilter:$v,i.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,i.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,i.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,i}return $d(n,[{key:"setTexture",value:function(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}},{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Jh({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(vm);Fm.prototype.isWebGLRenderTarget=!0;var $m=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;Bd(this,n);var o=(a=t.call(this,e,r)).texture;a.texture=[];for(var s=0;s<i;s++)a.texture[s]=o.clone();return a}return $d(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}]),n}(Fm);$m.prototype.isWebGLMultipleRenderTargets=!0;var qm=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i)).samples=4,a}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.samples=e.samples,this}}]),n}(Fm);qm.prototype.isWebGLMultisampleRenderTarget=!0;var Um=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Bd(this,e),this._x=t,this._y=n,this._z=r,this._w=i}return $d(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(r/2),c=o(i/2),h=s(n/2),d=s(r/2),f=s(i/2);switch(a){case"XYZ":this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f;break;case"YXZ":this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f;break;case"ZXY":this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f;break;case"ZYX":this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f;break;case"YZX":this._x=h*l*c+u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c-h*d*f;break;case"XZY":this._x=h*l*c-u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(l-s)*d,this._y=(i-u)*d,this._z=(a-r)*d}else if(n>o&&n>c){var f=2*Math.sqrt(1+n-o-c);this._w=(l-s)/f,this._x=.25*f,this._y=(r+a)/f,this._z=(i+u)/f}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(i-u)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(s+l)/p}else{var v=2*Math.sqrt(1+c-n-o);this._w=(a-r)/v,this._x=(i+u)/v,this._y=(s+l)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(km(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+r*u-i*s,this._y=r*l+a*s+i*o-n*u,this._z=i*l+a*u+n*s-r*o,this._w=a*l-n*o-r*s-i*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}},{key:"slerpFlat",value:function(e,t,n,r,i,a,o){var s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3],h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(c!==p||s!==h||u!==d||l!==f){var v=1-o,m=s*h+u*d+l*f+c*p,g=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){var y=Math.sqrt(_),b=Math.atan2(y,m*g);v=Math.sin(v*b)/y,o=Math.sin(o*b)/y}var x=o*g;if(s=s*v+h*x,u=u*v+d*x,l=l*v+f*x,c=c*v+p*x,v===1-o){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,a){var o=n[r],s=n[r+1],u=n[r+2],l=n[r+3],c=i[a],h=i[a+1],d=i[a+2],f=i[a+3];return e[t]=o*f+l*c+s*d-u*h,e[t+1]=s*f+l*h+u*c-o*d,e[t+2]=u*f+l*d+o*h-s*c,e[t+3]=l*f-o*c-s*h-u*d,e}}]),e}();Um.prototype.isQuaternion=!0;var Vm=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Bd(this,t),this.x=e,this.y=n,this.z=r}return $d(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Wm.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Wm.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,l=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Hm.copy(this).projectOnVector(e),this.sub(Hm)}},{key:"reflect",value:function(e){return this.sub(Hm.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(km(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:jd().mark((function e(){return jd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}();Vm.prototype.isVector3=!0;var Hm=new Vm,Wm=new Um,Gm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm(-1/0,-1/0,-1/0);Bd(this,e),this.min=t,this.max=n}return $d(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<n&&(n=c),h<r&&(r=h),l>i&&(i=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<n&&(n=c),h<r&&(r=h),l>i&&(i=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Ym.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Xm.copy(t.boundingBox),Xm.applyMatrix4(e.matrixWorld),this.union(Xm));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Ym),Ym.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(rg),ig.subVectors(this.max,rg),Km.subVectors(e.a,rg),Jm.subVectors(e.b,rg),Qm.subVectors(e.c,rg),eg.subVectors(Jm,Km),tg.subVectors(Qm,Jm),ng.subVectors(Km,Qm);var t=[0,-eg.z,eg.y,0,-tg.z,tg.y,0,-ng.z,ng.y,eg.z,0,-eg.x,tg.z,0,-tg.x,ng.z,0,-ng.x,-eg.y,eg.x,0,-tg.y,tg.x,0,-ng.y,ng.x,0];return!!sg(t,Km,Jm,Qm,ig)&&(!!sg(t=[1,0,0,0,1,0,0,0,1],Km,Jm,Qm,ig)&&(ag.crossVectors(eg,tg),sg(t=[ag.x,ag.y,ag.z],Km,Jm,Qm,ig)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Ym.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Ym).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(Zm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Zm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Zm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Zm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Zm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Zm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Zm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Zm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Zm)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();Gm.prototype.isBox3=!0;var Zm=[new Vm,new Vm,new Vm,new Vm,new Vm,new Vm,new Vm,new Vm],Ym=new Vm,Xm=new Gm,Km=new Vm,Jm=new Vm,Qm=new Vm,eg=new Vm,tg=new Vm,ng=new Vm,rg=new Vm,ig=new Vm,ag=new Vm,og=new Vm;function sg(e,t,n,r,i){for(var a=0,o=e.length-3;a<=o;a+=3){og.fromArray(e,a);var s=i.x*Math.abs(og.x)+i.y*Math.abs(og.y)+i.z*Math.abs(og.z),u=t.dot(og),l=n.dot(og),c=r.dot(og);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var ug=new Gm,lg=new Vm,cg=new Vm,hg=new Vm,dg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Bd(this,e),this.center=t,this.radius=n}return $d(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):ug.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){hg.subVectors(e,this.center);var t=hg.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.add(hg.multiplyScalar(r/n)),this.radius+=r}return this}},{key:"union",value:function(e){return cg.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(lg.copy(e.center).add(cg)),this.expandByPoint(lg.copy(e.center).sub(cg)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),fg=new Vm,pg=new Vm,vg=new Vm,mg=new Vm,gg=new Vm,_g=new Vm,yg=new Vm,bg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm(0,0,-1);Bd(this,e),this.origin=t,this.direction=n}return $d(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,fg)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=fg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(fg.copy(this.direction).multiplyScalar(t).add(this.origin),fg.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){pg.copy(e).add(t).multiplyScalar(.5),vg.copy(t).sub(e).normalize(),mg.copy(this.origin).sub(pg);var i,a,o,s,u=.5*e.distanceTo(t),l=-this.direction.dot(vg),c=mg.dot(this.direction),h=-mg.dot(vg),d=mg.lengthSq(),f=Math.abs(1-l*l);if(f>0)if(a=l*c-h,s=u*f,(i=l*h-c)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(i*=p)*(i+l*(a*=p)+2*c)+a*(l*i+a+2*h)+d}else a=u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+d;else a=-u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+d;else a<=-s?o=-(i=Math.max(0,-(-l*u+c)))*i+(a=i>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+d:a<=s?(i=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+d):o=-(i=Math.max(0,-(l*u+c)))*i+(a=i>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+d;else a=l>0?-u:u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(vg).multiplyScalar(a).add(pg),o}},{key:"intersectSphere",value:function(e,t){fg.subVectors(e.center,this.origin);var n=fg.dot(this.direction),r=fg.dot(fg)-n*n,i=e.radius*e.radius;if(r>i)return null;var a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,i,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),l>=0?(i=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||i>r?null:((i>n||n!==n)&&(n=i),(a<r||r!==r)&&(r=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,fg)}},{key:"intersectTriangle",value:function(e,t,n,r,i){gg.subVectors(t,e),_g.subVectors(n,e),yg.crossVectors(gg,_g);var a,o=this.direction.dot(yg);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}mg.subVectors(this.origin,e);var s=a*this.direction.dot(_g.crossVectors(mg,_g));if(s<0)return null;var u=a*this.direction.dot(gg.cross(mg));if(u<0)return null;if(s+u>o)return null;var l=-a*mg.dot(yg);return l<0?null:this.at(l/o,i)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),xg=function(){function e(){Bd(this,e),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return $d(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u,l,c,h,d,f,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/wg.setFromMatrixColumn(e,0).length(),i=1/wg.setFromMatrixColumn(e,1).length(),a=1/wg.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=a*l,d=a*c,f=o*l,p=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=d+f*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=f+d*u,t[10]=a*s}else if("YXZ"===e.order){var v=s*l,m=s*c,g=u*l,_=u*c;t[0]=v+_*o,t[4]=g*o-m,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=m*o-g,t[6]=_+v*o,t[10]=a*s}else if("ZXY"===e.order){var y=s*l,b=s*c,x=u*l,w=u*c;t[0]=y-w*o,t[4]=-a*c,t[8]=x+b*o,t[1]=b+x*o,t[5]=a*l,t[9]=w-y*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var k=a*l,S=a*c,M=o*l,C=o*c;t[0]=s*l,t[4]=M*u-S,t[8]=k*u+C,t[1]=s*c,t[5]=C*u+k,t[9]=S*u-M,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var T=a*s,E=a*u,P=o*s,A=o*u;t[0]=s*l,t[4]=A-T*c,t[8]=P*c+E,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=E*c+P,t[10]=T-A*c}else if("XZY"===e.order){var L=a*s,I=a*u,R=o*s,O=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=L*c+O,t[5]=a*l,t[9]=I*c-R,t[2]=R*c-I,t[6]=o*l,t[10]=O*c+L}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Sg,e,Mg)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return Eg.subVectors(e,t),0===Eg.lengthSq()&&(Eg.z=1),Eg.normalize(),Cg.crossVectors(n,Eg),0===Cg.lengthSq()&&(1===Math.abs(n.z)?Eg.x+=1e-4:Eg.z+=1e-4,Eg.normalize(),Cg.crossVectors(n,Eg)),Cg.normalize(),Tg.crossVectors(Eg,Cg),r[0]=Cg.x,r[4]=Tg.x,r[8]=Eg.x,r[1]=Cg.y,r[5]=Tg.y,r[9]=Eg.y,r[2]=Cg.z,r[6]=Tg.z,r[10]=Eg.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],v=n[10],m=n[14],g=n[3],_=n[7],y=n[11],b=n[15],x=r[0],w=r[4],k=r[8],S=r[12],M=r[1],C=r[5],T=r[9],E=r[13],P=r[2],A=r[6],L=r[10],I=r[14],R=r[3],O=r[7],N=r[11],D=r[15];return i[0]=a*x+o*M+s*P+u*R,i[4]=a*w+o*C+s*A+u*O,i[8]=a*k+o*T+s*L+u*N,i[12]=a*S+o*E+s*I+u*D,i[1]=l*x+c*M+h*P+d*R,i[5]=l*w+c*C+h*A+d*O,i[9]=l*k+c*T+h*L+d*N,i[13]=l*S+c*E+h*I+d*D,i[2]=f*x+p*M+v*P+m*R,i[6]=f*w+p*C+v*A+m*O,i[10]=f*k+p*T+v*L+m*N,i[14]=f*S+p*E+v*I+m*D,i[3]=g*x+_*M+y*P+b*R,i[7]=g*w+_*C+y*A+b*O,i[11]=g*k+_*T+y*L+b*N,i[15]=g*S+_*E+y*I+b*D,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-r*u*c-i*o*h+n*u*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*u*h+i*a*h-r*a*d+r*u*l-i*s*l)+e[11]*(+t*u*c-t*o*d-i*a*c+n*a*d+i*o*l-n*u*l)+e[15]*(-r*o*l-t*s*c+t*o*h+r*a*c-n*a*h+n*s*l)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],m=e[15],g=c*v*u-p*h*u+p*s*d-o*v*d-c*s*m+o*h*m,_=f*h*u-l*v*u-f*s*d+a*v*d+l*s*m-a*h*m,y=l*p*u-f*c*u+f*o*d-a*p*d-l*o*m+a*c*m,b=f*c*s-l*p*s-f*o*h+a*p*h+l*o*v-a*c*v,x=t*g+n*_+r*y+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/x;return e[0]=g*w,e[1]=(p*h*i-c*v*i-p*r*d+n*v*d+c*r*m-n*h*m)*w,e[2]=(o*v*i-p*s*i+p*r*u-n*v*u-o*r*m+n*s*m)*w,e[3]=(c*s*i-o*h*i-c*r*u+n*h*u+o*r*d-n*s*d)*w,e[4]=_*w,e[5]=(l*v*i-f*h*i+f*r*d-t*v*d-l*r*m+t*h*m)*w,e[6]=(f*s*i-a*v*i-f*r*u+t*v*u+a*r*m-t*s*m)*w,e[7]=(a*h*i-l*s*i+l*r*u-t*h*u-a*r*d+t*s*d)*w,e[8]=y*w,e[9]=(f*c*i-l*p*i-f*n*d+t*p*d+l*n*m-t*c*m)*w,e[10]=(a*p*i-f*o*i+f*n*u-t*p*u-a*n*m+t*o*m)*w,e[11]=(l*o*i-a*c*i-l*n*u+t*c*u+a*n*d-t*o*d)*w,e[12]=b*w,e[13]=(l*p*r-f*c*r+f*n*h-t*p*h-l*n*v+t*c*v)*w,e[14]=(f*o*r-a*p*r-f*n*s+t*p*s+a*n*v-t*o*v)*w,e[15]=(a*c*r-l*o*r+l*n*s-t*c*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,u=i*a,l=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,l*o+n,l*s-r*a,0,u*s-r*o,l*s+r*a,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,u=i+i,l=a+a,c=o+o,h=i*u,d=i*l,f=i*c,p=a*l,v=a*c,m=o*c,g=s*u,_=s*l,y=s*c,b=n.x,x=n.y,w=n.z;return r[0]=(1-(p+m))*b,r[1]=(d+y)*b,r[2]=(f-_)*b,r[3]=0,r[4]=(d-y)*x,r[5]=(1-(h+m))*x,r[6]=(v+g)*x,r[7]=0,r[8]=(f+_)*w,r[9]=(v-g)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,i=wg.set(r[0],r[1],r[2]).length(),a=wg.set(r[4],r[5],r[6]).length(),o=wg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],kg.copy(this);var s=1/i,u=1/a,l=1/o;return kg.elements[0]*=s,kg.elements[1]*=s,kg.elements[2]*=s,kg.elements[4]*=u,kg.elements[5]*=u,kg.elements[6]*=u,kg.elements[8]*=l,kg.elements[9]*=l,kg.elements[10]*=l,t.setFromRotationMatrix(kg),n.x=i,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),u=2*i/(n-r),l=(t+e)/(t-e),c=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),u=1/(n-r),l=1/(a-i),c=(t+e)*s,h=(n+r)*u,d=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}();xg.prototype.isMatrix4=!0;var wg=new Vm,kg=new xg,Sg=new Vm(0,0,0),Mg=new Vm(1,1,1),Cg=new Vm,Tg=new Vm,Eg=new Vm,Pg=new xg,Ag=new Um,Lg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;Bd(this,e),this._x=t,this._y=n,this._z=r,this._order=i}return $d(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],u=r[5],l=r[9],c=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(km(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-km(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(km(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-km(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(km(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-km(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Pg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Pg,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Ag.setFromEuler(this),this.setFromQuaternion(Ag,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new Vm(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}]),e}();Lg.prototype.isEuler=!0,Lg.DefaultOrder="XYZ",Lg.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Ig=function(){function e(){Bd(this,e),this.mask=1}return $d(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}}]),e}(),Rg=0,Og=new Vm,Ng=new Um,Dg=new xg,zg=new Vm,jg=new Vm,Bg=new Vm,Fg=new Um,$g=new Vm(1,0,0),qg=new Vm(0,1,0),Ug=new Vm(0,0,1),Vg={type:"added"},Hg={type:"removed"},Wg=function(e){Dd(n,e);var t=zd(n);function n(){var e;Bd(this,n),e=t.call(this),Object.defineProperty(Id(e),"id",{value:Rg++}),e.uuid=wm(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var r=new Vm,i=new Lg,a=new Um,o=new Vm(1,1,1);return i._onChange((function(){a.setFromEuler(i,!1)})),a._onChange((function(){i.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(Id(e),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new xg},normalMatrix:{value:new Lm}}),e.matrix=new xg,e.matrixWorld=new xg,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new Ig,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return $d(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Ng.setFromAxisAngle(e,t),this.quaternion.multiply(Ng),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Ng.setFromAxisAngle(e,t),this.quaternion.premultiply(Ng),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis($g,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(qg,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Ug,e)}},{key:"translateOnAxis",value:function(e,t){return Og.copy(e).applyQuaternion(this.quaternion),this.position.add(Og.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis($g,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(qg,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Ug,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Dg.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?zg.copy(e):zg.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),jg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dg.lookAt(jg,zg,this.up):Dg.lookAt(zg,jg,this.up),this.quaternion.setFromRotationMatrix(Dg),r&&(Dg.extractRotation(r.matrixWorld),Ng.setFromRotationMatrix(Dg),this.quaternion.premultiply(Ng.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Vg)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Hg)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Hg)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Dg.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Dg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Dg),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(jg,e,Bg),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(jg,Fg,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var l=o[s];i(e.shapes,l)}else i(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(i(e.materials,this.material[h]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(var f=0;f<this.children.length;f++)r.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];r.animations.push(i(e.animations,v))}}if(t){var m=k(e.geometries),g=k(e.materials),_=k(e.textures),y=k(e.images),b=k(e.shapes),x=k(e.skeletons),w=k(e.animations);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),_.length>0&&(n.textures=_),y.length>0&&(n.images=y),b.length>0&&(n.shapes=b),x.length>0&&(n.skeletons=x),w.length>0&&(n.animations=w)}return n.object=r,n;function k(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),n}(vm);Wg.DefaultUp=new Vm(0,1,0),Wg.DefaultMatrixAutoUpdate=!0,Wg.prototype.isObject3D=!0;var Gg=new Vm,Zg=new Vm,Yg=new Vm,Xg=new Vm,Kg=new Vm,Jg=new Vm,Qg=new Vm,e_=new Vm,t_=new Vm,n_=new Vm,r_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vm;Bd(this,e),this.a=t,this.b=n,this.c=r}return $d(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Gg.subVectors(this.c,this.b),Zg.subVectors(this.a,this.b),.5*Gg.cross(Zg).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,i,a){return e.getUV(t,this.a,this.b,this.c,n,r,i,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,i=this.a,a=this.b,o=this.c;Kg.subVectors(a,i),Jg.subVectors(o,i),e_.subVectors(e,i);var s=Kg.dot(e_),u=Jg.dot(e_);if(s<=0&&u<=0)return t.copy(i);t_.subVectors(e,a);var l=Kg.dot(t_),c=Jg.dot(t_);if(l>=0&&c<=l)return t.copy(a);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(i).addScaledVector(Kg,n);n_.subVectors(e,o);var d=Kg.dot(n_),f=Jg.dot(n_);if(f>=0&&d<=f)return t.copy(o);var p=d*u-s*f;if(p<=0&&u>=0&&f<=0)return r=u/(u-f),t.copy(i).addScaledVector(Jg,r);var v=l*f-d*c;if(v<=0&&c-l>=0&&d-f>=0)return Qg.subVectors(o,a),r=(c-l)/(c-l+(d-f)),t.copy(a).addScaledVector(Qg,r);var m=1/(v+p+h);return n=p*m,r=h*m,t.copy(i).addScaledVector(Kg,n).addScaledVector(Jg,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),Gg.subVectors(e,t),r.cross(Gg);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,i){Gg.subVectors(r,t),Zg.subVectors(n,t),Yg.subVectors(e,t);var a=Gg.dot(Gg),o=Gg.dot(Zg),s=Gg.dot(Yg),u=Zg.dot(Zg),l=Zg.dot(Yg),c=a*u-o*o;if(0===c)return i.set(-2,-1,-1);var h=1/c,d=(u*s-o*l)*h,f=(a*l-o*s)*h;return i.set(1-d-f,f,d)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,Xg),Xg.x>=0&&Xg.y>=0&&Xg.x+Xg.y<=1}},{key:"getUV",value:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,Xg),s.set(0,0),s.addScaledVector(i,Xg.x),s.addScaledVector(a,Xg.y),s.addScaledVector(o,Xg.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return Gg.subVectors(n,t),Zg.subVectors(e,t),Gg.cross(Zg).dot(r)<0}}]),e}(),i_=0,a_=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),e=t.call(this),Object.defineProperty(Id(e),"id",{value:i_++}),e.uuid=wm(),e.name="",e.type="Material",e.fog=!0,e.blending=1,e.side=0,e.vertexColors=!1,e.opacity=1,e.format=Xv,e.transparent=!1,e.blendSrc=204,e.blendDst=205,e.blendEquation=Rv,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=3,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=hm,e.stencilZFail=hm,e.stencilZPass=hm,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return $d(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==Xv&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),a=r(e.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(vm);a_.prototype.isMaterial=!0;var o_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},s_={h:0,s:0,l:0},u_={h:0,s:0,l:0};function l_(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function c_(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function h_(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var d_=function(){function e(t,n,r){return Bd(this,e),void 0===n&&void 0===r?this.set(t):this.setRGB(t,n,r)}return $d(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=Sm(e,1),t=km(t,0,1),n=km(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=l_(i,r,e+1/3),this.g=l_(i,r,e),this.b=l_(i,r,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,i=n[1],a=n[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(o,s,u)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=o_[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=c_(e.r),this.g=c_(e.g),this.b=c_(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=h_(e.r),this.g=h_(e.g),this.b=h_(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),u=(s+o)/2;if(s===o)t=0,n=0;else{var l=o-s;switch(n=u<=.5?l/(o+s):l/(2-o-s),o){case r:t=(i-a)/l+(i<a?6:0);break;case i:t=(a-r)/l+2;break;case a:t=(r-i)/l+4}t/=6}return e.h=t,e.s=n,e.l=u,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(s_),s_.h+=e,s_.s+=t,s_.l+=n,this.setHSL(s_.h,s_.s,s_.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(s_),e.getHSL(u_);var n=Mm(s_.h,u_.h,t),r=Mm(s_.s,u_.s,t),i=Mm(s_.l,u_.l,t);return this.setHSL(n,r,i),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();d_.NAMES=o_,d_.prototype.isColor=!0,d_.prototype.r=1,d_.prototype.g=1,d_.prototype.b=1;var f_=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="MeshBasicMaterial",r.color=new d_(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=0,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(a_);f_.prototype.isMeshBasicMaterial=!0;var p_=new Vm,v_=new Pm,m_=function(){function e(t,n,r){if(Bd(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===r,this.usage=dm,this.updateRange={offset:0,count:-1},this.version=0}return $d(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new d_),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new Pm),t[n++]=a.x,t[n++]=a.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new Vm),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Bm),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)v_.fromBufferAttribute(this,t),v_.applyMatrix3(e),this.setXY(t,v_.x,v_.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)p_.fromBufferAttribute(this,r),p_.applyMatrix3(e),this.setXYZ(r,p_.x,p_.y,p_.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)p_.x=this.getX(t),p_.y=this.getY(t),p_.z=this.getZ(t),p_.applyMatrix4(e),this.setXYZ(t,p_.x,p_.y,p_.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)p_.x=this.getX(t),p_.y=this.getY(t),p_.z=this.getZ(t),p_.applyNormalMatrix(e),this.setXYZ(t,p_.x,p_.y,p_.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)p_.x=this.getX(t),p_.y=this.getY(t),p_.z=this.getZ(t),p_.transformDirection(e),this.setXYZ(t,p_.x,p_.y,p_.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==dm&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}();m_.prototype.isBufferAttribute=!0;var g_=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){return Bd(this,n),t.call(this,new Uint16Array(e),r,i)}return $d(n)}(m_),__=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){return Bd(this,n),t.call(this,new Uint32Array(e),r,i)}return $d(n)}(m_),y_=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){return Bd(this,n),t.call(this,new Uint16Array(e),r,i)}return $d(n)}(m_);y_.prototype.isFloat16BufferAttribute=!0;var b_=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){return Bd(this,n),t.call(this,new Float32Array(e),r,i)}return $d(n)}(m_),x_=0,w_=new xg,k_=new Wg,S_=new Vm,M_=new Gm,C_=new Gm,T_=new Vm,E_=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),e=t.call(this),Object.defineProperty(Id(e),"id",{value:x_++}),e.uuid=wm(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return $d(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(Im(e)>65535?__:g_)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new Lm).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return w_.makeRotationFromQuaternion(e),this.applyMatrix4(w_),this}},{key:"rotateX",value:function(e){return w_.makeRotationX(e),this.applyMatrix4(w_),this}},{key:"rotateY",value:function(e){return w_.makeRotationY(e),this.applyMatrix4(w_),this}},{key:"rotateZ",value:function(e){return w_.makeRotationZ(e),this.applyMatrix4(w_),this}},{key:"translate",value:function(e,t,n){return w_.makeTranslation(e,t,n),this.applyMatrix4(w_),this}},{key:"scale",value:function(e,t,n){return w_.makeScale(e,t,n),this.applyMatrix4(w_),this}},{key:"lookAt",value:function(e){return k_.lookAt(e),k_.updateMatrix(),this.applyMatrix4(k_.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(S_).negate(),this.translate(S_.x,S_.y,S_.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new b_(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Gm);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vm(-1/0,-1/0,-1/0),new Vm(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];M_.setFromBufferAttribute(i),this.morphTargetsRelative?(T_.addVectors(this.boundingBox.min,M_.min),this.boundingBox.expandByPoint(T_),T_.addVectors(this.boundingBox.max,M_.max),this.boundingBox.expandByPoint(T_)):(this.boundingBox.expandByPoint(M_.min),this.boundingBox.expandByPoint(M_.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new dg);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vm,1/0);if(e){var n=this.boundingSphere.center;if(M_.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];C_.setFromBufferAttribute(a),this.morphTargetsRelative?(T_.addVectors(M_.min,C_.min),M_.expandByPoint(T_),T_.addVectors(M_.max,C_.max),M_.expandByPoint(T_)):(M_.expandByPoint(C_.min),M_.expandByPoint(C_.max))}M_.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)T_.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(T_));if(t)for(var l=0,c=t.length;l<c;l++)for(var h=t[l],d=this.morphTargetsRelative,f=0,p=h.count;f<p;f++)T_.fromBufferAttribute(h,f),d&&(S_.fromBufferAttribute(e,f),T_.add(S_)),o=Math.max(o,n.distanceToSquared(T_));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,o=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new m_(new Float32Array(4*o),4));for(var s=t.tangent.array,u=[],l=[],c=0;c<o;c++)u[c]=new Vm,l[c]=new Vm;var h=new Vm,d=new Vm,f=new Vm,p=new Pm,v=new Pm,m=new Pm,g=new Vm,_=new Vm,y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(var b=0,x=y.length;b<x;++b)for(var w=y[b],k=w.start,S=k,M=k+w.count;S<M;S+=3)D(n[S+0],n[S+1],n[S+2]);for(var C=new Vm,T=new Vm,E=new Vm,P=new Vm,A=0,L=y.length;A<L;++A)for(var I=y[A],R=I.start,O=R,N=R+I.count;O<N;O+=3)z(n[O+0]),z(n[O+1]),z(n[O+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function D(e,t,n){h.fromArray(r,3*e),d.fromArray(r,3*t),f.fromArray(r,3*n),p.fromArray(a,2*e),v.fromArray(a,2*t),m.fromArray(a,2*n),d.sub(h),f.sub(h),v.sub(p),m.sub(p);var i=1/(v.x*m.y-m.x*v.y);isFinite(i)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(f,-v.y).multiplyScalar(i),_.copy(f).multiplyScalar(v.x).addScaledVector(d,-m.x).multiplyScalar(i),u[e].add(g),u[t].add(g),u[n].add(g),l[e].add(_),l[t].add(_),l[n].add(_))}function z(e){E.fromArray(i,3*e),P.copy(E);var t=u[e];C.copy(t),C.sub(E.multiplyScalar(E.dot(t))).normalize(),T.crossVectors(P,t);var n=T.dot(l[e])<0?-1:1;s[4*e]=C.x,s[4*e+1]=C.y,s[4*e+2]=C.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new m_(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var a=new Vm,o=new Vm,s=new Vm,u=new Vm,l=new Vm,c=new Vm,h=new Vm,d=new Vm;if(e)for(var f=0,p=e.count;f<p;f+=3){var v=e.getX(f+0),m=e.getX(f+1),g=e.getX(f+2);a.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),u.fromBufferAttribute(n,v),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.add(h),l.add(h),c.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var _=0,y=t.count;_<y;_+=3)a.fromBufferAttribute(t,_+0),o.fromBufferAttribute(t,_+1),s.fromBufferAttribute(t,_+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(_+0,h.x,h.y,h.z),n.setXYZ(_+1,h.x,h.y,h.z),n.setXYZ(_+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,u=Math.min(o.length,i.length-s),l=0,c=s;l<u;l++,c++)i[c]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)T_.fromBufferAttribute(e,t),T_.normalize(),e.setXYZ(t,T_.x,T_.y,T_.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r),o=0,s=0,u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(var c=0;c<r;c++)a[s++]=n[o++]}return new m_(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,r=this.index.array,i=this.attributes;for(var a in i){var o=e(i[a],r);t.setAttribute(a,o)}var s=this.morphAttributes;for(var u in s){for(var l=[],c=s[u],h=0,d=c.length;h<d;h++){var f=e(c[h],r);l.push(f)}t.morphAttributes[u]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var a in i){var o=i[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},u=!1;for(var l in this.morphAttributes){for(var c=this.morphAttributes[l],h=[],d=0,f=c.length;d<f;d++){var p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var i in r){var a=r[i];this.setAttribute(i,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],l=o[s],c=0,h=l.length;c<h;c++)u.push(l[c].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,f=0,p=d.length;f<p;f++){var v=d[f];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(vm);E_.prototype.isBufferGeometry=!0;var P_=new xg,A_=new bg,L_=new dg,I_=new Vm,R_=new Vm,O_=new Vm,N_=new Vm,D_=new Vm,z_=new Vm,j_=new Vm,B_=new Vm,F_=new Vm,$_=new Pm,q_=new Pm,U_=new Pm,V_=new Vm,H_=new Vm,W_=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E_,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f_;return Bd(this,n),(e=t.call(this)).type="Mesh",e.geometry=r,e.material=i,e.updateMorphTargets(),e}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"raycast",value:function(e,t){var n,r=this.geometry,i=this.material,a=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),L_.copy(r.boundingSphere),L_.applyMatrix4(a),!1!==e.ray.intersectsSphere(L_)&&(P_.copy(a).invert(),A_.copy(e.ray).applyMatrix4(P_),null===r.boundingBox||!1!==A_.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o=r.index,s=r.attributes.position,u=r.morphAttributes.position,l=r.morphTargetsRelative,c=r.attributes.uv,h=r.attributes.uv2,d=r.groups,f=r.drawRange;if(null!==o)if(Array.isArray(i))for(var p=0,v=d.length;p<v;p++)for(var m=d[p],g=i[m.materialIndex],_=Math.max(m.start,f.start),y=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));_<y;_+=3){var b=o.getX(_),x=o.getX(_+1),w=o.getX(_+2);(n=G_(this,g,e,A_,s,u,l,c,h,b,x,w))&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,t.push(n))}else for(var k=Math.max(0,f.start),S=Math.min(o.count,f.start+f.count);k<S;k+=3){var M=o.getX(k),C=o.getX(k+1),T=o.getX(k+2);(n=G_(this,i,e,A_,s,u,l,c,h,M,C,T))&&(n.faceIndex=Math.floor(k/3),t.push(n))}else if(void 0!==s)if(Array.isArray(i))for(var E=0,P=d.length;E<P;E++)for(var A=d[E],L=i[A.materialIndex],I=Math.max(A.start,f.start),R=Math.min(s.count,Math.min(A.start+A.count,f.start+f.count));I<R;I+=3){(n=G_(this,L,e,A_,s,u,l,c,h,I,I+1,I+2))&&(n.faceIndex=Math.floor(I/3),n.face.materialIndex=A.materialIndex,t.push(n))}else for(var O=Math.max(0,f.start),N=Math.min(s.count,f.start+f.count);O<N;O+=3){(n=G_(this,i,e,A_,s,u,l,c,h,O,O+1,O+2))&&(n.faceIndex=Math.floor(O/3),t.push(n))}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}]),n}(Wg);function G_(e,t,n,r,i,a,o,s,u,l,c,h){I_.fromBufferAttribute(i,l),R_.fromBufferAttribute(i,c),O_.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(a&&d){j_.set(0,0,0),B_.set(0,0,0),F_.set(0,0,0);for(var f=0,p=a.length;f<p;f++){var v=d[f],m=a[f];0!==v&&(N_.fromBufferAttribute(m,l),D_.fromBufferAttribute(m,c),z_.fromBufferAttribute(m,h),o?(j_.addScaledVector(N_,v),B_.addScaledVector(D_,v),F_.addScaledVector(z_,v)):(j_.addScaledVector(N_.sub(I_),v),B_.addScaledVector(D_.sub(R_),v),F_.addScaledVector(z_.sub(O_),v)))}I_.add(j_),R_.add(B_),O_.add(F_)}e.isSkinnedMesh&&(e.boneTransform(l,I_),e.boneTransform(c,R_),e.boneTransform(h,O_));var g=function(e,t,n,r,i,a,o,s){if(null===(1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,2!==t.side,s)))return null;H_.copy(s),H_.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(H_);return u<n.near||u>n.far?null:{distance:u,point:H_.clone(),object:e}}(e,t,n,r,I_,R_,O_,V_);if(g){s&&($_.fromBufferAttribute(s,l),q_.fromBufferAttribute(s,c),U_.fromBufferAttribute(s,h),g.uv=r_.getUV(V_,I_,R_,O_,$_,q_,U_,new Pm)),u&&($_.fromBufferAttribute(u,l),q_.fromBufferAttribute(u,c),U_.fromBufferAttribute(u,h),g.uv2=r_.getUV(V_,I_,R_,O_,$_,q_,U_,new Pm));var _={a:l,b:c,c:h,normal:new Vm,materialIndex:0};r_.getNormal(I_,R_,O_,_.normal),g.face=_}return g}W_.prototype.isMesh=!0;var Z_=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Bd(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:i,depth:a,widthSegments:o,heightSegments:s,depthSegments:u};var l=Id(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var c=[],h=[],d=[],f=[],p=0,v=0;function m(e,t,n,r,i,a,o,s,u,m,g){for(var _=a/u,y=o/m,b=a/2,x=o/2,w=s/2,k=u+1,S=m+1,M=0,C=0,T=new Vm,E=0;E<S;E++)for(var P=E*y-x,A=0;A<k;A++){var L=A*_-b;T[e]=L*r,T[t]=P*i,T[n]=w,h.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=s>0?1:-1,d.push(T.x,T.y,T.z),f.push(A/u),f.push(1-E/m),M+=1}for(var I=0;I<m;I++)for(var R=0;R<u;R++){var O=p+R+k*I,N=p+R+k*(I+1),D=p+(R+1)+k*(I+1),z=p+(R+1)+k*I;c.push(O,N,z),c.push(N,D,z),C+=6}l.addGroup(v,C,g),v+=C,p+=M}return m("z","y","x",-1,-1,a,i,r,u,s,0),m("z","y","x",1,-1,a,i,-r,u,s,1),m("x","z","y",1,1,r,a,i,o,u,2),m("x","z","y",1,-1,r,a,-i,o,u,3),m("x","y","z",1,-1,r,i,a,o,s,4),m("x","y","z",-1,-1,r,i,-a,o,s,5),e.setIndex(c),e.setAttribute("position",new b_(h,3)),e.setAttribute("normal",new b_(d,3)),e.setAttribute("uv",new b_(f,2)),e}return $d(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(E_);function Y_(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function X_(e){for(var t={},n=0;n<e.length;n++){var r=Y_(e[n]);for(var i in r)t[i]=r[i]}return t}var K_={clone:Y_,merge:X_},J_=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="ShaderMaterial",r.defines={},r.uniforms={},r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",r.linewidth=1,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.lights=!1,r.clipping=!1,r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},r.index0AttributeName=void 0,r.uniformsNeedUpdate=!1,r.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),r.setValues(e)),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Y_(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);for(var r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(a_);J_.prototype.isShaderMaterial=!0;var Q_=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this)).type="Camera",e.matrixWorldInverse=new xg,e.projectionMatrix=new xg,e.projectionMatrixInverse=new xg,e}return $d(n,[{key:"copy",value:function(e,t){return Nd(wd(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){Nd(wd(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Nd(wd(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Wg);Q_.prototype.isCamera=!0;var ey=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return Bd(this,n),(e=t.call(this)).type="PerspectiveCamera",e.fov=r,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=i,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return $d(n,[{key:"copy",value:function(e,t){return Nd(wd(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*_m*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*gm*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*_m*Math.atan(Math.tan(.5*gm*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*gm*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(Q_);ey.prototype.isPerspectiveCamera=!0;var ty=90,ny=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;if(Bd(this,n),(a=t.call(this)).type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),Rd(a);a.renderTarget=i;var o=new ey(ty,1,e,r);o.layers=a.layers,o.up.set(0,-1,0),o.lookAt(new Vm(1,0,0)),a.add(o);var s=new ey(ty,1,e,r);s.layers=a.layers,s.up.set(0,-1,0),s.lookAt(new Vm(-1,0,0)),a.add(s);var u=new ey(ty,1,e,r);u.layers=a.layers,u.up.set(0,0,1),u.lookAt(new Vm(0,1,0)),a.add(u);var l=new ey(ty,1,e,r);l.layers=a.layers,l.up.set(0,0,-1),l.lookAt(new Vm(0,-1,0)),a.add(l);var c=new ey(ty,1,e,r);c.layers=a.layers,c.up.set(0,-1,0),c.lookAt(new Vm(0,0,1)),a.add(c);var h=new ey(ty,1,e,r);return h.layers=a.layers,h.up.set(0,-1,0),h.lookAt(new Vm(0,0,-1)),a.add(h),a}return $d(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=o(this.children,6),i=r[0],a=r[1],s=r[2],u=r[3],l=r[4],c=r[5],h=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;var f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,u),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=h}}]),n}(Wg),ry=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o,s,u,l,c,h){var d;return Bd(this,n),e=void 0!==e?e:[],r=void 0!==r?r:Ov,(d=t.call(this,e,r,i,a,o,s,u,l,c,h)).flipY=!1,d}return $d(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(zm);ry.prototype.isCubeTexture=!0;var iy=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),Number.isInteger(r)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),r=i),a=t.call(this,e,e,r),r=r||{},a.texture=new ry(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),a.texture.isRenderTargetTexture=!0,a.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,a.texture.minFilter=void 0!==r.minFilter?r.minFilter:$v,a.texture._needsFlipEnvMap=!1,a}return $d(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.format=Xv,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Z_(5,5,5),o=new J_({name:"CubemapFromEquirect",uniforms:Y_(n),vertexShader:r,fragmentShader:i,side:1,blending:0});o.uniforms.tEquirect.value=t;var s=new W_(a,o),u=t.minFilter;return t.minFilter===qv&&(t.minFilter=$v),new ny(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var i=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}]),n}(Fm);iy.prototype.isWebGLCubeRenderTarget=!0;var ay=new Vm,oy=new Vm,sy=new Lm,uy=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Bd(this,e),this.normal=t,this.constant=n}return $d(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=ay.subVectors(n,t).cross(oy.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(ay),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||sy.getNormalMatrix(e),r=this.coplanarPoint(ay).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();uy.prototype.isPlane=!0;var ly=new dg,cy=new Vm,hy=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new uy,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new uy,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new uy,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new uy,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new uy,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new uy;Bd(this,e),this.planes=[t,n,r,i,a,o]}return $d(e,[{key:"set",value:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],v=n[12],m=n[13],g=n[14],_=n[15];return t[0].setComponents(o-r,c-s,p-h,_-v).normalize(),t[1].setComponents(o+r,c+s,p+h,_+v).normalize(),t[2].setComponents(o+i,c+u,p+d,_+m).normalize(),t[3].setComponents(o-i,c-u,p-d,_-m).normalize(),t[4].setComponents(o-a,c-l,p-f,_-g).normalize(),t[5].setComponents(o+a,c+l,p+f,_+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ly.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ly)}},{key:"intersectsSprite",value:function(e){return ly.center.set(0,0,0),ly.radius=.7071067811865476,ly.applyMatrix4(e.matrixWorld),this.intersectsSphere(ly)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(cy.x=r.normal.x>0?e.max.x:e.min.x,cy.y=r.normal.y>0?e.max.y:e.min.y,cy.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(cy)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function dy(){var e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function fy(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){var a=r.get(t);(!a||a.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var i=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,i,a),t.onUploadCallback();var s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){var a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,i),o.version=t.version)}}}}var py=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Bd(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:i,widthSegments:a,heightSegments:o};for(var s=r/2,u=i/2,l=Math.floor(a),c=Math.floor(o),h=l+1,d=c+1,f=r/l,p=i/c,v=[],m=[],g=[],_=[],y=0;y<d;y++)for(var b=y*p-u,x=0;x<h;x++){var w=x*f-s;m.push(w,-b,0),g.push(0,0,1),_.push(x/l),_.push(1-y/c)}for(var k=0;k<c;k++)for(var S=0;S<l;S++){var M=S+h*k,C=S+h*(k+1),T=S+1+h*(k+1),E=S+1+h*k;v.push(M,C,E),v.push(C,T,E)}return e.setIndex(v),e.setAttribute("position",new b_(m,3)),e.setAttribute("normal",new b_(g,3)),e.setAttribute("uv",new b_(_,2)),e}return $d(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(E_),vy={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},my={common:{diffuse:{value:new d_(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Lm},uv2Transform:{value:new Lm},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pm(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new d_(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new d_(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Lm}},sprite:{diffuse:{value:new d_(16777215)},opacity:{value:1},center:{value:new Pm(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Lm}}},gy={basic:{uniforms:X_([my.common,my.specularmap,my.envmap,my.aomap,my.lightmap,my.fog]),vertexShader:vy.meshbasic_vert,fragmentShader:vy.meshbasic_frag},lambert:{uniforms:X_([my.common,my.specularmap,my.envmap,my.aomap,my.lightmap,my.emissivemap,my.fog,my.lights,{emissive:{value:new d_(0)}}]),vertexShader:vy.meshlambert_vert,fragmentShader:vy.meshlambert_frag},phong:{uniforms:X_([my.common,my.specularmap,my.envmap,my.aomap,my.lightmap,my.emissivemap,my.bumpmap,my.normalmap,my.displacementmap,my.fog,my.lights,{emissive:{value:new d_(0)},specular:{value:new d_(1118481)},shininess:{value:30}}]),vertexShader:vy.meshphong_vert,fragmentShader:vy.meshphong_frag},standard:{uniforms:X_([my.common,my.envmap,my.aomap,my.lightmap,my.emissivemap,my.bumpmap,my.normalmap,my.displacementmap,my.roughnessmap,my.metalnessmap,my.fog,my.lights,{emissive:{value:new d_(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vy.meshphysical_vert,fragmentShader:vy.meshphysical_frag},toon:{uniforms:X_([my.common,my.aomap,my.lightmap,my.emissivemap,my.bumpmap,my.normalmap,my.displacementmap,my.gradientmap,my.fog,my.lights,{emissive:{value:new d_(0)}}]),vertexShader:vy.meshtoon_vert,fragmentShader:vy.meshtoon_frag},matcap:{uniforms:X_([my.common,my.bumpmap,my.normalmap,my.displacementmap,my.fog,{matcap:{value:null}}]),vertexShader:vy.meshmatcap_vert,fragmentShader:vy.meshmatcap_frag},points:{uniforms:X_([my.points,my.fog]),vertexShader:vy.points_vert,fragmentShader:vy.points_frag},dashed:{uniforms:X_([my.common,my.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vy.linedashed_vert,fragmentShader:vy.linedashed_frag},depth:{uniforms:X_([my.common,my.displacementmap]),vertexShader:vy.depth_vert,fragmentShader:vy.depth_frag},normal:{uniforms:X_([my.common,my.bumpmap,my.normalmap,my.displacementmap,{opacity:{value:1}}]),vertexShader:vy.meshnormal_vert,fragmentShader:vy.meshnormal_frag},sprite:{uniforms:X_([my.sprite,my.fog]),vertexShader:vy.sprite_vert,fragmentShader:vy.sprite_frag},background:{uniforms:{uvTransform:{value:new Lm},t2D:{value:null}},vertexShader:vy.background_vert,fragmentShader:vy.background_frag},cube:{uniforms:X_([my.envmap,{opacity:{value:1}}]),vertexShader:vy.cube_vert,fragmentShader:vy.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vy.equirect_vert,fragmentShader:vy.equirect_frag},distanceRGBA:{uniforms:X_([my.common,my.displacementmap,{referencePosition:{value:new Vm},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vy.distanceRGBA_vert,fragmentShader:vy.distanceRGBA_frag},shadow:{uniforms:X_([my.lights,my.fog,{color:{value:new d_(0)},opacity:{value:1}}]),vertexShader:vy.shadow_vert,fragmentShader:vy.shadow_frag}};function _y(e,t,n,r,i){var a,o,s=new d_(0),u=0,l=null,c=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),d(s,u=t)},getClearAlpha:function(){return u},setClearAlpha:function(e){d(s,u=e)},render:function(n,i){var f=!1,p=!0===i.isScene?i.background:null;p&&p.isTexture&&(p=t.get(p));var v=e.xr,m=v.getSession&&v.getSession();m&&"additive"===m.environmentBlendMode&&(p=null),null===p?d(s,u):p&&p.isColor&&(d(p,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.mapping===Dv)?(void 0===o&&((o=new W_(new Z_(1,1,1),new J_({name:"BackgroundCubeMaterial",uniforms:Y_(gy.cube.uniforms),vertexShader:gy.cube.vertexShader,fragmentShader:gy.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(o)),o.material.uniforms.envMap.value=p,o.material.uniforms.flipEnvMap.value=p.isCubeTexture&&!1===p.isRenderTargetTexture?-1:1,l===p&&c===p.version&&h===e.toneMapping||(o.material.needsUpdate=!0,l=p,c=p.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):p&&p.isTexture&&(void 0===a&&((a=new W_(new py(2,2),new J_({name:"BackgroundMaterial",uniforms:Y_(gy.background.uniforms),vertexShader:gy.background.vertexShader,fragmentShader:gy.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),a.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&c===p.version&&h===e.toneMapping||(a.material.needsUpdate=!0,l=p,c=p.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function yy(e,t,n,r){var i=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},u=d(null),l=u;function c(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],r=[],a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){for(var e=l.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function p(e){v(e,0)}function v(n,i){var a=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function m(){for(var t=l.newAttributes,n=l.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function g(t,n,i,a,o,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function _(){y(),l!==u&&c((l=u).object)}function y(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(i,u,h,_,y){var b=!1;if(o){var x=function(t,n,i){var o=!0===i.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var l=u[n.id];void 0===l&&(l={},u[n.id]=l);var c=l[o];void 0===c&&(c=d(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),l[o]=c);return c}(_,h,u);l!==x&&c((l=x).object),b=function(e,t){var n=l.attributes,r=e.attributes,i=0;for(var a in r){var o=n[a],s=r[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;i++}return l.attributesNum!==i||l.index!==t}(_,y),b&&function(e,t){var n={},r=e.attributes,i=0;for(var a in r){var o=r[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,i++}l.attributes=n,l.attributesNum=i,l.index=t}(_,y)}else{var w=!0===u.wireframe;l.geometry===_.id&&l.program===h.id&&l.wireframe===w||(l.geometry=_.id,l.program=h.id,l.wireframe=w,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==y&&n.update(y,34963),b&&(!function(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();var u=s.attributes,l=o.getAttributes(),c=a.defaultAttributeValues;for(var h in l){var d=l[h];if(d.location>=0){var _=u[h];if(void 0===_&&("instanceMatrix"===h&&i.instanceMatrix&&(_=i.instanceMatrix),"instanceColor"===h&&i.instanceColor&&(_=i.instanceColor)),void 0!==_){var y=_.normalized,b=_.itemSize,x=n.get(_);if(void 0===x)continue;var w=x.buffer,k=x.type,S=x.bytesPerElement;if(_.isInterleavedBufferAttribute){var M=_.data,C=M.stride,T=_.offset;if(M&&M.isInstancedInterleavedBuffer){for(var E=0;E<d.locationSize;E++)v(d.location+E,M.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=M.meshPerAttribute*M.count)}else for(var P=0;P<d.locationSize;P++)p(d.location+P);e.bindBuffer(34962,w);for(var A=0;A<d.locationSize;A++)g(d.location+A,b/d.locationSize,k,y,C*S,(T+b/d.locationSize*A)*S)}else{if(_.isInstancedBufferAttribute){for(var L=0;L<d.locationSize;L++)v(d.location+L,_.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=_.meshPerAttribute*_.count)}else for(var I=0;I<d.locationSize;I++)p(d.location+I);e.bindBuffer(34962,w);for(var R=0;R<d.locationSize;R++)g(d.location+R,b/d.locationSize,k,y,b*S,b/d.locationSize*R*S)}}else if(void 0!==c){var O=c[h];if(void 0!==O)switch(O.length){case 2:e.vertexAttrib2fv(d.location,O);break;case 3:e.vertexAttrib3fv(d.location,O);break;case 4:e.vertexAttrib4fv(d.location,O);break;default:e.vertexAttrib1fv(d.location,O)}}}}m()}(i,u,h,_),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:_,resetDefaultState:y,dispose:function(){for(var e in _(),s){var t=s[e];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var i in r)h(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:m}}function by(e,t,n,r){var i,a=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=function(r,o,s){if(0!==s){var u,l;if(a)u=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](i,r,o,s),n.update(o,i,s)}}}function xy(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=a||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),f=e.getParameter(34076),p=e.getParameter(34921),v=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),_=h>0,y=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:_,floatFragmentTextures:y,floatVertexTextures:_&&y,maxSamples:a?e.getParameter(36183):0}}function wy(e){var t=this,n=null,r=0,i=!1,a=!1,o=new uy,s=new Lm,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,n,r,i){var a=null!==e?e.length:0,l=null;if(0!==a){if(l=u.value,!0!==i||null===l){var c=r+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var d=0,f=r;d!==a;++d,f+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(l,f),l[f+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==r||i;return i=t,n=c(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,l()},this.setState=function(t,o,s){var h=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||a&&!f)a?c(null):l();else{var v=a?0:r,m=4*v,g=p.clippingState||null;u.value=g,g=c(h,o,m,s);for(var _=0;_!==m;++_)g[_]=n[_];p.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}}}function ky(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=Ov:304===t&&(e.mapping=Nv),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){var a=i.mapping;if(303===a||304===a){if(t.has(i))return n(t.get(i).texture,i.mapping);var o=i.image;if(o&&o.height>0){var s=e.getRenderTarget(),u=new iy(o.height/2);return u.fromEquirectangularTexture(e,i),t.set(i,u),e.setRenderTarget(s),i.addEventListener("dispose",r),n(u.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}gy.physical={uniforms:X_([gy.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Pm(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new d_(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Pm},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new d_(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new d_(1,1,1)},specularColorMap:{value:null}}]),vertexShader:vy.meshphysical_vert,fragmentShader:vy.meshphysical_frag};var Sy=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return Bd(this,n),(e=t.call(this)).type="OrthographicCamera",e.zoom=1,e.view=null,e.left=r,e.right=i,e.top=a,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return $d(n,[{key:"copy",value:function(e,t){return Nd(wd(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=u*this.view.offsetX)+u*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(Q_);Sy.prototype.isOrthographicCamera=!0;var My=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e)).type="RawShaderMaterial",r}return $d(n)}(J_);My.prototype.isRawShaderMaterial=!0;var Cy=Math.pow(2,8),Ty=[.125,.215,.35,.446,.526,.582],Ey=5+Ty.length,Py=20,Ay=(Xh(Td={},sm,0),Xh(Td,um,1),Xh(Td,cm,2),Xh(Td,3004,3),Xh(Td,3005,4),Xh(Td,3006,5),Xh(Td,lm,6),Td),Ly=new Sy,Iy=Uy(),Ry=Iy._lodPlanes,Oy=Iy._sizeLods,Ny=Iy._sigmas,Dy=new d_,zy=null,jy=(1+Math.sqrt(5))/2,By=1/jy,Fy=[new Vm(1,1,1),new Vm(-1,1,1),new Vm(1,1,-1),new Vm(-1,1,-1),new Vm(0,jy,By),new Vm(0,jy,-By),new Vm(By,0,jy),new Vm(-By,0,jy),new Vm(jy,By,0),new Vm(-jy,By,0)],$y=function(){function e(t){Bd(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(e){var t=new Float32Array(e),n=new Vm(0,1,0);return new My({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Ay[3e3]},outputEncoding:{value:Ay[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t".concat("\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t","\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})}(Py),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}return $d(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;zy=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}},{key:"fromEquirectangular",value:function(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function(){null===this._cubemapShader&&(this._cubemapShader=Gy(),this._compileMaterial(this._cubemapShader))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectShader&&(this._equirectShader=Wy(),this._compileMaterial(this._equirectShader))}},{key:"dispose",value:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<Ry.length;e++)Ry[e].dispose()}},{key:"_cleanup",value:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(zy),e.scissorTest=!1,Hy(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e){zy=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}},{key:"_allocateTargets",value:function(e){var t={magFilter:Fv,minFilter:Fv,generateMipmaps:!1,type:Uv,format:1023,encoding:qy(e)?e.encoding:cm,depthBuffer:!1},n=Vy(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Vy(t),n}},{key:"_compileMaterial",value:function(e){var t=new W_(Ry[0],e);this._renderer.compile(t,Ly)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var i=new ey(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.outputEncoding,c=s.toneMapping;s.getClearColor(Dy),s.toneMapping=0,s.outputEncoding=sm,s.autoClear=!1;var h=new f_({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new W_(new Z_,h),f=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,f=!0):(h.color.copy(Dy),f=!0);for(var v=0;v<6;v++){var m=v%3;0==m?(i.up.set(0,a[v],0),i.lookAt(o[v],0,0)):1==m?(i.up.set(0,0,a[v]),i.lookAt(0,o[v],0)):(i.up.set(0,a[v],0),i.lookAt(0,0,o[v])),Hy(r,m*Cy,v>2?Cy:0,Cy,Cy),s.setRenderTarget(r),f&&s.render(d,i),s.render(e,i)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.outputEncoding=l,s.autoClear=u,e.background=p}},{key:"_setEncoding",value:function(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===Xv&&t.type===Uv&&t.encoding===um?e.value=Ay[3e3]:e.value=Ay[t.encoding]}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===Ov||e.mapping===Nv;r?null==this._cubemapShader&&(this._cubemapShader=Gy()):null==this._equirectShader&&(this._equirectShader=Wy());var i=r?this._cubemapShader:this._equirectShader,a=new W_(Ry[0],i),o=i.uniforms;o.envMap.value=e,r||o.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(o.inputEncoding,e),this._setEncoding(o.outputEncoding,t.texture),Hy(t,0,0,3*Cy,2*Cy),n.setRenderTarget(t),n.render(a,Ly)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<Ey;r++){var i=Math.sqrt(Ny[r]*Ny[r]-Ny[r-1]*Ny[r-1]),a=Fy[(r-1)%Fy.length];this._blur(e,r-1,r,i,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,i){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}},{key:"_halfBlur",value:function(e,t,n,r,i,a,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new W_(Ry[r],u),c=u.uniforms,h=Oy[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,f=i/d,p=isFinite(i)?1+Math.floor(3*f):Py;p>Py&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(Py));for(var v=[],m=0,g=0;g<Py;++g){var _=g/f,y=Math.exp(-_*_/2);v.push(y),0==g?m+=y:g<p&&(m+=2*y)}for(var b=0;b<v.length;b++)v[b]=v[b]/m;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=v,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=d,c.mipInt.value=8-n,this._setEncoding(c.inputEncoding,e.texture),this._setEncoding(c.outputEncoding,e.texture);var x=Oy[r];Hy(t,3*Math.max(0,Cy-2*x),(0===r?0:2*Cy)+2*x*(r>4?r-8+4:0),3*x,2*x),s.setRenderTarget(t),s.render(l,Ly)}}]),e}();function qy(e){return void 0!==e&&e.type===Uv&&(e.encoding===sm||e.encoding===um||e.encoding===lm)}function Uy(){for(var e=[],t=[],n=[],r=8,i=0;i<Ey;i++){var a=Math.pow(2,r);t.push(a);var o=1/a;i>4?o=Ty[i-8+4-1]:0==i&&(o=0),n.push(o);for(var s=1/(a-1),u=-s/2,l=1+s/2,c=[u,u,l,u,l,l,u,u,l,l,u,l],h=new Float32Array(108),d=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var v=p%3*2/3-1,m=p>2?0:-1,g=[v,m,0,v+2/3,m,0,v+2/3,m+1,0,v,m,0,v+2/3,m+1,0,v,m+1,0];h.set(g,18*p),d.set(c,12*p);var _=[p,p,p,p,p,p];f.set(_,6*p)}var y=new E_;y.setAttribute("position",new m_(h,3)),y.setAttribute("uv",new m_(d,2)),y.setAttribute("faceIndex",new m_(f,1)),e.push(y),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Vy(e){var t=new Fm(3*Cy,3*Cy,e);return t.texture.mapping=Dv,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Hy(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Wy(){var e=new Pm(1,1);return new My({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Ay[3e3]},outputEncoding:{value:Ay[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t".concat("\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t","\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})}function Gy(){return new My({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ay[3e3]},outputEncoding:{value:Ay[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t".concat("\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t","\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})}function Zy(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){var a=i.mapping,o=303===a||304===a,s=a===Ov||a===Nv;if(o||s){if(t.has(i))return t.get(i).texture;var u=i.image;if(o&&u&&u.height>0||s&&u&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(u)){var l=e.getRenderTarget();null===n&&(n=new $y(e));var c=o?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,c),e.setRenderTarget(l),i.addEventListener("dispose",r),c.texture}return null}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Yy(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Xy(e,t,n,r){var i={},a=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete i[s.id];var l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,i=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],d=s[u+2];n.push(c,h,h,d,d,c)}}else{var f=i.array;o=i.version;for(var p=0,v=f.length/3-1;p<v;p+=3){var m=p+0,g=p+1,_=p+2;n.push(m,g,g,_,_,m)}}var y=new(Im(n)>65535?__:g_)(n,1);y.version=o;var b=a.get(e);b&&t.remove(b),a.set(e,y)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var i=e.morphAttributes;for(var a in i)for(var o=i[a],s=0,u=o.length;s<u;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Ky(e,t,n,r){var i,a,o,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,a,t*o),n.update(r,i,1)},this.renderInstances=function(r,u,l){if(0!==l){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](i,u,a,r*o,l),n.update(u,i,l)}}}function Jy(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}var Qy=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Bd(this,n),(e=t.call(this,null)).image={data:r,width:i,height:a,depth:o},e.magFilter=Fv,e.minFilter=Fv,e.wrapR=jv,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return $d(n)}(zm);function eb(e,t){return e[0]-t[0]}function tb(e,t){return Math.abs(t[1])-Math.abs(e[1])}function nb(e,t){var n=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?n=127:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(n)}function rb(e,t,n){for(var r={},i=new Float32Array(8),a=new WeakMap,o=new Vm,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,l,c,h){var d=u.morphTargetInfluences;if(!0===t.isWebGL2){var f=l.morphAttributes.position.length,p=a.get(l);if(void 0===p||p.count!==f){void 0!==p&&p.texture.dispose();var v=void 0!==l.morphAttributes.normal,m=l.morphAttributes.position,g=l.morphAttributes.normal||[],_=!0===v?2:1,y=l.attributes.position.count*_,b=1;y>t.maxTextureSize&&(b=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);var x=new Float32Array(y*b*4*f),w=new Qy(x,y,b,f);w.format=Xv,w.type=Wv;for(var k=4*_,S=0;S<f;S++)for(var M=m[S],C=g[S],T=y*b*4*S,E=0;E<M.count;E++){o.fromBufferAttribute(M,E),!0===M.normalized&&nb(o,M);var P=E*k;x[T+P+0]=o.x,x[T+P+1]=o.y,x[T+P+2]=o.z,x[T+P+3]=0,!0===v&&(o.fromBufferAttribute(C,E),!0===C.normalized&&nb(o,C),x[T+P+4]=o.x,x[T+P+5]=o.y,x[T+P+6]=o.z,x[T+P+7]=0)}p={count:f,texture:w,size:new Pm(y,b)},a.set(l,p)}for(var A=0,L=0;L<d.length;L++)A+=d[L];var I=l.morphTargetsRelative?1:1-A;h.getUniforms().setValue(e,"morphTargetBaseInfluence",I),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{var R=void 0===d?0:d.length,O=r[l.id];if(void 0===O||O.length!==R){O=[];for(var N=0;N<R;N++)O[N]=[N,0];r[l.id]=O}for(var D=0;D<R;D++){var z=O[D];z[0]=D,z[1]=d[D]}O.sort(tb);for(var j=0;j<8;j++)j<R&&O[j][1]?(s[j][0]=O[j][0],s[j][1]=O[j][1]):(s[j][0]=Number.MAX_SAFE_INTEGER,s[j][1]=0);s.sort(eb);for(var B=l.morphAttributes.position,F=l.morphAttributes.normal,$=0,q=0;q<8;q++){var U=s[q],V=U[0],H=U[1];V!==Number.MAX_SAFE_INTEGER&&H?(B&&l.getAttribute("morphTarget"+q)!==B[V]&&l.setAttribute("morphTarget"+q,B[V]),F&&l.getAttribute("morphNormal"+q)!==F[V]&&l.setAttribute("morphNormal"+q,F[V]),i[q]=H,$+=H):(B&&!0===l.hasAttribute("morphTarget"+q)&&l.deleteAttribute("morphTarget"+q),F&&!0===l.hasAttribute("morphNormal"+q)&&l.deleteAttribute("morphNormal"+q),i[q]=0)}var W=l.morphTargetsRelative?1:1-$;h.getUniforms().setValue(e,"morphTargetBaseInfluence",W),h.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function ib(e,t,n,r){var i=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=r.render.frame,s=e.geometry,u=t.get(e,s);return i.get(u)!==o&&(t.update(u),i.set(u,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),u},dispose:function(){i=new WeakMap}}}Qy.prototype.isDataTexture2DArray=!0;var ab=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Bd(this,n),(e=t.call(this,null)).image={data:r,width:i,height:a,depth:o},e.magFilter=Fv,e.minFilter=Fv,e.wrapR=jv,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return $d(n)}(zm);ab.prototype.isDataTexture3D=!0;var ob=new zm,sb=new Qy,ub=new ab,lb=new ry,cb=[],hb=[],db=new Float32Array(16),fb=new Float32Array(9),pb=new Float32Array(4);function vb(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,a=cb[i];if(void 0===a&&(a=new Float32Array(i),cb[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function mb(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function gb(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function _b(e,t){var n=hb[t];void 0===n&&(n=new Int32Array(t),hb[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function yb(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function bb(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(mb(n,t))return;e.uniform2fv(this.addr,t),gb(n,t)}}function xb(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(mb(n,t))return;e.uniform3fv(this.addr,t),gb(n,t)}}function wb(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(mb(n,t))return;e.uniform4fv(this.addr,t),gb(n,t)}}function kb(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(mb(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),gb(n,t)}else{if(mb(n,r))return;pb.set(r),e.uniformMatrix2fv(this.addr,!1,pb),gb(n,r)}}function Sb(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(mb(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),gb(n,t)}else{if(mb(n,r))return;fb.set(r),e.uniformMatrix3fv(this.addr,!1,fb),gb(n,r)}}function Mb(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(mb(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),gb(n,t)}else{if(mb(n,r))return;db.set(r),e.uniformMatrix4fv(this.addr,!1,db),gb(n,r)}}function Cb(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Tb(e,t){var n=this.cache;mb(n,t)||(e.uniform2iv(this.addr,t),gb(n,t))}function Eb(e,t){var n=this.cache;mb(n,t)||(e.uniform3iv(this.addr,t),gb(n,t))}function Pb(e,t){var n=this.cache;mb(n,t)||(e.uniform4iv(this.addr,t),gb(n,t))}function Ab(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Lb(e,t){var n=this.cache;mb(n,t)||(e.uniform2uiv(this.addr,t),gb(n,t))}function Ib(e,t){var n=this.cache;mb(n,t)||(e.uniform3uiv(this.addr,t),gb(n,t))}function Rb(e,t){var n=this.cache;mb(n,t)||(e.uniform4uiv(this.addr,t),gb(n,t))}function Ob(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||ob,i)}function Nb(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ub,i)}function Db(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||lb,i)}function zb(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||sb,i)}function jb(e,t){e.uniform1fv(this.addr,t)}function Bb(e,t){var n=vb(t,this.size,2);e.uniform2fv(this.addr,n)}function Fb(e,t){var n=vb(t,this.size,3);e.uniform3fv(this.addr,n)}function $b(e,t){var n=vb(t,this.size,4);e.uniform4fv(this.addr,n)}function qb(e,t){var n=vb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ub(e,t){var n=vb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Vb(e,t){var n=vb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Hb(e,t){e.uniform1iv(this.addr,t)}function Wb(e,t){e.uniform2iv(this.addr,t)}function Gb(e,t){e.uniform3iv(this.addr,t)}function Zb(e,t){e.uniform4iv(this.addr,t)}function Yb(e,t){e.uniform1uiv(this.addr,t)}function Xb(e,t){e.uniform2uiv(this.addr,t)}function Kb(e,t){e.uniform3uiv(this.addr,t)}function Jb(e,t){e.uniform4uiv(this.addr,t)}function Qb(e,t,n){var r=t.length,i=_b(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTexture2D(t[a]||ob,i[a])}function ex(e,t,n){var r=t.length,i=_b(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTextureCube(t[a]||lb,i[a])}function tx(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return yb;case 35664:return bb;case 35665:return xb;case 35666:return wb;case 35674:return kb;case 35675:return Sb;case 35676:return Mb;case 5124:case 35670:return Cb;case 35667:case 35671:return Tb;case 35668:case 35672:return Eb;case 35669:case 35673:return Pb;case 5125:return Ab;case 36294:return Lb;case 36295:return Ib;case 36296:return Rb;case 35678:case 36198:case 36298:case 36306:case 35682:return Ob;case 35679:case 36299:case 36307:return Nb;case 35680:case 36300:case 36308:case 36293:return Db;case 36289:case 36303:case 36311:case 36292:return zb}}(t.type)}function nx(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return jb;case 35664:return Bb;case 35665:return Fb;case 35666:return $b;case 35674:return qb;case 35675:return Ub;case 35676:return Vb;case 5124:case 35670:return Hb;case 35667:case 35671:return Wb;case 35668:case 35672:return Gb;case 35669:case 35673:return Zb;case 5125:return Yb;case 36294:return Xb;case 36295:return Kb;case 36296:return Jb;case 35678:case 36198:case 36298:case 36306:case 35682:return Qb;case 35680:case 36300:case 36308:case 36293:return ex}}(t.type)}function rx(e){this.id=e,this.seq=[],this.map={}}nx.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),gb(t,e)},rx.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};var ix=/(\w+)(\])?(\[|\.)?/g;function ax(e,t){e.seq.push(t),e.map[t.id]=t}function ox(e,t,n){var r=e.name,i=r.length;for(ix.lastIndex=0;;){var a=ix.exec(r),o=ix.lastIndex,s=a[1],u="]"===a[2],l=a[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===i){ax(n,void 0===l?new tx(s,e,t):new nx(s,e,t));break}var c=n.map[s];void 0===c&&ax(n,c=new rx(s)),n=c}}function sx(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);ox(i,e.getUniformLocation(t,i.name),this)}}function ux(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}sx.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},sx.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},sx.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},sx.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n};var lx=0;function cx(e){switch(e){case sm:return["Linear","( value )"];case um:return["sRGB","( value )"];case cm:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case lm:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function hx(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function dx(e,t){var n=cx(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function fx(e,t){var n=cx(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function px(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function vx(e){return""!==e}function mx(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function gx(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var _x=/^[ \t]*#include +<([\w\d./]+)>/gm;function yx(e){return e.replace(_x,bx)}function bx(e,t){var n=vy[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return yx(n)}var xx=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,wx=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kx(e){return e.replace(wx,Mx).replace(xx,Sx)}function Sx(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Mx(e,t,n,r)}function Mx(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function Cx(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Tx(e,t,n,r){var i,a,o=e.getContext(),s=n.defines,u=n.vertexShader,l=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Ov:case Nv:t="ENVMAP_TYPE_CUBE";break;case Dv:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Nv:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),p=e.gammaFactor>0?e.gammaFactor:1,v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(vx).join("\n")}(n),m=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),g=o.createProgram(),_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[m].filter(vx).join("\n")).length>0&&(i+="\n"),(a=[v,m].filter(vx).join("\n")).length>0&&(a+="\n")):(i=[Cx(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(vx).join("\n"),a=[v,Cx(n),"#define SHADER_NAME "+n.shaderName,m,"#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?vy.tonemapping_pars_fragment:"",0!==n.toneMapping?px("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===Yv?"#define OPAQUE":"",vy.encodings_pars_fragment,n.map?dx("mapTexelToLinear",n.mapEncoding):"",n.matcap?dx("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?dx("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?dx("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularColorMap?dx("specularColorMapTexelToLinear",n.specularColorMapEncoding):"",n.sheenColorMap?dx("sheenColorMapTexelToLinear",n.sheenColorMapEncoding):"",n.lightMap?dx("lightMapTexelToLinear",n.lightMapEncoding):"",fx("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(vx).join("\n")),u=gx(u=mx(u=yx(u),n),n),l=gx(l=mx(l=yx(l),n),n),u=kx(u),l=kx(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",i=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,a=["#define varying in",n.glslVersion===pm?"":"out highp vec4 pc_fragColor;",n.glslVersion===pm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var y,b,x=_+a+l,w=ux(o,35633,_+i+u),k=ux(o,35632,x);if(o.attachShader(g,w),o.attachShader(g,k),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var S=o.getProgramInfoLog(g).trim(),M=o.getShaderInfoLog(w).trim(),C=o.getShaderInfoLog(k).trim(),T=!0,E=!0;if(!1===o.getProgramParameter(g,35714)){T=!1;var P=hx(o,w,"vertex"),A=hx(o,k,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+S+"\n"+P+"\n"+A)}else""!==S?console.warn("THREE.WebGLProgram: Program Info Log:",S):""!==M&&""!==C||(E=!1);E&&(this.diagnostics={runnable:T,programLog:S,vertexShader:{log:M,prefix:i},fragmentShader:{log:C,prefix:a}})}return o.deleteShader(w),o.deleteShader(k),this.getUniforms=function(){return void 0===y&&(y=new sx(o,g)),y},this.getAttributes=function(){return void 0===b&&(b=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),b},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=lx++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=k,this}function Ex(e,t,n,r,i,a,o){var s=[],u=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,h=i.maxVertexUniforms,d=i.vertexTextures,f=i.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function m(e){var t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=sm,u&&e&&e.isTexture&&e.format===Xv&&e.type===Uv&&e.encoding===um&&(t=sm),t}return{getParameters:function(a,s,v,g,_){var y,b,x=g.fog,w=a.isMeshStandardMaterial?g.environment:null,k=(a.isMeshStandardMaterial?n:t).get(a.envMap||w),S=p[a.type],M=_.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(c)return 1024;var n=h,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(_):0;if(null!==a.precision&&(f=i.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."),S){var C=gy[S];y=C.vertexShader,b=C.fragmentShader}else y=a.vertexShader,b=a.fragmentShader;var T=e.getRenderTarget(),E=a.alphaTest>0,P=a.clearcoat>0;return{isWebGL2:u,shaderID:S,shaderName:a.type,vertexShader:y,fragmentShader:b,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:d,outputEncoding:null!==T?m(T.texture):e.outputEncoding,map:!!a.map,mapEncoding:m(a.map),matcap:!!a.matcap,matcapEncoding:m(a.matcap),envMap:!!k,envMapMode:k&&k.mapping,envMapEncoding:m(k),envMapCubeUV:!!k&&(k.mapping===Dv||307===k.mapping),lightMap:!!a.lightMap,lightMapEncoding:m(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:m(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,clearcoat:P,clearcoatMap:P&&!!a.clearcoatMap,clearcoatRoughnessMap:P&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,specularColorMapEncoding:m(a.specularColorMap),alphaMap:!!a.alphaMap,alphaTest:E,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenColorMapEncoding:m(a.sheenColorMap),sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!_.geometry&&!!_.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.geometry&&!!_.geometry.attributes.color&&4===_.geometry.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||!!a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!x,useFog:a.fog,fogExp2:x&&x.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===_.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:!!_.geometry&&!!_.geometry.morphAttributes.position,morphNormals:!!_.geometry&&!!_.geometry.morphAttributes.normal,morphTargetsCount:_.geometry&&_.geometry.morphAttributes.position?_.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&v.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(Om(t.fragmentShader)),n.push(Om(t.vertexShader))),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);if(!1===t.isRawShaderMaterial){for(var i=0;i<v.length;i++)n.push(t[v[i]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var r=gy[n];t=K_.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,i=0,o=s.length;i<o;i++){var u=s[i];if(u.cacheKey===n){++(r=u).usedTimes;break}}return void 0===r&&(r=new Tx(e,n,t,a),s.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Px(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ax(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Lx(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ix(e){var t=[],n=0,r=[],i=[],a=[],o={id:-1};function s(r,i,a,s,u,l){var c=t[n],h=e.get(a);return void 0===c?(c={id:r.id,object:r,geometry:i,material:a,program:h.program||o,groupOrder:s,renderOrder:r.renderOrder,z:u,group:l},t[n]=c):(c.id=r.id,c.object=r,c.geometry=i,c.material=a,c.program=h.program||o,c.groupOrder=s,c.renderOrder=r.renderOrder,c.z=u,c.group=l),n++,c}return{opaque:r,transmissive:i,transparent:a,init:function(){n=0,r.length=0,i.length=0,a.length=0},push:function(e,t,n,o,u,l){var c=s(e,t,n,o,u,l);n.transmission>0?i.push(c):!0===n.transparent?a.push(c):r.push(c)},unshift:function(e,t,n,o,u,l){var c=s(e,t,n,o,u,l);n.transmission>0?i.unshift(c):!0===n.transparent?a.unshift(c):r.unshift(c)},finish:function(){for(var e=n,r=t.length;e<r;e++){var i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Ax),i.length>1&&i.sort(t||Lx),a.length>1&&a.sort(t||Lx)}}}function Rx(e){var t=new WeakMap;return{get:function(n,r){var i;return!1===t.has(n)?(i=new Ix(e),t.set(n,[i])):r>=t.get(n).length?(i=new Ix(e),t.get(n).push(i)):i=t.get(n)[r],i},dispose:function(){t=new WeakMap}}}function Ox(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Vm,color:new d_};break;case"SpotLight":n={position:new Vm,direction:new Vm,color:new d_,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Vm,color:new d_,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Vm,skyColor:new d_,groundColor:new d_};break;case"RectAreaLight":n={color:new d_,position:new Vm,halfWidth:new Vm,halfHeight:new Vm}}return e[t.id]=n,n}}}var Nx=0;function Dx(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function zx(e,t){for(var n=new Ox,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pm};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pm,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)i.probe.push(new Vm);var o=new Vm,s=new xg,u=new xg;return{setup:function(a,o){for(var s=0,u=0,l=0,c=0;c<9;c++)i.probe[c].set(0,0,0);var h=0,d=0,f=0,p=0,v=0,m=0,g=0,_=0;a.sort(Dx);for(var y=!0!==o?Math.PI:1,b=0,x=a.length;b<x;b++){var w=a[b],k=w.color,S=w.intensity,M=w.distance,C=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)s+=k.r*S*y,u+=k.g*S*y,l+=k.b*S*y;else if(w.isLightProbe)for(var T=0;T<9;T++)i.probe[T].addScaledVector(w.sh.coefficients[T],S);else if(w.isDirectionalLight){var E=n.get(w);if(E.color.copy(w.color).multiplyScalar(w.intensity*y),w.castShadow){var P=w.shadow,A=r.get(w);A.shadowBias=P.bias,A.shadowNormalBias=P.normalBias,A.shadowRadius=P.radius,A.shadowMapSize=P.mapSize,i.directionalShadow[h]=A,i.directionalShadowMap[h]=C,i.directionalShadowMatrix[h]=w.shadow.matrix,m++}i.directional[h]=E,h++}else if(w.isSpotLight){var L=n.get(w);if(L.position.setFromMatrixPosition(w.matrixWorld),L.color.copy(k).multiplyScalar(S*y),L.distance=M,L.coneCos=Math.cos(w.angle),L.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),L.decay=w.decay,w.castShadow){var I=w.shadow,R=r.get(w);R.shadowBias=I.bias,R.shadowNormalBias=I.normalBias,R.shadowRadius=I.radius,R.shadowMapSize=I.mapSize,i.spotShadow[f]=R,i.spotShadowMap[f]=C,i.spotShadowMatrix[f]=w.shadow.matrix,_++}i.spot[f]=L,f++}else if(w.isRectAreaLight){var O=n.get(w);O.color.copy(k).multiplyScalar(S),O.halfWidth.set(.5*w.width,0,0),O.halfHeight.set(0,.5*w.height,0),i.rectArea[p]=O,p++}else if(w.isPointLight){var N=n.get(w);if(N.color.copy(w.color).multiplyScalar(w.intensity*y),N.distance=w.distance,N.decay=w.decay,w.castShadow){var D=w.shadow,z=r.get(w);z.shadowBias=D.bias,z.shadowNormalBias=D.normalBias,z.shadowRadius=D.radius,z.shadowMapSize=D.mapSize,z.shadowCameraNear=D.camera.near,z.shadowCameraFar=D.camera.far,i.pointShadow[d]=z,i.pointShadowMap[d]=C,i.pointShadowMatrix[d]=w.shadow.matrix,g++}i.point[d]=N,d++}else if(w.isHemisphereLight){var j=n.get(w);j.skyColor.copy(w.color).multiplyScalar(S*y),j.groundColor.copy(w.groundColor).multiplyScalar(S*y),i.hemi[v]=j,v++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=my.LTC_FLOAT_1,i.rectAreaLTC2=my.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=my.LTC_HALF_1,i.rectAreaLTC2=my.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=u,i.ambient[2]=l;var B=i.hash;B.directionalLength===h&&B.pointLength===d&&B.spotLength===f&&B.rectAreaLength===p&&B.hemiLength===v&&B.numDirectionalShadows===m&&B.numPointShadows===g&&B.numSpotShadows===_||(i.directional.length=h,i.spot.length=f,i.rectArea.length=p,i.point.length=d,i.hemi.length=v,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=_,B.directionalLength=h,B.pointLength=d,B.spotLength=f,B.rectAreaLength=p,B.hemiLength=v,B.numDirectionalShadows=m,B.numPointShadows=g,B.numSpotShadows=_,i.version=Nx++)},setupView:function(e,t){for(var n=0,r=0,a=0,l=0,c=0,h=t.matrixWorldInverse,d=0,f=e.length;d<f;d++){var p=e[d];if(p.isDirectionalLight){var v=i.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(p.isSpotLight){var m=i.spot[a];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),a++}else if(p.isRectAreaLight){var g=i.rectArea[l];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(p.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),l++}else if(p.isPointLight){var _=i.point[r];_.position.setFromMatrixPosition(p.matrixWorld),_.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var y=i.hemi[c];y.direction.setFromMatrixPosition(p.matrixWorld),y.direction.transformDirection(h),y.direction.normalize(),c++}}},state:i}}function jx(e,t){var n=new zx(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Bx(e,t){var n=new WeakMap;return{get:function(r){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(i=new jx(e,t),n.set(r,[i])):a>=n.get(r).length?(i=new jx(e,t),n.get(r).push(i)):i=n.get(r)[a],i},dispose:function(){n=new WeakMap}}}var Fx=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="MeshDepthMaterial",r.depthPacking=3200,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(a_);Fx.prototype.isMeshDepthMaterial=!0;var $x=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="MeshDistanceMaterial",r.referencePosition=new Vm,r.nearDistance=1,r.farDistance=1e3,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.fog=!1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(a_);$x.prototype.isMeshDistanceMaterial=!0;function qx(e,t,n){var r=new hy,i=new Pm,a=new Pm,o=new Bm,s=new Fx({depthPacking:3201}),u=new $x,l={},c=n.maxTextureSize,h={0:1,1:0,2:2},d=new J_({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pm},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;var p=new E_;p.setAttribute("position",new m_(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new W_(p,d),m=this;function g(n,r){var i=t.update(v);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,d,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,f,v,null)}function _(t,n,r,i,a,o,c){var d=null,f=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d=void 0!==f?f:!0===i.isPointLight?u:s,e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0){var p=d.uuid,v=r.uuid,m=l[p];void 0===m&&(m={},l[p]=m);var g=m[v];void 0===g&&(g=d.clone(),m[v]=g),d=g}return d.visible=r.visible,d.wireframe=r.wireframe,d.side=3===c?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],d.alphaMap=r.alphaMap,d.alphaTest=r.alphaTest,d.clipShadows=r.clipShadows,d.clippingPlanes=r.clippingPlanes,d.clipIntersection=r.clipIntersection,d.displacementMap=r.displacementMap,d.displacementScale=r.displacementScale,d.displacementBias=r.displacementBias,d.wireframeLinewidth=r.wireframeLinewidth,d.linewidth=r.linewidth,!0===i.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(i.matrixWorld),d.nearDistance=a,d.farDistance=o),d}function y(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var u=t.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=l[f.materialIndex];if(p&&p.visible){var v=_(n,0,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,v,n,f)}}else if(l.visible){var m=_(n,0,l,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,m,n,null)}}for(var g=n.children,b=0,x=g.length;b<x;b++)y(g[b],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var v=t[f],_=v.shadow;if(void 0!==_){if(!1!==_.autoUpdate||!1!==_.needsUpdate){i.copy(_.mapSize);var b=_.getFrameExtents();if(i.multiply(b),a.copy(_.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/b.x),i.x=a.x*b.x,_.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/b.y),i.y=a.y*b.y,_.mapSize.y=a.y)),null===_.map&&!_.isPointLightShadow&&3===this.type){var x={minFilter:$v,magFilter:$v,format:Xv};_.map=new Fm(i.x,i.y,x),_.map.texture.name=v.name+".shadowMap",_.mapPass=new Fm(i.x,i.y,x),_.camera.updateProjectionMatrix()}if(null===_.map){var w={minFilter:Fv,magFilter:Fv,format:Xv};_.map=new Fm(i.x,i.y,w),_.map.texture.name=v.name+".shadowMap",_.camera.updateProjectionMatrix()}e.setRenderTarget(_.map),e.clear();for(var k=_.getViewportCount(),S=0;S<k;S++){var M=_.getViewport(S);o.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),d.viewport(o),_.updateMatrices(v,S),r=_.getFrustum(),y(n,s,_.camera,v,this.type)}_.isPointLightShadow||3!==this.type||g(_,s),_.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,l,h)}}}function Ux(e,t,n){var r,i,a=n.isWebGL2;var o=new function(){var t=!1,n=new Bm,r=null,i=new Bm(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?B(2929):F(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},u=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?B(2960):F(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null}}},l={},c=null,h={},d=null,f=!1,p=null,v=null,m=null,g=null,_=null,y=null,b=null,x=!1,w=null,k=null,S=null,M=null,C=null,T=e.getParameter(35661),E=!1,P=0,A=e.getParameter(7938);-1!==A.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(A)[1]),E=P>=1):-1!==A.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),E=P>=2);var L=null,I={},R=e.getParameter(3088),O=e.getParameter(2978),N=(new Bm).fromArray(R),D=(new Bm).fromArray(O);function z(t,n,r){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}var j={};function B(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function F(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}j[3553]=z(3553,3553,1),j[34067]=z(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),B(2929),s.setFunc(3),H(!1),W(1),B(2884),V(0);var $=(Xh(r={},Rv,32774),Xh(r,101,32778),Xh(r,102,32779),r);if(a)$[103]=32775,$[104]=32776;else{var q=t.get("EXT_blend_minmax");null!==q&&($[103]=q.MIN_EXT,$[104]=q.MAX_EXT)}var U=(Xh(i={},200,0),Xh(i,201,1),Xh(i,202,768),Xh(i,204,770),Xh(i,210,776),Xh(i,208,774),Xh(i,206,772),Xh(i,203,769),Xh(i,205,771),Xh(i,209,775),Xh(i,207,773),i);function V(t,n,r,i,a,o,s,u){if(0!==t){if(!1===f&&(B(3042),f=!0),5===t)a=a||n,o=o||r,s=s||i,n===v&&a===_||(e.blendEquationSeparate($[n],$[a]),v=n,_=a),r===m&&i===g&&o===y&&s===b||(e.blendFuncSeparate(U[r],U[i],U[o],U[s]),m=r,g=i,y=o,b=s),p=t,x=null;else if(t!==p||u!==x){if(v===Rv&&_===Rv||(e.blendEquation(32774),v=Rv,_=Rv),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,b=null,p=t,x=u}}else!0===f&&(F(3042),f=!1)}function H(t){w!==t&&(t?e.frontFace(2304):e.frontFace(2305),w=t)}function W(t){0!==t?(B(2884),t!==k&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):F(2884),k=t}function G(t,n,r){t?(B(32823),M===n&&C===r||(e.polygonOffset(n,r),M=n,C=r)):F(32823)}function Z(t){void 0===t&&(t=33984+T-1),L!==t&&(e.activeTexture(t),L=t)}return{buffers:{color:o,depth:s,stencil:u},enable:B,disable:F,bindFramebuffer:function(t,n){return null===n&&null!==c&&(n=c),h[t]!==n&&(e.bindFramebuffer(t,n),h[t]=n,a&&(36009===t&&(h[36160]=n),36160===t&&(h[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==c&&(e.bindFramebuffer(36160,t),c=t)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:V,setMaterial:function(e,t){2===e.side?F(2884):B(2884);var n=1===e.side;t&&(n=!n),H(n),1===e.blending&&!1===e.transparent?V(0):V(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var r=e.stencilWrite;u.setTest(r),r&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),G(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?B(32926):F(32926)},setFlipSided:H,setCullFace:W,setLineWidth:function(t){t!==S&&(E&&e.lineWidth(t),S=t)},setPolygonOffset:G,setScissorTest:function(e){e?B(3089):F(3089)},activeTexture:Z,bindTexture:function(t,n){null===L&&Z();var r=I[L];void 0===r&&(r={type:void 0,texture:void 0},I[L]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||j[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=I[L];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},L=null,I={},c=null,h={},d=null,f=!1,p=null,v=null,m=null,g=null,_=null,y=null,b=null,x=!1,w=null,k=null,S=null,M=null,C=null,N.set(0,0,e.canvas.width,e.canvas.height),D.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function Vx(e,t,n,r,i,a,o){var s,u,l,c=i.isWebGL2,h=i.maxTextures,d=i.maxCubemapSize,f=i.maxTextureSize,p=i.maxSamples,v=new WeakMap,m=!1;try{m="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(CO){}function g(e,t){return m?new OffscreenCanvas(e,t):Rm("canvas")}function _(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Tm:Math.floor,o=a(i*e.width),s=a(i*e.height);void 0===l&&(l=g(o,s));var u=n?g(o,s):l;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return Cm(e.width)&&Cm(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==Fv&&e.minFilter!==$v}function x(t,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.generateMipmap(t);var s=r.get(n);s.__maxMipLevel=Math.log2(Math.max(i,a,o))}function w(n,r,i,a){if(!1===c)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=a===um?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function k(e){return e===Fv||1004===e||1005===e?9728:9729}function S(t){var n=t.target;n.removeEventListener("dispose",S),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&v.delete(n),o.memory.textures--}function M(t){var n=t.target;n.removeEventListener("dispose",M),function(t){var n=t.texture,i=r.get(t),a=r.get(n);if(!t)return;void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(i.__webglFramebuffer[s]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[s]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(var u=0,l=n.length;u<l;u++){var c=r.get(n[u]);c.__webglTexture&&(e.deleteTexture(c.__webglTexture),o.memory.textures--),r.remove(n[u])}r.remove(n),r.remove(t)}(n)}var C=0;function T(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;v.get(e)!==t&&(v.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void R(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function E(t,i){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;I(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);for(var o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,u=[],l=0;l<6;l++)u[l]=o||s?s?r.image[l].image:r.image[l]:_(r.image[l],!1,!0,d);var h,f=u[0],p=y(f)||c,v=a.convert(r.format),m=a.convert(r.type),g=w(r.internalFormat,v,m,r.encoding);if(L(34067,r,p),o){for(var k=0;k<6;k++){h=u[k].mipmaps;for(var S=0;S<h.length;S++){var M=h[S];r.format!==Xv&&r.format!==Yv?null!==v?n.compressedTexImage2D(34069+k,S,g,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+k,S,g,M.width,M.height,0,v,m,M.data)}}t.__maxMipLevel=h.length-1}else{h=r.mipmaps;for(var C=0;C<6;C++)if(s){n.texImage2D(34069+C,0,g,u[C].width,u[C].height,0,v,m,u[C].data);for(var T=0;T<h.length;T++){var E=h[T].image[C].image;n.texImage2D(34069+C,T+1,g,E.width,E.height,0,v,m,E.data)}}else{n.texImage2D(34069+C,0,g,v,m,u[C]);for(var P=0;P<h.length;P++){var A=h[P];n.texImage2D(34069+C,P+1,g,v,m,A.image[C])}}t.__maxMipLevel=h.length}b(r,p)&&x(34067,r,f.width,f.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(o,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))}var P=(Xh(s={},zv,10497),Xh(s,jv,33071),Xh(s,Bv,33648),s),A=(Xh(u={},Fv,9728),Xh(u,1004,9984),Xh(u,1005,9986),Xh(u,$v,9729),Xh(u,1007,9985),Xh(u,qv,9987),u);function L(n,a,o){if(o?(e.texParameteri(n,10242,P[a.wrapS]),e.texParameteri(n,10243,P[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,P[a.wrapR]),e.texParameteri(n,10240,A[a.magFilter]),e.texParameteri(n,10241,A[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===jv&&a.wrapT===jv||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,k(a.magFilter)),e.texParameteri(n,10241,k(a.minFilter)),a.minFilter!==Fv&&a.minFilter!==$v&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.type===Wv&&!1===t.has("OES_texture_float_linear"))return;if(!1===c&&a.type===Gv&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function I(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S),t.__webglTexture=e.createTexture(),o.memory.textures++)}function R(t,r,i){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),I(t,r),n.activeTexture(33984+i),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);var s,u=function(e){return!c&&(e.wrapS!==jv||e.wrapT!==jv||e.minFilter!==Fv&&e.minFilter!==$v)}(r)&&!1===y(r.image),l=_(r.image,u,!1,f),h=y(l)||c,d=a.convert(r.format),p=a.convert(r.type),v=w(r.internalFormat,d,p,r.encoding);L(o,r,h);var m=r.mipmaps;if(r.isDepthTexture)v=6402,c?v=r.type===Wv?36012:r.type===Hv?33190:r.type===Zv?35056:33189:r.type===Wv&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Kv&&6402===v&&r.type!==Vv&&r.type!==Hv&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Vv,p=a.convert(r.type)),r.format===Jv&&6402===v&&(v=34041,r.type!==Zv&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Zv,p=a.convert(r.type))),n.texImage2D(3553,0,v,l.width,l.height,0,d,p,null);else if(r.isDataTexture)if(m.length>0&&h){for(var g=0,k=m.length;g<k;g++)s=m[g],n.texImage2D(3553,g,v,s.width,s.height,0,d,p,s.data);r.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,l.width,l.height,0,d,p,l.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(var S=0,M=m.length;S<M;S++)s=m[S],r.format!==Xv&&r.format!==Yv?null!==d?n.compressedTexImage2D(3553,S,v,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,S,v,s.width,s.height,0,d,p,s.data);t.__maxMipLevel=m.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,v,l.width,l.height,l.depth,0,d,p,l.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,v,l.width,l.height,l.depth,0,d,p,l.data),t.__maxMipLevel=0;else if(m.length>0&&h){for(var C=0,T=m.length;C<T;C++)s=m[C],n.texImage2D(3553,C,v,d,p,s);r.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,d,p,l),t.__maxMipLevel=0;b(r,h)&&x(o,r,l.width,l.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(t,i,o,s,u){var l=a.convert(o.format),c=a.convert(o.type),h=w(o.internalFormat,l,c,o.encoding);32879===u||35866===u?n.texImage3D(u,0,h,i.width,i.height,i.depth,0,l,c,null):n.texImage2D(u,0,h,i.width,i.height,0,l,c,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function N(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===Wv?i=36012:o.type===Hv&&(i=33190));var s=z(n);e.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){var u=z(n);e.renderbufferStorageMultisample(36161,u,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var l=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,c=a.convert(l.format),h=a.convert(l.type),d=w(l.internalFormat,c,h,l.encoding);if(r){var f=z(n);e.renderbufferStorageMultisample(36161,f,d,n.width,n.height)}else e.renderbufferStorage(36161,d,n.width,n.height)}e.bindRenderbuffer(36161,null)}function D(t){var i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);var a=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Kv)e.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==Jv)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),N(i.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),N(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function z(e){return c&&e.isWebGLMultisampleRenderTarget?Math.min(p,e.samples):0}var j=!1,B=!1;this.allocateTextureUnit=function(){var e=C;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?R(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?R(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){var s=t.texture,u=r.get(t),l=r.get(s);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(l.__webglTexture=e.createTexture(),l.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=!0===t.isWebGLMultisampleRenderTarget,p=s.isDataTexture3D||s.isDataTexture2DArray,v=y(t)||c;if(!c||s.format!==Yv||s.type!==Wv&&s.type!==Gv||(s.format=Xv,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){u.__webglFramebuffer=[];for(var m=0;m<6;m++)u.__webglFramebuffer[m]=e.createFramebuffer()}else if(u.__webglFramebuffer=e.createFramebuffer(),d)if(i.drawBuffers)for(var g=t.texture,_=0,k=g.length;_<k;_++){var S=r.get(g[_]);void 0===S.__webglTexture&&(S.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(f)if(c){u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer);var C=a.convert(s.format),T=a.convert(s.type),E=w(s.internalFormat,C,T,s.encoding),P=z(t);e.renderbufferStorageMultisample(36161,P,E,t.width,t.height),n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,u.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),N(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,l.__webglTexture),L(34067,s,v);for(var A=0;A<6;A++)O(u.__webglFramebuffer[A],t,s,36064,34069+A);b(s,v)&&x(34067,s,t.width,t.height),n.unbindTexture()}else if(d){for(var I=t.texture,R=0,j=I.length;R<j;R++){var B=I[R],F=r.get(B);n.bindTexture(3553,F.__webglTexture),L(3553,B,v),O(u.__webglFramebuffer,t,B,36064+R,3553),b(B,v)&&x(3553,B,t.width,t.height)}n.unbindTexture()}else{var $=3553;if(p)if(c)$=s.isDataTexture3D?32879:35866;else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture($,l.__webglTexture),L($,s,v),O(u.__webglFramebuffer,t,s,36064,$),b(s,v)&&x($,s,t.width,t.height,t.depth),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){for(var t=y(e)||c,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=i.length;a<o;a++){var s=i[a];if(b(s,t)){var u=e.isWebGLCubeRenderTarget?34067:3553,l=r.get(s).__webglTexture;n.bindTexture(u,l),x(u,s,e.width,e.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(c){var i=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);var s=r.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===j&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),j=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),E(e,t)}}function Hx(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===Uv)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===Vv)return 5123;if(1013===e)return 5124;if(e===Hv)return 5125;if(e===Wv)return 5126;if(e===Gv)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(e===Yv)return 6407;if(e===Xv)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===Kv)return 6402;if(e===Jv)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:e===Zv?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}var Wx=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Bd(this,n),(e=t.call(this)).cameras=r,e}return $d(n)}(ey);Wx.prototype.isArrayCamera=!0;var Gx=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this)).type="Group",e}return $d(n)}(Wg);Gx.prototype.isGroup=!0;var Zx={type:"move"},Yx=function(){function e(){Bd(this,e),this._targetRay=null,this._grip=null,this._hand=null}return $d(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new Gx,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new Gx,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vm,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vm),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new Gx,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vm,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vm),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,i=null,a=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&null!==(r=t.getPose(e.targetRaySpace,n))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Zx)),u&&e.hand){a=!0;var l,c=Ad(e.hand.values());try{for(c.s();!(l=c.n()).done;){var h=l.value,d=t.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var f=new Gx;f.matrixAutoUpdate=!1,f.visible=!1,u.joints[h.jointName]=f,u.add(f)}var p=u.joints[h.jointName];null!==d&&(p.matrix.fromArray(d.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=d.radius),p.visible=null!==d}}catch(CO){c.e(CO)}finally{c.f()}var v=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],g=v.position.distanceTo(m.position);u.inputState.pinching&&g>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&g<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(i=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1);return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==a),this}}]),e}(),Xx=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;Bd(this,n);var a=Id(i=t.call(this)),o=e.state,s=null,u=1,l=null,c="local-floor",h=null,d=null,f=null,p=null,v=null,m=!1,g=null,_=null,y=null,b=null,x=null,w=null,k=[],S=new Map,M=new ey;M.layers.enable(1),M.viewport=new Bm;var C=new ey;C.layers.enable(2),C.viewport=new Bm;var T=[M,C],E=new Wx;E.layers.enable(1),E.layers.enable(2);var P=null,A=null;function L(e){var t=S.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function I(){S.forEach((function(e,t){e.disconnect(t)})),S.clear(),P=null,A=null,o.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),f&&r.deleteFramebuffer(f),g&&r.deleteFramebuffer(g),_&&r.deleteRenderbuffer(_),y&&r.deleteRenderbuffer(y),f=null,g=null,_=null,y=null,v=null,p=null,d=null,s=null,j.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function R(e){for(var t=s.inputSources,n=0;n<k.length;n++)S.set(t[n],k[n]);for(var r=0;r<e.removed.length;r++){var i=e.removed[r],a=S.get(i);a&&(a.dispatchEvent({type:"disconnected",data:i}),S.delete(i))}for(var o=0;o<e.added.length;o++){var u=e.added[o],l=S.get(u);l&&l.dispatchEvent({type:"connected",data:u})}}i.cameraAutoUpdate=!0,i.enabled=!1,i.isPresenting=!1,i.getController=function(e){var t=k[e];return void 0===t&&(t=new Yx,k[e]=t),t.getTargetRaySpace()},i.getControllerGrip=function(e){var t=k[e];return void 0===t&&(t=new Yx,k[e]=t),t.getGripSpace()},i.getHand=function(e){var t=k[e];return void 0===t&&(t=new Yx,k[e]=t),t.getHandSpace()},i.setFramebufferScaleFactor=function(e){u=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},i.setReferenceSpaceType=function(e){c=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},i.getReferenceSpace=function(){return l},i.getBaseLayer=function(){return null!==p?p:v},i.getBinding=function(){return d},i.getFrame=function(){return b},i.getSession=function(){return s},i.setSession=function(){var e=(0,Pd.Z)(jd().mark((function e(t){var n,i,h,b,k;return jd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(s=t)){e.next=22;break}if(s.addEventListener("select",L),s.addEventListener("selectstart",L),s.addEventListener("selectend",L),s.addEventListener("squeeze",L),s.addEventListener("squeezestart",L),s.addEventListener("squeezeend",L),s.addEventListener("end",I),s.addEventListener("inputsourceschange",R),!0===(n=r.getContextAttributes()).xrCompatible){e.next=14;break}return e.next=14,r.makeXRCompatible();case 14:return void 0===s.renderState.layers?(i={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u},v=new XRWebGLLayer(s,r,i),s.updateRenderState({baseLayer:v})):r instanceof WebGLRenderingContext?(h={antialias:!0,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u},v=new XRWebGLLayer(s,r,h),s.updateRenderState({layers:[v]})):(m=n.antialias,b=null,n.depth&&(w=256,n.stencil&&(w|=1024),x=n.stencil?33306:36096,b=n.stencil?35056:33190),k={colorFormat:n.alpha?32856:32849,depthFormat:b,scaleFactor:u},d=new XRWebGLBinding(s,r),p=d.createProjectionLayer(k),f=r.createFramebuffer(),s.updateRenderState({layers:[p]}),m&&(g=r.createFramebuffer(),_=r.createRenderbuffer(),r.bindRenderbuffer(36161,_),r.renderbufferStorageMultisample(36161,4,32856,p.textureWidth,p.textureHeight),o.bindFramebuffer(36160,g),r.framebufferRenderbuffer(36160,36064,36161,_),r.bindRenderbuffer(36161,null),null!==b&&(y=r.createRenderbuffer(),r.bindRenderbuffer(36161,y),r.renderbufferStorageMultisample(36161,4,b,p.textureWidth,p.textureHeight),r.framebufferRenderbuffer(36160,x,36161,y),r.bindRenderbuffer(36161,null)),o.bindFramebuffer(36160,null))),e.next=17,s.requestReferenceSpace(c);case 17:l=e.sent,j.setContext(s),j.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var O=new Vm,N=new Vm;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}i.updateCamera=function(e){if(null!==s){E.near=C.near=M.near=e.near,E.far=C.far=M.far=e.far,P===E.near&&A===E.far||(s.updateRenderState({depthNear:E.near,depthFar:E.far}),P=E.near,A=E.far);var t=e.parent,n=E.cameras;D(E,t);for(var r=0;r<n.length;r++)D(n[r],t);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),e.position.copy(E.position),e.quaternion.copy(E.quaternion),e.scale.copy(E.scale),e.matrix.copy(E.matrix),e.matrixWorld.copy(E.matrixWorld);for(var i=e.children,a=0,o=i.length;a<o;a++)i[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){O.setFromMatrixPosition(t.matrixWorld),N.setFromMatrixPosition(n.matrixWorld);var r=O.distanceTo(N),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,f=o*h,p=r/(-c+h),v=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=s+p,_=d-v,y=f+(r-v),b=u*s/g*m,x=l*s/g*m;e.projectionMatrix.makePerspective(_,y,b,x,m,g)}(E,M,C):E.projectionMatrix.copy(M.projectionMatrix)}},i.getCamera=function(){return E},i.getFoveation=function(){return null!==p?p.fixedFoveation:null!==v?v.fixedFoveation:void 0},i.setFoveation=function(e){null!==p&&(p.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)};var z=null;var j=new dy;return j.setAnimationLoop((function(e,t){if(h=t.getViewerPose(l),b=t,null!==h){var n=h.views;null!==v&&o.bindXRFramebuffer(v.framebuffer);var i=!1;n.length!==E.cameras.length&&(E.cameras.length=0,i=!0);for(var a=0;a<n.length;a++){var u=n[a],c=null;if(null!==v)c=v.getViewport(u);else{var _=d.getViewSubImage(p,u);o.bindXRFramebuffer(f),void 0!==_.depthStencilTexture&&r.framebufferTexture2D(36160,x,3553,_.depthStencilTexture,0),r.framebufferTexture2D(36160,36064,3553,_.colorTexture,0),c=_.viewport}var y=T[a];y.matrix.fromArray(u.transform.matrix),y.projectionMatrix.fromArray(u.projectionMatrix),y.viewport.set(c.x,c.y,c.width,c.height),0===a&&E.matrix.copy(y.matrix),!0===i&&E.cameras.push(y)}m&&(o.bindXRFramebuffer(g),null!==w&&r.clear(w))}for(var S=s.inputSources,M=0;M<k.length;M++){var C=k[M],P=S[M];C.update(P,t,l)}if(z&&z(e,t),m){var A=p.textureWidth,L=p.textureHeight;o.bindFramebuffer(36008,g),o.bindFramebuffer(36009,f),r.invalidateFramebuffer(36008,[x]),r.invalidateFramebuffer(36009,[x]),r.blitFramebuffer(0,0,A,L,0,0,A,L,16384,9728),r.invalidateFramebuffer(36008,[36064]),o.bindFramebuffer(36008,null),o.bindFramebuffer(36009,null),o.bindFramebuffer(36160,g)}b=null})),i.setAnimationLoop=function(e){z=e},i.dispose=function(){},i}return $d(n)}(vm);function Kx(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);var r,i,a=e.get(n).envMap;if(a){t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio;var o=e.get(a).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?i=n.aoMap:n.lightMap&&(i=n.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uv2Transform.value.copy(i.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,a,o){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Jx(){var e=Rm("canvas");return e.style.display="block",e}function Qx(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=void 0!==e.canvas?e.canvas:Jx(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,d=null,f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=sm,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;var v=this,m=!1,g=0,_=0,y=null,b=-1,x=null,w=new Bm,k=new Bm,S=null,M=t.width,C=t.height,T=1,E=null,P=null,A=new Bm(0,0,M,C),L=new Bm(0,0,M,C),I=!1,R=[],O=new hy,N=!1,D=!1,z=null,j=new xg,B=new Vm,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return null===y?T:1}var q,U,V,H,W,G,Z,Y,X,K,J,Q,ee,te,ne,re,ie,ae,oe,se,ue,le,ce,he=n;function de(e,n){for(var r=0;r<e.length;r++){var i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{var fe={alpha:r,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",_e,!1),null===he){var pe=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&pe.shift(),null===(he=de(pe,fe)))throw de(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ze){throw console.error("THREE.WebGLRenderer: "+ze.message),ze}function ve(){q=new Yy(he),U=new xy(he,q,e),q.init(U),le=new Hx(he,q,U),V=new Ux(he,q,U),R[0]=1029,H=new Jy(he),W=new Px,G=new Vx(he,q,V,W,U,le,H),Z=new ky(v),Y=new Zy(v),X=new fy(he,U),ce=new yy(he,q,X,U),K=new Xy(he,X,H,ce),J=new ib(he,K,X,H),oe=new rb(he,U,G),re=new wy(W),Q=new Ex(v,Z,Y,q,U,ce,re),ee=new Kx(W),te=new Rx(W),ne=new Bx(q,U),ae=new _y(v,Z,V,J,s),ie=new qx(v,J,U),se=new by(he,q,H,U),ue=new Ky(he,q,H,U),H.programs=Q.programs,v.capabilities=U,v.extensions=q,v.properties=W,v.renderLists=te,v.shadowMap=ie,v.state=V,v.info=H}ve();var me=new Xx(v,he);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;var e=H.autoReset,t=ie.enabled,n=ie.autoUpdate,r=ie.needsUpdate,i=ie.type;ve(),H.autoReset=e,ie.enabled=t,ie.autoUpdate=n,ie.needsUpdate=r,ie.type=i}function ye(e){var t=e.target;t.removeEventListener("dispose",ye),be(t)}function be(e){xe(e),W.remove(e)}function xe(e){var t=W.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))}this.xr=me,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){var e=q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(e){void 0!==e&&(T=e,this.setSize(M,C,!1))},this.getSize=function(e){return e.set(M,C)},this.setSize=function(e,n,r){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,C=n,t.width=Math.floor(e*T),t.height=Math.floor(n*T),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(M*T,C*T).floor()},this.setDrawingBufferSize=function(e,n,r){M=e,C=n,T=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(A)},this.setViewport=function(e,t,n,r){e.isVector4?A.set(e.x,e.y,e.z,e.w):A.set(e,t,n,r),V.viewport(w.copy(A).multiplyScalar(T).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,r){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,r),V.scissor(k.copy(L).multiplyScalar(T).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(e){V.setScissorTest(I=e)},this.setOpaqueSort=function(e){E=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),he.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",_e,!1),te.dispose(),ne.dispose(),W.dispose(),Z.dispose(),Y.dispose(),J.dispose(),ce.dispose(),me.dispose(),me.removeEventListener("sessionstart",Se),me.removeEventListener("sessionend",Me),z&&(z.dispose(),z=null),Ce.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=F);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=Oe(e,t,n,r,i);V.setMaterial(r,o);var u=n.index,l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;var c,h=1;!0===r.wireframe&&(u=K.getWireframeAttribute(n),h=2),ce.setup(i,r,s,n,u);var d=se;null!==u&&(c=X.get(u),(d=ue).setIndex(c));var f=null!==u?u.count:l.count,p=n.drawRange.start*h,v=n.drawRange.count*h,m=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,_=Math.max(p,m),y=Math.min(f,p+v,m+g)-1,b=Math.max(0,y-_+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(V.setLineWidth(r.wireframeLinewidth*$()),d.setMode(1)):d.setMode(4);else if(i.isLine){var x=r.linewidth;void 0===x&&(x=1),V.setLineWidth(x*$()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(_,b,i.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(_,b,w)}else d.render(_,b)}},this.compile=function(e,t){(d=ne.get(e)).init(),p.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(v.physicallyCorrectLights),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){Ie(n[r],e,t)}else Ie(n,e,t)})),p.pop(),d=null};var we=null;function ke(e){we&&we(e)}function Se(){Ce.stop()}function Me(){Ce.start()}var Ce=new dy;function Te(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){r&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);var i=J.update(e),a=e.material;a.visible&&h.push(e,i,a,n,B.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==H.render.frame&&(e.skeleton.update(),e.skeleton.frame=H.render.frame),!e.frustumCulled||O.intersectsObject(e))){r&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);var o=J.update(e),s=e.material;if(Array.isArray(s))for(var u=o.groups,l=0,c=u.length;l<c;l++){var f=u[l],p=s[f.materialIndex];p&&p.visible&&h.push(e,o,p,n,B.z,f)}else s.visible&&h.push(e,o,s,n,B.z,null)}for(var v=e.children,m=0,g=v.length;m<g;m++)Te(v[m],t,n,r)}}function Ee(e,t,n,r){var i=e.opaque,a=e.transmissive,o=e.transparent;d.setupLightsView(n),a.length>0&&Pe(i,t,n),r&&V.viewport(w.copy(r)),i.length>0&&Ae(i,t,n),a.length>0&&Ae(a,t,n),o.length>0&&Ae(o,t,n)}function Pe(e,t,n){if(null===z){var r=!0===o&&!0===U.isWebGL2;z=new(r?qm:Fm)(1024,1024,{generateMipmaps:!0,type:null!==le.convert(Gv)?Gv:Uv,minFilter:qv,magFilter:Fv,wrapS:jv,wrapT:jv})}var i=v.getRenderTarget();v.setRenderTarget(z),v.clear();var a=v.toneMapping;v.toneMapping=0,Ae(e,t,n),v.toneMapping=a,G.updateMultisampleRenderTarget(z),G.updateRenderTargetMipmap(z),v.setRenderTarget(i)}function Ae(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,u=o.geometry,l=null===r?o.material:r,c=o.group;s.layers.test(n.layers)&&Le(s,t,n,u,l,c)}}function Le(e,t,n,r,i,a){e.onBeforeRender(v,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(v,t,n,r,e,a),!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=2):v.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(v,t,n,r,i,a)}function Ie(e,t,n){!0!==t.isScene&&(t=F);var r=W.get(e),i=d.state.lights,a=d.state.shadowsArray,o=i.state.version,s=Q.getParameters(e,i.state,a,t,n),u=Q.getProgramCacheKey(s),l=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?Y:Z).get(e.envMap||r.environment),void 0===l&&(e.addEventListener("dispose",ye),l=new Map,r.programs=l);var c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===o)return Re(e,s),c}else s.uniforms=Q.getUniforms(e),e.onBuild(n,s,v),e.onBeforeCompile(s,v),c=Q.acquireProgram(s,u),l.set(u,c),r.uniforms=s.uniforms;var h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=re.uniform),Re(e,s),r.needsLights=De(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);var f=c.getUniforms(),p=sx.seqWithValue(f.seq,h);return r.currentProgram=c,r.uniformsList=p,c}function Re(e,t){var n=W.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}function Oe(e,t,n,r,i){!0!==t.isScene&&(t=F),G.resetTextureUnits();var a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===y?v.outputEncoding:y.texture.encoding,u=(r.isMeshStandardMaterial?Y:Z).get(r.envMap||o),l=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,p=n.morphAttributes.position?n.morphAttributes.position.length:0,m=W.get(r),g=d.state.lights;if(!0===N&&(!0===D||e!==x)){var _=e===x&&r.id===b;re.setState(r,e,_)}var w=!1;r.version===m.__version?m.needsLights&&m.lightsStateVersion!==g.state.version||m.outputEncoding!==s||i.isInstancedMesh&&!1===m.instancing?w=!0:i.isInstancedMesh||!0!==m.instancing?i.isSkinnedMesh&&!1===m.skinning?w=!0:i.isSkinnedMesh||!0!==m.skinning?m.envMap!==u||r.fog&&m.fog!==a?w=!0:void 0===m.numClippingPlanes||m.numClippingPlanes===re.numPlanes&&m.numIntersection===re.numIntersection?(m.vertexAlphas!==l||m.vertexTangents!==c||m.morphTargets!==h||m.morphNormals!==f||!0===U.isWebGL2&&m.morphTargetsCount!==p)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,m.__version=r.version);var k=m.currentProgram;!0===w&&(k=Ie(r,t,i));var S=!1,M=!1,E=!1,P=k.getUniforms(),A=m.uniforms;if(V.useProgram(k.program)&&(S=!0,M=!0,E=!0),r.id!==b&&(b=r.id,M=!0),S||x!==e){if(P.setValue(he,"projectionMatrix",e.projectionMatrix),U.logarithmicDepthBuffer&&P.setValue(he,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),x!==e&&(x=e,M=!0,E=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var L=P.map.cameraPosition;void 0!==L&&L.setValue(he,B.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&P.setValue(he,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&P.setValue(he,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){P.setOptional(he,i,"bindMatrix"),P.setOptional(he,i,"bindMatrixInverse");var I=i.skeleton;I&&(U.floatVertexTextures?(null===I.boneTexture&&I.computeBoneTexture(),P.setValue(he,"boneTexture",I.boneTexture,G),P.setValue(he,"boneTextureSize",I.boneTextureSize)):P.setOptional(he,I,"boneMatrices"))}return!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||oe.update(i,n,r,k),(M||m.receiveShadow!==i.receiveShadow)&&(m.receiveShadow=i.receiveShadow,P.setValue(he,"receiveShadow",i.receiveShadow)),M&&(P.setValue(he,"toneMappingExposure",v.toneMappingExposure),m.needsLights&&Ne(A,E),a&&r.fog&&ee.refreshFogUniforms(A,a),ee.refreshMaterialUniforms(A,r,T,C,z),sx.upload(he,m.uniformsList,A,G)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(sx.upload(he,m.uniformsList,A,G),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&P.setValue(he,"center",i.center),P.setValue(he,"modelViewMatrix",i.modelViewMatrix),P.setValue(he,"normalMatrix",i.normalMatrix),P.setValue(he,"modelMatrix",i.matrixWorld),k}function Ne(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function De(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Ce.setAnimationLoop(ke),"undefined"!==typeof window&&Ce.setContext(window),this.setAnimationLoop=function(e){we=e,me.setAnimationLoop(e),null===e?Ce.stop():Ce.start()},me.addEventListener("sessionstart",Se),me.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==m){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,y),(d=ne.get(e,p.length)).init(),p.push(d),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(j),D=this.localClippingEnabled,N=re.init(this.clippingPlanes,D,t),(h=te.get(e,f.length)).init(),f.push(h),Te(e,t,0,v.sortObjects),h.finish(),!0===v.sortObjects&&h.sort(E,P),!0===N&&re.beginShadows();var n=d.state.shadowsArray;if(ie.render(n,e,t),!0===N&&re.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(h,e),d.setupLights(v.physicallyCorrectLights),t.isArrayCamera)for(var r=t.cameras,i=0,a=r.length;i<a;i++){var o=r[i];Ee(h,e,o,o.viewport)}else Ee(h,e,t);null!==y&&(G.updateMultisampleRenderTarget(y),G.updateRenderTargetMipmap(y)),!0===e.isScene&&e.onAfterRender(v,e,t),V.buffers.depth.setTest(!0),V.buffers.depth.setMask(!0),V.buffers.color.setMask(!0),V.setPolygonOffset(!1),ce.resetDefaultState(),b=-1,x=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),h=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return y},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y=e,g=t,_=n,e&&void 0===W.get(e).__webglFramebuffer&&G.setupRenderTarget(e);var r=null,i=!1,a=!1;if(e){var o=e.texture;(o.isDataTexture3D||o.isDataTexture2DArray)&&(a=!0);var s=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=s[t],i=!0):r=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:s,w.copy(e.viewport),k.copy(e.scissor),S=e.scissorTest}else w.copy(A).multiplyScalar(T).floor(),k.copy(L).multiplyScalar(T).floor(),S=I;var u=V.bindFramebuffer(36160,r);if(u&&U.drawBuffers){var l=!1;if(e)if(e.isWebGLMultipleRenderTargets){var c=e.texture;if(R.length!==c.length||36064!==R[0]){for(var h=0,d=c.length;h<d;h++)R[h]=36064+h;R.length=c.length,l=!0}}else 1===R.length&&36064===R[0]||(R[0]=36064,R.length=1,l=!0);else 1===R.length&&1029===R[0]||(R[0]=1029,R.length=1,l=!0);l&&(U.isWebGL2?he.drawBuffers(R):q.get("WEBGL_draw_buffers").drawBuffersWEBGL(R))}if(V.viewport(w),V.scissor(k),V.setScissorTest(S),i){var f=W.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,f.__webglTexture,n)}else if(a){var p=W.get(e.texture),v=t||0;he.framebufferTextureLayer(36160,36064,p.__webglTexture,n||0,v)}b=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){V.bindFramebuffer(36160,s);try{var u=e.texture,l=u.format,c=u.type;if(l!==Xv&&le.convert(l)!==he.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=c===Gv&&(q.has("EXT_color_buffer_half_float")||U.isWebGL2&&q.has("EXT_color_buffer_float"));if(c!==Uv&&le.convert(c)!==he.getParameter(35738)&&(c!==Wv||!(U.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===he.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&he.readPixels(t,n,r,i,le.convert(l),le.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{var d=null!==y?W.get(y).__webglFramebuffer:null;V.bindFramebuffer(36160,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r),o=le.convert(t.format);U.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),G.setTexture2D(t,0),he.copyTexImage2D(3553,n,o,e.x,e.y,i,a,0),V.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.image.width,a=t.image.height,o=le.convert(n.format),s=le.convert(n.type);G.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):he.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&he.generateMipmap(3553),V.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,l=le.convert(r.format),c=le.convert(r.type);if(r.isDataTexture3D)G.setTexture3D(r,0),a=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");G.setTexture2DArray(r,0),a=35866}he.pixelStorei(37440,r.flipY),he.pixelStorei(37441,r.premultiplyAlpha),he.pixelStorei(3317,r.unpackAlignment);var h=he.getParameter(3314),d=he.getParameter(32878),f=he.getParameter(3316),p=he.getParameter(3315),m=he.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;he.pixelStorei(3314,g.width),he.pixelStorei(32878,g.height),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?he.texSubImage3D(a,i,t.x,t.y,t.z,o,s,u,l,c,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),he.compressedTexSubImage3D(a,i,t.x,t.y,t.z,o,s,u,l,g.data)):he.texSubImage3D(a,i,t.x,t.y,t.z,o,s,u,l,c,g),he.pixelStorei(3314,h),he.pixelStorei(32878,d),he.pixelStorei(3316,f),he.pixelStorei(3315,p),he.pixelStorei(32877,m),0===i&&r.generateMipmaps&&he.generateMipmap(a),V.unbindTexture()}},this.initTexture=function(e){G.setTexture2D(e,0),V.unbindTexture()},this.resetState=function(){g=0,_=0,y=null,V.reset(),ce.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Qx.prototype.isWebGLRenderer=!0;var ew=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n)}(Qx);ew.prototype.isWebGL1Renderer=!0;var tw=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this)).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Id(e)})),e}return $d(n,[{key:"copy",value:function(e,t){return Nd(wd(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(Wg);tw.prototype.isScene=!0;var nw=function(){function e(t,n){Bd(this,e),this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=dm,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=wm()}return $d(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wm()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wm()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}();nw.prototype.isInterleavedBuffer=!0;var rw=new Vm,iw=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Bd(this,e),this.name="",this.data=t,this.itemSize=n,this.offset=r,this.normalized=!0===i}return $d(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)rw.x=this.getX(t),rw.y=this.getY(t),rw.z=this.getZ(t),rw.applyMatrix4(e),this.setXYZ(t,rw.x,rw.y,rw.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)rw.x=this.getX(t),rw.y=this.getY(t),rw.z=this.getZ(t),rw.applyNormalMatrix(e),this.setXYZ(t,rw.x,rw.y,rw.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)rw.x=this.getX(t),rw.y=this.getY(t),rw.z=this.getZ(t),rw.transformDirection(e),this.setXYZ(t,rw.x,rw.y,rw.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var i=r*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[i+a]);return new m_(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}();iw.prototype.isInterleavedBufferAttribute=!0;var aw,ow=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="SpriteMaterial",r.color=new d_(16777215),r.map=null,r.alphaMap=null,r.rotation=0,r.sizeAttenuation=!0,r.transparent=!0,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(a_);ow.prototype.isSpriteMaterial=!0;var sw=new Vm,uw=new Vm,lw=new Vm,cw=new Pm,hw=new Pm,dw=new xg,fw=new Vm,pw=new Vm,vw=new Vm,mw=new Pm,gw=new Pm,_w=new Pm,yw=function(e){Dd(n,e);var t=zd(n);function n(e){var r;if(Bd(this,n),(r=t.call(this)).type="Sprite",void 0===aw){aw=new E_;var i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new nw(i,5);aw.setIndex([0,1,2,0,2,3]),aw.setAttribute("position",new iw(a,3,0,!1)),aw.setAttribute("uv",new iw(a,2,3,!1))}return r.geometry=aw,r.material=void 0!==e?e:new ow,r.center=new Pm(.5,.5),r}return $d(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),uw.setFromMatrixScale(this.matrixWorld),dw.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),lw.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&uw.multiplyScalar(-lw.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var a=this.center;bw(fw.set(-.5,-.5,0),lw,a,uw,n,r),bw(pw.set(.5,-.5,0),lw,a,uw,n,r),bw(vw.set(.5,.5,0),lw,a,uw,n,r),mw.set(0,0),gw.set(1,0),_w.set(1,1);var o=e.ray.intersectTriangle(fw,pw,vw,!1,sw);if(null!==o||(bw(pw.set(-.5,.5,0),lw,a,uw,n,r),gw.set(0,1),null!==(o=e.ray.intersectTriangle(fw,vw,pw,!1,sw)))){var s=e.ray.origin.distanceTo(sw);s<e.near||s>e.far||t.push({distance:s,point:sw.clone(),uv:r_.getUV(sw,fw,pw,vw,mw,gw,_w,new Pm),face:null,object:this})}}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(Wg);function bw(e,t,n,r,i,a){cw.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(hw.x=a*cw.x-i*cw.y,hw.y=i*cw.x+a*cw.y):hw.copy(cw),e.copy(t),e.x+=hw.x,e.y+=hw.y,e.applyMatrix4(dw)}yw.prototype.isSprite=!0;var xw=new Vm,ww=new Bm,kw=new Bm,Sw=new Vm,Mw=new xg,Cw=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r)).type="SkinnedMesh",i.bindMode="attached",i.bindMatrix=new xg,i.bindMatrixInverse=new xg,i}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Bm,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){Nd(wd(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,r=this.geometry;ww.fromBufferAttribute(r.attributes.skinIndex,e),kw.fromBufferAttribute(r.attributes.skinWeight,e),xw.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var i=0;i<4;i++){var a=kw.getComponent(i);if(0!==a){var o=ww.getComponent(i);Mw.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(Sw.copy(xw).applyMatrix4(Mw),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(W_);Cw.prototype.isSkinnedMesh=!0,function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this)).type="Bone",e}return $d(n)}(Wg).prototype.isBone=!0;var Tw=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Fv,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Fv,f=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;return Bd(this,n),(e=t.call(this,null,u,l,c,h,d,o,s,f,p)).image={data:r,width:i,height:a},e.magFilter=h,e.minFilter=d,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return $d(n)}(zm);Tw.prototype.isDataTexture=!0;var Ew=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Bd(this,n),"number"===typeof i&&(o=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(a=t.call(this,e,r,i)).meshPerAttribute=o,a}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(m_);Ew.prototype.isInstancedBufferAttribute=!0;var Pw=new xg,Aw=new xg,Lw=[],Iw=new W_,Rw=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r)).instanceMatrix=new Ew(new Float32Array(16*i),16),a.instanceColor=null,a.count=i,a.frustumCulled=!1,a}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,r=this.count;if(Iw.geometry=this.geometry,Iw.material=this.material,void 0!==Iw.material)for(var i=0;i<r;i++){this.getMatrixAt(i,Pw),Aw.multiplyMatrices(n,Pw),Iw.matrixWorld=Aw,Iw.raycast(e,Lw);for(var a=0,o=Lw.length;a<o;a++){var s=Lw[a];s.instanceId=i,s.object=this,t.push(s)}Lw.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new Ew(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(W_);Rw.prototype.isInstancedMesh=!0;var Ow=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="LineBasicMaterial",r.color=new d_(16777215),r.linewidth=1,r.linecap="round",r.linejoin="round",r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}]),n}(a_);Ow.prototype.isLineBasicMaterial=!0;var Nw=new Vm,Dw=new Vm,zw=new xg,jw=new bg,Bw=new dg,Fw=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E_,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ow;return Bd(this,n),(e=t.call(this)).type="Line",e.geometry=r,e.material=i,e.updateMorphTargets(),e}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)Nw.fromBufferAttribute(t,r-1),Dw.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Nw.distanceTo(Dw);e.setAttribute("lineDistance",new b_(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Bw.copy(n.boundingSphere),Bw.applyMatrix4(r),Bw.radius+=i,!1!==e.ray.intersectsSphere(Bw)){zw.copy(r).invert(),jw.copy(e.ray).applyMatrix4(zw);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new Vm,l=new Vm,c=new Vm,h=new Vm,d=this.isLineSegments?2:1;if(n.isBufferGeometry){var f=n.index,p=n.attributes.position;if(null!==f)for(var v=Math.max(0,a.start),m=Math.min(f.count,a.start+a.count)-1;v<m;v+=d){var g=f.getX(v),_=f.getX(v+1);if(u.fromBufferAttribute(p,g),l.fromBufferAttribute(p,_),!(jw.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(h);y<e.near||y>e.far||t.push({distance:y,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var b=Math.max(0,a.start),x=Math.min(p.count,a.start+a.count)-1;b<x;b+=d){if(u.fromBufferAttribute(p,b),l.fromBufferAttribute(p,b+1),!(jw.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(Wg);Fw.prototype.isLine=!0;var $w=new Vm,qw=new Vm,Uw=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r)).type="LineSegments",i}return $d(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)$w.fromBufferAttribute(t,r),qw.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+$w.distanceTo(qw);e.setAttribute("lineDistance",new b_(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}]),n}(Fw);Uw.prototype.isLineSegments=!0,function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r)).type="LineLoop",i}return $d(n)}(Fw).prototype.isLineLoop=!0;var Vw=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="PointsMaterial",r.color=new d_(16777215),r.map=null,r.alphaMap=null,r.size=1,r.sizeAttenuation=!0,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(a_);Vw.prototype.isPointsMaterial=!0;var Hw=new xg,Ww=new bg,Gw=new dg,Zw=new Vm,Yw=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E_,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vw;return Bd(this,n),(e=t.call(this)).type="Points",e.geometry=r,e.material=i,e.updateMorphTargets(),e}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Gw.copy(n.boundingSphere),Gw.applyMatrix4(r),Gw.radius+=i,!1!==e.ray.intersectsSphere(Gw)){Hw.copy(r).invert(),Ww.copy(e.ray).applyMatrix4(Hw);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){var u=n.index,l=n.attributes.position;if(null!==u)for(var c=Math.max(0,a.start),h=Math.min(u.count,a.start+a.count);c<h;c++){var d=u.getX(c);Zw.fromBufferAttribute(l,d),Xw(Zw,d,s,r,e,t,this)}else for(var f=Math.max(0,a.start),p=Math.min(l.count,a.start+a.count);f<p;f++)Zw.fromBufferAttribute(l,f),Xw(Zw,f,s,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(Wg);function Xw(e,t,n,r,i,a,o){var s=Ww.distanceSqToPoint(e);if(s<n){var u=new Vm;Ww.closestPointToPoint(e,u),u.applyMatrix4(r);var l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:o})}}Yw.prototype.isPoints=!0;var Kw=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o,s,u,l,c){var h;Bd(this,n),(h=t.call(this,e,r,i,a,o,s,u,l,c)).format=void 0!==u?u:Yv,h.minFilter=void 0!==s?s:$v,h.magFilter=void 0!==o?o:$v,h.generateMipmaps=!1;var d=Id(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){d.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return $d(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(zm);Kw.prototype.isVideoTexture=!0;var Jw=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o,s,u,l,c,h,d,f){var p;return Bd(this,n),(p=t.call(this,null,s,u,l,c,h,a,o,d,f)).image={width:r,height:i},p.mipmaps=e,p.flipY=!1,p.generateMipmaps=!1,p}return $d(n)}(zm);Jw.prototype.isCompressedTexture=!0;var Qw=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o,s,u,l,c){var h;return Bd(this,n),(h=t.call(this,e,r,i,a,o,s,u,l,c)).needsUpdate=!0,h}return $d(n)}(zm);Qw.prototype.isCanvasTexture=!0;var ek=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o,s,u,l,c,h){var d;if(Bd(this,n),(h=void 0!==h?h:Kv)!==Kv&&h!==Jv)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===i&&h===Kv&&(i=Vv),void 0===i&&h===Jv&&(i=Zv),(d=t.call(this,null,a,o,s,u,l,h,i,c)).image={width:e,height:r},d.magFilter=void 0!==u?u:Fv,d.minFilter=void 0!==l?l:Fv,d.flipY=!1,d.generateMipmaps=!1,d}return $d(n)}(zm);ek.prototype.isDepthTexture=!0;new Vm,new Vm,new Vm,new r_;var tk=function(){function e(){Bd(this,e),this.type="Curve",this.arcLengthDivisions=200}return $d(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),i=0;n.push(0);for(var a=1;a<=e;a++)i+=(t=this.getPoint(a/e)).distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=r[i=Math.floor(s+(u-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){u=i;break}u=i-1}if(r[i=u]===n)return i/(a-1);var l=r[i];return(i+(n-l)/(r[i+1]-l))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);var a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new Pm:new Vm);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Vm,r=[],i=[],a=[],o=new Vm,s=new xg,u=0;u<=e;u++){var l=u/e;r[u]=this.getTangentAt(l,new Vm)}i[0]=new Vm,a[0]=new Vm;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),f<=c&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(var p=1;p<=e;p++){if(i[p]=i[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(km(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(s.makeRotationAxis(o,v))}a[p].crossVectors(r[p],i[p])}if(!0===t){var m=Math.acos(km(i[0].dot(i[e]),-1,1));m/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(m=-m);for(var g=1;g<=e;g++)i[g].applyMatrix4(s.makeRotationAxis(r[g],m*g)),a[g].crossVectors(r[g],i[g])}return{tangents:r,normals:i,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),nk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return Bd(this,n),(e=t.call(this)).type="EllipseCurve",e.aX=r,e.aY=i,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=u,e.aClockwise=l,e.aRotation=c,e}return $d(n,[{key:"getPoint",value:function(e,t){for(var n=t||new Pm,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=u-this.aY;s=h*l-d*c+this.aX,u=h*c+d*l+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(tk);nk.prototype.isEllipseCurve=!0;var rk=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o,s){var u;return Bd(this,n),(u=t.call(this,e,r,i,i,a,o,s)).type="ArcCurve",u}return $d(n)}(nk);function ik(){var e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){var u=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(r-t)/(o+s)+(r-n)/s;i(t,n,u*=o,l*=o)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}rk.prototype.isArcCurve=!0;var ak=new Vm,ok=new ik,sk=new ik,uk=new ik,lk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return Bd(this,n),(e=t.call(this)).type="CatmullRomCurve3",e.points=r,e.closed=i,e.curveType=a,e.tension=o,e}return $d(n,[{key:"getPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,i=r,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,u=Math.floor(s),l=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===l&&u===o-1&&(u=o-2,l=1),this.closed||u>0?t=a[(u-1)%o]:(ak.subVectors(a[0],a[1]).add(a[0]),t=ak);var c=a[u%o],h=a[(u+1)%o];if(this.closed||u+2<o?n=a[(u+2)%o]:(ak.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=ak),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(t.distanceToSquared(c),d),p=Math.pow(c.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(n),d);p<1e-4&&(p=1),f<1e-4&&(f=p),v<1e-4&&(v=p),ok.initNonuniformCatmullRom(t.x,c.x,h.x,n.x,f,p,v),sk.initNonuniformCatmullRom(t.y,c.y,h.y,n.y,f,p,v),uk.initNonuniformCatmullRom(t.z,c.z,h.z,n.z,f,p,v)}else"catmullrom"===this.curveType&&(ok.initCatmullRom(t.x,c.x,h.x,n.x,this.tension),sk.initCatmullRom(t.y,c.y,h.y,n.y,this.tension),uk.initCatmullRom(t.z,c.z,h.z,n.z,this.tension));return i.set(ok.calc(l),sk.calc(l),uk.calc(l)),i}},{key:"copy",value:function(e){Nd(wd(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new Vm).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(tk);function ck(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function hk(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function dk(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}lk.prototype.isCatmullRomCurve3=!0;var fk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pm,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pm,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Pm;return Bd(this,n),(e=t.call(this)).type="CubicBezierCurve",e.v0=r,e.v1=i,e.v2=a,e.v3=o,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm,n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(dk(e,r.x,i.x,a.x,o.x),dk(e,r.y,i.y,a.y,o.y)),n}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(tk);fk.prototype.isCubicBezierCurve=!0;var pk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vm,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Vm;return Bd(this,n),(e=t.call(this)).type="CubicBezierCurve3",e.v0=r,e.v1=i,e.v2=a,e.v3=o,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(dk(e,r.x,i.x,a.x,o.x),dk(e,r.y,i.y,a.y,o.y),dk(e,r.z,i.z,a.z,o.z)),n}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(tk);pk.prototype.isCubicBezierCurve3=!0;var vk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pm,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm;return Bd(this,n),(e=t.call(this)).type="LineCurve",e.v1=r,e.v2=i,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new Pm;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(tk);vk.prototype.isLineCurve=!0;var mk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm;return Bd(this,n),(e=t.call(this)).type="LineCurve3",e.isLineCurve3=!0,e.v1=r,e.v2=i,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(tk),gk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pm,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pm;return Bd(this,n),(e=t.call(this)).type="QuadraticBezierCurve",e.v0=r,e.v1=i,e.v2=a,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm,n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(hk(e,r.x,i.x,a.x),hk(e,r.y,i.y,a.y)),n}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(tk);gk.prototype.isQuadraticBezierCurve=!0;var _k=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vm;return Bd(this,n),(e=t.call(this)).type="QuadraticBezierCurve3",e.v0=r,e.v1=i,e.v2=a,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(hk(e,r.x,i.x,a.x),hk(e,r.y,i.y,a.y),hk(e,r.z,i.z,a.z)),n}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(tk);_k.prototype.isQuadraticBezierCurve3=!0;var yk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Bd(this,n),(e=t.call(this)).type="SplineCurve",e.points=r,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pm,n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],u=r[a],l=r[a>r.length-2?r.length-1:a+1],c=r[a>r.length-3?r.length-1:a+2];return n.set(ck(o,s.x,u.x,l.x,c.x),ck(o,s.y,u.y,l.y,c.y)),n}},{key:"copy",value:function(e){Nd(wd(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e}},{key:"fromJSON",value:function(e){Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new Pm).fromArray(i))}return this}}]),n}(tk);yk.prototype.isSplineCurve=!0;var bk=Object.freeze({__proto__:null,ArcCurve:rk,CatmullRomCurve3:lk,CubicBezierCurve:fk,CubicBezierCurve3:pk,EllipseCurve:nk,LineCurve:vk,LineCurve3:mk,QuadraticBezierCurve:gk,QuadraticBezierCurve3:_k,SplineCurve:yk}),xk=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return $d(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new vk(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var a=r[i]-n,o=this.curves[i],s=o.getLength(),u=0===s?0:1-a/s;return o.getPointAt(u,t)}i++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),u=0;u<s.length;u++){var l=s[u];e&&e.equals(l)||(n.push(l),e=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){Nd(wd(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e}},{key:"fromJSON",value:function(e){Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push((new bk[i.type]).fromJSON(i))}return this}}]),n}(tk),wk=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="Path",r.currentPoint=new Pm,e&&r.setFromPoints(e),r}return $d(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new vk(this.currentPoint.clone(),new Pm(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var i=new gk(this.currentPoint.clone(),new Pm(e,t),new Pm(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,i,a){var o=new fk(this.currentPoint.clone(),new Pm(e,t),new Pm(n,r),new Pm(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new yk(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}},{key:"absarc",value:function(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}},{key:"ellipse",value:function(e,t,n,r,i,a,o,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+u,t+l,n,r,i,a,o,s),this}},{key:"absellipse",value:function(e,t,n,r,i,a,o,s){var u=new nk(e,t,n,r,i,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(xk),kk=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e)).uuid=wm(),r.type="Shape",r.holes=[],r}return $d(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){Nd(wd(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e}},{key:"fromJSON",value:function(e){Nd(wd(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push((new wk).fromJSON(i))}return this}}]),n}(wk),Sk=function(e,t){var n,r,i,a,o,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*l:e.length,d=Mk(e,0,h,l,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=Ik(e,t,d,l)),e.length>80*l){n=i=e[0],r=a=e[1];for(var p=l;p<h;p+=l)(o=e[p])<n&&(n=o),(s=e[p+1])<r&&(r=s),o>i&&(i=o),s>a&&(a=s);u=0!==(u=Math.max(i-n,a-r))?1/u:0}return Tk(d,f,l,n,r,u),f};function Mk(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=Gk(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=Gk(a,e[a],e[a+1],o);return o&&$k(o,o.next)&&(Zk(o),o=o.next),o}function Ck(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!$k(r,r.next)&&0!==Fk(r.prev,r,r.next))r=r.next;else{if(Zk(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Tk(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Dk(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}(e,r,i,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?Pk(e,r,i,a):Ek(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),Zk(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?Tk(e=Ak(Ck(e),t,n),t,n,r,i,a,2):2===o&&Lk(e,t,n,r,i,a):Tk(Ck(e),t,n,r,i,a,1);break}}}function Ek(e){var t=e.prev,n=e,r=e.next;if(Fk(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(jk(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Fk(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Pk(e,t,n,r){var i=e.prev,a=e,o=e.next;if(Fk(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=Dk(s,u,t,n,r),d=Dk(l,c,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&jk(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Fk(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&jk(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Fk(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&jk(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Fk(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&jk(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Fk(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ak(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!$k(i,a)&&qk(i,r,r.next,a)&&Hk(i,a)&&Hk(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),Zk(r),Zk(r.next),r=e=a),r=r.next}while(r!==e);return Ck(r)}function Lk(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Bk(o,s)){var u=Wk(o,s);return o=Ck(o,o.next),u=Ck(u,u.next),Tk(o,t,n,r,i,a),void Tk(u,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function Ik(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=Mk(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(zk(o));for(s.sort(Rk),i=0;i<s.length;i++)Ok(s[i],n),n=Ck(n,n.next);return n}function Rk(e,t){return e.x-t.x}function Ok(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,l=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&jk(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),Hk(r,e)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&Nk(n,r)))&&(n=r,d=u)),r=r.next}while(r!==l);return n}(e,t),t){var n=Wk(t,e);Ck(t,t.next),Ck(n,n.next)}}function Nk(e,t){return Fk(e.prev,e,t.prev)<0&&Fk(t.next,e,e.next)<0}function Dk(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function zk(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function jk(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function Bk(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&qk(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Hk(e,t)&&Hk(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Fk(e.prev,e,t.prev)||Fk(e,t.prev,t))||$k(e,t)&&Fk(e.prev,e,e.next)>0&&Fk(t.prev,t,t.next)>0)}function Fk(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function $k(e,t){return e.x===t.x&&e.y===t.y}function qk(e,t,n,r){var i=Vk(Fk(e,t,n)),a=Vk(Fk(e,t,r)),o=Vk(Fk(n,r,e)),s=Vk(Fk(n,r,t));return i!==a&&o!==s||(!(0!==i||!Uk(e,n,t))||(!(0!==a||!Uk(e,r,t))||(!(0!==o||!Uk(n,e,r))||!(0!==s||!Uk(n,t,r)))))}function Uk(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Vk(e){return e>0?1:e<0?-1:0}function Hk(e,t){return Fk(e.prev,e,e.next)<0?Fk(e,t,e.next)>=0&&Fk(e,e.prev,t)>=0:Fk(e,t,e.prev)<0||Fk(e,e.next,t)<0}function Wk(e,t){var n=new Yk(e.i,e.x,e.y),r=new Yk(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Gk(e,t,n,r){var i=new Yk(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Zk(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yk(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Xk=function(){function e(){Bd(this,e)}return $d(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],r=[],i=[];Kk(e),Jk(n,e);var a=e.length;t.forEach(Kk);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,Jk(n,t[o]);for(var s=Sk(n,r),u=0;u<s.length;u+=3)i.push(s.slice(u,u+3));return i}}]),e}();function Kk(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Jk(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Qk=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kk([new Pm(.5,.5),new Pm(-.5,.5),new Pm(-.5,-.5),new Pm(.5,-.5)]),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Bd(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:r,options:i},r=Array.isArray(r)?r:[r];for(var a=Id(e),o=[],s=[],u=0,l=r.length;u<l;u++){var c=r[u];h(c)}function h(e){var t=[],n=void 0!==i.curveSegments?i.curveSegments:12,r=void 0!==i.steps?i.steps:1,u=void 0!==i.depth?i.depth:1,l=void 0===i.bevelEnabled||i.bevelEnabled,c=void 0!==i.bevelThickness?i.bevelThickness:.2,h=void 0!==i.bevelSize?i.bevelSize:c-.1,d=void 0!==i.bevelOffset?i.bevelOffset:0,f=void 0!==i.bevelSegments?i.bevelSegments:3,p=i.extrudePath,v=void 0!==i.UVGenerator?i.UVGenerator:eS;void 0!==i.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=i.amount);var m,g,_,y,b,x=!1;p&&(m=p.getSpacedPoints(r),x=!0,l=!1,g=p.computeFrenetFrames(r,!1),_=new Vm,y=new Vm,b=new Vm),l||(f=0,c=0,h=0,d=0);var w=e.extractPoints(n),k=w.shape,S=w.holes;if(!Xk.isClockWise(k)){k=k.reverse();for(var M=0,C=S.length;M<C;M++){var T=S[M];Xk.isClockWise(T)&&(S[M]=T.reverse())}}for(var E=Xk.triangulateShape(k,S),P=k,A=0,L=S.length;A<L;A++){var I=S[A];k=k.concat(I)}function R(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var O=k.length,N=E.length;function D(e,t,n){var r,i,a,o=e.x-t.x,s=e.y-t.y,u=n.x-e.x,l=n.y-e.y,c=o*o+s*s,h=o*l-s*u;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(u*u+l*l),p=t.x-s/d,v=t.y+o/d,m=((n.x-l/f-p)*l-(n.y+u/f-v)*u)/(o*l-s*u),g=(r=p+o*m-e.x)*r+(i=v+s*m-e.y)*i;if(g<=2)return new Pm(r,i);a=Math.sqrt(g/2)}else{var _=!1;o>Number.EPSILON?u>Number.EPSILON&&(_=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(_=!0):Math.sign(s)===Math.sign(l)&&(_=!0),_?(r=-s,i=o,a=Math.sqrt(c)):(r=o,i=s,a=Math.sqrt(c/2))}return new Pm(r/a,i/a)}for(var z=[],j=0,B=P.length,F=B-1,$=j+1;j<B;j++,F++,$++)F===B&&(F=0),$===B&&($=0),z[j]=D(P[j],P[F],P[$]);for(var q,U=[],V=z.concat(),H=0,W=S.length;H<W;H++){var G=S[H];q=[];for(var Z=0,Y=G.length,X=Y-1,K=Z+1;Z<Y;Z++,X++,K++)X===Y&&(X=0),K===Y&&(K=0),q[Z]=D(G[Z],G[X],G[K]);U.push(q),V=V.concat(q)}for(var J=0;J<f;J++){for(var Q=J/f,ee=c*Math.cos(Q*Math.PI/2),te=h*Math.sin(Q*Math.PI/2)+d,ne=0,re=P.length;ne<re;ne++){var ie=R(P[ne],z[ne],te);Le(ie.x,ie.y,-ee)}for(var ae=0,oe=S.length;ae<oe;ae++){var se=S[ae];q=U[ae];for(var ue=0,le=se.length;ue<le;ue++){var ce=R(se[ue],q[ue],te);Le(ce.x,ce.y,-ee)}}}for(var he=h+d,de=0;de<O;de++){var fe=l?R(k[de],V[de],he):k[de];x?(y.copy(g.normals[0]).multiplyScalar(fe.x),_.copy(g.binormals[0]).multiplyScalar(fe.y),b.copy(m[0]).add(y).add(_),Le(b.x,b.y,b.z)):Le(fe.x,fe.y,0)}for(var pe=1;pe<=r;pe++)for(var ve=0;ve<O;ve++){var me=l?R(k[ve],V[ve],he):k[ve];x?(y.copy(g.normals[pe]).multiplyScalar(me.x),_.copy(g.binormals[pe]).multiplyScalar(me.y),b.copy(m[pe]).add(y).add(_),Le(b.x,b.y,b.z)):Le(me.x,me.y,u/r*pe)}for(var ge=f-1;ge>=0;ge--){for(var _e=ge/f,ye=c*Math.cos(_e*Math.PI/2),be=h*Math.sin(_e*Math.PI/2)+d,xe=0,we=P.length;xe<we;xe++){var ke=R(P[xe],z[xe],be);Le(ke.x,ke.y,u+ye)}for(var Se=0,Me=S.length;Se<Me;Se++){var Ce=S[Se];q=U[Se];for(var Te=0,Ee=Ce.length;Te<Ee;Te++){var Pe=R(Ce[Te],q[Te],be);x?Le(Pe.x,Pe.y+m[r-1].y,m[r-1].x+ye):Le(Pe.x,Pe.y,u+ye)}}}function Ae(e,t){for(var n=e.length;--n>=0;){var i=n,a=n-1;a<0&&(a=e.length-1);for(var o=0,s=r+2*f;o<s;o++){var u=O*o,l=O*(o+1);Re(t+i+u,t+a+u,t+a+l,t+i+l)}}}function Le(e,n,r){t.push(e),t.push(n),t.push(r)}function Ie(e,t,n){Oe(e),Oe(t),Oe(n);var r=o.length/3,i=v.generateTopUV(a,o,r-3,r-2,r-1);Ne(i[0]),Ne(i[1]),Ne(i[2])}function Re(e,t,n,r){Oe(e),Oe(t),Oe(r),Oe(t),Oe(n),Oe(r);var i=o.length/3,s=v.generateSideWallUV(a,o,i-6,i-3,i-2,i-1);Ne(s[0]),Ne(s[1]),Ne(s[3]),Ne(s[1]),Ne(s[2]),Ne(s[3])}function Oe(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function Ne(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(l){for(var t=0,n=O*t,i=0;i<N;i++){var s=E[i];Ie(s[2]+n,s[1]+n,s[0]+n)}n=O*(t=r+2*f);for(var u=0;u<N;u++){var c=E[u];Ie(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<N;h++){var d=E[h];Ie(d[2],d[1],d[0])}for(var p=0;p<N;p++){var v=E[p];Ie(v[0]+O*r,v[1]+O*r,v[2]+O*r)}}a.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Ae(P,t),t+=P.length;for(var n=0,r=S.length;n<r;n++){var i=S[n];Ae(i,t),t+=i.length}a.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new b_(o,3)),e.setAttribute("uv",new b_(s,2)),e.computeVertexNormals(),e}return $d(n,[{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],i=0,a=e.shapes.length;i<a;i++){var o=t[e.shapes[i]];r.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new bk[s.type]).fromJSON(s)),new n(r,e.options)}}]),n}(E_),eS={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],u=t[3*r+1],l=t[3*i],c=t[3*i+1];return[new Pm(a,o),new Pm(s,u),new Pm(l,c)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],u=t[3*n+2],l=t[3*r],c=t[3*r+1],h=t[3*r+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],v=t[3*a],m=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<Math.abs(o-l)?[new Pm(o,1-u),new Pm(l,1-h),new Pm(d,1-p),new Pm(v,1-g)]:[new Pm(s,1-u),new Pm(c,1-h),new Pm(f,1-p),new Pm(m,1-g)]}};var tS=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kk([new Pm(0,.5),new Pm(-.5,-.5),new Pm(.5,-.5)]),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Bd(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:r,curveSegments:i};var a=[],o=[],s=[],u=[],l=0,c=0;if(!1===Array.isArray(r))d(r);else for(var h=0;h<r.length;h++)d(r[h]),e.addGroup(l,c,h),l+=c,c=0;function d(e){var t=o.length/3,n=e.extractPoints(i),r=n.shape,l=n.holes;!1===Xk.isClockWise(r)&&(r=r.reverse());for(var h=0,d=l.length;h<d;h++){var f=l[h];!0===Xk.isClockWise(f)&&(l[h]=f.reverse())}for(var p=Xk.triangulateShape(r,l),v=0,m=l.length;v<m;v++){var g=l[v];r=r.concat(g)}for(var _=0,y=r.length;_<y;_++){var b=r[_];o.push(b.x,b.y,0),s.push(0,0,1),u.push(b.x,b.y)}for(var x=0,w=p.length;x<w;x++){var k=p[x],S=k[0]+t,M=k[1]+t,C=k[2]+t;a.push(S,M,C),c+=3}}return e.setIndex(a),e.setAttribute("position",new b_(o,3)),e.setAttribute("normal",new b_(s,3)),e.setAttribute("uv",new b_(u,2)),e}return $d(n,[{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],i=0,a=e.shapes.length;i<a;i++){var o=t[e.shapes[i]];r.push(o)}return new n(r,e.curveSegments)}}]),n}(E_);var nS=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;Bd(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:r,widthSegments:i,heightSegments:a,phiStart:o,phiLength:s,thetaStart:u,thetaLength:l},i=Math.max(3,Math.floor(i)),a=Math.max(2,Math.floor(a));for(var c=Math.min(u+l,Math.PI),h=0,d=[],f=new Vm,p=new Vm,v=[],m=[],g=[],_=[],y=0;y<=a;y++){var b=[],x=y/a,w=0;0==y&&0==u?w=.5/i:y==a&&c==Math.PI&&(w=-.5/i);for(var k=0;k<=i;k++){var S=k/i;f.x=-r*Math.cos(o+S*s)*Math.sin(u+x*l),f.y=r*Math.cos(u+x*l),f.z=r*Math.sin(o+S*s)*Math.sin(u+x*l),m.push(f.x,f.y,f.z),p.copy(f).normalize(),g.push(p.x,p.y,p.z),_.push(S+w,1-x),b.push(h++)}d.push(b)}for(var M=0;M<a;M++)for(var C=0;C<i;C++){var T=d[M][C+1],E=d[M][C],P=d[M+1][C],A=d[M+1][C+1];(0!==M||u>0)&&v.push(T,E,A),(M!==a-1||c<Math.PI)&&v.push(E,P,A)}return e.setIndex(v),e.setAttribute("position",new b_(m,3)),e.setAttribute("normal",new b_(g,3)),e.setAttribute("uv",new b_(_,2)),e}return $d(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(E_);(function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="ShadowMaterial",r.color=new d_(0),r.transparent=!0,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this}}]),n})(a_).prototype.isShadowMaterial=!0;var rS=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).defines={STANDARD:""},r.type="MeshStandardMaterial",r.color=new d_(16777215),r.roughness=1,r.metalness=0,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new d_(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=0,r.normalScale=new Pm(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.roughnessMap=null,r.metalnessMap=null,r.alphaMap=null,r.envMap=null,r.envMapIntensity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(a_);rS.prototype.isMeshStandardMaterial=!0;var iS=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).defines={STANDARD:"",PHYSICAL:""},r.type="MeshPhysicalMaterial",r.clearcoatMap=null,r.clearcoatRoughness=0,r.clearcoatRoughnessMap=null,r.clearcoatNormalScale=new Pm(1,1),r.clearcoatNormalMap=null,r.ior=1.5,Object.defineProperty(Id(r),"reflectivity",{get:function(){return km(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),r.sheenColor=new d_(0),r.sheenColorMap=null,r.sheenRoughness=1,r.sheenRoughnessMap=null,r.transmissionMap=null,r.thickness=.01,r.thicknessMap=null,r.attenuationDistance=0,r.attenuationColor=new d_(1,1,1),r.specularIntensity=1,r.specularIntensityMap=null,r.specularColor=new d_(1,1,1),r.specularColorMap=null,r._sheen=0,r._clearcoat=0,r._transmission=0,r.setValues(e),r}return $d(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(rS);iS.prototype.isMeshPhysicalMaterial=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="MeshPhongMaterial",r.color=new d_(16777215),r.specular=new d_(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new d_(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=0,r.normalScale=new Pm(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=0,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(a_).prototype.isMeshPhongMaterial=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).defines={TOON:""},r.type="MeshToonMaterial",r.color=new d_(16777215),r.map=null,r.gradientMap=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new d_(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=0,r.normalScale=new Pm(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(a_).prototype.isMeshToonMaterial=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="MeshNormalMaterial",r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=0,r.normalScale=new Pm(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.flatShading=!1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(a_).prototype.isMeshNormalMaterial=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="MeshLambertMaterial",r.color=new d_(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new d_(0),r.emissiveIntensity=1,r.emissiveMap=null,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=0,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(a_).prototype.isMeshLambertMaterial=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).defines={MATCAP:""},r.type="MeshMatcapMaterial",r.color=new d_(16777215),r.matcap=null,r.map=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=0,r.normalScale=new Pm(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.flatShading=!1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}]),n}(a_).prototype.isMeshMatcapMaterial=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="LineDashedMaterial",r.scale=1,r.dashSize=3,r.gapSize=1,r.setValues(e),r}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(Ow).prototype.isLineDashedMaterial=!0;var aS={arraySlice:function(e,t,n){return aS.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,u=0;u!==t;++u)i[o++]=e[s+u];return i},flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var u=a.tracks[s],l=u.getValueSize(),c=[],h=[],d=0;d<u.times.length;++d){var f=u.times[d]*i;if(!(f<n||f>=r)){c.push(u.times[d]);for(var p=0;p<l;++p)h.push(u.values[d*l+p])}}0!==c.length&&(u.times=aS.convertArray(c,u.times.constructor),u.values=aS.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;for(var v=1/0,m=0;m<a.tracks.length;++m)v>a.tracks[m].times[0]&&(v=a.tracks[m].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*v);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var i=n.tracks.length,a=t/r,o=function(t){var r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var o=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===o)return"continue";var s=0,u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);var l=0,c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);var h=r.times.length-1,d=void 0;if(a<=r.times[0]){var f=s,p=u-s;d=aS.arraySlice(r.values,f,p)}else if(a>=r.times[h]){var v=h*u+s,m=v+u-s;d=aS.arraySlice(r.values,v,m)}else{var g=r.createInterpolant(),_=s,y=u-s;g.evaluate(a),d=aS.arraySlice(g.resultBuffer,_,y)}"quaternion"===i&&(new Um).fromArray(d).normalize().conjugate().toArray(d);for(var b=o.times.length,x=0;x<b;++x){var w=x*c+l;if("quaternion"===i)Um.multiplyQuaternionsFlat(o.values,w,d,0,o.values,w);else for(var k=c-2*l,S=0;S<k;++S)o.values[w+S]-=d[S]}},s=0;s<i;++s)o(s);return e.blendMode=om,e}},oS=function(){function e(t,n,r,i){Bd(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return $d(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,e<(r=t[++n]))break t}a=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(var u=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===u)break;if(r=i,e>=(i=t[--n-1]))break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}();oS.prototype.beforeStart_=oS.prototype.copySampleValue_,oS.prototype.afterEnd_=oS.prototype.copySampleValue_;var sS=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:nm,endingEnd:nm},o}return $d(n,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case rm:i=e,o=2*t-n;break;case im:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case rm:a=e,s=2*n-t;break;case im:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=i*l,this._offsetNext=a*l}},{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,v=p*f,m=-h*v+2*h*p-h*f,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*f+1,_=(-1-d)*v+(1.5+d)*p+.5*f,y=d*v-d*p,b=0;b!==o;++b)i[b]=m*a[l+b]+g*a[u+b]+_*a[s+b]+y*a[c+b];return i}}]),n}(oS),uS=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){return Bd(this,n),t.call(this,e,r,i,a)}return $d(n,[{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(r-t),c=1-l,h=0;h!==o;++h)i[h]=a[u+h]*c+a[s+h]*l;return i}}]),n}(oS),lS=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){return Bd(this,n),t.call(this,e,r,i,a)}return $d(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(oS),cS=function(){function e(t,n,r,i){if(Bd(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=aS.convertArray(n,this.TimeBufferType),this.values=aS.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}return $d(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new lS(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new uS(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new sS(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case Qv:t=this.InterpolantFactoryMethodDiscrete;break;case em:t=this.InterpolantFactoryMethodLinear;break;case tm:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Qv;case this.InterpolantFactoryMethodLinear:return em;case this.InterpolantFactoryMethodSmooth:return tm}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=aS.arraySlice(n,i,a),this.values=aS.arraySlice(this.values,i*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&aS.isTypedArray(r))for(var u=0,l=r.length;u!==l;++u){var c=r[u];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=aS.arraySlice(this.times),t=aS.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===tm,i=e.length-1,a=1,o=1;o<i;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(r)s=!0;else for(var l=o*n,c=l-n,h=l+n,d=0;d!==n;++d){var f=t[l+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,v=a*n,m=0;m!==n;++m)t[v+m]=t[p+m]}++a}}if(i>0){e[a]=e[i];for(var g=i*n,_=a*n,y=0;y!==n;++y)t[_+y]=t[g+y];++a}return a!==e.length?(this.times=aS.arraySlice(e,0,a),this.values=aS.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=aS.arraySlice(this.times,0),t=aS.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:aS.convertArray(e.times,Array),values:aS.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();cS.prototype.TimeBufferType=Float32Array,cS.prototype.ValueBufferType=Float32Array,cS.prototype.DefaultInterpolation=em;var hS=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n)}(cS);hS.prototype.ValueTypeName="bool",hS.prototype.ValueBufferType=Array,hS.prototype.DefaultInterpolation=Qv,hS.prototype.InterpolantFactoryMethodLinear=void 0,hS.prototype.InterpolantFactoryMethodSmooth=void 0;var dS=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n)}(cS);dS.prototype.ValueTypeName="color";var fS=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n)}(cS);fS.prototype.ValueTypeName="number";var pS=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){return Bd(this,n),t.call(this,e,r,i,a)}return $d(n,[{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),u=e*o,l=u+o;u!==l;u+=4)Um.slerpFlat(i,0,a,u-o,a,u,s);return i}}]),n}(oS),vS=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new pS(this.times,this.values,this.getValueSize(),e)}}]),n}(cS);vS.prototype.ValueTypeName="quaternion",vS.prototype.DefaultInterpolation=em,vS.prototype.InterpolantFactoryMethodSmooth=void 0;var mS=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n)}(cS);mS.prototype.ValueTypeName="string",mS.prototype.ValueBufferType=Array,mS.prototype.DefaultInterpolation=Qv,mS.prototype.InterpolantFactoryMethodLinear=void 0,mS.prototype.InterpolantFactoryMethodSmooth=void 0;var gS=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n)}(cS);gS.prototype.ValueTypeName="vector";var _S=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:am;Bd(this,e),this.name=t,this.tracks=r,this.duration=n,this.blendMode=i,this.uuid=wm(),this.duration<0&&this.resetDuration()}return $d(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(yS(n[i]).scale(r));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,a=n.length;i!==a;++i)t.push(cS.toJSON(n[i]));return r}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],u=[];s.push((o+i-1)%i,o,(o+1)%i),u.push(0,1,0);var l=aS.getKeyframeOrder(s);s=aS.sortedArray(s,1,l),u=aS.sortedArray(u,1,l),r||0!==s[0]||(s.push(i),u.push(u[0])),a.push(new fS(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],u=s.name.match(i);if(u&&u.length>1){var l=u[1],c=r[l];c||(r[l]=c=[]),c.push(s)}}var h=[];for(var d in r)h.push(this.CreateFromMorphTargetSequence(d,r[d],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var a=[],o=[];aS.flattenJSON(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,u=e.hierarchy||[],l=0;l<u.length;l++){var c=u[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},d=void 0;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(var f=0;f<c[d].morphTargets.length;f++)h[c[d].morphTargets[f]]=-1;for(var p in h){for(var v=[],m=[],g=0;g!==c[d].morphTargets.length;++g){var _=c[d];v.push(_.time),m.push(_.morphTarget===p?1:0)}r.push(new fS(".morphTargetInfluence["+p+"]",v,m))}s=h.length*(a||1)}else{var y=".bones["+t[l].name+"]";n(gS,y+".position",c,"pos",r),n(vS,y+".quaternion",c,"rot",r),n(gS,y+".scale",c,"scl",r)}}return 0===r.length?null:new this(i,s,r,o)}}]),e}();function yS(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return fS;case"vector":case"vector2":case"vector3":case"vector4":return gS;case"color":return dS;case"quaternion":return vS;case"bool":case"boolean":return hS;case"string":return mS}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];aS.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var bS={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},xS=$d((function e(t,n,r){Bd(this,e);var i=this,a=!1,o=0,s=0,u=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=r,this.itemStart=function(e){s++,!1===a&&void 0!==i.onStart&&i.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,s),o===s&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return u?u(e):e},this.setURLModifier=function(e){return u=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}})),wS=new xS,kS=function(){function e(t){Bd(this,e),this.manager=void 0!==t?t:wS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return $d(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),SS={},MS=function(e){Dd(n,e);var t=zd(n);function n(e){return Bd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,r){var i=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=bS.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===SS[e]){SS[e]=[],SS[e].push({onLoad:t,onProgress:n,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(o).then((function(t){if(200===t.status||0===t.status){0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");var n=SS[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),a=i?parseInt(i):0,o=0!==a,s=0;return new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var i=r.done,u=r.value;if(i)e.close();else{s+=u.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),c=0,h=n.length;c<h;c++){var d=n[c];d.onProgress&&d.onProgress(l)}e.enqueue(u),t()}}))}()}})}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){var t=new Response(e);switch(i.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((function(e){return(new DOMParser).parseFromString(e,i.mimeType)}));case"json":return t.json();default:return t.text()}})).then((function(t){bS.add(e,t);var n=SS[e];delete SS[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onLoad&&o.onLoad(t)}i.manager.itemEnd(e)})).catch((function(t){var n=SS[e];delete SS[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)})),this.manager.itemStart(e)}else SS[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(kS),CS=function(e){Dd(n,e);var t=zd(n);function n(e){return Bd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=bS.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=Rm("img");function s(){l(),bS.add(e,this),t&&t(this),i.manager.itemEnd(e)}function u(t){l(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}]),n}(kS),TS=function(e){Dd(n,e);var t=zd(n);function n(e){return Bd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,r){var i=new ry,a=new CS(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){i.images[n]=e,6===++o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var u=0;u<e.length;++u)s(u);return i}}]),n}(kS),ES=function(e){Dd(n,e);var t=zd(n);function n(e){return Bd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,r){var i=new zm,a=new CS(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}]),n}(kS),PS=function(e){Dd(n,e);var t=zd(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Bd(this,n),(r=t.call(this)).type="Light",r.color=new d_(e),r.intensity=i,r}return $d(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(Wg);PS.prototype.isLight=!0,function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,i)).type="HemisphereLight",a.position.copy(Wg.DefaultUp),a.updateMatrix(),a.groundColor=new d_(r),a}return $d(n,[{key:"copy",value:function(e){return PS.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}]),n}(PS).prototype.isHemisphereLight=!0;var AS=new xg,LS=new Vm,IS=new Vm,RS=function(){function e(t){Bd(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Pm(512,512),this.map=null,this.mapPass=null,this.matrix=new xg,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hy,this._frameExtents=new Pm(1,1),this._viewportCount=1,this._viewports=[new Bm(0,0,1,1)]}return $d(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;LS.setFromMatrixPosition(e.matrixWorld),t.position.copy(LS),IS.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(IS),t.updateMatrixWorld(),AS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(AS),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),OS=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this,new ey(50,1,.5,500))).focus=1,e}return $d(n,[{key:"updateMatrices",value:function(e){var t=this.camera,r=2*_m*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;r===t.fov&&i===t.aspect&&a===t.far||(t.fov=r,t.aspect=i,t.far=a,t.updateProjectionMatrix()),Nd(wd(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(RS);OS.prototype.isSpotLightShadow=!0;var NS=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Bd(this,n),(i=t.call(this,e,r)).type="SpotLight",i.position.copy(Wg.DefaultUp),i.updateMatrix(),i.target=new Wg,i.distance=a,i.angle=o,i.penumbra=s,i.decay=u,i.shadow=new OS,i}return $d(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(PS);NS.prototype.isSpotLight=!0;var DS=new xg,zS=new Vm,jS=new Vm,BS=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this,new ey(90,1,.5,500)))._frameExtents=new Pm(4,2),e._viewportCount=6,e._viewports=[new Bm(2,1,1,1),new Bm(0,1,1,1),new Bm(3,1,1,1),new Bm(1,1,1,1),new Bm(3,0,1,1),new Bm(1,0,1,1)],e._cubeDirections=[new Vm(1,0,0),new Vm(-1,0,0),new Vm(0,0,1),new Vm(0,0,-1),new Vm(0,1,0),new Vm(0,-1,0)],e._cubeUps=[new Vm(0,1,0),new Vm(0,1,0),new Vm(0,1,0),new Vm(0,1,0),new Vm(0,0,1),new Vm(0,0,-1)],e}return $d(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),zS.setFromMatrixPosition(e.matrixWorld),n.position.copy(zS),jS.copy(n.position),jS.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(jS),n.updateMatrixWorld(),r.makeTranslation(-zS.x,-zS.y,-zS.z),DS.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DS)}}]),n}(RS);BS.prototype.isPointLightShadow=!0;var FS=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Bd(this,n),(i=t.call(this,e,r)).type="PointLight",i.distance=a,i.decay=o,i.shadow=new BS,i}return $d(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(PS);FS.prototype.isPointLight=!0;var $S=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.call(this,new Sy(-5,5,5,-5,.5,500))}return $d(n)}(RS);$S.prototype.isDirectionalLightShadow=!0;var qS=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r)).type="DirectionalLight",i.position.copy(Wg.DefaultUp),i.updateMatrix(),i.target=new Wg,i.shadow=new $S,i}return $d(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(PS);qS.prototype.isDirectionalLight=!0;var US=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r)).type="AmbientLight",i}return $d(n)}(PS);US.prototype.isAmbientLight=!0;var VS=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return Bd(this,n),(i=t.call(this,e,r)).type="RectAreaLight",i.width=a,i.height=o,i}return $d(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(PS);VS.prototype.isRectAreaLight=!0;var HS=function(){function e(){Bd(this,e),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Vm)}return $d(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}]),e}();HS.prototype.isSphericalHarmonics3=!0;var WS=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new HS,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Bd(this,n),(e=t.call(this,void 0,i)).sh=r,e}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(PS);WS.prototype.isLightProbe=!0;var GS,ZS=function(){function e(){Bd(this,e)}return $d(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(i){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),YS=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this)).type="InstancedBufferGeometry",e.instanceCount=1/0,e}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=Nd(wd(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(E_);YS.prototype.isInstancedBufferGeometry=!0,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),r=t.call(this,e),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),r.options={premultiplyAlpha:"none"},r}return $d(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=bS.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){bS.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}]),n}(kS).prototype.isImageBitmapLoader=!0;var XS=function(){return void 0===GS&&(GS=new(window.AudioContext||window.webkitAudioContext)),GS},KS=function(e){Dd(n,e);var t=zd(n);function n(e){return Bd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,r){var i=this,a=new MS(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{var a=n.slice(0);XS().decodeAudioData(a,(function(e){t(e)}))}catch(o){r?r(o):console.error(o),i.manager.itemError(e)}}),n,r)}}]),n}(kS),JS=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Bd(this,n),i=t.call(this,void 0,a);var o=(new d_).set(e),s=(new d_).set(r),u=new Vm(o.r,o.g,o.b),l=new Vm(s.r,s.g,s.b),c=Math.sqrt(Math.PI),h=c*Math.sqrt(.75);return i.sh.coefficients[0].copy(u).add(l).multiplyScalar(c),i.sh.coefficients[1].copy(u).sub(l).multiplyScalar(h),i}return $d(n)}(WS);JS.prototype.isHemisphereLightProbe=!0;var QS=function(e){Dd(n,e);var t=zd(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Bd(this,n),r=t.call(this,void 0,i);var a=(new d_).set(e);return r.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),r}return $d(n)}(WS);QS.prototype.isAmbientLightProbe=!0;var eM=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Bd(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return $d(e,[{key:"start",value:function(){this.startTime=tM(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=tM();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function tM(){return("undefined"===typeof performance?Date:performance).now()}var nM=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this)).type="Audio",r.listener=e,r.context=e.context,r.gain=r.context.createGain(),r.gain.connect(e.getInput()),r.autoplay=!1,r.buffer=null,r.detune=0,r.loop=!1,r.loopStart=0,r.loopEnd=0,r.offset=0,r.duration=void 0,r.playbackRate=1,r.isPlaying=!1,r.hasPlaybackControl=!0,r.source=null,r.sourceType="empty",r._startedAt=0,r._progress=0,r._connected=!1,r.filters=[],r}return $d(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(Wg),rM=function(){function e(t,n,r){var i,a,o;switch(Bd(this,e),this.binding=t,this.valueSize=r,n){case"quaternion":i=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return $d(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==r;++o)n[i+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var u=t,l=t+t;u!==l;++u)if(n[u]!==n[u+t]){o.setValue(n,r);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,r,i){if(r>=.5)for(var a=0;a!==i;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,r){Um.slerpFlat(e,t,e,t,e,n,r)}},{key:"_slerpAdditive",value:function(e,t,n,r,i){var a=this._workIndex*i;Um.multiplyQuaternionsFlat(e,a,e,t,e,n),Um.slerpFlat(e,t,e,t,e,a,r)}},{key:"_lerp",value:function(e,t,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*r}}},{key:"_lerpAdditive",value:function(e,t,n,r,i){for(var a=0;a!==i;++a){var o=t+a;e[o]=e[o]+e[n+a]*r}}}]),e}(),iM="\\[\\]\\.:\\/",aM=new RegExp("[\\[\\]\\.:\\/]","g"),oM="[^\\[\\]\\.:\\/]",sM="[^"+iM.replace("\\.","")+"]",uM=/((?:WC+[\/:])*)/.source.replace("WC",oM),lM=/(WCOD+)?/.source.replace("WCOD",sM),cM=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",oM),hM=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",oM),dM=new RegExp("^"+uM+lM+cM+hM+"$"),fM=["material","materials","bones"],pM=function(){function e(t,n,r){Bd(this,e);var i=r||vM.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,i)}return $d(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),vM=function(){function e(t,n,r){Bd(this,e),this.path=n,this.parsedPath=r||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return $d(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[i];if(void 0!==u){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=a}else void 0!==u.fromArray&&void 0!==u.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(c=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(aM,"")}},{key:"parseTrackName",value:function(e){var t=dM.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==fM.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===t||i.uuid===t)return i;var a=e(i.children);if(a)return a}return null}(e.children);if(r)return r}return null}}]),e}();vM.Composite=pM,vM.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},vM.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},vM.prototype.GetterByBindingType=[vM.prototype._getValue_direct,vM.prototype._getValue_array,vM.prototype._getValue_arrayElement,vM.prototype._getValue_toArray],vM.prototype.SetterByBindingTypeAndVersioning=[[vM.prototype._setValue_direct,vM.prototype._setValue_direct_setNeedsUpdate,vM.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[vM.prototype._setValue_array,vM.prototype._setValue_array_setNeedsUpdate,vM.prototype._setValue_array_setMatrixWorldNeedsUpdate],[vM.prototype._setValue_arrayElement,vM.prototype._setValue_arrayElement_setNeedsUpdate,vM.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[vM.prototype._setValue_fromArray,vM.prototype._setValue_fromArray_setNeedsUpdate,vM.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var mM=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Bd(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=i;for(var a=n.tracks,o=a.length,s=new Array(o),u={endingStart:nm,endingEnd:nm},l=0;l!==o;++l){var c=a[l].createInterpolant(null);s[l]=c,c.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return $d(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,a=i/r,o=r/i;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,i=r.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=i,s[1]=i+n,u[0]=e/a,u[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var u=this._interpolants,l=this._propertyBindings;if(this.blendMode===om)for(var c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulateAdditive(s);else for(var d=0,f=u.length;d!==f;++d)u[d].evaluate(o),l[d].accumulate(r,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,i=this._loopCount,a=2202===n;if(0===e)return-1===i?r:a&&1===(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){var o=Math.floor(r/t);r-=t*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&1===(1&i))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=rm,r.endingEnd=rm):(r.endingStart=e?this.zeroSlopeAtStart?rm:nm:im,r.endingEnd=t?this.zeroSlopeAtEnd?rm:nm:im)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}]),e}(),gM=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this))._root=e,r._initMemoryManager(),r._accuIndex=0,r.time=0,r.timeScale=1,r}return $d(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==i;++c){var h=r[c],d=h.name,f=l[d];if(void 0!==f)a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new rM(vM.create(n,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[c]=f}o[c].resultBuffer=f.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var r=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.referenceCount&&this._removeInactiveBinding(i)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}},{key:"_addInactiveBinding",value:function(e,t,n){var r=this._bindingsByRootAndName,i=this._bindings,a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new uS(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}},{key:"clipAction",value:function(e,t,n){var r=t||this._root,i=r.uuid,a="string"===typeof e?_S.findByName(r,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],u=null;if(void 0===n&&(n=null!==a?a.blendMode:am),void 0!==s){var l=s.actionByRoot[i];if(void 0!==l&&l.blendMode===n)return l;u=s.knownActions[0],null===a&&(a=u._clip)}if(null===a)return null;var c=new mM(this,a,t,n);return this._bindAction(c,u),this._addInactiveAction(c,o,i),c}},{key:"existingAction",value:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?_S.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,i,a)}for(var s=this._bindings,u=this._nActiveBindings,l=0;l!==u;++l)s[l].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var u=a[o];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(vm);gM.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var _M=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Bd(this,n),(i=t.call(this,e,r)).meshPerAttribute=a,i}return $d(n,[{key:"copy",value:function(e){return Nd(wd(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=Nd(wd(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=Nd(wd(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(nw);_M.prototype.isInstancedInterleavedBuffer=!0;var yM=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;Bd(this,e),this.ray=new bg(t,n),this.near=r,this.far=i,this.camera=null,this.layers=new Ig,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return $d(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return xM(e,this,n,t),n.sort(bM),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,i=e.length;r<i;r++)xM(e[r],this,n,t);return n.sort(bM),n}}]),e}();function bM(e,t){return e.distance-t.distance}function xM(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var i=e.children,a=0,o=i.length;a<o;a++)xM(i[a],t,n,!0)}var wM=new Vm,kM=new xg,SM=new xg,MM=function(e){Dd(n,e);var t=zd(n);function n(e){var r;Bd(this,n);for(var i=CM(e),a=new E_,o=[],s=[],u=new d_(0,0,1),l=new d_(0,1,0),c=0;c<i.length;c++){var h=i[c];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(u.r,u.g,u.b),s.push(l.r,l.g,l.b))}a.setAttribute("position",new b_(o,3)),a.setAttribute("color",new b_(s,3));var d=new Ow({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(r=t.call(this,a,d)).type="SkeletonHelper",r.isSkeletonHelper=!0,r.root=e,r.bones=i,r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r}return $d(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,r=this.geometry,i=r.getAttribute("position");SM.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(kM.multiplyMatrices(SM,s.matrixWorld),wM.setFromMatrixPosition(kM),i.setXYZ(o,wM.x,wM.y,wM.z),kM.multiplyMatrices(SM,s.parent.matrixWorld),wM.setFromMatrixPosition(kM),i.setXYZ(o+1,wM.x,wM.y,wM.z),o+=2)}r.getAttribute("position").needsUpdate=!0,Nd(wd(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(Uw);function CM(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,CM(e.children[n]));return t}var TM=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;Bd(this,n),a=new d_(a),o=new d_(o);for(var s=i/2,u=r/i,l=r/2,c=[],h=[],d=0,f=0,p=-l;d<=i;d++,p+=u){c.push(-l,0,p,l,0,p),c.push(p,0,-l,p,0,l);var v=d===s?a:o;v.toArray(h,f),f+=3,v.toArray(h,f),f+=3,v.toArray(h,f),f+=3,v.toArray(h,f),f+=3}var m=new E_;m.setAttribute("position",new b_(c,3)),m.setAttribute("color",new b_(h,3));var g=new Ow({vertexColors:!0,toneMapped:!1});return(e=t.call(this,m,g)).type="GridHelper",e}return $d(n)}(Uw),EM=new Float32Array(1);new Int32Array(EM.buffer),tk.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(tk.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},wk.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},TM.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},MM.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},kS.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ZS.extractUrlBase(e)},kS.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Gm.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Gm.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Gm.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Gm.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Gm.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},dg.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},hy.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Lm.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Lm.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Lm.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Lm.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Lm.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Lm.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},xg.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},xg.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},xg.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vm).setFromMatrixColumn(this,3)},xg.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},xg.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},xg.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},xg.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},xg.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},xg.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},xg.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},xg.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},xg.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},xg.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},xg.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},xg.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},xg.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},xg.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},xg.prototype.makeFrustum=function(e,t,n,r,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,a)},xg.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},uy.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Um.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Um.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},bg.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},bg.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},bg.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},r_.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},r_.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},r_.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},r_.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},r_.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},r_.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),r_.getBarycoord(e,t,n,r,i)},r_.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),r_.getNormal(e,t,n,r)},kk.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},kk.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Qk(this,e)},kk.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new tS(this,e)},Pm.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Pm.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Pm.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vm.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vm.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vm.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Vm.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Vm.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Vm.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Vm.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Vm.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vm.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Bm.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Bm.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wg.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Wg.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Wg.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Wg.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Wg.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Wg.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),W_.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(W_.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Cw.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ey.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(PS.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(m_.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===fm},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(fm)}}}),m_.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?fm:dm),this},m_.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},m_.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},E_.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},E_.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new m_(arguments[1],arguments[2])))},E_.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},E_.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},E_.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},E_.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},E_.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(E_.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),nw.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?fm:dm),this},nw.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Qk.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Qk.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Qk.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},tw.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(a_.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new d_}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(J_.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Qx.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},Qx.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Qx.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Qx.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Qx.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Qx.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Qx.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Qx.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Qx.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Qx.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Qx.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Qx.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Qx.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Qx.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Qx.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Qx.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Qx.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Qx.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Qx.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Qx.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Qx.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Qx.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Qx.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Qx.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Qx.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Qx.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?um:sm}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(qx.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Fm.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),nM.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new KS).load(e,(function(e){t.setBuffer(e)})),this},ny.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},ny.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},Nm.crossOrigin=void 0,Nm.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new ES;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},Nm.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new TS;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},Nm.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Nm.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"134"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="134");var PM=Math.PI/180,AM=180/Math.PI,LM=6378137,IM=6356752.31424518;function RM(e,t,n,r,i,a){var o=NM(e,t,n);return function(e,t,n,r,i,a){var o=NM(r,i,a),s=[e-o[0],t-o[1],n-o[2]];r*=PM,i*=PM;var u=Math.cos(r),l=Math.sin(r),c=Math.cos(i),h=Math.sin(i),d=-l*s[0]+u*s[1],f=-h*u*s[0]-h*l*s[1]+c*s[2],p=c*u*s[0]+c*l*s[1]+h*s[2];return[d,f,p]}(o[0],o[1],o[2],r,i,a)}function OM(e,t,n,r,i,a){var o=function(e,t,n,r,i,a){var o=NM(r,i,a);r*=PM,i*=PM;var s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i),h=-u*e-c*s*t+l*s*n+o[0],d=s*e-c*u*t+l*u*n+o[1],f=l*t+c*n+o[2];return[h,d,f]}(e,t,n,r,i,a);return function(e,t,n){var r=LM,i=IM,a=r*r,o=i*i,s=a-o,u=Math.sqrt(s/a),l=Math.sqrt(s/o),c=Math.sqrt(e*e+t*t),h=Math.atan2(n*r,c*i),d=Math.sin(h),f=Math.cos(h),p=Math.atan2(t,e),v=Math.atan2(n+l*l*i*d*d*d,c-u*u*r*f*f*f),m=Math.sin(v),g=Math.cos(v),_=r/Math.sqrt(1-u*u*m*m);return[p*AM,v*AM,c/g-_]}(o[0],o[1],o[2])}function NM(e,t,n){var r=LM,i=IM;e*=PM,t*=PM;var a=Math.cos(e),o=Math.sin(e),s=Math.cos(t),u=Math.sin(t),l=r*r,c=i*i,h=1/Math.sqrt(l*s*s+c*u*u),d=(l*h+n)*s;return[d*a,d*o,(c*h+n)*u]}var DM,zM=function(){function e(){Bd(this,e)}return $d(e,[{key:"boundingBoxCorners",value:function(e,t){var n=OM(-t,-t,0,e.lng,e.lat,0),r=OM(t,t,0,e.lng,e.lat,0);return[{lat:n[1],lng:n[0]},{lat:r[1],lng:r[0]}]}},{key:"rotationFromCompass",value:function(e,t){var n=0,r=0,i=0;switch(t){case 1:n=Math.PI/2;break;case 3:n=-Math.PI/2,i=Math.PI;break;case 6:r=-Math.PI/2,i=-Math.PI/2;break;case 8:r=Math.PI/2,i=Math.PI/2}var a=(new xg).makeRotationZ(i),o=new Lg(n,r,e*Math.PI/180,"XYZ"),s=(new xg).makeRotationFromEuler(o),u=(new Bm).setAxisAngleFromRotationMatrix(s.multiply(a));return u.multiplyScalar(u.w).toArray().slice(0,3)}}]),e}(),jM=function(){function e(t){if(Bd(this,e),!t)throw new Error("Incorrect core image data ".concat(t));this._cache=null,this._core=t,this._spatial=null}return $d(e,[{key:"assetsCached",get:function(){return null!=this._core&&null!=this._spatial&&null!=this._cache&&null!=this._cache.image&&null!=this._cache.mesh}},{key:"cameraParameters",get:function(){return this._spatial.camera_parameters}},{key:"cameraType",get:function(){return this._spatial.camera_type}},{key:"capturedAt",get:function(){return this._spatial.captured_at}},{key:"clusterId",get:function(){return this._spatial.cluster?this._spatial.cluster.id:null}},{key:"clusterUrl",get:function(){return this._spatial.cluster?this._spatial.cluster.url:null}},{key:"compassAngle",get:function(){return null!=this._spatial.computed_compass_angle?this._spatial.computed_compass_angle:this._spatial.compass_angle}},{key:"complete",get:function(){return null!=this._spatial}},{key:"computedAltitude",get:function(){return this._spatial.computed_altitude}},{key:"computedCompassAngle",get:function(){return this._spatial.computed_compass_angle}},{key:"computedLngLat",get:function(){return this._core.computed_geometry}},{key:"creatorId",get:function(){return this._spatial.creator.id}},{key:"creatorUsername",get:function(){return this._spatial.creator.username}},{key:"exifOrientation",get:function(){return this._spatial.exif_orientation}},{key:"height",get:function(){return this._spatial.height}},{key:"image",get:function(){return this._cache.image}},{key:"image$",get:function(){return this._cache.image$}},{key:"id",get:function(){return this._core.id}},{key:"lngLat",get:function(){return null!=this._core.computed_geometry?this._core.computed_geometry:this._core.geometry}},{key:"merged",get:function(){return null!=this._spatial&&null!=this._spatial.merge_id}},{key:"mergeId",get:function(){return this._spatial.merge_id}},{key:"mesh",get:function(){return this._cache.mesh}},{key:"originalAltitude",get:function(){return this._spatial.altitude}},{key:"originalCompassAngle",get:function(){return this._spatial.compass_angle}},{key:"originalLngLat",get:function(){return this._core.geometry}},{key:"ownerId",get:function(){return this._spatial.owner?this._spatial.owner.id:null}},{key:"private",get:function(){return this._spatial.private}},{key:"qualityScore",get:function(){return this._spatial.quality_score}},{key:"rotation",get:function(){return this._spatial.computed_rotation}},{key:"scale",get:function(){return this._spatial.atomic_scale}},{key:"sequenceId",get:function(){return this._core.sequence?this._core.sequence.id:null}},{key:"sequenceEdges",get:function(){return this._cache.sequenceEdges}},{key:"sequenceEdges$",get:function(){return this._cache.sequenceEdges$}},{key:"spatialEdges",get:function(){return this._cache.spatialEdges}},{key:"spatialEdges$",get:function(){return this._cache.spatialEdges$}},{key:"width",get:function(){return this._spatial.width}},{key:"cacheAssets$",value:function(){var e=this;return this._cache.cacheAssets$(this._spatial,this.merged).pipe(wp((function(){return e})))}},{key:"cacheImage$",value:function(){var e=this;return this._cache.cacheImage$(this._spatial).pipe(wp((function(){return e})))}},{key:"cacheSequenceEdges",value:function(e){this._cache.cacheSequenceEdges(e)}},{key:"cacheSpatialEdges",value:function(e){this._cache.cacheSpatialEdges(e)}},{key:"dispose",value:function(){null!=this._cache&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}},{key:"initializeCache",value:function(e){if(null!=this._cache)throw new Error("Image cache already initialized (".concat(this.id,")."));this._cache=e}},{key:"makeComplete",value:function(e){if(null==e)throw new Error("Fill can not be null.");this._spatial=e}},{key:"resetSequenceEdges",value:function(){this._cache.resetSequenceEdges()}},{key:"resetSpatialEdges",value:function(){this._cache.resetSpatialEdges()}},{key:"uncache",value:function(){null!=this._cache&&(this._cache.dispose(),this._cache=null)}}]),e}(),BM=function(){function e(t){Bd(this,e),this._disposed=!1,this._provider=t,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new If,this._image$=this._imageChanged$.pipe(Cv(null),yv(1),Pf()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new If,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(Cv(this._sequenceEdges),yv(1),Pf()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe((function(){})),this._spatialEdgesChanged$=new If,this._spatialEdges$=this._spatialEdgesChanged$.pipe(Cv(this._spatialEdges),yv(1),Pf()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe((function(){})),this._cachingAssets$=null}return $d(e,[{key:"image",get:function(){return this._image}},{key:"image$",get:function(){return this._image$}},{key:"mesh",get:function(){return this._mesh}},{key:"sequenceEdges",get:function(){return this._sequenceEdges}},{key:"sequenceEdges$",get:function(){return this._sequenceEdges$}},{key:"spatialEdges",get:function(){return this._spatialEdges}},{key:"spatialEdges$",get:function(){return this._spatialEdges$}},{key:"cacheAssets$",value:function(e,t){var n=this;return null!=this._cachingAssets$||(this._cachingAssets$=Lp(this._cacheImage$(e),this._cacheMesh$(e,t)).pipe(wp((function(e){var t=o(e,2),r=t[0],i=t[1];return n._image=r,n._mesh=i,n})),dv((function(){n._cachingAssets$=null})),yv(1),Pf()),this._cachingAssets$.pipe(fv((function(e){return!!e._image}))).subscribe((function(){n._imageChanged$.next(n._image)}),(function(){}))),this._cachingAssets$}},{key:"cacheImage$",value:function(e){var t=this;if(null!=this._image)return vp(this);var n=this._cacheImage$(e).pipe(fv((function(e){return!!e})),Av((function(e){t._disposeImage(),t._image=e})),wp((function(){return t})),yv(1),Pf());return n.subscribe((function(){t._imageChanged$.next(t._image)}),(function(){})),n}},{key:"cacheSequenceEdges",value:function(e){this._sequenceEdges={cached:!0,edges:e},this._sequenceEdgesChanged$.next(this._sequenceEdges)}},{key:"cacheSpatialEdges",value:function(e){this._spatialEdges={cached:!0,edges:e},this._spatialEdgesChanged$.next(this._spatialEdges)}},{key:"dispose",value:function(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,null!=this._imageAborter&&(this._imageAborter(),this._imageAborter=null),null!=this._meshAborter&&(this._meshAborter(),this._meshAborter=null)}},{key:"resetSequenceEdges",value:function(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}},{key:"resetSpatialEdges",value:function(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}},{key:"_cacheImage$",value:function(e){var t=this;return Sf.create((function(n){var r=new Promise((function(e,n){t._imageAborter=n})),i=e.thumb.url;if(i)t._provider.getImageBuffer(i,r).then((function(e){t._imageAborter=null;var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){if(t._disposed){window.URL.revokeObjectURL(r.src);var e="Image load was aborted (".concat(i,")");n.error(new Error(e))}else n.next(r),n.complete()},r.onerror=function(){t._imageAborter=null,n.error(new Error("Failed to load image (".concat(i,")")))};var a=new Blob([e]);r.src=window.URL.createObjectURL(a)}),(function(e){t._imageAborter=null,n.error(e)}));else{var a=e.thumb.id,o="Incorrect thumb URL for ".concat(e.id," ")+"(".concat(a,", ").concat(i,")");n.error(new Error(o))}}))}},{key:"_cacheMesh$",value:function(e,t){var n=this;return Sf.create((function(r){if(!t)return r.next(n._createEmptyMesh()),void r.complete();var i=e.mesh.url;if(!i){var a=e.mesh.id,o="Incorrect mesh URL for ".concat(e.id," ")+"(".concat(a,", ").concat(i,")");return console.warn(o),r.next(n._createEmptyMesh()),void r.complete()}var s=new Promise((function(e,t){n._meshAborter=t}));n._provider.getMesh(i,s).then((function(e){n._meshAborter=null,n._disposed||(r.next(e),r.complete())}),(function(e){n._meshAborter=null,console.error(e),r.next(n._createEmptyMesh()),r.complete()}))}))}},{key:"_createEmptyMesh",value:function(){return{faces:[],vertices:[]}}},{key:"_disposeImage",value:function(){null!=this._image&&window.URL.revokeObjectURL(this._image.src),this._image=null}}]),e}(),FM=function(){function e(t){Bd(this,e),this._id=t.id,this._imageIds=t.image_ids}return $d(e,[{key:"id",get:function(){return this._id}},{key:"imageIds",get:function(){return this._imageIds}},{key:"dispose",value:function(){this._id=null,this._imageIds=null}},{key:"findNext",value:function(e){var t=this._imageIds.indexOf(e);return t+1>=this._imageIds.length||-1===t?null:this._imageIds[t+1]}},{key:"findPrev",value:function(e){var t=this._imageIds.indexOf(e);return 0===t||-1===t?null:this._imageIds[t-1]}}]),e}(),$M=$d((function e(){Bd(this,e),this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}));!function(e){e[e.Next=0]="Next",e[e.Prev=1]="Prev",e[e.StepLeft=2]="StepLeft",e[e.StepRight=3]="StepRight",e[e.StepForward=4]="StepForward",e[e.StepBackward=5]="StepBackward",e[e.TurnLeft=6]="TurnLeft",e[e.TurnRight=7]="TurnRight",e[e.TurnU=8]="TurnU",e[e.Spherical=9]="Spherical",e[e.Similar=10]="Similar"}(DM||(DM={}));var qM=$d((function e(){Bd(this,e),this.steps={},this.turns={},this.spherical={},this.steps[DM.StepForward]={direction:DM.StepForward,motionChange:0,useFallback:!0},this.steps[DM.StepBackward]={direction:DM.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[DM.StepLeft]={direction:DM.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[DM.StepRight]={direction:DM.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[DM.TurnLeft]={direction:DM.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[DM.TurnRight]={direction:DM.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[DM.TurnU]={direction:DM.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[DM.StepForward]={direction:DM.StepForward,directionChange:0,next:DM.StepLeft,prev:DM.StepRight},this.spherical[DM.StepBackward]={direction:DM.StepBackward,directionChange:Math.PI,next:DM.StepRight,prev:DM.StepLeft},this.spherical[DM.StepLeft]={direction:DM.StepLeft,directionChange:Math.PI/2,next:DM.StepBackward,prev:DM.StepForward},this.spherical[DM.StepRight]={direction:DM.StepRight,directionChange:-Math.PI/2,next:DM.StepForward,prev:DM.StepBackward}})),UM=function(){function e(){Bd(this,e),this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=432e5,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}return $d(e,[{key:"maxDistance",get:function(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}]),e}(),VM=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),r=t.call(this,e),Object.setPrototypeOf(Id(r),n.prototype),r.name="MapillaryError",r}return $d(n)}(Cd(Error)),HM=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),r=t.call(this,null!=e?e:"The argument is not valid."),Object.setPrototypeOf(Id(r),n.prototype),r.name="ArgumentMapillaryError",r}return $d(n)}(VM),WM=function(){function e(){Bd(this,e),this._epsilon=1e-9}return $d(e,[{key:"azimuthalToBearing",value:function(e){return-e+Math.PI/2}},{key:"degToRad",value:function(e){return Math.PI*e/180}},{key:"radToDeg",value:function(e){return 180*e/Math.PI}},{key:"rotationMatrix",value:function(e){var t=new Vm(e[0],e[1],e[2]),n=t.length();return n>0&&t.normalize(),(new xg).makeRotationAxis(t,n)}},{key:"rotate",value:function(e,t){var n=new Vm(e[0],e[1],e[2]),r=this.rotationMatrix(t);return n.applyMatrix4(r),n}},{key:"opticalCenter",value:function(e,t){var n=[-e[0],-e[1],-e[2]],r=[-t[0],-t[1],-t[2]];return this.rotate(r,n)}},{key:"viewingDirection",value:function(e){var t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)}},{key:"wrap",value:function(e,t,n){if(n<t)throw new Error("Invalid arguments: max must be larger than min.");for(var r=n-t;e>n||e<t;)e>n?e-=r:e<t&&(e+=r);return e}},{key:"wrapAngle",value:function(e){return this.wrap(e,-Math.PI,Math.PI)}},{key:"clamp",value:function(e,t,n){return e<t?t:e>n?n:e}},{key:"angleBetweenVector2",value:function(e,t,n,r){var i=Math.atan2(r,n)-Math.atan2(t,e);return this.wrapAngle(i)}},{key:"angleDifference",value:function(e,t){var n=t-e;return this.wrapAngle(n)}},{key:"relativeRotationAngle",value:function(e,t){var n=this.rotationMatrix([-e[0],-e[1],-e[2]]),r=this.rotationMatrix(t),i=n.multiply(r).elements,a=i[0]+i[5]+i[10];return Math.acos(Math.max(Math.min((a-1)/2,1),-1))}},{key:"angleToPlane",value:function(e,t){var n=(new Vm).fromArray(e),r=n.length();if(r<this._epsilon)return 0;var i=n.dot((new Vm).fromArray(t));return Math.asin(i/r)}},{key:"azimuthal",value:function(e,t){var n=(new Vm).fromArray(e),r=(new Vm).fromArray(t),i=n.clone().dot(r),a=n.clone().sub(r.clone().multiplyScalar(i));return Math.atan2(a.y,a.x)}},{key:"distanceFromLngLat",value:function(e,t,n,r){var i=this.degToRad(r-t),a=this.degToRad(n-e),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.degToRad(t))*Math.cos(this.degToRad(r))*Math.sin(a/2)*Math.sin(a/2);return 12742e3*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}}]),e}(),GM=new WM;function ZM(e){return"spherical"===e}function YM(e){return"fisheye"===e}function XM(e,t,n){var r=RM(e.lng,e.lat,e.alt,n.lng,n.lat,n.alt),i=GM.rotate(r,t);return[-i.x,-i.y,-i.z]}function KM(e,t,n,r,i){for(var a=[],o=0;o<t.length;++o)for(var s=t[o],u=n[o],l=0;l<=r;++l)a.push([s[0]+u[0]*l/r,s[1]+u[1]*l/r]);var c=new Q_;return c.up.copy(e.upVector()),c.position.copy((new Vm).fromArray(e.unprojectSfM([0,0],0))),c.lookAt((new Vm).fromArray(e.unprojectSfM([0,0],10))),c.updateMatrix(),c.updateMatrixWorld(!0),a.map((function(t){var n=e.unprojectBasic(t,1e4),r=i.worldToCamera(n,c);return[Math.abs(r[0]/r[2]),Math.abs(r[1]/r[2])]}))}var JM=function(){function e(t,n,r){Bd(this,e),this._spatial=new WM,this._settings=null!=t?t:new UM,this._directions=null!=n?n:new qM,this._coefficients=null!=r?r:new $M}return $d(e,[{key:"getPotentialEdges",value:function(e,t,n){if(!e.complete)throw new HM("Image has to be full.");if(!e.merged)return[];var r,i=this._spatial.viewingDirection(e.rotation),a=this._spatial.angleToPlane(i.toArray(),[0,0,1]),o=[],s=Ad(t);try{for(s.s();!(r=s.n()).done;){var u=r.value;if(u.merged&&u.id!==e.id){var l=RM(u.lngLat.lng,u.lngLat.lat,u.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude),c=new Vm(l[0],l[1],l[2]),h=c.length();if(!(h>this._settings.maxDistance&&n.indexOf(u.id)<0)){var d=this._spatial.angleBetweenVector2(i.x,i.y,c.x,c.y),f=this._spatial.angleToPlane(c.toArray(),[0,0,1]),p=this._spatial.viewingDirection(u.rotation),v=this._spatial.angleBetweenVector2(i.x,i.y,p.x,p.y),m=this._spatial.angleToPlane(p.toArray(),[0,0,1])-a,g=this._spatial.relativeRotationAngle(e.rotation,u.rotation),_=this._spatial.angleBetweenVector2(1,0,c.x,c.y),y=null!=u.sequenceId&&null!=e.sequenceId&&u.sequenceId===e.sequenceId,b=u.mergeId===e.mergeId,x=u.creatorId===e.creatorId,w={capturedAt:u.capturedAt,directionChange:v,distance:h,spherical:ZM(u.cameraType),id:u.id,motionChange:d,rotation:g,sameMergeCC:b,sameSequence:y,sameUser:x,sequenceId:u.sequenceId,verticalDirectionChange:m,verticalMotion:f,worldMotionAzimuth:_};o.push(w)}}}}catch(CO){s.e(CO)}finally{s.f()}return o}},{key:"computeSequenceEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");if(e.sequenceId!==t.id)throw new HM("Image and sequence does not correspond.");var n=[],r=t.findNext(e.id);null!=r&&n.push({data:{direction:DM.Next,worldMotionAzimuth:Number.NaN},source:e.id,target:r});var i=t.findPrev(e.id);return null!=i&&n.push({data:{direction:DM.Prev,worldMotionAzimuth:Number.NaN},source:e.id,target:i}),n}},{key:"computeSimilarEdges",value:function(e,t){var n=this;if(!e.complete)throw new HM("Image has to be full.");var r,i=ZM(e.cameraType),a={},o=Ad(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(null!=s.sequenceId&&!s.sameSequence){if(i){if(!s.spherical)continue}else if(!s.spherical&&Math.abs(s.directionChange)>this._settings.similarMaxDirectionChange)continue;s.distance>this._settings.similarMaxDistance||s.sameUser&&Math.abs(s.capturedAt-e.capturedAt)<this._settings.similarMinTimeDifference||(null==a[s.sequenceId]&&(a[s.sequenceId]=[]),a[s.sequenceId].push(s))}}}catch(CO){o.e(CO)}finally{o.f()}var u=[],l=ZM(e.cameraType)?function(e){return e.distance}:function(e){return n._coefficients.similarDistance*e.distance+n._coefficients.similarRotation*e.rotation};for(var c in a)if(a.hasOwnProperty(c)){var h,d=Number.MAX_VALUE,f=null,p=Ad(a[c]);try{for(p.s();!(h=p.n()).done;){var v=h.value,m=l(v);m<d&&(d=m,f=v)}}catch(CO){p.e(CO)}finally{p.f()}null!=f&&u.push(f)}return u.map((function(t){return{data:{direction:DM.Similar,worldMotionAzimuth:t.worldMotionAzimuth},source:e.id,target:t.id}}))}},{key:"computeStepEdges",value:function(e,t,n,r){if(!e.complete)throw new HM("Image has to be full.");var i=[];if(ZM(e.cameraType))return i;for(var a in this._directions.steps)if(this._directions.steps.hasOwnProperty(a)){var o,s=this._directions.steps[a],u=Number.MAX_VALUE,l=null,c=null,h=Ad(t);try{for(h.s();!(o=h.n()).done;){var d=o.value;if(!d.spherical&&!(Math.abs(d.directionChange)>this._settings.stepMaxDirectionChange)){var f=this._spatial.angleDifference(s.motionChange,d.motionChange),p=this._spatial.angleDifference(d.directionChange,f),v=Math.max(Math.abs(f),Math.abs(p));if(!(Math.abs(v)>this._settings.stepMaxDrift)){var m=d.id;if(!s.useFallback||m!==n&&m!==r||(c=d),!(d.distance>this._settings.stepMaxDistance)){f=Math.sqrt(f*f+d.verticalMotion*d.verticalMotion);var g=this._coefficients.stepPreferredDistance*Math.abs(d.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*f/this._settings.stepMaxDrift+this._coefficients.stepRotation*d.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(d.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(d.sameMergeCC?0:1);g<u&&(u=g,l=d)}}}}}catch(CO){h.e(CO)}finally{h.f()}null!=(l=null==l?c:l)&&i.push({data:{direction:s.direction,worldMotionAzimuth:l.worldMotionAzimuth},source:e.id,target:l.id})}return i}},{key:"computeTurnEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");var n=[];if(ZM(e.cameraType))return n;for(var r in this._directions.turns)if(this._directions.turns.hasOwnProperty(r)){var i,a=this._directions.turns[r],o=Number.MAX_VALUE,s=null,u=Ad(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(!l.spherical&&!(l.distance>this._settings.turnMaxDistance)){var c=a.direction!==DM.TurnU&&l.distance<this._settings.turnMaxRigDistance&&Math.abs(l.directionChange)>this._settings.turnMinRigDirectionChange,h=this._spatial.angleDifference(a.directionChange,l.directionChange),d=void 0;if(c&&l.directionChange*a.directionChange>0&&Math.abs(l.directionChange)<Math.abs(a.directionChange))d=-Math.PI/2+Math.abs(l.directionChange);else{if(Math.abs(h)>this._settings.turnMaxDirectionChange)continue;var f=a.motionChange?this._spatial.angleDifference(a.motionChange,l.motionChange):0;f=Math.sqrt(f*f+l.verticalMotion*l.verticalMotion),d=this._coefficients.turnDistance*l.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*f/Math.PI+this._coefficients.turnSequencePenalty*(l.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(l.sameMergeCC?0:1)}d<o&&(o=d,s=l)}}}catch(CO){u.e(CO)}finally{u.f()}null!=s&&n.push({data:{direction:a.direction,worldMotionAzimuth:s.worldMotionAzimuth},source:e.id,target:s.id})}return n}},{key:"computePerspectiveToSphericalEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");if(ZM(e.cameraType))return[];var n,r=Number.MAX_VALUE,i=null,a=Ad(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.spherical){var s=this._coefficients.sphericalPreferredDistance*Math.abs(o.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(o.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(o.sameMergeCC?0:1);s<r&&(r=s,i=o)}}}catch(CO){a.e(CO)}finally{a.f()}return null==i?[]:[{data:{direction:DM.Spherical,worldMotionAzimuth:i.worldMotionAzimuth},source:e.id,target:i.id}]}},{key:"computeSphericalEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");if(!ZM(e.cameraType))return[];var n,r=[],i=[],a=[],o=Ad(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!(s.distance>this._settings.sphericalMaxDistance))if(s.spherical){if(s.distance<this._settings.sphericalMinDistance)continue;i.push(s)}else for(var u in this._directions.spherical)if(this._directions.spherical.hasOwnProperty(u)){var l=this._directions.spherical[u],c=this._spatial.angleDifference(s.directionChange,s.motionChange),h=this._spatial.angleDifference(l.directionChange,c);if(!(Math.abs(h)>this._settings.sphericalMaxStepTurnChange)){a.push([l.direction,s]);break}}}}catch(CO){o.e(CO)}finally{o.f()}for(var d=Math.PI/this._settings.sphericalMaxItems,f=[],p=[],v=0;v<this._settings.sphericalMaxItems;v++){var m,g=v/this._settings.sphericalMaxItems*2*Math.PI,_=Number.MAX_VALUE,y=null,b=Ad(i);try{for(b.s();!(m=b.n()).done;){var x=m.value,w=this._spatial.angleDifference(g,x.motionChange);if(!(Math.abs(w)>d)){var k,S=Number.MAX_VALUE,M=Ad(f);try{for(M.s();!(k=M.n()).done;){var C=k.value,T=Math.abs(this._spatial.angleDifference(C,x.motionChange));T<S&&(S=T)}}catch(CO){M.e(CO)}finally{M.f()}if(!(S<=d)){var E=this._coefficients.sphericalPreferredDistance*Math.abs(x.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(w)/d+this._coefficients.sphericalSequencePenalty*(x.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(x.sameMergeCC?0:1);E<_&&(_=E,y=x)}}}}catch(CO){b.e(CO)}finally{b.f()}null!=y?(f.push(y.motionChange),r.push({data:{direction:DM.Spherical,worldMotionAzimuth:y.worldMotionAzimuth},source:e.id,target:y.id})):p.push(g)}var P={};P[DM.Spherical]=f,P[DM.StepForward]=[],P[DM.StepLeft]=[],P[DM.StepBackward]=[],P[DM.StepRight]=[];for(var A=0,L=p;A<L.length;A++){var I=L[A],R=[];for(var O in this._directions.spherical)if(this._directions.spherical.hasOwnProperty(O)){var N,D=this._directions.spherical[O],z=P[DM.Spherical].concat(P[D.direction]).concat(P[D.prev]).concat(P[D.next]),j=Number.MAX_VALUE,B=null,F=Ad(a);try{for(F.s();!(N=F.n()).done;){var $=N.value;if($[0]===D.direction){var q=this._spatial.angleDifference(I,$[1].motionChange);if(!(Math.abs(q)>d)){var U,V=Number.MAX_VALUE,H=Ad(z);try{for(H.s();!(U=H.n()).done;){var W=U.value,G=Math.abs(this._spatial.angleDifference(W,$[1].motionChange));G<V&&(V=G)}}catch(CO){H.e(CO)}finally{H.f()}if(!(V<=d)){var Z=this._coefficients.sphericalPreferredDistance*Math.abs($[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(q)/d+this._coefficients.sphericalMergeCCPenalty*($[1].sameMergeCC?0:1);Z<j&&(j=Z,B=$)}}}}}catch(CO){F.e(CO)}finally{F.f()}null!=B&&(R.push(B),r.push({data:{direction:B[0],worldMotionAzimuth:B[1].worldMotionAzimuth},source:e.id,target:B[1].id}))}for(var Y=0,X=R;Y<X.length;Y++){var K=X[Y];P[K[0]].push(K[1].motionChange)}}return r}}]),e}(),QM=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),r=t.call(this,e),Object.setPrototypeOf(Id(r),n.prototype),r.name="GraphMapillaryError",r}return $d(n)}(VM),eC=function(){function e(t,n,r,i,a,o){Bd(this,e),this._api=t,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new If,this._filterCreator=null!==a&&void 0!==a?a:new Iv,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new If,this._filter$=jp(vp(this._filter),this._filterSubject$).pipe(yv(1),Pf()),this._filterSubscription=this._filter$.subscribe((function(){})),this._defaultAlt=2,this._edgeCalculator=null!==i&&void 0!==i?i:new JM,this._graphCalculator=null!==r&&void 0!==r?r:new zM,this._configuration=null!==o&&void 0!==o?o:{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=null!==n&&void 0!==n?n:new e._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}return $d(e,[{key:"api",get:function(){return this._api}},{key:"changed$",get:function(){return this._changed$}},{key:"filter$",get:function(){return this._filter$}},{key:"cacheBoundingBox$",value:function(e,t){var n=this,r=this._api.data.geometry.bboxToCellIds(e,t).filter((function(e){return!(e in n._cachedTiles)})).map((function(e){return e in n._cachingTiles$?n._cachingTiles$[e]:n._cacheTile$(e)}));return 0===r.length&&r.push(vp(this)),ap(r).pipe(Dp(),vv(),Np((function(){var r,i=[],a=[],o=Ad(n._nodeIndex.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map((function(e){return e.node})));try{for(o.s();!(r=o.n()).done;){var s=r.value;s.complete?i.push(s):a.push(s.id)}}catch(CO){o.e(CO)}finally{o.f()}for(var u=[];a.length>0;)u.push(a.splice(0,200));var l=vp(i),c=u.map((function(e){return n._api.getSpatialImages$(e).pipe(wp((function(e){var t,r=[],i=Ad(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(n.hasNode(a.node_id)){var o=n.getNode(a.node_id);o.complete||n._makeFull(o,a.node),r.push(o)}}}catch(CO){i.e(CO)}finally{i.f()}return r})))}));return Hp(l,ap(c).pipe(Dp()))})),ev((function(e,t){return e.concat(t)})))}},{key:"cacheCell$",value:function(e){var t=this,n=e in this._cachedTiles?vp(this):e in this._cachingTiles$?this._cachingTiles$[e]:this._cacheTile$(e);return n.pipe(Np((function(){var n=t._cachedTiles[e];n.accessed=(new Date).getTime();var r,i=[],a=[],o=Ad(n.nodes);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.complete?i.push(s):a.push(s.id)}}catch(CO){o.e(CO)}finally{o.f()}for(var u=[];a.length>0;)u.push(a.splice(0,200));var l=vp(i),c=u.map((function(e){return t._api.getSpatialImages$(e).pipe(wp((function(e){var n,r=[],i=Ad(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.node){var o=a.node_id;if(t.hasNode(o)){var s=t.getNode(o);s.complete||t._makeFull(s,a.node),r.push(s)}}else console.warn("Image is empty (".concat(a.node,")"))}}catch(CO){i.e(CO)}finally{i.f()}return r})))}));return Hp(l,ap(c).pipe(Dp()))})),ev((function(e,t){return e.concat(t)})))}},{key:"cacheFill$",value:function(e){var t=this;if(e in this._cachingFull$)throw new QM("Cannot fill node while caching full (".concat(e,")."));if(!this.hasNode(e))throw new QM("Cannot fill node that does not exist in graph (".concat(e,")."));if(e in this._cachingFill$)return this._cachingFill$[e];var n=this.getNode(e);if(n.complete)throw new QM("Cannot fill node that is already full (".concat(e,")."));return this._cachingFill$[e]=this._api.getSpatialImages$([e]).pipe(Av((function(e){var r,i=Ad(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.node||console.warn("Image is empty ".concat(a.node_id)),n.complete||t._makeFull(n,a.node),delete t._cachingFill$[a.node_id]}}catch(CO){i.e(CO)}finally{i.f()}})),wp((function(){return t})),dv((function(){e in t._cachingFill$&&delete t._cachingFill$[e],t._changed$.next(t)})),_v(),Pf()),this._cachingFill$[e]}},{key:"cacheFull$",value:function(e){var t=this;if(e in this._cachingFull$)return this._cachingFull$[e];if(this.hasNode(e))throw new QM("Cannot cache full node that already exist in graph (".concat(e,")."));return this._cachingFull$[e]=this._api.getImages$([e]).pipe(Av((function(n){var r,i=Ad(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!a.node)throw new QM("Image does not exist (".concat(e,", ").concat(a.node,")."));var o=a.node_id;if(t.hasNode(o)){var s=t.getNode(e);s.complete||t._makeFull(s,a.node)}else{if(null==a.node.sequence.id)throw new QM("Image has no sequence key (".concat(e,")."));var u=new jM(a.node);t._makeFull(u,a.node);var l=t._api.data.geometry.lngLatToCellId(u.originalLngLat);t._preStore(l,u),t._setNode(u),delete t._cachingFull$[o]}}}catch(CO){i.e(CO)}finally{i.f()}})),wp((function(){return t})),dv((function(){e in t._cachingFull$&&delete t._cachingFull$[e],t._changed$.next(t)})),_v(),Pf()),this._cachingFull$[e]}},{key:"cacheNodeSequence$",value:function(e){if(!this.hasNode(e))throw new QM("Cannot cache sequence edges of node that does not exist in graph (".concat(e,")."));var t=this.getNode(e);if(t.sequenceId in this._sequences)throw new QM("Sequence already cached (".concat(e,"), (").concat(t.sequenceId,")."));return this._cacheSequence$(t.sequenceId)}},{key:"cacheSequence$",value:function(e){if(e in this._sequences)throw new QM("Sequence already cached (".concat(e,")"));return this._cacheSequence$(e)}},{key:"cacheSequenceEdges",value:function(e){var t=this.getNode(e);if(!(t.sequenceId in this._sequences))throw new QM("Sequence is not cached (".concat(e,"), (").concat(t.sequenceId,")"));var n=this._sequences[t.sequenceId].sequence,r=this._edgeCalculator.computeSequenceEdges(t,n);t.cacheSequenceEdges(r)}},{key:"cacheSequenceNodes$",value:function(e,t){var n=this;if(!this.hasSequence(e))throw new QM("Cannot cache sequence nodes of sequence that does not exist in graph (".concat(e,")."));if(this.hasSequenceNodes(e))throw new QM("Sequence nodes already cached (".concat(e,")."));var r=this.getSequence(e);if(r.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[r.id];var i=[],a=r.imageIds.slice();if(t&&a.length>50){var o=a.indexOf(t),s=Math.max(0,Math.min(o-25,a.length-50));i.push(a.splice(s,50))}for(;a.length>0;)i.push(a.splice(0,200));var u=i.length,l=ap(i).pipe(Np((function(e){return n._api.getImages$(e).pipe(Av((function(e){var t,r=Ad(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.node){var a=i.node_id;if(n.hasNode(a)){var o=n.getNode(a);o.complete||n._makeFull(o,i.node)}else{null==i.node.sequence.id&&console.warn("Sequence missing, discarding node (".concat(i.node_id,")"));var s=new jM(i.node);n._makeFull(s,i.node);var l=n._api.data.geometry.lngLatToCellId(s.originalLngLat);n._preStore(l,s),n._setNode(s)}}else console.warn("Image empty (".concat(i.node_id,")"))}}catch(CO){r.e(CO)}finally{r.f()}u--})),wp((function(){return n})))}),6),vv(),dv((function(){delete n._cachingSequenceNodes$[r.id],0===u&&(n._cachedSequenceNodes[r.id]=!0)})),_v(),Pf());return this._cachingSequenceNodes$[r.id]=l,l}},{key:"cacheSpatialArea$",value:function(e){var t=this;if(!this.hasNode(e))throw new QM("Cannot cache spatial area of node that does not exist in graph (".concat(e,")."));if(e in this._cachedSpatialEdges)throw new QM("Image already spatially cached (".concat(e,")."));if(!(e in this._requiredSpatialArea))throw new QM("Spatial area not determined (".concat(e,")."));var n=this._requiredSpatialArea[e];if(0===Object.keys(n.cacheNodes).length)throw new QM("Spatial nodes already cached (".concat(e,")."));if(e in this._cachingSpatialArea$)return this._cachingSpatialArea$[e];for(var r=[];n.cacheKeys.length>0;)r.push(n.cacheKeys.splice(0,200));for(var i=r.length,a=[],o=function(){var r=u[s],o=t._api.getSpatialImages$(r).pipe(Av((function(r){var a,o=Ad(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.node){var u=s.node_id,l=n.cacheNodes[u];l.complete||t._makeFull(l,s.node),delete n.cacheNodes[u]}else console.warn("Image is empty (".concat(s.node_id,")"))}}catch(CO){o.e(CO)}finally{o.f()}0===--i&&delete t._cachingSpatialArea$[e]})),wp((function(){return t})),Jp((function(a){var o,s=Ad(r);try{for(s.s();!(o=s.n()).done;){var u=o.value;u in n.all&&delete n.all[u],u in n.cacheNodes&&delete n.cacheNodes[u]}}catch(CO){s.e(CO)}finally{s.f()}throw 0===--i&&delete t._cachingSpatialArea$[e],a})),dv((function(){0===Object.keys(n.cacheNodes).length&&t._changed$.next(t)})),_v(),Pf());a.push(o)},s=0,u=r;s<u.length;s++)o();return this._cachingSpatialArea$[e]=a,a}},{key:"cacheSpatialEdges",value:function(e){if(e in this._cachedSpatialEdges)throw new QM("Spatial edges already cached (".concat(e,")."));var t=this.getNode(e),n=this._sequences[t.sequenceId].sequence,r=[],i=n.findPrev(t.id);null!=i&&r.push(i);var a=n.findNext(t.id);null!=a&&r.push(a);var o=this._requiredSpatialArea[e].all,s=[],u=this._filter;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];u(c)&&s.push(c)}var h=this._edgeCalculator.getPotentialEdges(t,s,r),d=this._edgeCalculator.computeStepEdges(t,h,i,a);d=(d=(d=(d=d.concat(this._edgeCalculator.computeTurnEdges(t,h))).concat(this._edgeCalculator.computeSphericalEdges(t,h))).concat(this._edgeCalculator.computePerspectiveToSphericalEdges(t,h))).concat(this._edgeCalculator.computeSimilarEdges(t,h)),t.cacheSpatialEdges(d),this._cachedSpatialEdges[e]=t,delete this._requiredSpatialArea[e],delete this._cachedNodeTiles[e]}},{key:"cacheTiles$",value:function(e){var t=this;if(e in this._cachedNodeTiles)throw new QM("Tiles already cached (".concat(e,")."));if(e in this._cachedSpatialEdges)throw new QM("Spatial edges already cached so tiles considered cached (".concat(e,")."));if(!(e in this._requiredNodeTiles))throw new QM("Tiles have not been determined (".concat(e,")."));var n=this._requiredNodeTiles[e];if(0===n.cache.length&&0===n.caching.length)throw new QM("Tiles already cached (".concat(e,")."));if(!this.hasNode(e))throw new QM("Cannot cache tiles of node that does not exist in graph (".concat(e,")."));var r=n.cache.slice();n.caching=this._requiredNodeTiles[e].caching.concat(r),n.cache=[];var i,a=[],o=Ad(n.caching);try{var s=function(){var r=i.value,o=r in t._cachingTiles$?t._cachingTiles$[r]:t._cacheTile$(r);a.push(o.pipe(Av((function(i){var a=n.caching.indexOf(r);a>-1&&n.caching.splice(a,1),0===n.caching.length&&0===n.cache.length&&(delete t._requiredNodeTiles[e],t._cachedNodeTiles[e]=!0)})),Jp((function(i){var a=n.caching.indexOf(r);throw a>-1&&n.caching.splice(a,1),0===n.caching.length&&0===n.cache.length&&(delete t._requiredNodeTiles[e],t._cachedNodeTiles[e]=!0),i})),dv((function(){t._changed$.next(t)})),_v(),Pf()))};for(o.s();!(i=o.n()).done;)s()}catch(CO){o.e(CO)}finally{o.f()}return a}},{key:"initializeCache",value:function(e){if(e in this._cachedNodes)throw new QM("Image already in cache (".concat(e,")."));var t=this.getNode(e),n=this._api.data;t.initializeCache(new BM(n));var r=(new Date).getTime();this._cachedNodes[e]={accessed:r,node:t},this._updateCachedTileAccess(e,r)}},{key:"isCachingFill",value:function(e){return e in this._cachingFill$}},{key:"isCachingFull",value:function(e){return e in this._cachingFull$}},{key:"isCachingNodeSequence",value:function(e){return this.getNode(e).sequenceId in this._cachingSequences$}},{key:"isCachingSequence",value:function(e){return e in this._cachingSequences$}},{key:"isCachingSequenceNodes",value:function(e){return e in this._cachingSequenceNodes$}},{key:"isCachingTiles",value:function(e){return e in this._requiredNodeTiles&&0===this._requiredNodeTiles[e].cache.length&&this._requiredNodeTiles[e].caching.length>0}},{key:"hasInitializedCache",value:function(e){return e in this._cachedNodes}},{key:"hasNode",value:function(e){var t=(new Date).getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),e in this._nodes}},{key:"hasNodeSequence",value:function(e){var t=this.getNode(e).sequenceId,n=t in this._sequences;return n&&(this._sequences[t].accessed=(new Date).getTime()),n}},{key:"hasSequence",value:function(e){var t=e in this._sequences;return t&&(this._sequences[e].accessed=(new Date).getTime()),t}},{key:"hasSequenceNodes",value:function(e){return e in this._cachedSequenceNodes}},{key:"hasSpatialArea",value:function(e){if(!this.hasNode(e))throw new QM("Spatial area nodes cannot be determined if node not in graph (".concat(e,")."));if(e in this._cachedSpatialEdges)return!0;if(e in this._requiredSpatialArea)return 0===Object.keys(this._requiredSpatialArea[e].cacheNodes).length;var t,n=this.getNode(e),r=this._graphCalculator.boundingBoxCorners(n.lngLat,this._tileThreshold),i={all:{},cacheKeys:[],cacheNodes:{}},a=Ad(this._nodeIndex.search({maxX:r[1].lng,maxY:r[1].lat,minX:r[0].lng,minY:r[0].lat}));try{for(a.s();!(t=a.n()).done;){var o=t.value;i.all[o.node.id]=o.node,o.node.complete||(i.cacheKeys.push(o.node.id),i.cacheNodes[o.node.id]=o.node)}}catch(CO){a.e(CO)}finally{a.f()}return this._requiredSpatialArea[e]=i,0===i.cacheKeys.length}},{key:"hasTiles",value:function(e){var t=this;if(e in this._cachedNodeTiles)return!0;if(e in this._cachedSpatialEdges)return!0;if(!this.hasNode(e))throw new QM("Image does not exist in graph (".concat(e,")."));var n={cache:[],caching:[]};if(e in this._requiredNodeTiles)n=this._requiredNodeTiles[e];else{var r=this.getNode(e),i=o(this._graphCalculator.boundingBoxCorners(r.lngLat,this._tileThreshold),2),a=i[0],s=i[1];n.cache=this._api.data.geometry.bboxToCellIds(a,s).filter((function(e){return!(e in t._cachedTiles)})),n.cache.length>0&&(this._requiredNodeTiles[e]=n)}return 0===n.cache.length&&0===n.caching.length}},{key:"getNode",value:function(e){var t=(new Date).getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),this._nodes[e]}},{key:"getSequence",value:function(e){var t=this._sequences[e];return t.accessed=(new Date).getTime(),t.sequence}},{key:"resetSpatialEdges",value:function(){for(var e=0,t=Object.keys(this._cachedSpatialEdges);e<t.length;e++){var n=t[e];this._cachedSpatialEdges[n].resetSpatialEdges(),delete this._cachedSpatialEdges[n]}}},{key:"reset",value:function(e){var t,n=[],r=Ad(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!this.hasNode(i))throw new Error("Image does not exist ".concat(i));var a=this.getNode(i);a.resetSequenceEdges(),a.resetSpatialEdges(),n.push(a)}}catch(CO){r.e(CO)}finally{r.f()}for(var o=0,s=Object.keys(this._cachedNodes);o<s.length;o++){var u=s[o];-1===e.indexOf(u)&&(this._cachedNodes[u].node.dispose(),delete this._cachedNodes[u])}this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(var l=0,c=n;l<c.length;l++){var h=c[l];this._nodes[h.id]=h;var d=this._api.data.geometry.lngLatToCellId(h.originalLngLat);this._preStore(d,h)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}},{key:"setFilter",value:function(e){this._filter=this._filterCreator.createFilter(e),this._filterSubject$.next(this._filter)}},{key:"uncache",value:function(e,t,n){var r={};this._addNewKeys(r,this._cachingFull$),this._addNewKeys(r,this._cachingFill$),this._addNewKeys(r,this._cachingSpatialArea$),this._addNewKeys(r,this._requiredNodeTiles),this._addNewKeys(r,this._requiredSpatialArea);var i,a=Ad(e);try{for(a.s();!(i=a.n()).done;){var s=i.value;s in r||(r[s]=!0)}}catch(CO){a.e(CO)}finally{a.f()}var u=this._tileThreshold,l=this._graphCalculator,c=this._api.data.geometry,h=new Set(t);for(var d in r)if(r.hasOwnProperty(d)){var f,p=this._nodes[d],v=o(l.boundingBoxCorners(p.lngLat,u),2),m=v[0],g=v[1],_=Ad(c.bboxToCellIds(m,g));try{for(_.s();!(f=_.n()).done;){var y=f.value;h.has(y)||h.add(y)}}catch(CO){_.e(CO)}finally{_.f()}}var b=[];for(var x in this._cachedTiles)this._cachedTiles.hasOwnProperty(x)&&!h.has(x)&&b.push([x,this._cachedTiles[x]]);var w,k=b.sort((function(e,t){return t[1].accessed-e[1].accessed})).slice(this._configuration.maxUnusedTiles).map((function(e){return e[0]})),S=Ad(k);try{for(S.s();!(w=S.n()).done;){var M=w.value;this._uncacheTile(M,n)}}catch(CO){S.e(CO)}finally{S.f()}var C=[],T=[];for(var E in this._preStored)if(this._preStored.hasOwnProperty(E)&&!(E in this._cachingTiles$)){var P=this._preStored[E];for(var A in P)P.hasOwnProperty(A)&&!(A in r)&&P[A].sequenceId!==n&&(A in this._cachedNodes?C.push([this._cachedNodes[A],E]):T.push([A,E]))}var L=C.sort((function(e,t){var n=o(e,1)[0];return o(t,1)[0].accessed-n.accessed})).slice(this._configuration.maxUnusedPreStoredImages).map((function(e){var t=o(e,2),n=t[0],r=t[1];return[n.node.id,r]}));this._uncachePreStored(T),this._uncachePreStored(L);var I=[];for(var R in this._cachedNodes)this._cachedNodes.hasOwnProperty(R)&&!(R in r)&&I.push(this._cachedNodes[R]);var O,N=Ad(I.sort((function(e,t){return t.accessed-e.accessed})).slice(this._configuration.maxUnusedImages));try{for(N.s();!(O=N.n()).done;){var D=O.value;D.node.uncache();var z=D.node.id;delete this._cachedNodes[z],z in this._cachedNodeTiles&&delete this._cachedNodeTiles[z],z in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[z]}}catch(CO){N.e(CO)}finally{N.f()}var j=[];for(var B in this._sequences)this._sequences.hasOwnProperty(B)&&!(B in this._cachingSequences$)&&B!==n&&j.push(this._sequences[B]);var F,$=Ad(j.sort((function(e,t){return t.accessed-e.accessed})).slice(this._configuration.maxSequences));try{for($.s();!(F=$.n()).done;){var q=F.value,U=q.sequence.id;delete this._sequences[U],U in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[U],q.sequence.dispose()}}catch(CO){$.e(CO)}finally{$.f()}}},{key:"updateCells$",value:function(e){var t=this,n=this._cachedTiles,r=this._cachingTiles$;return ap(e).pipe(Np((function(e){return e in n?t._updateCell$(e):e in r?r[e].pipe(Jp((function(){return vp(t)})),Np((function(){return t._updateCell$(e)}))):Hf()})))}},{key:"unsubscribe",value:function(){this._filterSubscription.unsubscribe()}},{key:"_addNewKeys",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&this.hasNode(n)&&(n in e||(e[n]=!0))}},{key:"_cacheSequence$",value:function(e){var t=this;return e in this._cachingSequences$||(this._cachingSequences$[e]=this._api.getSequence$(e).pipe(Av((function(n){n?(n.id in t._sequences||(t._sequences[n.id]={accessed:(new Date).getTime(),sequence:new FM(n)}),delete t._cachingSequences$[e]):console.warn("Sequence does not exist "+"(".concat(e,")"))})),wp((function(){return t})),dv((function(){e in t._cachingSequences$&&delete t._cachingSequences$[e],t._changed$.next(t)})),_v(),Pf())),this._cachingSequences$[e]}},{key:"_cacheTile$",value:function(e){var t=this;return this._cachingTiles$[e]=this._api.getCoreImages$(e).pipe(Av((function(n){if(!(e in t._cachedTiles)){var r=n.images;t._nodeIndexTiles[e]=[],t._cachedTiles[e]={accessed:(new Date).getTime(),nodes:[]};var i,a=t._cachedTiles[e].nodes,o=t._removeFromPreStore(e),s=Ad(r);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(!u)break;if(null!=u.sequence.id)if(null!=o&&u.id in o){var l=o[u.id];delete o[u.id],a.push(l);var c={lat:l.lngLat.lat,lng:l.lngLat.lng,node:l};t._nodeIndex.insert(c),t._nodeIndexTiles[e].push(c),t._nodeToTile[l.id]=e}else{var h=new jM(u);a.push(h);var d={lat:h.lngLat.lat,lng:h.lngLat.lng,node:h};t._nodeIndex.insert(d),t._nodeIndexTiles[e].push(d),t._nodeToTile[h.id]=e,t._setNode(h)}else console.warn("Sequence missing, discarding "+"node (".concat(u.id,")"))}}catch(CO){s.e(CO)}finally{s.f()}delete t._cachingTiles$[e]}})),wp((function(){return t})),Jp((function(n){throw delete t._cachingTiles$[e],n})),_v(),Pf()),this._cachingTiles$[e]}},{key:"_makeFull",value:function(e,t){null==t.computed_altitude&&(t.computed_altitude=this._defaultAlt),null==t.computed_rotation&&(t.computed_rotation=this._graphCalculator.rotationFromCompass(t.compass_angle,t.exif_orientation)),e.makeComplete(t)}},{key:"_preStore",value:function(e,t){e in this._preStored||(this._preStored[e]={}),this._preStored[e][t.id]=t}},{key:"_removeFromPreStore",value:function(e){var t=null;return e in this._preStored&&(t=this._preStored[e],delete this._preStored[e]),t}},{key:"_setNode",value:function(e){var t=e.id;if(this.hasNode(t))throw new QM("Image already exist (".concat(t,")."));this._nodes[t]=e}},{key:"_uncacheTile",value:function(e,t){var n,r=Ad(this._cachedTiles[e].nodes);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.id;delete this._nodeToTile[a],a in this._cachedNodes&&delete this._cachedNodes[a],a in this._cachedNodeTiles&&delete this._cachedNodeTiles[a],a in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[a],i.sequenceId===t?(this._preStore(e,i),i.uncache()):(delete this._nodes[a],i.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[i.sequenceId],i.dispose())}}catch(CO){r.e(CO)}finally{r.f()}var o,s=Ad(this._nodeIndexTiles[e]);try{for(s.s();!(o=s.n()).done;){var u=o.value;this._nodeIndex.remove(u)}}catch(CO){s.e(CO)}finally{s.f()}delete this._nodeIndexTiles[e],delete this._cachedTiles[e]}},{key:"_uncachePreStored",value:function(e){var t,n={},r=Ad(e);try{for(r.s();!(t=r.n()).done;){var i=o(t.value,2),a=i[0],s=i[1];a in this._nodes&&delete this._nodes[a],a in this._cachedNodes&&delete this._cachedNodes[a];var u=this._preStored[s][a];u.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[u.sequenceId],delete this._preStored[s][a],u.dispose(),n[s]=!0}}catch(CO){r.e(CO)}finally{r.f()}for(var l in n)n.hasOwnProperty(l)&&0===Object.keys(this._preStored[l]).length&&delete this._preStored[l]}},{key:"_updateCachedTileAccess",value:function(e,t){e in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[e]].accessed=t)}},{key:"_updateCachedNodeAccess",value:function(e,t){e in this._cachedNodes&&(this._cachedNodes[e].accessed=t)}},{key:"_updateCell$",value:function(e){var t=this;return this._api.getCoreImages$(e).pipe(Np((function(n){if(!(e in t._cachedTiles))return Hf();var r=t._nodeIndex,i=t._nodeIndexTiles[e],a=t._nodeToTile,o=t._cachedTiles[e];o.accessed=(new Date).getTime();var s,u=o.nodes,l=Ad(n.images);try{for(l.s();!(s=l.n()).done;){var c=s.value;if(null==c)break;if(!t.hasNode(c.id))if(null!=c.sequence.id){var h=new jM(c);u.push(h);var d={lat:h.lngLat.lat,lng:h.lngLat.lng,node:h};r.insert(d),i.push(d),a[h.id]=e,t._setNode(h)}else console.warn("Sequence missing, discarding "+"node (".concat(c.id,")"))}}catch(CO){l.e(CO)}finally{l.f()}return vp(e)})),Jp((function(e){return console.error(e),Hf()})))}}],[{key:"register",value:function(t){e._spatialIndex=t}}]),e}(),tC=function(){function e(){Bd(this,e),this._hash={},this._index=new e._spatialIndex(16),this._indexChanged$=new If,this._updated$=new If}return $d(e,[{key:"changed$",get:function(){return this._indexChanged$}},{key:"updated$",get:function(){return this._updated$}},{key:"add",value:function(e){var t,n=[],r=this._hash,i=this._index,a=Ad(e);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.id;s in r&&(i.remove(r[s]),n.push(o));var u={lat:o.lngLat.lat,lng:o.lngLat.lng,marker:o};r[s]=u,i.insert(u)}}catch(CO){a.e(CO)}finally{a.f()}n.length>0&&this._updated$.next(n),e.length>n.length&&this._indexChanged$.next(this)}},{key:"has",value:function(e){return e in this._hash}},{key:"get",value:function(e){return this.has(e)?this._hash[e].marker:void 0}},{key:"getAll",value:function(){return this._index.all().map((function(e){return e.marker}))}},{key:"remove",value:function(e){var t,n=this._hash,r=this._index,i=!1,a=Ad(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o in n){var s=n[o];r.remove(s),delete n[o],i=!0}}}catch(CO){a.e(CO)}finally{a.f()}i&&this._indexChanged$.next(this)}},{key:"removeAll",value:function(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}},{key:"search",value:function(e){var t=o(e,2),n=t[0],r=t[1];return this._index.search({maxX:r.lng,maxY:r.lat,minX:n.lng,minY:n.lat}).map((function(e){return e.marker}))}},{key:"update",value:function(e){var t=this._hash,n=this._index,r=e.id;if(r in t){n.remove(t[r]);var i={lat:e.lngLat.lat,lng:e.lngLat.lng,marker:e};t[r]=i,n.insert(i)}}}],[{key:"register",value:function(t){e._spatialIndex=t}}]),e}();function nC(e,t,n,r,i){rC(e,t,n||0,r||e.length-1,i||aC)}function rC(e,t,n,r,i){for(;r>n;){if(r-n>600){var a=r-n+1,o=t-n+1,s=Math.log(a),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1);rC(e,t,Math.max(n,Math.floor(t-o*u/a+l)),Math.min(r,Math.floor(t+(a-o)*u/a+l)),i)}var c=e[t],h=n,d=r;for(iC(e,n,t),i(e[r],c)>0&&iC(e,n,r);h<d;){for(iC(e,h,d),h++,d--;i(e[h],c)<0;)h++;for(;i(e[d],c)>0;)d--}0===i(e[n],c)?iC(e,n,d):iC(e,++d,r),d<=t&&(n=d+1),t<=d&&(r=d-1)}}function iC(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function aC(e,t){return e<t?-1:e>t?1:0}var oC=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;Bd(this,e),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}return $d(e,[{key:"all",value:function(){return this._all(this.data,[])}},{key:"search",value:function(e){var t=this.data,n=[];if(!gC(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var a=0;a<t.children.length;a++){var o=t.children[a],s=t.leaf?r(o):o;gC(e,s)&&(t.leaf?n.push(o):mC(e,s)?this._all(o,n):i.push(o))}t=i.pop()}return n}},{key:"collides",value:function(e){var t=this.data;if(!gC(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],a=t.leaf?this.toBBox(i):i;if(gC(e,a)){if(t.leaf||mC(e,a))return!0;n.push(i)}}t=n.pop()}return!1}},{key:"load",value:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=_C([]),this}},{key:"remove",value:function(e,t){if(!e)return this;for(var n,r,i,a=this.data,o=this.toBBox(e),s=[],u=[];a||s.length;){if(a||(a=s.pop(),r=s[s.length-1],n=u.pop(),i=!0),a.leaf){var l=sC(e,a.children,t);if(-1!==l)return a.children.splice(l,1),s.push(a),this._condense(s),this}i||a.leaf||!mC(a,o)?r?(n++,a=r.children[n],i=!1):a=null:(s.push(a),u.push(n),n=0,r=a,a=a.children[0])}return this}},{key:"toBBox",value:function(e){return e}},{key:"compareMinX",value:function(e,t){return e.minX-t.minX}},{key:"compareMinY",value:function(e,t){return e.minY-t.minY}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,xd(e.children)):n.push.apply(n,xd(e.children)),e=n.pop();return t}},{key:"_build",value:function(e,t,n,r){var i,a=n-t+1,o=this._maxEntries;if(a<=o)return uC(i=_C(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,r-1))),(i=_C([])).leaf=!1,i.height=r;var s=Math.ceil(a/o),u=s*Math.ceil(Math.sqrt(o));yC(e,t,n,u,this.compareMinX);for(var l=t;l<=n;l+=u){var c=Math.min(l+u-1,n);yC(e,l,c,s,this.compareMinY);for(var h=l;h<=c;h+=s){var d=Math.min(h+s-1,c);i.children.push(this._build(e,h,d,r-1))}}return uC(i,this.toBBox),i}},{key:"_chooseSubtree",value:function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,a=1/0,o=void 0,s=0;s<t.children.length;s++){var u=t.children[s],l=fC(u),c=(h=e,d=u,(Math.max(d.maxX,h.maxX)-Math.min(d.minX,h.minX))*(Math.max(d.maxY,h.maxY)-Math.min(d.minY,h.minY))-l);c<a?(a=c,i=l<i?l:i,o=u):c===a&&l<i&&(i=l,o=u)}t=o||t.children[0]}var h,d;return t}},{key:"_insert",value:function(e,t,n){var r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),cC(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)}},{key:"_split",value:function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),o=_C(n.children.splice(a,n.children.length-a));o.height=n.height,o.leaf=n.leaf,uC(n,this.toBBox),uC(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(n,o)}},{key:"_splitRoot",value:function(e,t){this.data=_C([e,t]),this.data.height=e.height+1,this.data.leaf=!1,uC(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,n){for(var r,i=1/0,a=1/0,o=t;o<=n-t;o++){var s=lC(e,0,o,this.toBBox),u=lC(e,o,n,this.toBBox),l=vC(s,u),c=fC(s)+fC(u);l<i?(i=l,r=o,a=c<a?c:a):l===i&&c<a&&(a=c,r=o)}return r||n-t}},{key:"_chooseSplitAxis",value:function(e,t,n){var r=e.leaf?this.compareMinX:hC,i=e.leaf?this.compareMinY:dC;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)}},{key:"_allDistMargin",value:function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,a=lC(e,0,t,i),o=lC(e,n-t,n,i),s=pC(a)+pC(o),u=t;u<n-t;u++){var l=e.children[u];cC(a,e.leaf?i(l):l),s+=pC(a)}for(var c=n-t-1;c>=t;c--){var h=e.children[c];cC(o,e.leaf?i(h):h),s+=pC(o)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,n){for(var r=n;r>=0;r--)cC(t[r],e)}},{key:"_condense",value:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():uC(e[n],this.toBBox)}}]),e}();function sC(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function uC(e,t){lC(e,0,e.children.length,t,e)}function lC(e,t,n,r,i){i||(i=_C(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=t;a<n;a++){var o=e.children[a];cC(i,e.leaf?r(o):o)}return i}function cC(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function hC(e,t){return e.minX-t.minX}function dC(e,t){return e.minY-t.minY}function fC(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function pC(e){return e.maxX-e.minX+(e.maxY-e.minY)}function vC(e,t){var n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function mC(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function gC(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _C(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function yC(e,t,n,r,i){for(var a=[t,n];a.length;)if(!((n=a.pop())-(t=a.pop())<=r)){var o=t+Math.ceil((n-t)/r/2)*r;nC(e,o,t,n,i),a.push(t,o,o,n)}}var bC=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"compareMinX",value:function(e,t){return e.lng-t.lng}},{key:"compareMinY",value:function(e,t){return e.lat-t.lat}},{key:"toBBox",value:function(e){return{minX:e.lng,minY:e.lat,maxX:e.lng,maxY:e.lat}}}]),n}(oC),xC=function(){function e(t,n){for(var r in Bd(this,e),this._components={},e.registeredComponents)if(e.registeredComponents.hasOwnProperty(r)){var i=e.registeredComponents[r];this._components[r]={active:!1,component:new i(r,t,n)}}this._coverComponent=new e.registeredCoverComponent("cover",t,n),this._coverComponent.activate(),this._coverActivated=!0}return $d(e,[{key:"coverActivated",get:function(){return this._coverActivated}},{key:"activateCover",value:function(){if(!this._coverActivated)for(var e in this._coverActivated=!0,this._components)if(this._components.hasOwnProperty(e)){var t=this._components[e];t.active&&t.component.deactivate()}}},{key:"deactivateCover",value:function(){if(this._coverActivated)for(var e in this._coverActivated=!1,this._components)if(this._components.hasOwnProperty(e)){var t=this._components[e];t.active&&t.component.activate()}}},{key:"activate",value:function(e){this._checkName(e),this._components[e].active=!0,this._coverActivated||this.get(e).activate()}},{key:"configure",value:function(e,t){this._checkName(e),this.get(e).configure(t)}},{key:"deactivate",value:function(e){this._checkName(e),this._components[e].active=!1,this._coverActivated||this.get(e).deactivate()}},{key:"get",value:function(e){return this._components[e].component}},{key:"getCover",value:function(){return this._coverComponent}},{key:"remove",value:function(){for(var e in this._coverComponent.deactivate(),this._components)this._components.hasOwnProperty(e)&&this._components[e].component.deactivate()}},{key:"_checkName",value:function(e){if(!(e in this._components))throw new HM("Component does not exist: ".concat(e))}}],[{key:"register",value:function(t){void 0===e.registeredComponents[t.componentName]&&(e.registeredComponents[t.componentName]=t)}},{key:"registerCover",value:function(t){e.registeredCoverComponent=t}}]),e}();xC.registeredComponents={};var wC="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function kC(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var SC=Array.isArray,MC=Object.prototype.toString,CC=SC||function(e){return"[object Array]"===MC.call(e)};EC.NONE=0,EC.VTEXT=1,EC.VNODE=2,EC.WIDGET=3,EC.PROPS=4,EC.ORDER=5,EC.INSERT=6,EC.REMOVE=7,EC.THUNK=8;var TC=EC;function EC(e,t,n){this.type=Number(e),this.vNode=t,this.patch=n}EC.prototype.version="2",EC.prototype.type="VirtualPatch";var PC=function(e){return e&&"VirtualNode"===e.type&&"2"===e.version};var AC=function(e){return e&&"VirtualText"===e.type&&"2"===e.version};var LC=function(e){return e&&"Widget"===e.type};var IC=function(e){return e&&"Thunk"===e.type};var RC=PC,OC=AC,NC=LC,DC=IC,zC=function(e,t){var n=e,r=t;DC(t)&&(r=jC(t,e));DC(e)&&(n=jC(e,null));return{a:n,b:r}};function jC(e,t){var n=e.vnode;if(n||(n=e.vnode=e.render(t)),!(RC(n)||OC(n)||NC(n)))throw new Error("thunk did not return a valid node");return n}var BC=function(e){return"object"===typeof e&&null!==e},FC=function(e){return e&&("function"===typeof e.hook&&!e.hasOwnProperty("hook")||"function"===typeof e.unhook&&!e.hasOwnProperty("unhook"))};var $C=BC,qC=FC,UC=function e(t,n){var r;for(var i in t){i in n||((r=r||{})[i]=void 0);var a=t[i],o=n[i];if(a!==o)if($C(a)&&$C(o))if(VC(o)!==VC(a))(r=r||{})[i]=o;else if(qC(o))(r=r||{})[i]=o;else{var s=e(a,o);s&&((r=r||{})[i]=s)}else(r=r||{})[i]=o}for(var u in n)u in t||((r=r||{})[u]=n[u]);return r};function VC(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var HC=CC,WC=TC,GC=PC,ZC=AC,YC=LC,XC=IC,KC=zC,JC=UC;function QC(e,t){var n={a:e};return eT(e,t,n,0),n}function eT(e,t,n,r){if(e!==t){var i=n[r],a=!1;if(XC(e)||XC(t))rT(e,t,n,r);else if(null==t)YC(e)||(tT(e,n,r),i=n[r]),i=sT(i,new WC(WC.REMOVE,e,t));else if(GC(t))if(GC(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var o=JC(e.properties,t.properties);o&&(i=sT(i,new WC(WC.PROPS,e,o))),i=function(e,t,n,r,i){for(var a=e.children,o=function(e,t){var n=oT(t),r=n.keys,i=n.free;if(i.length===t.length)return{children:t,moves:null};var a=oT(e),o=a.keys;if(a.free.length===e.length)return{children:t,moves:null};for(var s=[],u=0,l=i.length,c=0,h=0;h<e.length;h++){var d,f=e[h];f.key?r.hasOwnProperty(f.key)?(d=r[f.key],s.push(t[d])):(d=h-c++,s.push(null)):u<l?(d=i[u++],s.push(t[d])):(d=h-c++,s.push(null))}for(var p=u>=i.length?t.length:i[u],v=0;v<t.length;v++){var m=t[v];m.key?o.hasOwnProperty(m.key)||s.push(m):v>=p&&s.push(m)}for(var g,_=s.slice(),y=0,b=[],x=[],w=0;w<t.length;){var k=t[w];for(g=_[y];null===g&&_.length;)b.push(aT(_,y,null)),g=_[y];g&&g.key===k.key?(y++,w++):k.key?(g&&g.key&&r[g.key]!==w+1?(b.push(aT(_,y,g.key)),(g=_[y])&&g.key===k.key?y++:x.push({key:k.key,to:w})):x.push({key:k.key,to:w}),w++):g&&g.key&&b.push(aT(_,y,g.key))}for(;y<_.length;)g=_[y],b.push(aT(_,y,g&&g.key));if(b.length===c&&!x.length)return{children:s,moves:null};return{children:s,moves:{removes:b,inserts:x}}}(a,t.children),s=o.children,u=a.length,l=s.length,c=u>l?u:l,h=0;h<c;h++){var d=a[h],f=s[h];i+=1,d?eT(d,f,n,i):f&&(r=sT(r,new WC(WC.INSERT,null,f))),GC(d)&&d.count&&(i+=d.count)}o.moves&&(r=sT(r,new WC(WC.ORDER,e,o.moves)));return r}(e,t,n,i,r)}else i=sT(i,new WC(WC.VNODE,e,t)),a=!0;else i=sT(i,new WC(WC.VNODE,e,t)),a=!0;else ZC(t)?ZC(e)?e.text!==t.text&&(i=sT(i,new WC(WC.VTEXT,e,t))):(i=sT(i,new WC(WC.VTEXT,e,t)),a=!0):YC(t)&&(YC(e)||(a=!0),i=sT(i,new WC(WC.WIDGET,e,t)));i&&(n[r]=i),a&&tT(e,n,r)}}function tT(e,t,n){iT(e,t,n),nT(e,t,n)}function nT(e,t,n){if(YC(e))"function"===typeof e.destroy&&(t[n]=sT(t[n],new WC(WC.REMOVE,e,null)));else if(GC(e)&&(e.hasWidgets||e.hasThunks))for(var r=e.children,i=r.length,a=0;a<i;a++){var o=r[a];nT(o,t,n+=1),GC(o)&&o.count&&(n+=o.count)}else XC(e)&&rT(e,null,t,n)}function rT(e,t,n,r){var i=KC(e,t),a=QC(i.a,i.b);(function(e){for(var t in e)if("a"!==t)return!0;return!1})(a)&&(n[r]=new WC(WC.THUNK,null,a))}function iT(e,t,n){if(GC(e)){if(e.hooks&&(t[n]=sT(t[n],new WC(WC.PROPS,e,function(e){var t={};for(var n in e)t[n]=void 0;return t}(e.hooks)))),e.descendantHooks||e.hasThunks)for(var r=e.children,i=r.length,a=0;a<i;a++){var o=r[a];iT(o,t,n+=1),GC(o)&&o.count&&(n+=o.count)}}else XC(e)&&rT(e,null,t,n)}function aT(e,t,n){return e.splice(t,1),{from:t,key:n}}function oT(e){for(var t={},n=[],r=e.length,i=0;i<r;i++){var a=e[i];a.key?t[a.key]=i:n.push(i)}return{keys:t,free:n}}function sT(e,t){return e?(HC(e)?e.push(t):e=[e,t],e):t}var uT=QC,lT=Array.prototype.slice,cT=function(e,t){"length"in e||(e=[e]);e=lT.call(e);for(;e.length;){var n=e.shift(),r=t(n);if(r)return r;n.childNodes&&n.childNodes.length&&(e=lT.call(n.childNodes).concat(e))}};var hT=dT;function dT(e,t){if(!(this instanceof dT))return new dT(e,t);this.data=e,this.nodeValue=e,this.length=e.length,this.ownerDocument=t||null}dT.prototype.nodeType=8,dT.prototype.nodeName="#comment",dT.prototype.toString=function(){return"[object Comment]"};var fT=pT;function pT(e,t){if(!(this instanceof pT))return new pT(e);this.data=e||"",this.length=this.data.length,this.ownerDocument=t||null}pT.prototype.type="DOMTextNode",pT.prototype.nodeType=3,pT.prototype.nodeName="#text",pT.prototype.toString=function(){return this.data},pT.prototype.replaceData=function(e,t,n){var r=this.data,i=r.substring(0,e),a=r.substring(e+t,r.length);this.data=i+n+a,this.length=this.data.length};var vT=function(e){var t=this,n=e.type;e.target||(e.target=t);t.listeners||(t.listeners={});var r=t.listeners[n];if(r)return r.forEach((function(n){e.currentTarget=t,"function"===typeof n?n(e):n.handleEvent(e)}));t.parentNode&&t.parentNode.dispatchEvent(e)};var mT=function(e,t){var n=this;n.listeners||(n.listeners={});n.listeners[e]||(n.listeners[e]=[]);-1===n.listeners[e].indexOf(t)&&n.listeners[e].push(t)};var gT=function(e,t){var n=this;if(!n.listeners)return;if(!n.listeners[e])return;var r=n.listeners[e],i=r.indexOf(t);-1!==i&&r.splice(i,1)};var _T=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function yT(e){switch(e.nodeType){case 3:return wT(e.data);case 8:return"\x3c!--"+e.data+"--\x3e";default:return function(e){var t=[],n=e.tagName;"http://www.w3.org/1999/xhtml"===e.namespaceURI&&(n=n.toLowerCase());t.push("<"+n+function(e){var t=[];for(var n in e)bT(e,n)&&t.push({name:n,value:e[n]});for(var r in e._attributes)for(var i in e._attributes[r]){var a=e._attributes[r][i],o=(a.prefix?a.prefix+":":"")+i;t.push({name:o,value:a.value})}e.className&&t.push({name:"class",value:e.className});return t.length?xT(t):""}(e)+function(e){var t=e.dataset,n=[];for(var r in t)n.push({name:"data-"+r,value:t[r]});return n.length?xT(n):""}(e)),_T.indexOf(n)>-1?t.push(" />"):(t.push(">"),e.childNodes.length?t.push.apply(t,e.childNodes.map(yT)):e.textContent||e.innerText?t.push(wT(e.textContent||e.innerText)):e.innerHTML&&t.push(e.innerHTML),t.push("</"+n+">"));return t.join("")}(e)}}function bT(e,t){var n=typeof e[t];return"style"===t&&Object.keys(e.style).length>0||e.hasOwnProperty(t)&&("string"===n||"boolean"===n||"number"===n)&&"nodeName"!==t&&"className"!==t&&"tagName"!==t&&"textContent"!==t&&"innerText"!==t&&"namespaceURI"!==t&&"innerHTML"!==t}function xT(e){var t=[];return e.forEach((function(e){var n=e.name,r=e.value;"style"===n&&(r=function(e){if("string"===typeof e)return e;var t="";return Object.keys(e).forEach((function(n){var r=e[n];n=n.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),t+=n+":"+r+";"})),t}(r)),t.push(n+'="'+(wT(r).replace(/"/g,"&quot;")+'"'))})),t.length?" "+t.join(" "):""}function wT(e){var t="";return"string"===typeof e?t=e:e&&(t=e.toString()),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var kT=cT,ST=vT,MT=mT,CT=gT,TT=yT,ET="http://www.w3.org/1999/xhtml",PT=AT;function AT(e,t,n){if(!(this instanceof AT))return new AT(e);var r=void 0===n?ET:n||null;this.tagName=r===ET?String(e).toUpperCase():e,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=t||null,this.namespaceURI=r,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}AT.prototype.type="DOMElement",AT.prototype.nodeType=1,AT.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e},AT.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var n=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[n]=e,e.parentNode=this,t},AT.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e},AT.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var n=null===t||void 0===t?-1:this.childNodes.indexOf(t);return n>-1?this.childNodes.splice(n,0,e):this.childNodes.push(e),e.parentNode=this,e},AT.prototype.setAttributeNS=function(e,t,n){var r=null,i=t,a=t.indexOf(":");(a>-1&&(r=t.substr(0,a),i=t.substr(a+1)),"INPUT"===this.tagName&&"type"===t)?this.type=n:(this._attributes[e]||(this._attributes[e]={}))[i]={value:n,prefix:r}},AT.prototype.getAttributeNS=function(e,t){var n=this._attributes[e],r=n&&n[t]&&n[t].value;return"INPUT"===this.tagName&&"type"===t?this.type:"string"!==typeof r?null:r},AT.prototype.removeAttributeNS=function(e,t){var n=this._attributes[e];n&&delete n[t]},AT.prototype.hasAttributeNS=function(e,t){var n=this._attributes[e];return!!n&&t in n},AT.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)},AT.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)},AT.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)},AT.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)},AT.prototype.removeEventListener=CT,AT.prototype.addEventListener=MT,AT.prototype.dispatchEvent=ST,AT.prototype.focus=function(){},AT.prototype.toString=function(){return TT(this)},AT.prototype.getElementsByClassName=function(e){var t=e.split(" "),n=[];return kT(this,(function(e){if(1===e.nodeType){var r=(e.className||"").split(" ");t.every((function(e){return-1!==r.indexOf(e)}))&&n.push(e)}})),n},AT.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return kT(this.childNodes,(function(n){1!==n.nodeType||"*"!==e&&n.tagName.toLowerCase()!==e||t.push(n)})),t},AT.prototype.contains=function(e){return kT(this,(function(t){return e===t}))||!1};var LT=PT,IT=RT;function RT(e){if(!(this instanceof RT))return new RT;this.childNodes=[],this.parentNode=null,this.ownerDocument=e||null}RT.prototype.type="DocumentFragment",RT.prototype.nodeType=11,RT.prototype.nodeName="#document-fragment",RT.prototype.appendChild=LT.prototype.appendChild,RT.prototype.replaceChild=LT.prototype.replaceChild,RT.prototype.removeChild=LT.prototype.removeChild,RT.prototype.toString=function(){return this.childNodes.map((function(e){return String(e)})).join("")};var OT=NT;function NT(e){}NT.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},NT.prototype.preventDefault=function(){};var DT=cT,zT=hT,jT=fT,BT=PT,FT=IT,$T=OT,qT=vT,UT=mT,VT=gT,HT=WT;function WT(){if(!(this instanceof WT))return new WT;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var GT=WT.prototype;GT.createTextNode=function(e){return new jT(e,this)},GT.createElementNS=function(e,t){var n=null===e?null:String(e);return new BT(t,this,n)},GT.createElement=function(e){return new BT(e,this)},GT.createDocumentFragment=function(){return new FT(this)},GT.createEvent=function(e){return new $T(e)},GT.createComment=function(e){return new zT(e,this)},GT.getElementById=function(e){e=String(e);var t=DT(this.childNodes,(function(t){if(String(t.id)===e)return t}));return t||null},GT.getElementsByClassName=BT.prototype.getElementsByClassName,GT.getElementsByTagName=BT.prototype.getElementsByTagName,GT.contains=BT.prototype.contains,GT.removeEventListener=VT,GT.addEventListener=UT,GT.dispatchEvent=qT;var ZT,YT=new HT,XT="undefined"!==typeof wC?wC:"undefined"!==typeof window?window:{},KT=YT;"undefined"!==typeof document?ZT=document:(ZT=XT["__GLOBAL_DOCUMENT_CACHE@4"])||(ZT=XT["__GLOBAL_DOCUMENT_CACHE@4"]=KT);var JT=BC,QT=FC,eE=function(e,t,n){for(var r in t){var i=t[r];void 0===i?tE(e,r,i,n):QT(i)?(tE(e,r,i,n),i.hook&&i.hook(e,r,n?n[r]:void 0)):JT(i)?nE(e,t,n,r,i):e[r]=i}};function tE(e,t,n,r){if(r){var i=r[t];if(QT(i))i.unhook&&i.unhook(e,t,n);else if("attributes"===t)for(var a in i)e.removeAttribute(a);else if("style"===t)for(var o in i)e.style[o]="";else e[t]="string"===typeof i?"":null}}function nE(e,t,n,r,i){var a=n?n[r]:void 0;if("attributes"!==r)if(a&&JT(a)&&rE(a)!==rE(i))e[r]=i;else{JT(e[r])||(e[r]={});var o="style"===r?"":void 0;for(var s in i){var u=i[s];e[r][s]=void 0===u?o:u}}else for(var l in i){var c=i[l];void 0===c?e.removeAttribute(l):e.setAttribute(l,c)}}function rE(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var iE=ZT,aE=eE,oE=PC,sE=AC,uE=LC,lE=zC,cE=function e(t,n){var r=n&&n.document||iE,i=n?n.warn:null;if(t=lE(t).a,uE(t))return t.init();if(sE(t))return r.createTextNode(t.text);if(!oE(t))return i&&i("Item is not a valid virtual dom node",t),null;var a=null===t.namespace?r.createElement(t.tagName):r.createElementNS(t.namespace,t.tagName),o=t.properties;aE(a,o);for(var s=t.children,u=0;u<s.length;u++){var l=e(s[u],n);l&&a.appendChild(l)}return a};var hE={},dE=function(e,t,n,r){return n&&0!==n.length?(n.sort(vE),fE(e,t,n,r,0)):{}};function fE(e,t,n,r,i){if(r=r||{},e){pE(n,i,i)&&(r[i]=e);var a=t.children;if(a)for(var o=e.childNodes,s=0;s<t.children.length;s++){i+=1;var u=a[s]||hE,l=i+(u.count||0);pE(n,i,l)&&fE(o[s],u,n,r,i),i=l}}return r}function pE(e,t,n){if(0===e.length)return!1;for(var r,i,a=0,o=e.length-1;a<=o;){if(i=e[r=(o+a)/2>>0],a===o)return i>=t&&i<=n;if(i<t)a=r+1;else{if(!(i>n))return!0;o=r-1}}return!1}function vE(e,t){return e>t?1:-1}var mE=LC;var gE=eE,_E=LC,yE=TC,bE=function(e,t){if(mE(e)&&mE(t))return"name"in e&&"name"in t?e.id===t.id:e.init===t.init;return!1},xE=function(e,t,n){var r=e.type,i=e.vNode,a=e.patch;switch(r){case yE.REMOVE:return function(e,t){var n=e.parentNode;n&&n.removeChild(e);return wE(e,t),null}(t,i);case yE.INSERT:return function(e,t,n){var r=n.render(t,n);e&&e.appendChild(r);return e}(t,a,n);case yE.VTEXT:return function(e,t,n,r){var i;if(3===e.nodeType)e.replaceData(0,e.length,n.text),i=e;else{var a=e.parentNode;i=r.render(n,r),a&&i!==e&&a.replaceChild(i,e)}return i}(t,0,a,n);case yE.WIDGET:return function(e,t,n,r){var i,a=bE(t,n);i=a?n.update(t,e)||e:r.render(n,r);var o=e.parentNode;o&&i!==e&&o.replaceChild(i,e);a||wE(e,t);return i}(t,i,a,n);case yE.VNODE:return function(e,t,n,r){var i=e.parentNode,a=r.render(n,r);i&&a!==e&&i.replaceChild(a,e);return a}(t,0,a,n);case yE.ORDER:return function(e,t){for(var n,r,i,a=e.childNodes,o={},s=0;s<t.removes.length;s++)n=a[(r=t.removes[s]).from],r.key&&(o[r.key]=n),e.removeChild(n);for(var u=a.length,l=0;l<t.inserts.length;l++)n=o[(i=t.inserts[l]).key],e.insertBefore(n,i.to>=u++?null:a[i.to])}(t,a),t;case yE.PROPS:return gE(t,a,i.properties),t;case yE.THUNK:return function(e,t){e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e);return t}(t,n.patch(t,a,n));default:return t}};function wE(e,t){"function"===typeof t.destroy&&_E(t)&&t.destroy(e)}var kE=ZT,SE=CC,ME=cE,CE=dE,TE=xE,EE=function e(t,n,r){return(r=r||{}).patch=r.patch&&r.patch!==e?r.patch:PE,r.render=r.render||ME,r.patch(t,n,r)};function PE(e,t,n){var r=function(e){var t=[];for(var n in e)"a"!==n&&t.push(Number(n));return t}(t);if(0===r.length)return e;var i=CE(e,t.a,r),a=e.ownerDocument;n.document||a===kE||(n.document=a);for(var o=0;o<r.length;o++){var s=r[o];e=AE(e,i[s],t[s],n)}return e}function AE(e,t,n,r){if(!t)return e;var i;if(SE(n))for(var a=0;a<n.length;a++)i=TE(n[a],t,r),t===e&&(e=i);else i=TE(n,t,r),t===e&&(e=i);return e}var LE=EE,IE=PC,RE=LC,OE=IC,NE=FC,DE=BE,zE={},jE=[];function BE(e,t,n,r,i){this.tagName=e,this.properties=t||zE,this.children=n||jE,this.key=null!=r?String(r):void 0,this.namespace="string"===typeof i?i:null;var a,o=n&&n.length||0,s=0,u=!1,l=!1,c=!1;for(var h in t)if(t.hasOwnProperty(h)){var d=t[h];NE(d)&&d.unhook&&(a||(a={}),a[h]=d)}for(var f=0;f<o;f++){var p=n[f];IE(p)?(s+=p.count||0,!u&&p.hasWidgets&&(u=!0),!l&&p.hasThunks&&(l=!0),c||!p.hooks&&!p.descendantHooks||(c=!0)):!u&&RE(p)?"function"===typeof p.destroy&&(u=!0):!l&&OE(p)&&(l=!0)}this.count=o+s,this.hasWidgets=u,this.hasThunks=l,this.hooks=a,this.descendantHooks=c}BE.prototype.version="2",BE.prototype.type="VirtualNode";var FE=$E;function $E(e){this.text=String(e)}$E.prototype.version="2",$E.prototype.type="VirtualText";var qE=function(e){var t,n=String.prototype.split,r=/()??/.exec("")[1]===e;return t=function(t,i,a){if("[object RegExp]"!==Object.prototype.toString.call(i))return n.call(t,i,a);var o,s,u,l,c=[],h=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),d=0;i=new RegExp(i.source,h+"g");for(t+="",r||(o=new RegExp("^"+i.source+"$(?!\\s)",h)),a=a===e?-1>>>0:a>>>0;(s=i.exec(t))&&!((u=s.index+s[0].length)>d&&(c.push(t.slice(d,s.index)),!r&&s.length>1&&s[0].replace(o,(function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(s[t]=e)})),s.length>1&&s.index<t.length&&Array.prototype.push.apply(c,s.slice(1)),l=s[0].length,d=u,c.length>=a));)i.lastIndex===s.index&&i.lastIndex++;return d===t.length?!l&&i.test("")||c.push(""):c.push(t.slice(d)),c.length>a?c.slice(0,a):c},t}(),UE=qE,VE=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,HE=/^\.|#/,WE=function(e,t){if(!e)return"DIV";var n,r,i,a,o=!t.hasOwnProperty("id"),s=UE(e,VE),u=null;HE.test(s[1])&&(u="DIV");for(a=0;a<s.length;a++)(r=s[a])&&(i=r.charAt(0),u?"."===i?(n=n||[]).push(r.substring(1,r.length)):"#"===i&&o&&(t.id=r.substring(1,r.length)):u=r);n&&(t.className&&n.push(t.className),t.className=n.join(" "));return t.namespace?u:u.toUpperCase()};var GE=ZE;function ZE(e){if(!(this instanceof ZE))return new ZE(e);this.value=e}ZE.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)};var YE="undefined"!==typeof window?window:"undefined"!==typeof wC?wC:{},XE=function(e,t){if(e in YE)return YE[e];return YE[e]=t,t};var KE=XE,JE=function(e,t,n){var r="__INDIVIDUAL_ONE_VERSION_"+e,i=KE(r+"_ENFORCE_SINGLETON",t);if(i!==t)throw new Error("Can only have one copy of "+e+".\nYou already have version "+i+" installed.\nThis means you cannot install version "+t);return KE(r,n)};JE("ev-store","7");var QE="__EV_STORE_KEY@7";var eP=function(e){var t=e[QE];t||(t=e[QE]={});return t},tP=nP;function nP(e){if(!(this instanceof nP))return new nP(e);this.value=e}nP.prototype.hook=function(e,t){eP(e)[t.substr(3)]=this.value},nP.prototype.unhook=function(e,t){eP(e)[t.substr(3)]=void 0};var rP=CC,iP=DE,aP=FE,oP=PC,sP=AC,uP=LC,lP=FC,cP=IC,hP=WE,dP=GE,fP=tP,pP=function(e,t,n){var r,i,a,o,s=[];!n&&function(e){return"string"===typeof e||rP(e)||mP(e)}(t)&&(n=t,i={});r=hP(e,i=i||t||{}),i.hasOwnProperty("key")&&(a=i.key,i.key=void 0);i.hasOwnProperty("namespace")&&(o=i.namespace,i.namespace=void 0);"INPUT"!==r||o||!i.hasOwnProperty("value")||void 0===i.value||lP(i.value)||(i.value=dP(i.value));(function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(lP(n))continue;"ev-"===t.substr(0,3)&&(e[t]=fP(n))}})(i),void 0!==n&&null!==n&&vP(n,s,r,i);return new iP(r,i,s,a,o)};function vP(e,t,n,r){if("string"===typeof e)t.push(new aP(e));else if("number"===typeof e)t.push(new aP(String(e)));else if(mP(e))t.push(e);else{if(!rP(e)){if(null===e||void 0===e)return;throw function(e){var t=new Error;return t.type="virtual-hyperscript.unexpected.virtual-element",t.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+gP(e.foreignObject)+".\nThe parent vnode is:\n"+gP(e.parentVnode),t.foreignObject=e.foreignObject,t.parentVnode=e.parentVnode,t}({foreignObject:e,parentVnode:{tagName:n,properties:r}})}for(var i=0;i<e.length;i++)vP(e[i],t,n,r)}}function mP(e){return oP(e)||sP(e)||uP(e)||cP(e)}function gP(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}var _P,yP={diff:uT,patch:LE,h:pP,create:cE,VNode:DE,VText:FE},bP=function(){function e(){Bd(this,e),this._events={}}return $d(e,[{key:"fire",value:function(e,t){if(this._listens(e)){var n,r=Ad(this._events[e]);try{for(r.s();!(n=r.n()).done;){(0,n.value)(t)}}catch(CO){r.e(CO)}finally{r.f()}}}},{key:"off",value:function(e,t){if(e){if(this._listens(e)){var n=this._events[e].indexOf(t);n>=0&&this._events[e].splice(n,1),this._events[e].length||delete this._events[e]}}else this._events={}}},{key:"on",value:function(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}},{key:"_listens",value:function(e){return e in this._events}}]),e}(),xP=function(){function e(){Bd(this,e),this._subscriptions=[]}return $d(e,[{key:"push",value:function(e){this._subscriptions.push(e)}},{key:"unsubscribe",value:function(){var e,t=Ad(this._subscriptions);try{for(t.s();!(e=t.n()).done;){e.value.unsubscribe()}}catch(CO){t.e(CO)}finally{t.f()}this._subscriptions=[]}}]),e}(),wP=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this))._activated$=new Of(!1),a._configurationSubject$=new If,a._activated=!1,a._container=r,a._name=e,a._navigator=i,a._subscriptions=new xP,a._configuration$=a._configurationSubject$.pipe(Cv(a.defaultConfiguration),xv((function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e})),yv(1),Pf()),a._configuration$.subscribe((function(){})),a}return $d(n,[{key:"activated",get:function(){return this._activated}},{key:"activated$",get:function(){return this._activated$}},{key:"defaultConfiguration",get:function(){return this._getDefaultConfiguration()}},{key:"configuration$",get:function(){return this._configuration$}},{key:"name",get:function(){return this._name}},{key:"activate",value:function(e){this._activated||(void 0!==e&&this._configurationSubject$.next(e),this._activated=!0,this._activate(),this._activated$.next(!0))}},{key:"configure",value:function(e){this._configurationSubject$.next(e)}},{key:"deactivate",value:function(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"resize",value:function(){}}]),n}(bP);!function(e){e[e.Hidden=0]="Hidden",e[e.Loading=1]="Loading",e[e.Visible=2]="Visible"}(_P||(_P={}));var kP=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){return Bd(this,n),t.call(this,e,r,i)}return $d(n,[{key:"_activate",value:function(){var e=this,t=this.configuration$.pipe(fv((function(e){return!!e.id})),Zp((function(e){return!e.src})),Tv((function(t){return e._getImageSrc$(t.id).pipe(Jp((function(e){return console.error(e),Hf()})))})),yv(1),Pf()),n=this._subscriptions;n.push(t.pipe(wp((function(e){return{src:e}}))).subscribe((function(t){e._configurationSubject$.next(t)}))),n.push(Lp(this.configuration$,t).pipe(Zp((function(e){var t=o(e,2),n=t[0],r=t[1];return!!n.src&&n.src!==r})),fv()).subscribe((function(e){var t=o(e,2)[1];window.URL.revokeObjectURL(t)}))),n.push(this._configuration$.pipe(sv(void 0,(function(e){return e.state})),Tv((function(t){return Lp(vp(t.state),e._navigator.stateService.currentImage$)})),Tv((function(e){var t=o(e,2),n=t[0],r=t[1],i=Lp(vp(r.id),r.image$.pipe(Zp((function(e){return!!e})),wp((function(e){return e.src}))));return n===_P.Visible?i.pipe(fv()):i})),sv((function(e,t){var n=o(e,2),r=n[0],i=n[1],a=o(t,2),s=a[0],u=a[1];return r===s&&i===u})),wp((function(e){var t=o(e,2);return{id:t[0],src:t[1]}}))).subscribe(this._configurationSubject$)),n.push(Lp(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(wp((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2];if(!r.src)return{name:e._name,vNode:yP.h("div",[])};var s=a.width<=640||a.height<=480?".mapillary-cover-compact":"";if(r.state===_P.Hidden){var u=yP.h("div.mapillary-cover-container.mapillary-cover-done"+s,[e._getCoverBackgroundVNode(r)]);return{name:e._name,vNode:u}}var l=yP.h("div.mapillary-cover-container"+s,[e._getCoverButtonVNode(r,i)]);return{name:e._name,vNode:l}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{state:_P.Visible}}},{key:"_getCoverButtonVNode",value:function(e,t){var n=this,r=e.state===_P.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",i=yP.h("div.mapillary-cover-button",[yP.h("div.mapillary-cover-button-icon",[])]),a=yP.h("a.mapillary-cover-logo",{href:t,target:"_blank"},[]),o=yP.h("div.mapillary-cover-indicator",{onclick:function(){n.configure({state:_P.Loading})}},[]);return yP.h(r,[this._getCoverBackgroundVNode(e),o,i,a])}},{key:"_getCoverBackgroundVNode",value:function(e){var t={style:{backgroundImage:"url(".concat(e.src,")")}},n=[];return e.state===_P.Loading&&n.push(yP.h("div.mapillary-cover-spinner",{},[])),yP.h("div.mapillary-cover-background",t,n)}},{key:"_getImageSrc$",value:function(e){var t=this;return Sf.create((function(n){t._navigator.api.getImages$([e]).subscribe((function(r){var i,a=Ad(r);try{for(a.s();!(i=a.n()).done;){var o=i.value,s="number"===typeof e?e.toString():e;if(o.node_id===s)return void t._navigator.api.data.getImageBuffer(o.node.thumb.url).then((function(t){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){n.next(r.src),n.complete()},r.onerror=function(){n.error(new Error("Failed to load cover "+"image (".concat(e,")")))};var i=new Blob([t]);r.src=window.URL.createObjectURL(i)}),(function(e){n.error(e)}))}}catch(CO){a.e(CO)}finally{a.f()}n.error(new VM("Non existent cover key: ".concat(e)))}),(function(e){n.error(e)}))}))}}]),n}(wP);kP.componentName="cover";var SP=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_activate",value:function(){var e=this;this._subscriptions.push(Lp(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(wp((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2],s=e._makeAttribution(i.creatorUsername,r,i.id,i.capturedAt,a.width);return{name:e._name,vNode:s}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}},{key:"makeImageUrl",value:function(e,t){return"".concat(e,"/app/?pKey=").concat(t,"&focus=photo")}},{key:"_makeAttribution",value:function(e,t,n,r,i){var a=i<=640,o=this._makeDate(r,a),s=this._makeBy(e,t,n,a),u=a?".mapillary-attribution-compact":"";return yP.h("div.mapillary-attribution-container"+u,{},[].concat(xd(s),[o]))}},{key:"_makeBy",value:function(e,t,n,r){var i=yP.h("div.mapillary-attribution-logo",[]);return e?this._makeCreatorBy(i,e,t,n,r):this._makeGeneralBy(i,t,n,r)}},{key:"_makeCreatorBy",value:function(e,t,n,r,i){var a=yP.h("a.mapillary-attribution-icon-container",{href:n,rel:"noreferrer",target:"_blank"},[e]),o=i?"".concat(t):"image by ".concat(t),s=yP.h("div.mapillary-attribution-username",{textContent:o},[]);return[a,yP.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(n,r),rel:"noreferrer",target:"_blank"},[s])]}},{key:"_makeGeneralBy",value:function(e,t,n,r){var i=yP.h("div.mapillary-attribution-username",{textContent:"images by"},[]),a=[yP.h("div.mapillary-attribution-icon-container",{},[e]),yP.h("div.mapillary-attribution-username",{textContent:"contributors"},[])];return r||a.unshift(i),[yP.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(t,n),rel:"noreferrer",target:"_blank"},a)]}},{key:"_makeDate",value:function(e,t){var n=new Date(e).toDateString().split(" "),r=(n.length>3?t?[n[3]]:[n[1],n[2]+",",n[3]]:n).join(" ");return yP.h("div.mapillary-attribution-date",{textContent:r},[])}}]),n}(wP);SP.componentName="attribution";var MP,CP=function(){function e(){Bd(this,e),this._unprojectDepth=200}return $d(e,[{key:"basicToCanvas",value:function(e,t,n,r,i){var a=r.unprojectBasic([e,t],this._unprojectDepth);return this.projectToCanvas(a,n,i)}},{key:"basicToCanvasSafe",value:function(e,t,n,r,i){var a=this.basicToViewportSafe(e,t,r,i);return null===a?null:this.viewportToCanvas(a[0],a[1],n)}},{key:"basicToViewport",value:function(e,t,n,r){var i=n.unprojectBasic([e,t],this._unprojectDepth);return this.projectToViewport(i,r)}},{key:"basicToViewportSafe",value:function(e,t,n,r){var i=n.unprojectBasic([e,t],this._unprojectDepth);return this.worldToCamera(i,r)[2]>0?null:this.projectToViewport(i,r)}},{key:"cameraToViewport",value:function(e,t){var n=(new Vm).fromArray(e).applyMatrix4(t.projectionMatrix);return[n.x,n.y]}},{key:"canvasPosition",value:function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop]}},{key:"canvasToBasic",value:function(e,t,n,r,i){var a=this.unprojectFromCanvas(e,t,n,i).toArray();return r.projectBasic(a)}},{key:"canvasToViewport",value:function(e,t,n){var r=o(this.containerToCanvas(n),2);return[2*e/r[0]-1,1-2*t/r[1]]}},{key:"containerToCanvas",value:function(e){return[e.offsetWidth,e.offsetHeight]}},{key:"getBasicDistances",value:function(e,t){var n=this.viewportToBasic(-1,1,e,t),r=this.viewportToBasic(1,1,e,t),i=this.viewportToBasic(1,-1,e,t),a=this.viewportToBasic(-1,-1,e,t),o=0,s=0,u=0,l=0;return n[1]<0&&r[1]<0&&(o=n[1]>r[1]?-n[1]:-r[1]),r[0]>1&&i[0]>1&&(s=r[0]<i[0]?r[0]-1:i[0]-1),i[1]>1&&a[1]>1&&(u=i[1]<a[1]?i[1]-1:a[1]-1),a[0]<0&&n[0]<0&&(l=a[0]>n[0]?-a[0]:-n[0]),[o,s,u,l]}},{key:"getPixelDistances",value:function(e,t,n){var r=this.viewportToBasic(-1,1,t,n),i=this.viewportToBasic(1,1,t,n),a=this.viewportToBasic(1,-1,t,n),s=this.viewportToBasic(-1,-1,t,n),u=0,l=0,c=0,h=0,d=o(this.containerToCanvas(e),2),f=d[0],p=d[1];if(r[1]<0&&i[1]<0){var v=r[1]>i[1]?r[0]:i[0],m=this.basicToCanvas(v,0,e,t,n);u=m[1]>0?m[1]:0}if(i[0]>1&&a[0]>1){var g=i[0]<a[0]?i[1]:a[1],_=this.basicToCanvas(1,g,e,t,n);l=_[0]<f?f-_[0]:0}if(a[1]>1&&s[1]>1){var y=a[1]<s[1]?a[0]:s[0],b=this.basicToCanvas(y,1,e,t,n);c=b[1]<p?p-b[1]:0}if(s[0]<0&&r[0]<0){var x=s[0]>r[0]?s[1]:r[1],w=this.basicToCanvas(0,x,e,t,n);h=w[0]>0?w[0]:0}return[u,l,c,h]}},{key:"insideElement",value:function(e,t){var n=t.getBoundingClientRect(),r=n.left+t.clientLeft,i=r+t.clientWidth,a=n.top+t.clientTop,o=a+t.clientHeight;return e.clientX>r&&e.clientX<i&&e.clientY>a&&e.clientY<o}},{key:"projectToCanvas",value:function(e,t,n){var r=this.projectToViewport(e,n);return this.viewportToCanvas(r[0],r[1],t)}},{key:"projectToCanvasSafe",value:function(e,t,n){if(this.worldToCamera(e,n)[2]>0)return null;var r=this.projectToViewport(e,n);return this.viewportToCanvas(r[0],r[1],t)}},{key:"projectToViewport",value:function(e,t){var n=new Vm(e[0],e[1],e[2]).project(t);return[n.x,n.y]}},{key:"unprojectFromCanvas",value:function(e,t,n,r){var i=this.canvasToViewport(e,t,n);return this.unprojectFromViewport(i[0],i[1],r)}},{key:"unprojectFromViewport",value:function(e,t,n){return new Vm(e,t,1).unproject(n)}},{key:"viewportToBasic",value:function(e,t,n,r){var i=new Vm(e,t,1).unproject(r).toArray();return n.projectBasic(i)}},{key:"viewportToCanvas",value:function(e,t,n){var r=o(this.containerToCanvas(n),2);return[r[0]*(e+1)/2,-r[1]*(t-1)/2]}},{key:"worldToCamera",value:function(e,t){return new Vm(e[0],e[1],e[2]).applyMatrix4(t.matrixWorldInverse).toArray()}}]),e}();!function(e){e[e.Automatic=0]="Automatic",e[e.Large=1]="Large",e[e.Small=2]="Small"}(MP||(MP={}));var TP=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._spatial=new WM,a._viewportCoords=new CP,a._svgNamespace="http://www.w3.org/2000/svg",a._distinctThreshold=Math.PI/360,a._animationSpeed=.075,a}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions,n=this._container.renderService.renderCamera$.pipe(wp((function(t){var n=e._spatial.degToRad(t.perspective.fov),r=t.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:2*Math.atan(t.perspective.aspect*Math.tan(.5*n));return[e._spatial.azimuthalToBearing(t.rotation.phi),r]})),sv((function(t,n){return Math.abs(n[0]-t[0])<e._distinctThreshold&&Math.abs(n[1]-t[1])<e._distinctThreshold}))),r=Lp(this._navigator.stateService.currentState$.pipe(sv(void 0,(function(e){return e.state.currentImage.id}))),this._navigator.panService.panImages$).pipe(wp((function(t){var n=o(t,2),r=n[0],i=n[1],a=r.state.currentImage,s=r.state.currentTransform;if(ZM(a.cameraType))return[Math.PI,Math.PI];var u,l=e._computeProjectedPoints(s),c=e._spatial.degToRad(e._computeHorizontalFov(l)),h=c/2,d=c/2,f=Ad(i);try{for(f.s();!(u=f.n()).done;){var p=o(u.value,3),v=p[0],m=p[2],g=e._spatial.wrap(v.compassAngle-a.compassAngle,-180,180);g<0?h=e._spatial.degToRad(Math.abs(g))+m/2:d=e._spatial.degToRad(Math.abs(g))+m/2}}catch(CO){f.e(CO)}finally{f.f()}return[h,d]})),sv((function(t,n){var r=o(t,2),i=r[0],a=r[1],s=o(n,2),u=s[0],l=s[1];return Math.abs(u-i)<e._distinctThreshold&&Math.abs(l-a)<e._distinctThreshold}))),i=Lp(this._navigator.stateService.currentState$.pipe(sv(void 0,(function(e){return e.state.currentImage.id}))),this._container.renderService.bearing$).pipe(wp((function(t){var n=o(t,2),r=n[0],i=n[1];return e._spatial.degToRad(r.state.currentImage.compassAngle-i)}))),a=new If,s=a.pipe(xv((function(e,t){return t(e)}),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),wp((function(t){var n=Em.smootherstep(t.alpha,0,1),r=t.curr,i=t.prev;return[e._interpolate(i[0],r[0],n),e._interpolate(i[1],r[1],n)]})));t.push(r.pipe(wp((function(t){return function(n){var r=Em.smootherstep(n.alpha,0,1),i=n.curr,a=n.prev,o=[e._interpolate(a[0],i[0],r),e._interpolate(a[1],i[1],r)];return{alpha:0,curr:t.slice(),prev:o}}}))).subscribe(a)),t.push(r.pipe(Tv((function(){return e._container.renderService.renderCameraFrame$.pipe(Sv(1),xv((function(t){return t+e._animationSpeed}),0),Pv((function(t){return t<=1+e._animationSpeed})),wp((function(e){return Math.min(e,1)})))})),wp((function(e){return function(t){return{alpha:e,curr:t.curr.slice(),prev:t.prev.slice()}}}))).subscribe(a));var u=Lp(i,s).pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return[n,r[0],r[1]]})));t.push(Lp(n,u,this._configuration$,this._container.renderService.size$).pipe(wp((function(t){var n=o(t,4),r=o(n[0],2),i=r[0],a=r[1],s=o(n[1],3),u=s[0],l=s[1],c=s[2],h=n[2],d=n[3],f=e._createBackground(i),p=e._createFovIndicator(l,c,u),v=e._createNorth(i),m=e._createCircleSectorCompass(e._createCircleSector(Math.max(Math.PI/20,a),"#FFF")),g=h.size===MP.Small||h.size===MP.Automatic&&d.width<640?".mapillary-bearing-compact":"";return{name:e._name,vNode:yP.h("div.mapillary-bearing-indicator-container"+g,{oncontextmenu:function(e){e.preventDefault()}},[f,p,v,m])}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{size:MP.Automatic}}},{key:"_createFovIndicator",value:function(e,t,n){var r=this._createFovArc(e,t),i=yP.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[r]);return yP.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:"rotateZ(".concat(this._spatial.radToDeg(n),"deg)"),width:"36px"}},[i])}},{key:"_createFovArc",value:function(e,t){var n=16.75,r=e+t;if(r>2*Math.PI-Math.PI/90)return yP.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:"".concat(n),stroke:"#FFF","stroke-width":"".concat(2.5)},namespace:this._svgNamespace},[]);var i=-Math.PI/2-e,a=i+r,o=n*Math.cos(i),s=n*Math.sin(i),u=n*Math.cos(a),l=n*Math.sin(a),c=r>=Math.PI?1:0,h="M ".concat(o," ").concat(s," A ").concat(n," ").concat(n," 0 ").concat(c," 1 ").concat(u," ").concat(l);return yP.h("path",{attributes:{d:h,"fill-opacity":"0",stroke:"#FFF","stroke-width":"".concat(2.5)},namespace:this._svgNamespace},[])}},{key:"_createCircleSectorCompass",value:function(e){var t=yP.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[e]);return yP.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[t])}},{key:"_createCircleSector",value:function(e,t){if(e>2*Math.PI-Math.PI/90)return yP.h("circle",{attributes:{cx:"0",cy:"0",fill:t,r:"1"},namespace:this._svgNamespace},[]);var n=-Math.PI/2-e/2,r=n+e,i=Math.cos(n),a=Math.sin(n),o=Math.cos(r),s=Math.sin(r),u=e>=Math.PI?1:0,l="M 0 0 ".concat(i," ").concat(a," A 1 1 0 ").concat(u," 1 ").concat(o," ").concat(s);return yP.h("path",{attributes:{d:l,fill:t},namespace:this._svgNamespace},[])}},{key:"_createNorth",value:function(e){var t=yP.h("div.mapillary-bearing-north",[]);return yP.h("div.mapillary-bearing-north-container",{style:{transform:"rotateZ(".concat(this._spatial.radToDeg(-e),"deg)")}},[t])}},{key:"_createBackground",value:function(e){return yP.h("div.mapillary-bearing-indicator-background",{style:{transform:"rotateZ(".concat(this._spatial.radToDeg(-e),"deg)")}},[yP.h("div.mapillary-bearing-indicator-background-circle",[]),yP.h("div.mapillary-bearing-indicator-background-arrow-container",[yP.h("div.mapillary-bearing-indicator-background-arrow",[])])])}},{key:"_computeProjectedPoints",value:function(e){return KM(e,[[1,0]],[[0,.5]],12,this._viewportCoords)}},{key:"_computeHorizontalFov",value:function(e){var t=this,n=e.map((function(e){return t._coordToFov(e[0])}));return Math.min.apply(Math,xd(n))}},{key:"_coordToFov",value:function(e){return this._spatial.radToDeg(2*Math.atan(e))}},{key:"_interpolate",value:function(e,t,n){return(1-n)*e+n*t}}]),n}(wP);TP.componentName="bearing";var EP=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){return Bd(this,n),t.call(this,e,r,i)}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(Lp(this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$})),Zp((function(e){return e.cached}))),this._configuration$).pipe(Tv((function(t){var n=t[0],r=t[1],i=Math.max(0,Math.min(4,r.depth.sequence));return Hp(e._cache$(n.edges,DM.Next,i),e._cache$(n.edges,DM.Prev,i)).pipe(Jp((function(e){return console.error("Failed to cache sequence edges.",e),Hf()})))}))).subscribe((function(){}))),t.push(Lp(this._navigator.stateService.currentImage$.pipe(Tv((function(e){return Lp(vp(e),e.spatialEdges$.pipe(Zp((function(e){return e.cached}))))}))),this._configuration$).pipe(Tv((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1],u=a.edges,l=s.depth,c=Math.max(0,Math.min(2,l.spherical)),h=ZM(i.cameraType)?0:Math.max(0,Math.min(3,l.step)),d=ZM(i.cameraType)?0:Math.max(0,Math.min(1,l.turn)),f=e._cache$(u,DM.Spherical,c);return Hp(e._cache$(u,DM.StepForward,h),e._cache$(u,DM.StepBackward,h),e._cache$(u,DM.StepLeft,h),e._cache$(u,DM.StepRight,h),f,e._cache$(u,DM.TurnLeft,d),e._cache$(u,DM.TurnRight,d),e._cache$(u,DM.TurnU,d)).pipe(Jp((function(e){return console.error("Failed to cache spatial edges.",e),Hf()})))}))).subscribe((function(){})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}},{key:"_cache$",value:function(e,t,n){var r=this;return Yp(vp(e),vp(n)).pipe(hv((function(e){var n=e[0],i=e[1],a=[];if(i>0){var o,s=Ad(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.data.direction===t&&a.push(Yp(r._navigator.graphService.cacheImage$(u.target).pipe(Np((function(e){return r._imageToEdges$(e,t)}))),vp(i-1)))}}catch(CO){s.e(CO)}finally{s.f()}}return ap(a).pipe(Dp())})),Sv(1))}},{key:"_imageToEdges$",value:function(e,t){return([DM.Next,DM.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(fv((function(e){return e.cached})),wp((function(e){return e.edges})))}}]),n}(wP);EP.componentName="cache";var PP=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),r=t.call(this,null!=e?e:"The request was cancelled."),Object.setPrototypeOf(Id(r),n.prototype),r.name="CancelMapillaryError",r}return $d(n)}(VM),AP=function(){function e(t,n){Bd(this,e),this._spatial=new WM,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(t),this._resize(n),this._reset()}return $d(e,[{key:"minWidth",get:function(){return this._minWidth}},{key:"maxWidth",get:function(){return this._maxWidth}},{key:"containerWidth",get:function(){return this._containerWidth}},{key:"containerWidthCss",get:function(){return this._containerWidthCss}},{key:"containerMarginCss",get:function(){return this._containerMarginCss}},{key:"containerLeftCss",get:function(){return this._containerLeftCss}},{key:"containerHeight",get:function(){return this._containerHeight}},{key:"containerHeightCss",get:function(){return this._containerHeightCss}},{key:"containerBottomCss",get:function(){return this._containerBottomCss}},{key:"stepCircleSize",get:function(){return this._stepCircleSize}},{key:"stepCircleSizeCss",get:function(){return this._stepCircleSizeCss}},{key:"stepCircleMarginCss",get:function(){return this._stepCircleMarginCss}},{key:"turnCircleSize",get:function(){return this._turnCircleSize}},{key:"turnCircleSizeCss",get:function(){return this._turnCircleSizeCss}},{key:"outerRadius",get:function(){return this._outerRadius}},{key:"innerRadius",get:function(){return this._innerRadius}},{key:"shadowOffset",get:function(){return this._shadowOffset}},{key:"configure",value:function(e){this._configure(e),this._reset()}},{key:"resize",value:function(e){this._resize(e),this._reset()}},{key:"angleToCoordinates",value:function(e){return[Math.cos(e),Math.sin(e)]}},{key:"relativeAngleToCoordiantes",value:function(e,t){var n=this._spatial.wrapAngle(e-t);return this.angleToCoordinates(n)}},{key:"_configure",value:function(e){this._minWidth=e.minWidth,this._maxWidth=this._getMaxWidth(e.minWidth,e.maxWidth)}},{key:"_resize",value:function(e){this._elementWidth=e.width,this._elementHeight=e.height}},{key:"_reset",value:function(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}},{key:"_getContainerWidth",value:function(e,t){var n=(e-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),r=(t-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),i=Math.max(0,Math.min(1,Math.min(n,r)));return i=.04*Math.round(25*i),this._minWidth+i*(this._maxWidth-this._minWidth)}},{key:"_getContainerHeight",value:function(e){return.77*e}},{key:"_getStepCircleDiameter",value:function(e){return.34*e}},{key:"_getTurnCircleDiameter",value:function(e){return.3*e}},{key:"_getOuterRadius",value:function(e){return.31*e}},{key:"_getInnerRadius",value:function(e){return.125*e}},{key:"_numberToCssPixels",value:function(e){return e+"px"}},{key:"_getMaxWidth",value:function(e,t){return e>t?e:t}}]),e}(),LP=function(){function e(t,n){Bd(this,e),this._isEdge=!1,this._spatial=new WM,this._calculator=new AP(t,n),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[DM.StepForward,DM.StepBackward,DM.StepLeft,DM.StepRight],this._turnDirections=[DM.TurnLeft,DM.TurnRight,DM.TurnU],this._turnNames={},this._turnNames[DM.TurnLeft]="mapillary-direction-turn-left",this._turnNames[DM.TurnRight]="mapillary-direction-turn-right",this._turnNames[DM.TurnU]="mapillary-direction-turn-around";var r=!!document.documentMode;this._isEdge=!r&&!!window.StyleMedia}return $d(e,[{key:"needsRender",get:function(){return this._needsRender}},{key:"render",value:function(e){this._needsRender=!1;var t=this._rotation,n=[],r=[];return ZM(this._image.cameraType)?n=n.concat(this._createSphericalArrows(e,t)):(n=(n=n.concat(this._createPerspectiveToSphericalArrows(e,t))).concat(this._createStepArrows(e,t)),r=r.concat(this._createTurnArrows(e))),this._getContainer(n,r,t)}},{key:"setEdges",value:function(e,t){this._setEdges(e,t),this._setNeedsRender()}},{key:"setImage",value:function(e){this._image=e,this._clearEdges(),this._setNeedsRender()}},{key:"setRenderCamera",value:function(e){var t=e.rotation;Math.abs(t.phi-this._rotation.phi)<this._epsilon||(this._rotation=t,this._setNeedsRender())}},{key:"setConfiguration",value:function(e){var t=!1;this._highlightKey===e.highlightId&&this._distinguishSequence===e.distinguishSequence||(this._highlightKey=e.highlightId,this._distinguishSequence=e.distinguishSequence,t=!0),this._calculator.minWidth===e.minWidth&&this._calculator.maxWidth===e.maxWidth||(this._calculator.configure(e),t=!0),t&&this._setNeedsRender()}},{key:"resize",value:function(e){this._calculator.resize(e),this._setNeedsRender()}},{key:"_setNeedsRender",value:function(){null!=this._image&&(this._needsRender=!0)}},{key:"_clearEdges",value:function(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}},{key:"_setEdges",value:function(e,t){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];var n,r=Ad(e.edges);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.data.direction;this._stepDirections.indexOf(a)>-1?this._stepEdges.push(i):this._turnDirections.indexOf(a)>-1?this._turnEdges.push(i):i.data.direction===DM.Spherical&&this._sphericalEdges.push(i)}}catch(CO){r.e(CO)}finally{r.f()}if(this._distinguishSequence&&null!=t){var o,s=Ad(this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges));try{for(s.s();!(o=s.n()).done;){var u,l=o.value.target,c=Ad(t.imageIds);try{for(c.s();!(u=c.n()).done;){if(u.value===l){this._sequenceEdgeKeys.push(l);break}}}catch(CO){c.e(CO)}finally{c.f()}}}catch(CO){s.e(CO)}finally{s.f()}}}},{key:"_createSphericalArrows",value:function(e,t){var n,r=[],i=Ad(this._sphericalEdges);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(this._createVNodeByKey(e,a.target,a.data.worldMotionAzimuth,t,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"))}}catch(CO){i.e(CO)}finally{i.f()}var o,s=Ad(this._stepEdges);try{for(s.s();!(o=s.n()).done;){var u=o.value;r.push(this._createSphericalToPerspectiveArrow(e,u.target,u.data.worldMotionAzimuth,t,u.data.direction))}}catch(CO){s.e(CO)}finally{s.f()}return r}},{key:"_createSphericalToPerspectiveArrow",value:function(e,t,n,r,i){var a=Math.PI/8,o=r.phi;switch(i){case DM.StepBackward:o=r.phi-Math.PI;break;case DM.StepLeft:o=r.phi+Math.PI/2;break;case DM.StepRight:o=r.phi-Math.PI/2}return Math.abs(this._spatial.wrapAngle(n-o))<a?this._createVNodeByKey(e,t,n,r,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(t,n,r)}},{key:"_createPerspectiveToSphericalArrows",value:function(e,t){var n,r=[],i=Ad(this._sphericalEdges);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(this._createVNodeByKey(e,a.target,a.data.worldMotionAzimuth,t,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0))}}catch(CO){i.e(CO)}finally{i.f()}return r}},{key:"_createStepArrows",value:function(e,t){var n,r=[],i=Ad(this._stepEdges);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(this._createVNodeByDirection(e,a.target,a.data.worldMotionAzimuth,t,a.data.direction))}}catch(CO){i.e(CO)}finally{i.f()}return r}},{key:"_createTurnArrows",value:function(e){var t,n=[],r=Ad(this._turnEdges);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.data.direction,o=this._turnNames[a];n.push(this._createVNodeByTurn(e,i.target,o,a))}}catch(CO){r.e(CO)}finally{r.f()}return n}},{key:"_createVNodeByKey",value:function(e,t,n,r,i,a,o){return this._createVNode(t,n,r,i,a,"mapillary-direction-circle",(function(n){e.moveTo$(t).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))}),o)}},{key:"_createVNodeByDirection",value:function(e,t,n,r,i){return this._createVNode(t,n,r,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",(function(t){e.moveDir$(i).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))}))}},{key:"_createVNodeByTurn",value:function(e,t,n,r){var i={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(r){case DM.TurnLeft:i.left="5px",i.top="5px";break;case DM.TurnRight:i.right="5px",i.top="5px";break;case DM.TurnU:i.left="5px",i.bottom="5px"}var a={attributes:{"data-id":t},onclick:function(t){e.moveDir$(r).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))},style:i},o="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(t)>-1&&(o+="-sequence"),this._highlightKey===t&&(o+="-highlight");var s=yP.h("div.".concat(n),{},[]);return yP.h("div."+o,a,[s])}},{key:"_createVNodeInactive",value:function(e,t,n){return this._createVNode(e,t,n,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}},{key:"_createVNode",value:function(e,t,n,r,i,a,o,s){var u=this._calculator.angleToCoordinates(t-n.phi),l=Math.round(-r*u[1]+.5*this._calculator.containerWidth),c=Math.round(-r*u[0]+.5*this._calculator.containerHeight),h=this._calculator.relativeAngleToCoordiantes(t,n.phi),d=this._calculator.shadowOffset,f=-d*h[1],p=d*h[0],v="drop-shadow(".concat(f,"px ").concat(p,"px 1px rgba(0,0,0,0.8))"),m={style:{"-webkit-filter":v,filter:v}},g=yP.h("div."+i,m,[]),_=-this._spatial.radToDeg(t-n.phi),y=s?"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(_,"deg) translateZ(-0.01px)"):"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(_,"deg)"),b={attributes:{"data-id":e},onclick:o,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:y,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(e)>-1&&(a+="-sequence"),this._highlightKey===e&&(a+="-highlight"),yP.h("div."+a,b,[g])}},{key:"_getContainer",value:function(e,t,n){var r=this._isEdge?"rotateX(60deg)":"perspective(".concat(this._calculator.containerWidthCss,") rotateX(60deg)"),i={oncontextmenu:function(e){e.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:r,width:this._calculator.containerWidthCss}};return yP.h("div.mapillary-direction-perspective",i,t.concat(e))}}]),e}(),IP=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._renderer=a||new LP(o.defaultConfiguration,{height:r.container.offsetHeight,width:r.container.offsetWidth}),o._hoveredIdSubject$=new If,o._hoveredId$=o._hoveredIdSubject$.pipe(wv()),o}return $d(n,[{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(this._configuration$.subscribe((function(t){e._renderer.setConfiguration(t)}))),t.push(this._container.renderService.size$.subscribe((function(t){e._renderer.resize(t)}))),t.push(this._navigator.stateService.currentImage$.pipe(Av((function(t){e._container.domRenderer.render$.next({name:e._name,vNode:yP.h("div",{},[])}),e._renderer.setImage(t)})),Lv(this._configuration$),Tv((function(t){var n=o(t,2),r=n[0],i=n[1];return Lp(r.spatialEdges$,i.distinguishSequence?e._navigator.graphService.cacheSequence$(r.sequenceId).pipe(Jp((function(e){return console.error("Failed to cache sequence (".concat(r.sequenceId,")"),e),vp(null)}))):vp(null))}))).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];e._renderer.setEdges(r,i)}))),t.push(this._container.renderService.renderCameraFrame$.pipe(Av((function(t){e._renderer.setRenderCamera(t)})),wp((function(){return e._renderer})),Zp((function(e){return e.needsRender})),wp((function(t){return{name:e._name,vNode:t.render(e._navigator)}}))).subscribe(this._container.domRenderer.render$)),t.push(Lp(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(Cv(null)),this._container.mouseService.mouseUp$.pipe(Cv(null))).pipe(wp((function(e){for(var t=o(e,1)[0].getElementsByClassName("mapillary-direction-perspective"),n=0;n<t.length;n++){var r=t.item(n).querySelector(":hover");if(null!=r&&r.hasAttribute("data-id"))return r.getAttribute("data-id")}return null})),sv()).subscribe(this._hoveredIdSubject$)),t.push(this._hoveredId$.subscribe((function(t){var n="hover",r={id:t,target:e,type:n};e.fire(n,r)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}]),n}(wP);IP.componentName="direction";var RP=$d((function e(){Bd(this,e)}));RP.fisheye={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.fisheyeCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.perspective={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.perspectiveCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.perspectiveDistorted={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.perspectiveDistortedCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.spherical={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},RP.sphericalCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};var OP,NP=function(){function e(t,n){Bd(this,e),this._imagePlaneDepth=null!=t?t:200,this._imageSphereRadius=null!=n?n:200}return $d(e,[{key:"createMesh",value:function(e,t){return ZM(t.cameraType)?this._createImageSphere(e,t):YM(t.cameraType)?this._createImagePlaneFisheye(e,t):this._createImagePlane(e,t)}},{key:"createFlatMesh",value:function(e,t,n,r,i,a){var o=this._createTexture(e.image),s=this._createDistortedPlaneMaterialParameters(t,o),u=new J_(s),l=this._getFlatImagePlaneGeoFromBasic(t,n,r,i,a);return new W_(l,u)}},{key:"createCurtainMesh",value:function(e,t){return ZM(t.cameraType)?this._createSphereCurtainMesh(e,t):YM(t.cameraType)?this._createCurtainMeshFisheye(e,t):this._createCurtainMesh(e,t)}},{key:"createDistortedCurtainMesh",value:function(e,t){return this._createDistortedCurtainMesh(e,t)}},{key:"_createCurtainMesh",value:function(e,t){var n=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParameters(t,n),i=new J_(r),a=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new W_(a,i)}},{key:"_createCurtainMeshFisheye",value:function(e,t){var n=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParametersFisheye(t,n),i=new J_(r),a=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeo(t);return new W_(a,i)}},{key:"_createDistortedCurtainMesh",value:function(e,t){var n=this._createTexture(e.image),r=this._createDistortedCurtainPlaneMaterialParameters(t,n),i=new J_(r),a=this._getRegularFlatImagePlaneGeo(t);return new W_(a,i)}},{key:"_createSphereCurtainMesh",value:function(e,t){var n=this._createTexture(e.image),r=this._createCurtainSphereMaterialParameters(t,n),i=new J_(r);return this._useMesh(t,e)?new W_(this._getImageSphereGeo(t,e),i):new W_(this._getFlatImageSphereGeo(t),i)}},{key:"_createImageSphere",value:function(e,t){var n=this._createTexture(e.image),r=this._createSphereMaterialParameters(t,n),i=new J_(r);return this._useMesh(t,e)?new W_(this._getImageSphereGeo(t,e),i):new W_(this._getFlatImageSphereGeo(t),i)}},{key:"_createImagePlane",value:function(e,t){var n=this._createTexture(e.image),r=this._createPlaneMaterialParameters(t,n),i=new J_(r),a=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new W_(a,i)}},{key:"_createImagePlaneFisheye",value:function(e,t){var n=this._createTexture(e.image),r=this._createPlaneMaterialParametersFisheye(t,n),i=new J_(r),a=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeoFisheye(t);return new W_(a,i)}},{key:"_createSphereMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.spherical.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:RP.spherical.vertex}}},{key:"_createCurtainSphereMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.sphericalCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:RP.sphericalCurtain.vertex}}},{key:"_createPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.perspective.fragment,side:2,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:RP.perspective.vertex}}},{key:"_createPlaneMaterialParametersFisheye",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.fisheye.fragment,side:2,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:RP.fisheye.vertex}}},{key:"_createCurtainPlaneMaterialParametersFisheye",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.fisheyeCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:RP.fisheyeCurtain.vertex}}},{key:"_createCurtainPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.perspectiveCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:RP.perspectiveCurtain.vertex}}},{key:"_createDistortedCurtainPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.perspectiveDistortedCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:RP.perspectiveDistortedCurtain.vertex}}},{key:"_createDistortedPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:RP.perspectiveDistorted.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:RP.perspectiveDistorted.vertex}}},{key:"_createTexture",value:function(e){var t=new zm(e);return t.minFilter=$v,t.needsUpdate=!0,t}},{key:"_useMesh",value:function(e,t){return t.mesh.vertices.length&&e.hasValidScale}},{key:"_getImageSphereGeo",value:function(e,t){for(var n=e.srtInverse,r=5*e.scale,i=this._imageSphereRadius*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],d=a[l+2],f=Math.sqrt(c*c+h*h+d*d),p=Math.max(r,Math.min(f,i))/f,v=new Vm(c*p,h*p,d*p);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=t.mesh.faces,g=new Uint16Array(m.length),_=0;_<m.length;++_)g[_]=m[_];var y=new E_;return y.setAttribute("position",new m_(s,3)),y.setIndex(new m_(g,1)),y}},{key:"_getImagePlaneGeo",value:function(e,t){for(var n=e.srtInverse,r=5*e.scale,i=this._imagePlaneDepth*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],d=a[l+2];u<4&&(c*=3,h*=3);var f=Math.max(r,Math.min(d,i)),p=f/d,v=new Vm(c*p,h*p,f);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=t.mesh.faces,g=new Uint16Array(m.length),_=0;_<m.length;++_)g[_]=m[_];var y=new E_;return y.setAttribute("position",new m_(s,3)),y.setIndex(new m_(g,1)),y}},{key:"_getImagePlaneGeoFisheye",value:function(e,t){for(var n=e.srtInverse,r=5*e.scale,i=this._imagePlaneDepth*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],d=a[l+2],f=Math.sqrt(c*c+h*h+d*d),p=Math.max(r,Math.min(f,i))/f,v=new Vm(c*p,h*p,d*p);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=t.mesh.faces,g=new Uint16Array(m.length),_=0;_<m.length;++_)g[_]=m[_];var y=new E_;return y.setAttribute("position",new m_(s,3)),y.setIndex(new m_(g,1)),y}},{key:"_getFlatImageSphereGeo",value:function(e){var t=new nS(this._imageSphereRadius,20,40),n=e.rt.clone().invert();return t.applyMatrix4(n),t}},{key:"_getRegularFlatImagePlaneGeo",value:function(e){var t=e.width,n=e.height,r=Math.max(t,n),i=t/2/r,a=n/2/r;return this._getFlatImagePlaneGeo(e,i,a)}},{key:"_getFlatImagePlaneGeo",value:function(e,t,n){var r=[];return r.push(e.unprojectSfM([-t,-n],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-n],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,n],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,n],this._imagePlaneDepth)),this._createFlatGeometry(r)}},{key:"_getRegularFlatImagePlaneGeoFisheye",value:function(e){var t=e.width,n=e.height,r=Math.max(t,n),i=t/2/r,a=n/2/r;return this._getFlatImagePlaneGeoFisheye(e,i,a)}},{key:"_getFlatImagePlaneGeoFisheye",value:function(e,t,n){var r=[];return r.push(e.unprojectSfM([-t,-n],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-n],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,n],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,n],this._imagePlaneDepth)),this._createFlatGeometry(r)}},{key:"_getFlatImagePlaneGeoFromBasic",value:function(e,t,n,r,i){var a=[];return a.push(e.unprojectBasic([t,r],this._imagePlaneDepth)),a.push(e.unprojectBasic([n,r],this._imagePlaneDepth)),a.push(e.unprojectBasic([n,i],this._imagePlaneDepth)),a.push(e.unprojectBasic([t,i],this._imagePlaneDepth)),this._createFlatGeometry(a)}},{key:"_createFlatGeometry",value:function(e){for(var t=new Float32Array(12),n=0;n<e.length;n++){var r=3*n;t[r+0]=e[n][0],t[r+1]=e[n][1],t[r+2]=e[n][2]}var i=new Uint16Array(6);i[0]=0,i[1]=1,i[2]=3,i[3]=1,i[4]=2,i[5]=3;var a=new E_;return a.setAttribute("position",new m_(t,3)),a.setIndex(new m_(i,1)),a}}]),e}(),DP=function(){function e(){Bd(this,e),this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new tw,this._sceneOld=new tw,this._scenePeriphery=new tw}return $d(e,[{key:"planes",get:function(){return this._planes}},{key:"planesOld",get:function(){return this._planesOld}},{key:"planesPeriphery",get:function(){return this._planesPeriphery}},{key:"scene",get:function(){return this._scene}},{key:"sceneOld",get:function(){return this._sceneOld}},{key:"scenePeriphery",get:function(){return this._scenePeriphery}},{key:"updateImagePlanes",value:function(e){for(var t in this._dispose(this._planesOld,this.sceneOld),this._planes)if(this._planes.hasOwnProperty(t)){var n=this._planes[t];this._scene.remove(n),this._sceneOld.add(n)}for(var r in e)e.hasOwnProperty(r)&&this._scene.add(e[r]);this._planesOld=this._planes,this._planes=e}},{key:"addImagePlanes",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._scene.add(n),this._planes[t]=n}}},{key:"addImagePlanesOld",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._sceneOld.add(n),this._planesOld[t]=n}}},{key:"setImagePlanes",value:function(e){this._clear(),this.addImagePlanes(e)}},{key:"addPeripheryPlanes",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._scenePeriphery.add(n),this._planesPeriphery[t]=n}}},{key:"setPeripheryPlanes",value:function(e){this._clearPeriphery(),this.addPeripheryPlanes(e)}},{key:"setImagePlanesOld",value:function(e){this._clearOld(),this.addImagePlanesOld(e)}},{key:"clear",value:function(){this._clear(),this._clearOld()}},{key:"_clear",value:function(){this._dispose(this._planes,this._scene),this._planes={}}},{key:"_clearOld",value:function(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}},{key:"_clearPeriphery",value:function(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}},{key:"_dispose",value:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t.remove(r),r.geometry.dispose(),r.material.dispose();var i=r.material.uniforms.projectorTex.value;null!=i&&i.dispose()}}}]),e}(),zP=function(){function e(){Bd(this,e),this._factory=new NP,this._scene=new DP,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}return $d(e,[{key:"frameId",get:function(){return this._frameId}},{key:"needsRender",get:function(){return this._needsRender}},{key:"indicateNeedsRender",value:function(){this._needsRender=!0}},{key:"addPeripheryPlane",value:function(e,t){var n=this._factory.createMesh(e,t),r={};r[e.id]=n,this._scene.addPeripheryPlanes(r),this._needsRender=!0}},{key:"clearPeripheryPlanes",value:function(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}},{key:"updateFrame",value:function(e){this._updateFrameId(e.id),this._needsRender=this._updateAlpha(e.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(e.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(e.state)||this._needsRender}},{key:"setTextureProvider",value:function(e,t){var n=this;if(e===this._currentKey){var r=t.textureCreated$.subscribe((function(e){n._updateTexture(e)})),i=t.textureUpdated$.subscribe((function(e){n._needsRender=!0}));if(e in this._providerDisposers)(0,this._providerDisposers[e])(),delete this._providerDisposers[e];this._providerDisposers[e]=function(){r.unsubscribe(),i.unsubscribe(),t.dispose()}}}},{key:"updateTextureImage",value:function(e,t){this._needsRender=!0;var n=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(var r in n)if(n.hasOwnProperty(r)&&r===t.id){var i=n[r].material.uniforms.projectorTex.value;i.image=e,i.needsUpdate=!0}}},{key:"render",value:function(e,t){var n=this._scene.planes,r=this._scene.planesOld,i=this._scene.planesPeriphery,a=Object.keys(r).length?1:this._alpha,o=Object.keys(r).length?1:Math.floor(this._alpha);for(var s in n){if(n.hasOwnProperty(s))n[s].material.uniforms.opacity.value=a}for(var u in r){if(r.hasOwnProperty(u))r[u].material.uniforms.opacity.value=this._alphaOld}for(var l in i){if(i.hasOwnProperty(l))i[l].material.uniforms.opacity.value=o}for(var c in t.render(this._scene.scenePeriphery,e),t.render(this._scene.scene,e),t.render(this._scene.sceneOld,e),n){if(n.hasOwnProperty(c))n[c].material.uniforms.opacity.value=this._alpha}t.render(this._scene.scene,e)}},{key:"clearNeedsRender",value:function(){this._needsRender=!1}},{key:"dispose",value:function(){this._scene.clear()}},{key:"_updateFrameId",value:function(e){this._frameId=e}},{key:"_updateAlpha",value:function(e){return e!==this._alpha&&(this._alpha=e,!0)}},{key:"_updateAlphaOld",value:function(e){return!(e<1||0===this._alphaOld)&&(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}},{key:"_updateImagePlanes",value:function(e){if(null==e.currentImage||e.currentImage.id===this._currentKey)return!1;var t=null!=e.previousImage?e.previousImage.id:null,n=e.currentImage.id;this._previousKey!==t&&this._previousKey!==n&&this._previousKey in this._providerDisposers&&((0,this._providerDisposers[this._previousKey])(),delete this._providerDisposers[this._previousKey]);if(null!=t){if(t!==this._currentKey&&t!==this._previousKey){var r=this._factory.createMesh(e.previousImage,e.previousTransform),i={};i[t]=r,this._scene.updateImagePlanes(i)}this._previousKey=t}this._currentKey=n;var a=this._factory.createMesh(e.currentImage,e.currentTransform),o={};return o[n]=a,this._scene.updateImagePlanes(o),this._alphaOld=1,!0}},{key:"_updateTexture",value:function(e){this._needsRender=!0;var t=this._scene.planes;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n].material,i=r.uniforms.projectorTex.value;r.uniforms.projectorTex.value=null,i.dispose(),r.uniforms.projectorTex.value=e}}},{key:"_extend",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];for(var s in o)o.hasOwnProperty(s)&&(e[s]=o[s])}return e}}]),e}();!function(e){e[e.Background=0]="Background",e[e.Opaque=1]="Opaque"}(OP||(OP={}));var jP=function(){function e(t){Bd(this,e),this._api=t,this._urls$=new Map}return $d(e,[{key:"getImage$",value:function(e){var t,n=this,r=new Promise((function(e,n){t=n}));return[Sf.create((function(i){n._api.data.getImageBuffer(e,r).then((function(e){t=null;var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){window.URL.revokeObjectURL(n.src),i.next(n),i.complete()},n.onerror=function(){t=null,window.URL.revokeObjectURL(n.src),i.error(new Error("Failed to load image tile"))};var r=new Blob([e]);n.src=window.URL.createObjectURL(r)}),(function(e){t=null,i.error(e)}))})),function(){t&&t()}]}},{key:"getURLs$",value:function(e,t){var n=this,r=this._inventId(e,t);if(this._urls$.has(r))return this._urls$.get(r);var i={imageId:e,z:t},a=this._api.getImageTiles$(i).pipe(wp((function(e){return e.node})),dv((function(){n._urls$.delete(r)})),_v(),Pf());return this._urls$.set(r,a),a}},{key:"_inventId",value:function(e,t){return"".concat(e,"-").concat(t)}}]),e}(),BP=function(){function e(){Bd(this,e),this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}return $d(e,[{key:"add",value:function(e,t){if(this._tiles.has(e))throw new Error("Image tile already stored (".concat(e,")"));this._tiles.set(e,t)}},{key:"addURLs",value:function(e,t){var n,r=this._urls,i=Ad(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=this.inventId(a);if(this._urls.has(o))throw new Error("URL already stored (".concat(o,")"));r.set(o,a.url)}}catch(CO){i.e(CO)}finally{i.f()}this._urlLevels.add(e)}},{key:"dispose",value:function(){this._tiles.forEach((function(e){return window.URL.revokeObjectURL(e.src)})),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}},{key:"get",value:function(e){return this._tiles.get(e)}},{key:"getURL",value:function(e){return this._urls.get(e)}},{key:"has",value:function(e){return this._tiles.has(e)}},{key:"hasURL",value:function(e){return this._urls.has(e)}},{key:"hasURLLevel",value:function(e){return this._urlLevels.has(e)}},{key:"inventId",value:function(e){return"".concat(e.z,"-").concat(e.x,"-").concat(e.y)}}]),e}(),FP=function(){function e(){Bd(this,e),this._viewportCoords=new CP}return $d(e,[{key:"computeRegionOfInterest",value:function(e,t,n){var r=this._viewportBoundaryPoints(4),i=this._viewportPointsBoundingBox(r,e,n);this._clipBoundingBox(i);var a=2/t.width,o=2/t.height,s=[[-.5*a,.5*o],[.5*a,.5*o],[.5*a,-.5*o],[-.5*a,-.5*o]],u=this._viewportPointsBoundingBox(s,e,n),l=u.minX<u.maxX;return{bbox:i,pixelHeight:u.maxY-u.minY,pixelWidth:u.maxX-u.minX+(l?0:1)}}},{key:"_viewportBoundaryPoints",value:function(e){for(var t=[],n=[[-1,1],[1,1],[1,-1],[-1,-1]],r=[[2,0],[0,-2],[-2,0],[0,2]],i=0;i<4;++i)for(var a=n[i],o=r[i],s=0;s<e;++s)t.push([a[0]+o[0]*s/e,a[1]+o[1]*s/e]);return t}},{key:"_viewportPointsBoundingBox",value:function(e,t,n){var r=this,i=e.map((function(e){return r._viewportCoords.viewportToBasic(e[0],e[1],n,t.perspective)}));return ZM(n.cameraType)?this._boundingBoxSpherical(i):this._boundingBox(i)}},{key:"_boundingBox",value:function(e){for(var t={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY},n=0;n<e.length;++n)t.minX=Math.min(t.minX,e[n][0]),t.maxX=Math.max(t.maxX,e[n][0]),t.minY=Math.min(t.minY,e[n][1]),t.maxY=Math.max(t.maxY,e[n][1]);return t}},{key:"_boundingBoxSpherical",value:function(e){for(var t=this,n=[],r=[],i=0;i<e.length;++i)n.push(e[i][0]),r.push(e[i][1]);n.sort((function(e,n){return t._sign(e-n)})),r.sort((function(e,n){return t._sign(e-n)}));var a=this._intervalSpherical(n);return{maxX:a[1],maxY:r[r.length-1],minX:a[0],minY:r[0]}}},{key:"_intervalSpherical",value:function(e){for(var t=0,n=-1,r=0;r<e.length-1;++r){var i=e[r+1]-e[r];i>t&&(t=i,n=r)}return e[0]+1-e[e.length-1]>t?[e[0],e[e.length-1]]:[e[n+1],e[n]]}},{key:"_clipBoundingBox",value:function(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}},{key:"_sign",value:function(e){return e>0?1:e<0?-1:0}}]),e}();function $P(e,t,n){return Math.max(t,Math.min(n,e))}function qP(e){return 1024/UP(e)}function UP(e){return Math.pow(2,e.z-e.max)}function VP(e){return Math.ceil(function(e){var t=Math.max(e.w,e.h);return Math.log(t)/Math.log(2)}(e))}function HP(e,t,n){var r=qP(n),i=t.w,a=t.h,o=Math.ceil(i/r)-1,s=Math.ceil(a/r)-1;return{x:$P(Math.floor(i*e[0]/r),0,o),y:$P(Math.floor(a*e[1]/r),0,s)}}function WP(e,t,n){var r=1024*(1/UP(n)),i=r*e.x,a=r*e.y,o=Math.min(r,t.w-i);return{h:Math.min(r,t.h-a),x:i,y:a,w:o}}function GP(e,t,n){return n*e<=t&&t<n*(e+1)}function ZP(e,t){if(e.z===t.z)return e.x===t.x&&e.y===t.y;var n=e.z<t.z?e:t,r=e.z<t.z?t:e,i=1/UP({max:r.z,z:n.z}),a=GP(n.x,r.x,i),o=GP(n.y,r.y,i);return a&&o}function YP(e){return e.w>0&&e.h>0}var XP,KP=function(){function e(t,n,r,i,a,o,s){Bd(this,e);var u={h:r,w:n};YP(u)||console.warn("Original image size (".concat(n,", ").concat(r,") ")+"is invalid (".concat(t,"). Tiles will not be loaded.")),this._imageId=t,this._size=u,this._level={max:VP(this._size),z:-1},this._holder=new xP,this._updated$=new If,this._createdSubject$=new If,this._created$=this._createdSubject$.pipe(yv(1),Pf()),this._holder.push(this._created$.subscribe((function(){}))),this._hasSubject$=new If,this._has$=this._hasSubject$.pipe(Cv(!1),yv(1),Pf()),this._holder.push(this._has$.subscribe((function(){}))),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=a,this._store=o,this._background=i,this._renderer=s,this._aborts=[],this._render=null,this._disposed=!1}return $d(e,[{key:"disposed",get:function(){return this._disposed}},{key:"hasTexture$",get:function(){return this._has$}},{key:"id",get:function(){return this._imageId}},{key:"textureUpdated$",get:function(){return this._updated$}},{key:"textureCreated$",get:function(){return this._created$}},{key:"abort",value:function(){this._subscriptions.forEach((function(e){return e.unsubscribe()})),this._subscriptions.clear();var e,t=Ad(this._aborts);try{for(t.s();!(e=t.n()).done;){var n=e.value;n()}}catch(CO){t.e(CO)}finally{t.f()}this._aborts=[]}},{key:"dispose",value:function(){this._disposed?console.warn("Texture already disposed (".concat(this._imageId,")")):(this._urlSubscriptions.forEach((function(e){return e.unsubscribe()})),this._urlSubscriptions.clear(),this.abort(),null!=this._render&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0)}},{key:"setRegionOfInterest",value:function(e){var t=this;if(YP(this._size)){var n=1/e.pixelWidth,r=function(e,t,n){return Math.max(t,Math.min(n,VP(e)))}({h:1/e.pixelHeight,w:n},11,this._level.max);r!==this._level.z&&(this.abort(),this._level.z=r,this._renderedLevel.clear(),this._rendered.forEach((function(e,n){e.z===r&&t._renderedLevel.add(n)}))),null==this._render&&this._initRender();var i=function(e,t,n,r){var i=[];if(e.x>t.x){for(var a=qP(r),o=Math.ceil(n.w/a)-1,s=e.x;s<=o;s++)i.push(s);for(var u=0;u<=t.x;u++)i.push(u)}else for(var l=e.x;l<=t.x;l++)i.push(l);for(var c=[],h=0,d=i;h<d.length;h++)for(var f=d[h],p=e.y;p<=t.y;p++)c.push({x:f,y:p});return c}(HP([e.bbox.minX,e.bbox.minY],this._size,this._level),HP([e.bbox.maxX,e.bbox.maxY],this._size,this._level),this._size,this._level);this._fetchTiles(r,i)}}},{key:"_fetchTile",value:function(e){var t=this,n=this._loader.getImage$(e.url),r=n[0],i=n[1];this._aborts.push(i);var a=this._store.inventId(e),o=r.subscribe((function(n){var r=WP(e,t._size,t._level);t._renderToTarget(r,n),t._subscriptions.delete(a),t._removeFromArray(i,t._aborts),t._markRendered(e),t._store.add(a,n),t._updated$.next(!0)}),(function(e){t._subscriptions.delete(a),t._removeFromArray(i,t._aborts),console.error(e)}));o.closed||this._subscriptions.set(a,o)}},{key:"_fetchTiles",value:function(e,t){var n=this,r=(this._store.hasURLLevel(e)?vp(void 0):this._loader.getURLs$(this._imageId,e).pipe(Av((function(t){n._store.hasURLLevel(e)||n._store.addURLs(e,t)})))).subscribe((function(){if(e===n._level.z){var r,i=Ad(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,o={x:a.x,y:a.y,z:e,url:null},s=n._store.inventId(o);if(!n._renderedLevel.has(s)&&!n._subscriptions.has(s))if(n._store.has(s)){var u=WP(a,n._size,n._level);n._renderToTarget(u,n._store.get(s)),n._markRendered(o),n._updated$.next(!0)}else o.url=n._store.getURL(s),n._fetchTile(o)}}catch(CO){i.e(CO)}finally{i.f()}n._urlSubscriptions.delete(e)}}),(function(t){n._urlSubscriptions.delete(e),console.error(t)}));r.closed||this._urlSubscriptions.set(e,r)}},{key:"_initRender",value:function(){var e=this._size.w/2,t=this._size.h/2,n=new Sy(-e,e,t,-t,-1,1);n.position.z=1;var r=this._renderer.getContext(),i=r.getParameter(r.MAX_TEXTURE_SIZE),a=Math.max(this._size.w,this._size.h),o=i>a?1:i/a,s=Math.floor(o*this._size.w),u=Math.floor(o*this._size.h),l=new Fm(s,u,{depthBuffer:!1,format:Yv,magFilter:$v,minFilter:$v,stencilBuffer:!1});this._render={camera:n,target:l};var c=WP({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(c,this._background),this._createdSubject$.next(l.texture),this._hasSubject$.next(!0)}},{key:"_markRendered",value:function(e){var t,n=Ad(Array.from(this._rendered.entries()).filter((function(t){var n=o(t,2);n[0];return n[1].z!==e.z})));try{for(n.s();!(t=n.n()).done;){var r=o(t.value,2),i=r[0],a=r[1];ZP(e,a)&&this._rendered.delete(i)}}catch(CO){n.e(CO)}finally{n.f()}var s=this._store.inventId(e);this._rendered.set(s,e),this._renderedLevel.add(s)}},{key:"_removeFromArray",value:function(e,t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},{key:"_renderToTarget",value:function(e,t){var n=new zm(t);n.minFilter=$v,n.needsUpdate=!0;var r=new py(e.w,e.h),i=new f_({map:n,side:0}),a=new W_(r,i);a.position.x=-this._size.w/2+e.x+e.w/2,a.position.y=this._size.h/2-e.y-e.h/2;var o=new tw;o.add(a);var s=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(o,this._render.camera),this._renderer.setRenderTarget(s),o.remove(a),r.dispose(),i.dispose(),n.dispose()}}]),e}();!function(e){e[e.Custom=0]="Custom",e[e.Earth=1]="Earth",e[e.Traversing=2]="Traversing",e[e.Waiting=3]="Waiting",e[e.WaitingInteractively=4]="WaitingInteractively"}(XP||(XP={}));var JP=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._imageTileLoader=new jP(i.api),a._roiCalculator=new FP,a._rendererOperation$=new If,a._rendererCreator$=new If,a._rendererDisposer$=new If,a._renderer$=a._rendererOperation$.pipe(xv((function(e,t){return t(e)}),null),Zp((function(e){return null!=e})),sv(void 0,(function(e){return e.frameId}))),a._rendererCreator$.pipe(wp((function(){return function(e){if(null!=e)throw new Error("Multiple image plane states can not be created at the same time");return new zP}}))).subscribe(a._rendererOperation$),a._rendererDisposer$.pipe(wp((function(){return function(e){return e.dispose(),null}}))).subscribe(a._rendererOperation$),a}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(this._renderer$.pipe(wp((function(t){var n={name:e._name,renderer:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),pass:OP.Background}};return t.clearNeedsRender(),n}))).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),t.push(this._navigator.stateService.currentState$.pipe(wp((function(e){return function(t){return t.updateFrame(e),t}}))).subscribe(this._rendererOperation$));var n=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?e._navigator.stateService.currentState$:new If})),sv(void 0,(function(e){return e.state.currentImage.id})),Lv(this._container.glRenderer.webGLRenderer$),wp((function(t){var n=o(t,2),r=n[0],i=n[1],a=r.state,s=a.currentImage,u=a.currentTransform;return new KP(s.id,u.basicWidth,u.basicHeight,s.image,e._imageTileLoader,new BP,i)})),yv(1),Pf());t.push(n.subscribe((function(){}))),t.push(n.pipe(wp((function(e){return function(t){return t.setTextureProvider(e.id,e),t}}))).subscribe(this._rendererOperation$)),t.push(n.pipe(gv()).subscribe((function(e){e[0].abort()})));var r=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?Lp(e._navigator.stateService.state$,e._navigator.stateService.inTranslation$):new If})),Tv((function(t){var n=o(t,2),r=n[0],i=n[1];return(r===XP.Traversing||r===XP.Waiting||r===XP.WaitingInteractively)&&!i?e._container.renderService.renderCameraFrame$:Hf()})),wp((function(e){return{camera:e,height:e.size.height.valueOf(),lookat:e.camera.lookat.clone(),width:e.size.width.valueOf(),zoom:e.zoom.valueOf()}})),gv(),wp((function(e){var t=o(e,2),n=t[0],r=t[1],i=n.width===r.width&&n.height===r.height&&n.zoom===r.zoom&&n.lookat.equals(r.lookat);return{camera:r.camera,stalled:i}})),sv((function(e,t){return e.stalled===t.stalled})),Zp((function(e){return e.stalled})),Lv(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(n.pipe(Tv((function(t){return r.pipe(wp((function(n){var r=o(n,3),i=r[0],a=r[1],s=r[2],u=i.camera,l=(new CP).viewportToBasic(0,0,s,u.perspective);if(!(l[0]<0||l[1]<0||l[0]>1||l[1]>1))return[e._roiCalculator.computeRegionOfInterest(u,a,s),t]})),Zp((function(e){return!!e})))})),Zp((function(e){return!e[1].disposed}))).subscribe((function(e){var t=o(e,2),n=t[0];t[1].setRegionOfInterest(n)})));var i=n.pipe(Tv((function(e){return e.hasTexture$})),Cv(!1),yv(1),Pf());t.push(i.subscribe((function(){}))),t.push(this._navigator.panService.panImages$.pipe(Zp((function(e){return 0===e.length})),wp((function(){return function(e){return e.clearPeripheryPlanes(),e}}))).subscribe(this._rendererOperation$));var a=this._navigator.panService.panImages$.pipe(Tv((function(t){return ap(t).pipe(Np((function(t){var n=o(t,2),r=n[0],i=n[1];return Lp(e._navigator.graphService.cacheImage$(r.id).pipe(Jp((function(e){return console.error("Failed to cache periphery image (".concat(r.id,")"),e),Hf()}))),vp(i))})))})),wv());t.push(a.pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return function(e){return e.addPeripheryPlane(n,r),e}}))).subscribe(this._rendererOperation$)),t.push(a.pipe(Np((function(e){return o(e,1)[0].cacheImage$().pipe(Jp((function(){return Hf()})))})),wp((function(e){return function(t){return t.updateTextureImage(e.image,e),t}}))).subscribe(this._rendererOperation$));var s=this._navigator.stateService.currentState$.pipe(wp((function(e){return e.state.alpha<1})),sv()),u=Lp(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,s).pipe(wp((function(e){var t=o(e,4),n=t[0],r=t[1],i=t[2],a=t[3];return!(n||r||i||a)})),Zp((function(e){return e})));t.push(this._navigator.stateService.state$.pipe(Tv((function(t){return t===XP.Traversing?e._navigator.panService.panImages$:Hf()})),Tv((function(t){return u.pipe(Lv(e._container.renderService.renderCamera$,e._navigator.stateService.currentImage$,e._navigator.stateService.currentTransform$),Np((function(e){var n=o(e,4);return vp([n[1],n[2],n[3],t])})))})),Tv((function(t){var n=o(t,4),r=n[0],i=n[1],a=n[2],s=n[3],u=r.camera.lookat.clone().sub(r.camera.position),l=[(new WM).viewingDirection(i.rotation).angleTo(u),void 0],c=(new CP).viewportToBasic(0,0,a,r.perspective);c[0]>=0&&c[0]<=1&&c[1]>=0&&c[1]<=1&&(l[0]=Number.NEGATIVE_INFINITY);var h,d=Ad(s);try{for(d.s();!(h=d.n()).done;){var f=o(h.value,1)[0],p=(new WM).viewingDirection(f.rotation).angleTo(u);p<l[0]&&(l[0]=p,l[1]=f.id)}}catch(CO){d.e(CO)}finally{d.f()}return l[1]?e._navigator.moveTo$(l[1]).pipe(Jp((function(){return Hf()}))):Hf()}))).subscribe())}},{key:"_deactivate",value:function(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}}]),n}(wP);JP.componentName="image";var QP=function(){function e(t,n,r){Bd(this,e),this._component=t,this._container=n,this._navigator=r,this._enabled=!1}return $d(e,[{key:"isEnabled",get:function(){return this._enabled}},{key:"enable",value:function(){!this._enabled&&this._component.activated&&(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}},{key:"disable",value:function(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}]),e}(),eA=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$})));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(t)).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1],a=null;switch(r.keyCode){case 38:a=DM.Next;break;case 40:a=DM.Prev;break;default:return}if(r.preventDefault(),r.altKey&&!r.shiftKey&&i.cached){var s,u=Ad(i.edges);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l.data.direction===a)return void e._navigator.moveTo$(l.target).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))}}catch(CO){u.e(CO)}finally{u.f()}}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keySequenceNavigation:e}}}]),n}(QP),tA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._spatial=a,o}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.spatialEdges$})));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(t,this._navigator.stateService.currentState$)).subscribe((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2],s=ZM(a.state.currentImage.cameraType),u=null;switch(r.keyCode){case 37:u=r.shiftKey&&!s?DM.TurnLeft:DM.StepLeft;break;case 38:u=r.shiftKey&&!s?DM.Spherical:DM.StepForward;break;case 39:u=r.shiftKey&&!s?DM.TurnRight:DM.StepRight;break;case 40:u=r.shiftKey&&!s?DM.TurnU:DM.StepBackward;break;default:return}if(r.preventDefault(),!(r.altKey||!i.cached||r.shiftKey&&s))if(s){var l={};l[DM.StepBackward]=Math.PI,l[DM.StepForward]=0,l[DM.StepLeft]=Math.PI/2,l[DM.StepRight]=-Math.PI/2;var c,h=e._rotationFromCamera(a.state.camera).phi,d=e._spatial.wrapAngle(h+l[u]),f=Math.PI/4,p=i.edges.filter((function(e){return e.data.direction===DM.Spherical||e.data.direction===u})),v=Number.MAX_VALUE,m=null,g=Ad(p);try{for(g.s();!(c=g.n()).done;){var _=c.value,y=Math.abs(e._spatial.wrapAngle(_.data.worldMotionAzimuth-d));y<Math.min(v,f)&&(v=y,m=_.target)}}catch(CO){g.e(CO)}finally{g.f()}if(null==m)return;e._moveTo(m)}else e._moveDir(u,i)}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keySpatialNavigation:e}}},{key:"_moveDir",value:function(e,t){var n,r=Ad(t.edges);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.data.direction===e)return void this._moveTo(i.target)}}catch(CO){r.e(CO)}finally{r.f()}}},{key:"_moveTo",value:function(e){this._navigator.moveTo$(e).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))}},{key:"_rotationFromCamera",value:function(e){var t=e.lookat.clone().sub(e.position),n=t.clone().dot(e.up),r=t.clone().sub(e.up.clone().multiplyScalar(n));return{phi:Math.atan2(r.y,r.x),theta:Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1])}}}]),n}(QP),nA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._viewportCoords=a,o}return $d(n,[{key:"_enable",value:function(){var e=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2];if(!(r.altKey||r.ctrlKey||r.metaKey)){var s=0;switch(r.key){case"+":s=1;break;case"-":s=-1;break;default:return}r.preventDefault();var u=e._viewportCoords.unprojectFromViewport(0,0,i.perspective),l=a.projectBasic(u.toArray());e._navigator.stateService.zoomIn(s,l)}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keyZoom:e}}}]),n}(QP),rA=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enable",value:function(){var e=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$}))),this._navigator.stateService.state$.pipe(wp((function(e){return e===XP.Earth})),sv()))).subscribe((function(t){var n=o(t,6),r=n[0],i=n[1],a=n[2],s=n[3],u=n[4],l=n[5];if(!(r.altKey||r.ctrlKey||r.metaKey)){switch(r.key){case"D":if(!r.shiftKey)return;var c=i?null:a===DM.Next?DM.Prev:a===DM.Prev?DM.Next:null;null!=c&&e._navigator.playService.setDirection(c);break;case" ":if(r.shiftKey)return;if(!l)if(i)e._navigator.playService.stop();else{var h,d=Ad(u.edges);try{for(d.s();!(h=d.n()).done;){h.value.data.direction===a&&e._navigator.playService.play()}}catch(CO){d.e(CO)}finally{d.f()}}break;case"<":e._navigator.playService.setSpeed(s-.05);break;case">":e._navigator.playService.setSpeed(s+.05);break;default:return}r.preventDefault()}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keyPlay:e}}}]),n}(QP),iA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._keyPlayHandler=new rA(Id(a),r,i),a._keySequenceNavigationHandler=new eA(Id(a),r,i),a._keySpatialNavigationHandler=new tA(Id(a),r,i,new WM),a._keyZoomHandler=new nA(Id(a),r,i,new CP),a}return $d(n,[{key:"keyPlay",get:function(){return this._keyPlayHandler}},{key:"keySequenceNavigation",get:function(){return this._keySequenceNavigationHandler}},{key:"keySpatialNavigation",get:function(){return this._keySpatialNavigationHandler}},{key:"keyZoom",get:function(){return this._keyZoomHandler}},{key:"_activate",value:function(){var e=this;this._subscriptions.push(this._configuration$.subscribe((function(t){t.keyPlay?e._keyPlayHandler.enable():e._keyPlayHandler.disable(),t.keySequenceNavigation?e._keySequenceNavigationHandler.enable():e._keySequenceNavigationHandler.disable(),t.keySpatialNavigation?e._keySpatialNavigationHandler.enable():e._keySpatialNavigationHandler.disable(),t.keyZoom?e._keyZoomHandler.enable():e._keyZoomHandler.disable()})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}},{key:"_getDefaultConfiguration",value:function(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}]),n}(wP);iA.componentName="keyboard";var aA=function(){function e(t,n){Bd(this,e),this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=n||new yM,this._scene=t||new tw}return $d(e,[{key:"markers",get:function(){return this._markers}},{key:"needsRender",get:function(){return this._needsRender}},{key:"add",value:function(e,t){e.id in this._markers&&this._dispose(e.id),e.createGeometry(t),this._scene.add(e.geometry),this._markers[e.id]=e;var n,r=Ad(e.getInteractiveObjects());try{for(r.s();!(n=r.n()).done;){var i=n.value;this._interactiveObjects.push(i),this._objectMarkers[i.uuid]=e.id}}catch(CO){r.e(CO)}finally{r.f()}this._needsRender=!0}},{key:"clear",value:function(){for(var e in this._markers)this._markers.hasOwnProperty&&this._dispose(e);this._needsRender=!0}},{key:"get",value:function(e){return this._markers[e]}},{key:"getAll",value:function(){var e=this;return Object.keys(this._markers).map((function(t){return e._markers[t]}))}},{key:"has",value:function(e){return e in this._markers}},{key:"intersectObjects",value:function(e,t){var n=o(e,2),r=n[0],i=n[1];this._raycaster.setFromCamera(new Pm(r,i),t);var a,s=Ad(this._raycaster.intersectObjects(this._interactiveObjects));try{for(s.s();!(a=s.n()).done;){var u=a.value;if(u.object.uuid in this._objectMarkers)return this._objectMarkers[u.object.uuid]}}catch(CO){s.e(CO)}finally{s.f()}return null}},{key:"lerpAltitude",value:function(e,t,n){e in this._markers&&(this._markers[e].lerpAltitude(t,n),this._needsRender=!0)}},{key:"remove",value:function(e){e in this._markers&&(this._dispose(e),this._needsRender=!0)}},{key:"render",value:function(e,t){t.render(this._scene,e),this._needsRender=!1}},{key:"update",value:function(e,t,n){e in this._markers&&(this._markers[e].updatePosition(t,n),this._needsRender=!0)}},{key:"_dispose",value:function(e){var t=this._markers[e];this._scene.remove(t.geometry);var n,r=Ad(t.getInteractiveObjects());try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this._interactiveObjects.indexOf(i);-1!==a?this._interactiveObjects.splice(a,1):console.warn("Object does not exist (".concat(i.id,") for ").concat(e)),delete this._objectMarkers[i.uuid]}}catch(CO){r.e(CO)}finally{r.f()}t.disposeGeometry(),delete this._markers[e]}}]),e}(),oA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._graphCalculator=new zM,a._markerScene=new aA,a._markerSet=new tC,a._viewportCoords=new CP,a._relativeGroundAltitude=-2,a}return $d(n,[{key:"add",value:function(e){this._markerSet.add(e)}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"get",value:function(e){return this._markerSet.get(e)}},{key:"getAll",value:function(){return this._markerSet.getAll()}},{key:"getMarkerIdAt",value:function(e){var t=this;return new Promise((function(n,r){t._container.renderService.renderCamera$.pipe(fv(),wp((function(n){var r=t._viewportCoords.canvasToViewport(e[0],e[1],t._container.container);return t._markerScene.intersectObjects(r,n.perspective)}))).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"has",value:function(e){return this._markerSet.has(e)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"remove",value:function(e){this._markerSet.remove(e)}},{key:"removeAll",value:function(){this._markerSet.removeAll()}},{key:"_activate",value:function(){var e=this,t=this._navigator.stateService.currentState$.pipe(wp((function(t){return t.state.camera.position.z+e._relativeGroundAltitude})),sv((function(e,t){return Math.abs(e-t)<.01})),yv(1),Pf()),n=Lp(t,this._navigator.stateService.reference$).pipe(fv(),wp((function(){})),yv(1),Pf()),r=this._configuration$.pipe(wp((function(e){return{visibleBBoxSize:Math.max(1,Math.min(200,e.visibleBBoxSize))}}))),i=this._navigator.stateService.currentImage$.pipe(wp((function(e){return e.lngLat})),yv(1),Pf()),a=Lp(r,i).pipe(wp((function(t){var n=o(t,2),r=n[0],i=n[1];return e._graphCalculator.boundingBoxCorners(i,r.visibleBBoxSize/2)})),yv(1),Pf()),s=Lp(jp(vp(this._markerSet),this._markerSet.changed$),a).pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return n.search(r)}))),u=this._subscriptions;u.push(n.pipe(Tv((function(){return s.pipe(Lv(e._navigator.stateService.reference$,t))}))).subscribe((function(t){var n,r=o(t,3),i=r[0],a=r[1],s=r[2],u=e._markerScene,l=u.markers,c=Object.assign({},l),h=Ad(i);try{for(h.s();!(n=h.n()).done;){var d=n.value;if(d.id in l)delete c[d.id];else{var f=RM(d.lngLat.lng,d.lngLat.lat,a.alt+s,a.lng,a.lat,a.alt);u.add(d,f)}}}catch(CO){h.e(CO)}finally{h.f()}for(var p in c)c.hasOwnProperty(p)&&u.remove(p)}))),u.push(n.pipe(Tv((function(){return e._markerSet.updated$.pipe(Lv(a,e._navigator.stateService.reference$,t))}))).subscribe((function(t){var n,r=o(t,4),i=r[0],a=o(r[1],2),s=a[0],u=a[1],l=r[2],c=r[3],h=e._markerScene,d=Ad(i);try{for(d.s();!(n=d.n()).done;){var f=n.value,p=h.has(f.id),v=f.lngLat.lat>s.lat&&f.lngLat.lat<u.lat&&f.lngLat.lng>s.lng&&f.lngLat.lng<u.lng;if(v){var m=RM(f.lngLat.lng,f.lngLat.lat,l.alt+c,l.lng,l.lat,l.alt);h.add(f,m)}else!v&&p&&h.remove(f.id)}}catch(CO){d.e(CO)}finally{d.f()}}))),u.push(this._navigator.stateService.reference$.pipe(Sv(1),Lv(t)).subscribe((function(t){var n,r=o(t,2),i=r[0],a=r[1],s=e._markerScene,u=Ad(s.getAll());try{for(u.s();!(n=u.n()).done;){var l=n.value,c=RM(l.lngLat.lng,l.lngLat.lat,i.alt+a,i.lng,i.lat,i.alt);s.update(l.id,c)}}catch(CO){u.e(CO)}finally{u.f()}}))),u.push(t.pipe(Sv(1),Lv(this._navigator.stateService.reference$,i)).subscribe((function(t){var n,r=o(t,3),i=r[0],a=r[1],s=r[2],u=e._markerScene,l=RM(s.lng,s.lat,a.alt+i,a.lng,a.lat,a.alt),c=Ad(u.getAll());try{for(c.s();!(n=c.n()).done;){var h=n.value,d=RM(h.lngLat.lng,h.lngLat.lat,a.alt+i,a.lng,a.lat,a.alt),f=d[0]-l[0],p=d[1]-l[1],v=Math.sqrt(f*f+p*p);v>50||u.lerpAltitude(h.id,i,Math.min(1,Math.max(0,1.2-1.2*v/50)))}}catch(CO){c.e(CO)}finally{c.f()}}))),u.push(this._navigator.stateService.currentState$.pipe(wp((function(t){var n=e._markerScene;return{name:e._name,renderer:{frameId:t.id,needsRender:n.needsRender,render:n.render.bind(n),pass:OP.Opaque}}}))).subscribe(this._container.glRenderer.render$));var l=Lp(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(wp((function(t){var n=o(t,2),r=n[0],i=n[1],a=e._container.container,s=o(e._viewportCoords.canvasPosition(i,a),2),u=s[0],l=s[1],c=e._viewportCoords.canvasToViewport(u,l,a);return e._markerScene.intersectObjects(c,r.perspective)})),yv(1),Pf()),c=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(wp((function(){return!0}))),h=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(wp((function(){return!1}))),d=Hp(c,h).pipe(Cv(!1));u.push(Hp(c.pipe(Lv(l)),Lp(h,vp(null))).pipe(Cv([!1,null]),gv()).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1],a=i[0],s=a?"markerdragstart":"markerdragend",u=a?i[1]:r[1],l={marker:e._markerScene.get(u),target:e,type:s};e.fire(s,l)})));var f=Hp(this._container.mouseService.mouseDown$.pipe(wp((function(){return!0}))),this._container.mouseService.documentMouseUp$.pipe(wp((function(){return!1})))).pipe(Cv(!1));u.push(Lp(this._container.mouseService.active$,l.pipe(sv()),f,d).pipe(wp((function(e){var t=o(e,4),n=t[0],r=t[1],i=t[2],a=t[3];return!n&&null!=r&&i||a})),sv()).subscribe((function(t){t?(e._container.mouseService.claimMouse(e._name,1),e._container.mouseService.claimWheel(e._name,1)):(e._container.mouseService.unclaimMouse(e._name),e._container.mouseService.unclaimWheel(e._name))})));var p=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(Lv(l,this._container.renderService.renderCamera$),wp((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2],s=e._markerScene.get(i),u=e._container.container,l=o(e._viewportCoords.projectToCanvas(s.geometry.position.toArray(),u,a.perspective),2),c=l[0],h=l[1],d=o(e._viewportCoords.canvasPosition(r,u),2);return[s,[d[0]-c,d[1]-h],a]})),yv(1),Pf());u.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(Lv(p,this._navigator.stateService.reference$,r)).subscribe((function(t){var n=o(t,4),r=n[0],i=o(n[1],3),a=i[0],s=i[1],u=i[2],l=n[2],c=n[3];if(e._markerScene.has(a.id)){var h=e._container.container,d=o(e._viewportCoords.canvasPosition(r,h),2),f=d[0],p=d[1],v=f-s[0],m=p-s[1],g=o(e._viewportCoords.canvasToViewport(v,m,h),2),_=g[0],y=g[1],b=new Vm(_,y,1).unproject(u.perspective).sub(u.perspective.position).normalize(),x=Math.min(e._relativeGroundAltitude/b.z,c.visibleBBoxSize/2-.1);if(!(x<0)){var w=b.clone().multiplyScalar(x).add(u.perspective.position);w.z=u.perspective.position.z+e._relativeGroundAltitude;var k=o(OM(w.x,w.y,w.z,l.lng,l.lat,l.alt),2),S=k[0],M=k[1];e._markerScene.update(a.id,w.toArray(),{lat:M,lng:S}),e._markerSet.update(a);var C="markerposition",T={marker:a,target:e,type:C};e.fire(C,T)}}})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._markerScene.clear()}},{key:"_getDefaultConfiguration",value:function(){return{visibleBBoxSize:100}}}]),n}(wP);function sA(e,t){return e.x<=Math.max(t.p1.x,t.p2.x)&&e.x>=Math.min(t.p1.x,t.p2.x)&&e.y>=Math.max(t.p1.y,t.p2.y)&&e.y>=Math.min(t.p1.y,t.p2.y)}function uA(e,t){var n=e.p2.x-e.p1.x,r=e.p2.y-e.p1.y,i=t.p2.x-t.p1.x,a=t.p2.y-t.p1.y,o=n*a-r*i;return o*o<1e-10*(n*n+r*r)*(i*i+a*a)}function lA(e,t,n){var r,i=(t.y-e.y)*(n.x-t.x)-(n.y-t.y)*(t.x-e.x);return(r=i)>0?1:r<0?-1:0}function cA(e,t){if(uA(e,t))return!1;var n=lA(e.p1,e.p2,t.p1),r=lA(e.p1,e.p2,t.p2),i=lA(t.p1,t.p2,e.p1),a=lA(t.p1,t.p2,e.p2);return n!==r&&i!==a||(!(0!==n||!sA(t.p1,e))||(!(0!==r||!sA(t.p2,e))||(!(0!==i||!sA(e.p1,t))||!(0!==a||!sA(e.p2,t)))))}function hA(e,t){if(!uA(e,t)){var n=e.p1.x,r=e.p2.x,i=e.p1.y,a=e.p2.y,o=t.p1.x,s=t.p2.x,u=t.p1.y,l=t.p2.y,c=(n-r)*(u-l)-(i-a)*(o-s);return{x:((n*a-i*r)*(o-s)-(n-r)*(o*l-u*s))/c,y:((n*a-i*r)*(u-l)-(i-a)*(o*l-u*s))/c}}}function dA(e,t){return e>=-1&&e<=1&&t>=-1&&t<=1}function fA(e,t){return e>=0&&e<=1&&t>=0&&t<=1}function pA(e,t,n){for(var r=function(e){for(var t=[],n=[[0,0],[1,0],[1,1],[0,1]],r=[[1,0],[0,1],[-1,0],[0,-1]],i=0;i<4;++i)for(var a=n[i],o=r[i],s=0;s<e;++s)t.push([a[0]+o[0]*s/e,a[1]+o[1]*s/e]);return t}(100),i=r.map((function(r){return n.basicToViewportSafe(r[0],r[1],e,t)})),a=[],s=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],u=[!1,!1,!1,!1],l=0;l<i.length;l++){var c=i[l],h=i[(l+1)%i.length];if(null!==c)if(null!==h){var d=o(c,2),f=d[0],p=d[1],v=o(h,2),m=v[0],g=v[1];if(dA(f,p))if(dA(m,g))a.push(c);else for(var _=0;_<4;_++){var y={p1:{x:f,y:p},p2:{x:m,y:g}},b={p1:s[_],p2:s[(_+1)%4]};if(cA(y,b)){var x=hA(y,b);a.push(c,[x.x,x.y]),u[_]=!0}}}else dA(c[0],c[1])&&a.push(c)}var w=o(n.viewportToBasic(-1,1,e,t),2),k=w[0],S=w[1],M=o(n.viewportToBasic(1,1,e,t),2),C=M[0],T=M[1],E=o(n.viewportToBasic(1,-1,e,t),2),P=E[0],A=E[1],L=o(n.viewportToBasic(-1,-1,e,t),2),I=L[0],R=L[1];fA(k,S)&&(u[3]=u[0]=!0),fA(C,T)&&(u[0]=u[1]=!0),fA(P,A)&&(u[1]=u[2]=!0),fA(I,R)&&(u[2]=u[3]=!0);for(var O=[-1,-1,1,1],N=0,D=a;N<D.length;N++){var z=D[N],j=z[0],B=z[1];j>O[1]&&(O[1]=j),j<O[3]&&(O[3]=j),B>O[0]&&(O[0]=B),B<O[2]&&(O[2]=B)}var F=[1,1,-1,-1],$=[];for(_=0;_<4;_++)u[_]?$.push(0):$.push(Math.abs(F[_]-O[_]));return $}oA.componentName="marker";var vA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o){var s;return Bd(this,n),(s=t.call(this,e,r,i))._spatial=o,s._viewportCoords=a,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.currentState$.pipe(wp((function(e){return e.state.alpha<1})),sv());this._bounceSubscription=Lp(t,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(wp((function(e){return e[0]||e[1]||e[2]||e[3]})),sv(),Tv((function(t){return t?Hf():Lp(e._container.renderService.renderCamera$,e._navigator.stateService.currentTransform$.pipe(fv()))})),Lv(this._navigator.panService.panImages$)).subscribe((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1];if((a.hasValidScale||!(i.camera.focal<.1))&&0!==i.perspective.aspect&&i.perspective.aspect!==Number.POSITIVE_INFINITY){var u=pA(a,i.perspective,e._viewportCoords),l=e._viewportCoords.viewportToBasic(0,0,a,i.perspective);(l[0]<0||l[0]>1)&&s.length>0&&(u[0]=u[2]=0);var c,h=Ad(s);try{for(h.s();!(c=h.n()).done;)for(var d=pA(o(c.value,2)[1],i.perspective,e._viewportCoords),f=1;f<u.length;f+=2)d[f]<u[f]&&(u[f]=d[f])}catch(CO){h.e(CO)}finally{h.f()}if(!(Math.max.apply(Math,xd(u))<.01)){var p=u[1]-u[3],v=u[0]-u[2],m=e._viewportCoords.unprojectFromViewport(0,0,i.perspective).sub(i.perspective.position),g=e._viewportCoords.unprojectFromViewport(p,0,i.perspective).sub(i.perspective.position),_=e._viewportCoords.unprojectFromViewport(0,v,i.perspective).sub(i.perspective.position),y=(p>0?1:-1)*g.angleTo(m),b=(v>0?1:-1)*_.angleTo(m),x=Math.PI/60;y=e._spatial.clamp(.1*y,-x,x),b=e._spatial.clamp(.1*b,-x,x),e._navigator.stateService.rotateUnbounded({phi:y,theta:b})}}}))}},{key:"_disable",value:function(){this._bounceSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(){return{}}}]),n}(QP),mA=function(){function e(){Bd(this,e)}return $d(e,null,[{key:"filteredPairwiseMouseDrag$",value:function(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseDragStart$,t.mouseDrag$,t.mouseDragEnd$)}},{key:"filteredPairwiseMouseRightDrag$",value:function(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseRightDragStart$,t.mouseRightDrag$,t.mouseRightDragEnd$)}},{key:"_filteredPairwiseMouseDrag$",value:function(e,t,n,r,i){return t.filtered$(e,n).pipe(Tv((function(n){return Hp(jp(vp(n),t.filtered$(e,r)),t.filtered$(e,i).pipe(wp((function(){return null})))).pipe(Pv((function(e){return!!e})),Cv(null))})),gv(),Zp((function(e){return null!=e[0]&&null!=e[1]})))}}]),e}(),gA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o){var s;return Bd(this,n),(s=t.call(this,e,r,i))._spatial=o,s._viewportCoords=a,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(wp((function(){return!0})),wv()),n=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(wp((function(){return!1})),wv());this._activeMouseSubscription=Hp(t,n).subscribe(this._container.mouseService.activate$);var r=Hp(t,n).pipe(Tv((function(t){return t?e._container.mouseService.documentMouseMove$:Hf()})));this._preventDefaultSubscription=Hp(r,this._container.touchService.touchMove$).subscribe((function(e){e.preventDefault()}));var i=this._container.touchService.singleTouchDragStart$.pipe(wp((function(){return!0}))),a=this._container.touchService.singleTouchDragEnd$.pipe(wp((function(){return!1})));this._activeTouchSubscription=Hp(i,a).subscribe(this._container.touchService.activate$);var s,u=this._navigator.stateService.currentState$.pipe(wp((function(e){return ZM(e.state.currentImage.cameraType)||e.state.imagesAhead<1})),sv(),Tv((function(t){if(!t)return Hf();var n=mA.filteredPairwiseMouseDrag$(e._component.name,e._container.mouseService),r=Hp(e._container.touchService.singleTouchDragStart$,e._container.touchService.singleTouchDrag$,e._container.touchService.singleTouchDragEnd$.pipe(wp((function(){return null})))).pipe(wp((function(e){return null!=e&&e.touches.length>0?e.touches[0]:null})),gv(),Zp((function(e){return null!=e[0]&&null!=e[1]})));return Hp(n,r)})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),wp((function(t){var n,r=o(t,4),i=r[0],a=r[1],s=r[2],u=r[3],l=i[0],c=i[1],h=c.clientX-l.clientX,d=c.clientY-l.clientY,f=e._container.container,p=o(e._viewportCoords.canvasPosition(c,f),2),v=p[0],m=p[1],g=e._viewportCoords.unprojectFromCanvas(v,m,f,a.perspective).sub(a.perspective.position),_=e._viewportCoords.unprojectFromCanvas(v-h,m,f,a.perspective).sub(a.perspective.position),y=e._viewportCoords.unprojectFromCanvas(v,m-d,f,a.perspective).sub(a.perspective.position),b=(h>0?1:-1)*_.angleTo(g),x=(d>0?-1:1)*y.angleTo(g),w=pA(s,a.perspective,e._viewportCoords),k=Ad(u);try{for(k.s();!(n=k.n()).done;)for(var S=pA(o(n.value,2)[1],a.perspective,e._viewportCoords),M=0;M<w.length;M++)S[M]<w[M]&&(w[M]=S[M])}catch(CO){k.e(CO)}finally{k.f()}return w[0]>0&&x<0&&(x/=Math.max(1,200*w[0])),w[2]>0&&x>0&&(x/=Math.max(1,200*w[2])),w[1]>0&&b<0&&(b/=Math.max(1,200*w[1])),w[3]>0&&b>0&&(b/=Math.max(1,200*w[3])),{phi:b,theta:x}})),wv());this._rotateWithoutInertiaSubscription=u.subscribe((function(t){e._navigator.stateService.rotateWithoutInertia(t)})),this._rotateSubscription=u.pipe(xv((function(t,n){return e._drainBuffer(t),t.push([Date.now(),n]),t}),[]),(s=Hp(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$),Tf((function(e,t){var n=!1,r=null;e.subscribe(new Ef(t,(function(e){n=!0,r=e}))),s.subscribe(new Ef(t,(function(){if(n){n=!1;var e=r;r=null,t.next(e)}}),cf))}))),wp((function(t){var n,r=e._drainBuffer(t.slice()),i={phi:0,theta:0},a=Ad(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.phi+=o[1].phi,i.theta+=o[1].theta}}catch(CO){a.e(CO)}finally{a.f()}var s=r.length;s>0&&(i.phi/=s,i.theta/=s);var u=Math.PI/18;return i.phi=e._spatial.clamp(i.phi,-u,u),i.theta=e._spatial.clamp(i.theta,-u,u),i}))).subscribe((function(t){e._navigator.stateService.rotate(t)}))}},{key:"_disable",value:function(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}},{key:"_getConfiguration",value:function(e){return{dragPan:e}}},{key:"_drainBuffer",value:function(e){for(var t=Date.now();e.length>0&&t-e[0][0]>50;)e.shift();return e}}]),n}(QP),_A=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o){var s;return Bd(this,n),(s=t.call(this,e,r,i))._spatial=o,s._viewportCoords=a,s._subscriptions=new xP,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.state$.pipe(wp((function(e){return e===XP.Earth})),yv(1),Pf()),n=this._subscriptions;n.push(t.pipe(Tv((function(t){return t?e._container.mouseService.mouseWheel$:Hf()}))).subscribe((function(e){e.preventDefault()}))),n.push(t.pipe(Tv((function(t){return t?mA.filteredPairwiseMouseDrag$(e._component.name,e._container.mouseService).pipe(Zp((function(e){var t=o(e,2),n=t[0],r=t[1];return!(n.ctrlKey&&r.ctrlKey)}))):Hf()})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),wp((function(t){var n=o(t,3),r=o(n[0],2),i=r[0],a=r[1],s=n[1],u=(n[2],[0,0,1]),l=[0,0,-2],c=e._planeIntersection(a,u,l,s.perspective,e._container.container),h=e._planeIntersection(i,u,l,s.perspective,e._container.container);return c&&h?(new Vm).subVectors(c,h).multiplyScalar(-1).toArray():null})),Zp((function(e){return!!e}))).subscribe((function(t){e._navigator.stateService.truck(t)}))),n.push(t.pipe(Tv((function(t){return t?mA.filteredPairwiseMouseDrag$(e._component.name,e._container.mouseService).pipe(Zp((function(e){var t=o(e,2),n=t[0],r=t[1];return n.ctrlKey&&r.ctrlKey}))):Hf()})),wp((function(t){var n=o(t,2),r=n[0],i=n[1];return e._mousePairToRotation(r,i)}))).subscribe((function(t){e._navigator.stateService.orbit(t)}))),n.push(t.pipe(Tv((function(t){return t?mA.filteredPairwiseMouseRightDrag$(e._component.name,e._container.mouseService).pipe(Zp((function(e){var t=o(e,2),n=t[0],r=t[1];return!n.ctrlKey&&!r.ctrlKey}))):Hf()})),wp((function(t){var n=o(t,2),r=n[0],i=n[1];return e._mousePairToRotation(r,i)}))).subscribe((function(t){e._navigator.stateService.orbit(t)}))),n.push(t.pipe(Tv((function(t){return t?e._container.mouseService.filteredWheel$(e._component.name,e._container.mouseService.mouseWheel$):Hf()})),wp((function(t){var n=t.deltaY;return 1===t.deltaMode?n*=40:2===t.deltaMode&&(n*=800),-n/e._viewportCoords.containerToCanvas(e._container.container)[1]}))).subscribe((function(t){e._navigator.stateService.dolly(t)})))}},{key:"_disable",value:function(){this._subscriptions.unsubscribe()}},{key:"_getConfiguration",value:function(){return{}}},{key:"_eventToViewport",value:function(e,t){var n=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToViewport(n[0],n[1],t)}},{key:"_mousePairToRotation",value:function(e,t){var n=o(this._eventToViewport(t,this._container.container),2),r=n[0],i=n[1],a=o(this._eventToViewport(e,this._container.container),2),s=a[0],u=a[1];return{phi:(s-r)*Math.PI,theta:(i-u)*Math.PI/2}}},{key:"_planeIntersection",value:function(e,t,n,r,i){var a=o(this._viewportCoords.canvasPosition(e,i),2),s=a[0],u=a[1],l=this._viewportCoords.unprojectFromCanvas(s,u,i,r).sub(r.position).normalize();if(Math.abs(this._spatial.angleToPlane(l.toArray(),t))<Math.PI/90)return null;var c=r.position.clone(),h=(new Vm).fromArray(t),d=(new Vm).fromArray(n),f=(new Vm).subVectors(d,c).dot(h)/l.clone().dot(h),p=(new Vm).addVectors(c,l.multiplyScalar(f));return this._viewportCoords.worldToCamera(p.toArray(),r)[2]>0?null:p}}]),n}(QP),yA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._viewportCoords=a,o}return $d(n,[{key:"_enable",value:function(){var e=this;this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe((function(e){e.preventDefault()})),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(Lv(this._navigator.stateService.currentState$,(function(e,t){return[e,t]})),Zp((function(e){var t=e[1].state;return ZM(t.currentImage.cameraType)||t.imagesAhead<1})),wp((function(e){return e[0]})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,(function(e,t,n){return[e,t,n]}))).subscribe((function(t){var n=t[0],r=t[1],i=t[2],a=e._container.container,s=o(e._viewportCoords.canvasPosition(n,a),2),u=s[0],l=s[1],c=e._viewportCoords.unprojectFromCanvas(u,l,a,r.perspective),h=i.projectBasic(c.toArray()),d=n.deltaY;1===n.deltaMode?d*=40:2===n.deltaMode&&(d*=800);var f=-3*d/e._viewportCoords.containerToCanvas(a)[1];e._navigator.stateService.zoomIn(f,h)}))}},{key:"_disable",value:function(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}},{key:"_getConfiguration",value:function(e){return{scrollZoom:e}}}]),n}(QP),bA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._viewportCoords=a,o}return $d(n,[{key:"_enable",value:function(){var e=this;this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe((function(e){e.originalEvent.preventDefault()}));var t=this._container.touchService.pinchStart$.pipe(wp((function(e){return!0}))),n=this._container.touchService.pinchEnd$.pipe(wp((function(e){return!1})));this._activeSubscription=Hp(t,n).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(Lv(this._navigator.stateService.currentState$),Zp((function(e){var t=e[1].state;return ZM(t.currentImage.cameraType)||t.imagesAhead<1})),wp((function(e){return e[0]})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2],s=e._container.container,u=o(e._viewportCoords.canvasPosition(r,s),2),l=u[0],c=u[1],h=e._viewportCoords.unprojectFromCanvas(l,c,s,i.perspective),d=a.projectBasic(h.toArray()),f=o(e._viewportCoords.containerToCanvas(s),2),p=f[0],v=f[1],m=3*r.distanceChange/Math.min(p,v);e._navigator.stateService.zoomIn(m,d)}))}},{key:"_disable",value:function(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}},{key:"_getConfiguration",value:function(e){return{touchZoom:e}}}]),n}(QP),xA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;Bd(this,n),a=t.call(this,e,r,i);var o=new WM,s=new CP;return a._bounceHandler=new vA(Id(a),r,i,s,o),a._dragPanHandler=new gA(Id(a),r,i,s,o),a._earthControlHandler=new _A(Id(a),r,i,s,o),a._scrollZoomHandler=new yA(Id(a),r,i,s),a._touchZoomHandler=new bA(Id(a),r,i,s),a}return $d(n,[{key:"dragPan",get:function(){return this._dragPanHandler}},{key:"earthControl",get:function(){return this._earthControlHandler}},{key:"scrollZoom",get:function(){return this._scrollZoomHandler}},{key:"touchZoom",get:function(){return this._touchZoomHandler}},{key:"_activate",value:function(){var e=this;this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe((function(t){t.dragPan?e._dragPanHandler.enable():e._dragPanHandler.disable(),t.earthControl?e._earthControlHandler.enable():e._earthControlHandler.disable(),t.scrollZoom?e._scrollZoomHandler.enable():e._scrollZoomHandler.disable(),t.touchZoom?e._touchZoomHandler.enable():e._touchZoomHandler.disable()}))),this._container.mouseService.claimMouse(this._name,0)}},{key:"_deactivate",value:function(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}},{key:"_getDefaultConfiguration",value:function(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}]),n}(wP);xA.componentName="pointer";var wA,kA,SA=function(){function e(t){Bd(this,e),this._document=t||document}return $d(e,[{key:"document",get:function(){return this._document}},{key:"createElement",value:function(e,t,n){var r=this._document.createElement(e);return t&&(r.className=t),n&&n.appendChild(r),r}}]),e}(),MA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._dom=a||new SA,o._popups=[],o._added$=new If,o._popups$=new If,o}return $d(n,[{key:"add",value:function(e){var t,n=Ad(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;-1===this._popups.indexOf(r)&&(this._popups.push(r),this._activated&&r.setParentContainer(this._popupContainer))}}catch(CO){n.e(CO)}finally{n.f()}this._added$.next(e),this._popups$.next(this._popups)}},{key:"getAll",value:function(){return this._popups.slice()}},{key:"remove",value:function(e){var t,n=Ad(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._remove(r)}}catch(CO){n.e(CO)}finally{n.f()}this._popups$.next(this._popups)}},{key:"removeAll",value:function(){var e,t=Ad(this._popups.slice());try{for(t.s();!(e=t.n()).done;){var n=e.value;this._remove(n)}}catch(CO){t.e(CO)}finally{t.f()}this._popups$.next(this._popups)}},{key:"_activate",value:function(){var e=this;this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);var t,n=Ad(this._popups);try{for(n.s();!(t=n.n()).done;){t.value.setParentContainer(this._popupContainer)}}catch(CO){n.e(CO)}finally{n.f()}var r=this._subscriptions;r.push(Lp(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe((function(t){var n,r=o(t,3),i=r[0],a=r[1],s=r[2],u=Ad(e._popups);try{for(u.s();!(n=u.n()).done;){n.value.update(i,a,s)}}catch(CO){u.e(CO)}finally{u.f()}})));var i=this._popups$.pipe(Cv(this._popups),Tv((function(e){return ap(e).pipe(Np((function(e){return e.changed$})))})),wp((function(e){return[e]})));r.push(Hp(this._added$,i).pipe(Lv(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe((function(e){var t,n=o(e,4),r=n[0],i=n[1],a=n[2],s=n[3],u=Ad(r);try{for(u.s();!(t=u.n()).done;){t.value.update(i,a,s)}}catch(CO){u.e(CO)}finally{u.f()}})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe();var e,t=Ad(this._popups);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(CO){t.e(CO)}finally{t.f()}this._container.container.removeChild(this._popupContainer),delete this._popupContainer}},{key:"_getDefaultConfiguration",value:function(){return{}}},{key:"_remove",value:function(e){var t=this._popups.indexOf(e);if(-1!==t){var n=this._popups.splice(t,1)[0];this._activated&&n.remove()}}}]),n}(wP);MA.componentName="popup",function(e){e[e.Sequence=0]="Sequence",e[e.Spatial=1]="Spatial"}(wA||(wA={})),function(e){e[e.Default=0]="Default",e[e.Playback=1]="Playback",e[e.Timeline=2]="Timeline"}(kA||(kA={}));var CA,TA=function(){function e(t){Bd(this,e),this._container=t,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=kA.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new If,this._mouseLeaveDirection$=new If,this._notifyChanged$=new If,this._notifyChangingPositionChanged$=new If,this._notifySpeedChanged$=new If,this._notifyIndexChanged$=new If}return $d(e,[{key:"changed$",get:function(){return this._notifyChanged$}},{key:"changingPositionChanged$",get:function(){return this._notifyChangingPositionChanged$}},{key:"speed$",get:function(){return this._notifySpeedChanged$}},{key:"index$",get:function(){return this._notifyIndexChanged$}},{key:"mouseEnterDirection$",get:function(){return this._mouseEnterDirection$}},{key:"mouseLeaveDirection$",get:function(){return this._mouseLeaveDirection$}},{key:"activate",value:function(){var e=this;this._changingSubscription||(this._changingSubscription=Hp(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(Zp((function(e){return 0===e.touches.length})))).subscribe((function(){e._changingSpeed&&(e._changingSpeed=!1),e._changingPosition&&e._setChangingPosition(!1)})))}},{key:"deactivate",value:function(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=kA.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}},{key:"render",value:function(e,t,n,r,i,a,o,s,u){if(!1===t.visible)return yP.h("div.mapillary-sequence-container",{},[]);var l=this._createStepper(e,t,o,n,s,u),c=this._createSequenceControls(n),h=this._createPlaybackControls(n,r,s,t),d=this._createTimelineControls(n,i,a);return yP.h("div.mapillary-sequence-container",[l,c,h,d])}},{key:"getContainerWidth",value:function(e,t){var n=t.minWidth,r=t.maxWidth;r<n&&(r=n);var i=(e.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),a=(e.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);return n+Math.max(0,Math.min(1,Math.min(i,a)))*(r-n)}},{key:"_createPositionInput",value:function(e,t){var n=this;this._index=e;var r=function(e){n._index=Number(e.target.value),n._notifyIndexChanged$.next(n._index)},i=this._container.domContainer.getBoundingClientRect(),a=Math.max(276,Math.min(410,5+.8*i.width))-65,o=function(e){e.stopPropagation(),n._setChangingPosition(!0)},s=function(e){!0===n._changingPosition&&e.stopPropagation()},u={max:null!=t?t:1,min:0,onchange:r,oninput:r,onkeydown:function(e){"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:o,onpointermove:s,ontouchmove:s,ontouchstart:o,style:{width:"".concat(a,"px")},type:"range",value:null!=e?e:0},l=null==e||null==t||t<=1;l&&(u.disabled="true");var c=yP.h("input.mapillary-sequence-position",u,[]),h=l?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return yP.h("div"+h,[c])}},{key:"_createSpeedInput",value:function(e){var t=this;this._speed=e;var n=function(e){t._speed=Number(e.target.value)/1e3,t._notifySpeedChanged$.next(t._speed)},r=this._container.domContainer.getBoundingClientRect(),i=Math.max(276,Math.min(410,5+.8*r.width))-160,a=function(e){t._changingSpeed=!0,e.stopPropagation()},o=function(e){!0===t._changingSpeed&&e.stopPropagation()},s=yP.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:n,oninput:n,onkeydown:function(e){"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:a,onpointermove:o,ontouchmove:o,ontouchstart:a,style:{width:"".concat(i,"px")},type:"range",value:1e3*e},[]);return yP.h("div.mapillary-sequence-speed-container",[s])}},{key:"_createPlaybackControls",value:function(e,t,n,r){var i=this;if(this._mode!==kA.Playback)return yP.h("div.mapillary-sequence-playback",[]);var a=yP.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),o=r.direction===DM.Next?DM.Prev:DM.Next,s=r.playing,u={onclick:function(){s||n.configure({direction:o})}},l=r.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",c=yP.h("div"+l,u,[a]),h=yP.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),d=yP.h("div.mapillary-sequence-slow-container",[h]),f=yP.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),p=yP.h("div.mapillary-sequence-fast-container",[f]),v=yP.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),m={onclick:function(){i._mode=kA.Default,i._notifyChanged$.next(i)}},g=yP.h("div.mapillary-sequence-close-button",m,[v]),_=[c,d,this._createSpeedInput(t),p,g],y=Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10),b={style:{top:"".concat(y,"px")}};return yP.h("div.mapillary-sequence-playback",b,_)}},{key:"_createPlayingButton",value:function(e,t,n,r,i){var a=r.direction===DM.Next&&null!=e||r.direction===DM.Prev&&null!=t;a=a&&n;var o={onclick:r.playing?function(){i.stop()}:a?function(){i.play()}:null},s={};r.direction===DM.Prev&&(s.style={transform:"rotate(180deg) translate(50%, 50%)"});var u=yP.h("div.mapillary-sequence-icon",s,[]),l=r.playing?"mapillary-sequence-stop":a?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return yP.h("div."+l,o,[u])}},{key:"_createSequenceControls",value:function(e){var t=this,n=Math.round(8/this._stepperDefaultWidth*e),r={onclick:function(){t._expandControls=!t._expandControls,t._mode=kA.Default,t._notifyChanged$.next(t)},style:{"border-bottom-right-radius":"".concat(n,"px"),"border-top-right-radius":"".concat(n,"px")}},i=yP.h("div.mapillary-sequence-expander-bar",[]),a=yP.h("div.mapillary-sequence-expander-button",r,[i]),o=this._mode===kA.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",s=yP.h("div"+o,[]),u={onclick:function(){t._mode=t._mode===kA.Playback?kA.Default:kA.Playback,t._notifyChanged$.next(t)}},l=yP.h("div.mapillary-sequence-playback-button",u,[s]),c=this._mode===kA.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",h=yP.h("div"+c,[]),d={onclick:function(){t._mode=t._mode===kA.Timeline?kA.Default:kA.Timeline,t._notifyChanged$.next(t)}},f=yP.h("div.mapillary-sequence-timeline-button",d,[h]),p={style:{height:this._defaultHeight/this._stepperDefaultWidth*e+"px",transform:"translate(".concat(e/2+2,"px, 0)"),width:this._controlsDefaultWidth/this._stepperDefaultWidth*e+"px"}},v=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return yP.h("div"+v,p,[l,f,a])}},{key:"_createSequenceArrows",value:function(e,t,n,r,i){var a=this,o={onclick:null!=e?function(){i.moveDir$(DM.Next).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))}:null,onpointerenter:function(){a._mouseEnterDirection$.next(DM.Next)},onpointerleave:function(){a._mouseLeaveDirection$.next(DM.Next)}},s=Math.round(8/this._stepperDefaultWidth*n),u={onclick:null!=t?function(){i.moveDir$(DM.Prev).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))}:null,onpointerenter:function(){a._mouseEnterDirection$.next(DM.Prev)},onpointerleave:function(){a._mouseLeaveDirection$.next(DM.Prev)},style:{"border-bottom-left-radius":"".concat(s,"px"),"border-top-left-radius":"".concat(s,"px")}},l=this._getStepClassName(DM.Next,e,r.highlightId),c=this._getStepClassName(DM.Prev,t,r.highlightId),h=yP.h("div.mapillary-sequence-icon",[]),d=yP.h("div.mapillary-sequence-icon",[]);return[yP.h("div."+c,u,[d]),yP.h("div."+l,o,[h])]}},{key:"_createStepper",value:function(e,t,n,r,i,a){var o,s=null,u=null,l=Ad(e.edges);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.data.direction===DM.Next&&(s=c.target),c.data.direction===DM.Prev&&(u=c.target)}}catch(CO){l.e(CO)}finally{l.f()}var h=this._createPlayingButton(s,u,n,t,i),d=this._createSequenceArrows(s,u,r,t,a);d.splice(1,0,h);var f={oncontextmenu:function(e){e.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*r+"px",width:r+"px"}};return yP.h("div.mapillary-sequence-stepper",f,d)}},{key:"_createTimelineControls",value:function(e,t,n){var r=this;if(this._mode!==kA.Timeline)return yP.h("div.mapillary-sequence-timeline",[]);var i=this._createPositionInput(t,n),a=yP.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),o={onclick:function(){r._mode=kA.Default,r._notifyChanged$.next(r)}},s=yP.h("div.mapillary-sequence-close-button",o,[a]),u=Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10),l={style:{top:"".concat(u,"px")}};return yP.h("div.mapillary-sequence-timeline",l,[i,s])}},{key:"_getStepClassName",value:function(e,t,n){var r=e===DM.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return null==t?r+="-inactive":n===t&&(r+="-highlight"),r}},{key:"_setChangingPosition",value:function(e){this._changingPosition=e,this._notifyChangingPositionChanged$.next(e)}}]),e}(),EA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,s){var u;return Bd(this,n),(u=t.call(this,e,r,i))._sequenceDOMRenderer=a||new TA(r),u._scheduler=s,u._containerWidth$=new If,u._hoveredIdSubject$=new If,u._hoveredId$=u._hoveredIdSubject$.pipe(wv()),u._navigator.playService.playing$.pipe(Sv(1),Lv(u._configuration$)).subscribe((function(e){var t=o(e,2),n=t[0],r=t[1],i="playing",a={playing:n,target:Id(u),type:i};u.fire(i,a),n!==r.playing&&(n?u.play():u.stop())})),u._navigator.playService.direction$.pipe(Sv(1),Lv(u._configuration$)).subscribe((function(e){var t=o(e,2),n=t[0];n!==t[1].direction&&u.configure({direction:n})})),u}return $d(n,[{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"play",value:function(){this.configure({playing:!0})}},{key:"stop",value:function(){this.configure({playing:!1})}},{key:"_activate",value:function(){var e=this;this._sequenceDOMRenderer.activate();var t=this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$})),yv(1),Pf()),n=this._navigator.stateService.currentImage$.pipe(sv(void 0,(function(e){return e.sequenceId})),Tv((function(t){return jp(vp(null),e._navigator.graphService.cacheSequence$(t.sequenceId).pipe(bv(3),Jp((function(e){return console.error("Failed to cache sequence",e),vp(null)}))))})),Cv(null),yv(1),Pf()),r=this._subscriptions;r.push(n.subscribe());var i=this._sequenceDOMRenderer.index$.pipe(Lv(n),wp((function(e){var t=o(e,2),n=t[0],r=t[1];return null!=r?r.imageIds[n]:null})),Zp((function(e){return!!e})),sv(),_v(),Pf());r.push(Hp(i.pipe(iv(100,this._scheduler)),i.pipe(Xp(400,this._scheduler))).pipe(sv(),Tv((function(t){return e._navigator.moveTo$(t).pipe(Jp((function(){return Hf()})))}))).subscribe()),r.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Zp((function(e){return e}))).subscribe((function(){e._navigator.graphService.setGraphMode(wA.Sequence)}))),r.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Zp((function(e){return!e}))).subscribe((function(){e._navigator.graphService.setGraphMode(wA.Spatial)}))),this._navigator.graphService.graphMode$.pipe(Tv((function(t){return t===wA.Spatial?e._navigator.stateService.currentImage$.pipe(ov(2)):Hf()})),Zp((function(e){return!e.spatialEdges.cached})),Tv((function(t){return e._navigator.graphService.cacheImage$(t.id).pipe(Jp((function(){return Hf()})))}))).subscribe(),r.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Zp((function(e){return e}))).subscribe((function(){e._navigator.playService.stop()}))),r.push(Lp(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(Cv(!1),sv())).pipe(Lv(this._navigator.stateService.currentImage$),Tv((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1];return a&&i===wA.Sequence?e._navigator.graphService.cacheSequenceImages$(s.sequenceId,s.id).pipe(bv(3),Jp((function(e){return console.error("Failed to cache sequence images.",e),Hf()}))):Hf()}))).subscribe());var a=n.pipe(Tv((function(t){if(!t)return vp({index:null,max:null});var n=!0;return e._sequenceDOMRenderer.changingPositionChanged$.pipe(Cv(!1),sv(),Tv((function(t){var r=!t&&n?0:1;return n=!1,t?i:e._navigator.stateService.currentImage$.pipe(wp((function(e){return e.id})),sv(),Sv(r))})),wp((function(e){var n=t.imageIds.indexOf(e);return-1===n?{index:null,max:null}:{index:n,max:t.imageIds.length-1}})))}))),s=this._navigator.stateService.state$.pipe(wp((function(e){return e===XP.Earth})),sv());r.push(Lp(t,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(Cv(this._sequenceDOMRenderer)),this._navigator.playService.speed$,a,s).pipe(wp((function(t){var n=o(t,7),r=n[0],i=n[1],a=n[2],s=n[4],u=n[5],l=n[6],c=e._sequenceDOMRenderer.render(r,i,a,s,u.index,u.max,!l,e,e._navigator);return{name:e._name,vNode:c}}))).subscribe(this._container.domRenderer.render$)),r.push(this._sequenceDOMRenderer.speed$.subscribe((function(t){e._navigator.playService.setSpeed(t)}))),r.push(this._configuration$.pipe(wp((function(e){return e.direction})),sv()).subscribe((function(t){e._navigator.playService.setDirection(t)}))),r.push(Lp(this._container.renderService.size$,this._configuration$.pipe(sv((function(e,t){return e[0]===t[0]&&e[1]===t[1]}),(function(e){return[e.minWidth,e.maxWidth]})))).pipe(wp((function(t){var n=o(t,2),r=n[0],i=n[1];return e._sequenceDOMRenderer.getContainerWidth(r,i)}))).subscribe(this._containerWidth$)),r.push(this._configuration$.pipe(wp((function(e){return e.playing})),sv()).subscribe((function(t){t?e._navigator.playService.play():e._navigator.playService.stop()}))),r.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(Tv((function(n){var r=t.pipe(wp((function(e){var t,r=Ad(e.edges);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.data.direction===n)return i.target}}catch(CO){r.e(CO)}finally{r.f()}return null})),Ev(e._sequenceDOMRenderer.mouseLeaveDirection$));return jp(r,vp(null))})),sv()).subscribe(this._hoveredIdSubject$)),r.push(this._hoveredId$.subscribe((function(t){var n="hover",r={id:t,target:e,type:n};e.fire(n,r)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}},{key:"_getDefaultConfiguration",value:function(){return{direction:DM.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}]),n}(wP);EA.componentName="sequence",function(e){e[e.Motion=0]="Motion",e[e.Stationary=1]="Stationary"}(CA||(CA={}));var PA=function(){function e(t,n,r,i,a,o,s,u,l,c){Bd(this,e),this._orientation=this._getValue(t,1);var h=null!=s?s.width:4,d=null!=s?s.height:3,f=this._orientation<5;this._width=this._getValue(n,f?h:d),this._height=this._getValue(r,f?d:h),this._basicAspect=f?this._width/this._height:this._height/this._width,this._basicWidth=f?n:r,this._basicHeight=f?r:n;var p=this._getCameraParameters(l,c),v=p[0],m=p[1],g=p[2];this._focal=this._getValue(v,1),this._scale=this._getValue(i,0),this._worldToCamera=this.createWorldToCamera(a,o),this._worldToCameraInverse=(new xg).copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=(new xg).copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,t),this._textureScale=u||[1,1],this._ck1=m||0,this._ck2=g||0,this._cameraType=c||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}return $d(e,[{key:"ck1",get:function(){return this._ck1}},{key:"ck2",get:function(){return this._ck2}},{key:"cameraType",get:function(){return this._cameraType}},{key:"basicAspect",get:function(){return this._basicAspect}},{key:"basicHeight",get:function(){return this._basicHeight}},{key:"basicRt",get:function(){return this._basicWorldToCamera}},{key:"basicWidth",get:function(){return this._basicWidth}},{key:"focal",get:function(){return this._focal}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}},{key:"rt",get:function(){return this._worldToCamera}},{key:"srt",get:function(){return this._scaledWorldToCamera}},{key:"srtInverse",get:function(){return this._scaledWorldToCameraInverse}},{key:"scale",get:function(){return this._scale}},{key:"hasValidScale",get:function(){return this._scale>.01&&this._scale<50}},{key:"radialPeak",get:function(){return this._radialPeak}},{key:"width",get:function(){return this._width}},{key:"upVector",value:function(){var e=this._worldToCamera.elements;switch(this._orientation){case 1:default:return new Vm(-e[1],-e[5],-e[9]);case 3:return new Vm(e[1],e[5],e[9]);case 6:return new Vm(-e[0],-e[4],-e[8]);case 8:return new Vm(e[0],e[4],e[8])}}},{key:"projectorMatrix",value:function(){var e=this._normalizedToTextureMatrix(),t=this._focal,n=(new xg).set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);return e.multiply(n),e.multiply(this._worldToCamera),e}},{key:"projectBasic",value:function(e){var t=this.projectSfM(e);return this._sfmToBasic(t)}},{key:"unprojectBasic",value:function(e,t,n){var r=this._basicToSfm(e);return this.unprojectSfM(r,t,n)}},{key:"projectSfM",value:function(e){var t=new Bm(e[0],e[1],e[2],1);return t.applyMatrix4(this._worldToCamera),this._bearingToSfm([t.x,t.y,t.z])}},{key:"unprojectSfM",value:function(e,t,n){var r=this._sfmToBearing(e),i=(n&&!ZM(this._cameraType)?new Bm(t*r[0]/r[2],t*r[1]/r[2],t,1):new Bm(t*r[0],t*r[1],t*r[2],1)).applyMatrix4(this._worldToCameraInverse);return[i.x/i.w,i.y/i.w,i.z/i.w]}},{key:"_sfmToBearing",value:function(e){if(ZM(this._cameraType)){var t=2*e[0]*Math.PI,n=2*-e[1]*Math.PI;return[Math.cos(n)*Math.sin(t),-Math.sin(n),Math.cos(n)*Math.cos(t)]}if(YM(this._cameraType)){var r=e[0]/this._focal,i=e[1]/this._focal,a=Math.sqrt(r*r+i*i),o=a/this._distortionFromDistortedRadius(a,this._ck1,this._ck2,this._radialPeak),s=Math.cos(o),u=Math.sin(o),l=a>1e-8?1/a:1;return[u*r*l,u*i*l,s]}var c=e[0]/this._focal,h=e[1]/this._focal,d=Math.sqrt(c*c+h*h),f=this._distortionFromDistortedRadius(d,this._ck1,this._ck2,this._radialPeak),p=new Vm(c/f,h/f,1);return p.normalize(),[p.x,p.y,p.z]}},{key:"_distortionFromDistortedRadius",value:function(e,t,n,r){for(var i=1,a=0;a<10;a++){var o=e/i;o>r&&(o=r),i=1+t*Math.pow(o,2)+n*Math.pow(o,4)}return i}},{key:"_bearingToSfm",value:function(e){if(ZM(this._cameraType)){var t=e[0],n=e[1],r=e[2],i=Math.atan2(t,r),a=Math.atan2(-n,Math.sqrt(t*t+r*r));return[i/(2*Math.PI),-a/(2*Math.PI)]}if(YM(this._cameraType)){if(e[2]>0){var s=o(e,3),u=s[0],l=s[1],c=s[2],h=Math.sqrt(u*u+l*l),d=Math.atan2(h,c);d>this._radialPeak&&(d=this._radialPeak);var f=1+Math.pow(d,2)*(this._ck1+Math.pow(d,2)*this._ck2),p=this._focal*f*d/h;return[p*u,p*l]}return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}if(e[2]>0){var v=e[0]/e[2],m=e[1]/e[2],g=v*v+m*m,_=Math.pow(this._radialPeak,2);g>_&&(g=_);var y=1+this._ck1*g+this._ck2*Math.pow(g,2);return[this._focal*y*v,this._focal*y*m]}return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}},{key:"_basicToSfm",value:function(e){var t,n;switch(this._orientation){case 1:default:t=e[0],n=e[1];break;case 3:t=1-e[0],n=1-e[1];break;case 6:t=e[1],n=1-e[0];break;case 8:t=1-e[1],n=e[0]}var r=this._width,i=this._height,a=Math.max(r,i);return[t*r/a-r/a/2,n*i/a-i/a/2]}},{key:"_sfmToBasic",value:function(e){var t,n,r=this._width,i=this._height,a=Math.max(r,i),o=(e[0]+r/a/2)/r*a,s=(e[1]+i/a/2)/i*a;switch(this._orientation){case 1:default:t=o,n=s;break;case 3:t=1-o,n=1-s;break;case 6:t=1-s,n=o;break;case 8:t=s,n=1-o}return[t,n]}},{key:"_getValue",value:function(e,t){return null!=e&&e>0?e:t}},{key:"_getCameraParameters",value:function(e,t){if(ZM(t))return[];if(!e||0===e.length)return[1,0,0];var n=3-e.length;return n<=0?e:e.concat(new Array(n).fill(0))}},{key:"createWorldToCamera",value:function(e,t){var n=new Vm(e[0],e[1],e[2]),r=n.length();r>0&&n.normalize();var i=new xg;return i.makeRotationAxis(n,r),i.setPosition(new Vm(t[0],t[1],t[2])),i}},{key:"_createScaledWorldToCamera",value:function(e,t){var n=e.clone(),r=n.elements;return r[12]=t*r[12],r[13]=t*r[13],r[14]=t*r[14],n.scale(new Vm(t,t,t)),n}},{key:"_createBasicWorldToCamera",value:function(e,t){var n=new Vm(0,0,1),r=0;switch(t){case 3:r=Math.PI;break;case 6:r=Math.PI/2;break;case 8:r=3*Math.PI/2}return(new xg).makeRotationAxis(n,r).multiply(e)}},{key:"_getRadialPeak",value:function(e,t){var n=5*t,r=3*e,i=Math.pow(r,2)-4*n*1;if(!(i<0)){var a=(-r-Math.sqrt(i))/2/n,o=(-r+Math.sqrt(i))/2/n,s=Math.min(a,o),u=Math.max(a,o);return s>0?Math.sqrt(s):u>0?Math.sqrt(u):void 0}}},{key:"_normalizedToTextureMatrix",value:function(){var e=Math.max(this._width,this._height),t=this._orientation<5?this._textureScale[0]:this._textureScale[1],n=this._orientation<5?this._textureScale[1]:this._textureScale[0],r=e/this._width*t,i=e/this._height*n;switch(this._orientation){case 1:default:return(new xg).set(r,0,0,.5,0,-i,0,.5,0,0,1,0,0,0,0,1);case 3:return(new xg).set(-r,0,0,.5,0,i,0,.5,0,0,1,0,0,0,0,1);case 6:return(new xg).set(0,-i,0,.5,-r,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new xg).set(0,i,0,.5,r,0,0,.5,0,0,1,0,0,0,0,1)}}}]),e}(),AA=function(){function e(){Bd(this,e),this._factory=new NP,this._scene=new DP,this._spatial=new WM,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}return $d(e,[{key:"disabled",get:function(){return this._disabled}},{key:"frameId",get:function(){return this._frameId}},{key:"needsRender",get:function(){return this._needsRender}},{key:"setTextureProvider",value:function(e,t){this._setTextureProvider(e,this._currentKey,t,this._currentProviderDisposers,this._updateTexture.bind(this))}},{key:"setTextureProviderPrev",value:function(e,t){this._setTextureProvider(e,this._previousKey,t,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}},{key:"update",value:function(e,t){this._updateFrameId(e.id),this._updateImagePlanes(e.state,t)}},{key:"updateCurtain",value:function(e){this._curtain!==e&&(this._curtain=e,this._updateCurtain(),this._needsRender=!0)}},{key:"updateTexture",value:function(e,t){var n=t.id===this._currentKey?this._scene.planes:t.id===this._previousKey?this._scene.planesOld:{};if(0!==Object.keys(n).length)for(var r in this._needsRender=!0,n)if(n.hasOwnProperty(r)){var i=n[r].material.uniforms.projectorTex.value;i.image=e,i.needsUpdate=!0}}},{key:"updateTextureImage",value:function(e,t){if(this._currentKey===t.id){this._needsRender=!0;var n=this._scene.planes;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r].material.uniforms.projectorTex.value;i.image=e,i.needsUpdate=!0}}}},{key:"render",value:function(e,t){this.disabled||t.render(this._scene.sceneOld,e),t.render(this._scene.scene,e),this._needsRender=!1}},{key:"dispose",value:function(){for(var e in this._scene.clear(),this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(e)&&this._currentProviderDisposers[e]();for(var t in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(t)&&this._previousProviderDisposers[t]();this._currentProviderDisposers={},this._previousProviderDisposers={}}},{key:"_getBasicCorners",value:function(e,t){var n,r;return e>t?(n=.5,r=.5*e/t):(n=.5*t/e,r=.5),[[.5-n,.5-r],[.5+n,.5+r]]}},{key:"_setDisabled",value:function(e){this._disabled=null==e.currentImage||null==e.previousImage||ZM(e.currentImage.cameraType)&&!ZM(e.previousImage.cameraType)}},{key:"_setTextureProvider",value:function(e,t,n,r,i){var a=this;if(e===t){var o=n.textureCreated$.subscribe(i),s=n.textureUpdated$.subscribe((function(e){a._needsRender=!0}));if(e in r)(0,r[e])(),delete r[e];r[e]=function(){o.unsubscribe(),s.unsubscribe(),n.dispose()}}}},{key:"_updateCurtain",value:function(){var e=this._scene.planes;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t].material;n.uniforms.curtain&&(n.uniforms.curtain.value=this._curtain)}}},{key:"_updateFrameId",value:function(e){this._frameId=e}},{key:"_updateImagePlanes",value:function(e,t){var n=null!=e.currentImage&&this._currentKey!==e.currentImage.id,r=null!=e.previousImage&&this._previousKey!==e.previousImage.id,i=this._mode!==t;if(n||r||i){this._setDisabled(e),this._needsRender=!0,this._mode=t;var a=e.motionless||t===CA.Stationary||ZM(e.currentImage.cameraType);if((this.disabled||r)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(r||i){var s=e.previousImage;this._previousKey=s.id;var u=e.currentTransform.rt.elements,l=[u[12],u[13],u[14]],c=e.currentTransform.basicAspect,h=e.previousTransform.basicAspect,d=c>h?[1,h/c]:[c/h,1],f=e.currentImage.rotation,p=e.currentImage.width,v=e.currentImage.height;ZM(s.cameraType)&&(f=e.previousImage.rotation,l=this._spatial.rotate(this._spatial.opticalCenter(e.currentImage.rotation,l).toArray(),f).multiplyScalar(-1).toArray(),p=e.previousImage.width,v=e.previousImage.height);var m=new PA(e.currentImage.exifOrientation,p,v,e.currentImage.scale,f,l,s.image,d,e.currentImage.cameraParameters,e.currentImage.cameraType),g=void 0;if(ZM(s.cameraType))g=this._factory.createMesh(s,a||ZM(e.currentImage.cameraType)?m:e.previousTransform);else if(a){var _=o(this._getBasicCorners(c,h),2),y=o(_[0],2),b=y[0],x=y[1],w=o(_[1],2),k=w[0],S=w[1];g=this._factory.createFlatMesh(e.previousImage,m,b,k,x,S)}else g=this._factory.createMesh(e.previousImage,e.previousTransform);var M={};M[s.id]=g,this._scene.setImagePlanesOld(M)}if(n||i){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=e.currentImage.id;var C={};ZM(e.currentImage.cameraType)?C[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform):C[e.currentImage.id]=a?this._factory.createDistortedCurtainMesh(e.currentImage,e.currentTransform):this._factory.createCurtainMesh(e.currentImage,e.currentTransform),this._scene.setImagePlanes(C),this._updateCurtain()}}}},{key:"_updateTexture",value:function(e){this._needsRender=!0;var t=this._scene.planes;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n].material,i=r.uniforms.projectorTex.value;r.uniforms.projectorTex.value=null,i.dispose(),r.uniforms.projectorTex.value=e}}},{key:"_updateTexturePrev",value:function(e){this._needsRender=!0;var t=this._scene.planesOld;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n].material,i=r.uniforms.projectorTex.value;r.uniforms.projectorTex.value=null,i.dispose(),r.uniforms.projectorTex.value=e}}}]),e}(),LA=function(){function e(t){Bd(this,e),this._container=t,this._interacting=!1,this._notifyModeChanged$=new If,this._notifyPositionChanged$=new If,this._stopInteractionSubscription=null}return $d(e,[{key:"mode$",get:function(){return this._notifyModeChanged$}},{key:"position$",get:function(){return this._notifyPositionChanged$}},{key:"activate",value:function(){var e=this;this._stopInteractionSubscription||(this._stopInteractionSubscription=Hp(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(Zp((function(e){return 0===e.touches.length})))).subscribe((function(t){e._interacting&&(e._interacting=!1)})))}},{key:"deactivate",value:function(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}},{key:"render",value:function(e,t,n,r,i){var a=[];if(i){a.push(yP.h("div.mapillary-slider-border",[]));var o=!(n||r);o&&(a.push(this._createModeButton(t)),a.push(this._createModeButton2d(t))),a.push(this._createPositionInput(e,o))}var s=this._container.domContainer.getBoundingClientRect(),u=Math.max(215,Math.min(400,s.width-100));return yP.h("div.mapillary-slider-container",{style:{width:"".concat(u,"px")}},a)}},{key:"_createModeButton",value:function(e){var t=this,n={onclick:function(){e!==CA.Motion&&t._notifyModeChanged$.next(CA.Motion)}},r=e===CA.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return yP.h("div."+r,n,[yP.h("div.mapillary-slider-mode-icon",[])])}},{key:"_createModeButton2d",value:function(e){var t=this,n={onclick:function(){e!==CA.Stationary&&t._notifyModeChanged$.next(CA.Stationary)}},r=e===CA.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return yP.h("div."+r,n,[yP.h("div.mapillary-slider-mode-icon-2d",[])])}},{key:"_createPositionInput",value:function(e,t){var n=this,r=function(e){n._notifyPositionChanged$.next(Number(e.target.value)/1e3)},i=function(e){n._interacting=!0,e.stopPropagation()},a=function(e){n._interacting&&e.stopPropagation()},o=this._container.domContainer.getBoundingClientRect(),s=Math.max(215,Math.min(400,o.width-105))-84+(t?0:52),u=yP.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:r,oninput:r,onkeydown:function(e){"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:i,onpointermove:a,ontouchmove:a,ontouchstart:i,style:{width:"".concat(s,"px")},type:"range",value:1e3*e},[]);return yP.h("div.mapillary-slider-position-container",[u])}}]),e}(),IA=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._viewportCoords=a||new CP,o._domRenderer=new LA(r),o._imageTileLoader=new jP(i.api),o._roiCalculator=new FP,o._spatial=new WM,o._glRendererOperation$=new If,o._glRendererCreator$=new If,o._glRendererDisposer$=new If,o._glRenderer$=o._glRendererOperation$.pipe(xv((function(e,t){return t(e)}),null),Zp((function(e){return null!=e})),sv(void 0,(function(e){return e.frameId}))),o._glRendererCreator$.pipe(wp((function(){return function(e){if(null!=e)throw new Error("Multiple slider states can not be created at the same time");return new AA}}))).subscribe(o._glRendererOperation$),o._glRendererDisposer$.pipe(wp((function(){return function(e){return e.dispose(),null}}))).subscribe(o._glRendererOperation$),o}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(this._domRenderer.mode$.subscribe((function(t){e.configure({mode:t})}))),t.push(this._glRenderer$.pipe(wp((function(t){return{name:e._name,renderer:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),pass:OP.Background}}}))).subscribe(this._container.glRenderer.render$));var n=jp(this.configuration$.pipe(wp((function(e){return null!=e.initialPosition?e.initialPosition:1})),fv()),this._domRenderer.position$),r=this.configuration$.pipe(wp((function(e){return e.mode})),sv()),i=this._navigator.stateService.currentState$.pipe(wp((function(e){return e.state.motionless})),sv()),a=this._navigator.stateService.currentState$.pipe(wp((function(e){return ZM(e.state.currentImage.cameraType)})),sv()),s=Lp(this._configuration$.pipe(wp((function(e){return e.sliderVisible}))),this._navigator.stateService.currentState$.pipe(wp((function(e){return!(null==e.state.currentImage||null==e.state.previousImage||ZM(e.state.currentImage.cameraType)&&!ZM(e.state.previousImage.cameraType))})),sv())).pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return n&&r})),sv());this._waitSubscription=Lp(r,i,a,s).pipe(Lv(this._navigator.stateService.state$)).subscribe((function(t){var n=o(t,2),r=o(n[0],4),i=r[0],a=r[1],s=r[2],u=r[3],l=n[1],c=u&&(a||i===CA.Stationary||s);c&&l!==XP.WaitingInteractively?e._navigator.stateService.waitInteractively():c||l===XP.Waiting||e._navigator.stateService.wait()})),t.push(Lp(n,r,i,a,s).subscribe((function(t){var n=o(t,4),r=n[0],i=n[1],a=n[2],s=n[3];a||i===CA.Stationary||s?e._navigator.stateService.moveTo(1):e._navigator.stateService.moveTo(r)}))),t.push(Lp(n,r,i,a,s,this._container.renderService.size$).pipe(wp((function(t){var n=o(t,5),r=n[0],i=n[1],a=n[2],s=n[3],u=n[4];return{name:e._name,vNode:e._domRenderer.render(r,i,a,s,u)}}))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),t.push(Lp(n,a,s,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(wp((function(t){var n=o(t,5),r=n[0],i=n[1],a=n[2],s=n[3],u=n[4];if(!i)return a?r:1;var l=e._viewportCoords.viewportToBasic(-1.15,0,u,s.perspective),c=e._viewportCoords.viewportToBasic(1.15,0,u,s.perspective),h=c[0]<l[0]?c[0]+1:c[0],d=l[0]+r*(h-l[0]);return d>1?d-1:d})),wp((function(e){return function(t){return t.updateCurtain(e),t}}))).subscribe(this._glRendererOperation$)),t.push(Lp(this._navigator.stateService.currentState$,r).pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return function(e){return e.update(n,r),e}}))).subscribe(this._glRendererOperation$)),t.push(this._configuration$.pipe(Zp((function(e){return null!=e.ids})),Tv((function(t){return Yp(Yp(e._catchCacheImage$(t.ids.background),e._catchCacheImage$(t.ids.foreground)).pipe(wp((function(e){return{background:e[0],foreground:e[1]}}))),e._navigator.stateService.currentState$.pipe(fv())).pipe(wp((function(e){return{images:e[0],state:e[1].state}})))}))).subscribe((function(t){null!=t.state.currentImage&&null!=t.state.previousImage&&t.state.currentImage.id===t.images.foreground.id&&t.state.previousImage.id===t.images.background.id||(t.state.currentImage.id!==t.images.background.id?t.state.currentImage.id!==t.images.foreground.id||1!==t.state.trajectory.length?(e._navigator.stateService.setImages([t.images.background]),e._navigator.stateService.setImages([t.images.foreground])):e._navigator.stateService.prependImages([t.images.background]):e._navigator.stateService.setImages([t.images.foreground]))}),(function(e){console.error(e)})));var u=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?e._navigator.stateService.currentState$:new If})),sv(void 0,(function(e){return e.state.currentImage.id})),Lv(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),wp((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2],s=r.state;Math.max(a.width,a.height);var u=s.currentImage,l=s.currentTransform;return new KP(u.id,l.basicWidth,l.basicHeight,u.image,e._imageTileLoader,new BP,i)})),yv(1),Pf());t.push(u.subscribe((function(){}))),t.push(u.pipe(wp((function(e){return function(t){return t.setTextureProvider(e.id,e),t}}))).subscribe(this._glRendererOperation$)),t.push(u.pipe(gv()).subscribe((function(e){e[0].abort()})));var l=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?Lp(e._container.renderService.renderCameraFrame$,e._container.renderService.size$.pipe(iv(250))):new If})),wp((function(e){var t=o(e,2),n=t[0],r=t[1];return[n.camera.position.clone(),n.camera.lookat.clone(),n.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]})),gv(),Mv((function(e){return e[1][2]-e[0][2]<0||0===e[1][2]})),wp((function(e){var t=e[0][0].equals(e[1][0]),n=e[0][1].equals(e[1][1]),r=e[0][2]===e[1][2],i=e[0][3]===e[1][3],a=e[0][4]===e[1][4];return t&&n&&r&&i&&a})),sv(),Zp((function(e){return e})),Tv((function(){return e._container.renderService.renderCameraFrame$.pipe(fv())})),Lv(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(u.pipe(Tv((function(t){return l.pipe(wp((function(n){var r=o(n,3),i=r[0],a=r[1],s=r[2];return[e._roiCalculator.computeRegionOfInterest(i,a,s),t]})))})),Zp((function(e){return!e[1].disposed}))).subscribe((function(e){var t=e[0];e[1].setRegionOfInterest(t)})));var c=u.pipe(Tv((function(e){return e.hasTexture$})),Cv(!1),yv(1),Pf());t.push(c.subscribe((function(){})));var h=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?e._navigator.stateService.currentState$:new If})),Zp((function(e){return!!e.state.previousImage})),sv(void 0,(function(e){return e.state.previousImage.id})),Lv(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),wp((function(t){var n=o(t,3),r=n[0],i=n[1],a=(n[2],r.state),s=a.previousImage,u=a.previousTransform;return new KP(s.id,u.basicWidth,u.basicHeight,s.image,e._imageTileLoader,new BP,i)})),yv(1),Pf());t.push(h.subscribe((function(){}))),t.push(h.pipe(wp((function(e){return function(t){return t.setTextureProviderPrev(e.id,e),t}}))).subscribe(this._glRendererOperation$)),t.push(h.pipe(gv()).subscribe((function(e){e[0].abort()})));var d=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?Lp(e._container.renderService.renderCameraFrame$,e._container.renderService.size$.pipe(iv(250))):new If})),wp((function(e){var t=o(e,2),n=t[0],r=t[1];return[n.camera.position.clone(),n.camera.lookat.clone(),n.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]})),gv(),Mv((function(e){return e[1][2]-e[0][2]<0||0===e[1][2]})),wp((function(e){var t=e[0][0].equals(e[1][0]),n=e[0][1].equals(e[1][1]),r=e[0][2]===e[1][2],i=e[0][3]===e[1][3],a=e[0][4]===e[1][4];return t&&n&&r&&i&&a})),sv(),Zp((function(e){return e})),Tv((function(){return e._container.renderService.renderCameraFrame$.pipe(fv())})),Lv(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(h.pipe(Tv((function(t){return d.pipe(wp((function(n){var r=o(n,3),i=r[0],a=r[1],s=r[2];return[e._roiCalculator.computeRegionOfInterest(i,a,s),t]})))})),Zp((function(e){return!e[1].disposed})),Lv(this._navigator.stateService.currentState$)).subscribe((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1],u=null;if(ZM(s.state.previousImage.cameraType))if(ZM(s.state.currentImage.cameraType)){var l=e._spatial.viewingDirection(s.state.currentImage.rotation),c=e._spatial.viewingDirection(s.state.previousImage.rotation),h=e._spatial.angleBetweenVector2(l.x,l.y,c.x,c.y)/(2*Math.PI);u={bbox:{maxX:e._spatial.wrap(i.bbox.maxX+h,0,1),maxY:i.bbox.maxY,minX:e._spatial.wrap(i.bbox.minX+h,0,1),minY:i.bbox.minY},pixelHeight:i.pixelHeight,pixelWidth:i.pixelWidth}}else{var d=e._spatial.viewingDirection(s.state.currentImage.rotation),f=e._spatial.viewingDirection(s.state.previousImage.rotation),p=e._spatial.angleBetweenVector2(d.x,d.y,f.x,f.y)/(2*Math.PI),v=e._spatial.angleToPlane(d.toArray(),[0,0,1]),m=(e._spatial.angleToPlane(f.toArray(),[0,0,1])-v)/(2*Math.PI),g=s.state.currentTransform,_=Math.max(g.basicWidth,g.basicHeight),y=_>0?2*Math.atan(.5*g.basicWidth/(_*g.focal)):Math.PI/3,b=_>0?2*Math.atan(.5*g.basicHeight/(_*g.focal)):Math.PI/3,x=y/(2*Math.PI),w=b/Math.PI,k=(i.bbox.maxX-i.bbox.minX)*x,S=(i.bbox.maxY-i.bbox.minY)*w,M=i.pixelWidth*x,C=i.pixelHeight*w,T=(i.bbox.minX+i.bbox.maxX)/2-.5,E=(i.bbox.minY+i.bbox.maxY)/2-.5,P=.5+p+x*T-k/2,A=.5+p+x*T+k/2,L=.5+m+w*E-S/2,I=.5+m+w*E+S/2;u={bbox:{maxX:e._spatial.wrap(A,0,1),maxY:I,minX:e._spatial.wrap(P,0,1),minY:L},pixelHeight:C,pixelWidth:M}}else{var R=s.state.currentTransform.basicAspect,O=s.state.previousTransform.basicAspect,N=o(e._getBasicCorners(R,O),2),D=o(N[0],2),z=D[0],j=D[1],B=o(N[1],2),F=B[0]-z,$=B[1]-j,q=i.pixelWidth/F,U=i.pixelHeight/$,V=(F-1)/(2*F)+i.bbox.minX/F,H=(F-1)/(2*F)+i.bbox.maxX/F,W=($-1)/(2*$)+i.bbox.minY/$,G={maxX:H,maxY:($-1)/(2*$)+i.bbox.maxY/$,minX:V,minY:W};e._clipBoundingBox(G),u={bbox:G,pixelHeight:U,pixelWidth:q}}a.setRegionOfInterest(u)})));var f=h.pipe(Tv((function(e){return e.hasTexture$})),Cv(!1),yv(1),Pf());t.push(f.subscribe((function(){})))}},{key:"_deactivate",value:function(){var e=this;this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(fv()).subscribe((function(t){t!==XP.Traversing&&e._navigator.stateService.traverse()})),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}},{key:"_getDefaultConfiguration",value:function(){return{initialPosition:1,mode:CA.Motion,sliderVisible:!0}}},{key:"_catchCacheImage$",value:function(e){return this._navigator.graphService.cacheImage$(e).pipe(Jp((function(t){return console.error("Failed to cache slider image (".concat(e,")"),t),Hf()})))}},{key:"_getBasicCorners",value:function(e,t){var n,r;return e>t?(n=.5,r=.5*e/t):(n=.5*t/e,r=.5),[[.5-n,.5-r],[.5+n,.5+r]]}},{key:"_clipBoundingBox",value:function(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}}]),n}(wP);IA.componentName="slider";var RA,OA,NA=function(){function e(t,n){Bd(this,e),this._subscriptions=new xP,this._graphService=t,this._stateService=n;var r=this._subscriptions;this._directionSubject$=new If,this._direction$=this._directionSubject$.pipe(Cv(DM.Next),yv(1),Pf()),r.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new If,this._playing$=this._playingSubject$.pipe(Cv(this._playing),yv(1),Pf()),r.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new If,this._speed$=this._speedSubject$.pipe(Cv(this._speed),yv(1),Pf()),r.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}return $d(e,[{key:"playing",get:function(){return this._playing}},{key:"direction$",get:function(){return this._direction$}},{key:"playing$",get:function(){return this._playing$}},{key:"speed$",get:function(){return this._speed$}},{key:"play",value:function(){var t=this;if(!this._playing){this._stateService.cutImages();var n=this._setSpeed(this._speed);this._stateService.setSpeed(n),this._graphModeSubscription=this._speed$.pipe(wp((function(t){return t>e.sequenceSpeed?wA.Sequence:wA.Spatial})),sv()).subscribe((function(e){t._graphService.setGraphMode(e)})),this._cacheSubscription=Lp(this._stateService.currentImage$.pipe(wp((function(e){return[e.sequenceId,e.id]})),sv(void 0,(function(e){return o(e,1)[0]}))),this._graphService.graphMode$,this._direction$).pipe(Tv((function(e){var n=o(e,3),r=o(n[0],2),i=r[0],a=r[1],s=n[1],u=n[2];return u!==DM.Next&&u!==DM.Prev?vp([void 0,u]):Lp((s===wA.Sequence?t._graphService.cacheSequenceImages$(i,a):t._graphService.cacheSequence$(i)).pipe(bv(3),Jp((function(e){return console.error(e),vp(void 0)}))),vp(u))})),Tv((function(e){var n=o(e,2),r=n[0],i=n[1];if(void 0===r)return Hf();var a=r.imageIds.slice();return i===DM.Prev&&a.reverse(),t._stateService.currentState$.pipe(wp((function(e){return[e.state.trajectory[e.state.trajectory.length-1].id,e.state.imagesAhead]})),xv((function(e,n){var r=o(e,2),i=r[0],s=(r[1],o(n,2)),u=s[0],l=s[1];void 0===i&&(i=u);var c=a.length-1;if(l>=t._imagesAhead||a[c]===i)return[i,[]];var h=a.indexOf(u),d=a.indexOf(i)+1,f=Math.min(c,h+t._imagesAhead-l)+1;return f<=d?[i,[]]:[a[f-1],a.slice(d,f)]}),[void 0,[]]),Np((function(e){var t=o(e,2);t[0];return ap(t[1])})))})),Np((function(e){return t._graphService.cacheImage$(e).pipe(Jp((function(){return Hf()})))}),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(Zp((function(e){return e.state.imagesAhead<t._imagesAhead})),sv(void 0,(function(e){return e.state.lastImage.id})),wp((function(e){for(var t=e.state.lastImage,n=e.state.trajectory,r=void 0,i=n.length-2;i>=0;i--){var a=n[i];if(a.sequenceId!==t.sequenceId)break;if(a.capturedAt!==t.capturedAt){r=a.capturedAt<t.capturedAt;break}}return[e.state.lastImage,r]})),Lv(this._direction$),Tv((function(e){var n=o(e,2),r=o(n[0],2),i=r[0],a=(r[1],n[1]);return Yp(([DM.Next,DM.Prev].indexOf(a)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(fv((function(e){return e.cached})),bp(15e3)),vp(a)).pipe(wp((function(e){var t,n=o(e,2),r=n[0],i=n[1],a=Ad(r.edges);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(s.data.direction===i)return s.target}}catch(CO){a.e(CO)}finally{a.f()}return null})),Tv((function(e){return null!=e?t._graphService.cacheImage$(e):Hf()})))}))).subscribe((function(e){t._stateService.appendImagess([e])}),(function(e){console.error(e),t.stop()})),this._clearSubscription=this._stateService.currentImage$.pipe(Kp(1,10)).subscribe((function(e){t._stateService.clearPriorImages()})),this._setPlaying(!0);var r=this._stateService.currentState$.pipe(wp((function(e){return e.state})),sv((function(e,t){var n=o(e,2),r=n[0],i=n[1],a=o(t,2),s=a[0],u=a[1];return r===s&&i===u}),(function(e){return[e.currentImage.id,e.lastImage.id]})),Zp((function(e){return e.currentImage.id===e.lastImage.id&&e.currentIndex===e.trajectory.length-1})),wp((function(e){return e.currentImage})));this._stopSubscription=Lp(r,this._direction$).pipe(Tv((function(e){var t=o(e,2),n=t[0],r=t[1],i=([DM.Next,DM.Prev].indexOf(r)>-1?n.sequenceEdges$:n.spatialEdges$).pipe(fv((function(e){return e.cached})),bp(15e3),Jp((function(e){return console.error(e),vp({cached:!1,edges:[]})})));return Lp(vp(r),i).pipe(wp((function(e){var t,n=o(e,2),r=n[0],i=Ad(n[1].edges);try{for(i.s();!(t=i.n()).done;){if(t.value.data.direction===r)return!0}}catch(CO){i.e(CO)}finally{i.f()}return!1})))})),Np((function(e){return e||!t._bridging$?vp(e):t._bridging$.pipe(wp((function(e){return null!=e})),Jp((function(e){return console.error(e),vp(!1)})))})),fv((function(e){return!e}))).subscribe(void 0,void 0,(function(){t.stop()})),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(wp((function(e){return e===XP.Earth})),sv(),fv((function(e){return e}))).subscribe(void 0,void 0,(function(){t.stop()})),this._earthSubscription.closed&&(this._earthSubscription=null)}}},{key:"dispose",value:function(){this.stop(),this._subscriptions.unsubscribe()}},{key:"setDirection",value:function(e){this._directionSubject$.next(e)}},{key:"setSpeed",value:function(e){if((e=Math.max(0,Math.min(1,e)))!==this._speed){var t=this._setSpeed(e);this._playing&&this._stateService.setSpeed(t),this._speedSubject$.next(this._speed)}}},{key:"stop",value:function(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(wA.Spatial),this._setPlaying(!1))}},{key:"_mapSpeed",value:function(e){var t=2*e-1;return Math.pow(10,t)-.2*t}},{key:"_mapImagesAhead",value:function(e){return Math.round(Math.max(10,Math.min(50,8+6*e)))}},{key:"_setPlaying",value:function(e){this._playing=e,this._playingSubject$.next(e)}},{key:"_setSpeed",value:function(e){this._speed=e;var t=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(t),t}}]),e}();NA.sequenceSpeed=.54,function(e){e[e.Hidden=0]="Hidden",e[e.Homogeneous=1]="Homogeneous",e[e.Cluster=2]="Cluster",e[e.ConnectedComponent=3]="ConnectedComponent",e[e.Sequence=4]="Sequence"}(RA||(RA={})),function(e){e[e.Hidden=0]="Hidden",e[e.Altitude=1]="Altitude",e[e.Flat=2]="Flat"}(OA||(OA={}));var DA=function(e){Dd(n,e);var t=zd(n);function n(e){var r;Bd(this,n),(r=t.call(this))._originalSize=e.originalSize;var i=e.cluster,a=e.color,o=e.scale,s=e.translation;return r._makeAttributes(i),r.material.size=o*r._originalSize,r.setColor(a),r.matrixAutoUpdate=!1,r.position.fromArray(s),r.updateMatrix(),r.updateMatrixWorld(!1),r}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setColor",value:function(e){this.material.vertexColors=null==e,this.material.color=new d_(e),this.material.needsUpdate=!0}},{key:"resize",value:function(e){this.material.size=e*this._originalSize,this.material.needsUpdate=!0}},{key:"_makeAttributes",value:function(e){var t=[],n=[],r=e.points;for(var i in r)if(r.hasOwnProperty(i)){var a=r[i];t.push.apply(t,xd(a.coordinates));var o=a.color;n.push(o[0]),n.push(o[1]),n.push(o[2])}var s=this.geometry;s.setAttribute("position",new m_(new Float32Array(t),3)),s.setAttribute("color",new m_(new Float32Array(n),3))}}]),n}(Yw),zA=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this))._makeAttributes(e),r.matrixAutoUpdate=!1,r.updateMatrix(),r.updateMatrixWorld(!1),r}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"_makeAttributes",value:function(e){var t=e.slice();t.push(e[0]);var n,r=0,i=new Float32Array(3*(e.length+1)),a=Ad(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;i[r++]=o[0],i[r++]=o[1],i[r++]=o[2]}}catch(CO){a.e(CO)}finally{a.f()}this.geometry.setAttribute("position",new m_(i,3))}}]),n}(Fw);function jA(e,t){return e===t}function BA(e){var t=function(e){return Math.pow(2,e)}(e),n=t/2;return{min:[-n,-n,-n],max:[n,n,n]}}var FA=function(){function e(t,n,r,i){Bd(this,e),this.level=t,this.leafLevel=n,this.boundingBox=r,this.parent=i,this.children=[],this.items=[],i&&i.children.push(this)}return $d(e,[{key:"isEmpty",get:function(){return!(this.children.length||this.items.length)}},{key:"add",value:function(t){var n=this;if(!n.boundingBox.containsPoint(t.position))throw new Error("Item not contained in node");if(jA(n.level,n.leafLevel))return n.items.push(t),this;var r,i=Ad(n.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.boundingBox.containsPoint(t.position))return a.add(t)}}catch(CO){i.e(CO)}finally{i.f()}var o,s=Ad(n._generateBoundingBoxes());try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u.containsPoint(t.position))return new e(n.level-1,n.leafLevel,u,n).add(t)}}catch(CO){s.e(CO)}finally{s.f()}throw new Error("Item not contained in children")}},{key:"intersect",value:function(e,t,n){if(e.intersectBox(this.boundingBox,t))if(jA(this.level,this.leafLevel))n.push(this);else{var r,i=Ad(this.children);try{for(i.s();!(r=i.n()).done;){r.value.intersect(e,t,n)}}catch(CO){i.e(CO)}finally{i.f()}}}},{key:"remove",value:function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("Item does not exist ".concat(e.uuid));this.items.splice(t,1)}},{key:"traverse",value:function(){var e=this;if(e.isEmpty){var t=e.parent;if(t){var n=t.children.indexOf(e);if(n<0)throw new Error("Corrupt octree");t.children.splice(n,1),this.parent=null,t.traverse()}}}},{key:"_generateBoundingBoxes",value:function(){for(var e=this.boundingBox.min,t=(this.boundingBox.max.x-e.x)/2,n=[],r=0,i=[[e.x,e.y+t,e.z+t],[e.x+t,e.y+t,e.z+t],[e.x,e.y,e.z+t],[e.x+t,e.y,e.z+t],[e.x,e.y+t,e.z],[e.x+t,e.y+t,e.z],[e.x,e.y,e.z],[e.x+t,e.y,e.z]];r<i.length;r++){var a=o(i[r],3),s=a[0],u=a[1],l=a[2];n.push(new Gm(new Vm(s,u,l),new Vm(s+t,u+t,l+t)))}return n}}]),e}(),$A=function(){function e(t,n){if(Bd(this,e),this.rootLevel=t,this.leafLevel=n,n>t)throw new Error;this._index=new Map,this._root=this._makeRoot()}return $d(e,[{key:"root",get:function(){return this._root}},{key:"add",value:function(e){if(this.root.boundingBox.containsPoint(e.position)){var t=this._root.add(e);this._index.set(e.uuid,t)}else console.warn("Object outside bounding box ".concat(e.uuid))}},{key:"has",value:function(e){return this._index.has(e.uuid)}},{key:"intersect",value:function(e){var t=[],n=new Vm;return this._root.intersect(e,n,t),t.map((function(e){return e.items})).reduce((function(e,t){return e.push.apply(e,xd(t)),e}),[])}},{key:"reset",value:function(){this._root=this._makeRoot(),this._index.clear()}},{key:"remove",value:function(e){if(!this.has(e))throw new Error("Frame does not exist ".concat(e.uuid));var t=this._index.get(e.uuid);t.remove(e),t.traverse(),this._index.delete(e.uuid)}},{key:"_makeRoot",value:function(){var e=this.rootLevel,t=BA(e),n=new Gm((new Vm).fromArray(t.min),(new Vm).fromArray(t.max));return new FA(e,this.leafLevel,n)}}]),e}(),qA=function(){function e(t,n){Bd(this,e),this._objects=[],this._objectImageMap=new Map,this._octree=null!==t&&void 0!==t?t:new $A(14,6),this._raycaster=null!==n&&void 0!==n?n:new yM,this._interactiveLayer=1,this._raycaster=n||new yM(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}return $d(e,[{key:"interactiveLayer",get:function(){return this._interactiveLayer}},{key:"octree",get:function(){return this._octree}},{key:"raycaster",get:function(){return this._raycaster}},{key:"add",value:function(e,t){var n=e.uuid;this._objectImageMap.set(n,t),this._objects.push(e),this._octree.add(e)}},{key:"intersectObjects",value:function(e,t){this._raycaster.setFromCamera((new Pm).fromArray(e),t);var n,r=this._octree.intersect(this.raycaster.ray),i=this._raycaster.intersectObjects(r),a=this._objectImageMap,o=Ad(i);try{for(o.s();!(n=o.n()).done;){var s=n.value.object.uuid;if(a.has(s))return a.get(s)}}catch(CO){o.e(CO)}finally{o.f()}return null}},{key:"remove",value:function(e){var t=this._objects,n=t.indexOf(e);if(-1!==n){var r,i=Ad(t.splice(n,1));try{for(i.s();!(r=i.n()).done;){var a=r.value;this._objectImageMap.delete(a.uuid)}}catch(CO){i.e(CO)}finally{i.f()}this._octree.remove(e)}else console.warn("Object does not exist")}},{key:"resetIntersectionThreshold",value:function(e){this._raycaster.params.Line.threshold=e?this._largeLineThreshold:this._lineThreshold}}]),e}(),UA=function(e){Dd(n,e);var t=zd(n);function n(e){var r;Bd(this,n),r=t.call(this,e.geometry,e.material);var i=e.mode,a=e.originalOrigin,o=e.transform.unprojectBasic([0,0],0);return r._relativeAltitude=a[2]-o[2],r._makeAttributes(o,a,i),r.matrixAutoUpdate=!1,r.position.fromArray(o),r.updateMatrix(),r.updateMatrixWorld(!1),r}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setMode",value:function(e){var t=this.geometry.attributes.position;t.array[5]=this._modeToAltitude(e),t.needsUpdate=!0,this.geometry.computeBoundingSphere()}},{key:"_makeAttributes",value:function(e,t,n){var r=new Float32Array(6);r[0]=0,r[1]=0,r[2]=0,r[3]=t[0]-e[0],r[4]=t[1]-e[1],r[5]=this._modeToAltitude(n);var i=new m_(r,3);this.geometry.setAttribute("position",i),i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},{key:"_modeToAltitude",value:function(e){return e===OA.Altitude?this._relativeAltitude:0}}]),n}(Fw),VA=function(e){Dd(n,e);var t=zd(n);function n(e){var r;Bd(this,n),r=t.call(this,e.geometry,e.material);var i=e.color,a=e.size,o=e.scale,s=e.transform,u=s.unprojectBasic([0,0],0),l=r._makePositions(a,s,u);return r._makeAttributes(l,i),r.geometry.computeBoundingSphere(),r.geometry.computeBoundingBox(),r.matrixAutoUpdate=!1,r.position.fromArray(u),r.scale.set(o,o,o),r.updateMatrix(),r.updateMatrixWorld(!1),r}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setColor",value:function(e){return this._updateColorAttribute(e),this}},{key:"resize",value:function(e){return this.scale.set(e,e,e),this.updateMatrix(),this.updateMatrixWorld(!1),this}},{key:"_makeAttributes",value:function(e,t){var n=this.geometry,r=new m_(new Float32Array(e),3);n.setAttribute("position",r),r.needsUpdate=!0;var i=new m_(new Float32Array(e.length),3);n.setAttribute("color",i),this._updateColorAttribute(t)}},{key:"_updateColorAttribute",value:function(e){for(var t=o(new d_(e).toArray(),3),n=t[0],r=t[1],i=t[2],a=this.geometry.attributes.color,s=a.array,u=s.length,l=0,c=0;c<u;c++)s[l++]=n,s[l++]=r,s[l++]=i;a.needsUpdate=!0}}]),n}(Uw),HA=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_makePositions",value:function(e,t,n){var r=[];r.push.apply(r,xd(this._makeAxis(e,t,n))),r.push.apply(r,xd(this._makeLat(.5,10,e,t,n)));for(var i=0,a=[0,.25,.5,.75];i<a.length;i++){var o=a[i];r.push.apply(r,xd(this._makeLng(o,10,e,t,n)))}return r}},{key:"_makeAxis",value:function(e,t,n){var r=t.unprojectBasic([.5,1],.8*e),i=t.unprojectBasic([.5,0],1.2*e);return[r[0]-n[0],r[1]-n[1],r[2]-n[2],i[0]-n[0],i[1]-n[1],i[2]-n[2]]}},{key:"_makeLat",value:function(e,t,n,r,i){var a=.8*n,s=o(i,3),u=s[0],l=s[1],c=s[2],h=[],d=r.unprojectBasic([0,e],a);d[0]-=u,d[1]-=l,d[2]-=c,h.push.apply(h,xd(d));for(var f=1;f<=t;f++){var p=r.unprojectBasic([f/t,e],a);p[0]-=u,p[1]-=l,p[2]-=c,h.push.apply(h,xd(p).concat(xd(p)))}return h.push.apply(h,xd(d)),h}},{key:"_makeLng",value:function(e,t,n,r,i){var a=.8*n,s=o(i,3),u=s[0],l=s[1],c=s[2],h=[],d=r.unprojectBasic([e,0],a);d[0]-=u,d[1]-=l,d[2]-=c,h.push.apply(h,xd(d));for(var f=0;f<=t;f++){var p=r.unprojectBasic([e,f/t],a);p[0]-=u,p[1]-=l,p[2]-=c,h.push.apply(h,xd(p).concat(xd(p)))}return h.push.apply(h,xd(d)),h}}]),n}(VA),WA=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_makePositions",value:function(e,t,n){var r=[];return r.push.apply(r,xd(this._makeDiags(e,t,n))),r.push.apply(r,xd(this._makeFrame(e,8,t,n))),r}},{key:"_makeDiags",value:function(e,t,n){for(var r=o(n,3),i=r[0],a=r[1],s=r[2],u=[0,0,0],l=[],c=0,h=[[0,0],[1,0],[1,1],[0,1]];c<h.length;c++){var d=h[c],f=t.unprojectBasic(d,e);f[0]-=i,f[1]-=a,f[2]-=s,l.push.apply(l,u.concat(xd(f)))}return l}},{key:"_makeFrame",value:function(e,t,n,r){var i=[];i.push.apply(i,xd(this._subsample([0,1],[0,0],t))),i.push.apply(i,xd(this._subsample([0,0],[1,0],t))),i.push.apply(i,xd(this._subsample([1,0],[1,1],t)));for(var a=o(r,3),s=a[0],u=a[1],l=a[2],c=[],h=0,d=i;h<d.length;h++){var f=d[h],p=n.unprojectBasic(f,e);p[0]-=s,p[1]-=u,p[2]-=l,c.push.apply(c,xd(p))}return c}},{key:"_interpolate",value:function(e,t,n){return e+n*(t-e)}},{key:"_subsample",value:function(e,t,n){if(n<1)return[e,t];var r=[];r.push(e);for(var i=0;i<=n;i++){for(var a=[],o=0;o<3;o++)a.push(this._interpolate(e[o],t[o],i/(n+1)));r.push(a),r.push(a)}return r.push(t),r}}]),n}(VA);function GA(e,t,n){var r=o(t,3),i=o(OM(r[0],r[1],r[2],n.lng,n.lat,n.alt),3);return RM(i[0],i[1],i[2],e.lng,e.lat,e.alt)}var ZA,YA=function(){function e(t,n,r){Bd(this,e),this.id=t,this._scene=n,this._intersection=r,this.cameras=new Wg,this.keys=[],this._positionLines={},this._positions=new Wg,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new Ow({fog:!1,vertexColors:!0}),this._positionMaterial=new Ow({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}return $d(e,[{key:"addImage",value:function(e){var t=e.image,n=t.id;if(this.hasImage(n))throw new Error("Image exists ".concat(n));var r=e.idMap.ccId;this._connectedComponents.has(r)||this._connectedComponents.set(r,[]);var i=e.idMap.clusterId;this._clusters.has(i)||this._clusters.set(i,[]);var a=e.idMap.sequenceId;this._sequences.has(a)||this._sequences.set(a,[]),this._props[n]={image:t,ids:{ccId:r,clusterId:i,sequenceId:a}},this.keys.push(n)}},{key:"applyCameraColor",value:function(e,t){this._cameraFrames[e].setColor(t)}},{key:"applyCameraSize",value:function(e){var t,n=Ad(this.cameras.children);try{for(n.s();!(t=n.n()).done;){t.value.resize(e)}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"applyFilter",value:function(e){var t,n=this.clusterVisibles;for(var r in n)n.hasOwnProperty(r)&&(n[r]=!1);for(var i=this._cameraFrames,a=this._positionLines,o=this._intersection.interactiveLayer,s=0,u=Object.values(this._props);s<u.length;s++){var l=u[s],c=l.image,h=e(c),d=c.id;a[d].visible=h;var f=i[d];this._setCameraVisibility(f,h,o),n[t=l.ids.clusterId]||(n[t]=h)}}},{key:"applyPositionMode",value:function(e){this._positions.visible=e!==OA.Hidden;var t,n=Ad(this._positions.children);try{for(n.s();!(t=n.n()).done;){t.value.setMode(e)}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"dispose",value:function(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}},{key:"getCamerasByMode",value:function(e){if(e===RA.Cluster)return this._clusters;if(e===RA.ConnectedComponent)return this._connectedComponents;if(e===RA.Sequence)return this._sequences;var t=RA[RA.Homogeneous],n=new Map;return n.set(t,this.cameras.children),n}},{key:"getColorId",value:function(e,t){var n=this._props[e],r=RA;switch(t){case r.Cluster:return n.ids.clusterId;case r.ConnectedComponent:return n.ids.ccId;case r.Sequence:return n.ids.sequenceId;default:return r[r.Homogeneous]}}},{key:"hasImage",value:function(e){return-1!==this.keys.indexOf(e)}},{key:"resetReference",value:function(e,t){var n=this._cameraFrames;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];i.position.fromArray(GA(e,i.position.toArray(),t))}var a=this._positionLines;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];s.position.fromArray(GA(e,s.position.toArray(),t))}}},{key:"visualize",value:function(e){var t,n,r=e.id,i=e.visible,a=e.transform,o={color:e.color,material:this._frameMaterial,scale:e.scale,size:e.maxSize,transform:a},s=ZM(a.cameraType)?new HA(o):new WA(o),u=this._intersection.interactiveLayer;this._setCameraVisibility(s,i,u),this.cameras.add(s),this._cameraFrames[r]=s,this._intersection.add(s,r);var l=this._props[r].ids;(t=this.clusterVisibles)[n=l.clusterId]||(t[n]=i),this._connectedComponents.get(l.ccId).push(s),this._clusters.get(l.clusterId).push(s),this._sequences.get(l.sequenceId).push(s);var c={material:this._positionMaterial,mode:e.positionMode,originalOrigin:e.originalPosition,transform:a},h=new UA(c);h.visible=i,this._positions.add(h),this._positionLines[r]=h}},{key:"_disposeCameras",value:function(){var e,t=this._intersection,n=this.cameras,r=Ad(n.children.slice());try{for(r.s();!(e=r.n()).done;){var i=e.value;i.dispose(),t.remove(i),n.remove(i)}}catch(CO){r.e(CO)}finally{r.f()}this._scene.remove(this.cameras)}},{key:"_disposePositions",value:function(){var e,t=this._positions,n=Ad(t.children.slice());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.dispose(),t.remove(r)}}catch(CO){n.e(CO)}finally{n.f()}this._scene.remove(this._positions)}},{key:"_setCameraVisibility",value:function(e,t,n){e.visible=t,t?e.layers.enable(n):e.layers.disable(n)}}]),e}(),XA=function(){function e(){Bd(this,e),this._colors=new Map;var t=RA;this._colors.set(t[t.Homogeneous],"#FFFFFF")}return $d(e,[{key:"getColor",value:function(e){var t=this._colors;return t.has(e)||t.set(e,this._randomColor()),t.get(e)}},{key:"_randomColor",value:function(){return"hsl(".concat(Math.floor(360*Math.random()),", 100%, 50%)")}}]),e}();function KA(e){return e!==RA.Hidden}!function(e){e[e.Hidden=0]="Hidden",e[e.Original=1]="Original",e[e.Cluster=2]="Cluster"}(ZA||(ZA={}));var JA=function(){function e(t,n){Bd(this,e),this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=n||new tw,this._scene.autoUpdate=!1,this._intersection=new qA,this._assets=new XA,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=t.cameraVisualizationMode?t.cameraVisualizationMode:RA.Homogeneous,this._cameraSize=t.cameraSize,this._pointSize=t.pointSize,this._pointVisualizationMode=t.pointVisualizationMode?t.pointVisualizationMode:ZA.Original,this._positionMode=t.originalPositionMode,this._cellsVisible=t.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=function(){return!0}}return $d(e,[{key:"needsRender",get:function(){return this._needsRender}},{key:"intersection",get:function(){return this._intersection}},{key:"addCluster",value:function(e,t,n){if(!this.hasCluster(e.id,n)){var r=e.id;if(!(r in this._clusters)){this._clusters[r]={points:new Wg,cellIds:[]};var i=this._getClusterVisible(r),a=this._clusters[r],o=this._pointVisualizationMode===ZA.Cluster?this._assets.getColor(r):null,s=new DA({cluster:e,color:o,originalSize:this._originalPointSize,scale:this._pointSize,translation:t});a.points.visible=i,a.points.add(s),this._scene.add(a.points)}-1===this._clusters[r].cellIds.indexOf(n)&&this._clusters[r].cellIds.push(n),n in this._cellClusters||(this._cellClusters[n]={keys:[]}),-1===this._cellClusters[n].keys.indexOf(r)&&this._cellClusters[n].keys.push(r),this._needsRender=!0}}},{key:"addImage",value:function(e,t,n,r){var i,a,o,s=e.id,u={clusterId:null!==(i=e.clusterId)&&void 0!==i?i:"NO_CLUSTER_ID",sequenceId:null!==(a=e.sequenceId)&&void 0!==a?a:"NO_SEQUENCE_ID",ccId:null!==(o=e.mergeId)&&void 0!==o?o:"NO_MERGE_ID"};if(!(r in this._images)){var l=new YA(r,this._scene,this._intersection);l.cameras.visible=KA(this._cameraVisualizationMode),l.applyPositionMode(this._positionMode),this._images[r]=l}var c=this._images[r];if(!c.hasImage(s)){c.addImage({idMap:u,image:e});var h=c.getColorId(s,this._cameraVisualizationMode),d=this._assets.getColor(h),f=this._filter(e);if(c.visualize({id:s,color:d,positionMode:this._positionMode,scale:this._cameraSize,transform:t,visible:f,maxSize:this._originalCameraSize,originalPosition:n}),this._imageCellMap.set(s,r),s===this._selectedId&&this._highlight(s,this._colors.select,this._cameraVisualizationMode),u.clusterId in this._clusters){var p=this._getClusterVisible(u.clusterId);this._clusters[u.clusterId].points.visible=p}this._needsRender=!0}}},{key:"addCell",value:function(e,t){if(!this.hasCell(t)){var n=new zA(e);this._cells[t]=new Wg,this._cells[t].visible=this._cellsVisible,this._cells[t].add(n),this._scene.add(this._cells[t]),this._needsRender=!0}}},{key:"deactivate",value:function(){this._filter=function(){return!0},this._selectedId=null,this._hoveredId=null,this.uncache()}},{key:"hasCluster",value:function(e,t){return e in this._clusters&&-1!==this._clusters[e].cellIds.indexOf(t)}},{key:"hasCell",value:function(e){return e in this._cells}},{key:"hasImage",value:function(e,t){return t in this._images&&this._images[t].hasImage(e)}},{key:"render",value:function(e,t){t.render(this._scene,e),this._needsRender=!1}},{key:"resetReference",value:function(e,t){var n=this._clusters;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];i.points.position.fromArray(GA(e,i.points.position.toArray(),t))}var a=this._cells;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];s.position.fromArray(GA(e,s.position.toArray(),t))}var u=this._images;for(var l in u){if(u.hasOwnProperty(l))u[l].resetReference(e,t)}}},{key:"setCameraSize",value:function(e){if(!(Math.abs(e-this._cameraSize)<.001)){for(var t=this._images,n=0,r=Object.keys(t);n<r.length;n++){t[r[n]].applyCameraSize(e)}this._intersection.raycaster.near=this._getNear(e),this._cameraSize=e,this._needsRender=!0}}},{key:"setFilter",value:function(e){this._filter=e;for(var t={},n=0,r=Object.values(this._images);n<r.length;n++){var i=r[n];i.applyFilter(e);var a=i.clusterVisibles;for(var o in a)a.hasOwnProperty(o)&&(o in t||(t[o]=!1),t[o]||(t[o]=a[o]))}var s=this._pointVisualizationMode!==ZA.Hidden;for(var u in t)if(t.hasOwnProperty(u)){t[u]&&(t[u]=s);var l=t[u];u in this._clusters&&(this._clusters[u].points.visible=l)}this._needsRender=!0}},{key:"setHoveredImage",value:function(e){if(null!=e&&!this._imageCellMap.has(e))throw new VM("Image does not exist: ".concat(e));this._hoveredId!==e&&(this._needsRender=!0,null!=this._hoveredId&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(e,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=e)}},{key:"setNavigationState",value:function(e){this._intersection.resetIntersectionThreshold(e)}},{key:"setPointSize",value:function(e){if(!(Math.abs(e-this._pointSize)<.001)){var t=this._clusters;for(var n in t)if(t.hasOwnProperty(n)){var r,i=Ad(t[n].points.children);try{for(i.s();!(r=i.n()).done;){r.value.resize(e)}}catch(CO){i.e(CO)}finally{i.f()}}this._pointSize=e,this._needsRender=!0}}},{key:"setPointVisualizationMode",value:function(e){if(e!==this._pointVisualizationMode){for(var t in this._pointVisualizationMode=e,this._clusters)if(this._clusters.hasOwnProperty(t)){var n=this._clusters[t];n.points.visible=this._getClusterVisible(t);var r,i=Ad(n.points.children);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=e===ZA.Cluster?this._assets.getColor(t):null;a.setColor(o)}}catch(CO){i.e(CO)}finally{i.f()}}this._needsRender=!0}}},{key:"setPositionMode",value:function(e){if(e!==this._positionMode){for(var t=0,n=Object.values(this._images);t<n.length;t++){n[t].applyPositionMode(e)}this._positionMode=e,this._needsRender=!0}}},{key:"setSelectedImage",value:function(e){this._selectedId!==e&&(this._needsRender=!0,null!=this._selectedId&&this._resetCameraColor(this._selectedId),this._highlight(e,this._colors.select,this._cameraVisualizationMode),this._selectedId=e)}},{key:"setCellVisibility",value:function(e){if(e!==this._cellsVisible){for(var t in this._cells)this._cells.hasOwnProperty(t)&&(this._cells[t].visible=e);this._cellsVisible=e,this._needsRender=!0}}},{key:"setCameraVisualizationMode",value:function(e){if(e!==this._cameraVisualizationMode){for(var t=KA(e),n=this._assets,r=0,i=Object.values(this._images);r<i.length;r++){var a=i[r];a.cameras.visible=t,a.getCamerasByMode(e).forEach((function(e,t){var r,i=n.getColor(t),a=Ad(e);try{for(a.s();!(r=a.n()).done;){r.value.setColor(i)}}catch(CO){a.e(CO)}finally{a.f()}}))}this._highlight(this._hoveredId,this._colors.hover,e),this._highlight(this._selectedId,this._colors.select,e),this._cameraVisualizationMode=e,this._needsRender=!0}}},{key:"uncache",value:function(e){for(var t=0,n=Object.keys(this._cellClusters);t<n.length;t++){var r=n[t];e&&-1!==e.indexOf(r)||this._disposeReconstruction(r)}for(var i=0,a=Object.keys(this._images);i<a.length;i++){var o=a[i];if(!e||-1===e.indexOf(o)){var s,u=this._imageCellMap,l=Ad(this._images[o].keys);try{for(l.s();!(s=l.n()).done;){var c=s.value;u.delete(c)}}catch(CO){l.e(CO)}finally{l.f()}this._images[o].dispose(),delete this._images[o]}}for(var h=0,d=Object.keys(this._cells);h<d.length;h++){var f=d[h];e&&-1!==e.indexOf(f)||this._disposeCell(f)}this._needsRender=!0}},{key:"_getClusterVisible",value:function(e){if(this._pointVisualizationMode===ZA.Hidden)return!1;for(var t=!1,n=0,r=Object.values(this._images);n<r.length;n++){var i=r[n].clusterVisibles;e in i&&(t||(t=i[e]))}return t}},{key:"_disposePoints",value:function(e){var t,n=Ad(this._cellClusters[e].keys);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in this._clusters){var i=this._clusters[r].cellIds.indexOf(e);if(-1!==i&&(this._clusters[r].cellIds.splice(i,1),!(this._clusters[r].cellIds.length>0))){var a,o=Ad(this._clusters[r].points.children.slice());try{for(o.s();!(a=o.n()).done;){a.value.dispose()}}catch(CO){o.e(CO)}finally{o.f()}this._scene.remove(this._clusters[r].points),delete this._clusters[r]}}}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"_disposeReconstruction",value:function(e){this._disposePoints(e),delete this._cellClusters[e]}},{key:"_disposeCell",value:function(e){var t,n=this._cells[e],r=Ad(n.children.slice());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.dispose(),n.remove(i)}}catch(CO){r.e(CO)}finally{r.f()}this._scene.remove(n),delete this._cells[e]}},{key:"_getNear",value:function(e){var t=this._rayNearScale*this._originalCameraSize*e;return Math.max(1,t)}},{key:"_resetCameraColor",value:function(e){var t=this._imageCellMap;if(null!=e&&t.has(e)){var n=t.get(e),r=this._images[n],i=r.getColorId(e,this._cameraVisualizationMode),a=this._assets.getColor(i);r.applyCameraColor(e,a)}}},{key:"_highlight",value:function(e,t,n){var r=this._imageCellMap;if(null!=e&&r.has(e)){var i=r.get(e);t=n===RA.Homogeneous?t:"#FFFFFF",this._images[i].applyCameraColor(e,t)}}}]),e}(),QA=function(){function e(t,n){Bd(this,e),this._graphService=t,this._data=n,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}return $d(e,[{key:"cacheClusters$",value:function(e){var t=this;if(!this.hasCell(e))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(e))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(e))return this._cachingClusters$[e];var n,r=this.getCell(e).filter((function(e){return!!e.clusterId&&!!e.clusterUrl})).map((function(e){return{key:e.clusterId,url:e.clusterUrl}})),i=Array.from(new Map(r.map((function(e){return[e.key,e]}))).values());this._cellClusters[e]=i,this._cacheRequests[e]=[];var a=new Promise((function(e,t){n=t}));return this._cacheRequests[e].push(n),this._cachingClusters$[e]=this._cacheClusters$(i,e,a).pipe(dv((function(){e in t._cachingClusters$&&delete t._cachingClusters$[e],e in t._cacheRequests&&delete t._cacheRequests[e]})),_v(),Pf()),this._cachingClusters$[e]}},{key:"cacheCell$",value:function(e){var t=this;if(this.hasCell(e))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(e)||(this._cachingCells$[e]=this._graphService.cacheCell$(e).pipe(Jp((function(e){return console.error(e),Hf()})),Zp((function(){return!(e in t._cells)})),Av((function(n){var r;t._cells[e]=[],(r=t._cells[e]).push.apply(r,xd(n)),delete t._cachingCells$[e]})),dv((function(){e in t._cachingCells$&&delete t._cachingCells$[e]})),_v(),Pf())),this._cachingCells$[e]}},{key:"isCachingClusters",value:function(e){return e in this._cachingClusters$}},{key:"isCachingCell",value:function(e){return e in this._cachingCells$}},{key:"hasClusters",value:function(e){if(e in this._cachingClusters$||!(e in this._cellClusters))return!1;var t,n=Ad(this._cellClusters[e]);try{for(n.s();!(t=n.n()).done;){if(!(t.value.key in this._clusters))return!1}}catch(CO){n.e(CO)}finally{n.f()}return!0}},{key:"hasCell",value:function(e){return!(e in this._cachingCells$)&&e in this._cells}},{key:"getClusters",value:function(e){var t=this;return e in this._cellClusters?this._cellClusters[e].map((function(e){return t._clusters[e.key]})).filter((function(e){return!!e})):[]}},{key:"getCell",value:function(e){return e in this._cells?this._cells[e]:[]}},{key:"uncache",value:function(e){for(var t=0,n=Object.keys(this._cacheRequests);t<n.length;t++){var r=n[t];if(!e||-1===e.indexOf(r)){var i,a=Ad(this._cacheRequests[r]);try{for(a.s();!(i=a.n()).done;){(0,i.value)()}}catch(CO){a.e(CO)}finally{a.f()}delete this._cacheRequests[r]}}for(var o=0,s=Object.keys(this._cellClusters);o<s.length;o++){var u=s[o];if(!e||-1===e.indexOf(u)){var l,c=Ad(this._cellClusters[u]);try{for(c.s();!(l=c.n()).done;){var h=l.value;if(h.key in this._clusterCells){var d=this._clusterCells[h.key].indexOf(u);-1!==d&&(this._clusterCells[h.key].splice(d,1),this._clusterCells[h.key].length>0||(delete this._clusterCells[h.key],delete this._clusters[h.key]))}}}catch(CO){c.e(CO)}finally{c.f()}delete this._cellClusters[u]}}for(var f=0,p=Object.keys(this._cells);f<p.length;f++){var v=p[f];e&&-1!==e.indexOf(v)||delete this._cells[v]}}},{key:"updateCell$",value:function(e){var t=this;if(!this.hasCell(e))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(e).pipe(Jp((function(e){return console.error(e),Hf()})),Zp((function(){return e in t._cells})),Av((function(n){var r;t._cells[e]=[],(r=t._cells[e]).push.apply(r,xd(n))})),_v(),Pf())}},{key:"updateClusters$",value:function(e){var t,n=this;if(!this.hasCell(e))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(e))throw new Error("Cannot update reconstructions for cell that is not cached.");var r=this.getCell(e).filter((function(e){return!!e.clusterId&&!!e.clusterUrl})).map((function(e){return{key:e.clusterId,url:e.clusterUrl}})),i=Array.from(new Map(r.map((function(e){return[e.key,e]}))).values()).filter((function(e){return!(e.key in n._clusters)}));return(t=this._cellClusters[e]).push.apply(t,xd(i)),this._cacheClusters$(i,e,null)}},{key:"_cacheClusters$",value:function(e,t,n){var r=this;return ap(e).pipe(Np((function(e){return r._hasCluster(e.key)?vp(r._getCluster(e.key)):r._getCluster$(e.url,e.key,n).pipe(Jp((function(e){return e instanceof PP||console.error(e),Hf()})))}),6),Zp((function(){return t in r._cellClusters})),Av((function(e){r._hasCluster(e.id)||(r._clusters[e.id]=e),e.id in r._clusterCells||(r._clusterCells[e.id]=[]),-1===r._clusterCells[e.id].indexOf(t)&&r._clusterCells[e.id].push(t)})))}},{key:"_getCluster",value:function(e){return this._clusters[e]}},{key:"_getCluster$",value:function(e,t,n){var r=this;return Sf.create((function(i){r._data.getCluster(e,n).then((function(e){e.id=t,i.next(e),i.complete()}),(function(e){i.error(e)}))}))}},{key:"_hasCluster",value:function(e){return e in this._clusters}}]),e}();function eL(e,t,n){var r=new Set;return r.add(e),tL(r,[e],0,t,n),Array.from(r)}function tL(e,t,n,r,i){if(!(n>=r)){var a,o=[],s=Ad(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=i.getAdjacent(u);o.push.apply(o,xd(l))}}catch(CO){s.e(CO)}finally{s.f()}for(var c=[],h=0,d=o;h<d.length;h++){var f=d[h];e.has(f)||(e.add(f),c.push(f))}tL(e,c,n+1,r,i)}}var nL=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._cache=new QA(i.graphService,i.api.data),a._scene=new JA(a._getDefaultConfiguration()),a._viewportCoords=new CP,a._spatial=new WM,a}return $d(n,[{key:"getFrameIdAt",value:function(e){var t=this;return new Promise((function(n,r){t._container.renderService.renderCamera$.pipe(fv(),wp((function(n){var r=t._viewportCoords.canvasToViewport(e[0],e[1],t._container.container);return t._scene.intersection.intersectObjects(r,n.perspective)}))).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"_activate",value:function(){var e=this;this._navigator.cacheService.configure({cellDepth:3});var t=this._subscriptions;t.push(this._navigator.stateService.reference$.pipe(gv()).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];e._scene.resetReference(i,r)}))),t.push(this._navigator.graphService.filter$.subscribe((function(t){e._scene.setFilter(t)})));var n=this._container.renderService.bearing$.pipe(wp((function(e){return 6*Math.floor(e/6)})),sv(),yv(1),Pf()),r=this._navigator.stateService.currentImage$.pipe(wp((function(t){return e._navigator.api.data.geometry.lngLatToCellId(t.originalLngLat)})),sv(),yv(1),Pf()),i=this._configuration$.pipe(wp((function(t){return e._spatial.clamp(t.cellGridDepth,1,3)})),sv(),yv(1),Pf()),a=Lp(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return n&&r>NA.sequenceSpeed})),sv(),yv(1),Pf()),s=this._navigator.stateService.state$.pipe(wp((function(e){return function(e){return e===XP.Custom||e===XP.Earth}(e)})),sv(),yv(1),Pf());t.push(s.subscribe((function(t){e._scene.setNavigationState(t)})));var u=Lp(s,a,n,i,this._navigator.stateService.currentImage$).pipe(sv((function(e,t){var n=o(e,5),r=n[0],i=n[1],a=n[2],s=n[3],u=n[4],l=o(t,5),c=l[0],h=l[1],d=l[2],f=l[3],p=l[4];if(r!==c)return!1;var v=u.id===p.id&&i===h&&s===f;return r?v:v&&a===d})),tv((function(t){var n=o(t,5),r=n[0],i=n[1],a=n[2],s=n[3],u=n[4];if(r){var l=e._navigator.api.data.geometry,c=l.lngLatToCellId(u.originalLngLat);return vp(i?[c]:eL(c,s,l))}var h=i?30:90;return vp(e._cellsInFov(u,a,h))})),Tv((function(t){return ap(t).pipe(Np((function(t){return(e._cache.hasCell(t)?vp(e._cache.getCell(t)):e._cache.cacheCell$(t)).pipe(wp((function(e){return{id:t,images:e}})))}),6))})));t.push(u.pipe(Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];e._scene.hasCell(r.id)||e._scene.addCell(e._cellToTopocentric(r.id,i),r.id)}))),t.push(u.pipe(Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];e._addSceneImages(r,i)}))),t.push(u.pipe(tv((function(t){var n,r=t.id;return n=e._cache.hasClusters(r)?ap(e._cache.getClusters(r)):e._cache.isCachingClusters(r)?e._cache.cacheClusters$(r).pipe(vv(null,{}),Tv((function(){return ap(e._cache.getClusters(r))}))):e._cache.hasCell(r)?e._cache.cacheClusters$(r):Hf(),Lp(vp(r),n)})),Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1];e._scene.hasCluster(a.id,i)||e._scene.addCluster(a,e._computeTranslation(a,s),i)}))),t.push(this._configuration$.pipe(wp((function(t){var n;t.cameraSize=e._spatial.clamp(t.cameraSize,.01,1),t.pointSize=e._spatial.clamp(t.pointSize,.01,1);var r=t.pointsVisible?null!==(n=t.pointVisualizationMode)&&void 0!==n?n:ZA.Original:ZA.Hidden;return{cameraSize:t.cameraSize,cameraVisualizationMode:t.cameraVisualizationMode,cellsVisible:t.cellsVisible,originalPositionMode:t.originalPositionMode,pointSize:t.pointSize,pointVisualizationMode:r}})),sv((function(e,t){return e.cameraSize===t.cameraSize&&e.cameraVisualizationMode===t.cameraVisualizationMode&&e.cellsVisible===t.cellsVisible&&e.originalPositionMode===t.originalPositionMode&&e.pointSize===t.pointSize&&e.pointVisualizationMode===t.pointVisualizationMode}))).subscribe((function(t){e._scene.setCameraSize(t.cameraSize);var n=t.cameraVisualizationMode;e._scene.setCameraVisualizationMode(n),e._scene.setCellVisibility(t.cellsVisible),e._scene.setPointSize(t.pointSize);var r=t.pointVisualizationMode;e._scene.setPointVisualizationMode(r);var i=t.originalPositionMode;e._scene.setPositionMode(i)}))),t.push(Lp(r,i).subscribe((function(t){var n=o(t,2),r=eL(n[0],n[1],e._navigator.api.data.geometry);e._scene.uncache(r),e._cache.uncache(r)}))),t.push(this._navigator.playService.playing$.pipe(Tv((function(t){return t?Hf():e._container.mouseService.dblClick$})),Lv(this._container.renderService.renderCamera$),Tv((function(t){var n=o(t,2),r=n[0],i=n[1],a=e._container.container,s=o(e._viewportCoords.canvasPosition(r,a),2),u=s[0],l=s[1],c=e._viewportCoords.canvasToViewport(u,l,a),h=e._scene.intersection.intersectObjects(c,i.perspective);return h?e._navigator.moveTo$(h).pipe(Jp((function(){return Hf()}))):Hf()}))).subscribe());var l=Lp(this._configuration$,this._navigator.stateService.state$).pipe(wp((function(t){var n=o(t,2),r=n[0],i=n[1];return r.cameraSize=e._spatial.clamp(r.cameraSize,.01,1),{size:r.cameraSize,visible:KA(r.cameraVisualizationMode),state:i}})),sv((function(e,t){return e.size===t.size&&e.visible===t.visible&&e.state===t.state}))),c=this._container.mouseService.mouseMove$.pipe(yv(1),Pf());t.push(c.subscribe());var h=Hp(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);t.push(Lp(this._navigator.playService.playing$,h,s,this._navigator.graphService.filter$).pipe(Tv((function(t){var n=o(t,2),r=n[0],i=n[1];return r||"pointerenter"!==i.type?Lp(vp(i),vp(null),vp(null)):Lp(jp(c.pipe(ov(1)),e._container.mouseService.mouseMove$),e._container.renderService.renderCamera$,l)}))).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];if("pointermove"===r.type){var a=e._container.container,s=o(e._viewportCoords.canvasPosition(r,a),2),u=s[0],l=s[1],c=e._viewportCoords.canvasToViewport(u,l,a),h=e._scene.intersection.intersectObjects(c,i.perspective);e._scene.setHoveredImage(h)}else e._scene.setHoveredImage(null)}))),t.push(this._navigator.stateService.currentId$.subscribe((function(t){e._scene.setSelectedImage(t)}))),t.push(this._navigator.stateService.currentState$.pipe(wp((function(t){var n=e._scene;return{name:e._name,renderer:{frameId:t.id,needsRender:n.needsRender,render:n.render.bind(n),pass:OP.Opaque}}}))).subscribe(this._container.glRenderer.render$));var d=this._navigator.graphService.dataAdded$.pipe(Zp((function(t){return e._cache.hasCell(t)})),Np((function(t){return e._cache.updateCell$(t).pipe(wp((function(e){return{id:t,images:e}})),Lv(e._navigator.stateService.reference$))})),_v(),Pf());t.push(d.subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];e._addSceneImages(r,i)}))),t.push(d.pipe(tv((function(t){var n,r=o(t,1)[0].id,i=e._cache;return n=i.hasClusters(r)?i.updateClusters$(r):i.isCachingClusters(r)?e._cache.cacheClusters$(r).pipe(vv(null,{}),Tv((function(){return ap(i.updateClusters$(r))}))):Hf(),Lp(vp(r),n)})),Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1];e._scene.hasCluster(a.id,i)||e._scene.addCluster(a,e._computeTranslation(a,s),i)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}},{key:"_getDefaultConfiguration",value:function(){return{cameraSize:.1,cameraVisualizationMode:RA.Homogeneous,cellGridDepth:1,originalPositionMode:OA.Hidden,pointSize:.1,pointsVisible:!0,pointVisualizationMode:ZA.Original,cellsVisible:!1}}},{key:"_addSceneImages",value:function(e,t){var n,r=e.id,i=Ad(e.images);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._scene.hasImage(a.id,r)||this._scene.addImage(a,this._createTransform(a,t),this._computeOriginalPosition(a,t),r)}}catch(CO){i.e(CO)}finally{i.f()}}},{key:"_cellsInFov",value:function(e,t,n){var r,i=this._spatial,a=this._navigator.api.data.geometry,s=a.lngLatToCellId(e.originalLngLat),u=[s],l=n/2,c=Ad(a.getAdjacent(s));try{for(c.s();!(r=c.n()).done;){var h,d=r.value,f=Ad(a.getVertices(d));try{for(f.s();!(h=f.n()).done;){var p=h.value,v=o(RM(p.lng,p.lat,0,e.lngLat.lng,e.lngLat.lat,0),2),m=v[0],g=v[1],_=Math.atan2(g,m),y=i.radToDeg(i.azimuthalToBearing(_));Math.abs(y-t)<l&&u.push(d)}}catch(CO){f.e(CO)}finally{f.f()}}}catch(CO){c.e(CO)}finally{c.f()}return u}},{key:"_computeOriginalPosition",value:function(e,t){return RM(e.originalLngLat.lng,e.originalLngLat.lat,null!=e.originalAltitude?e.originalAltitude:e.computedAltitude,t.lng,t.lat,t.alt)}},{key:"_cellToTopocentric",value:function(e,t){var n=this._navigator.api.data.geometry.getVertices(e).map((function(e){return RM(e.lng,e.lat,-2,t.lng,t.lat,t.alt)}));return n}},{key:"_computeTranslation",value:function(e,t){return RM(e.reference.lng,e.reference.lat,e.reference.alt,t.lng,t.lat,t.alt)}},{key:"_createTransform",value:function(e,t){var n=XM({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t);return new PA(e.exifOrientation,e.width,e.height,e.scale,e.rotation,n,void 0,void 0,e.cameraParameters,e.cameraType)}}]),n}(wP);nL.componentName="spatial";var rL=function(){function e(){Bd(this,e),this._notifyChanged$=new If}return $d(e,[{key:"changed$",get:function(){return this._notifyChanged$}}]),e}(),iL=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),r=t.call(this,null!=e?e:"The provided geometry value is incorrect"),Object.setPrototypeOf(Id(r),n.prototype),r.name="GeometryTagError",r}return $d(n)}(VM),aL=function(e){Dd(n,e);var t=zd(n);function n(e){var r;if(Bd(this,n),r=t.call(this),e.length<2)throw new iL("A points geometry must have two or more positions.");r._points=[];var i,a=Ad(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o[0]<0||o[0]>1||o[1]<0||o[1]>1)throw new iL("Basic coordinates of points must be on the interval [0, 1].");r._points.push(o.slice())}}catch(CO){a.e(CO)}finally{a.f()}return r}return $d(n,[{key:"points",get:function(){return this._points}},{key:"addPoint2d",value:function(e){var t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points.push(t),this._notifyChanged$.next(this)}},{key:"getPoint2d",value:function(e){return this._points[e].slice()}},{key:"removePoint2d",value:function(e){if(e<0||e>=this._points.length||this._points.length<3)throw new iL("Index for removed point must be valid.");this._points.splice(e,1),this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(e,t,n){this.setPoint2d(e,t,n)}},{key:"setPoint2d",value:function(e,t,n){var r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points[e]=r,this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(e){return this._getPoints3d(this._points,e)}},{key:"getPoint3d",value:function(e,t){return t.unprojectBasic(this._points[e],200)}},{key:"getPoints2d",value:function(){return this._points.slice()}},{key:"getCentroid2d",value:function(e){if(!e)throw new iL("Get centroid must be called with a transform for points geometries.");var t=o(this.getRect2d(e),4),n=t[0],r=t[1],i=t[2];return[n<i?(n+i)/2:(n+i+1)/2%1,(r+t[3])/2]}},{key:"getCentroid3d",value:function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)}},{key:"getRect2d",value:function(e){var t,n=1,r=0,i=1,a=0,o=this._points,s=Ad(o);try{for(s.s();!(t=s.n()).done;){var u=t.value;u[0]<n&&(n=u[0]),u[0]>r&&(r=u[0]),u[1]<i&&(i=u[1]),u[1]>a&&(a=u[1])}}catch(CO){s.e(CO)}finally{s.f()}if(ZM(e.cameraType)){for(var l=[],c=0;c<o.length;c++)l[c]=c;l.sort((function(e,t){return o[e][0]<o[t][0]?-1:o[e][0]>o[t][0]?1:e<t?-1:1}));for(var h=o[l[0]][0]+1-o[l[l.length-1]][0],d=0,f=0;f<l.length-1;f++){var p=l[f],v=l[f+1],m=o[v][0]-o[p][0];m>h&&(h=m,d=f+1)}d>0&&(n=o[l[d]][0],r=o[l[d-1]][0])}return[n,i,r,a]}},{key:"setCentroid2d",value:function(e,t){throw new Error("Not implemented")}},{key:"_getPoints3d",value:function(e,t){return e.map((function(e){return t.unprojectBasic(e,200)}))}}]),n}(rL),oL=function(){function e(t,n,r){var i=this;Bd(this,e),this._geometry=t,this._transform=n,this._viewportCoords=r||new CP,this._aborted$=new If,this._created$=new If,this._glObjectsChanged$=new If,this._geometryChangedSubscription=this._geometry.changed$.subscribe((function(){i._onGeometryChanged(),i._glObjectsChanged$.next(i)}))}return $d(e,[{key:"geometry",get:function(){return this._geometry}},{key:"glObjects",get:function(){return this._glObjects}},{key:"aborted$",get:function(){return this._aborted$}},{key:"created$",get:function(){return this._created$}},{key:"glObjectsChanged$",get:function(){return this._glObjectsChanged$}},{key:"geometryChanged$",get:function(){var e=this;return this._geometry.changed$.pipe(wp((function(){return e})))}},{key:"dispose",value:function(){this._geometryChangedSubscription.unsubscribe()}},{key:"_canvasToTransform",value:function(e){var t=Math.round(e[0]),n=Math.round(e[1]);return"translate(-50%,-50%) translate(".concat(t,"px,").concat(n,"px)")}},{key:"_colorToBackground",value:function(e){return"#"+("000000"+e.toString(16)).substr(-6)}},{key:"_createOutine",value:function(e,t){var n=this._getLinePositions(e),r=new E_;r.setAttribute("position",new m_(n,3));var i=new Ow({color:t,linewidth:1});return new Fw(r,i)}},{key:"_disposeLine",value:function(e){null!=e&&(e.geometry.dispose(),e.material.dispose())}},{key:"_getLinePositions",value:function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;++r){var i=3*r,a=e[r];n[i]=a[0],n[i+1]=a[1],n[i+2]=a[2]}return n}}]),e}(),sL={exports:{}};function uL(e,t,n){n=n||2;var r,i,a,o,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,d=lL(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=lL(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(bL(o));for(s.sort(mL),i=0;i<s.length;i++)n=cL(n=gL(s[i],n),n.next);return n}(e,t,d,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var p=n;p<h;p+=n)(s=e[p])<r&&(r=s),(u=e[p+1])<i&&(i=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-r,o-i))?1/l:0}return hL(d,f,n,r,i,l),f}function lL(e,t,n,r,i){var a,o;if(i===RL(e,t,n,r)>0)for(a=t;a<n;a+=r)o=AL(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=AL(a,e[a],e[a+1],o);return o&&SL(o,o.next)&&(LL(o),o=o.next),o}function cL(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!SL(r,r.next)&&0!==kL(r.prev,r,r.next))r=r.next;else{if(LL(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function hL(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=yL(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}(e,r,i,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?fL(e,r,i,a):dL(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),LL(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?hL(e=pL(cL(e),t,n),t,n,r,i,a,2):2===o&&vL(e,t,n,r,i,a):hL(cL(e),t,n,r,i,a,1);break}}}function dL(e){var t=e.prev,n=e,r=e.next;if(kL(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(xL(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&kL(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function fL(e,t,n,r){var i=e.prev,a=e,o=e.next;if(kL(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=yL(s,u,t,n,r),d=yL(l,c,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&xL(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&kL(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&xL(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&kL(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&xL(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&kL(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&xL(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&kL(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function pL(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!SL(i,a)&&ML(i,r,r.next,a)&&EL(i,a)&&EL(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),LL(r),LL(r.next),r=e=a),r=r.next}while(r!==e);return cL(r)}function vL(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&wL(o,s)){var u=PL(o,s);return o=cL(o,o.next),u=cL(u,u.next),hL(o,t,n,r,i,a),void hL(u,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function mL(e,t){return e.x-t.x}function gL(e,t){var n=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,l=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&xL(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),EL(r,e)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&_L(n,r)))&&(n=r,d=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var r=PL(n,e),i=cL(n,n.next);return cL(r,r.next),t===n?i:t}function _L(e,t){return kL(e.prev,e,t.prev)<0&&kL(t.next,e,e.next)<0}function yL(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function bL(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function xL(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function wL(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ML(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(EL(e,t)&&EL(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(kL(e.prev,e,t.prev)||kL(e,t.prev,t))||SL(e,t)&&kL(e.prev,e,e.next)>0&&kL(t.prev,t,t.next)>0)}function kL(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function SL(e,t){return e.x===t.x&&e.y===t.y}function ML(e,t,n,r){var i=TL(kL(e,t,n)),a=TL(kL(e,t,r)),o=TL(kL(n,r,e)),s=TL(kL(n,r,t));return i!==a&&o!==s||(!(0!==i||!CL(e,n,t))||(!(0!==a||!CL(e,r,t))||(!(0!==o||!CL(n,e,r))||!(0!==s||!CL(n,t,r)))))}function CL(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function TL(e){return e>0?1:e<0?-1:0}function EL(e,t){return kL(e.prev,e,e.next)<0?kL(e,t,e.next)>=0&&kL(e,e.prev,t)>=0:kL(e,t,e.prev)<0||kL(e,e.next,t)<0}function PL(e,t){var n=new IL(e.i,e.x,e.y),r=new IL(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function AL(e,t,n,r){var i=new IL(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function LL(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function IL(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function RL(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}sL.exports=uL,sL.exports.default=uL,uL.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(RL(e,0,a,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;o-=Math.abs(RL(e,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},uL.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n};var OL=sL.exports,NL={exports:{}},DL=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zL;if(Bd(this,e),this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}return $d(e,[{key:"push",value:function(e){this.data.push(e),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}},{key:"_down",value:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&n(t[s],o)<0&&(a=s,o=t[s]),n(o,i)>=0)break;t[e]=o,e=a}t[e]=i}}]),e}();function zL(e,t){return e<t?-1:e>t?1:0}var jL=kC(Object.freeze({__proto__:null,default:DL}));function BL(e,t,n){var r,i,a,o;t=t||1;for(var s=0;s<e[0].length;s++){var u=e[0][s];(!s||u[0]<r)&&(r=u[0]),(!s||u[1]<i)&&(i=u[1]),(!s||u[0]>a)&&(a=u[0]),(!s||u[1]>o)&&(o=u[1])}var l=a-r,c=o-i,h=Math.min(l,c),d=h/2;if(0===h){var f=[r,i];return f.distance=0,f}for(var p=new jL(void 0,FL),v=r;v<a;v+=h)for(var m=i;m<o;m+=h)p.push(new $L(v+d,m+d,d,e));var g=function(e){for(var t=0,n=0,r=0,i=e[0],a=0,o=i.length,s=o-1;a<o;s=a++){var u=i[a],l=i[s],c=u[0]*l[1]-l[0]*u[1];n+=(u[0]+l[0])*c,r+=(u[1]+l[1])*c,t+=3*c}return 0===t?new $L(i[0][0],i[0][1],0,e):new $L(n/t,r/t,0,e)}(e),_=new $L(r+l/2,i+c/2,0,e);_.d>g.d&&(g=_);for(var y=p.length;p.length;){var b=p.pop();b.d>g.d&&(g=b,n&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(d=b.h/2,p.push(new $L(b.x-d,b.y-d,d,e)),p.push(new $L(b.x+d,b.y-d,d,e)),p.push(new $L(b.x-d,b.y+d,d,e)),p.push(new $L(b.x+d,b.y+d,d,e)),y+=4)}n&&(console.log("num probes: "+y),console.log("best distance: "+g.d));var x=[g.x,g.y];return x.distance=g.d,x}function FL(e,t){return t.max-e.max}function $L(e,t,n,r){this.x=e,this.y=t,this.h=n,this.d=function(e,t,n){for(var r=!1,i=1/0,a=0;a<n.length;a++)for(var o=n[a],s=0,u=o.length,l=u-1;s<u;l=s++){var c=o[s],h=o[l];c[1]>t!==h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(r=!r),i=Math.min(i,qL(e,t,c,h))}return 0===i?0:(r?1:-1)*Math.sqrt(i)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function qL(e,t,n,r){var i=n[0],a=n[1],o=r[0]-i,s=r[1]-a;if(0!==o||0!==s){var u=((e-i)*o+(t-a)*s)/(o*o+s*s);u>1?(i=r[0],a=r[1]):u>0&&(i+=o*u,a+=s*u)}return(o=e-i)*o+(s=t-a)*s}jL.default&&(jL=jL.default),NL.exports=BL,NL.exports.default=BL;var UL=NL.exports;function VL(e,t){return e>t?1:e<t?-1:0}var HL=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VL,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Bd(this,e),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!n}return $d(e,[{key:"rotateLeft",value:function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}},{key:"rotateRight",value:function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}},{key:"_splay",value:function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}},{key:"splay",value:function(e){for(var t,n,r,i,a;e.parent;)(n=(t=e.parent).parent)&&n.parent?((r=n.parent).left===n?r.left=e:r.right=e,e.parent=r):(e.parent=null,this._root=e),i=e.left,a=e.right,e===t.left?(n&&(n.left===t?(t.right?(n.left=t.right,n.left.parent=n):n.left=null,t.right=n,n.parent=t):(i?(n.right=i,i.parent=n):n.right=null,e.left=n,n.parent=e)),a?(t.left=a,a.parent=t):t.left=null,e.right=t,t.parent=e):(n&&(n.right===t?(t.left?(n.right=t.left,n.right.parent=n):n.right=null,t.left=n,n.parent=t):(a?(n.left=a,a.parent=n):n.left=null,e.right=n,n.parent=e)),i?(t.right=i,i.parent=t):t.right=null,e.left=t,t.parent=e)}},{key:"replace",value:function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}},{key:"minNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(e)for(;e.left;)e=e.left;return e}},{key:"maxNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(e)for(;e.right;)e=e.right;return e}},{key:"insert",value:function(e,t){var n=this._root,r=null,i=this._compare;if(this._noDuplicates)for(;n;){if(r=n,0===i(n.key,e))return;n=i(n.key,e)<0?n.right:n.left}else for(;n;)r=n,n=i(n.key,e)<0?n.right:n.left;return n={key:e,data:t,left:null,right:null,parent:r},r?i(r.key,n.key)<0?r.right=n:r.left=n:this._root=n,this.splay(n),this._size++,n}},{key:"find",value:function(e){for(var t=this._root,n=this._compare;t;){var r=n(t.key,e);if(r<0)t=t.right;else{if(!(r>0))return t;t=t.left}}return null}},{key:"contains",value:function(e){for(var t=this._root,n=this._compare;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1}},{key:"remove",value:function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var n=this.minNode(t.right);n.parent!==t&&(this.replace(n,n.right),n.right=t.right,n.right.parent=n),this.replace(t,n),n.left=t.left,n.left.parent=n}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}},{key:"removeNode",value:function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}},{key:"erase",value:function(e){var t=this.find(e);if(t){this.splay(t);var n=t.left,r=t.right,i=null;n&&(n.parent=null,i=this.maxNode(n),this.splay(i),this._root=i),r&&(n?i.right=r:this._root=r,r.parent=i),this._size--}}},{key:"pop",value:function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}},{key:"next",value:function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}},{key:"prev",value:function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}},{key:"forEach",value:function(e){for(var t=this._root,n=[],r=!1,i=0;!r;)t?(n.push(t),t=t.left):n.length>0?(e(t=n.pop(),i++),t=t.right):r=!0;return this}},{key:"range",value:function(e,t,n,r){for(var i=[],a=this._compare,o=this._root;0!==i.length||o;)if(o)i.push(o),o=o.left;else{if(a((o=i.pop()).key,t)>0)break;if(a(o.key,e)>=0&&n.call(r,o))return this;o=o.right}return this}},{key:"keys",value:function(){for(var e=this._root,t=[],n=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.key),e=e.right):r=!0;return n}},{key:"values",value:function(){for(var e=this._root,t=[],n=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.data),e=e.right):r=!0;return n}},{key:"at",value:function(e){for(var t=this._root,n=[],r=!1,i=0;!r;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),i===e)return t;i++,t=t.right}else r=!0;return null}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var r=e.length;return n&&GL(e,t,0,r-1,this._compare),this._root=WL(null,e,t,0,r),this._size=r,this}},{key:"min",value:function(){var e=this.minNode(this._root);return e?e.key:null}},{key:"max",value:function(){var e=this.maxNode(this._root);return e?e.key:null}},{key:"isEmpty",value:function(){return null===this._root}},{key:"size",get:function(){return this._size}}],[{key:"createTree",value:function(t,n,r,i,a){return new e(r,a).load(t,n,i)}}]),e}();function WL(e,t,n,r,i){var a=i-r;if(a>0){var o=r+Math.floor(a/2),s={key:t[o],data:n[o],parent:e};return s.left=WL(s,t,n,r,o),s.right=WL(s,t,n,o+1,i),s}return null}function GL(e,t,n,r,i){if(!(n>=r)){for(var a=e[n+r>>1],o=n-1,s=r+1;;){do{o++}while(i(e[o],a)<0);do{s--}while(i(e[s],a)>0);if(o>=s)break;var u=e[o];e[o]=e[s],e[s]=u,u=t[o],t[o]=t[s],t[s]=u}GL(e,t,n,s,i),GL(e,t,s+1,r,i)}}function ZL(e,t,n){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!YL(t,n)||t.isVertical()?t.prevInResult:t));var r=YL(e,n);e.resultTransition=r?function(e,t){var n,r=!e.inOut,i=!e.otherInOut;switch(t){case 0:n=r&&i;break;case 1:n=r||i;break;case 3:n=r^i;break;case 2:n=e.isSubject?r&&!i:i&&!r}return n?1:-1}(e,n):0}function YL(e,t){switch(e.type){case 0:switch(t){case 0:return!e.otherInOut;case 1:return e.otherInOut;case 2:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case 3:return!0}break;case 2:return 0===t||1===t;case 3:return 2===t;case 1:return!1}return!1}var XL=function(){function e(t,n,r,i,a){Bd(this,e),this.left=n,this.point=t,this.otherEvent=r,this.isSubject=i,this.type=a||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}return $d(e,[{key:"isBelow",value:function(e){var t=this.point,n=this.otherEvent.point;return this.left?(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])>0:(n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1])>0}},{key:"isAbove",value:function(e){return!this.isBelow(e)}},{key:"isVertical",value:function(){return this.point[0]===this.otherEvent.point[0]}},{key:"inResult",get:function(){return 0!==this.resultTransition}},{key:"clone",value:function(){var t=new e(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}]),e}();function KL(e,t){return e[0]===t[0]&&e[1]===t[1]}var JL=134217729;function QL(e,t,n,r,i){var a,o,s,u,l=t[0],c=r[0],h=0,d=0;c>l===c>-l?(a=l,l=t[++h]):(a=c,c=r[++d]);var f=0;if(h<e&&d<n)for(c>l===c>-l?(s=a-((o=l+a)-l),l=t[++h]):(s=a-((o=c+a)-c),c=r[++d]),a=o,0!==s&&(i[f++]=s);h<e&&d<n;)c>l===c>-l?(s=a-((o=a+l)-(u=o-a))+(l-u),l=t[++h]):(s=a-((o=a+c)-(u=o-a))+(c-u),c=r[++d]),a=o,0!==s&&(i[f++]=s);for(;h<e;)s=a-((o=a+l)-(u=o-a))+(l-u),l=t[++h],a=o,0!==s&&(i[f++]=s);for(;d<n;)s=a-((o=a+c)-(u=o-a))+(c-u),c=r[++d],a=o,0!==s&&(i[f++]=s);return 0===a&&0!==f||(i[f++]=a),f}function eI(e){return new Float64Array(e)}var tI=eI(4),nI=eI(8),rI=eI(12),iI=eI(16),aI=eI(4);function oI(e,t,n,r,i,a){var o=(t-a)*(n-i),s=(e-i)*(r-a),u=o-s;if(0===o||0===s||o>0!==s>0)return u;var l=Math.abs(o+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(e,t,n,r,i,a,o){var s,u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S,M=e-i,C=n-i,T=t-a,E=r-a;h=(x=(p=M-(f=(d=JL*M)-(d-M)))*(m=E-(v=(d=JL*E)-(d-E)))-((b=M*E)-f*v-p*v-f*m))-(g=x-(k=(p=T-(f=(d=JL*T)-(d-T)))*(m=C-(v=(d=JL*C)-(d-C)))-((w=T*C)-f*v-p*v-f*m))),tI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),tI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,tI[2]=_-(S-h)+(g-h),tI[3]=S;var P=function(e,t){for(var n=t[0],r=1;r<e;r++)n+=t[r];return n}(4,tI),A=22204460492503146e-32*o;if(P>=A||-P>=A)return P;if(s=e-(M+(h=e-M))+(h-i),l=n-(C+(h=n-C))+(h-i),u=t-(T+(h=t-T))+(h-a),c=r-(E+(h=r-E))+(h-a),0===s&&0===u&&0===l&&0===c)return P;if(A=11093356479670487e-47*o+33306690738754706e-32*Math.abs(P),(P+=M*c+E*s-(T*l+C*u))>=A||-P>=A)return P;h=(x=(p=s-(f=(d=JL*s)-(d-s)))*(m=E-(v=(d=JL*E)-(d-E)))-((b=s*E)-f*v-p*v-f*m))-(g=x-(k=(p=u-(f=(d=JL*u)-(d-u)))*(m=C-(v=(d=JL*C)-(d-C)))-((w=u*C)-f*v-p*v-f*m))),aI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),aI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,aI[2]=_-(S-h)+(g-h),aI[3]=S;var L=QL(4,tI,4,aI,nI);h=(x=(p=M-(f=(d=JL*M)-(d-M)))*(m=c-(v=(d=JL*c)-(d-c)))-((b=M*c)-f*v-p*v-f*m))-(g=x-(k=(p=T-(f=(d=JL*T)-(d-T)))*(m=l-(v=(d=JL*l)-(d-l)))-((w=T*l)-f*v-p*v-f*m))),aI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),aI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,aI[2]=_-(S-h)+(g-h),aI[3]=S;var I=QL(L,nI,4,aI,rI);h=(x=(p=s-(f=(d=JL*s)-(d-s)))*(m=c-(v=(d=JL*c)-(d-c)))-((b=s*c)-f*v-p*v-f*m))-(g=x-(k=(p=u-(f=(d=JL*u)-(d-u)))*(m=l-(v=(d=JL*l)-(d-l)))-((w=u*l)-f*v-p*v-f*m))),aI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),aI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,aI[2]=_-(S-h)+(g-h),aI[3]=S;var R=QL(I,rI,4,aI,iI);return iI[R-1]}(e,t,n,r,i,a,l)}function sI(e,t,n){var r=oI(e[0],e[1],t[0],t[1],n[0],n[1]);return r>0?-1:r<0?1:0}function uI(e,t){var n=e.point,r=t.point;return n[0]>r[0]?1:n[0]<r[0]?-1:n[1]!==r[1]?n[1]>r[1]?1:-1:function(e,t,n,r){if(e.left!==t.left)return e.left?1:-1;if(0!==sI(n,e.otherEvent.point,t.otherEvent.point))return e.isBelow(t.otherEvent.point)?-1:1;return!e.isSubject&&t.isSubject?1:-1}(e,t,n)}function lI(e,t,n){var r=new XL(t,!1,e,e.isSubject),i=new XL(t,!0,e.otherEvent,e.isSubject);return KL(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),r.contourId=i.contourId=e.contourId,uI(i,e.otherEvent)>0&&(e.otherEvent.left=!0,i.left=!1),e.otherEvent.otherEvent=i,e.otherEvent=r,n.push(i),n.push(r),n}function cI(e,t){return e[0]*t[1]-e[1]*t[0]}function hI(e,t){return e[0]*t[0]+e[1]*t[1]}function dI(e,t,n){var r=function(e,t,n,r,i){var a=[t[0]-e[0],t[1]-e[1]],o=[r[0]-n[0],r[1]-n[1]];function s(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}var u=[n[0]-e[0],n[1]-e[1]],l=cI(a,o),c=l*l,h=hI(a,a);if(c>0){var d=cI(u,o)/l;if(d<0||d>1)return null;var f=cI(u,a)/l;return f<0||f>1?null:0===d||1===d?i?null:[s(e,d,a)]:0===f||1===f?i?null:[s(n,f,o)]:[s(e,d,a)]}if((c=(l=cI(u,a))*l)>0)return null;var p=hI(a,u)/h,v=p+hI(a,o)/h,m=Math.min(p,v),g=Math.max(p,v);return m<=1&&g>=0?1===m?i?null:[s(e,m>0?m:0,a)]:0===g?i?null:[s(e,g<1?g:1,a)]:i&&0===m&&1===g?null:[s(e,m>0?m:0,a),s(e,g<1?g:1,a)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),i=r?r.length:0;if(0===i)return 0;if(1===i&&(KL(e.point,t.point)||KL(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===i&&e.isSubject===t.isSubject)return 0;if(1===i)return KL(e.point,r[0])||KL(e.otherEvent.point,r[0])||lI(e,r[0],n),KL(t.point,r[0])||KL(t.otherEvent.point,r[0])||lI(t,r[0],n),1;var a=[],o=!1,s=!1;return KL(e.point,t.point)?o=!0:1===uI(e,t)?a.push(t,e):a.push(e,t),KL(e.otherEvent.point,t.otherEvent.point)?s=!0:1===uI(e.otherEvent,t.otherEvent)?a.push(t.otherEvent,e.otherEvent):a.push(e.otherEvent,t.otherEvent),o&&s||o?(t.type=1,e.type=t.inOut===e.inOut?2:3,o&&!s&&lI(a[1].otherEvent,a[0].point,n),2):s?(lI(a[0],a[1].point,n),3):a[0]!==a[3].otherEvent?(lI(a[0],a[1].point,n),lI(a[1],a[2].point,n),3):(lI(a[0],a[1].point,n),lI(a[3].otherEvent,a[2].point,n),3)}function fI(e,t){if(e===t)return 0;if(0!==sI(e.point,e.otherEvent.point,t.point)||0!==sI(e.point,e.otherEvent.point,t.otherEvent.point))return KL(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===uI(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var n=e.point,r=t.point;return n[0]===r[0]&&n[1]===r[1]?(n=e.otherEvent.point,r=t.otherEvent.point,n[0]===r[0]&&n[1]===r[1]?0:e.contourId>t.contourId?1:-1):1===uI(e,t)?1:-1}var pI=function(){function e(){Bd(this,e),this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}return $d(e,[{key:"isExterior",value:function(){return null==this.holeOf}}]),e}();function vI(e,t,n,r){var i,a=e+1,o=t[e].point,s=t.length;for(a<s&&(i=t[a].point);a<s&&i[0]===o[0]&&i[1]===o[1];){if(!n[a])return a;i=t[++a].point}for(a=e-1;n[a]&&a>r;)a--;return a}function mI(e){var t,n,r=function(e){var t,n,r,i,a=[];for(n=0,r=e.length;n<r;n++)((t=e[n]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&a.push(t);for(var o=!1;!o;)for(o=!0,n=0,r=a.length;n<r;n++)n+1<r&&1===uI(a[n],a[n+1])&&(i=a[n],a[n]=a[n+1],a[n+1]=i,o=!1);for(n=0,r=a.length;n<r;n++)(t=a[n]).otherPos=n;for(n=0,r=a.length;n<r;n++)(t=a[n]).left||(i=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=i);return a}(e),i={},a=[],o=function(){if(i[t])return"continue";var e=a.length,n=function(e,t,n){var r=new pI;if(null!=e.prevInResult){var i=e.prevInResult,a=i.outputContourId;if(i.resultTransition>0){var o=t[a];if(null!=o.holeOf){var s=o.holeOf;t[s].holeIds.push(n),r.holeOf=s,r.depth=t[a].depth}else t[a].holeIds.push(n),r.holeOf=a,r.depth=t[a].depth+1}else r.holeOf=null,r.depth=t[a].depth}else r.holeOf=null,r.depth=0;return r}(r[t],a,e),o=function(t){i[t]=!0,r[t].outputContourId=e},s=t,u=t,l=r[t].point;for(n.points.push(l);o(s),o(s=r[s].otherPos),n.points.push(r[s].point),(s=vI(s,r,i,u))!=u;);a.push(n)};for(t=0,n=r.length;t<n;t++)o();return a}var gI={exports:{}};function _I(e,t){if(!(this instanceof _I))return new _I(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||yI,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function yI(e,t){return e<t?-1:e>t?1:0}gI.exports=_I,gI.exports.default=_I,_I.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r},_down:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var a=1+(e<<1),o=a+1,s=t[a];if(o<this.length&&n(t[o],s)<0&&(a=o,s=t[o]),n(s,i)>=0)break;t[e]=s,e=a}t[e]=i}};var bI=gI.exports,xI=Math.max,wI=Math.min,kI=0;function SI(e,t,n,r,i,a){var o,s,u,l,c,h;for(o=0,s=e.length-1;o<s;o++)if(u=e[o],l=e[o+1],c=new XL(u,!1,void 0,t),h=new XL(l,!1,c,t),c.otherEvent=h,u[0]!==l[0]||u[1]!==l[1]){c.contourId=h.contourId=n,a||(c.isExteriorRing=!1,h.isExteriorRing=!1),uI(c,h)>0?h.left=!0:c.left=!0;var d=u[0],f=u[1];i[0]=wI(i[0],d),i[1]=wI(i[1],f),i[2]=xI(i[2],d),i[3]=xI(i[3],f),r.push(c),r.push(h)}}var MI=[];function CI(e,t,n){"number"===typeof e[0][0][0]&&(e=[e]),"number"===typeof t[0][0][0]&&(t=[t]);var r=function(e,t,n){var r=null;return e.length*t.length===0&&(0===n?r=MI:2===n?r=e:1!==n&&3!==n||(r=0===e.length?t:e)),r}(e,t,n);if(r)return r===MI?null:r;var i=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],o=function(e,t,n,r,i){var a,o,s,u,l,c,h=new bI(null,uI);for(s=0,u=e.length;s<u;s++)for(l=0,c=(a=e[s]).length;l<c;l++)(o=0===l)&&kI++,SI(a[l],!0,kI,h,n,o);for(s=0,u=t.length;s<u;s++)for(l=0,c=(a=t[s]).length;l<c;l++)o=0===l,2===i&&(o=!1),o&&kI++,SI(a[l],!1,kI,h,r,o);return h}(e,t,i,a,n);if(r=function(e,t,n,r,i){var a=null;return(n[0]>r[2]||r[0]>n[2]||n[1]>r[3]||r[1]>n[3])&&(0===i?a=MI:2===i?a=e:1!==i&&3!==i||(a=e.concat(t))),a}(e,t,i,a,n),r)return r===MI?null:r;for(var s=function(e,t,n,r,i,a){for(var o,s,u,l=new HL(fI),c=[],h=Math.min(r[2],i[2]);0!==e.length;){var d=e.pop();if(c.push(d),0===a&&d.point[0]>h||2===a&&d.point[0]>r[2])break;if(d.left){s=o=l.insert(d),o=o!==(u=l.minNode())?l.prev(o):null,s=l.next(s);var f=o?o.key:null;if(ZL(d,f,a),s&&2===dI(d,s.key,e)&&(ZL(d,f,a),ZL(d,s.key,a)),o&&2===dI(o.key,d,e)){var p=o;ZL(f,(p=p!==u?l.prev(p):null)?p.key:null,a),ZL(d,f,a)}}else d=d.otherEvent,s=o=l.find(d),o&&s&&(o=o!==u?l.prev(o):null,s=l.next(s),l.remove(d),s&&o&&dI(o.key,s.key,e))}return c}(o,0,0,i,a,n),u=mI(s),l=[],c=0;c<u.length;c++){var h=u[c];if(h.isExterior()){for(var d=[h.points],f=0;f<h.holeIds.length;f++){var p=h.holeIds[f];d.push(u[p].points)}l.push(d)}}return l}var TI,EI,PI=function(e){Dd(n,e);var t=zd(n);function n(){var e;return Bd(this,n),(e=t.call(this))._subsampleThreshold=.005,e}return $d(n,[{key:"_getPoleOfInaccessibility2d",value:function(e){return UL([e],.03)}},{key:"_project",value:function(e,t){var n=this._createCamera(t.upVector().toArray(),t.unprojectSfM([0,0],0),t.unprojectSfM([0,0],10));return this._deunproject(e,t,n)}},{key:"_subsample",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._subsampleThreshold,n=[],r=e.length,i=0;i<r;i++){var a=e[i],o=e[(i+1)%r];n.push(a);for(var s=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)),u=Math.floor(s/t),l=1/(u+1),c=1;c<=u;c++){var h=c*l,d=[(1-h)*a[0]+h*o[0],(1-h)*a[1]+h*o[1]];n.push(d)}}return n}},{key:"_triangulate",value:function(e,t,n,r){var i,a=[e.slice(0,-1)],o=Ad(null!=n?n:[]);try{for(o.s();!(i=o.n()).done;){var s=i.value;a.push(s.slice(0,-1))}}catch(CO){o.e(CO)}finally{o.f()}var u,l=t.slice(0,-1),c=Ad(null!=r?r:[]);try{for(c.s();!(u=c.n()).done;){var h=u.value;l=l.concat(h.slice(0,-1))}}catch(CO){c.e(CO)}finally{c.f()}for(var d=OL.flatten(a),f=OL(d.vertices,d.holes,d.dimensions),p=[],v=0;v<f.length;++v){var m=l[f[v]];p.push(m[0]),p.push(m[1]),p.push(m[2])}return p}},{key:"_triangulateSpherical",value:function(e,t,n){for(var r=[],i=1e-9,a=0;a<3;a++)for(var o=0;o<3;o++){var s=a/3+(0===a?-1e-9:i),u=o/3+(0===o?-1e-9:i),l=(a+1)/3+i,c=(o+1)/3+i,h=[[s,u],[s,c],[l,c],[l,u],[s,u]],d=[(2*a+1)/6,(2*o+1)/6];r.push.apply(r,xd(this._triangulateSubarea(e,t,h,d,n)))}return r}},{key:"_unproject",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;return e.map((function(e){return t.unprojectBasic(e,n)}))}},{key:"_createCamera",value:function(e,t,n){var r=new Q_;return r.up.copy((new Vm).fromArray(e)),r.position.copy((new Vm).fromArray(t)),r.lookAt((new Vm).fromArray(n)),r.updateMatrix(),r.updateMatrixWorld(!0),r}},{key:"_deunproject",value:function(e,t,n){return e.map((function(e){var r=t.unprojectBasic(e,1e4),i=new Vm(r[0],r[1],r[2]).applyMatrix4(n.matrixWorldInverse);return[i.x/i.z,i.y/i.z]}))}},{key:"_triangulateSubarea",value:function(e,t,n,r,i){var a=CI([e].concat(xd(t)),[n],0);if(!a)return[];var o,s=[],u=this._subsampleThreshold,l=this._createCamera(i.upVector().toArray(),i.unprojectSfM([0,0],0),i.unprojectBasic(r,10)),c=Ad(a);try{for(c.s();!(o=c.n()).done;){for(var h=o.value,d=this._subsample(h[0],u),f=this._deunproject(d,i,l),p=this._unproject(d,i),v=[],m=[],g=1;g<h.length;g++){var _=this._subsample(h[g],u),y=this._deunproject(_,i,l),b=this._unproject(_,i);v.push(y),m.push(b)}s.push.apply(s,xd(this._triangulate(f,p,v,m)))}}catch(CO){c.e(CO)}finally{c.f()}return s}}]),n}(rL),AI=function(e){Dd(n,e);var t=zd(n);function n(e){var r;if(Bd(this,n),r=t.call(this),4!==e.length)throw new iL("Rectangle needs to have four values.");if(e[1]>e[3])throw new iL("Basic Y coordinates values can not be inverted.");var i,a=Ad(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o<0||o>1)throw new iL("Basic coordinates must be on the interval [0, 1].")}}catch(CO){a.e(CO)}finally{a.f()}return r._anchorIndex=void 0,r._rect=e.slice(0,4),r._inverted=r._rect[0]>r._rect[2],r}return $d(n,[{key:"anchorIndex",get:function(){return this._anchorIndex}},{key:"inverted",get:function(){return this._inverted}},{key:"rect",get:function(){return this._rect}},{key:"initializeAnchorIndexing",value:function(e){if(void 0!==this._anchorIndex)throw new iL("Anchor indexing is already initialized.");if(e<0||e>3)throw new iL("Invalid anchor index: ".concat(e,"."));this._anchorIndex=void 0===e?0:e}},{key:"terminateAnchorIndexing",value:function(){this._anchorIndex=void 0}},{key:"setOppositeVertex2d",value:function(e,t){if(void 0===this._anchorIndex)throw new iL("Anchor indexing needs to be initialized.");var n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],r=this._rect.slice(),i=0===this._anchorIndex?[r[0],r[3]]:1===this._anchorIndex?[r[0],r[1]]:2===this._anchorIndex?[r[2],r[1]]:[r[2],r[3]];if(ZM(t.cameraType)){var a=this._anchorIndex<2?n[0]-r[2]:n[0]-r[0];!this._inverted&&this._anchorIndex<2&&n[0]<.25&&r[2]>.75&&a<-.5||!this._inverted&&this._anchorIndex>=2&&n[0]<.25&&r[2]>.75&&a<-.5?(this._inverted=!0,this._anchorIndex=i[1]>n[1]?0:1):this._inverted&&this._anchorIndex>=2&&n[0]<.25&&r[0]>.75&&a<-.5?(this._inverted=!1,this._anchorIndex=i[0]>n[0]?i[1]>n[1]?3:2:i[1]>n[1]?0:1):!this._inverted&&this._anchorIndex>=2&&n[0]>.75&&r[0]<.25&&a>.5||!this._inverted&&this._anchorIndex<2&&n[0]>.75&&r[0]<.25&&a>.5?(this._inverted=!0,this._anchorIndex=i[1]>n[1]?3:2):this._inverted&&this._anchorIndex<2&&n[0]>.75&&r[2]<.25&&a>.5?(this._inverted=!1,this._anchorIndex=i[0]>n[0]?i[1]>n[1]?3:2:i[1]>n[1]?0:1):this._inverted&&this._anchorIndex<2&&n[0]>r[0]?(this._inverted=!1,this._anchorIndex=i[1]>n[1]?0:1):this._inverted&&this._anchorIndex>=2&&n[0]<r[2]?(this._inverted=!1,this._anchorIndex=i[1]>n[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=i[1]>n[1]?0:1:this._anchorIndex=i[1]>n[1]?3:2:this._anchorIndex=i[0]<=n[0]&&i[1]>n[1]?0:i[0]<=n[0]&&i[1]<=n[1]?1:i[0]>n[0]&&i[1]<=n[1]?2:3;var o=[];0===this._anchorIndex?(o[0]=i[0],o[1]=n[1],o[2]=n[0],o[3]=i[1]):1===this._anchorIndex?(o[0]=i[0],o[1]=i[1],o[2]=n[0],o[3]=n[1]):2===this._anchorIndex?(o[0]=n[0],o[1]=i[1],o[2]=i[0],o[3]=n[1]):(o[0]=n[0],o[1]=n[1],o[2]=i[0],o[3]=i[1]),(!this._inverted&&o[0]>o[2]||this._inverted&&o[0]<o[2])&&(o[0]=r[0],o[2]=r[2]),o[1]>o[3]&&(o[1]=r[1],o[3]=r[3]),this._rect[0]=o[0],this._rect[1]=o[1],this._rect[2]=o[2],this._rect[3]=o[3]}else{this._anchorIndex=i[0]<=n[0]&&i[1]>n[1]?0:i[0]<=n[0]&&i[1]<=n[1]?1:i[0]>n[0]&&i[1]<=n[1]?2:3;var s=[];0===this._anchorIndex?(s[0]=i[0],s[1]=n[1],s[2]=n[0],s[3]=i[1]):1===this._anchorIndex?(s[0]=i[0],s[1]=i[1],s[2]=n[0],s[3]=n[1]):2===this._anchorIndex?(s[0]=n[0],s[1]=i[1],s[2]=i[0],s[3]=n[1]):(s[0]=n[0],s[1]=n[1],s[2]=i[0],s[3]=i[1]),s[0]>s[2]&&(s[0]=r[0],s[2]=r[2]),s[1]>s[3]&&(s[1]=r[1],s[3]=r[3]),this._rect[0]=s[0],this._rect[1]=s[1],this._rect[2]=s[2],this._rect[3]=s[3]}this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(e,t,n){var r=this._rect.slice(),i=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],a=[];if(0===e?(a[0]=i[0],a[1]=r[1],a[2]=r[2],a[3]=i[1]):1===e?(a[0]=i[0],a[1]=i[1],a[2]=r[2],a[3]=r[3]):2===e?(a[0]=r[0],a[1]=i[1],a[2]=i[0],a[3]=r[3]):3===e&&(a[0]=r[0],a[1]=r[1],a[2]=i[0],a[3]=i[1]),ZM(n.cameraType)){var o=e<2&&i[0]>.75&&r[0]<.25||e>=2&&this._inverted&&i[0]>.75&&r[2]<.25,s=e<2&&this._inverted&&i[0]<.25&&r[0]>.75||e>=2&&i[0]<.25&&r[2]>.75;o||s?this._inverted=!this._inverted:(a[0]-r[0]<-.25&&(a[0]=r[0]),a[2]-r[2]>.25&&(a[2]=r[2])),(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2])&&(a[0]=r[0],a[2]=r[2])}else a[0]>a[2]&&(a[0]=r[0],a[2]=r[2]);a[1]>a[3]&&(a[1]=r[1],a[3]=r[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3],this._notifyChanged$.next(this)}},{key:"setCentroid2d",value:function(e,t){var n=this._rect.slice(),r=n[0],i=this._inverted?n[2]+1:n[2],a=n[1],o=n[3],s=r+(i-r)/2,u=a+(o-a)/2,l=0;if(ZM(t.cameraType))l=this._inverted?e[0]+1-s:e[0]-s;else{var c=-r,h=1-i;l=Math.max(c,Math.min(h,e[0]-s))}var d=-a,f=1-o,p=Math.max(d,Math.min(f,e[1]-u));this._rect[0]=n[0]+l,this._rect[1]=n[1]+p,this._rect[2]=n[2]+l,this._rect[3]=n[3]+p,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(e){return this._getPoints2d().map((function(t){return e.unprojectBasic(t,200)}))}},{key:"getVertex2d",value:function(e){return this._rectToVertices2d(this._rect)[e]}},{key:"getNonAdjustedVertex2d",value:function(e){return this._rectToNonAdjustedVertices2d(this._rect)[e]}},{key:"getVertex3d",value:function(e,t){return t.unprojectBasic(this._rectToVertices2d(this._rect)[e],200)}},{key:"getVertices2d",value:function(){return this._rectToVertices2d(this._rect)}},{key:"getVertices3d",value:function(e){return this._rectToVertices2d(this._rect).map((function(t){return e.unprojectBasic(t,200)}))}},{key:"getCentroid2d",value:function(){var e=this._rect;return[(e[0]+(this._inverted?e[2]+1:e[2]))/2,(e[1]+e[3])/2]}},{key:"getCentroid3d",value:function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)}},{key:"getPoleOfInaccessibility2d",value:function(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}},{key:"getPoleOfInaccessibility3d",value:function(e){var t=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return e.unprojectBasic(t,200)}},{key:"getTriangles3d",value:function(e){return ZM(e.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),e),this.getPoints3d(e))}},{key:"validate",value:function(e){var t=this._rect;return!(!this._inverted&&e[0]<t[0]||e[0]-t[2]>.25||e[1]<t[1])}},{key:"_getPoints2d",value:function(){for(var e=this._rectToVertices2d(this._rect),t=e.length-1,n=[],r=0;r<t;++r)for(var i=e[r][0],a=e[r][1],o=(e[r+1][0]-i)/9,s=(e[r+1][1]-a)/9,u=0;u<10;++u){var l=[i+u*o,a+u*s];n.push(l)}return n}},{key:"_rectToVertices2d",value:function(e){return[[e[0],e[3]],[e[0],e[1]],[this._inverted?e[2]+1:e[2],e[1]],[this._inverted?e[2]+1:e[2],e[3]],[e[0],e[3]]]}},{key:"_rectToNonAdjustedVertices2d",value:function(e){return[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}}]),n}(PI),LI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,i,a))._options={color:null==r.color?16777215:r.color,indicateCompleter:null==r.indicateCompleter||r.indicateCompleter},o._rectGeometry=new AI(o._geometry.getRect2d(i)),o._createGlObjects(),o}return $d(n,[{key:"create",value:function(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}},{key:"dispose",value:function(){Nd(wd(n.prototype),"dispose",this).call(this),this._disposeObjects()}},{key:"getDOMObjects",value:function(e,t){for(var n=this,r={offsetHeight:t.height,offsetWidth:t.width},i=[],a=this._geometry.getPoints2d(),s=a.length,u=function(t){var u=t,l=o(a[t],2),c=l[0],h=l[1],d=n._viewportCoords.basicToCanvasSafe(c,h,r,n._transform,e);if(!d)return"continue";var f=n._canvasToTransform(d),p={onclick:0===t&&s<3?function(e){e.stopPropagation(),n._aborted$.next(n)}:function(e){e.stopPropagation(),n._geometry.removePoint2d(u)},style:{transform:f}};i.push(yP.h("div.mapillary-tag-interactor",p,[]));var v={style:{background:n._colorToBackground(n._options.color),transform:f}};i.push(yP.h("div.mapillary-tag-vertex",v,[]))},l=0;l<s-1;l++)u(l);if(s>2&&!0===this._options.indicateCompleter){var c=o(this._geometry.getCentroid2d(this._transform),2),h=c[0],d=c[1],f=this._viewportCoords.basicToCanvasSafe(h,d,r,this._transform,e);if(f){var p=this._canvasToTransform(f),v={onclick:function(e){e.stopPropagation(),n._geometry.removePoint2d(n._geometry.points.length-1),n._created$.next(n)},style:{transform:p}};i.push(yP.h("div.mapillary-tag-completer.mapillary-tag-larger",v,[]));var m={style:{background:this._colorToBackground(this._options.color),transform:p}};i.push(yP.h("div.mapillary-tag-vertex.mapillary-tag-larger",m,[]));var g={style:{transform:p}};i.push(yP.h("div.mapillary-tag-dot",g,[]))}}return i}},{key:"_onGeometryChanged",value:function(){this._disposeObjects(),this._rectGeometry=new AI(this._geometry.getRect2d(this._transform)),this._createGlObjects()}},{key:"_createGlObjects",value:function(){this._glObjects=[];var e=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects.push(this._outline)}},{key:"_disposeObjects",value:function(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}]),n}(oL),II=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;Bd(this,n),i=t.call(this);var a=e.length;if(a<3)throw new iL("A polygon must have three or more positions.");if(e[0][0]!==e[a-1][0]||e[0][1]!==e[a-1][1])throw new iL("First and last positions must be equivalent.");i._polygon=[];var o,s=Ad(e);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u[0]<0||u[0]>1||u[1]<0||u[1]>1)throw new iL("Basic coordinates of polygon must be on the interval [0, 1].");i._polygon.push(u.slice())}}catch(CO){s.e(CO)}finally{s.f()}if(i._holes=[],null==r)return Rd(i);for(var l=0;l<r.length;l++){var c=r[l],h=c.length;if(h<3)throw new iL("A polygon hole must have three or more positions.");if(c[0][0]!==c[h-1][0]||c[0][1]!==c[h-1][1])throw new iL("First and last positions of hole must be equivalent.");i._holes.push([]);var d,f=Ad(c);try{for(f.s();!(d=f.n()).done;){var p=d.value;if(p[0]<0||p[0]>1||p[1]<0||p[1]>1)throw new iL("Basic coordinates of hole must be on the interval [0, 1].");i._holes[l].push(p.slice())}}catch(CO){f.e(CO)}finally{f.f()}}return i}return $d(n,[{key:"polygon",get:function(){return this._polygon}},{key:"holes",get:function(){return this._holes}},{key:"addVertex2d",value:function(e){var t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._polygon.splice(this._polygon.length-1,0,t),this._notifyChanged$.next(this)}},{key:"getVertex2d",value:function(e){return this._polygon[e].slice()}},{key:"removeVertex2d",value:function(e){if(e<0||e>=this._polygon.length||this._polygon.length<4)throw new iL("Index for removed vertex must be valid.");if(e>0&&e<this._polygon.length-1)this._polygon.splice(e,1);else{this._polygon.splice(0,1),this._polygon.pop();var t=this._polygon[0].slice();this._polygon.push(t)}this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(e,t,n){var r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];0===e||e===this._polygon.length-1?(this._polygon[0]=r.slice(),this._polygon[this._polygon.length-1]=r.slice()):this._polygon[e]=r.slice(),this._notifyChanged$.next(this)}},{key:"setCentroid2d",value:function(e,t){var n,r=this._polygon.map((function(e){return e[0]})),i=this._polygon.map((function(e){return e[1]})),a=Math.min.apply(Math,r),o=Math.max.apply(Math,r),s=Math.min.apply(Math,i),u=Math.max.apply(Math,i),l=this.getCentroid2d(),c=-a,h=1-o,d=-s,f=1-u,p=Math.max(c,Math.min(h,e[0]-l[0])),v=Math.max(d,Math.min(f,e[1]-l[1])),m=Ad(this._polygon);try{for(m.s();!(n=m.n()).done;){var g=n.value;g[0]+=p,g[1]+=v}}catch(CO){m.e(CO)}finally{m.f()}this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(e){return this._getPoints3d(this._subsample(this._polygon),e)}},{key:"getVertex3d",value:function(e,t){return t.unprojectBasic(this._polygon[e],200)}},{key:"getVertices2d",value:function(){return this._polygon.slice()}},{key:"getVertices3d",value:function(e){return this._getPoints3d(this._polygon,e)}},{key:"getHolePoints3d",value:function(e){var t=this;return this._holes.map((function(n){return t._getPoints3d(t._subsample(n),e)}))}},{key:"getHoleVertices3d",value:function(e){var t=this;return this._holes.map((function(n){return t._getPoints3d(n,e)}))}},{key:"getCentroid2d",value:function(){for(var e=this._polygon,t=0,n=0,r=0,i=0;i<e.length-1;i++){var a=e[i][0],o=e[i][1],s=e[i+1][0],u=e[i+1][1],l=a*u-s*o;t+=l,n+=(a+s)*l,r+=(o+u)*l}return[n/=6*(t/=2),r/=6*t]}},{key:"getCentroid3d",value:function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)}},{key:"get3dDomainTriangles3d",value:function(e){var t=this;return this._triangulate(this._project(this._polygon,e),this.getVertices3d(e),this._holes.map((function(n){return t._project(n,e)})),this.getHoleVertices3d(e))}},{key:"getTriangles3d",value:function(e){var t=this;if(ZM(e.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),e);var n=this._project(this._subsample(this._polygon),e),r=this.getPoints3d(e),i=this._holes.map((function(n){return t._project(t._subsample(n),e)})),a=this.getHolePoints3d(e);return this._triangulate(n,r,i,a)}},{key:"getPoleOfInaccessibility2d",value:function(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}},{key:"getPoleOfInaccessibility3d",value:function(e){var t=this._getPoleOfInaccessibility2d(this._polygon.slice());return e.unprojectBasic(t,200)}},{key:"_getPoints3d",value:function(e,t){return e.map((function(e){return t.unprojectBasic(e,200)}))}}]),n}(PI),RI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,i,a))._options={color:null==r.color?16777215:r.color},o._createGlObjects(),o}return $d(n,[{key:"create",value:function(){if(this._geometry instanceof AI)this._created$.next(this);else if(this._geometry instanceof II){var e=this._geometry;e.removeVertex2d(e.polygon.length-2),this._created$.next(this)}}},{key:"dispose",value:function(){Nd(wd(n.prototype),"dispose",this).call(this),this._disposeLine(this._outline),this._disposeObjects()}},{key:"getDOMObjects",value:function(e,t){var n=this,r=[],i={offsetHeight:t.height,offsetWidth:t.width},a=function(e){e.stopPropagation(),n._aborted$.next(n)};if(this._geometry instanceof AI){var s=this._geometry.anchorIndex,u=void 0===s?1:s,l=o(this._geometry.getVertex2d(u),2),c=l[0],h=l[1],d=this._viewportCoords.basicToCanvasSafe(c,h,i,this._transform,e);if(null!=d){var f=this._colorToBackground(this._options.color),p=this._canvasToTransform(d),v={style:{background:f,transform:p}},m={onclick:a,style:{transform:p}};r.push(yP.h("div.mapillary-tag-interactor",m,[])),r.push(yP.h("div.mapillary-tag-vertex",v,[]))}}else if(this._geometry instanceof II){var g=this._geometry,_=o(g.getVertex2d(0),2),y=_[0],b=_[1],x=this._viewportCoords.basicToCanvasSafe(y,b,i,this._transform,e);if(null!=x){var w={onclick:g.polygon.length>4?function(e){e.stopPropagation(),g.removeVertex2d(g.polygon.length-2),n._created$.next(n)}:a,style:{transform:this._canvasToTransform(x)}},k=g.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";r.push(yP.h("div."+k,w,[]))}if(g.polygon.length>3){var S=o(g.getVertex2d(g.polygon.length-3),2),M=S[0],C=S[1],T=this._viewportCoords.basicToCanvasSafe(M,C,i,this._transform,e);if(null!=T){var E={onclick:function(e){e.stopPropagation(),g.removeVertex2d(g.polygon.length-3)},style:{transform:this._canvasToTransform(T)}};r.push(yP.h("div.mapillary-tag-interactor",E,[]))}}var P=g.polygon.slice();P.splice(-2,2);var A,L=Ad(P);try{for(L.s();!(A=L.n()).done;){var I=A.value,R=this._viewportCoords.basicToCanvasSafe(I[0],I[1],i,this._transform,e);if(null!=R){var O={style:{background:this._colorToBackground(this._options.color),transform:this._canvasToTransform(R)}};r.push(yP.h("div.mapillary-tag-vertex",O,[]))}}}catch(CO){L.e(CO)}finally{L.f()}}return r}},{key:"addPoint",value:function(e){if(this._geometry instanceof AI){if(!this._geometry.validate(e))return;this._created$.next(this)}else if(this._geometry instanceof II){this._geometry.addVertex2d(e)}}},{key:"_onGeometryChanged",value:function(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}},{key:"_disposeObjects",value:function(){this._outline=null,this._glObjects=[]}},{key:"_createGlObjects",value:function(){var e=this._geometry instanceof AI?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects=[this._outline]}}]),n}(oL),OI=function(){function e(t,n){Bd(this,e),this._component=t,this._navigator=n,this._tagOperation$=new If,this._createPoints$=new If,this._createPolygon$=new If,this._createRect$=new If,this._delete$=new If,this._tag$=this._tagOperation$.pipe(xv((function(e,t){return t(e)}),null),wv()),this._replayedTag$=this._tag$.pipe(yv(1),Pf()),this._replayedTag$.subscribe(),this._createPoints$.pipe(Lv(this._component.configuration$,this._navigator.stateService.currentTransform$),wp((function(e){var t=o(e,3),n=t[0],r=t[1],i=t[2];return function(){var e=new aL([[n[0],n[1]],[n[0],n[1]]]);return new LI(e,{color:r.createColor,indicateCompleter:r.indicatePointsCompleter},i)}}))).subscribe(this._tagOperation$),this._createRect$.pipe(Lv(this._component.configuration$,this._navigator.stateService.currentTransform$),wp((function(e){var t=o(e,3),n=t[0],r=t[1],i=t[2];return function(){var e=new AI([n[0],n[1],n[0],n[1]]);return new RI(e,{color:r.createColor},i)}}))).subscribe(this._tagOperation$),this._createPolygon$.pipe(Lv(this._component.configuration$,this._navigator.stateService.currentTransform$),wp((function(e){var t=o(e,3),n=t[0],r=t[1],i=t[2];return function(){var e=new II([[n[0],n[1]],[n[0],n[1]],[n[0],n[1]]]);return new RI(e,{color:r.createColor},i)}}))).subscribe(this._tagOperation$),this._delete$.pipe(wp((function(){return function(){return null}}))).subscribe(this._tagOperation$)}return $d(e,[{key:"createRect$",get:function(){return this._createRect$}},{key:"createPolygon$",get:function(){return this._createPolygon$}},{key:"createPoints$",get:function(){return this._createPoints$}},{key:"delete$",get:function(){return this._delete$}},{key:"tag$",get:function(){return this._tag$}},{key:"replayedTag$",get:function(){return this._replayedTag$}}]),e}(),NI=function(){function e(){Bd(this,e)}return $d(e,[{key:"render",value:function(e,t,n,r,i){var a,o=[],s=Ad(e);try{for(s.s();!(a=s.n()).done;){var u=a.value;o=o.concat(u.getDOMObjects(n,r,i))}}catch(CO){s.e(CO)}finally{s.f()}return null!=t&&(o=o.concat(t.getDOMObjects(r,i))),yP.h("div.mapillary-tag-container",{},o)}},{key:"clear",value:function(){return yP.h("div",{},[])}}]),e}(),DI=function(){function e(t,n){Bd(this,e),this._createTag=null,this._needsRender=!1,this._raycaster=n||new yM,this._scene=t||new tw,this._objectTags={},this._retrievableObjects=[],this._tags={}}return $d(e,[{key:"needsRender",get:function(){return this._needsRender}},{key:"add",value:function(e){var t,n=Ad(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.tag.id in this._tags&&this._remove(r.tag.id),this._add(r)}}catch(CO){n.e(CO)}finally{n.f()}this._needsRender=!0}},{key:"addCreateTag",value:function(e){var t,n=Ad(e.glObjects);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._scene.add(r)}}catch(CO){n.e(CO)}finally{n.f()}this._createTag={tag:e,objects:e.glObjects},this._needsRender=!0}},{key:"clear",value:function(){for(var e=0,t=Object.keys(this._tags);e<t.length;e++){var n=t[e];this._remove(n)}this._needsRender=!1}},{key:"get",value:function(e){return this.has(e)?this._tags[e].tag:void 0}},{key:"has",value:function(e){return e in this._tags}},{key:"hasCreateTag",value:function(){return null!=this._createTag}},{key:"intersectObjects",value:function(e,t){var n=o(e,2),r=n[0],i=n[1];this._raycaster.setFromCamera(new Pm(r,i),t);var a,s=[],u=Ad(this._raycaster.intersectObjects(this._retrievableObjects));try{for(u.s();!(a=u.n()).done;){var l=a.value;l.object.uuid in this._objectTags&&s.push(this._objectTags[l.object.uuid])}}catch(CO){u.e(CO)}finally{u.f()}return s}},{key:"remove",value:function(e){var t,n=Ad(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._remove(r)}}catch(CO){n.e(CO)}finally{n.f()}this._needsRender=!0}},{key:"removeAll",value:function(){for(var e=0,t=Object.keys(this._tags);e<t.length;e++){var n=t[e];this._remove(n)}this._needsRender=!0}},{key:"removeCreateTag",value:function(){if(null!=this._createTag){var e,t=Ad(this._createTag.objects);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._scene.remove(n)}}catch(CO){t.e(CO)}finally{t.f()}this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}},{key:"render",value:function(e,t){t.render(this._scene,e),this._needsRender=!1}},{key:"update",value:function(){this._needsRender=!0}},{key:"updateCreateTagObjects",value:function(e){if(this._createTag.tag!==e)throw new Error("Create tags do not have the same reference.");var t,n=Ad(this._createTag.objects);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._scene.remove(r)}}catch(CO){n.e(CO)}finally{n.f()}var i,a=Ad(e.glObjects);try{for(a.s();!(i=a.n()).done;){var o=i.value;this._scene.add(o)}}catch(CO){a.e(CO)}finally{a.f()}this._createTag.objects=e.glObjects,this._needsRender=!0}},{key:"updateObjects",value:function(e){var t=e.tag.id;if(this._tags[t].tag!==e)throw new Error("Tags do not have the same reference.");var n=this._tags[t];this._removeObjects(n),delete this._tags[t],this._add(e),this._needsRender=!0}},{key:"_add",value:function(e){var t=e.tag.id,n={tag:e,objects:[],retrievableObjects:[]};this._tags[t]=n;var r,i=Ad(e.getGLObjects());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.objects.push(a),this._scene.add(a)}}catch(CO){i.e(CO)}finally{i.f()}var o,s=Ad(e.getRetrievableObjects());try{for(s.s();!(o=s.n()).done;){var u=o.value;n.retrievableObjects.push(u),this._retrievableObjects.push(u),this._objectTags[u.uuid]=e.tag.id}}catch(CO){s.e(CO)}finally{s.f()}}},{key:"_remove",value:function(e){var t=this._tags[e];this._removeObjects(t),t.tag.dispose(),delete this._tags[e]}},{key:"_removeObjects",value:function(e){var t,n=Ad(e.objects);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._scene.remove(r)}}catch(CO){n.e(CO)}finally{n.f()}var i,a=Ad(e.retrievableObjects);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=this._retrievableObjects.indexOf(o);-1!==s&&this._retrievableObjects.splice(s,1)}}catch(CO){a.e(CO)}finally{a.f()}}}]),e}();!function(e){e[e.Default=0]="Default",e[e.CreatePoint=1]="CreatePoint",e[e.CreatePoints=2]="CreatePoints",e[e.CreatePolygon=3]="CreatePolygon",e[e.CreateRect=4]="CreateRect",e[e.CreateRectDrag=5]="CreateRectDrag"}(TI||(TI={})),function(e){e[e.None=0]="None",e[e.Centroid=1]="Centroid",e[e.Vertex=2]="Vertex"}(EI||(EI={}));var zI,jI=function(){function e(t,n,r){Bd(this,e),this._tag=t,this._transform=n,this._viewportCoords=r||new CP,this._glObjectsChanged$=new If,this._interact$=new If}return $d(e,[{key:"glObjectsChanged$",get:function(){return this._glObjectsChanged$}},{key:"interact$",get:function(){return this._interact$}},{key:"tag",get:function(){return this._tag}}]),e}(),BI=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r))._geometryChangedSubscription=i._tag.geometry.changed$.subscribe((function(){i._onGeometryChanged()})),i._changedSubscription=i._tag.changed$.subscribe((function(){i._onTagChanged()&&i._glObjectsChanged$.next(Id(i))})),i}return $d(n,[{key:"dispose",value:function(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}},{key:"_colorToCss",value:function(e){return"#"+("000000"+e.toString(16)).substr(-6)}},{key:"_createFill",value:function(){var e=this._getTriangles(),t=new Float32Array(e),n=new E_;n.setAttribute("position",new m_(t,3)),n.computeBoundingSphere();var r=new f_({side:2,transparent:!0});return this._updateFillMaterial(r),new W_(n,r)}},{key:"_createLine",value:function(e){var t=this._getLinePositions(e),n=new E_;n.setAttribute("position",new m_(t,3)),n.computeBoundingSphere();var r=new Ow;this._updateLineBasicMaterial(r);var i=new Fw(n,r);return i.renderOrder=1,i}},{key:"_createOutline",value:function(){return this._createLine(this._getPoints3d())}},{key:"_disposeFill",value:function(){null!=this._fill&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}},{key:"_disposeOutline",value:function(){null!=this._outline&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}},{key:"_getLinePositions",value:function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;++r){var i=3*r,a=e[r];n[i+0]=a[0],n[i+1]=a[1],n[i+2]=a[2]}return n}},{key:"_interact",value:function(e,t,n){var r=this;return function(i){var a=i.offsetX-i.target.offsetWidth/2,o=i.offsetY-i.target.offsetHeight/2;r._interact$.next({cursor:t,offsetX:a,offsetY:o,operation:e,tag:r._tag,vertexIndex:n})}}},{key:"_updateFillGeometry",value:function(){var e=this._getTriangles(),t=new Float32Array(e),n=this._fill.geometry,r=n.getAttribute("position");r.array.length===t.length?(r.set(t),r.needsUpdate=!0):(n.deleteAttribute("position"),n.setAttribute("position",new m_(t,3))),n.computeBoundingSphere()}},{key:"_updateLine",value:function(e,t){var n=this._getLinePositions(t),r=e.geometry,i=r.getAttribute("position");i.set(n),i.needsUpdate=!0,r.computeBoundingSphere()}},{key:"_updateOulineGeometry",value:function(){this._updateLine(this._outline,this._getPoints3d())}}]),n}(jI),FI=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r))._rectGeometry=new AI(i._tag.geometry.getRect2d(r)),i._fill=ZM(r.cameraType)?null:i._createFill(),i._outline=i._tag.lineWidth>=1?i._createOutline():null,i}return $d(n,[{key:"dispose",value:function(){Nd(wd(n.prototype),"dispose",this).call(this),this._disposeFill(),this._disposeOutline()}},{key:"getDOMObjects",value:function(e,t,n){var r=[],i={offsetHeight:n.height,offsetWidth:n.width};if(!this._tag.editable)return r;for(var a=this._colorToCss(this._tag.lineColor),s=this._tag.geometry.getPoints2d(),u=0;u<s.length;u++){var l=o(s[u],2),c=l[0],h=l[1],d=this._viewportCoords.basicToCanvasSafe(c,h,i,this._transform,t);if(null!=d){var f="crosshair",p=this._interact(EI.Vertex,f,u),v=Math.round(d[0]),m=Math.round(d[1]),g="translate(-50%, -50%) translate(".concat(v,"px,").concat(m,"px)"),_={onpointerdown:p,style:{background:a,transform:g,cursor:f}};if(r.push(yP.h("div.mapillary-tag-resizer",_,[])),this._tag.indicateVertices){var y={style:{background:a,transform:g}};r.push(yP.h("div.mapillary-tag-vertex",y,[]))}}}return r}},{key:"getGLObjects",value:function(){var e=[];return null!=this._fill&&e.push(this._fill),null!=this._outline&&e.push(this._outline),e}},{key:"getRetrievableObjects",value:function(){return null!=this._fill?[this._fill]:[]}},{key:"_onGeometryChanged",value:function(){this._rectGeometry=new AI(this._tag.geometry.getRect2d(this._transform)),null!=this._fill&&this._updateFillGeometry(),null!=this._outline&&this._updateOulineGeometry()}},{key:"_onTagChanged",value:function(){var e=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),e=!0):this._updateOutlineMaterial(),e}},{key:"_getPoints3d",value:function(){return this._rectGeometry.getPoints3d(this._transform)}},{key:"_getTriangles",value:function(){return this._rectGeometry.getTriangles3d(this._transform)}},{key:"_updateFillMaterial",value:function(e){e.color=new d_(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}},{key:"_updateLineBasicMaterial",value:function(e){e.color=new d_(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}},{key:"_updateOutlineMaterial",value:function(){var e=this._outline.material;this._updateLineBasicMaterial(e)}}]),n}(BI),$I=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this))._id=e,i._geometry=r,i._notifyChanged$=new If,i._notifyChanged$.subscribe((function(e){var t={target:Id(i),type:"tag"};i.fire("tag",t)})),i._geometry.changed$.subscribe((function(e){var t="geometry",n={target:Id(i),type:t};i.fire(t,n)})),i}return $d(n,[{key:"id",get:function(){return this._id}},{key:"geometry",get:function(){return this._geometry}},{key:"changed$",get:function(){return this._notifyChanged$}},{key:"geometryChanged$",get:function(){var e=this;return this._geometry.changed$.pipe(wp((function(){return e})),wv())}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}}]),n}(bP),qI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),i=i||{},(a=t.call(this,e,r))._editable=null!=i.editable&&i.editable,a._fillColor=null==i.fillColor?16777215:i.fillColor,a._fillOpacity=null==i.fillOpacity?0:i.fillOpacity,a._indicateVertices=null==i.indicateVertices||i.indicateVertices,a._lineColor=null==i.lineColor?16777215:i.lineColor,a._lineOpacity=null==i.lineOpacity?1:i.lineOpacity,a._lineWidth=null==i.lineWidth?1:i.lineWidth,a}return $d(n,[{key:"editable",get:function(){return this._editable},set:function(e){this._editable=e,this._notifyChanged$.next(this)}},{key:"fillColor",get:function(){return this._fillColor},set:function(e){this._fillColor=e,this._notifyChanged$.next(this)}},{key:"fillOpacity",get:function(){return this._fillOpacity},set:function(e){this._fillOpacity=e,this._notifyChanged$.next(this)}},{key:"geometry",get:function(){return this._geometry}},{key:"indicateVertices",get:function(){return this._indicateVertices},set:function(e){this._indicateVertices=e,this._notifyChanged$.next(this)}},{key:"lineColor",get:function(){return this._lineColor},set:function(e){this._lineColor=e,this._notifyChanged$.next(this)}},{key:"lineOpacity",get:function(){return this._lineOpacity},set:function(e){this._lineOpacity=e,this._notifyChanged$.next(this)}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(e){this._lineWidth=e,this._notifyChanged$.next(this)}},{key:"setOptions",value:function(e){this._editable=null==e.editable?this._editable:e.editable,this._indicateVertices=null==e.indicateVertices?this._indicateVertices:e.indicateVertices,this._lineColor=null==e.lineColor?this._lineColor:e.lineColor,this._lineWidth=null==e.lineWidth?this._lineWidth:e.lineWidth,this._fillColor=null==e.fillColor?this._fillColor:e.fillColor,this._fillOpacity=null==e.fillOpacity?this._fillOpacity:e.fillOpacity,this._notifyChanged$.next(this)}}]),n}($I);!function(e){e[e.TwoDimensional=0]="TwoDimensional",e[e.ThreeDimensional=1]="ThreeDimensional"}(zI||(zI={}));var UI,VI=function(e){Dd(n,e);var t=zd(n);function n(e,r){var i;return Bd(this,n),(i=t.call(this,e,r))._fill=ZM(r.cameraType)?e.domain===zI.TwoDimensional&&e.geometry instanceof II?i._createFill():null:i._createFill(),i._holes=i._tag.lineWidth>=1?i._createHoles():[],i._outline=i._tag.lineWidth>=1?i._createOutline():null,i}return $d(n,[{key:"dispose",value:function(){Nd(wd(n.prototype),"dispose",this).call(this),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}},{key:"getDOMObjects",value:function(e,t,n){var r=this,i=[],a=this._tag.geometry instanceof AI,s=!ZM(this._transform.cameraType),u={offsetHeight:n.height,offsetWidth:n.width};if(null!=this._tag.icon&&(a||s)){var l=o(this._tag.geometry instanceof AI?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),2),c=l[0],h=l[1],d=this._viewportCoords.basicToCanvasSafe(c,h,u,this._transform,t);if(null!=d){if(e.loaded){var f=e.getDOMSprite(this._tag.icon,this._tag.iconFloat),p=Math.round(d[0]),v=Math.round(d[1]),m={onclick:function(e){e.stopPropagation(),r._tag.click$.next(r._tag)},onpointerdown:function(){r._interact$.next({offsetX:0,offsetY:0,operation:EI.None,tag:r._tag})},style:{transform:"translate(".concat(p,"px,").concat(v,"px)")}};i.push(yP.h("div.mapillary-tag-symbol",m,[f]))}}}else if(null!=this._tag.text&&(a||s)){var g=o(this._tag.geometry instanceof AI?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),2),_=g[0],y=g[1],b=this._viewportCoords.basicToCanvasSafe(_,y,u,this._transform,t);if(null!=b){var x=Math.round(b[0]),w=Math.round(b[1]),k=this._tag.geometry instanceof AI?"translate(".concat(x,"px,").concat(w,"px)"):"translate(-50%, -50%) translate(".concat(x,"px,").concat(w,"px)"),S={onpointerdown:function(){r._interact$.next({offsetX:0,offsetY:0,operation:EI.None,tag:r._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:k},textContent:this._tag.text};i.push(yP.h("span.mapillary-tag-symbol",S,[]))}}if(!this._tag.editable)return i;var M=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof AI){var C=o(this._tag.geometry.getCentroid2d(),2),T=C[0],E=C[1],P=this._viewportCoords.basicToCanvasSafe(T,E,u,this._transform,t);if(null!=P){var A=this._interact(EI.Centroid,"move"),L=Math.round(P[0]),I=Math.round(P[1]),R={onpointerdown:A,style:{background:M,transform:"translate(-50%, -50%) translate(".concat(L,"px,").concat(I,"px)")}};i.push(yP.h("div.mapillary-tag-mover",R,[]))}}for(var O=this._tag.geometry.getVertices2d(),N=0;N<O.length-1;N++)if(!a||!(null!=this._tag.icon&&N===this._tag.iconIndex||null==this._tag.icon&&null!=this._tag.text&&3===N)){var D=o(O[N],2),z=D[0],j=D[1],B=this._viewportCoords.basicToCanvasSafe(z,j,u,this._transform,t);if(null!=B){var F=a?N%2===0?"nesw-resize":"nwse-resize":"crosshair",$=this._interact(EI.Vertex,F,N),q=Math.round(B[0]),U=Math.round(B[1]),V="translate(-50%, -50%) translate(".concat(q,"px,").concat(U,"px)"),H={onpointerdown:$,style:{background:M,transform:V,cursor:F}};if(i.push(yP.h("div.mapillary-tag-resizer",H,[])),this._tag.indicateVertices){var W={style:{background:M,transform:V}};i.push(yP.h("div.mapillary-tag-vertex",W,[]))}}}return i}},{key:"getGLObjects",value:function(){var e=[];null!=this._fill&&e.push(this._fill);var t,n=Ad(this._holes);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.push(r)}}catch(CO){n.e(CO)}finally{n.f()}return null!=this._outline&&e.push(this._outline),e}},{key:"getRetrievableObjects",value:function(){return null!=this._fill?[this._fill]:[]}},{key:"_onGeometryChanged",value:function(){null!=this._fill&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),null!=this._outline&&this._updateOulineGeometry()}},{key:"_onTagChanged",value:function(){var e=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),e=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),e}},{key:"_getPoints3d",value:function(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}},{key:"_getTriangles",value:function(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}},{key:"_updateFillMaterial",value:function(e){e.color=new d_(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}},{key:"_updateLineBasicMaterial",value:function(e){e.color=new d_(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}},{key:"_createHoles",value:function(){var e=[];if(this._tag.geometry instanceof II){var t,n=Ad(this._getHoles3d());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this._createLine(r);e.push(i)}}catch(CO){n.e(CO)}finally{n.f()}}return e}},{key:"_disposeHoles",value:function(){var e,t=Ad(this._holes);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.geometry.dispose(),n.material.dispose()}}catch(CO){t.e(CO)}finally{t.f()}this._holes=[]}},{key:"_getHoles3d",value:function(){var e=this._tag.geometry;return this._in3dDomain()?e.getHoleVertices3d(this._transform):e.getHolePoints3d(this._transform)}},{key:"_in3dDomain",value:function(){return this._tag.geometry instanceof II&&this._tag.domain===zI.ThreeDimensional}},{key:"_updateHoleGeometries",value:function(){var e=this._getHoles3d();if(e.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(var t=0;t<this._holes.length;t++){var n=e[t],r=this._holes[t];this._updateLine(r,n)}}},{key:"_updateHoleMaterials",value:function(){var e,t=Ad(this._holes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._updateLineBasicMaterial(n.material)}}catch(CO){t.e(CO)}finally{t.f()}}},{key:"_updateOutlineMaterial",value:function(){this._updateLineBasicMaterial(this._outline.material)}}]),n}(BI);!function(e){e[e.Bottom=0]="Bottom",e[e.BottomLeft=1]="BottomLeft",e[e.BottomRight=2]="BottomRight",e[e.Center=3]="Center",e[e.Left=4]="Left",e[e.Right=5]="Right",e[e.Top=6]="Top",e[e.TopLeft=7]="TopLeft",e[e.TopRight=8]="TopRight"}(UI||(UI={}));var HI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;Bd(this,n),a=t.call(this,e,r);var o=null!=(i=i||{}).domain&&r instanceof II?i.domain:zI.TwoDimensional,s=a._twoDimensionalPolygon(o,r);return a._domain=o,a._editable=null!=i.editable&&!s&&i.editable,a._fillColor=null==i.fillColor?16777215:i.fillColor,a._fillOpacity=null==i.fillOpacity?0:i.fillOpacity,a._icon=void 0===i.icon?null:i.icon,a._iconFloat=null==i.iconFloat?UI.Center:i.iconFloat,a._iconIndex=null==i.iconIndex?3:i.iconIndex,a._indicateVertices=null==i.indicateVertices||i.indicateVertices,a._lineColor=null==i.lineColor?16777215:i.lineColor,a._lineOpacity=null==i.lineOpacity?1:i.lineOpacity,a._lineWidth=null==i.lineWidth?1:i.lineWidth,a._text=void 0===i.text?null:i.text,a._textColor=null==i.textColor?16777215:i.textColor,a._click$=new If,a._click$.subscribe((function(){var e="click",t={target:Id(a),type:e};a.fire(e,t)})),a}return $d(n,[{key:"click$",get:function(){return this._click$}},{key:"domain",get:function(){return this._domain}},{key:"editable",get:function(){return this._editable},set:function(e){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=e,this._notifyChanged$.next(this))}},{key:"fillColor",get:function(){return this._fillColor},set:function(e){this._fillColor=e,this._notifyChanged$.next(this)}},{key:"fillOpacity",get:function(){return this._fillOpacity},set:function(e){this._fillOpacity=e,this._notifyChanged$.next(this)}},{key:"geometry",get:function(){return this._geometry}},{key:"icon",get:function(){return this._icon},set:function(e){this._icon=e,this._notifyChanged$.next(this)}},{key:"iconFloat",get:function(){return this._iconFloat},set:function(e){this._iconFloat=e,this._notifyChanged$.next(this)}},{key:"iconIndex",get:function(){return this._iconIndex},set:function(e){this._iconIndex=e,this._notifyChanged$.next(this)}},{key:"indicateVertices",get:function(){return this._indicateVertices},set:function(e){this._indicateVertices=e,this._notifyChanged$.next(this)}},{key:"lineColor",get:function(){return this._lineColor},set:function(e){this._lineColor=e,this._notifyChanged$.next(this)}},{key:"lineOpacity",get:function(){return this._lineOpacity},set:function(e){this._lineOpacity=e,this._notifyChanged$.next(this)}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(e){this._lineWidth=e,this._notifyChanged$.next(this)}},{key:"text",get:function(){return this._text},set:function(e){this._text=e,this._notifyChanged$.next(this)}},{key:"textColor",get:function(){return this._textColor},set:function(e){this._textColor=e,this._notifyChanged$.next(this)}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"setOptions",value:function(e){var t=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=t||null==e.editable?this._editable:e.editable,this._icon=void 0===e.icon?this._icon:e.icon,this._iconFloat=null==e.iconFloat?this._iconFloat:e.iconFloat,this._iconIndex=null==e.iconIndex?this._iconIndex:e.iconIndex,this._indicateVertices=null==e.indicateVertices?this._indicateVertices:e.indicateVertices,this._lineColor=null==e.lineColor?this._lineColor:e.lineColor,this._lineWidth=null==e.lineWidth?this._lineWidth:e.lineWidth,this._fillColor=null==e.fillColor?this._fillColor:e.fillColor,this._fillOpacity=null==e.fillOpacity?this._fillOpacity:e.fillOpacity,this._text=void 0===e.text?this._text:e.text,this._textColor=null==e.textColor?this._textColor:e.textColor,this._notifyChanged$.next(this)}},{key:"_twoDimensionalPolygon",value:function(e,t){return e!==zI.ThreeDimensional&&t instanceof II}}]),n}($I),WI=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"dispose",value:function(){}},{key:"getDOMObjects",value:function(e,t,n){var r=this,i=this._tag,a={offsetHeight:n.height,offsetWidth:n.width},s=[],u=o(i.geometry.getCentroid2d(),2),l=u[0],c=u[1],h=this._viewportCoords.basicToCanvasSafe(l,c,a,this._transform,t);if(null!=h){var d=function(e){r._interact$.next({offsetX:0,offsetY:0,operation:EI.None,tag:i})},f=Math.round(h[0]),p=Math.round(h[1]);if(null!=i.icon){if(e.loaded){var v=e.getDOMSprite(i.icon,UI.Bottom),m={onpointerdown:d,style:{pointerEvents:"all",transform:"translate(".concat(f,"px,").concat(p+8,"px)")}};s.push(yP.h("div",m,[v]))}}else if(null!=i.text){var g="translate(-50%,0%) translate(".concat(f,"px,").concat(p+8,"px)"),_={onpointerdown:d,style:{color:this._colorToCss(i.textColor),transform:g},textContent:i.text};s.push(yP.h("span.mapillary-tag-symbol",_,[]))}var y=this._interact(EI.Centroid,i,"move"),b=this._colorToCss(i.color),x="translate(-50%,-50%) translate(".concat(f,"px,").concat(p,"px)");if(i.editable){var w={onpointerdown:y,style:{background:b,transform:x}};s.push(yP.h("div.mapillary-tag-spot-interactor",w,[]))}var k={style:{background:b,transform:x}};s.push(yP.h("div.mapillary-tag-vertex",k,[]))}return s}},{key:"getGLObjects",value:function(){return[]}},{key:"getRetrievableObjects",value:function(){return[]}},{key:"_colorToCss",value:function(e){return"#"+("000000"+e.toString(16)).substr(-6)}},{key:"_interact",value:function(e,t,n,r){var i=this;return function(a){var o=a.offsetX-a.target.offsetWidth/2,s=a.offsetY-a.target.offsetHeight/2;i._interact$.next({cursor:n,offsetX:o,offsetY:s,operation:e,tag:t,vertexIndex:r})}}}]),n}(jI),GI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),i=i||{},(a=t.call(this,e,r))._color=null==i.color?16777215:i.color,a._editable=null!=i.editable&&i.editable,a._icon=void 0===i.icon?null:i.icon,a._text=void 0===i.text?null:i.text,a._textColor=null==i.textColor?16777215:i.textColor,a}return $d(n,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._notifyChanged$.next(this)}},{key:"editable",get:function(){return this._editable},set:function(e){this._editable=e,this._notifyChanged$.next(this)}},{key:"icon",get:function(){return this._icon},set:function(e){this._icon=e,this._notifyChanged$.next(this)}},{key:"text",get:function(){return this._text},set:function(e){this._text=e,this._notifyChanged$.next(this)}},{key:"textColor",get:function(){return this._textColor},set:function(e){this._textColor=e,this._notifyChanged$.next(this)}},{key:"setOptions",value:function(e){this._color=null==e.color?this._color:e.color,this._editable=null==e.editable?this._editable:e.editable,this._icon=void 0===e.icon?this._icon:e.icon,this._text=void 0===e.text?this._text:e.text,this._textColor=null==e.textColor?this._textColor:e.textColor,this._notifyChanged$.next(this)}}]),n}($I),ZI=function(){function e(){Bd(this,e),this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new If}return $d(e,[{key:"active",get:function(){return this._active}},{key:"changed$",get:function(){return this._notifyChanged$}},{key:"activate",value:function(e){if(!this._active){for(var t in this._hashDeactivated)if(this._hashDeactivated.hasOwnProperty(t)){var n=this._hashDeactivated[t];this._add(n,e)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}},{key:"deactivate",value:function(){if(this._active){for(var e in this._hash)this._hash.hasOwnProperty(e)&&(this._hashDeactivated[e]=this._hash[e].tag);this._hash={},this._active=!1}}},{key:"add",value:function(e,t){this._assertActivationState(!0);var n,r=Ad(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this._add(i,t)}}catch(CO){r.e(CO)}finally{r.f()}this._notifyChanged$.next(this)}},{key:"addDeactivated",value:function(e){this._assertActivationState(!1);var t,n=Ad(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!(r instanceof HI||r instanceof GI||r instanceof qI))throw new Error("Tag type not supported");this._hashDeactivated[r.id]=r}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"get",value:function(e){return this.has(e)?this._hash[e]:void 0}},{key:"getAll",value:function(){var e=this._hash;return Object.keys(e).map((function(t){return e[t]}))}},{key:"getAllDeactivated",value:function(){var e=this._hashDeactivated;return Object.keys(e).map((function(t){return e[t]}))}},{key:"getDeactivated",value:function(e){return this.hasDeactivated(e)?this._hashDeactivated[e]:void 0}},{key:"has",value:function(e){return e in this._hash}},{key:"hasDeactivated",value:function(e){return e in this._hashDeactivated}},{key:"remove",value:function(e){this._assertActivationState(!0);var t,n=this._hash,r=Ad(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i in n&&delete n[i]}}catch(CO){r.e(CO)}finally{r.f()}this._notifyChanged$.next(this)}},{key:"removeAll",value:function(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}},{key:"removeAllDeactivated",value:function(){this._assertActivationState(!1),this._hashDeactivated={}}},{key:"removeDeactivated",value:function(e){this._assertActivationState(!1);var t,n=this._hashDeactivated,r=Ad(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i in n&&delete n[i]}}catch(CO){r.e(CO)}finally{r.f()}}},{key:"_add",value:function(e,t){if(e instanceof HI)this._hash[e.id]=new VI(e,t);else if(e instanceof GI)this._hash[e.id]=new WI(e,t);else{if(!(e instanceof qI))throw new Error("Tag type not supported");this._hash[e.id]=new FI(e,t)}}},{key:"_assertActivationState",value:function(e){if(e!==this._active)throw new Error("Tag set not in correct state for operation.")}}]),e}(),YI=function(e){Dd(n,e);var t=zd(n);function n(e){var r;Bd(this,n),r=t.call(this);var i=e[0],a=e[1];if(i<0||i>1||a<0||a>1)throw new iL("Basic coordinates must be on the interval [0, 1].");return r._point=e.slice(),r}return $d(n,[{key:"point",get:function(){return this._point}},{key:"getCentroid2d",value:function(){return this._point.slice()}},{key:"getCentroid3d",value:function(e){return e.unprojectBasic(this._point,200)}},{key:"setCentroid2d",value:function(e,t){var n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._point[0]=n[0],this._point[1]=n[1],this._notifyChanged$.next(this)}}]),n}(rL),XI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._name="".concat(o._component.name,"-").concat(o._getNameExtension()),o._viewportCoords=a,o}return $d(n,[{key:"_getConfiguration",value:function(e){return{}}},{key:"_mouseEventToBasic",value:function(e,t,n,r,i,a){i=null!=i?i:0,a=null!=a?a:0;var s=o(this._viewportCoords.canvasPosition(e,t),2),u=s[0],l=s[1];return this._viewportCoords.canvasToBasic(u-i,l-a,t,r,n.perspective)}}]),n}(QP),KI=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o){var s;return Bd(this,n),(s=t.call(this,e,r,i,a))._tagCreator=o,s._geometryCreated$=new If,s}return $d(n,[{key:"geometryCreated$",get:function(){return this._geometryCreated$}},{key:"_enable",value:function(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}},{key:"_disable",value:function(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}},{key:"_validateBasic",value:function(e){var t=e[0],n=e[1];return 0<=t&&t<=1&&0<=n&&n<=1}},{key:"_mouseEventToBasic$",value:function(e){var t=this;return e.pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),wp((function(e){var n=o(e,3),r=n[0],i=n[1],a=n[2];return t._mouseEventToBasic(r,t._container.container,i,a)})))}}]),n}(XI),JI=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enableCreate",value:function(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(Zp(this._validateBasic),wp((function(e){return new YI(e)}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-point"}}]),n}(KI),QI=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enableCreate",value:function(){var e=this;this._container.mouseService.deferPixels(this._name,4);var t=this._navigator.stateService.currentTransform$.pipe(wp((function(){})),yv(1),Pf());this._deleteSubscription=t.pipe(Sv(1)).subscribe(this._tagCreator.delete$);var n=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(wv());this._createSubscription=t.pipe(Tv((function(){return n.pipe(Zp(e._validateBasic),ov(1))}))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(Tv((function(t){return t?Lp(vp(t),Hp(e._container.mouseService.mouseMove$,e._container.mouseService.domMouseMove$),e._container.renderService.renderCamera$,e._navigator.stateService.currentTransform$):Hf()}))).subscribe((function(t){var n=o(t,4),r=n[0],i=n[1],a=n[2],s=n[3],u=e._mouseEventToBasic(i,e._container.container,a,s);e._setVertex2d(r,u,s)})),this._addPointSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?Lp(vp(e),n):Hf()}))).subscribe((function(t){var n=o(t,2),r=n[0],i=n[1];e._addPoint(r,i)})),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?e.created$.pipe(wp((function(e){return e.geometry}))):Hf()}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}]),n}(KI),eR=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_create$",get:function(){return this._tagCreator.createPoints$}},{key:"_addPoint",value:function(e,t){e.geometry.addPoint2d(t)}},{key:"_getNameExtension",value:function(){return"create-points"}},{key:"_setVertex2d",value:function(e,t,n){e.geometry.setPoint2d(e.geometry.points.length-1,t,n)}}]),n}(QI),tR=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_create$",get:function(){return this._tagCreator.createPolygon$}},{key:"_addPoint",value:function(e,t){e.addPoint(t)}},{key:"_getNameExtension",value:function(){return"create-polygon"}},{key:"_setVertex2d",value:function(e,t,n){e.geometry.setVertex2d(e.geometry.polygon.length-2,t,n)}}]),n}(QI),nR=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_create$",get:function(){return this._tagCreator.createRect$}},{key:"_addPoint",value:function(e,t){var n=e.geometry;n.validate(t)||(t=n.getNonAdjustedVertex2d(3)),e.addPoint(t)}},{key:"_enable",value:function(){Nd(wd(n.prototype),"_enable",this).call(this),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(Zp((function(e){return!!e}))).subscribe((function(e){e.geometry.initializeAnchorIndexing()}))}},{key:"_disable",value:function(){Nd(wd(n.prototype),"_disable",this).call(this),this._initializeAnchorIndexingSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-rect"}},{key:"_setVertex2d",value:function(e,t,n){e.geometry.setOppositeVertex2d(t,n)}}]),n}(QI),rR=function(e){Dd(n,e);var t=zd(n);function n(){return Bd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enableCreate",value:function(){var e=this;this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(wp((function(e){return null})),Sv(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(Zp(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(Zp((function(e){return!!e}))).subscribe((function(e){e.geometry.initializeAnchorIndexing()}));var t=Lp(Hp(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(Lv(this._navigator.stateService.currentTransform$),wp((function(t){var n=o(t,2),r=o(n[0],2),i=r[0],a=r[1],s=n[1];return e._mouseEventToBasic(i,e._container.container,a,s)})));this._setVertexSubscription=this._tagCreator.tag$.pipe(Tv((function(n){return n?Lp(vp(n),t,e._navigator.stateService.currentTransform$):Hf()}))).subscribe((function(e){var t=o(e,3),n=t[0],r=t[1],i=t[2];n.geometry.setOppositeVertex2d(r,i)}));var n=this._container.mouseService.mouseDragEnd$.pipe(Lv(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(Zp(this._validateBasic)),(function(e,t){return t})),wv());this._addPointSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?Lp(vp(e),n):Hf()}))).subscribe((function(e){var t=o(e,2),n=t[0],r=t[1],i=n.geometry;i.validate(r)||(r=i.getNonAdjustedVertex2d(3)),n.addPoint(r)})),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?e.created$.pipe(wp((function(e){return e.geometry}))):Hf()}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-rect-drag"}}]),n}(KI),iR=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a,o){var s;return Bd(this,n),(s=t.call(this,e,r,i,a))._tagSet=o,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._tagSet.changed$.pipe(wp((function(e){return e.getAll()})),Tv((function(e){return ap(e).pipe(Np((function(e){return e.interact$})))})),Tv((function(t){return jp(vp(t),e._container.mouseService.documentMouseUp$.pipe(wp((function(){return{offsetX:0,offsetY:0,operation:EI.None,tag:null}})),fv()))})),wv());Hp(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(wv()),this._claimMouseSubscription=t.pipe(Tv((function(t){return t.tag?e._container.mouseService.domMouseDragStart$:Hf()}))).subscribe((function(){e._container.mouseService.claimMouse(e._name,3)})),this._cursorSubscription=t.pipe(wp((function(e){return e.cursor})),sv()).subscribe((function(t){for(var n=0,r=["crosshair","move","nesw-resize","nwse-resize"];n<r.length;n++){var i=r[n];e._container.container.classList.remove("component-tag-edit-".concat(i))}t&&e._container.container.classList.add("component-tag-edit-".concat(t))})),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe((function(t){e._container.mouseService.unclaimMouse(e._name)})),this._preventDefaultSubscription=t.pipe(Tv((function(t){return t.tag?e._container.mouseService.documentMouseMove$:Hf()}))).subscribe((function(e){e.preventDefault()})),this._updateGeometrySubscription=t.pipe(Tv((function(t){return t.operation!==EI.None&&t.tag?Lp(e._container.mouseService.filtered$(e._name,e._container.mouseService.domMouseDrag$).pipe(Zp((function(t){return e._viewportCoords.insideElement(t,e._container.container)}))),e._container.renderService.renderCamera$).pipe(Lv(vp(t),e._navigator.stateService.currentTransform$,(function(e,t,n){var r=o(e,2);return[r[0],r[1],t,n]}))):Hf()}))).subscribe((function(t){var n=o(t,4),r=n[0],i=n[1],a=n[2],s=n[3],u=e._mouseEventToBasic(r,e._container.container,i,s,a.offsetX,a.offsetY),l=a.tag.geometry;a.operation===EI.Centroid?l.setCentroid2d(u,s):a.operation===EI.Vertex&&l.setVertex2d(a.vertexIndex,u,s)}))}},{key:"_disable",value:function(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"edit-vertex"}}]),n}(XI),aR=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._tagDomRenderer=new NI,a._tagScene=new DI,a._tagSet=new ZI,a._tagCreator=new OI(Id(a),i),a._viewportCoords=new CP,a._createHandlers={CreatePoint:new JI(Id(a),r,i,a._viewportCoords,a._tagCreator),CreatePoints:new eR(Id(a),r,i,a._viewportCoords,a._tagCreator),CreatePolygon:new tR(Id(a),r,i,a._viewportCoords,a._tagCreator),CreateRect:new nR(Id(a),r,i,a._viewportCoords,a._tagCreator),CreateRectDrag:new rR(Id(a),r,i,a._viewportCoords,a._tagCreator),Default:void 0},a._editVertexHandler=new iR(Id(a),r,i,a._viewportCoords,a._tagSet),a._renderTags$=a._tagSet.changed$.pipe(wp((function(e){var t=e.getAll();return t.sort((function(e,t){var n=e.tag.id,r=t.tag.id;return n<r?-1:n>r?1:0})),t})),wv()),a._tagChanged$=a._renderTags$.pipe(Tv((function(e){return ap(e).pipe(Np((function(e){return Hp(e.tag.changed$,e.tag.geometryChanged$)})))})),wv()),a._renderTagGLChanged$=a._renderTags$.pipe(Tv((function(e){return ap(e).pipe(Np((function(e){return e.glObjectsChanged$})))})),wv()),a._createGeometryChanged$=a._tagCreator.tag$.pipe(Tv((function(e){return null!=e?e.geometryChanged$:Hf()})),wv()),a._createGLObjectsChanged$=a._tagCreator.tag$.pipe(Tv((function(e){return null!=e?e.glObjectsChanged$:Hf()})),wv()),a._creatingConfiguration$=a._configuration$.pipe(sv((function(e,t){return e.mode===t.mode}),(function(e){return{createColor:e.createColor,mode:e.mode}})),yv(1),Pf()),a._creatingConfiguration$.subscribe((function(e){var t="tagmode",n={mode:e.mode,target:Id(a),type:t};a.fire(t,n)})),a}return $d(n,[{key:"add",value:function(e){var t=this;this._activated?this._navigator.stateService.currentTransform$.pipe(fv()).subscribe((function(n){t._tagSet.add(e,n);var r=e.map((function(e){return t._tagSet.get(e.id)}));t._tagScene.add(r)})):this._tagSet.addDeactivated(e)}},{key:"calculateRect",value:function(e){var t=this;return new Promise((function(n,r){t._navigator.stateService.currentTransform$.pipe(fv(),wp((function(t){return e.getRect2d(t)}))).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"create",value:function(){this._tagCreator.replayedTag$.pipe(fv(),Zp((function(e){return!!e}))).subscribe((function(e){e.create()}))}},{key:"changeMode",value:function(e){this.configure({mode:e})}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"get",value:function(e){if(this._activated){var t=this._tagSet.get(e);return void 0!==t?t.tag:void 0}return this._tagSet.getDeactivated(e)}},{key:"getAll",value:function(){return this.activated?this._tagSet.getAll().map((function(e){return e.tag})):this._tagSet.getAllDeactivated()}},{key:"getTagIdsAt",value:function(e){var t=this;return new Promise((function(n,r){t._container.renderService.renderCamera$.pipe(fv(),wp((function(n){var r=t._viewportCoords.canvasToViewport(e[0],e[1],t._container.container);return t._tagScene.intersectObjects(r,n.perspective)}))).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"has",value:function(e){return this._activated?this._tagSet.has(e):this._tagSet.hasDeactivated(e)}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"remove",value:function(e){this._activated?(this._tagSet.remove(e),this._tagScene.remove(e)):this._tagSet.removeDeactivated(e)}},{key:"removeAll",value:function(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}},{key:"_activate",value:function(){var e=this;this._editVertexHandler.enable();var t=ap(Object.keys(this._createHandlers)).pipe(wp((function(t){return e._createHandlers[t]})),Zp((function(e){return!!e})),Np((function(e){return e.geometryCreated$})),wv()),n=this._subscriptions;n.push(t.subscribe((function(t){var n="geometrycreate",r={geometry:t,target:e,type:n};e.fire(n,r)}))),n.push(this._tagCreator.tag$.pipe(Mv((function(e){return null==e})),sv()).subscribe((function(t){var n=null!=t?"tagcreatestart":"tagcreateend",r={target:e,type:n};e.fire(n,r)}))),n.push(t.subscribe((function(){e.changeMode(TI.Default)}))),n.push(this._creatingConfiguration$.subscribe((function(t){e._disableCreateHandlers();var n=TI[t.mode],r=e._createHandlers[n];r&&r.enable()}))),n.push(this._renderTags$.subscribe((function(){var t="tags",n={target:e,type:t};e.fire(t,n)}))),n.push(this._tagCreator.tag$.pipe(Tv((function(e){return null!=e?e.aborted$.pipe(wp((function(){return null}))):Hf()}))).subscribe((function(){e.changeMode(TI.Default)}))),n.push(this._tagCreator.tag$.subscribe((function(t){e._tagScene.hasCreateTag()&&e._tagScene.removeCreateTag(),null!=t&&e._tagScene.addCreateTag(t)}))),n.push(this._createGLObjectsChanged$.subscribe((function(t){e._tagScene.updateCreateTagObjects(t)}))),n.push(this._renderTagGLChanged$.subscribe((function(t){e._tagScene.updateObjects(t)}))),n.push(this._tagChanged$.subscribe((function(){e._tagScene.update()}))),n.push(Lp(this._renderTags$.pipe(Cv([]),Av((function(){e._container.domRenderer.render$.next({name:e._name,vNode:e._tagDomRenderer.clear()})}))),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(Cv(null)),Hp(this._tagCreator.tag$,this._createGeometryChanged$).pipe(Cv(null))).pipe(wp((function(t){var n=o(t,6),r=n[0],i=n[1],a=n[2],s=n[3],u=n[5];return{name:e._name,vNode:e._tagDomRenderer.render(r,u,a,i.perspective,s)}}))).subscribe(this._container.domRenderer.render$)),n.push(this._navigator.stateService.currentState$.pipe(wp((function(t){var n=e._tagScene;return{name:e._name,renderer:{frameId:t.id,needsRender:n.needsRender,render:n.render.bind(n),pass:OP.Opaque}}}))).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(fv()).subscribe((function(t){e._tagSet.activate(t),e._tagScene.add(e._tagSet.getAll())}))}},{key:"_deactivate",value:function(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}},{key:"_getDefaultConfiguration",value:function(){return{createColor:16777215,indicatePointsCompleter:!0,mode:TI.Default}}},{key:"_disableCreateHandlers",value:function(){var e=this._createHandlers;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];n&&n.disable()}}}]),n}(wP);aR.componentName="tag";var oR=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._viewportCoords=new CP,a._zoomDelta$=new If,a}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(Lp(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(wp((function(t){var n=o(t,4),r=n[0],i=n[1],a=n[2],s=n[3],u=r.state.zoom,l=yP.h("div.mapillary-zoom-in-icon",[]),c=u>=3||i===XP.Waiting?yP.h("div.mapillary-zoom-in-button-inactive",[l]):yP.h("div.mapillary-zoom-in-button",{onclick:function(){e._zoomDelta$.next(1)}},[l]),h=yP.h("div.mapillary-zoom-out-icon",[]),d=u<=0||i===XP.Waiting?yP.h("div.mapillary-zoom-out-button-inactive",[h]):yP.h("div.mapillary-zoom-out-button",{onclick:function(){e._zoomDelta$.next(-1)}},[h]),f=a.size===MP.Small||a.size===MP.Automatic&&s.width<640?".mapillary-zoom-compact":"";return{name:e._name,vNode:yP.h("div.mapillary-zoom-container"+f,{oncontextmenu:function(e){e.preventDefault()}},[c,d])}}))).subscribe(this._container.domRenderer.render$)),t.push(this._zoomDelta$.pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var n=o(t,3),r=n[0],i=n[1],a=n[2],s=e._viewportCoords.unprojectFromViewport(0,0,i.perspective),u=a.projectBasic(s.toArray());e._navigator.stateService.zoomIn(r,u)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{size:MP.Automatic}}}]),n}(wP);oR.componentName="zoom";var sR=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o;return Bd(this,n),(o=t.call(this,e,r,i))._canvasId="".concat(r.id,"-").concat(o._name),o._dom=a||new SA,o}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._container.domRenderer.element$.pipe(wp((function(){return e._dom.document.getElementById(e._canvasId)})),Zp((function(e){return!!e})),wp((function(e){var t=e.parentElement,n=t.offsetWidth;return[e,{height:t.offsetHeight,width:n}]})),sv((function(e,t){return e.height===t.height&&e.width===t.width}),(function(e){return o(e,2)[1]})));this._subscriptions.push(Lp(t,this._navigator.stateService.currentImage$).subscribe((function(e){var t=o(e,2),n=o(t[0],2),r=n[0],i=n[1],a=t[1];r.width=i.width,r.height=i.height,r.getContext("2d").drawImage(a.image,0,0,i.width,i.height)}))),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:yP.h("canvas#".concat(this._canvasId),[])})}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}}]),n}(wP);sR.componentName="imagefallback";var uR=function(e){Dd(n,e);var t=zd(n);function n(e,r,i){var a;return Bd(this,n),(a=t.call(this,e,r,i))._seqNames={},a._seqNames[DM[DM.Prev]]="-prev",a._seqNames[DM[DM.Next]]="-next",a._spaTopNames={},a._spaTopNames[DM[DM.TurnLeft]]="-turn-left",a._spaTopNames[DM[DM.StepLeft]]="-left",a._spaTopNames[DM[DM.StepForward]]="-forward",a._spaTopNames[DM[DM.StepRight]]="-right",a._spaTopNames[DM[DM.TurnRight]]="-turn-right",a._spaBottomNames={},a._spaBottomNames[DM[DM.TurnU]]="-turn-around",a._spaBottomNames[DM[DM.StepBackward]]="-backward",a}return $d(n,[{key:"_activate",value:function(){var e=this;this._subscriptions.push(Lp(this._navigator.stateService.currentImage$,this._configuration$).pipe(Tv((function(e){var t=o(e,2),n=t[0],r=t[1];return Lp(r.sequence?n.sequenceEdges$.pipe(wp((function(e){return e.edges.map((function(e){return e.data.direction}))}))):vp([]),!ZM(n.cameraType)&&r.spatial?n.spatialEdges$.pipe(wp((function(e){return e.edges.map((function(e){return e.data.direction}))}))):vp([])).pipe(wp((function(e){var t=o(e,2),n=t[0],r=t[1];return n.concat(r)})))})),wp((function(t){var n=e._createArrowRow(e._seqNames,t),r=e._createArrowRow(e._spaTopNames,t),i=e._createArrowRow(e._spaBottomNames,t),a=yP.h("div.mapillary-navigation-sequence",n),o=yP.h("div.NavigationSpatialTop",r),s=yP.h("div.mapillary-navigation-spatial-bottom",i),u=yP.h("div.mapillary-navigation-spatial",[o,s]);return{name:e._name,vNode:yP.h("div.NavigationContainer",[a,u])}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{sequence:!0,spatial:!0}}},{key:"_createArrowRow",value:function(e,t){var n=[];for(var r in e)if(e.hasOwnProperty(r)){var i=DM[r];-1!==t.indexOf(i)?n.push(this._createVNode(i,e[r],"visible")):n.push(this._createVNode(i,e[r],"hidden"))}return n}},{key:"_createVNode",value:function(e,t,n){var r=this;return yP.h("span.mapillary-navigation-button.mapillary-navigation".concat(t),{onclick:function(){r._navigator.moveDir$(e).subscribe(void 0,(function(e){e instanceof PP||console.error(e)}))},style:{visibility:n}},[])}}]),n}(wP);uR.componentName="navigationfallback";function lR(e){for(var t=e.length;--t>=0;)e[t]=0}var cR=256,hR=286,dR=30,fR=15,pR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),mR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gR=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_R=new Array(576);lR(_R);var yR=new Array(60);lR(yR);var bR=new Array(512);lR(bR);var xR=new Array(256);lR(xR);var wR=new Array(29);lR(wR);var kR,SR,MR,CR=new Array(dR);function TR(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function ER(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}lR(CR);var PR=function(e){return e<256?bR[e]:bR[256+(e>>>7)]},AR=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},LR=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,AR(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},IR=function(e,t,n){LR(e,n[2*t],n[2*t+1])},RR=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},OR=function(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=fR;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=RR(a[s]++,s))}},NR=function(e){var t;for(t=0;t<hR;t++)e.dyn_ltree[2*t]=0;for(t=0;t<dR;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},DR=function(e){e.bi_valid>8?AR(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},zR=function(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},jR=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&zR(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!zR(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},BR=function(e,t,n){var r,i,a,o,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===r?IR(e,i,t):(a=xR[i],IR(e,a+cR+1,t),0!==(o=pR[a])&&(i-=wR[a],LR(e,i,o)),r--,a=PR(r),IR(e,a,n),0!==(o=vR[a])&&(r-=CR[a],LR(e,r,o)))}while(s<e.last_lit);IR(e,256,t)},FR=function(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==a[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)jR(e,a,n);i=u;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],jR(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,jR(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,v=0;for(a=0;a<=fR;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=u[2*u[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,v++),u[2*r+1]=a,r>l||(e.bl_count[a]++,o=0,r>=f&&(o=d[r-f]),s=u[2*r],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*r+1]+o)));if(0!==v){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,v-=2}while(v>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>l||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),r--)}}(e,t),OR(a,l,e.bl_count)},$R=function(e,t,n){var r,i,a=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<u&&i===o||(s<l?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(u=138,l=3):i===o?(u=6,l=3):(u=7,l=4))},qR=function(e,t,n){var r,i,a=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<u&&i===o)){if(s<l)do{IR(e,i,e.bl_tree)}while(0!==--s);else 0!==i?(i!==a&&(IR(e,i,e.bl_tree),s--),IR(e,16,e.bl_tree),LR(e,s-3,2)):s<=10?(IR(e,17,e.bl_tree),LR(e,s-3,3)):(IR(e,18,e.bl_tree),LR(e,s-11,7));s=0,a=i,0===o?(u=138,l=3):i===o?(u=6,l=3):(u=7,l=4)}},UR=!1,VR=function(e,t,n,r){LR(e,0+(r?1:0),3),function(e,t,n,r){DR(e),r&&(AR(e,n),AR(e,~n)),e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n}(e,t,n,!0)},HR=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<cR;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),FR(e,e.l_desc),FR(e,e.d_desc),o=function(e){var t;for($R(e,e.dyn_ltree,e.l_desc.max_code),$R(e,e.dyn_dtree,e.d_desc.max_code),FR(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*gR[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?VR(e,t,n,r):4===e.strategy||a===i?(LR(e,2+(r?1:0),3),BR(e,_R,yR)):(LR(e,4+(r?1:0),3),function(e,t,n,r){var i;for(LR(e,t-257,5),LR(e,n-1,5),LR(e,r-4,4),i=0;i<r;i++)LR(e,e.bl_tree[2*gR[i]+1],3);qR(e,e.dyn_ltree,t-1),qR(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),BR(e,e.dyn_ltree,e.dyn_dtree)),NR(e),r&&DR(e)},WR={_tr_init:function(e){UR||(!function(){var e,t,n,r,i,a=new Array(16);for(n=0,r=0;r<28;r++)for(wR[r]=n,e=0;e<1<<pR[r];e++)xR[n++]=r;for(xR[n-1]=r,i=0,r=0;r<16;r++)for(CR[r]=i,e=0;e<1<<vR[r];e++)bR[i++]=r;for(i>>=7;r<dR;r++)for(CR[r]=i<<7,e=0;e<1<<vR[r]-7;e++)bR[256+i++]=r;for(t=0;t<=fR;t++)a[t]=0;for(e=0;e<=143;)_R[2*e+1]=8,e++,a[8]++;for(;e<=255;)_R[2*e+1]=9,e++,a[9]++;for(;e<=279;)_R[2*e+1]=7,e++,a[7]++;for(;e<=287;)_R[2*e+1]=8,e++,a[8]++;for(OR(_R,287,a),e=0;e<dR;e++)yR[2*e+1]=5,yR[2*e]=RR(e,5);kR=new TR(_R,pR,257,hR,fR),SR=new TR(yR,vR,0,dR,fR),MR=new TR(new Array(0),mR,0,19,7)}(),UR=!0),e.l_desc=new ER(e.dyn_ltree,kR),e.d_desc=new ER(e.dyn_dtree,SR),e.bl_desc=new ER(e.bl_tree,MR),e.bi_buf=0,e.bi_valid=0,NR(e)},_tr_stored_block:VR,_tr_flush_block:HR,_tr_tally:function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(xR[n]+cR+1)]++,e.dyn_dtree[2*PR(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){LR(e,2,3),IR(e,256,_R),function(e){16===e.bi_valid?(AR(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},GR=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0},ZR=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),YR=function(e,t,n,r){var i=ZR,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},XR={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},KR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},JR=WR._tr_init,QR=WR._tr_stored_block,eO=WR._tr_flush_block,tO=WR._tr_tally,nO=WR._tr_align,rO=KR.Z_NO_FLUSH,iO=KR.Z_PARTIAL_FLUSH,aO=KR.Z_FULL_FLUSH,oO=KR.Z_FINISH,sO=KR.Z_BLOCK,uO=KR.Z_OK,lO=KR.Z_STREAM_END,cO=KR.Z_STREAM_ERROR,hO=KR.Z_DATA_ERROR,dO=KR.Z_BUF_ERROR,fO=KR.Z_DEFAULT_COMPRESSION,pO=KR.Z_FILTERED,vO=KR.Z_HUFFMAN_ONLY,mO=KR.Z_RLE,gO=KR.Z_FIXED,_O=KR.Z_DEFAULT_STRATEGY,yO=KR.Z_UNKNOWN,bO=KR.Z_DEFLATED,xO=258,wO=262,kO=103,SO=113,MO=666,CO=function(e,t){return e.msg=XR[t],t},TO=function(e){return(e<<1)-(e>4?9:0)},EO=function(e){for(var t=e.length;--t>=0;)e[t]=0},PO=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},AO=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},LO=function(e,t){eO(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,AO(e.strm)},IO=function(e,t){e.pending_buf[e.pending++]=t},RO=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},OO=function(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=GR(e.adler,t,i,n):2===e.state.wrap&&(e.adler=YR(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},NO=function(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-wO?e.strstart-(e.w_size-wO):0,l=e.window,c=e.w_mask,h=e.prev,d=e.strstart+xO,f=l[a+o-1],p=l[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+o]===p&&l[n+o-1]===f&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<d);if(r=xO-(d-a),a=d-xO,r>o){if(e.match_start=t,o=r,r>=s)break;f=l[a+o-1],p=l[a+o]}}}while((t=h[t&c])>u&&0!==--i);return o<=e.lookahead?o:e.lookahead},DO=function(e){var t,n,r,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-wO)){e.window.set(e.window.subarray(o,o+o),0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=o?r-o:0}while(--n);t=n=o;do{r=e.prev[--t],e.prev[t]=r>=o?r-o:0}while(--n);i+=o}if(0===e.strm.avail_in)break;if(n=OO(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=PO(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=PO(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<wO&&0!==e.strm.avail_in)},zO=function(e,t){for(var n,r;;){if(e.lookahead<wO){if(DO(e),e.lookahead<wO&&t===rO)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=PO(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-wO&&(e.match_length=NO(e,n)),e.match_length>=3)if(r=tO(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=PO(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=PO(e,e.ins_h,e.window[e.strstart+1]);else r=tO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(LO(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===oO?(LO(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LO(e,!1),0===e.strm.avail_out)?1:2},jO=function(e,t){for(var n,r,i;;){if(e.lookahead<wO){if(DO(e),e.lookahead<wO&&t===rO)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=PO(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-wO&&(e.match_length=NO(e,n),e.match_length<=5&&(e.strategy===pO||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=tO(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=PO(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(LO(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=tO(e,0,e.window[e.strstart-1]))&&LO(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=tO(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===oO?(LO(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LO(e,!1),0===e.strm.avail_out)?1:2};function BO(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var FO=[new BO(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(DO(e),0===e.lookahead&&t===rO)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,LO(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-wO&&(LO(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===oO?(LO(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(LO(e,!1),e.strm.avail_out),1)})),new BO(4,4,8,4,zO),new BO(4,5,16,8,zO),new BO(4,6,32,32,zO),new BO(4,4,16,16,jO),new BO(8,16,32,32,jO),new BO(8,16,128,128,jO),new BO(8,32,128,256,jO),new BO(32,128,258,1024,jO),new BO(32,258,258,4096,jO)];function $O(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=bO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),EO(this.dyn_ltree),EO(this.dyn_dtree),EO(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),EO(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),EO(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var qO=function(e){if(!e||!e.state)return CO(e,cO);e.total_in=e.total_out=0,e.data_type=yO;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:SO,e.adler=2===t.wrap?0:1,t.last_flush=rO,JR(t),uO},UO=function(e){var t,n=qO(e);return n===uO&&((t=e.state).window_size=2*t.w_size,EO(t.head),t.max_lazy_match=FO[t.level].max_lazy,t.good_match=FO[t.level].good_length,t.nice_match=FO[t.level].nice_length,t.max_chain_length=FO[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n},VO=function(e,t,n,r,i,a){if(!e)return cO;var o=1;if(t===fO&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==bO||r<8||r>15||t<0||t>9||a<0||a>gO)return CO(e,cO);8===r&&(r=9);var s=new $O;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,UO(e)},HO=function(e,t){var n,r;if(!e||!e.state||t>sO||t<0)return e?CO(e,cO):cO;var i=e.state;if(!e.output||!e.input&&0!==e.avail_in||i.status===MO&&t!==oO)return CO(e,0===e.avail_out?dO:cO);i.strm=e;var a=i.last_flush;if(i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,IO(i,31),IO(i,139),IO(i,8),i.gzhead?(IO(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),IO(i,255&i.gzhead.time),IO(i,i.gzhead.time>>8&255),IO(i,i.gzhead.time>>16&255),IO(i,i.gzhead.time>>24&255),IO(i,9===i.level?2:i.strategy>=vO||i.level<2?4:0),IO(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(IO(i,255&i.gzhead.extra.length),IO(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=YR(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(IO(i,0),IO(i,0),IO(i,0),IO(i,0),IO(i,0),IO(i,9===i.level?2:i.strategy>=vO||i.level<2?4:0),IO(i,3),i.status=SO);else{var o=bO+(i.w_bits-8<<4)<<8;o|=(i.strategy>=vO||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(o|=32),o+=31-o%31,i.status=SO,RO(i,o),0!==i.strstart&&(RO(i,e.adler>>>16),RO(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(e.adler=YR(e.adler,i.pending_buf,i.pending-n,n)),AO(e),n=i.pending,i.pending!==i.pending_buf_size));)IO(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(e.adler=YR(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=YR(e.adler,i.pending_buf,i.pending-n,n)),AO(e),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,IO(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>n&&(e.adler=YR(e.adler,i.pending_buf,i.pending-n,n)),0===r&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=YR(e.adler,i.pending_buf,i.pending-n,n)),AO(e),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,IO(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>n&&(e.adler=YR(e.adler,i.pending_buf,i.pending-n,n)),0===r&&(i.status=kO)}else i.status=kO;if(i.status===kO&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&AO(e),i.pending+2<=i.pending_buf_size&&(IO(i,255&e.adler),IO(i,e.adler>>8&255),e.adler=0,i.status=SO)):i.status=SO),0!==i.pending){if(AO(e),0===e.avail_out)return i.last_flush=-1,uO}else if(0===e.avail_in&&TO(t)<=TO(a)&&t!==oO)return CO(e,dO);if(i.status===MO&&0!==e.avail_in)return CO(e,dO);if(0!==e.avail_in||0!==i.lookahead||t!==rO&&i.status!==MO){var s=i.strategy===vO?function(e,t){for(var n;;){if(0===e.lookahead&&(DO(e),0===e.lookahead)){if(t===rO)return 1;break}if(e.match_length=0,n=tO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(LO(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===oO?(LO(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LO(e,!1),0===e.strm.avail_out)?1:2}(i,t):i.strategy===mO?function(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=xO){if(DO(e),e.lookahead<=xO&&t===rO)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=e.strstart+xO;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=xO-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=tO(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=tO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(LO(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===oO?(LO(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LO(e,!1),0===e.strm.avail_out)?1:2}(i,t):FO[i.level].func(i,t);if(3!==s&&4!==s||(i.status=MO),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),uO;if(2===s&&(t===iO?nO(i):t!==sO&&(QR(i,0,0,!1),t===aO&&(EO(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),AO(e),0===e.avail_out))return i.last_flush=-1,uO}return t!==oO?uO:i.wrap<=0?lO:(2===i.wrap?(IO(i,255&e.adler),IO(i,e.adler>>8&255),IO(i,e.adler>>16&255),IO(i,e.adler>>24&255),IO(i,255&e.total_in),IO(i,e.total_in>>8&255),IO(i,e.total_in>>16&255),IO(i,e.total_in>>24&255)):(RO(i,e.adler>>>16),RO(i,65535&e.adler)),AO(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?uO:lO)},WO={deflateInit:function(e,t){return VO(e,t,bO,15,8,_O)},deflateInit2:VO,deflateReset:UO,deflateResetKeep:qO,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?cO:(e.state.gzhead=t,uO):cO},deflate:HO,deflateEnd:function(e){if(!e||!e.state)return cO;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==kO&&t!==SO&&t!==MO?CO(e,cO):(e.state=null,t===SO?CO(e,hO):uO)},deflateSetDictionary:function(e,t){var n=t.length;if(!e||!e.state)return cO;var r=e.state,i=r.wrap;if(2===i||1===i&&42!==r.status||r.lookahead)return cO;if(1===i&&(e.adler=GR(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(EO(r.head),r.strstart=0,r.block_start=0,r.insert=0);var a=new Uint8Array(r.w_size);a.set(t.subarray(n-r.w_size,n),0),t=a,n=r.w_size}var o=e.avail_in,s=e.next_in,u=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,DO(r);r.lookahead>=3;){var l=r.strstart,c=r.lookahead-2;do{r.ins_h=PO(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++}while(--c);r.strstart=l,r.lookahead=2,DO(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=u,e.avail_in=o,r.wrap=i,uO},deflateInfo:"pako deflate (from Nodeca project)"},GO=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},ZO=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var r in n)GO(n,r)&&(e[r]=n[r])}}return e},YO=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),a=0,o=0,s=e.length;a<s;a++){var u=e[a];i.set(u,o),o+=u.length}return i},XO=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Dz){XO=!1}for(var KO=new Uint8Array(256),JO=0;JO<256;JO++)KO[JO]=JO>=252?6:JO>=248?5:JO>=240?4:JO>=224?3:JO>=192?2:1;KO[254]=KO[254]=1;var QO=function(e){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296===(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320===(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)55296===(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320===(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},eN=function(e,t){var n,r,i=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*i);for(r=0,n=0;n<i;){var o=e[n++];if(o<128)a[r++]=o;else{var s=KO[o];if(s>4)a[r++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<i;)o=o<<6|63&e[n++],s--;s>1?a[r++]=65533:o<65536?a[r++]=o:(o-=65536,a[r++]=55296|o>>10&1023,a[r++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&XO)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(a,r)},tN=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+KO[e[n]]>t?n:t};var nN=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},rN=Object.prototype.toString,iN=KR.Z_NO_FLUSH,aN=KR.Z_SYNC_FLUSH,oN=KR.Z_FULL_FLUSH,sN=KR.Z_FINISH,uN=KR.Z_OK,lN=KR.Z_STREAM_END,cN=KR.Z_DEFAULT_COMPRESSION,hN=KR.Z_DEFAULT_STRATEGY,dN=KR.Z_DEFLATED;function fN(e){this.options=ZO({level:cN,method:dN,chunkSize:16384,windowBits:15,memLevel:8,strategy:hN},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nN,this.strm.avail_out=0;var n=WO.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==uN)throw new Error(XR[n]);if(t.header&&WO.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"===typeof t.dictionary?QO(t.dictionary):"[object ArrayBuffer]"===rN.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=WO.deflateSetDictionary(this.strm,r))!==uN)throw new Error(XR[n]);this._dict_set=!0}}fN.prototype.push=function(e,t){var n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?sN:iN,"string"===typeof e?i.input=QO(e):"[object ArrayBuffer]"===rN.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===aN||r===oN)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if((n=WO.deflate(i,r))===lN)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=WO.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===uN;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},fN.prototype.onData=function(e){this.chunks.push(e)},fN.prototype.onEnd=function(e){e===uN&&(this.result=YO(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var pN=function(e,t){var n,r,i,a,o,s,u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S,M,C=e.state;n=e.next_in,S=e.input,r=n+(e.avail_in-5),i=e.next_out,M=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=C.dmax,u=C.wsize,l=C.whave,c=C.wnext,h=C.window,d=C.hold,f=C.bits,p=C.lencode,v=C.distcode,m=(1<<C.lenbits)-1,g=(1<<C.distbits)-1;e:do{f<15&&(d+=S[n++]<<f,f+=8,d+=S[n++]<<f,f+=8),_=p[d&m];t:for(;;){if(d>>>=y=_>>>24,f-=y,0===(y=_>>>16&255))M[i++]=65535&_;else{if(!(16&y)){if(0===(64&y)){_=p[(65535&_)+(d&(1<<y)-1)];continue t}if(32&y){C.mode=12;break e}e.msg="invalid literal/length code",C.mode=30;break e}b=65535&_,(y&=15)&&(f<y&&(d+=S[n++]<<f,f+=8),b+=d&(1<<y)-1,d>>>=y,f-=y),f<15&&(d+=S[n++]<<f,f+=8,d+=S[n++]<<f,f+=8),_=v[d&g];n:for(;;){if(d>>>=y=_>>>24,f-=y,!(16&(y=_>>>16&255))){if(0===(64&y)){_=v[(65535&_)+(d&(1<<y)-1)];continue n}e.msg="invalid distance code",C.mode=30;break e}if(x=65535&_,f<(y&=15)&&(d+=S[n++]<<f,(f+=8)<y&&(d+=S[n++]<<f,f+=8)),(x+=d&(1<<y)-1)>s){e.msg="invalid distance too far back",C.mode=30;break e}if(d>>>=y,f-=y,x>(y=i-a)){if((y=x-y)>l&&C.sane){e.msg="invalid distance too far back",C.mode=30;break e}if(w=0,k=h,0===c){if(w+=u-y,y<b){b-=y;do{M[i++]=h[w++]}while(--y);w=i-x,k=M}}else if(c<y){if(w+=u+c-y,(y-=c)<b){b-=y;do{M[i++]=h[w++]}while(--y);if(w=0,c<b){b-=y=c;do{M[i++]=h[w++]}while(--y);w=i-x,k=M}}}else if(w+=c-y,y<b){b-=y;do{M[i++]=h[w++]}while(--y);w=i-x,k=M}for(;b>2;)M[i++]=k[w++],M[i++]=k[w++],M[i++]=k[w++],b-=3;b&&(M[i++]=k[w++],b>1&&(M[i++]=k[w++]))}else{w=i-x;do{M[i++]=M[w++],M[i++]=M[w++],M[i++]=M[w++],b-=3}while(b>2);b&&(M[i++]=M[w++],b>1&&(M[i++]=M[w++]))}break}}break}}while(n<r&&i<o);n-=b=f>>3,d&=(1<<(f-=b<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),C.hold=d,C.bits=f},vN=15,mN=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),gN=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_N=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),yN=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bN=function(e,t,n,r,i,a,o,s){var u,l,c,h,d,f,p,v,m,g=s.bits,_=0,y=0,b=0,x=0,w=0,k=0,S=0,M=0,C=0,T=0,E=null,P=0,A=new Uint16Array(16),L=new Uint16Array(16),I=null,R=0;for(_=0;_<=vN;_++)A[_]=0;for(y=0;y<r;y++)A[t[n+y]]++;for(w=g,x=vN;x>=1&&0===A[x];x--);if(w>x&&(w=x),0===x)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(b=1;b<x&&0===A[b];b++);for(w<b&&(w=b),M=1,_=1;_<=vN;_++)if(M<<=1,(M-=A[_])<0)return-1;if(M>0&&(0===e||1!==x))return-1;for(L[1]=0,_=1;_<vN;_++)L[_+1]=L[_]+A[_];for(y=0;y<r;y++)0!==t[n+y]&&(o[L[t[n+y]]++]=y);if(0===e?(E=I=o,f=19):1===e?(E=mN,P-=257,I=gN,R-=257,f=256):(E=_N,I=yN,f=-1),T=0,y=0,_=b,d=a,k=w,S=0,c=-1,h=(C=1<<w)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){p=_-S,o[y]<f?(v=0,m=o[y]):o[y]>f?(v=I[R+o[y]],m=E[P+o[y]]):(v=96,m=0),u=1<<_-S,b=l=1<<k;do{i[d+(T>>S)+(l-=u)]=p<<24|v<<16|m|0}while(0!==l);for(u=1<<_-1;T&u;)u>>=1;if(0!==u?(T&=u-1,T+=u):T=0,y++,0===--A[_]){if(_===x)break;_=t[n+o[y]]}if(_>w&&(T&h)!==c){for(0===S&&(S=w),d+=b,M=1<<(k=_-S);k+S<x&&!((M-=A[k+S])<=0);)k++,M<<=1;if(C+=1<<k,1===e&&C>852||2===e&&C>592)return 1;i[c=T&h]=w<<24|k<<16|d-a|0}}return 0!==T&&(i[d+T]=_-S<<24|64<<16|0),s.bits=w,0},xN=KR.Z_FINISH,wN=KR.Z_BLOCK,kN=KR.Z_TREES,SN=KR.Z_OK,MN=KR.Z_STREAM_END,CN=KR.Z_NEED_DICT,TN=KR.Z_STREAM_ERROR,EN=KR.Z_DATA_ERROR,PN=KR.Z_MEM_ERROR,AN=KR.Z_BUF_ERROR,LN=KR.Z_DEFLATED,IN=12,RN=30,ON=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function NN(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var DN,zN,jN=function(e){if(!e||!e.state)return TN;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,SN},BN=function(e){if(!e||!e.state)return TN;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,jN(e)},FN=function(e,t){var n;if(!e||!e.state)return TN;var r=e.state;return t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?TN:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,BN(e))},$N=function(e,t){if(!e)return TN;var n=new NN;e.state=n,n.window=null;var r=FN(e,t);return r!==SN&&(e.state=null),r},qN=!0,UN=function(e){if(qN){DN=new Int32Array(512),zN=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bN(1,e.lens,0,288,DN,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bN(2,e.lens,0,32,zN,0,e.work,{bits:5}),qN=!1}e.lencode=DN,e.lenbits=9,e.distcode=zN,e.distbits=5},VN=function(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},HN=function(e,t){var n,r,i,a,o,s,u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S,M,C=0,T=new Uint8Array(4),E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return TN;(n=e.state).mode===IN&&(n.mode=13),o=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=n.hold,c=n.bits,h=s,d=u,k=SN;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(2&n.wrap&&35615===l){n.check=0,T[0]=255&l,T[1]=l>>>8&255,n.check=YR(n.check,T,2,0),l=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=RN;break}if((15&l)!==LN){e.msg="unknown compression method",n.mode=RN;break}if(c-=4,w=8+(15&(l>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=RN;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=512&l?10:IN,l=0,c=0;break;case 2:for(;c<16;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(n.flags=l,(255&n.flags)!==LN){e.msg="unknown compression method",n.mode=RN;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=RN;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(T[0]=255&l,T[1]=l>>>8&255,n.check=YR(n.check,T,2,0)),l=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}n.head&&(n.head.time=l),512&n.flags&&(T[0]=255&l,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,n.check=YR(n.check,T,4,0)),l=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(T[0]=255&l,T[1]=l>>>8&255,n.check=YR(n.check,T,2,0)),l=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(T[0]=255&l,T[1]=l>>>8&255,n.check=YR(n.check,T,2,0)),l=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((f=n.length)>s&&(f=s),f&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+f),w)),512&n.flags&&(n.check=YR(n.check,r,f,a)),s-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;f=0;do{w=r[a+f++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&f<s);if(512&n.flags&&(n.check=YR(n.check,r,f,a)),s-=f,a+=f,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;f=0;do{w=r[a+f++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&f<s);if(512&n.flags&&(n.check=YR(n.check,r,f,a)),s-=f,a+=f,w)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=RN;break}l=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=IN;break;case 10:for(;c<32;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}e.adler=n.check=ON(l),l=0,c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=c,CN;e.adler=n.check=1,n.mode=IN;case IN:if(t===wN||t===kN)break e;case 13:if(n.last){l>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}switch(n.last=1&l,c-=1,3&(l>>>=1)){case 0:n.mode=14;break;case 1:if(UN(n),n.mode=20,t===kN){l>>>=2,c-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=RN}l>>>=2,c-=2;break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if((65535&l)!==(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=RN;break}if(n.length=65535&l,l=0,c=0,n.mode=15,t===kN)break e;case 15:n.mode=16;case 16:if(f=n.length){if(f>s&&(f=s),f>u&&(f=u),0===f)break e;i.set(r.subarray(a,a+f),o),s-=f,a+=f,u-=f,o+=f,n.length-=f;break}n.mode=IN;break;case 17:for(;c<14;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(n.nlen=257+(31&l),l>>>=5,c-=5,n.ndist=1+(31&l),l>>>=5,c-=5,n.ncode=4+(15&l),l>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=RN;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}n.lens[E[n.have++]]=7&l,l>>>=3,c-=3}for(;n.have<19;)n.lens[E[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},k=bN(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,k){e.msg="invalid code lengths set",n.mode=RN;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;g=(C=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&C,!((m=C>>>24)<=c);){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(_<16)l>>>=m,c-=m,n.lens[n.have++]=_;else{if(16===_){for(M=m+2;c<M;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(l>>>=m,c-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=RN;break}w=n.lens[n.have-1],f=3+(3&l),l>>>=2,c-=2}else if(17===_){for(M=m+3;c<M;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}c-=m,w=0,f=3+(7&(l>>>=m)),l>>>=3,c-=3}else{for(M=m+7;c<M;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}c-=m,w=0,f=11+(127&(l>>>=m)),l>>>=7,c-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=RN;break}for(;f--;)n.lens[n.have++]=w}}if(n.mode===RN)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=RN;break}if(n.lenbits=9,S={bits:n.lenbits},k=bN(1,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,k){e.msg="invalid literal/lengths set",n.mode=RN;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},k=bN(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,k){e.msg="invalid distances set",n.mode=RN;break}if(n.mode=20,t===kN)break e;case 20:n.mode=21;case 21:if(s>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=c,pN(e,d),o=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=n.hold,c=n.bits,n.mode===IN&&(n.back=-1);break}for(n.back=0;g=(C=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&C,!((m=C>>>24)<=c);){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(g&&0===(240&g)){for(y=m,b=g,x=_;g=(C=n.lencode[x+((l&(1<<y+b)-1)>>y)])>>>16&255,_=65535&C,!(y+(m=C>>>24)<=c);){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}l>>>=y,c-=y,n.back+=y}if(l>>>=m,c-=m,n.back+=m,n.length=_,0===g){n.mode=26;break}if(32&g){n.back=-1,n.mode=IN;break}if(64&g){e.msg="invalid literal/length code",n.mode=RN;break}n.extra=15&g,n.mode=22;case 22:if(n.extra){for(M=n.extra;c<M;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;g=(C=n.distcode[l&(1<<n.distbits)-1])>>>16&255,_=65535&C,!((m=C>>>24)<=c);){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(0===(240&g)){for(y=m,b=g,x=_;g=(C=n.distcode[x+((l&(1<<y+b)-1)>>y)])>>>16&255,_=65535&C,!(y+(m=C>>>24)<=c);){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}l>>>=y,c-=y,n.back+=y}if(l>>>=m,c-=m,n.back+=m,64&g){e.msg="invalid distance code",n.mode=RN;break}n.offset=_,n.extra=15&g,n.mode=24;case 24:if(n.extra){for(M=n.extra;c<M;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=RN;break}n.mode=25;case 25:if(0===u)break e;if(f=d-u,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=RN;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=i,p=o-n.offset,f=n.length;f>u&&(f=u),u-=f,n.length-=f;do{i[o++]=v[p++]}while(--f);0===n.length&&(n.mode=21);break;case 26:if(0===u)break e;i[o++]=n.length,u--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===s)break e;s--,l|=r[a++]<<c,c+=8}if(d-=u,e.total_out+=d,n.total+=d,d&&(e.adler=n.check=n.flags?YR(n.check,i,d,o-d):GR(n.check,i,d,o-d)),d=u,(n.flags?l:ON(l))!==n.check){e.msg="incorrect data check",n.mode=RN;break}l=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===s)break e;s--,l+=r[a++]<<c,c+=8}if(l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=RN;break}l=0,c=0}n.mode=29;case 29:k=MN;break e;case RN:k=EN;break e;case 31:return PN;default:return TN}return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=c,(n.wsize||d!==e.avail_out&&n.mode<RN&&(n.mode<27||t!==xN))&&VN(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?YR(n.check,i,d,e.next_out-d):GR(n.check,i,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===IN?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===d||t===xN)&&k===SN&&(k=AN),k},WN={inflateReset:BN,inflateReset2:FN,inflateResetKeep:jN,inflateInit:function(e){return $N(e,15)},inflateInit2:$N,inflate:HN,inflateEnd:function(e){if(!e||!e.state)return TN;var t=e.state;return t.window&&(t.window=null),e.state=null,SN},inflateGetHeader:function(e,t){if(!e||!e.state)return TN;var n=e.state;return 0===(2&n.wrap)?TN:(n.head=t,t.done=!1,SN)},inflateSetDictionary:function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?TN:11===n.mode&&GR(1,t,r,0)!==n.check?EN:VN(e,t,r,r)?(n.mode=31,PN):(n.havedict=1,SN):TN},inflateInfo:"pako inflate (from Nodeca project)"};var GN=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},ZN=Object.prototype.toString,YN=KR.Z_NO_FLUSH,XN=KR.Z_FINISH,KN=KR.Z_OK,JN=KR.Z_STREAM_END,QN=KR.Z_NEED_DICT,eD=KR.Z_STREAM_ERROR,tD=KR.Z_DATA_ERROR,nD=KR.Z_MEM_ERROR;function rD(e){this.options=ZO({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nN,this.strm.avail_out=0;var n=WN.inflateInit2(this.strm,t.windowBits);if(n!==KN)throw new Error(XR[n]);if(this.header=new GN,WN.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=QO(t.dictionary):"[object ArrayBuffer]"===ZN.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=WN.inflateSetDictionary(this.strm,t.dictionary))!==KN))throw new Error(XR[n])}function iD(e,t){var n=new rD(t);if(n.push(e),n.err)throw n.msg||XR[n.err];return n.result}rD.prototype.push=function(e,t){var n,r,i,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?XN:YN,"[object ArrayBuffer]"===ZN.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),(n=WN.inflate(a,r))===QN&&s&&((n=WN.inflateSetDictionary(a,s))===KN?n=WN.inflate(a,r):n===tD&&(n=QN));a.avail_in>0&&n===JN&&a.state.wrap>0&&0!==e[a.next_in];)WN.inflateReset(a),n=WN.inflate(a,r);switch(n){case eD:case tD:case QN:case nD:return this.onEnd(n),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||n===JN))if("string"===this.options.to){var u=tN(a.output,a.next_out),l=a.next_out-u,c=eN(a.output,u);a.next_out=l,a.avail_out=o-l,l&&a.output.set(a.output.subarray(u,u+l),0),this.onData(c)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==KN||0!==i){if(n===JN)return n=WN.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},rD.prototype.onData=function(e){this.chunks.push(e)},rD.prototype.onEnd=function(e){e===KN&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=YO(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var aD={Inflate:rD,inflate:iD,inflateRaw:function(e,t){return(t=t||{}).raw=!0,iD(e,t)},ungzip:iD,constants:KR},oD=aD.inflate,sD={read:function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=l}return(f?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,n,r,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?d/u:d*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+f]=255&o,f+=p,o/=256,l-=8);e[n+f-p]|=128*v}},uD=cD,lD=sD;function cD(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}cD.Varint=0,cD.Fixed64=1,cD.Bytes=2,cD.Fixed32=5;var hD=4294967296,dD=1/hD,fD="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function pD(e){return e.type===cD.Bytes?e.readVarint()+e.pos:e.pos+1}function vD(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function mD(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function gD(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function _D(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function yD(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function bD(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function xD(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function wD(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function kD(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function SD(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function MD(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function CD(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function TD(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function ED(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function PD(e,t){return AD(e,"GET","arraybuffer",[],null,t)}function AD(e,t,n,r,i,a){var o=new XMLHttpRequest,s=new Promise((function(a,s){o.open(t,e,!0);var u,l=Ad(r);try{for(l.s();!(u=l.n()).done;){var c=u.value;o.setRequestHeader(c.name,c.value)}}catch(CO){l.e(CO)}finally{l.f()}o.responseType=n,o.timeout=15e3,o.onload=function(){var t;if(200!==o.status){var n=null!==(t=o.response)&&void 0!==t?t:new VM("Response status error: ".concat(e));s(n)}o.response||s(new VM("Response empty: ".concat(e))),a(o.response)},o.onerror=function(){s(new VM("Request error: ".concat(e)))},o.ontimeout=function(){s(new VM("Request timeout: ".concat(e)))},o.onabort=function(){s(new VM("Request aborted: ".concat(e)))},o.send("POST"===t?i:null)}));return a&&a.catch((function(){o.abort()})),s}function LD(e,t,n){1===e?t.vertices.push(n.readFloat()):2===e?t.faces.push(n.readVarint()):console.warn("Unsupported pbf tag (".concat(e,")"))}cD.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,a=this.pos;this.type=7&r,e(i,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=CD(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=ED(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=CD(this.buf,this.pos)+CD(this.buf,this.pos+4)*hD;return this.pos+=8,e},readSFixed64:function(){var e=CD(this.buf,this.pos)+ED(this.buf,this.pos+4)*hD;return this.pos+=8,e},readFloat:function(){var e=lD.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=lD.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,a=n.buf;if(i=a[n.pos++],r=(112&i)>>4,i<128)return vD(e,r,t);if(i=a[n.pos++],r|=(127&i)<<3,i<128)return vD(e,r,t);if(i=a[n.pos++],r|=(127&i)<<10,i<128)return vD(e,r,t);if(i=a[n.pos++],r|=(127&i)<<17,i<128)return vD(e,r,t);if(i=a[n.pos++],r|=(127&i)<<24,i<128)return vD(e,r,t);if(i=a[n.pos++],r|=(1&i)<<31,i<128)return vD(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&fD?function(e,t,n){return fD.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var a,o,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128===(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(a=e[i+1],o=e[i+2],128===(192&a)&&128===(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=e[i+1],o=e[i+2],s=e[i+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==cD.Bytes)return e.push(this.readVarint(t));var n=pD(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==cD.Bytes)return e.push(this.readSVarint());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==cD.Bytes)return e.push(this.readBoolean());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==cD.Bytes)return e.push(this.readFloat());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==cD.Bytes)return e.push(this.readDouble());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==cD.Bytes)return e.push(this.readFixed32());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==cD.Bytes)return e.push(this.readSFixed32());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==cD.Bytes)return e.push(this.readFixed64());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==cD.Bytes)return e.push(this.readSFixed64());var t=pD(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===cD.Varint)for(;this.buf[this.pos++]>127;);else if(t===cD.Bytes)this.pos=this.readVarint()+this.pos;else if(t===cD.Fixed32)this.pos+=4;else{if(t!==cD.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),TD(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),TD(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),TD(this.buf,-1&e,this.pos),TD(this.buf,Math.floor(e*dD),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),TD(this.buf,-1&e,this.pos),TD(this.buf,Math.floor(e*dD),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){r>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&mD(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),lD.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),lD.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&mD(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,cD.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,gD,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,_D,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,xD,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,yD,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,bD,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,wD,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,kD,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,SD,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,MD,t)},writeBytesField:function(e,t){this.writeTag(e,cD.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,cD.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,cD.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,cD.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,cD.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,cD.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,cD.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,cD.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,cD.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,cD.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var ID,RD=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this))._geometry=e,r}return $d(n,[{key:"geometry",get:function(){return this._geometry}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"getCoreImages",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getCluster",value:function(e,t){return Promise.reject(new VM("Not implemented"))}},{key:"getSpatialImages",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getImages",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getImageBuffer",value:function(e,t){return Promise.reject(new VM("Not implemented"))}},{key:"getImageTiles",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getMesh",value:function(e,t){return Promise.reject(new VM("Not implemented"))}},{key:"getSequence",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"setAccessToken",value:function(e){throw new VM("Not implemented")}}]),n}(bP),OD=function(){function e(){Bd(this,e)}return $d(e,[{key:"bboxToCellIds",value:function(e,t){throw new VM("Not implemented")}},{key:"getAdjacent",value:function(e){throw new VM("Not implemented")}},{key:"getVertices",value:function(e){throw new VM("Not implemented")}},{key:"lngLatToCellId",value:function(e){throw new VM("Not implemented")}},{key:"_approxBboxToCellIds",value:function(e,t){if(t.lat<=e.lat||t.lng<=e.lng)throw new VM("North east needs to be top right of south west");var n=(e.lat+t.lat)/2,r=(e.lng+t.lng)/2,i=RM(t.lng,t.lat,0,r,n,0),a=Math.max(i[0],i[1]);return this._lngLatToCellIds({lat:n,lng:r},a)}},{key:"_enuToGeodetic",value:function(e,t){var n=o(OM(e[0],e[1],e[2],t.lng,t.lat,0),2),r=n[0];return{lat:n[1],lng:r}}},{key:"_getLngLatBoundingBoxCorners",value:function(e,t){var n=this;return[[-t,t,0],[t,t,0],[t,-t,0],[-t,-t,0]].map((function(t){return n._enuToGeodetic(t,e)}))}},{key:"_lngLatToCellIds",value:function(e,t){var n,r=this.lngLatToCellId(e),i=Ad(this._getLngLatBoundingBoxCorners(e,t));try{for(i.s();!(n=i.n()).done;){var a=n.value;if(this.lngLatToCellId(a)!==r)return[r].concat(xd(this.getAdjacent(r)))}}catch(CO){i.e(CO)}finally{i.f()}return[r]}}]),e}(),ND={exports:{}},DD={exports:{}};ID=DD,function(e,t){ID&&ID.exports?ID.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(wC,(function(){function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var n={},r={};function i(e,t){var i,a,s;return t?(s=0<=(e>>>=0)&&e<256)&&(a=r[e])?a:(i=o(e,(0|e)<0?-1:0,!0),s&&(r[e]=i),i):(s=-128<=(e|=0)&&e<128)&&(a=n[e])?a:(i=o(e,e<0?-1:0,!1),s&&(n[e]=i),i)}function a(e,t){if(isNaN(e)||!isFinite(e))return t?v:p;if(t){if(e<0)return v;if(e>=h)return b}else{if(e<=-d)return x;if(e+1>=d)return y}return e<0?a(-e,t).neg():o(e%c|0,e/c|0,t)}function o(t,n,r){return new e(t,n,r)}e.fromInt=i,e.fromNumber=a,e.fromBits=o;var s=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return u(e.substring(1),t,n).neg();for(var i=a(s(n,8)),o=p,l=0;l<e.length;l+=8){var c=Math.min(8,e.length-l),h=parseInt(e.substring(l,l+c),n);if(c<8){var d=a(s(n,c));o=o.mul(d).add(a(h))}else o=(o=o.mul(i)).add(a(h))}return o.unsigned=t,o}function l(t){return t instanceof e?t:"number"===typeof t?a(t):"string"===typeof t?u(t):o(t.low,t.high,t.unsigned)}e.fromString=u,e.fromValue=l;var c=4294967296,h=c*c,d=h/2,f=i(1<<24),p=i(0);e.ZERO=p;var v=i(0,!0);e.UZERO=v;var m=i(1);e.ONE=m;var g=i(1,!0);e.UONE=g;var _=i(-1);e.NEG_ONE=_;var y=o(-1,2147483647,!1);e.MAX_VALUE=y;var b=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=b;var x=o(0,-2147483648,!1);e.MIN_VALUE=x;var w=e.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},w.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var t=a(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=a(s(e,6),this.unsigned),o=this,u="";;){var l=o.div(i),c=(o.sub(l.mul(i)).toInt()>>>0).toString(e);if((o=l).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1===(1&this.low)},w.isEven=function(){return 0===(1&this.low)},w.equals=function(e){return t(e)||(e=l(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&this.high===e.high&&this.low===e.low},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.lessThan=function(e){return this.comp(e)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return this.comp(e)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(e){return this.comp(e)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return this.comp(e)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(e){if(t(e)||(e=l(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(m)},w.neg=w.negate,w.add=function(e){t(e)||(e=l(e));var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,a=65535&this.low,s=e.high>>>16,u=65535&e.high,c=e.low>>>16,h=0,d=0,f=0,p=0;return f+=(p+=a+(65535&e.low))>>>16,d+=(f+=i+c)>>>16,h+=(d+=r+u)>>>16,h+=n+s,o((f&=65535)<<16|(p&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},w.subtract=function(e){return t(e)||(e=l(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){if(this.isZero())return p;if(t(e)||(e=l(e)),e.isZero())return p;if(this.eq(x))return e.isOdd()?x:p;if(e.eq(x))return this.isOdd()?x:p;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return a(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,s=65535&this.low,u=e.high>>>16,c=65535&e.high,h=e.low>>>16,d=65535&e.low,v=0,m=0,g=0,_=0;return g+=(_+=s*d)>>>16,m+=(g+=i*d)>>>16,g&=65535,m+=(g+=s*h)>>>16,v+=(m+=r*d)>>>16,m&=65535,v+=(m+=i*h)>>>16,m&=65535,v+=(m+=s*c)>>>16,v+=n*d+r*h+i*c+s*u,o((g&=65535)<<16|(_&=65535),(v&=65535)<<16|(m&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(e){if(t(e)||(e=l(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?v:p;var n,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return g;i=v}else{if(this.eq(x))return e.eq(m)||e.eq(_)?x:e.eq(x)?m:(n=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?m:_:(r=this.sub(e.mul(n)),i=n.add(r.div(e)));if(e.eq(x))return this.unsigned?v:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=p}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:s(2,o-48),c=a(n),h=c.mul(e);h.isNegative()||h.gt(r);)h=(c=a(n-=u,this.unsigned)).mul(e);c.isZero()&&(c=m),i=i.add(c),r=r.sub(h)}return i},w.div=w.divide,w.modulo=function(e){return t(e)||(e=l(e)),this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(e){return t(e)||(e=l(e)),o(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return t(e)||(e=l(e)),o(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return t(e)||(e=l(e)),o(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?o(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):o(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?o(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):o(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var n=this.high;return e<32?o(this.low>>>e|n<<32-e,n>>>e,this.unsigned):o(32===e?n:n>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})),function(e){!function(e){var t=e.S2={L:{}};t.L.LatLng=function(e,t,n){var r=parseFloat(e,10),i=parseFloat(t,10);if(isNaN(r)||isNaN(i))throw new Error("Invalid LatLng object: ("+e+", "+t+")");return!0!==n&&(r=Math.max(Math.min(r,90),-90),i=(i+180)%360+(i<-180||180===i?180:-180)),{lat:r,lng:i}},t.L.LatLng.DEG_TO_RAD=Math.PI/180,t.L.LatLng.RAD_TO_DEG=180/Math.PI,t.LatLngToXYZ=function(e){var n=t.L.LatLng.DEG_TO_RAD,r=e.lat*n,i=e.lng*n,a=Math.cos(r);return[Math.cos(i)*a,Math.sin(i)*a,Math.sin(r)]},t.XYZToLatLng=function(e){var n=t.L.LatLng.RAD_TO_DEG,r=Math.atan2(e[2],Math.sqrt(e[0]*e[0]+e[1]*e[1])),i=Math.atan2(e[1],e[0]);return t.L.LatLng(r*n,i*n)};t.XYZToFaceUV=function(e){var t=function(e){var t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t[0]>t[1]?t[0]>t[2]?0:2:t[1]>t[2]?1:2}(e);e[t]<0&&(t+=3);var n=function(e,t){var n,r;switch(e){case 0:n=t[1]/t[0],r=t[2]/t[0];break;case 1:n=-t[0]/t[1],r=t[2]/t[1];break;case 2:n=-t[0]/t[2],r=-t[1]/t[2];break;case 3:n=t[2]/t[0],r=t[1]/t[0];break;case 4:n=t[2]/t[1],r=-t[0]/t[1];break;case 5:n=-t[1]/t[2],r=-t[0]/t[2];break;default:throw{error:"Invalid face"}}return[n,r]}(t,e);return[t,n]},t.FaceUVToXYZ=function(e,t){var n=t[0],r=t[1];switch(e){case 0:return[1,n,r];case 1:return[-n,1,r];case 2:return[-n,-r,1];case 3:return[-1,-r,-n];case 4:return[r,-1,-n];case 5:return[r,n,-1];default:throw{error:"Invalid face"}}};var n=function(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))};t.STToUV=function(e){return[n(e[0]),n(e[1])]};var r=function(e){return e>=0?.5*Math.sqrt(1+3*e):1-.5*Math.sqrt(1-3*e)};t.UVToST=function(e){return[r(e[0]),r(e[1])]},t.STToIJ=function(e,t){var n=1<<t,r=function(e){var t=Math.floor(e*n);return Math.max(0,Math.min(n-1,t))};return[r(e[0]),r(e[1])]},t.IJToST=function(e,t,n){var r=1<<t;return[(e[0]+n[0])/r,(e[1]+n[1])/r]};var i=function(e,t,n,r){if(0==r){1==n&&(t.x=e-1-t.x,t.y=e-1-t.y);var i=t.x;t.x=t.y,t.y=i}},a=function(e,t,n,r){var i={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};"number"!==typeof r&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var a=r%2?"d":"a",o=[],s=n-1;s>=0;s--){var u=1<<s,l=i[a][2*(e&u?1:0)+(t&u?1:0)];o.push(l[0]),a=l[1]}return o};t.S2Cell=function(){},t.S2Cell.FromHilbertQuadKey=function(e){var n,r,a,o,s,u,l=e.split("/"),c=parseInt(l[0]),h=l[1],d=h.length,f={x:0,y:0};for(n=d-1;n>=0;n--)r=d-n,o=0,s=0,"1"===(a=h[n])?s=1:"2"===a?(o=1,s=1):"3"===a&&(o=1),u=Math.pow(2,r-1),i(u,f,o,s),f.x+=u*o,f.y+=u*s;if(c%2===1){var p=f.x;f.x=f.y,f.y=p}return t.S2Cell.FromFaceIJ(parseInt(c),[f.x,f.y],r)},t.S2Cell.FromLatLng=function(e,n){if(!e.lat&&0!==e.lat||!e.lng&&0!==e.lng)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var r=t.LatLngToXYZ(e),i=t.XYZToFaceUV(r),a=t.UVToST(i[1]),o=t.STToIJ(a,n);return t.S2Cell.FromFaceIJ(i[0],o,n)},t.S2Cell.FromFaceIJ=function(e,n,r){var i=new t.S2Cell;return i.face=e,i.ij=n,i.level=r,i},t.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},t.S2Cell.prototype.getLatLng=function(){var e=t.IJToST(this.ij,this.level,[.5,.5]),n=t.STToUV(e),r=t.FaceUVToXYZ(this.face,n);return t.XYZToLatLng(r)},t.S2Cell.prototype.getCornerLatLngs=function(){for(var e=[],n=[[0,0],[0,1],[1,1],[1,0]],r=0;r<4;r++){var i=t.IJToST(this.ij,this.level,n[r]),a=t.STToUV(i),o=t.FaceUVToXYZ(this.face,a);e.push(t.XYZToLatLng(o))}return e},t.S2Cell.prototype.getFaceAndQuads=function(){var e=a(this.ij[0],this.ij[1],this.level,this.face);return[this.face,e]},t.S2Cell.prototype.toHilbertQuadkey=function(){var e=a(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+e.join("")},t.latLngToNeighborKeys=t.S2Cell.latLngToNeighborKeys=function(e,n,r){return t.S2Cell.FromLatLng({lat:e,lng:n},r).getNeighbors().map((function(e){return e.toHilbertQuadkey()}))},t.S2Cell.prototype.getNeighbors=function(){var e=function(e,n,r){var i=1<<r;if(n[0]>=0&&n[1]>=0&&n[0]<i&&n[1]<i)return t.S2Cell.FromFaceIJ(e,n,r);var a=t.IJToST(n,r,[.5,.5]),o=t.STToUV(a),s=t.FaceUVToXYZ(e,o),u=t.XYZToFaceUV(s);return e=u[0],o=u[1],a=t.UVToST(o),n=t.STToIJ(a,r),t.S2Cell.FromFaceIJ(e,n,r)},n=this.face,r=this.ij[0],i=this.ij[1],a=this.level;return[e(n,[r-1,i],a),e(n,[r,i-1],a),e(n,[r+1,i],a),e(n,[r,i+1],a)]},t.FACE_BITS=3,t.MAX_LEVEL=30,t.POS_BITS=2*t.MAX_LEVEL+1,t.facePosLevelToId=t.S2Cell.facePosLevelToId=t.fromFacePosLevel=function(n,r,i){var a,o,s,u=e.dcodeIO&&e.dcodeIO.Long||DD.exports;for(i||(i=r.length),r.length>i&&(r=r.substr(0,i)),a=u.fromString(n.toString(10),!0,10).toString(2);a.length<t.FACE_BITS;)a="0"+a;for(o=u.fromString(r,!0,4).toString(2);o.length<2*i;)o="0"+o;for(s=a+o,s+="1";s.length<t.FACE_BITS+t.POS_BITS;)s+="0";return u.fromString(s,!0,2).toString(10)},t.keyToId=t.S2Cell.keyToId=t.toId=t.toCellId=t.fromKey=function(e){var n=e.split("/");return t.fromFacePosLevel(n[0],n[1],n[1].length)},t.idToKey=t.S2Cell.idToKey=t.S2Cell.toKey=t.toKey=t.fromId=t.fromCellId=t.S2Cell.toHilbertQuadkey=t.toHilbertQuadkey=function(n){for(var r=e.dcodeIO&&e.dcodeIO.Long||DD.exports,i=r.fromString(n,!0,10).toString(2);i.length<t.FACE_BITS+t.POS_BITS;)i="0"+i;for(var a=i.lastIndexOf("1"),o=i.substring(0,3),s=i.substring(3,a),u=s.length/2,l=r.fromString(o,!0,2).toString(10),c=r.fromString(s,!0,2).toString(4);c.length<u;)c="0"+c;return l+"/"+c},t.keyToLatLng=t.S2Cell.keyToLatLng=function(e){return t.S2Cell.FromHilbertQuadKey(e).getLatLng()},t.idToLatLng=t.S2Cell.idToLatLng=function(e){var n=t.idToKey(e);return t.keyToLatLng(n)},t.S2Cell.latLngToKey=t.latLngToKey=t.latLngToQuadkey=function(e,n,r){if(isNaN(r)||r<1||r>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return t.S2Cell.FromLatLng({lat:e,lng:n},r).toHilbertQuadkey()},t.stepKey=function(t,n){var r,i=e.dcodeIO&&e.dcodeIO.Long||DD.exports,a=t.split("/"),o=a[0],s=a[1],u=a[1].length,l=i.fromString(s,!0,4);n>0?r=l.add(Math.abs(n)):n<0&&(r=l.subtract(Math.abs(n)));var c=r.toString(4);for("0"===c&&console.warning(new Error("face/position wrapping is not yet supported"));c.length<u;)c="0"+c;return o+"/"+c},t.S2Cell.prevKey=t.prevKey=function(e){return t.stepKey(e,-1)},t.S2Cell.nextKey=t.nextKey=function(e){return t.stepKey(e,1)}}(e.exports)}(ND);var zD=function(e){Dd(n,e);var t=zd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:17;return Bd(this,n),(e=t.call(this))._level=r,e}return $d(n,[{key:"bboxToCellIds",value:function(e,t){return this._approxBboxToCellIds(e,t)}},{key:"getAdjacent",value:function(e){for(var t=ND.exports.S2.idToKey(e),n=t.split("/")[1].length,r=o(this._getNeighbors(t,n),4),i=r[0],a=r[1],s=r[2],u=r[3],l=[t,i,a,s,u],c=[i,a,s,u],h=0,d=Array.from(new Set([].concat(xd(this._getNeighbors(i,n)),xd(this._getNeighbors(a,n)),xd(this._getNeighbors(s,n)),xd(this._getNeighbors(u,n))).filter((function(e){return!l.includes(e)}))));h<d.length;h++){var f,p=d[h],v=0,m=Ad(this._getNeighbors(p,n));try{for(m.s();!(f=m.n()).done;){var g=f.value;l.includes(g)&&v++}}catch(CO){m.e(CO)}finally{m.f()}2===v&&c.push(p)}return c.map((function(e){return ND.exports.S2.keyToId(e)}))}},{key:"getVertices",value:function(e){var t=ND.exports.S2.idToKey(e);return ND.exports.S2.S2Cell.FromHilbertQuadKey(t).getCornerLatLngs().map((function(e){return{lat:e.lat,lng:e.lng}}))}},{key:"lngLatToCellId",value:function(e){return this._lngLatToId(e,this._level)}},{key:"_getNeighbors",value:function(e,t){var n=ND.exports.S2.keyToLatLng(e);return ND.exports.S2.latLngToNeighborKeys(n.lat,n.lng,t)}},{key:"_lngLatToId",value:function(e,t){var n=ND.exports.S2.latLngToKey(e.lat,e.lng,t);return ND.exports.S2.keyToId(n)}}]),n}(OD);var jD=function(){function e(){Bd(this,e)}return $d(e,[{key:"clusterReconstruction",value:function(e){var t=e.points,n=1/255;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].color;i[0]*=n,i[1]*=n,i[2]*=n}var a=e.reference_lla;return{id:null,points:t,reference:{alt:a.altitude,lat:a.latitude,lng:a.longitude}}}},{key:"coreImage",value:function(e){var t=this._geometry(e.geometry),n=this._geometry(e.computed_geometry),r={id:e.sequence};return{computed_geometry:n,geometry:t,id:e.id,sequence:r}}},{key:"spatialImage",value:function(e){var t,n,r,i;e.camera_type=function(e){switch(e){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}(e.camera_type),e.merge_id=e.merge_cc?e.merge_cc.toString():null,e.private=null;var a="spherical"===e.camera_type?e.thumb_2048_url:e.thumb_1024_url;return e.thumb=null!==(t=e.thumb)&&void 0!==t?t:{id:null,url:a},e.cluster=null!==(n=e.sfm_cluster)&&void 0!==n?n:{id:null,url:null},e.creator={id:null,username:null},e.owner=null!==(r=e.owner)&&void 0!==r?r:{id:null},e.mesh=null!==(i=e.mesh)&&void 0!==i?i:{id:null,url:null},e}},{key:"_geometry",value:function(e){var t=null===e||void 0===e?void 0:e.coordinates;return t?{lat:t[1],lng:t[0]}:null}}]),e}(),BD=function(){function e(){Bd(this,e),this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","exif_orientation","height","merge_cc","mesh","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}return $d(e,[{key:"images",value:function(e,t){return"image_ids=".concat(e.join(","),"&fields=").concat(t.join(","))}},{key:"imagesS2",value:function(e,t){return"s2=".concat(e,"&fields=").concat(t.join(","))}},{key:"imageTiles",value:function(e,t){return"z=".concat(e,"&fields=").concat(t.join(","))}},{key:"imageTilesPath",value:function(e){return"".concat(e,"/").concat(this._imageTilesPath)}},{key:"sequence",value:function(e){return"sequence_id=".concat(e)}}]),e}(),FD=function(e){Dd(n,e);var t=zd(n);function n(e,r,i,a){var o,s;Bd(this,n),(o=t.call(this,null!==r&&void 0!==r?r:new zD))._convert=null!==i&&void 0!==i?i:new jD,o._query=null!==a&&void 0!==a?a:new BD,o._method="GET";var u=null!==e&&void 0!==e?e:{};return o._endpoint=null!==(s=u.endpoint)&&void 0!==s?s:"https://graph.mapillary.com",o._accessToken=u.accessToken,o}return $d(n,[{key:"getCluster",value:function(e,t){var n=this;return PD(e,t).then((function(e){var t=function(e){var t=oD(e,{to:"string"});return JSON.parse(t)}(e);if(t.length<1)throw new Error("Cluster reconstruction empty");return n._convert.clusterReconstruction(t[0])}))}},{key:"getCoreImages",value:function(e){var t=this,n=[].concat(xd(this._query.idFields),xd(this._query.coreFields)),r=this._query.imagesS2(e,n),i=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(r,i).then((function(n){var r,i={cell_id:e,images:[]},a=Ad(n.data);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=t._convert.coreImage(o);i.images.push(s)}}catch(CO){a.e(CO)}finally{a.f()}return i}))}},{key:"getImageBuffer",value:function(e,t){return PD(e,t)}},{key:"getImages",value:function(e){var t=this,n=[].concat(xd(this._query.idFields),xd(this._query.coreFields),xd(this._query.spatialFields)),r=this._query.images(e,n),i=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(r,i).then((function(e){var n,r=[],i=Ad(e.data);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t._convert.coreImage(a),s=t._convert.spatialImage(a),u={node:Object.assign({},s,o),node_id:a.id};r.push(u)}}catch(CO){i.e(CO)}finally{i.f()}return r}))}},{key:"getImageTiles",value:function(e){var t=xd(this._query.imageTileFields),n=this._query.imageTiles(e.z,t),r=new URL(this._query.imageTilesPath(e.imageId),this._endpoint).href;return this._fetchGraphContract(n,r).then((function(t){return{node:t.data,node_id:e.imageId}}))}},{key:"getMesh",value:function(e,t){return PD(e,t).then((function(e){return function(e){return new uD(e).readFields(LD,{faces:[],vertices:[]})}(e)}))}},{key:"getSequence",value:function(e){var t=this._query.sequence(e),n=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(t,n).then((function(t){return{id:e,image_ids:t.data.map((function(e){return e.id}))}}))}},{key:"getSpatialImages",value:function(e){var t=this,n=[].concat(xd(this._query.idFields),xd(this._query.coreFields),xd(this._query.spatialFields)),r=this._query.images(e,n),i=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(r,i).then((function(e){var n,r=[],i=Ad(e.data);try{for(i.s();!(n=i.n()).done;){var a=n.value,o={node:t._convert.spatialImage(a),node_id:a.id};r.push(o)}}catch(CO){i.e(CO)}finally{i.f()}return r}))}},{key:"setAccessToken",value:function(e){this._accessToken=e}},{key:"_createHeaders",value:function(){var e=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&e.push({name:"Authorization",value:"OAuth ".concat(this._accessToken)}),e}},{key:"_fetchGraphContract",value:function(e,t){var n=this,r=this._method,i=this._createHeaders();return AD("".concat(t,"?").concat(e),r,"json",i,null,null).catch((function(e){var t=n._makeErrorMessage(e);throw new VM(t)}))}},{key:"_makeErrorMessage",value:function(e){var t=e.error;return t?"".concat(t.code," (").concat(t.type,", ").concat(t.fbtrace_id,"): ").concat(t.message):"Failed to fetch data"}}]),n}(RD);var $D,qD,UD,VD;!function(e){e[e.Custom=0]="Custom",e[e.Earth=1]="Earth",e[e.Street=2]="Street"}($D||($D={})),function(e){e[e.Letterbox=0]="Letterbox",e[e.Fill=1]="Fill"}(qD||(qD={})),function(e){e[e.Opaque=0]="Opaque"}(UD||(UD={})),function(e){e[e.Default=0]="Default",e[e.Instantaneous=1]="Instantaneous"}(VD||(VD={}));var HD,WD=function(){function e(t,n,r,i,a,o){var s=this;Bd(this,e),this._container=t,this._observer=r,this._navigator=n,this._options=null!=a?a:{},this._key=i,this._navigable=null==i,this._componentService=o||new xC(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),i?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(fv((function(e){return null!=e}))).subscribe((function(e){s._key=e,s._componentService.deactivateCover(),s._coverComponent.configure({id:s._key,state:_P.Hidden}),s._subscribeCoverComponent(),s._navigator.stateService.start(),s._navigator.cacheService.start(),s._navigator.panService.start(),s._observer.startEmit()}))}return $d(e,[{key:"navigable",get:function(){return this._navigable}},{key:"get",value:function(e){return this._componentService.get(e)}},{key:"activate",value:function(e){this._componentService.activate(e)}},{key:"activateCover",value:function(){this._coverComponent.configure({state:_P.Visible})}},{key:"deactivate",value:function(e){this._componentService.deactivate(e)}},{key:"deactivateCover",value:function(){this._coverComponent.configure({state:_P.Loading})}},{key:"remove",value:function(){this._componentService.remove(),null!=this._configurationSubscription&&this._configurationSubscription.unsubscribe()}},{key:"_initializeComponents",value:function(){var e,t,n=this._options;this._uFalse(null===(e=n.fallback)||void 0===e?void 0:e.image,"imagefallback"),this._uFalse(null===(t=n.fallback)||void 0===t?void 0:t.navigation,"navigationfallback"),this._uFalse(n.marker,"marker"),this._uFalse(n.popup,"popup"),this._uFalse(n.slider,"slider"),this._uFalse(n.spatial,"spatial"),this._uFalse(n.tag,"tag"),this._uTrue(n.attribution,"attribution"),this._uTrue(n.bearing,"bearing"),this._uTrue(n.cache,"cache"),this._uTrue(n.direction,"direction"),this._uTrue(n.image,"image"),this._uTrue(n.keyboard,"keyboard"),this._uTrue(n.pointer,"pointer"),this._uTrue(n.sequence,"sequence"),this._uTrue(n.zoom,"zoom")}},{key:"_initilizeCoverComponent",value:function(){var e=this._options;this._coverComponent.configure({id:this._key}),void 0===e.cover||e.cover?this.activateCover():this.deactivateCover()}},{key:"_setNavigable",value:function(e){this._navigable!==e&&(this._navigable=e,this._observer.navigable$.next(e))}},{key:"_subscribeCoverComponent",value:function(){var e=this;this._configurationSubscription=this._coverComponent.configuration$.pipe(sv(void 0,(function(e){return e.state}))).subscribe((function(t){t.state===_P.Loading?e._navigator.stateService.currentId$.pipe(fv(),Tv((function(n){var r=null==n||n!==t.id;return r&&e._setNavigable(!1),r?e._navigator.moveTo$(t.id):e._navigator.stateService.currentImage$.pipe(fv())}))).subscribe((function(){e._navigator.stateService.start(),e._navigator.cacheService.start(),e._navigator.panService.start(),e._observer.startEmit(),e._coverComponent.configure({state:_P.Hidden}),e._componentService.deactivateCover(),e._setNavigable(!0)}),(function(t){console.error("Failed to deactivate cover.",t),e._coverComponent.configure({state:_P.Visible})})):t.state===_P.Visible&&(e._observer.stopEmit(),e._navigator.stateService.stop(),e._navigator.cacheService.stop(),e._navigator.playService.stop(),e._navigator.panService.stop(),e._componentService.activateCover(),e._setNavigable(null==t.id))}))}},{key:"_uFalse",value:function(e,t){void 0!==e?"boolean"!==typeof e?(this._componentService.configure(t,e),this._componentService.activate(t)):e?this._componentService.activate(t):this._componentService.deactivate(t):this._componentService.deactivate(t)}},{key:"_uTrue",value:function(e,t){void 0!==e?"boolean"!==typeof e?(this._componentService.configure(t,e),this._componentService.activate(t)):e?this._componentService.activate(t):this._componentService.deactivate(t):this._componentService.activate(t)}}]),e}(),GD=function(){function e(t,n,r){Bd(this,e),this._adaptiveOperation$=new If,this._render$=new If,this._renderAdaptive$=new If,this._subscriptions=new xP,this._renderService=n,this._currentFrame$=r;var i=this._subscriptions,a=yP.create(yP.h("div.mapillary-dom-renderer",[]));t.appendChild(a),this._offset$=this._adaptiveOperation$.pipe(xv((function(e,t){return t(e)}),{elementHeight:t.offsetHeight,elementWidth:t.offsetWidth,imageAspect:0,renderMode:qD.Fill}),Zp((function(e){return e.imageAspect>0&&e.elementWidth>0&&e.elementHeight>0})),wp((function(e){var t=e.elementWidth/e.elementHeight,n=e.imageAspect/t,r=0,i=0;return e.renderMode===qD.Letterbox?e.imageAspect>t?r=e.elementHeight*(1-1/n)/2:i=e.elementWidth*(1-n)/2:e.imageAspect>t?i=-e.elementWidth*(n-1)/2:r=-e.elementHeight*(1/n-1)/2,{bottom:r,left:i,right:i,top:r}})));var o=this._currentFrame$.pipe(Zp((function(e){return null!=e.state.currentImage})),sv((function(e,t){return e===t}),(function(e){return e.state.currentImage.id})),wp((function(e){return e.state.currentTransform.basicAspect})),wp((function(e){return function(t){return t.imageAspect=e,t}}))).subscribe(this._adaptiveOperation$),s=Lp(this._renderAdaptive$.pipe(xv((function(e,t){return null==t.vNode?delete e[t.name]:e[t.name]=t.vNode,e}),{})),this._offset$).pipe(wp((function(e){var t=[],n=e[0];for(var r in n)n.hasOwnProperty(r)&&t.push(n[r]);var i=e[1],a={style:{bottom:i.bottom+"px",left:i.left+"px","pointer-events":"none",position:"absolute",right:i.right+"px",top:i.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:yP.h("div.mapillary-dom-adaptive-renderer",a,t)}}))).subscribe(this._render$);this._vNode$=this._render$.pipe(xv((function(e,t){return null==t.vNode?delete e[t.name]:e[t.name]=t.vNode,e}),{}),wp((function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return yP.h("div.mapillary-dom-renderer",t)}))),this._vPatch$=this._vNode$.pipe(xv((function(e,t){return e.vpatch=yP.diff(e.vNode,t),e.vNode=t,e}),{vNode:yP.h("div.mapillary-dom-renderer",[]),vpatch:null}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return wp((function(t){for(var r=t,i=0;i<n;i++){var a=null===r||void 0===r?void 0:r[e[i]];if("undefined"===typeof a)return;r=a}return r}))}("vpatch")),this._element$=this._vPatch$.pipe(xv((function(e,t){return yP.patch(e,t)}),a),yv(1),Pf()),i.push(o),i.push(s),i.push(this._element$.subscribe((function(){}))),i.push(this._renderService.size$.pipe(wp((function(e){return function(t){return t.elementWidth=e.width,t.elementHeight=e.height,t}}))).subscribe(this._adaptiveOperation$)),i.push(this._renderService.renderMode$.pipe(wp((function(e){return function(t){return t.renderMode=e,t}}))).subscribe(this._adaptiveOperation$))}return $d(e,[{key:"element$",get:function(){return this._element$}},{key:"render$",get:function(){return this._render$}},{key:"renderAdaptive$",get:function(){return this._renderAdaptive$}},{key:"clear",value:function(e){this._renderAdaptive$.next({name:e,vNode:null}),this._render$.next({name:e,vNode:null})}},{key:"remove",value:function(){this._subscriptions.unsubscribe()}}]),e}(),ZD=function(){function e(t,n,r){var i=this;Bd(this,e),this._renderFrame$=new If,this._renderCameraOperation$=new If,this._render$=new If,this._clear$=new If,this._renderOperation$=new If,this._rendererOperation$=new If,this._eraserOperation$=new If,this._triggerOperation$=new If,this._subscriptions=new xP,this._opaqueRender$=new If,this._renderService=r;var a=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(xv((function(e,t){return t(e)}),{needsRender:!1,renderer:null}),Zp((function(e){return!!e.renderer}))),this._renderCollection$=this._renderOperation$.pipe(xv((function(e,t){return t(e)}),{}),wv()),this._renderCamera$=this._renderCameraOperation$.pipe(xv((function(e,t){return t(e)}),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(Cv((function(e){return e})),xv((function(e,t){return t(e)}),{needsRender:!1}));var s=this._triggerOperation$.pipe(Cv((function(e){return e})),xv((function(e,t){return t(e)}),{needsRender:!1})),u=new d_(986895),l=Lp(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,s).pipe(wp((function(e){var t=o(e,5),n=t[0],r=t[1];return{camera:t[2],eraser:t[3],trigger:t[4],renderer:n,renders:Object.keys(r).map((function(e){return r[e]}))}})),Zp((function(e){var t,n=e.renderer.needsRender||e.camera.needsRender||e.eraser.needsRender||e.trigger.needsRender,r=e.camera.frameId,i=Ad(e.renders);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.frameId!==r)return!1;n=n||a.needsRender}}catch(CO){i.e(CO)}finally{i.f()}return n})),sv((function(e,t){return e===t}),(function(e){return e.eraser.needsRender||e.trigger.needsRender?-e.camera.frameId:e.camera.frameId}))).subscribe((function(e){e.renderer.needsRender=!1,e.camera.needsRender=!1,e.eraser.needsRender=!1,e.trigger.needsRender=!1;var t,n=e.camera.perspective,r=[],a=[],o=Ad(e.renders);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.pass===OP.Background?r.push(s.render):s.pass===OP.Opaque&&a.push(s.render)}}catch(CO){o.e(CO)}finally{o.f()}var l=e.renderer.renderer;l.resetState(),l.setClearColor(u,1),l.clear();for(var c=0,h=r;c<h.length;c++){(0,h[c])(n,l)}l.clearDepth();for(var d=0,f=a;d<f.length;d++){(0,f[d])(n,l)}l.resetState(),i._opaqueRender$.next()}));a.push(l),a.push(this._renderFrame$.pipe(wp((function(e){return function(t){return t.frameId=e.frameId,t.perspective=e.perspective,!0===e.changed&&(t.needsRender=!0),t}}))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();var c=this._render$.pipe(wp((function(e){return function(t){return t[e.name]=e.renderer,t}}))),h=this._clear$.pipe(wp((function(e){return function(t){return delete t[e],t}})));a.push(Hp(c,h).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(fv(),wp((function(){n.appendChild(t);var e=r.element,i=new Qx({canvas:t});return i.setPixelRatio(window.devicePixelRatio),i.setSize(e.offsetWidth,e.offsetHeight),i.autoClear=!1,i})),yv(1),Pf()),a.push(this._webGLRenderer$.subscribe((function(){})));var d=this._webGLRenderer$.pipe(fv(),wp((function(e){return function(t){return t.needsRender=!0,t.renderer=e,t}}))),f=this._renderService.size$.pipe(wp((function(e){return function(t){return null==t.renderer||(t.renderer.setSize(e.width,e.height),t.needsRender=!0),t}}))),p=this._clear$.pipe(wp((function(){return function(e){return null==e.renderer||(e.needsRender=!0),e}})));a.push(Hp(d,f,p).subscribe(this._rendererOperation$));var v=this._renderCollection$.pipe(Zp((function(e){return 0===Object.keys(e).length})),wv());a.push(v.subscribe((function(){null!=i._renderFrameSubscription&&(i._renderFrameSubscription.unsubscribe(),i._renderFrameSubscription=null,i._renderFrameSubscribe())}))),a.push(v.pipe(wp((function(){return function(e){return e.needsRender=!0,e}}))).subscribe(this._eraserOperation$))}return $d(e,[{key:"render$",get:function(){return this._render$}},{key:"opaqueRender$",get:function(){return this._opaqueRender$}},{key:"webGLRenderer$",get:function(){return this._webGLRenderer$}},{key:"clear",value:function(e){this._clear$.next(e)}},{key:"remove",value:function(){this._rendererOperation$.next((function(e){if(null!=e.renderer){var t=e.renderer.getContext().getExtension("WEBGL_lose_context");t&&t.loseContext(),e.renderer=null}return e})),null!=this._renderFrameSubscription&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}},{key:"triggerRerender",value:function(){var e=this;this._renderService.renderCameraFrame$.pipe(Sv(1),fv()).subscribe((function(){e._triggerOperation$.next((function(e){return e.needsRender=!0,e}))}))}},{key:"_renderFrameSubscribe",value:function(){var e=this;this._render$.pipe(fv(),wp((function(){return function(e){return e.needsRender=!0,e}}))).subscribe((function(t){e._renderCameraOperation$.next(t)})),this._renderFrameSubscription=this._render$.pipe(fv(),Np((function(){return e._renderService.renderCameraFrame$}))).subscribe(this._renderFrame$)}}]),e}(),YD=function(){function e(t){Bd(this,e),null!=t?(this._position=(new Vm).fromArray(t.unprojectSfM([0,0],0)),this._lookat=(new Vm).fromArray(t.unprojectSfM([0,0],10)),this._up=t.upVector(),this._focal=this._getFocal(t)):(this._position=new Vm(0,0,0),this._lookat=new Vm(1,0,0),this._up=new Vm(0,0,1),this._focal=1)}return $d(e,[{key:"position",get:function(){return this._position}},{key:"lookat",get:function(){return this._lookat}},{key:"up",get:function(){return this._up}},{key:"focal",get:function(){return this._focal},set:function(e){this._focal=e}},{key:"lerpCameras",value:function(e,t,n){this._position.subVectors(t.position,e.position).multiplyScalar(n).add(e.position),this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(n).add(e.lookat),this._up.subVectors(t.up,e.up).multiplyScalar(n).add(e.up),this._focal=(1-n)*e.focal+n*t.focal}},{key:"copy",value:function(e){this._position.copy(e.position),this._lookat.copy(e.lookat),this._up.copy(e.up),this._focal=e.focal}},{key:"clone",value:function(){var t=new e;return t.position.copy(this._position),t.lookat.copy(this._lookat),t.up.copy(this._up),t.focal=this._focal,t}},{key:"diff",value:function(e){var t=this._position.distanceToSquared(e.position),n=this._lookat.distanceToSquared(e.lookat),r=this._up.distanceToSquared(e.up),i=100*Math.abs(this._focal-e.focal);return Math.max(t,n,r,i)}},{key:"_getFocal",value:function(e){return ZM(e.cameraType)?.5/Math.tan(Math.PI/2):e.focal}}]),e}(),XD=function(){function e(t,n,r){Bd(this,e),this._spatial=new WM,this._viewportCoords=new CP,this._size={width:t,height:n},this._initialFov=60,this._alpha=-1,this._stateTransitionAlpha=-1,this._stateTransitionFov=-1,this._renderMode=r,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new YD,this._perspective=new ey(this._initialFov,this._computeAspect(t,n),.1,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}return $d(e,[{key:"alpha",get:function(){return this._alpha}},{key:"camera",get:function(){return this._camera}},{key:"changed",get:function(){return this._frameId===this._changedForFrame}},{key:"frameId",get:function(){return this._frameId}},{key:"perspective",get:function(){return this._perspective}},{key:"renderMode",get:function(){return this._renderMode}},{key:"rotation",get:function(){return this._rotation}},{key:"zoom",get:function(){return this._zoom}},{key:"size",get:function(){return this._size}},{key:"getTilt",value:function(){return 90-this._spatial.radToDeg(this._rotation.theta)}},{key:"fovToZoom",value:function(e){e=Math.min(90,Math.max(0,e));var t=this._computeCurrentFov(0),n=1===this._alpha?t:this._interpolateFov(t,this._computePreviousFov(0),this._alpha),r=Math.tan(n/2*Math.PI/180),i=Math.tan(e/2*Math.PI/180);return Math.log(r/i)/Math.log(2)}},{key:"setFrame",value:function(e){var t=e.state;if(t.state!==this._state){if(this._state=t.state,this._state!==XP.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._state===XP.Earth){var n=this._fovToY(this._perspective.fov,this._zoom);this._stateTransitionFov=this._yToFov(n,0)}this._changed=!0}var r=t.currentImage.id,i=t.previousImage?t.previousImage.id:null;r!==this._currentImageId&&(this._currentImageId=r,this._currentSpherical=ZM(t.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(t.currentTransform),this._changed=!0),i!==this._previousImageId&&(this._previousImageId=i,this._previousSpherical=ZM(t.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(t.previousTransform),this._changed=!0);var a=t.zoom;a!==this._zoom&&(this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(a),this._previousFov=this._computePreviousFov(a));var o=t.alpha,s=t.stateTransitionAlpha;if(this._changed||o!==this._alpha||s!==this._stateTransitionAlpha){switch(this._alpha=o,this._stateTransitionAlpha=s,this._state){case XP.Earth:var u=this._stateTransitionFov,l=this._focalToFov(t.camera.focal),c=Em.lerp(u,l,s),h=this._fovToY(c,0);this._perspective.fov=this._yToFov(h,a);break;case XP.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0}this._zoom=a,this._state!==XP.Custom&&this._perspective.updateProjectionMatrix()}var d=t.camera;this._camera.diff(d)>1e-9&&(this._camera.copy(d),this._rotation=this._computeRotation(d),this._perspective.up.copy(d.up),this._perspective.position.copy(d.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(d.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(e.id)}},{key:"setProjectionMatrix",value:function(e){this._perspective.fov=this._focalToFov(e[5]/2),this._perspective.projectionMatrix.fromArray(e),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}},{key:"setRenderMode",value:function(e){this._renderMode=e,this._state!==XP.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}},{key:"setSize",value:function(e){this._size=e,this._state!==XP.Custom&&(this._perspective.aspect=this._computeAspect(e.width,e.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}},{key:"_computeAspect",value:function(e,t){return 0===e?0:e/t}},{key:"_computeCurrentFov",value:function(e){return 0===this._perspective.aspect?0:this._currentImageId?this._currentSpherical?this._yToFov(1,e):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,e,this.perspective.aspect):this._initialFov}},{key:"_computeFov",value:function(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}},{key:"_computePreviousFov",value:function(e){return 0===this._perspective.aspect?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,e):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,e,this.perspective.aspect):this._currentFov:this._initialFov}},{key:"_computeProjectedPoints",value:function(e){return KM(e,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}},{key:"_computeRequiredVerticalFov",value:function(e,t,n){var r=Math.max(e[0]/n,e[1]);return this._yToFov(r,t)}},{key:"_computeRotation",value:function(e){var t=e.lookat.clone().sub(e.position),n=e.up.clone();return{phi:this._spatial.azimuthal(t.toArray(),n.toArray()),theta:Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1])}}},{key:"_computeVerticalFov",value:function(e,t,n,r){var i=this,a=e.map((function(e){return i._computeRequiredVerticalFov(e,n,r)}));return t===qD.Fill?.995*Math.min.apply(Math,xd(a)):Math.max.apply(Math,xd(a))}},{key:"_yToFov",value:function(e,t){return 2*Math.atan(e/Math.pow(2,t))*180/Math.PI}},{key:"_focalToFov",value:function(e){return 2*Math.atan2(1,2*e)*180/Math.PI}},{key:"_fovToY",value:function(e,t){return Math.pow(2,t)*Math.tan(Math.PI*e/360)}},{key:"_interpolateFov",value:function(e,t,n){return n*e+(1-n)*t}},{key:"_setFrameId",value:function(e){this._frameId=e,this._changed&&(this._changed=!1,this._changedForFrame=e)}}]),e}(),KD=function(){function e(t,n,r,i){var a=this;Bd(this,e),this._subscriptions=new xP,this._element=t,this._currentFrame$=n,this._spatial=new WM,r=null!=r?r:qD.Fill,this._resize$=new If,this._projectionMatrix$=new If,this._renderCameraOperation$=new If,this._size$=new Of({height:this._element.offsetHeight,width:this._element.offsetWidth});var s=this._subscriptions;s.push(this._resize$.pipe(wp((function(){return{height:a._element.offsetHeight,width:a._element.offsetWidth}}))).subscribe(this._size$)),this._renderMode$=new Of(r),this._renderCameraHolder$=this._renderCameraOperation$.pipe(Cv((function(e){return e})),xv((function(e,t){return t(e)}),null!==i&&void 0!==i?i:new XD(this._element.offsetWidth,this._element.offsetHeight,r)),yv(1),Pf()),this._renderCameraFrame$=this._currentFrame$.pipe(Lv(this._renderCameraHolder$),Av((function(e){var t=o(e,2),n=t[0];t[1].setFrame(n)})),wp((function(e){return e[1]})),yv(1),Pf()),this._renderCamera$=this._renderCameraFrame$.pipe(Zp((function(e){return e.changed})),yv(1),Pf()),this._bearing$=this._renderCamera$.pipe(wp((function(e){var t=a._spatial.radToDeg(a._spatial.azimuthalToBearing(e.rotation.phi));return a._spatial.wrap(t,0,360)})),yv(1),Pf()),s.push(this._size$.pipe(Sv(1),wp((function(e){return function(t){return t.setSize(e),t}}))).subscribe(this._renderCameraOperation$)),s.push(this._renderMode$.pipe(Sv(1),wp((function(e){return function(t){return t.setRenderMode(e),t}}))).subscribe(this._renderCameraOperation$)),s.push(this._projectionMatrix$.pipe(wp((function(e){return function(t){return t.setProjectionMatrix(e),t}}))).subscribe(this._renderCameraOperation$)),s.push(this._bearing$.subscribe((function(){}))),s.push(this._renderCameraHolder$.subscribe((function(){}))),s.push(this._size$.subscribe((function(){}))),s.push(this._renderMode$.subscribe((function(){}))),s.push(this._renderCamera$.subscribe((function(){}))),s.push(this._renderCameraFrame$.subscribe((function(){})))}return $d(e,[{key:"bearing$",get:function(){return this._bearing$}},{key:"element",get:function(){return this._element}},{key:"projectionMatrix$",get:function(){return this._projectionMatrix$}},{key:"renderCamera$",get:function(){return this._renderCamera$}},{key:"renderCameraFrame$",get:function(){return this._renderCameraFrame$}},{key:"renderMode$",get:function(){return this._renderMode$}},{key:"resize$",get:function(){return this._resize$}},{key:"size$",get:function(){return this._size$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}}]),e}(),JD=function(){function e(t){Bd(this,e),this._keyDown$=qp(t,"keydown"),this._keyUp$=qp(t,"keyup")}return $d(e,[{key:"keyDown$",get:function(){return this._keyDown$}},{key:"keyUp$",get:function(){return this._keyUp$}}]),e}(),QD=(Xh(Ed={},0,1),Xh(Ed,2,2),Ed),ez=function(){function e(t,n,r,i){var a=this;Bd(this,e),this._subscriptions=new xP;var o=this._subscriptions;this._activeSubject$=new Of(!1),this._active$=this._activeSubject$.pipe(sv(),yv(1),Pf()),this._claimMouse$=new If,this._claimWheel$=new If,this._deferPixelClaims$=new If,this._deferPixels$=this._deferPixelClaims$.pipe(xv((function(e,t){return null==t.deferPixels?delete e[t.name]:e[t.name]=t.deferPixels,e}),{}),wp((function(e){var t=-1;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r>t&&(t=r)}return t})),Cv(-1),yv(1),Pf()),o.push(this._deferPixels$.subscribe((function(){}))),this._documentMouseMove$=qp(i,"pointermove").pipe(Zp(this._isMousePen)),this._documentMouseUp$=qp(i,"pointerup").pipe(Zp(this._isMousePen)),this._mouseDown$=qp(n,"pointerdown").pipe(Zp(this._isMousePen)),this._mouseEnter$=qp(n,"pointerenter").pipe(Zp(this._isMousePen)),this._mouseLeave$=qp(n,"pointerleave").pipe(Zp(this._isMousePen)),this._mouseMove$=qp(n,"pointermove").pipe(Zp(this._isMousePen)),this._mouseUp$=qp(n,"pointerup").pipe(Zp(this._isMousePen)),this._mouseOut$=qp(n,"pointerout").pipe(Zp(this._isMousePen)),this._mouseOver$=qp(n,"pointerover").pipe(Zp(this._isMousePen)),this._domMouseDown$=qp(r,"pointerdown").pipe(Zp(this._isMousePen)),this._domMouseMove$=qp(r,"pointermove").pipe(Zp(this._isMousePen)),this._click$=qp(n,"click"),this._contextMenu$=qp(n,"contextmenu"),this._windowBlur$=qp(window,"blur"),this._dblClick$=Hp(qp(t,"click"),qp(n,"dblclick")).pipe(Kp(3,1),Zp((function(e){var t=e[0],r=e[1],i=e[2];return"click"===t.type&&"click"===r.type&&"dblclick"===i.type&&t.target.parentNode===n&&r.target.parentNode===n})),wp((function(e){return e[2]})),wv()),o.push(Hp(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe((function(e){e.preventDefault()}))),this._mouseWheel$=Hp(qp(n,"wheel"),qp(r,"wheel")).pipe(wv()),this._consistentContextMenu$=Hp(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(Kp(3,1),Zp((function(e){return"pointerdown"===e[0].type&&"contextmenu"===e[1].type&&"pointerup"===e[2].type})),wp((function(e){return e[1]})),wv());var s=Hp(this._windowBlur$,this._documentMouseMove$.pipe(Zp((function(e){return a._buttonReleased(e,0)}))),this._documentMouseUp$.pipe(Zp((function(e){return 0===a._mouseButton(e)})))).pipe(wv()),u=this._createMouseDragInitiate$(0,this._mouseDown$,s,!0).pipe(wv());this._mouseDragStart$=this._createMouseDragStart$(u).pipe(wv()),this._mouseDrag$=this._createMouseDrag$(u,s).pipe(wv()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,s).pipe(wv());var l=this._createMouseDragInitiate$(0,this._domMouseDown$,s,!1).pipe(wv());this._domMouseDragStart$=this._createMouseDragStart$(l).pipe(wv()),this._domMouseDrag$=this._createMouseDrag$(l,s).pipe(wv()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,s).pipe(wv());var c=Hp(this._windowBlur$,this._documentMouseMove$.pipe(Zp((function(e){return a._buttonReleased(e,2)}))),this._documentMouseUp$.pipe(Zp((function(e){return 2===a._mouseButton(e)})))).pipe(wv()),h=this._createMouseDragInitiate$(2,this._mouseDown$,c,!0).pipe(wv());this._mouseRightDragStart$=this._createMouseDragStart$(h).pipe(wv()),this._mouseRightDrag$=this._createMouseDrag$(h,c).pipe(wv()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,c).pipe(wv()),this._proximateClick$=this._mouseDown$.pipe(Tv((function(e){return a._click$.pipe(Ev(a._createDeferredMouseMove$(e,a._documentMouseMove$)),ov(1))})),wv()),this._staticClick$=this._mouseDown$.pipe(Tv((function(){return a._click$.pipe(Ev(a._documentMouseMove$),ov(1))})),wv()),o.push(this._mouseDragStart$.subscribe()),o.push(this._mouseDrag$.subscribe()),o.push(this._mouseDragEnd$.subscribe()),o.push(this._domMouseDragStart$.subscribe()),o.push(this._domMouseDrag$.subscribe()),o.push(this._domMouseDragEnd$.subscribe()),o.push(this._mouseRightDragStart$.subscribe()),o.push(this._mouseRightDrag$.subscribe()),o.push(this._mouseRightDragEnd$.subscribe()),o.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(yv(1),Pf()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(yv(1),Pf()),o.push(this._mouseOwner$.subscribe((function(){}))),o.push(this._wheelOwner$.subscribe((function(){})))}return $d(e,[{key:"active$",get:function(){return this._active$}},{key:"activate$",get:function(){return this._activeSubject$}},{key:"documentMouseMove$",get:function(){return this._documentMouseMove$}},{key:"documentMouseUp$",get:function(){return this._documentMouseUp$}},{key:"domMouseDragStart$",get:function(){return this._domMouseDragStart$}},{key:"domMouseDrag$",get:function(){return this._domMouseDrag$}},{key:"domMouseDragEnd$",get:function(){return this._domMouseDragEnd$}},{key:"domMouseDown$",get:function(){return this._domMouseDown$}},{key:"domMouseMove$",get:function(){return this._domMouseMove$}},{key:"mouseOwner$",get:function(){return this._mouseOwner$}},{key:"mouseDown$",get:function(){return this._mouseDown$}},{key:"mouseEnter$",get:function(){return this._mouseEnter$}},{key:"mouseMove$",get:function(){return this._mouseMove$}},{key:"mouseLeave$",get:function(){return this._mouseLeave$}},{key:"mouseOut$",get:function(){return this._mouseOut$}},{key:"mouseOver$",get:function(){return this._mouseOver$}},{key:"mouseUp$",get:function(){return this._mouseUp$}},{key:"click$",get:function(){return this._click$}},{key:"dblClick$",get:function(){return this._dblClick$}},{key:"contextMenu$",get:function(){return this._consistentContextMenu$}},{key:"mouseWheel$",get:function(){return this._mouseWheel$}},{key:"mouseDragStart$",get:function(){return this._mouseDragStart$}},{key:"mouseDrag$",get:function(){return this._mouseDrag$}},{key:"mouseDragEnd$",get:function(){return this._mouseDragEnd$}},{key:"mouseRightDragStart$",get:function(){return this._mouseRightDragStart$}},{key:"mouseRightDrag$",get:function(){return this._mouseRightDrag$}},{key:"mouseRightDragEnd$",get:function(){return this._mouseRightDragEnd$}},{key:"proximateClick$",get:function(){return this._proximateClick$}},{key:"staticClick$",get:function(){return this._staticClick$}},{key:"windowBlur$",get:function(){return this._windowBlur$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}},{key:"claimMouse",value:function(e,t){this._claimMouse$.next({name:e,zindex:t})}},{key:"unclaimMouse",value:function(e){this._claimMouse$.next({name:e,zindex:null})}},{key:"deferPixels",value:function(e,t){this._deferPixelClaims$.next({name:e,deferPixels:t})}},{key:"undeferPixels",value:function(e){this._deferPixelClaims$.next({name:e,deferPixels:null})}},{key:"claimWheel",value:function(e,t){this._claimWheel$.next({name:e,zindex:t})}},{key:"unclaimWheel",value:function(e){this._claimWheel$.next({name:e,zindex:null})}},{key:"filtered$",value:function(e,t){return this._filtered(e,t,this._mouseOwner$)}},{key:"filteredWheel$",value:function(e,t){return this._filtered(e,t,this._wheelOwner$)}},{key:"_createDeferredMouseMove$",value:function(e,t){return t.pipe(wp((function(t){var n=t.clientX-e.clientX,r=t.clientY-e.clientY;return[t,Math.sqrt(n*n+r*r)]})),Lv(this._deferPixels$),Zp((function(e){var t=o(e,2);return o(t[0],2)[1]>t[1]})),wp((function(e){var t=o(e,1);return o(t[0],1)[0]})))}},{key:"_createMouseDrag$",value:function(e,t){var n=this;return e.pipe(wp((function(e){return o(e,2)[1]})),Tv((function(e){return jp(vp(e),n._documentMouseMove$).pipe(Ev(t))})))}},{key:"_createMouseDragEnd$",value:function(e,t){return e.pipe(Tv((function(){return t.pipe(fv())})))}},{key:"_createMouseDragStart$",value:function(e){return e.pipe(wp((function(e){return o(e,1)[0]})))}},{key:"_createMouseDragInitiate$",value:function(e,t,n,r){var i=this;return t.pipe(Zp((function(t){return i._mouseButton(t)===e})),Tv((function(e){return Lp(vp(e),r?i._createDeferredMouseMove$(e,i._documentMouseMove$):i._documentMouseMove$).pipe(Ev(n),ov(1))})))}},{key:"_createOwner$",value:function(e){return e.pipe(xv((function(e,t){return null==t.zindex?delete e[t.name]:e[t.name]=t.zindex,e}),{}),wp((function(e){var t=null,n=-1;for(var r in e)e.hasOwnProperty(r)&&e[r]>n&&(n=e[r],t=r);return t})),Cv(null))}},{key:"_filtered",value:function(e,t,n){return t.pipe(Lv(n),Zp((function(t){return o(t,2)[1]===e})),wp((function(e){return o(e,1)[0]})))}},{key:"_mouseButton",value:function(e){var t="pointerdown"===e.type||"pointerup"===e.type,n=window.InstallTrigger;return t&&"undefined"!==typeof n&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}},{key:"_buttonReleased",value:function(e,t){var n=QD[t];return void 0===e.buttons||(e.buttons&n)!==n}},{key:"_isMousePen",value:function(e){var t=e.pointerType;return"mouse"===t||"pen"===t}}]),e}(),tz=function(){function e(){Bd(this,e)}return $d(e,[{key:"json",set:function(e){this._json=e}},{key:"image",set:function(e){this._image=e,this._texture=new zm(this._image),this._texture.minFilter=Fv}},{key:"loaded",get:function(){return!(!this._image||!this._json)}},{key:"getGLSprite",value:function(e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");var t=this._json[e];if(!t)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),new Wg;var n=this._texture.clone();n.needsUpdate=!0;var r=this._image.width,i=this._image.height;n.offset.x=t.x/r,n.offset.y=(i-t.y-t.height)/i,n.repeat.x=t.width/r,n.repeat.y=t.height/i;var a=new ow({map:n});return new yw(a)}},{key:"getDOMSprite",value:function(e,t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");null==t&&(t=UI.Center);var n=this._json[e];if(!n)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),yP.h("div",{},[]);var r=n.y,i=n.x+n.width,a=n.y+n.height,o=n.x,s=-n.x,u=-n.y,l=this._image.height,c=this._image.width;switch(t){case UI.Bottom:case UI.Center:case UI.Top:s-=n.width/2;break;case UI.BottomLeft:case UI.Left:case UI.TopLeft:s-=n.width;case UI.BottomRight:case UI.Right:case UI.TopRight:}switch(t){case UI.Center:case UI.Left:case UI.Right:u-=n.height/2;break;case UI.Top:case UI.TopLeft:case UI.TopRight:u-=n.height;case UI.Bottom:case UI.BottomLeft:case UI.BottomRight:}var h=1/n.pixelRatio;r*=h,i*=h,a*=h,o*=h,s*=h,u*=h,l*=h,c*=h;var d={src:this._image.src,style:{clip:"rect(".concat(r,"px, ").concat(i,"px, ").concat(a,"px, ").concat(o,"px)"),height:"".concat(l,"px"),left:"".concat(s,"px"),position:"absolute",top:"".concat(u,"px"),width:"".concat(c,"px")}};return yP.h("img",d,[])}}]),e}(),nz=function(){function e(t){var n=this;if(Bd(this,e),this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new If,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(Cv((function(e){return e})),xv((function(e,t){return t(e)}),new tz),yv(1),Pf()),this._atlasSubscription=this._spriteAtlas$.subscribe((function(){})),null!=t){var r=this._retina?"@2x":"",i=new XMLHttpRequest;i.open("GET",t+r+".png",!0),i.responseType="arraybuffer",i.onload=function(){var e=new Image;e.onload=function(){n._spriteAtlasOperation$.next((function(t){return t.image=e,t}))};var t=new Blob([i.response]);e.src=window.URL.createObjectURL(t)},i.onerror=function(e){console.error(new Error("Failed to fetch sprite sheet (".concat(t).concat(r,".png)")))},i.send();var a=new XMLHttpRequest;a.open("GET",t+r+".json",!0),a.responseType="text",a.onload=function(){var e=JSON.parse(a.response);n._spriteAtlasOperation$.next((function(t){return t.json=e,t}))},a.onerror=function(e){console.error(new Error("Failed to fetch sheet (".concat(t).concat(r,".json)")))},a.send()}}return $d(e,[{key:"spriteAtlas$",get:function(){return this._spriteAtlas$}},{key:"dispose",value:function(){this._atlasSubscription.unsubscribe()}}]),e}(),rz=function(){function e(t,n){var r=this;Bd(this,e),this._subscriptions=new xP;var i=this._subscriptions;this._activeSubject$=new Of(!1),this._active$=this._activeSubject$.pipe(sv(),yv(1),Pf()),i.push(qp(n,"touchmove").subscribe((function(e){e.preventDefault()}))),this._touchStart$=qp(t,"touchstart"),this._touchMove$=qp(t,"touchmove"),this._touchEnd$=qp(t,"touchend"),this._touchCancel$=qp(t,"touchcancel");var a,o=this._touchStart$.pipe(Zp((function(e){return 1===e.touches.length&&1===e.targetTouches.length})),wv());this._doubleTap$=o.pipe((a=function(){return o.pipe(fv(),Tv((function(){return Hp(Vp(300),o).pipe(ov(1))})))},Tf((function(e,t){var n=null,r=null;!function e(){null===r||void 0===r||r.unsubscribe();var i=n;n=[],i&&t.next(i),op(a()).subscribe(r=new Ef(t,e,cf))}(),e.subscribe(new Ef(t,(function(e){return null===n||void 0===n?void 0:n.push(e)}),(function(){n&&t.next(n),t.complete()}),void 0,(function(){return n=r=null})))}))),Zp((function(e){return 2===e.length})),wp((function(e){return e[e.length-1]})),wv()),i.push(this._doubleTap$.subscribe((function(e){e.preventDefault()}))),this._singleTouchMove$=this._touchMove$.pipe(Zp((function(e){return 1===e.touches.length&&1===e.targetTouches.length})),wv());var s=Hp(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(Zp((function(e){return 1===e.touches.length&&1===e.targetTouches.length}))),u=Hp(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(Zp((function(e){return e.touches.length>=1}))),l=Hp(this._touchEnd$,this._touchCancel$).pipe(Zp((function(e){return 0===e.touches.length})));this._singleTouchDragStart$=s.pipe(Np((function(){return r._singleTouchMove$.pipe(Ev(Hp(l,u)),ov(1))}))),this._singleTouchDragEnd$=s.pipe(Np((function(){return Hp(l,u).pipe(fv())}))),this._singleTouchDrag$=s.pipe(Tv((function(){return r._singleTouchMove$.pipe(Sv(1),Ev(Hp(u,l)))})));var c=Hp(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=c.pipe(Zp((function(e){return 2===e.touches.length&&2===e.targetTouches.length}))),this._pinchEnd$=c.pipe(Zp((function(e){return 2!==e.touches.length||2!==e.targetTouches.length}))),this._pinchOperation$=new If,this._pinch$=this._pinchOperation$.pipe(xv((function(e,t){return t(e)}),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));var h=this._touchMove$.pipe(Zp((function(e){return 2===e.touches.length&&2===e.targetTouches.length})),wp((function(e){return function(t){var n=e.touches[0],r=e.touches[1],i=Math.min(n.clientX,r.clientX),a=Math.max(n.clientX,r.clientX),o=Math.min(n.clientY,r.clientY),s=i+(a-i)/2,u=o+(Math.max(n.clientY,r.clientY)-o)/2,l=s+n.pageX-n.clientX,c=u+n.pageY-n.clientY,h=s+n.screenX-n.clientX,d=u+n.screenY-n.clientY,f=Math.abs(n.clientX-r.clientX),p=Math.abs(n.clientY-r.clientY),v=Math.sqrt(f*f+p*p),m=v-t.distance;return{changeX:f-t.distanceX,changeY:p-t.distanceY,clientX:s,clientY:u,distance:v,distanceChange:m,distanceX:f,distanceY:p,originalEvent:e,pageX:l,pageY:c,screenX:h,screenY:d,touch1:n,touch2:r}}}))).subscribe(this._pinchOperation$);i.push(h),this._pinchChange$=this._pinchStart$.pipe(Tv((function(){return r._pinch$.pipe(Sv(1),Ev(r._pinchEnd$))})))}return $d(e,[{key:"active$",get:function(){return this._active$}},{key:"activate$",get:function(){return this._activeSubject$}},{key:"doubleTap$",get:function(){return this._doubleTap$}},{key:"touchStart$",get:function(){return this._touchStart$}},{key:"touchMove$",get:function(){return this._touchMove$}},{key:"touchEnd$",get:function(){return this._touchEnd$}},{key:"touchCancel$",get:function(){return this._touchCancel$}},{key:"singleTouchDragStart$",get:function(){return this._singleTouchDragStart$}},{key:"singleTouchDrag$",get:function(){return this._singleTouchDrag$}},{key:"singleTouchDragEnd$",get:function(){return this._singleTouchDragEnd$}},{key:"pinch$",get:function(){return this._pinchChange$}},{key:"pinchStart$",get:function(){return this._pinchStart$}},{key:"pinchEnd$",get:function(){return this._pinchEnd$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}}]),e}(),iz=function(){function e(t){var n,r,i,a;Bd(this,e);var o=null!==(r=null===(n=null===t||void 0===t?void 0:t.url)||void 0===n?void 0:n.exploreHost)&&void 0!==r?r:"www.mapillary.com",s=null!==(a=null===(i=null===t||void 0===t?void 0:t.url)||void 0===i?void 0:i.scheme)&&void 0!==a?a:"https",u="".concat(s,"://").concat(o);this._exploreUrl$=vp(u);var l=!1!==(null===t||void 0===t?void 0:t.imageTiling);this._imageTiling$=vp(l)}return $d(e,[{key:"exploreUrl$",get:function(){return this._exploreUrl$}},{key:"imageTiling$",get:function(){return this._imageTiling$}}]),e}(),az=function(){function e(t,n,r){var i,a=this;if(Bd(this,e),this._onWindowResize=function(){a._trackResize&&a.renderService.resize$.next()},this._dom=null!==r&&void 0!==r?r:new SA,"string"===typeof t.container){if(this._container=this._dom.document.getElementById(t.container),!this._container)throw new Error('Container "'.concat(t.container,'" not found.'))}else{if(!(t.container instanceof HTMLElement))throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._container=t.container}this._trackResize=!1!==t.trackResize,this.id=null!==(i=this._container.id)&&void 0!==i?i:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new iz(t),this.renderService=new KD(this._container,n.currentState$,t.renderMode),this.glRenderer=new ZD(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new GD(this._domContainer,this.renderService,n.currentState$),this.keyboardService=new JD(this._canvasContainer),this.mouseService=new ez(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new rz(this._canvasContainer,this._domContainer),this.spriteService=new nz(t.sprite),window.addEventListener("resize",this._onWindowResize,!1)}return $d(e,[{key:"canvas",get:function(){return this._canvas.parentNode?this._canvas:null}},{key:"canvasContainer",get:function(){return this._canvasContainer}},{key:"container",get:function(){return this._container}},{key:"domContainer",get:function(){return this._domContainer}},{key:"remove",value:function(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}},{key:"_removeNode",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}}]),e}(),oz=function(){function e(t,n,r){Bd(this,e),this._graphService=t,this._stateService=n,this._api=r,this._subscriptions=new xP,this._started=!1,this._cellDepth=1}return $d(e,[{key:"started",get:function(){return this._started}},{key:"configure",value:function(e){this._cellDepth=e?Math.max(1,Math.min(3,e.cellDepth)):1}},{key:"start",value:function(){var e=this;if(!this._started){var t=this._subscriptions;t.push(this._stateService.currentState$.pipe(sv(void 0,(function(e){return e.state.currentImage.id})),wp((function(e){var t=e.state,n=t.trajectory,r=n.map((function(e){return e.id})),i=n[n.length-1].sequenceId;return[r,t.currentImage.originalLngLat,i]})),Kp(1,5),Lv(this._graphService.graphMode$),Tv((function(t){var n=o(t,2),r=n[0],i=n[1],a=r[0][0],s=r[0][1],u=e._api.data.geometry,l=eL(u.lngLatToCellId(s),e._cellDepth,u),c=i===wA.Sequence?r[0][2]:void 0;return e._graphService.uncache$(a,l,c)}))).subscribe((function(){}))),t.push(this._graphService.graphMode$.pipe(Sv(1),Lv(this._stateService.currentState$),Tv((function(t){var n=o(t,2),r=n[0],i=n[1];return r===wA.Sequence?e._keyToEdges(i.state.currentImage.id,(function(e){return e.sequenceEdges$})):ap(i.state.trajectory.map((function(e){return e.id})).slice(i.state.currentIndex)).pipe(Np((function(t){return e._keyToEdges(t,(function(e){return e.spatialEdges$}))}),6))}))).subscribe((function(){}))),t.push(this._graphService.dataAdded$.pipe(Lv(this._stateService.currentId$),Tv((function(t){var n=o(t,2),r=(n[0],n[1]);return e._graphService.cacheImage$(r)}))).subscribe((function(){}))),this._started=!0}}},{key:"stop",value:function(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}},{key:"_keyToEdges",value:function(e,t){return this._graphService.cacheImage$(e).pipe(Tv(t),fv((function(e){return e.cached})),bp(15e3),Jp((function(t){return console.error("Failed to cache edges (".concat(e,")."),t),Hf()})))}}]),e}(),sz=function(){function e(){Bd(this,e),this._loadersSubject$=new If,this._loaders$=this._loadersSubject$.pipe(xv((function(e,t){return void 0!==t.task&&(e[t.task]=t.loading),e}),{}),Cv({}),yv(1),Pf())}return $d(e,[{key:"loading$",get:function(){return this._loaders$.pipe(wp((function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return!1})),iv(100),sv())}},{key:"taskLoading$",value:function(e){return this._loaders$.pipe(wp((function(t){return!!t[e]})),iv(100),sv())}},{key:"startLoading",value:function(e){this._loadersSubject$.next({loading:!0,task:e})}},{key:"stopLoading",value:function(e){this._loadersSubject$.next({loading:!1,task:e})}}]),e}();!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.Started=2]="Started"}(HD||(HD={}));var uz=function(){function e(t,n,r,i,a,o){Bd(this,e),this._subscriptions=new xP,this._graphService=t,this._stateService=n,this._graphCalculator=null!==i&&void 0!==i?i:new zM,this._spatial=null!==a&&void 0!==a?a:new WM,this._viewportCoords=null!==o&&void 0!==o?o:new CP,this._mode=!1!==r?HD.Enabled:HD.Disabled,this._panImagesSubject$=new If,this._panImages$=this._panImagesSubject$.pipe(Cv([]),yv(1),Pf()),this._subscriptions.push(this._panImages$.subscribe())}return $d(e,[{key:"panImages$",get:function(){return this._panImages$}},{key:"dispose",value:function(){this.stop(),null!=this._panImagesSubscription&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}},{key:"enable",value:function(){this._mode===HD.Disabled&&(this._mode=HD.Enabled,this.start())}},{key:"disable",value:function(){this._mode!==HD.Disabled&&(this.stop(),this._mode=HD.Disabled)}},{key:"start",value:function(){var e=this;if(this._mode===HD.Enabled){var t=this._stateService.currentImage$.pipe(Tv((function(t){if(!t.merged||ZM(t.cameraType))return vp([]);var n=vp(t),r=e._graphCalculator.boundingBoxCorners(t.lngLat,20),i=e._graphService.cacheBoundingBox$(r[0],r[1]).pipe(Jp((function(e){return console.error("Failed to cache periphery bounding box (".concat(t.id,")"),e),Hf()})),wp((function(n){if(ZM(t.cameraType))return[];var r,i=[],a=Ad(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.id!==t.id&&(o.mergeId===t.mergeId&&(ZM(o.cameraType)||e._distance(o,t)>4||i.push(o)))}}catch(CO){a.e(CO)}finally{a.f()}return i})));return Lp(n,i).pipe(Lv(e._stateService.reference$),wp((function(t){var n,r=o(t,2),i=o(r[0],2),a=i[0],s=i[1],u=r[1],l=e._spatial.viewingDirection(a.rotation),c=XM({lat:a.lngLat.lat,lng:a.lngLat.lng,alt:a.computedAltitude},a.rotation,u),h=e._createTransform(a,c),d=e._spatial.wrap(e._spatial.azimuthal(l.toArray(),h.upVector().toArray()),0,2*Math.PI),f=e._computeProjectedPoints(h),p=e._computeHorizontalFov(f)/180*Math.PI,v=Math.PI/8,m=void 0,g=void 0,_=Ad(s);try{for(_.s();!(n=_.n()).done;){var y=n.value,b=XM({lat:y.lngLat.lat,lng:y.lngLat.lng,alt:y.computedAltitude},y.rotation,u),x=e._createTransform(y,b),w=e._computeProjectedPoints(x),k=e._computeHorizontalFov(w)/180*Math.PI,S=e._spatial.viewingDirection(y.rotation),M=e._spatial.wrap(e._spatial.azimuthal(S.toArray(),x.upVector().toArray()),0,2*Math.PI),C=e._spatial.angleBetweenVector2(l.x,l.y,S.x,S.y),T=Number.NEGATIVE_INFINITY;T=C>0?d>M?d-2*Math.PI+p/2-(M-k/2):d+p/2-(M-k/2):d<M?M+k/2-(d+2*Math.PI-p/2):M+k/2-(d-p/2);var E=Math.abs(k-T),P=e._distance(y,a)+Math.min(e._timeDifference(y,a),4)+20*Math.abs(T-v)+Math.min(5,1/Math.min(k/p,1))+(T>0?-2*E:0);T>0&&T<.5*p&&T<.5*k&&E>.5*p&&(C>0?m?P<m[0]&&(m=[P,y,x,k]):m=[P,y,x,k]:g?P<g[0]&&(g=[P,y,x,k]):g=[P,y,x,k])}}catch(CO){_.e(CO)}finally{_.f()}var A=[];return m&&A.push([m[1],m[2],m[3]]),g&&A.push([g[1],g[2],g[3]]),A})),Cv([]))})));this._panImagesSubscription=this._stateService.currentState$.pipe(wp((function(e){return e.state.imagesAhead>0})),sv(),Tv((function(e){return e?vp([]):t}))).subscribe((function(t){e._panImagesSubject$.next(t)})),this._mode=HD.Started}}},{key:"stop",value:function(){this._mode===HD.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=HD.Enabled)}},{key:"_distance",value:function(e,t){var n=o(RM(e.lngLat.lng,e.lngLat.lat,e.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude),3),r=n[0],i=n[1],a=n[2];return Math.sqrt(r*r+i*i+a*a)}},{key:"_timeDifference",value:function(e,t){return Math.abs(e.capturedAt-t.capturedAt)/2592e6}},{key:"_createTransform",value:function(e,t){return new PA(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.assetsCached?e.image:void 0,void 0,e.cameraParameters,e.cameraType)}},{key:"_computeProjectedPoints",value:function(e){return KM(e,[[1,0]],[[0,.5]],20,this._viewportCoords)}},{key:"_computeHorizontalFov",value:function(e){var t=this,n=e.map((function(e){return t._coordToFov(e[0])}));return Math.min.apply(Math,xd(n))}},{key:"_coordToFov",value:function(e){return 2*Math.atan(e)*180/Math.PI}}]),e}(),lz=function(){function e(t){Bd(this,e),this._data=t}return $d(e,[{key:"data",get:function(){return this._data}},{key:"getCoreImages$",value:function(e){return this._wrap$(this._data.getCoreImages(e))}},{key:"getImages$",value:function(e){return this._wrap$(this._data.getImages(e))}},{key:"getImageTiles$",value:function(e){return this._wrap$(this._data.getImageTiles(e))}},{key:"getSequence$",value:function(e){return this._wrap$(this._data.getSequence(e))}},{key:"getSpatialImages$",value:function(e){return this._wrap$(this._data.getSpatialImages(e))}},{key:"setAccessToken",value:function(e){this._data.setAccessToken(e)}},{key:"_wrap$",value:function(e){return Sf.create((function(t){e.then((function(e){t.next(e),t.complete()}),(function(e){t.error(e)}))}))}}]),e}(),cz=function(){function e(t){var n=this;Bd(this,e),this._dataAdded$=new If,this._subscriptions=new xP,this._onDataAdded=function(e){n._graph$.pipe(fv(),Np((function(t){return t.updateCells$(e.cellIds).pipe(Av((function(){t.resetSpatialEdges()})))}))).subscribe((function(e){n._dataAdded$.next(e)}))};var r=this._subscriptions;this._graph$=jp(vp(t),t.changed$).pipe(yv(1),Pf()),r.push(this._graph$.subscribe((function(){}))),this._graphMode=wA.Spatial,this._graphModeSubject$=new If,this._graphMode$=this._graphModeSubject$.pipe(Cv(this._graphMode),yv(1),Pf()),r.push(this._graphMode$.subscribe((function(){}))),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],t.api.data.on("datacreate",this._onDataAdded)}return $d(e,[{key:"dataAdded$",get:function(){return this._dataAdded$}},{key:"filter$",get:function(){return this._graph$.pipe(fv(),Np((function(e){return e.filter$})))}},{key:"graphMode$",get:function(){return this._graphMode$}},{key:"cacheBoundingBox$",value:function(e,t){return this._graph$.pipe(fv(),Np((function(n){return n.cacheBoundingBox$(e,t)})))}},{key:"cacheCell$",value:function(e){return this._graph$.pipe(fv(),Np((function(t){return t.cacheCell$(e)})))}},{key:"cacheImage$",value:function(e){var t=this,n=new If;this._firstGraphSubjects$.push(n);var r,i=n.pipe(yv(1),Pf()),a=i.pipe(wp((function(t){return t.getNode(e)})),Np((function(e){return e.assetsCached?vp(e):e.cacheAssets$()})),yv(1),Pf());a.subscribe(void 0,(function(t){console.error("Failed to cache image (".concat(e,")."),t)})),(r=this._graph$.pipe(fv(),Np((function(t){return t.isCachingFull(e)||!t.hasNode(e)?t.cacheFull$(e):t.isCachingFill(e)||!t.getNode(e).complete?t.cacheFill$(e):vp(t)})),Av((function(t){if(!t.hasNode(e))throw new QM("Failed to cache image (".concat(e,")"));t.hasInitializedCache(e)||t.initializeCache(e)})),dv((function(){null!=r&&(t._removeFromArray(r,t._initializeCacheSubscriptions),t._removeFromArray(n,t._firstGraphSubjects$))}))).subscribe((function(e){n.next(e),n.complete()}),(function(e){n.error(e)}))).closed||this._initializeCacheSubscriptions.push(r);var o,s,u=i.pipe(Jp((function(){return Hf()})),Np((function(t){return t.isCachingNodeSequence(e)||!t.hasNodeSequence(e)?t.cacheNodeSequence$(e):vp(t)})),yv(1),Pf());((o=u.pipe(Av((function(t){t.getNode(e).sequenceEdges.cached||t.cacheSequenceEdges(e)})),dv((function(){null!=o&&t._removeFromArray(o,t._sequenceSubscriptions)}))).subscribe((function(){}),(function(t){console.error("Failed to cache sequence edges (".concat(e,")."),t)}))).closed||this._sequenceSubscriptions.push(o),this._graphMode===wA.Spatial)&&((s=i.pipe(Jp((function(){return Hf()})),hv((function(t){return t.hasTiles(e)?Hf():ap(t.cacheTiles$(e)).pipe(Np((function(t){return t.pipe(Np((function(t){return t.isCachingTiles(e)?Hf():vp(t)})),Jp((function(t){return console.error("Failed to cache tile data (".concat(e,")."),t),Hf()})))})))})),pv(1),Np((function(t){return t.hasSpatialArea(e)?vp(t):ap(t.cacheSpatialArea$(e)).pipe(Np((function(t){return t.pipe(Jp((function(t){return console.error("Failed to cache spatial images (".concat(e,")."),t),Hf()})))})))})),pv(1),Np((function(t){return t.hasNodeSequence(e)?vp(t):t.cacheNodeSequence$(e)})),Av((function(t){t.getNode(e).spatialEdges.cached||t.cacheSpatialEdges(e)})),dv((function(){null!=s&&t._removeFromArray(s,t._spatialSubscriptions)}))).subscribe((function(){}),(function(t){var n="Failed to cache spatial edges (".concat(e,").");console.error(n,t)}))).closed||this._spatialSubscriptions.push(s));return a.pipe(fv((function(e){return e.assetsCached})))}},{key:"cacheSequence$",value:function(e){return this._graph$.pipe(fv(),Np((function(t){return t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):vp(t)})),wp((function(t){return t.getSequence(e)})))}},{key:"cacheSequenceImages$",value:function(e,t){return this._graph$.pipe(fv(),Np((function(t){return t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):vp(t)})),Np((function(n){return n.isCachingSequenceNodes(e)||!n.hasSequenceNodes(e)?n.cacheSequenceNodes$(e,t):vp(n)})),wp((function(t){return t.getSequence(e)})))}},{key:"dispose",value:function(){this._graph$.pipe(fv()).subscribe((function(e){e.unsubscribe()})),this._subscriptions.unsubscribe()}},{key:"setFilter$",value:function(e){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(fv(),Av((function(t){t.resetSpatialEdges(),t.setFilter(e)})),wp((function(){})))}},{key:"setGraphMode",value:function(e){this._graphMode!==e&&(e===wA.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=e,this._graphModeSubject$.next(this._graphMode))}},{key:"reset$",value:function(e){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(fv(),Av((function(t){t.reset(e)})),wp((function(){})))}},{key:"uncache$",value:function(e,t,n){return this._graph$.pipe(fv(),Av((function(r){r.uncache(e,t,n)})),wp((function(){})))}},{key:"_abortSubjects",value:function(e){var t,n=Ad(e.slice());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._removeFromArray(r,e),r.error(new Error("Cache image request was aborted."))}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"_removeFromArray",value:function(e,t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},{key:"_resetSubscriptions",value:function(e){var t,n=Ad(e.slice());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._removeFromArray(r,e),r.closed||r.unsubscribe()}}catch(CO){n.e(CO)}finally{n.f()}}}]),e}(),hz=function(){function e(t){Bd(this,e),t.requestAnimationFrame?(this._cancelAnimationFrame=t.cancelAnimationFrame.bind(t),this._requestAnimationFrame=t.requestAnimationFrame.bind(t)):t.mozRequestAnimationFrame?(this._cancelAnimationFrame=t.mozCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.mozRequestAnimationFrame.bind(t)):t.webkitRequestAnimationFrame?(this._cancelAnimationFrame=t.webkitCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.webkitRequestAnimationFrame.bind(t)):t.msRequestAnimationFrame?(this._cancelAnimationFrame=t.msCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.msRequestAnimationFrame.bind(t)):t.oRequestAnimationFrame?(this._cancelAnimationFrame=t.oCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.oRequestAnimationFrame.bind(t)):(this._cancelAnimationFrame=t.clearTimeout.bind(t),this._requestAnimationFrame=function(e){return t.setTimeout(e,1e3/60)})}return $d(e,[{key:"cancelAnimationFrame",get:function(){return this._cancelAnimationFrame}},{key:"requestAnimationFrame",get:function(){return this._requestAnimationFrame}}]),e}(),dz=function(){function e(t){Bd(this,e),this._spatial=new WM,this._referenceThreshold=.01,this._transitionMode=t.transitionMode,this._reference=t.reference,this._alpha=t.alpha,this._stateTransitionAlpha=0,this._camera=t.camera.clone(),this._zoom=t.zoom,this._currentIndex=t.currentIndex,this._trajectory=t.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];var n,r=Ad(this._trajectory);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this._imageToTranslation(i,this._reference),o=new PA(i.exifOrientation,i.width,i.height,i.scale,i.rotation,a,i.image,void 0,i.cameraParameters,i.cameraType);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new YD(o))}}catch(CO){r.e(CO)}finally{r.f()}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new YD,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}return $d(e,[{key:"reference",get:function(){return this._reference}},{key:"alpha",get:function(){return this._getAlpha()}},{key:"stateTransitionAlpha",get:function(){return this._getStateTransitionAlpha()}},{key:"camera",get:function(){return this._camera}},{key:"zoom",get:function(){return this._zoom}},{key:"trajectory",get:function(){return this._trajectory}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"currentImage",get:function(){return this._currentImage}},{key:"previousImage",get:function(){return this._previousImage}},{key:"currentCamera",get:function(){return this._currentCamera}},{key:"currentTransform",get:function(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}},{key:"previousTransform",get:function(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}},{key:"motionless",get:function(){return this._motionless}},{key:"transitionMode",get:function(){return this._transitionMode}},{key:"move",value:function(e){}},{key:"moveTo",value:function(e){}},{key:"rotate",value:function(e){}},{key:"rotateUnbounded",value:function(e){}},{key:"rotateWithoutInertia",value:function(e){}},{key:"rotateBasic",value:function(e){}},{key:"rotateBasicUnbounded",value:function(e){}},{key:"rotateBasicWithoutInertia",value:function(e){}},{key:"rotateToBasic",value:function(e){}},{key:"setSpeed",value:function(e){}},{key:"zoomIn",value:function(e,t){}},{key:"update",value:function(e){}},{key:"setCenter",value:function(e){}},{key:"setZoom",value:function(e){}},{key:"dolly",value:function(e){}},{key:"orbit",value:function(e){}},{key:"setViewMatrix",value:function(e){}},{key:"truck",value:function(e){}},{key:"append",value:function(e){if(e.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(e):(this._trajectory=this._trajectory.concat(e),this._appendToTrajectories(e))}},{key:"prepend",value:function(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=e.slice().concat(this._trajectory),this._currentIndex+=e.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(e),this._setCurrentCamera()}},{key:"remove",value:function(e){if(e<0)throw Error("n must be a positive integer");if(this._currentIndex-1<e)throw Error("Current and previous images can not be removed");for(var t=0;t<e;t++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}},{key:"clearPrior",value:function(){this._currentIndex>0&&this.remove(this._currentIndex-1)}},{key:"clear",value:function(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}},{key:"cut",value:function(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}},{key:"set",value:function(e){this._setTrajectory(e),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}},{key:"getCenter",value:function(){return null!=this._currentImage?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}},{key:"setTransitionMode",value:function(e){this._transitionMode=e}},{key:"_getAlpha",value:function(){return 1}},{key:"_getStateTransitionAlpha",value:function(){return 1}},{key:"_setCurrent",value:function(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}},{key:"_setCurrentCamera",value:function(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}},{key:"_motionlessTransition",value:function(){return null!=this._currentImage&&null!=this._previousImage&&(this._transitionMode===VD.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}},{key:"_setReference",value:function(e){return!(Math.abs(e.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(e.lngLat.lng-this.reference.lng)<this._referenceThreshold)&&(!(null!=this._previousImage&&!this._motionlessTransition())&&(this._reference.lat=e.lngLat.lat,this._reference.lng=e.lngLat.lng,this._reference.alt=e.computedAltitude,!0))}},{key:"_setCurrentImage",value:function(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}},{key:"_setTrajectory",value:function(e){if(e.length<1)throw new HM("Trajectory can not be empty");null!=this._currentImage?(this._trajectory=[this._currentImage].concat(e),this._currentIndex=1):(this._trajectory=e.slice(),this._currentIndex=0)}},{key:"_setTrajectories",value:function(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}},{key:"_appendToTrajectories",value:function(e){var t,n=Ad(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!r.assetsCached)throw new HM("Assets must be cached when image is added to trajectory");var i=this._imageToTranslation(r,this.reference),a=new PA(r.exifOrientation,r.width,r.height,r.scale,r.rotation,i,r.image,void 0,r.cameraParameters,r.cameraType);this._trajectoryTransforms.push(a),this._trajectoryCameras.push(new YD(a))}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"_prependToTrajectories",value:function(e){var t,n=Ad(e.reverse());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!r.assetsCached)throw new HM("Assets must be cached when added to trajectory");var i=this._imageToTranslation(r,this.reference),a=new PA(r.exifOrientation,r.width,r.height,r.scale,r.rotation,i,r.image,void 0,r.cameraParameters,r.cameraType);this._trajectoryTransforms.unshift(a),this._trajectoryCameras.unshift(new YD(a))}}catch(CO){n.e(CO)}finally{n.f()}}},{key:"_imageToTranslation",value:function(e,t){return XM({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t)}},{key:"_sameConnectedComponent",value:function(){var e=this._currentImage,t=this._previousImage;return!!e&&!!t&&e.mergeId===t.mergeId}},{key:"_withinOriginalDistance",value:function(){var e=this._currentImage,t=this._previousImage;return!e||!t||this._spatial.distanceFromLngLat(e.originalLngLat.lng,e.originalLngLat.lat,t.originalLngLat.lng,t.originalLngLat.lat)<25}}]),e}(),fz=function(e){Dd(n,e);var t=zd(n);function n(e){return Bd(this,n),t.call(this,e)}return $d(n,[{key:"setViewMatrix",value:function(e){var t=(new xg).fromArray(e).invert().elements,n=new Vm(t[12],t[13],t[14]),r=new Vm(-t[8],-t[9],-t[10]),i=new Vm(t[4],t[5],t[6]),a=this._camera;a.position.copy(n),a.lookat.copy(n.clone().add(r)),a.up.copy(i);var o=.5/Math.tan(Math.PI/3);a.focal=o}}]),n}(dz),pz=function(e){Dd(n,e);var t=zd(n);function n(e){var r;Bd(this,n),(r=t.call(this,e))._transition=0;var i=r._camera.position.clone(),a=r._camera.lookat.clone().sub(i).normalize(),o=Math.sqrt(a.x*a.x+a.y*a.y),s=Math.atan2(a.z,o),u=new Vm;if(s>-Math.PI/45)u.copy(i),i.add(new Vm(a.x,a.y,0).multiplyScalar(-50)),i.z=30;else{var l=i.clone(),c=new Vm(0,0,1),h=new Vm(0,0,-2),d=(new Vm).subVectors(h,l).dot(c)/a.dot(c),f=l.clone().add(a.clone().multiplyScalar(Math.min(1e4,d)));u.copy(f);var p=i.clone().sub(f).normalize();i.copy(f.add(p.multiplyScalar(Math.max(50,p.length()))))}var v=r._camera.position.clone(),m=v.clone().add(a.clone().normalize().multiplyScalar(10)),g=r._camera.up.clone(),_=m.clone(),y=_.clone().add(a.clone().normalize().multiplyScalar(10)),b=g.clone(),x=i.clone(),w=u.clone(),k=new Vm(0,0,1),S=i.clone().add(w.clone().sub(x).normalize().multiplyScalar(-10)),M=w.clone(),C=k.clone();return r._curveE=new lk([_,v,x,S]),r._curveL=new lk([y,m,w,M]),r._curveU=new lk([b,g,k,C]),r._zoom0=r._zoom,r._zoom1=0,r._camera.focal=.5/Math.tan(Math.PI/4),r}return $d(n,[{key:"_isTransitioning",get:function(){return this._transition<1}},{key:"dolly",value:function(e){if(!this._isTransitioning){var t=this._camera,n=t.position.clone().sub(t.lookat),r=n.length()*Math.pow(2,-e),i=Math.max(1,Math.min(r,4e3));n.normalize(),n.multiplyScalar(i),t.position.copy(t.lookat).add(n)}}},{key:"orbit",value:function(e){if(!this._isTransitioning){var t=this._camera,n=(new Um).setFromUnitVectors(t.up,new Vm(0,0,1)),r=n.clone().invert(),i=t.position.clone().sub(t.lookat);i.applyQuaternion(n);var a=i.length(),o=Math.atan2(i.y,i.x);o+=e.phi;var s=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);s+=e.theta;var u=Math.PI/36;s=Math.max(u,Math.min(Math.PI/2-u,s)),i.x=Math.sin(s)*Math.cos(o),i.y=Math.sin(s)*Math.sin(o),i.z=Math.cos(s),i.applyQuaternion(r),t.position.copy(t.lookat).add(i.multiplyScalar(a))}}},{key:"truck",value:function(e){if(!this._isTransitioning){var t=this._camera;t.position.add((new Vm).fromArray(e)),t.lookat.add((new Vm).fromArray(e))}}},{key:"update",value:function(e){if(this._isTransitioning){this._transition=Math.min(this._transition+2*e/3,1);var t=Em.smootherstep(this._transition,0,1),n=(t+1)/3,r=this._curveE.getPoint(n),i=this._curveL.getPoint(n),a=this._curveU.getPoint(n);this._camera.position.copy(r),this._camera.lookat.copy(i),this._camera.up.copy(a),this._zoom=Em.lerp(this._zoom0,this._zoom1,t),this._stateTransitionAlpha=t}}},{key:"_getStateTransitionAlpha",value:function(){return this._stateTransitionAlpha}}]),n}(dz),vz=function(){function e(t,n){Bd(this,e),this._phi=t,this._theta=n}return $d(e,[{key:"phi",get:function(){return this._phi},set:function(e){this._phi=e}},{key:"theta",get:function(){return this._theta},set:function(e){this._theta=e}},{key:"isZero",get:function(){return 0===this._phi&&0===this._theta}},{key:"copy",value:function(e){this._phi=e.phi,this._theta=e.theta}},{key:"lerp",value:function(e,t){this._phi=(1-t)*this._phi+t*e.phi,this._theta=(1-t)*this._theta+t*e.theta}},{key:"multiply",value:function(e){this._phi*=e,this._theta*=e}},{key:"threshold",value:function(e){this._phi=Math.abs(this._phi)>e?this._phi:0,this._theta=Math.abs(this._theta)>e?this._theta:0}},{key:"lengthSquared",value:function(){return this._phi*this._phi+this._theta*this._theta}},{key:"reset",value:function(){this._phi=0,this._theta=0}}]),e}(),mz=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e))._animationSpeed=1/40,r._rotationDelta=new vz(0,0),r._requestedRotationDelta=null,r._basicRotation=[0,0],r._requestedBasicRotation=null,r._requestedBasicRotationUnbounded=null,r._rotationAcceleration=.86,r._rotationIncreaseAlpha=.97,r._rotationDecreaseAlpha=.9,r._rotationThreshold=.001,r._unboundedRotationAlpha=.8,r._desiredZoom=e.zoom,r._minZoom=0,r._maxZoom=3,r._lookatDepth=10,r._desiredLookat=null,r._desiredCenter=null,r}return $d(n,[{key:"rotate",value:function(e){null!=this._currentImage&&(0===e.phi&&0===e.theta||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,null!=this._requestedRotationDelta?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+e.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+e.theta):this._requestedRotationDelta=new vz(e.phi,e.theta)))}},{key:"rotateUnbounded",value:function(e){if(null!=this._currentImage&&(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(e,this._currentCamera),this._applyRotation(e,this._previousCamera),this._desiredLookat)){var t=(new Um).setFromUnitVectors(this._currentCamera.up,new Vm(0,0,1)),n=t.clone().invert(),r=(new Vm).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(t),i=r.length(),a=Math.atan2(r.y,r.x);a+=e.phi;var o=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);o+=e.theta,o=Math.max(.1,Math.min(Math.PI-.1,o)),r.x=Math.sin(o)*Math.cos(a),r.y=Math.sin(o)*Math.sin(a),r.z=Math.cos(o),r.applyQuaternion(n),this._desiredLookat.copy(this._camera.position).add(r.multiplyScalar(i))}}},{key:"rotateWithoutInertia",value:function(e){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;var t=Math.PI/(10*Math.pow(2,this._zoom)),n={phi:this._spatial.clamp(e.phi,-t,t),theta:this._spatial.clamp(e.theta,-t,t)};this._applyRotation(n,this._currentCamera),this._applyRotation(n,this._previousCamera)}}},{key:"rotateBasic",value:function(e){if(null!=this._currentImage)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,null!=this._requestedBasicRotation){this._requestedBasicRotation[0]+=e[0],this._requestedBasicRotation[1]+=e[1];var t=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-t,t),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-t,t)}else this._requestedBasicRotation=e.slice()}},{key:"rotateBasicUnbounded",value:function(e){null!=this._currentImage&&(null!=this._requestedBasicRotationUnbounded?(this._requestedBasicRotationUnbounded[0]+=e[0],this._requestedBasicRotationUnbounded[1]+=e[1]):this._requestedBasicRotationUnbounded=e.slice())}},{key:"rotateBasicWithoutInertia",value:function(e){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;var t=.05/Math.pow(2,this._zoom),n=e.slice();n[0]=this._spatial.clamp(n[0],-t,t),n[1]=this._spatial.clamp(n[1],-t,t),this._applyRotationBasic(n)}}},{key:"rotateToBasic",value:function(e){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,e[0]=this._spatial.clamp(e[0],0,1),e[1]=this._spatial.clamp(e[1],0,1);var t=this.currentTransform.unprojectBasic(e,this._lookatDepth);this._currentCamera.lookat.fromArray(t)}}},{key:"zoomIn",value:function(e,t){if(null!=this._currentImage){this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+e));var n=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),r=n[0],i=n[1],a=Math.pow(2,this._zoom),o=Math.pow(2,this._desiredZoom),s=t[0],u=t[1];ZM(this.currentTransform.cameraType)&&(s-r>.5?s-=1:r-s>.5&&(s=1+s));var l=s-a/o*(s-r),c=u-a/o*(u-i);ZM(this._currentImage.cameraType)?(l=this._spatial.wrap(l+this._basicRotation[0],0,1),c=this._spatial.clamp(c+this._basicRotation[1],.05,.95)):(l=this._spatial.clamp(l,0,1),c=this._spatial.clamp(c,0,1)),this._desiredLookat=(new Vm).fromArray(this.currentTransform.unprojectBasic([l,c],this._lookatDepth))}}},{key:"setCenter",value:function(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;var t=[this._spatial.clamp(e[0],0,1),this._spatial.clamp(e[1],0,1)];if(null!=this._currentImage){this._desiredCenter=null;var n=(new Vm).fromArray(this.currentTransform.unprojectBasic(t,this._lookatDepth)),r=null!=this.previousTransform?this.previousTransform:this.currentTransform,i=(new Vm).fromArray(r.unprojectBasic(t,this._lookatDepth));this._currentCamera.lookat.copy(n),this._previousCamera.lookat.copy(i)}else this._desiredCenter=t}},{key:"setZoom",value:function(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(e,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}},{key:"_applyRotation",value:function(e,t){if(null!=t){var n=(new Um).setFromUnitVectors(t.up,new Vm(0,0,1)),r=n.clone().invert(),i=new Vm;i.copy(t.lookat).sub(t.position),i.applyQuaternion(n);var a=i.length(),o=Math.atan2(i.y,i.x);o+=e.phi;var s=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);s+=e.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),i.x=Math.sin(s)*Math.cos(o),i.y=Math.sin(s)*Math.sin(o),i.z=Math.cos(s),i.applyQuaternion(r),t.lookat.copy(t.position).add(i.multiplyScalar(a))}}},{key:"_applyRotationBasic",value:function(e){var t=this._currentImage,n=null!=this._previousImage?this.previousImage:this.currentImage,r=this._currentCamera,i=this._previousCamera,a=this.currentTransform,o=null!=this.previousTransform?this.previousTransform:this.currentTransform,s=a.projectBasic(r.lookat.toArray()),u=o.projectBasic(i.lookat.toArray());ZM(t.cameraType)?(s[0]=this._spatial.wrap(s[0]+e[0],0,1),s[1]=this._spatial.clamp(s[1]+e[1],.05,.95)):(s[0]=this._spatial.clamp(s[0]+e[0],0,1),s[1]=this._spatial.clamp(s[1]+e[1],0,1)),ZM(n.cameraType)?(u[0]=this._spatial.wrap(u[0]+e[0],0,1),u[1]=this._spatial.clamp(u[1]+e[1],.05,.95)):(u[0]=this._spatial.clamp(u[0]+e[0],0,1),u[1]=this._spatial.clamp(s[1]+e[1],0,1));var l=a.unprojectBasic(s,this._lookatDepth);r.lookat.fromArray(l);var c=o.unprojectBasic(u,this._lookatDepth);i.lookat.fromArray(c)}},{key:"_updateZoom",value:function(e){var t=this._desiredZoom-this._zoom,n=t>0?1:t<0?-1:0;0!==t&&(Math.abs(t)<.002?(this._zoom=this._desiredZoom,null!=this._desiredLookat&&(this._desiredLookat=null)):this._zoom+=n*Math.max(Math.abs(5*e*t),.002))}},{key:"_updateLookat",value:function(e){if(null!==this._desiredLookat){var t=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(t)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*e)}}},{key:"_updateRotation",value:function(){if(null!=this._requestedRotationDelta){var e=this._rotationDelta.lengthSquared();return this._requestedRotationDelta.lengthSquared()>e?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null)}if(!this._rotationDelta.isZero){var t=ZM(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*t),this._rotationDelta.threshold(this._rotationThreshold)}}},{key:"_updateRotationBasic",value:function(){if(null!=this._requestedBasicRotation){var e=this._basicRotation[0],t=this._basicRotation[1],n=this._requestedBasicRotation[0],r=this._requestedBasicRotation[1];return Math.abs(n)>Math.abs(e)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*n:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*n,Math.abs(r)>Math.abs(t)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*r:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*r,void(this._requestedBasicRotation=null)}if(null!=this._requestedBasicRotationUnbounded){var i=this._requestedBasicRotationUnbounded[0],a=this._requestedBasicRotationUnbounded[1];if(Math.abs(i)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*i),Math.abs(a)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*a),null!=this._desiredLookat){var o=this.currentTransform.projectBasic(this._desiredLookat.toArray());o[0]+=i,o[1]+=a,this._desiredLookat=(new Vm).fromArray(this.currentTransform.unprojectBasic(o,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}0===this._basicRotation[0]&&0===this._basicRotation[1]||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}},{key:"_clearRotation",value:function(){ZM(this._currentImage.cameraType)||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),null!=this._requestedBasicRotation&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}},{key:"_setDesiredCenter",value:function(){if(null!=this._desiredCenter){var e=(new Vm).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(e)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(e)),this._desiredCenter=null}}},{key:"_setDesiredZoom",value:function(){this._desiredZoom=ZM(this._currentImage.cameraType)||null==this._previousImage?this._zoom:0}}]),n}(dz),gz=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e))._adjustCameras(),r._motionless=r._motionlessTransition(),r}return $d(n,[{key:"prepend",value:function(e){Nd(wd(n.prototype),"prepend",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"set",value:function(e){Nd(wd(n.prototype),"set",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"move",value:function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}},{key:"moveTo",value:function(e){this._alpha=Math.max(0,Math.min(1,e))}},{key:"update",value:function(e){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation);var t=this._animationSpeed*e/.1*6;this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.round(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){Nd(wd(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){if(ZM(this._currentImage.cameraType)){var e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(ZM(this._previousImage.cameraType)){var t=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position))}}}}]),n}(mz),_z=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e))._adjustCameras(),r._motionless=r._motionlessTransition(),r._baseAlpha=r._alpha,r._speedCoefficient=1,r._smoothing=!1,r}return $d(n,[{key:"append",value:function(e){var t=0===this._trajectory.length;t&&this._resetTransition(),Nd(wd(n.prototype),"append",this).call(this,e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}},{key:"prepend",value:function(e){var t=0===this._trajectory.length;t&&this._resetTransition(),Nd(wd(n.prototype),"prepend",this).call(this,e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}},{key:"set",value:function(e){Nd(wd(n.prototype),"set",this).call(this,e),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._smoothing=!0)}},{key:"setSpeed",value:function(e){this._speedCoefficient=this._spatial.clamp(e,0,10)}},{key:"update",value:function(e){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._smoothing=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=ZM(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);var t=this._animationSpeed*e/.1*6;this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*t),this._smoothing?this._alpha=Em.smootherstep(this._baseAlpha,0,1):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation),this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.ceil(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){Nd(wd(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){var e=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position)),ZM(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}}},{key:"_resetTransition",value:function(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}]),n}(mz),yz=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e))._zoom=0,r._adjustCameras(),r._motionless=r._motionlessTransition(),r}return $d(n,[{key:"prepend",value:function(e){Nd(wd(n.prototype),"prepend",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"set",value:function(e){Nd(wd(n.prototype),"set",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"move",value:function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}},{key:"moveTo",value:function(e){this._alpha=Math.max(0,Math.min(1,e))}},{key:"update",value:function(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.round(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){Nd(wd(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){if(ZM(this._currentImage.cameraType)){var e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(ZM(this._previousImage.cameraType)){var t=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position))}}}}]),n}(dz),bz=function(){function e(){Bd(this,e);var t=XP[XP.Custom],n=XP[XP.Earth],r=XP[XP.Traversing],i=XP[XP.Waiting],a=XP[XP.WaitingInteractively];this._creators=new Map;var o=this._creators;o.set(t,fz),o.set(n,pz),o.set(r,_z),o.set(i,yz),o.set(a,gz),this._transitions=new Map;var s=this._transitions;s.set(t,[n,r]),s.set(n,[t,r]),s.set(r,[t,n,i,a]),s.set(i,[r,a]),s.set(a,[r,i])}return $d(e,[{key:"getState",value:function(e){if(e instanceof fz)return XP.Custom;if(e instanceof pz)return XP.Earth;if(e instanceof _z)return XP.Traversing;if(e instanceof yz)return XP.Waiting;if(e instanceof gz)return XP.WaitingInteractively;throw new Error("Invalid state instance")}},{key:"generate",value:function(e,t){return new(this._creators.get(XP[e]))(t)}},{key:"transition",value:function(e,t){if(!this.validate(e,t))throw new Error("Invalid transition");return this.generate(t,e)}},{key:"validate",value:function(e,t){var n=XP[this.getState(e)],r=XP[t],i=this._transitions;return i.has(n)&&i.get(n).includes(r)}}]),e}(),xz=function(){function e(t,n){Bd(this,e),this._transitions=new bz,this._state=this._transitions.generate(t,{alpha:1,camera:new YD,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:null==n?VD.Default:n,zoom:0})}return $d(e,[{key:"state",get:function(){return this._transitions.getState(this._state)}},{key:"reference",get:function(){return this._state.reference}},{key:"alpha",get:function(){return this._state.alpha}},{key:"stateTransitionAlpha",get:function(){return this._state.stateTransitionAlpha}},{key:"camera",get:function(){return this._state.camera}},{key:"zoom",get:function(){return this._state.zoom}},{key:"currentImage",get:function(){return this._state.currentImage}},{key:"previousImage",get:function(){return this._state.previousImage}},{key:"currentCamera",get:function(){return this._state.currentCamera}},{key:"currentTransform",get:function(){return this._state.currentTransform}},{key:"previousTransform",get:function(){return this._state.previousTransform}},{key:"trajectory",get:function(){return this._state.trajectory}},{key:"currentIndex",get:function(){return this._state.currentIndex}},{key:"lastImage",get:function(){return this._state.trajectory[this._state.trajectory.length-1]}},{key:"imagesAhead",get:function(){return this._state.trajectory.length-1-this._state.currentIndex}},{key:"motionless",get:function(){return this._state.motionless}},{key:"custom",value:function(){this._transition(XP.Custom)}},{key:"earth",value:function(){this._transition(XP.Earth)}},{key:"traverse",value:function(){this._transition(XP.Traversing)}},{key:"wait",value:function(){this._transition(XP.Waiting)}},{key:"waitInteractively",value:function(){this._transition(XP.WaitingInteractively)}},{key:"getCenter",value:function(){return this._state.getCenter()}},{key:"setCenter",value:function(e){this._state.setCenter(e)}},{key:"setZoom",value:function(e){this._state.setZoom(e)}},{key:"update",value:function(e){this._state.update(e)}},{key:"append",value:function(e){this._state.append(e)}},{key:"prepend",value:function(e){this._state.prepend(e)}},{key:"remove",value:function(e){this._state.remove(e)}},{key:"clear",value:function(){this._state.clear()}},{key:"clearPrior",value:function(){this._state.clearPrior()}},{key:"cut",value:function(){this._state.cut()}},{key:"set",value:function(e){this._state.set(e)}},{key:"setViewMatrix",value:function(e){this._state.setViewMatrix(e)}},{key:"rotate",value:function(e){this._state.rotate(e)}},{key:"rotateUnbounded",value:function(e){this._state.rotateUnbounded(e)}},{key:"rotateWithoutInertia",value:function(e){this._state.rotateWithoutInertia(e)}},{key:"rotateBasic",value:function(e){this._state.rotateBasic(e)}},{key:"rotateBasicUnbounded",value:function(e){this._state.rotateBasicUnbounded(e)}},{key:"rotateBasicWithoutInertia",value:function(e){this._state.rotateBasicWithoutInertia(e)}},{key:"rotateToBasic",value:function(e){this._state.rotateToBasic(e)}},{key:"move",value:function(e){this._state.move(e)}},{key:"moveTo",value:function(e){this._state.moveTo(e)}},{key:"zoomIn",value:function(e,t){this._state.zoomIn(e,t)}},{key:"setSpeed",value:function(e){this._state.setSpeed(e)}},{key:"setTransitionMode",value:function(e){this._state.setTransitionMode(e)}},{key:"dolly",value:function(e){this._state.dolly(e)}},{key:"orbit",value:function(e){this._state.orbit(e)}},{key:"truck",value:function(e){this._state.truck(e)}},{key:"_transition",value:function(e){if(this._transitions.validate(this._state,e)){var t=this._transitions.transition(this._state,e);this._state=t}else{var n=this._transitions.getState(this._state);console.warn("Transition not valid (".concat(XP[n]," - ").concat(XP[e],")"))}}}]),e}(),wz=function(){function e(t,n){var r=this;Bd(this,e),this._appendImage$=new If,this._clock=new eM,this._subscriptions=new xP;var i=this._subscriptions;this._start$=new If,this._frame$=new If,this._contextOperation$=new Of((function(e){return e})),this._context$=this._contextOperation$.pipe(xv((function(e,t){return t(e)}),new xz(t,n)),yv(1),Pf()),this._state$=this._context$.pipe(wp((function(e){return e.state})),sv(),yv(1),Pf()),this._currentState$=this._frame$.pipe(Lv(this._context$,(function(e,t){return[e,t]})),Zp((function(e){return null!=e[1].currentImage})),Av((function(e){e[1].update(r._clock.getDelta())})),wp((function(e){return{fps:60,id:e[0],state:e[1]}})),wv()),this._lastState$=this._currentState$.pipe(yv(1),Pf());var a=this._currentState$.pipe(sv(void 0,(function(e){return e.state.currentImage.id})),yv(1),Pf()),o=new If;i.push(a.subscribe(o)),this._currentId$=new Of(null),i.push(o.pipe(wp((function(e){return e.state.currentImage.id}))).subscribe(this._currentId$)),this._currentImage$=o.pipe(wp((function(e){return e.state.currentImage})),yv(1),Pf()),this._currentCamera$=o.pipe(wp((function(e){return e.state.currentCamera})),yv(1),Pf()),this._currentTransform$=o.pipe(wp((function(e){return e.state.currentTransform})),yv(1),Pf()),this._reference$=o.pipe(wp((function(e){return e.state.reference})),sv((function(e,t){return e.lat===t.lat&&e.lng===t.lng}),(function(e){return{lat:e.lat,lng:e.lng}})),yv(1),Pf()),this._currentImageExternal$=a.pipe(wp((function(e){return e.state.currentImage})),yv(1),Pf()),i.push(this._appendImage$.pipe(wp((function(e){return function(t){return t.append([e]),t}}))).subscribe(this._contextOperation$)),this._inMotionOperation$=new If,i.push(a.pipe(wp((function(){return!0}))).subscribe(this._inMotionOperation$)),i.push(this._inMotionOperation$.pipe(sv(),Zp((function(e){return e})),Tv((function(){return r._currentState$.pipe(Zp((function(e){return 0===e.state.imagesAhead})),wp((function(e){return[e.state.camera.clone(),e.state.zoom]})),gv(),wp((function(e){var t=e[0][0],n=e[1][0],r=e[0][1],i=e[1][1];return t.diff(n)>1e-5||Math.abs(r-i)>1e-5})),fv((function(e){return!e})))}))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(sv(),yv(1),Pf()),this._inTranslationOperation$=new If,i.push(a.pipe(wp((function(){return!0}))).subscribe(this._inTranslationOperation$)),i.push(this._inTranslationOperation$.pipe(sv(),Zp((function(e){return e})),Tv((function(){return r._currentState$.pipe(Zp((function(e){return 0===e.state.imagesAhead})),wp((function(e){return e.state.camera.position.clone()})),gv(),wp((function(e){return 0!==e[0].distanceToSquared(e[1])})),fv((function(e){return!e})))}))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(sv(),yv(1),Pf()),i.push(this._state$.subscribe((function(){}))),i.push(this._currentImage$.subscribe((function(){}))),i.push(this._currentCamera$.subscribe((function(){}))),i.push(this._currentTransform$.subscribe((function(){}))),i.push(this._reference$.subscribe((function(){}))),i.push(this._currentImageExternal$.subscribe((function(){}))),i.push(this._lastState$.subscribe((function(){}))),i.push(this._inMotion$.subscribe((function(){}))),i.push(this._inTranslation$.subscribe((function(){}))),this._frameId=null,this._frameGenerator=new hz(window)}return $d(e,[{key:"currentState$",get:function(){return this._currentState$}},{key:"currentImage$",get:function(){return this._currentImage$}},{key:"currentId$",get:function(){return this._currentId$}},{key:"currentImageExternal$",get:function(){return this._currentImageExternal$}},{key:"currentCamera$",get:function(){return this._currentCamera$}},{key:"currentTransform$",get:function(){return this._currentTransform$}},{key:"state$",get:function(){return this._state$}},{key:"reference$",get:function(){return this._reference$}},{key:"inMotion$",get:function(){return this._inMotion$}},{key:"inTranslation$",get:function(){return this._inTranslation$}},{key:"appendImage$",get:function(){return this._appendImage$}},{key:"dispose",value:function(){this.stop(),this._subscriptions.unsubscribe()}},{key:"custom",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.custom()}))}},{key:"earth",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.earth()}))}},{key:"traverse",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.traverse()}))}},{key:"wait",value:function(){this._invokeContextOperation((function(e){e.wait()}))}},{key:"waitInteractively",value:function(){this._invokeContextOperation((function(e){e.waitInteractively()}))}},{key:"appendImagess",value:function(e){this._invokeContextOperation((function(t){t.append(e)}))}},{key:"prependImages",value:function(e){this._invokeContextOperation((function(t){t.prepend(e)}))}},{key:"removeImages",value:function(e){this._invokeContextOperation((function(t){t.remove(e)}))}},{key:"clearImages",value:function(){this._invokeContextOperation((function(e){e.clear()}))}},{key:"clearPriorImages",value:function(){this._invokeContextOperation((function(e){e.clearPrior()}))}},{key:"cutImages",value:function(){this._invokeContextOperation((function(e){e.cut()}))}},{key:"setImages",value:function(e){this._invokeContextOperation((function(t){t.set(e)}))}},{key:"setViewMatrix",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.setViewMatrix(e)}))}},{key:"rotate",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotate(e)}))}},{key:"rotateUnbounded",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateUnbounded(e)}))}},{key:"rotateWithoutInertia",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateWithoutInertia(e)}))}},{key:"rotateBasic",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateBasic(e)}))}},{key:"rotateBasicUnbounded",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateBasicUnbounded(e)}))}},{key:"rotateBasicWithoutInertia",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateBasicWithoutInertia(e)}))}},{key:"rotateToBasic",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateToBasic(e)}))}},{key:"move",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.move(e)}))}},{key:"moveTo",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.moveTo(e)}))}},{key:"dolly",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.dolly(e)}))}},{key:"orbit",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.orbit(e)}))}},{key:"truck",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.truck(e)}))}},{key:"zoomIn",value:function(e,t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(n){n.zoomIn(e,t)}))}},{key:"getCenter",value:function(){return this._lastState$.pipe(fv(),wp((function(e){return e.state.getCenter()})))}},{key:"getZoom",value:function(){return this._lastState$.pipe(fv(),wp((function(e){return e.state.zoom})))}},{key:"setCenter",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.setCenter(e)}))}},{key:"setSpeed",value:function(e){this._invokeContextOperation((function(t){t.setSpeed(e)}))}},{key:"setTransitionMode",value:function(e){this._invokeContextOperation((function(t){t.setTransitionMode(e)}))}},{key:"setZoom",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.setZoom(e)}))}},{key:"start",value:function(){this._clock.start(),null==this._frameId&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}},{key:"stop",value:function(){this._clock.stop(),null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}},{key:"_invokeContextOperation",value:function(e){this._contextOperation$.next((function(t){return e(t),t}))}},{key:"_frame",value:function(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}]),e}();function kz(e){switch(e){case $D.Custom:return XP.Custom;case $D.Earth:return XP.Earth;case $D.Street:return XP.Traversing;default:return null}}var Sz=function(){function e(t,n,r,i,a,o,s,u){var l;Bd(this,e),n?this._api=n:t.dataProvider?this._api=new lz(t.dataProvider):this._api=new lz(new FD({accessToken:t.accessToken})),this._graphService=null!==r&&void 0!==r?r:new cz(new eC(this.api)),this._loadingName="navigator",this._loadingService=null!==i&&void 0!==i?i:new sz;var c=null!==(l=t.cameraControls)&&void 0!==l?l:$D.Street;this._stateService=null!==a&&void 0!==a?a:new wz(kz(c),t.transitionMode),this._cacheService=null!==o&&void 0!==o?o:new oz(this._graphService,this._stateService,this._api),this._playService=null!==s&&void 0!==s?s:new NA(this._graphService,this._stateService),this._panService=null!==u&&void 0!==u?u:new uz(this._graphService,this._stateService,t.combinedPanning),this._idRequested$=new Of(null),this._movedToId$=new Of(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}return $d(e,[{key:"api",get:function(){return this._api}},{key:"cacheService",get:function(){return this._cacheService}},{key:"graphService",get:function(){return this._graphService}},{key:"loadingService",get:function(){return this._loadingService}},{key:"movedToId$",get:function(){return this._movedToId$}},{key:"panService",get:function(){return this._panService}},{key:"playService",get:function(){return this._playService}},{key:"stateService",get:function(){return this._stateService}},{key:"dispose",value:function(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}},{key:"moveTo$",value:function(e){this._abortRequest("to id ".concat(e)),this._loadingService.startLoading(this._loadingName);var t=this._moveTo$(e);return this._makeRequest$(t)}},{key:"moveDir$",value:function(e){var t=this;this._abortRequest("in dir ".concat(DM[e])),this._loadingService.startLoading(this._loadingName);var n=this.stateService.currentImage$.pipe(fv(),Np((function(t){return([DM.Next,DM.Prev].indexOf(e)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(fv(),wp((function(t){var n,r=Ad(t.edges);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.data.direction===e)return i.target}}catch(CO){r.e(CO)}finally{r.f()}return null})))})),Np((function(n){return null==n?(t._loadingService.stopLoading(t._loadingName),mp(new Error("Direction (".concat(e,") does not exist for current image.")))):t._moveTo$(n)})));return this._makeRequest$(n)}},{key:"setFilter$",value:function(e){var t=this;return this._stateService.clearImages(),this._movedToId$.pipe(fv(),Np((function(n){return null!=n?t._trajectoryIds$().pipe(Np((function(n){return t._graphService.setFilter$(e).pipe(Np((function(){return t._cacheIds$(n)})))})),vv()):t._idRequested$.pipe(fv(),Np((function(n){return null!=n?t._graphService.setFilter$(e).pipe(Np((function(){return t._graphService.cacheImage$(n)}))):t._graphService.setFilter$(e).pipe(wp((function(){})))})))})),wp((function(){})))}},{key:"setAccessToken$",value:function(e){var t=this;return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(fv(),Av((function(){t._api.setAccessToken(e)})),Np((function(e){return null==e?t._graphService.reset$([]):t._trajectoryIds$().pipe(Np((function(e){return t._graphService.reset$(e).pipe(Np((function(){return t._cacheIds$(e)})))})),vv(),wp((function(){})))})))}},{key:"_cacheIds$",value:function(e){var t=this,n=e.map((function(e){return t._graphService.cacheImage$(e)}));return ap(n).pipe(Dp())}},{key:"_abortRequest",value:function(e){null!=this._requestSubscription&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),null!=this._imageRequestSubscription&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),null!=this._request$&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new PP("Request aborted by a subsequent request ".concat(e,"."))),this._request$=null)}},{key:"_makeRequest$",value:function(e){var t=this,n=new Df(1);return this._requestSubscription=n.subscribe(void 0,(function(){})),this._request$=n,this._imageRequestSubscription=e.subscribe((function(e){t._request$=null,n.next(e),n.complete()}),(function(e){t._request$=null,n.error(e)})),n}},{key:"_moveTo$",value:function(e){var t=this;return this._idRequested$.next(e),this._graphService.cacheImage$(e).pipe(Av((function(e){t._stateService.setImages([e]),t._movedToId$.next(e.id)})),dv((function(){t._loadingService.stopLoading(t._loadingName)})))}},{key:"_trajectoryIds$",value:function(){return this._stateService.currentState$.pipe(fv(),wp((function(e){return e.state.trajectory.map((function(e){return e.id}))})))}}]),e}(),Mz=function(){function e(t,n){Bd(this,e),this._spatial=null!==n&&void 0!==n?n:new WM,this._viewportCoords=null!==t&&void 0!==t?t:new CP}return $d(e,[{key:"basicToCanvas",value:function(e,t,n,r){return this._viewportCoords.basicToCanvasSafe(e[0],e[1],t,r,n.perspective)}},{key:"canvasToBasic",value:function(e,t,n,r){var i=this._viewportCoords.canvasToBasic(e[0],e[1],t,r,n.perspective);return(i[0]<0||i[0]>1||i[1]<0||i[1]>1)&&(i=null),i}},{key:"eventToUnprojection",value:function(e,t,n,r,i){var a=this._viewportCoords.canvasPosition(e,t);return this.canvasToUnprojection(a,t,n,r,i)}},{key:"canvasToUnprojection",value:function(e,t,n,r,i){var a=e[0],s=e[1],u=o(this._viewportCoords.canvasToViewport(a,s,t),2),l=u[0],c=u[1],h=new Vm(l,c,1).unproject(n.perspective),d=i.projectBasic(h.toArray());(d[0]<0||d[0]>1||d[1]<0||d[1]>1)&&(d=null);var f=h.clone().sub(n.camera.position).normalize(),p=-2/f.z,v=null;if(p>0&&p<100&&d){var m=f.clone().multiplyScalar(p).add(n.camera.position),g=o(OM(m.x,m.y,m.z,r.lng,r.lat,r.alt),2),_=g[0];v={lat:g[1],lng:_}}return{basicPoint:d,lngLat:v,pixelPoint:[a,s]}}},{key:"cameraToLngLat",value:function(e,t){var n=e.camera.position,r=o(OM(n.x,n.y,n.z,t.lng,t.lat,t.alt),2),i=r[0];return{lat:r[1],lng:i}}},{key:"lngLatToCanvas",value:function(e,t,n,r){var i=RM(e.lng,e.lat,0,r.lng,r.lat,r.alt);return this._viewportCoords.projectToCanvasSafe(i,t,n.perspective)}},{key:"distanceBetweenLngLats",value:function(e,t){return this._spatial.distanceFromLngLat(e.lng,e.lat,t.lng,t.lat)}}]),e}(),Cz=function(){function e(t,n,r){var i=this;Bd(this,e),this._subscriptions=new xP,this._emitSubscriptions=new xP,this._container=r,this._viewer=t,this._navigator=n,this._projection=new Mz,this._started=!1,this._navigable$=new If;var a=this._subscriptions;a.push(this._navigable$.subscribe((function(e){var t="navigable",n={navigable:e,target:i._viewer,type:t};i._viewer.fire(t,n)}))),a.push(this._navigator.loadingService.loading$.subscribe((function(e){var t="dataloading",n={loading:e,target:i._viewer,type:t};i._viewer.fire(t,n)}))),a.push(this._container.glRenderer.opaqueRender$.pipe(fv()).subscribe((function(){var e="load",t={target:i._viewer,type:e};i._viewer.fire(e,t)})))}return $d(e,[{key:"started",get:function(){return this._started}},{key:"navigable$",get:function(){return this._navigable$}},{key:"projection",get:function(){return this._projection}},{key:"dispose",value:function(){this.stopEmit(),this._subscriptions.unsubscribe()}},{key:"project$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(fv(),wp((function(n){var r=o(n,3),i=r[0],a=r[1],s=r[2];if(t._projection.distanceBetweenLngLats(e,a.lngLat)>1e3)return null;var u=t._projection.lngLatToCanvas(e,t._container.container,i,s);return u?[Math.round(u[0]),Math.round(u[1])]:null})))}},{key:"projectBasic$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(fv(),wp((function(n){var r=o(n,2),i=r[0],a=r[1],s=t._projection.basicToCanvas(e,t._container.container,i,a);return s?[Math.round(s[0]),Math.round(s[1])]:null})))}},{key:"startEmit",value:function(){var e=this;if(!this._started){this._started=!0;var t=this._emitSubscriptions;t.push(this._navigator.stateService.currentImageExternal$.subscribe((function(t){var n="image",r={image:t,target:e._viewer,type:n};e._viewer.fire(n,r)}))),t.push(this._navigator.stateService.currentImageExternal$.pipe(Tv((function(e){return e.sequenceEdges$}))).subscribe((function(t){var n="sequenceedges",r={status:t,target:e._viewer,type:n};e._viewer.fire(n,r)}))),t.push(this._navigator.stateService.currentImageExternal$.pipe(Tv((function(e){return e.spatialEdges$}))).subscribe((function(t){var n="spatialedges",r={status:t,target:e._viewer,type:n};e._viewer.fire(n,r)}))),t.push(this._navigator.stateService.reference$.subscribe((function(t){var n="reference",r={reference:t,target:e._viewer,type:n};e._viewer.fire(n,r)}))),t.push(Lp(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(wp((function(e){return e[0]||e[1]||e[2]})),sv()).subscribe((function(t){var n=t?"movestart":"moveend",r={target:e._viewer,type:n};e._viewer.fire(n,r)}))),t.push(this._container.renderService.bearing$.pipe(Xp(100),sv((function(e,t){return Math.abs(t-e)<1}))).subscribe((function(t){var n="bearing",r={bearing:t,target:e._viewer,type:n};e._viewer.fire(n,r)})));var n=this._container.mouseService.active$.pipe(Tv((function(t){return t?Hf():e._container.mouseService.mouseMove$})));t.push(Hp(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",n),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),wp((function(t){var n=o(t,5),r=o(n[0],2),i=r[0],a=r[1],s=n[1],u=n[2],l=n[3],c=n[4],h=e._projection.eventToUnprojection(a,e._container.container,s,u,l);return{basicPoint:c===XP.Traversing?h.basicPoint:null,lngLat:h.lngLat,originalEvent:a,pixelPoint:h.pixelPoint,target:e._viewer,type:i}}))).subscribe((function(t){e._viewer.fire(t.type,t)}))),t.push(this._container.renderService.renderCamera$.pipe(sv((function(t,n){var r=o(t,2),i=r[0],a=r[1],s=o(n,2),u=s[0],l=s[1];return e._closeTo(i,u,.01)&&e._closeTo(a,l,.01)}),(function(e){return e.camera.position.toArray()}))).subscribe((function(){var t="position",n={target:e._viewer,type:t};e._viewer.fire(t,n)}))),t.push(this._container.renderService.renderCamera$.pipe(sv((function(t,n){var r=o(t,2),i=r[0],a=r[1],s=o(n,2),u=s[0],l=s[1];return e._closeTo(i,u,.001)&&e._closeTo(a,l,.001)}),(function(e){return[e.rotation.phi,e.rotation.theta]}))).subscribe((function(){var t={target:e._viewer,type:"pov"};e._viewer.fire("pov",t)}))),t.push(this._container.renderService.renderCamera$.pipe(sv((function(t,n){return e._closeTo(t,n,.01)}),(function(e){return e.perspective.fov}))).subscribe((function(){var t={target:e._viewer,type:"fov"};e._viewer.fire("fov",t)})))}}},{key:"stopEmit",value:function(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}},{key:"unproject$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(fv(),wp((function(n){var r=o(n,3),i=r[0],a=r[1],s=r[2];return t._projection.canvasToUnprojection(e,t._container.container,i,a,s).lngLat})))}},{key:"unprojectBasic$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(fv(),wp((function(n){var r=o(n,2),i=r[0],a=r[1];return t._projection.canvasToBasic(e,t._container.container,i,a)})))}},{key:"_closeTo",value:function(e,t,n){return Math.abs(e-t)<=n}},{key:"_mapMouseEvent$",value:function(e,t){return t.pipe(wp((function(t){return[e,t]})))}}]),e}(),Tz=function(){function e(t,n){Bd(this,e),this._container=t,this._navigator=n,this._renderers={}}return $d(e,[{key:"add",value:function(e,t){var n=new xP;this._renderers[e.id]={subs:n,renderer:e},n.push(Lp([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe(ov(1)).subscribe((function(n){var r=o(n,2),i=r[0],a=r[1];e.onAdd(t,a,i.getContext())}))),n.push(this._container.glRenderer.opaqueRender$.pipe(Lv(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe((function(t){var n=o(t,3),r=n[1],i=n[2].getContext(),a=r.perspective.matrixWorldInverse,s=r.perspective.projectionMatrix;e.render(i,a.toArray(),s.toArray())}))),n.push(this._navigator.stateService.reference$.pipe(Sv(1)).subscribe((function(n){e.onReference(t,n)})))}},{key:"dispose",value:function(e){for(var t=0,n=Object.keys(this._renderers);t<n.length;t++){var r=n[t];this.remove(r,e)}}},{key:"has",value:function(e){return e in this._renderers}},{key:"remove",value:function(e,t){this._renderers[e].subs.unsubscribe();var n=this._renderers[e].renderer;delete this._renderers[e],this._container.glRenderer.webGLRenderer$.subscribe((function(e){n.onRemove(t,e.getContext())}))}}]),e}(),Ez=function(){function e(t,n){Bd(this,e),this._container=t,this._navigator=n,this._controls=null,this._subscriptions=new xP}return $d(e,[{key:"attach",value:function(e,t){var n=this;if(this._controls)throw new VM("Custom camera controls already attached");this._controls=e;var r=new If,i=r.pipe(Tv((function(){return n._navigator.stateService.state$})),wp((function(e){return e===XP.Custom})),sv()),a=this._subscriptions;a.push(i.pipe(Cv(!1),gv(),Lv(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe((function(n){var r=o(n,3),i=o(r[0],2),a=i[0],s=i[1],u=r[1],l=r[2];s?e.onActivate(t,l.perspective.matrixWorldInverse.toArray(),l.perspective.projectionMatrix.toArray(),u):a&&e.onDeactivate(t)}))),a.push(i.pipe(Tv((function(e){return e?n._navigator.stateService.currentState$.pipe(Sv(1)):Hf()}))).subscribe((function(n){e.onAnimationFrame(t,n.id)}))),a.push(i.pipe(Tv((function(e){return e?n._navigator.stateService.reference$.pipe(Sv(1)):Hf()}))).subscribe((function(n){return e.onReference(t,n)}))),a.push(i.pipe(Tv((function(e){return e?n._container.renderService.size$.pipe(Sv(1)):Hf()}))).subscribe((function(){return e.onResize(t)}))),a.push(Lp([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(fv()).subscribe((function(){e.onAttach(t,(function(t){n._controls&&e===n._controls&&n._updateViewMatrix(t)}),(function(t){n._controls&&e===n._controls&&n._updateProjectionMatrix(t)})),r.next(),r.complete()})))}},{key:"detach",value:function(e){var t=this,n=this._controls;return this._controls=null,this._subscriptions.unsubscribe(),new Promise((function(r){t._navigator.stateService.state$.pipe(ov(1)).subscribe((function(t){n?(t===XP.Custom&&n.onDeactivate(e),n.onDetach(e),r(n)):r(null)}))}))}},{key:"dispose",value:function(e){this.detach(e)}},{key:"has",value:function(e){return!!this._controls&&e===this._controls}},{key:"_updateProjectionMatrix",value:function(e){var t=this;this._navigator.stateService.state$.pipe(fv()).subscribe((function(n){if(n===XP.Custom)t._container.renderService.projectionMatrix$.next(e);else{console.warn("Incorrect camera control mode for projection matrix update")}}))}},{key:"_updateViewMatrix",value:function(e){var t=this;this._navigator.stateService.state$.pipe(fv()).subscribe((function(n){if(n===XP.Custom)t._navigator.stateService.setViewMatrix(e);else{console.warn("Incorrect camera control mode for view matrix update")}}))}}]),e}(),Pz=function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this))._navigator=new Sz(e),r._container=new az(e,r._navigator.stateService),r._observer=new Cz(Id(r),r._navigator,r._container),r._componentController=new WD(r._container,r._navigator,r._observer,e.imageId,e.component),r._customRenderer=new Tz(r._container,r._navigator),r._customCameraControls=new Ez(r._container,r._navigator),r}return $d(n,[{key:"dataProvider",get:function(){return this._navigator.api.data}},{key:"isNavigable",get:function(){return this._componentController.navigable}},{key:"activateCombinedPanning",value:function(){this._navigator.panService.enable()}},{key:"activateComponent",value:function(e){this._componentController.activate(e)}},{key:"activateCover",value:function(){this._componentController.activateCover()}},{key:"addCustomRenderer",value:function(e){this._customRenderer.add(e,this)}},{key:"attachCustomCameraControls",value:function(e){this._customCameraControls.attach(e,this)}},{key:"deactivateCombinedPanning",value:function(){this._navigator.panService.disable()}},{key:"deactivateComponent",value:function(e){this._componentController.deactivate(e)}},{key:"deactivateCover",value:function(){this._componentController.deactivateCover()}},{key:"detachCustomCameraControls",value:function(){return this._customCameraControls.detach(this)}},{key:"fire",value:function(e,t){Nd(wd(n.prototype),"fire",this).call(this,e,t)}},{key:"getBearing",value:function(){var e=this;return new Promise((function(t,n){e._container.renderService.bearing$.pipe(fv()).subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getCameraControls",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.state$.pipe(fv()).subscribe((function(e){switch(e){case XP.Custom:t($D.Custom);break;case XP.Earth:t($D.Earth);break;default:t($D.Street)}}),(function(e){n(e)}))}))}},{key:"getCanvas",value:function(){return this._container.canvas}},{key:"getCanvasContainer",value:function(){return this._container.canvasContainer}},{key:"getCenter",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.getCenter().subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getComponent",value:function(e){return this._componentController.get(e)}},{key:"getContainer",value:function(){return this._container.container}},{key:"getFieldOfView",value:function(){var e=this;return new Promise((function(t,n){e._container.renderService.renderCamera$.pipe(fv()).subscribe((function(e){t(e.perspective.fov)}),(function(e){n(e)}))}))}},{key:"getImage",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.currentImage$.pipe(fv()).subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getPointOfView",value:function(){var e=this;return new Promise((function(t,n){Lp(e._container.renderService.renderCamera$,e._container.renderService.bearing$).pipe(fv()).subscribe((function(e){var n=o(e,2),r=n[0],i=n[1];t({bearing:i,tilt:r.getTilt()})}),(function(e){n(e)}))}))}},{key:"getPosition",value:function(){var e=this;return new Promise((function(t,n){Lp(e._container.renderService.renderCamera$,e._navigator.stateService.reference$).pipe(fv()).subscribe((function(n){var r=o(n,2),i=r[0],a=r[1];t(e._observer.projection.cameraToLngLat(i,a))}),(function(e){n(e)}))}))}},{key:"getReference",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.reference$.pipe(fv()).subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getZoom",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.getZoom().subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"hasCustomCameraControls",value:function(e){return this._customCameraControls.has(e)}},{key:"hasCustomRenderer",value:function(e){return this._customRenderer.has(e)}},{key:"moveDir",value:function(e){var t=this.isNavigable?this._navigator.moveDir$(e):mp(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise((function(e,n){t.subscribe((function(t){e(t)}),(function(e){n(e)}))}))}},{key:"moveTo",value:function(e){var t=this.isNavigable?this._navigator.moveTo$(e):mp(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise((function(e,n){t.subscribe((function(t){e(t)}),(function(e){n(e)}))}))}},{key:"off",value:function(e,t){Nd(wd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(wd(n.prototype),"on",this).call(this,e,t)}},{key:"project",value:function(e){var t=this;return new Promise((function(n,r){t._observer.project$(e).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"projectFromBasic",value:function(e){var t=this;return new Promise((function(n,r){t._observer.projectBasic$(e).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"remove",value:function(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();var e="remove",t={target:this,type:e};this.fire(e,t)}},{key:"removeCustomRenderer",value:function(e){this._customRenderer.remove(e,this)}},{key:"resize",value:function(){this._container.renderService.resize$.next()}},{key:"setCameraControls",value:function(e){var t=kz(e);t===XP.Traversing?this._navigator.stateService.traverse():t===XP.Earth?this._navigator.stateService.earth():t===XP.Custom?this._navigator.stateService.custom():console.warn("Unsupported camera control transition (".concat(e,")"))}},{key:"setCenter",value:function(e){this._navigator.stateService.setCenter(e)}},{key:"setFieldOfView",value:function(e){var t=this;this._container.renderService.renderCamera$.pipe(fv()).subscribe((function(n){var r=n.fovToZoom(e);t._navigator.stateService.setZoom(r)}))}},{key:"setFilter",value:function(e){var t=this;return new Promise((function(n,r){t._navigator.setFilter$(e).subscribe((function(){n(void 0)}),(function(e){r(e)}))}))}},{key:"setRenderMode",value:function(e){this._container.renderService.renderMode$.next(e)}},{key:"setTransitionMode",value:function(e){this._navigator.stateService.setTransitionMode(e)}},{key:"setAccessToken",value:function(e){var t=this.isNavigable?this._navigator.setAccessToken$(e):mp(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise((function(e,n){t.subscribe((function(){e(void 0)}),(function(e){n(e)}))}))}},{key:"setZoom",value:function(e){this._navigator.stateService.setZoom(e)}},{key:"triggerRerender",value:function(){this._container.glRenderer.triggerRerender()}},{key:"unproject",value:function(e){var t=this;return new Promise((function(n,r){t._observer.unproject$(e).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}},{key:"unprojectToBasic",value:function(e){var t=this;return new Promise((function(n,r){t._observer.unprojectBasic$(e).subscribe((function(e){n(e)}),(function(e){r(e)}))}))}}]),n}(bP);eC.register(bC),tC.register(bC),xC.registerCover(kP),xC.register(SP),xC.register(TP),xC.register(EP),xC.register(IP),xC.register(JP),xC.register(iA),xC.register(oA),xC.register(xA),xC.register(MA),xC.register(EA),xC.register(IA),xC.register(nL),xC.register(aR),xC.register(oR),xC.register(sR),xC.register(uR);var Az=function(e){Dd(r,e);var n=zd(r);function r(e){var i;return Bd(this,r),(i=n.call(this,e)).containerRef=t.createRef(),i}return $d(r,[{key:"componentDidMount",value:function(){this.viewer=new Pz({accessToken:this.props.accessToken,container:this.containerRef.current,imageId:this.props.imageId})}},{key:"componentWillUnmount",value:function(){this.viewer&&this.viewer.remove()}},{key:"render",value:function(){return(0,se.jsx)("div",{ref:this.containerRef,style:this.props.style})}}]),r}(t.Component),Lz=(t.Component,t.Component,function(e){Dd(n,e);var t=zd(n);function n(e){var r;return Bd(this,n),(r=t.call(this,e)).state={index:0,test:["145728107523175","179011504107194","259103735961077"]},r.handleClick=r.handleClick.bind(Id(r)),r}return $d(n,[{key:"handleClick",value:function(){this.setState({index:0})}},{key:"handleClick1",value:function(){this.setState({index:1})}},{key:"handleClick2",value:function(){this.setState({index:2})}},{key:"handleClick3",value:function(){this.setState({index:3})}},{key:"render",value:function(){var e=this;return(0,se.jsxs)("div",{children:[(0,se.jsx)("button",{onClick:function(){return e.handleClick()},children:"Get Next Street View"}),(0,se.jsx)("button",{onClick:function(){return e.handleClick1()},children:"Click me: UCLA Royce Hall"}),(0,se.jsx)("button",{onClick:function(){return e.handleClick2()},children:"Click me: Sepulved Boulevard"}),(0,se.jsx)("button",{onClick:function(){return e.handleClick3()},children:"Click me: Forest Lawn Dr"}),(0,se.jsx)("br",{}),"Let the buttons be coordinates on the map",this.state.test.slice(this.state.index-1,this.state.index).map((function(e){return(0,se.jsx)(Az,{accessToken:"MLY|5601141439945634|a93d0122bc05efd58fbd9c081cf82b8f",imageId:e,style:{width:"90%",height:"400px"}})}))]})}}]),n}(t.Component)),Iz=Lz;var Rz=function(){return(0,se.jsxs)("div",{className:"application",children:[(0,se.jsx)("div",{className:"intro",children:(0,se.jsx)("h1",{children:"Hillside Street Prioritization Application"})}),(0,se.jsx)("div",{className:"charts",children:(0,se.jsx)("div",{className:"chart",children:(0,se.jsx)(ad,{})})}),(0,se.jsxs)("div",{className:"map",children:[(0,se.jsx)("div",{id:"leafletTooltip"}),(0,se.jsx)(bd,{}),(0,se.jsx)(Iz,{})]})]})};var Oz=function(){return(0,se.jsxs)("div",{className:"footerContainer",children:[(0,se.jsxs)("div",{className:"footerInfo",children:[(0,se.jsxs)("div",{className:"InfoItem",children:[(0,se.jsx)("h1",{children:"Engineer Change."}),(0,se.jsx)("p",{children:"UCLA Samueli School of Engineering Department of Civil and Environmental Engineering Los Angeles, CA 90095"})]}),(0,se.jsxs)("div",{className:"InfoItem",children:[(0,se.jsx)("h1",{children:" Contact "}),(0,se.jsxs)("p",{children:["Sriram Narasimhan ",(0,se.jsx)("br",{}),"Email: snarasim@ucla.edu"]})]})]}),(0,se.jsx)("div",{className:"footerBar",children:(0,se.jsx)("div",{className:"website-rights",children:"\xa9 2022 SRI Lab"})})]})};var Nz=function(){return(0,se.jsx)(se.Fragment,{children:(0,se.jsxs)(Z,{basename:"/LAStreet",children:[(0,se.jsx)(he,{}),(0,se.jsxs)(q,{children:[(0,se.jsx)(F,{exact:!0,path:"/",element:(0,se.jsx)(ve,{})}),(0,se.jsx)(F,{path:"/application",element:(0,se.jsx)(Rz,{})})]}),(0,se.jsx)(Oz,{})]})})};r.createRoot(document.getElementById("root")).render((0,se.jsx)(Nz,{}))}()}();
//# sourceMappingURL=main.f3ae2025.js.map