/*! For license information please see main.fba6cb83.js.LICENSE.txt */
!function(){var e={559:function(e,t){!function(e){"use strict";var t="1.8.0";function n(e){var t,n,i,r;for(n=1,i=arguments.length;n<i;n++)for(t in r=arguments[n])e[t]=r[t];return e}var i=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function r(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var i=n.call(arguments,2);return function(){return e.apply(t,i.length?i.concat(n.call(arguments)):arguments)}}var a=0;function o(e){return"_leaflet_id"in e||(e._leaflet_id=++a),e._leaflet_id}function s(e,t,n){var i,r,a,o;return o=function(){i=!1,r&&(a.apply(n,r),r=!1)},a=function(){i?r=arguments:(e.apply(n,arguments),setTimeout(o,t),i=!0)},a}function u(e,t,n){var i=t[1],r=t[0],a=i-r;return e===i&&n?e:((e-r)%a+a)%a+r}function l(){return!1}function c(e,t){if(!1===t)return e;var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function h(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function d(e){return h(e).split(/\s+/)}function f(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?i(e.options):{}),t)e.options[n]=t[n];return e.options}function p(e,t,n){var i=[];for(var r in e)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(e[r]));return(t&&-1!==t.indexOf("?")?"&":"?")+i.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function m(e,t){return e.replace(v,(function(e,n){var i=t[n];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"===typeof i&&(i=i(t)),i}))}var g=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function _(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var x=0;function w(e){var t=+new Date,n=Math.max(0,16-(t-x));return x=t+n,window.setTimeout(e,n)}var k=window.requestAnimationFrame||b("RequestAnimationFrame")||w,S=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function M(e,t,n){if(!n||k!==w)return k.call(window,r(e,t));e.call(t)}function T(e){e&&S.call(window,e)}var C={__proto__:null,extend:n,create:i,bind:r,get lastId(){return a},stamp:o,throttle:s,wrapNum:u,falseFn:l,formatNum:c,trim:h,splitWords:d,setOptions:f,getParamString:p,template:m,isArray:g,indexOf:_,emptyImageUrl:y,requestFn:k,cancelFn:S,requestAnimFrame:M,cancelAnimFrame:T};function E(){}function P(e){if("undefined"!==typeof L&&L&&L.Mixin){e=g(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}E.extend=function(e){var t=function(){f(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=t.__super__=this.prototype,a=i(r);for(var o in a.constructor=t,t.prototype=a,this)Object.prototype.hasOwnProperty.call(this,o)&&"prototype"!==o&&"__super__"!==o&&(t[o]=this[o]);return e.statics&&n(t,e.statics),e.includes&&(P(e.includes),n.apply(null,[a].concat(e.includes))),n(a,e),delete a.statics,delete a.includes,a.options&&(a.options=r.options?i(r.options):{},n(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=a._initHooks.length;e<t;e++)a._initHooks[e].call(this)}},t},E.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},E.mergeOptions=function(e){return n(this.prototype.options,e),this},E.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var A={on:function(e,t,n){if("object"===typeof e)for(var i in e)this._on(i,e[i],t);else for(var r=0,a=(e=d(e)).length;r<a;r++)this._on(e[r],t,n);return this},off:function(e,t,n){if(arguments.length)if("object"===typeof e)for(var i in e)this._off(i,e[i],t);else{e=d(e);for(var r=1===arguments.length,a=0,o=e.length;a<o;a++)r?this._off(e[a]):this._off(e[a],t,n)}else delete this._events;return this},_on:function(e,t,n){if("function"===typeof t){this._events=this._events||{};var i=this._events[e];i||(i=[],this._events[e]=i),n===this&&(n=void 0);for(var r={fn:t,ctx:n},a=i,o=0,s=a.length;o<s;o++)if(a[o].fn===t&&a[o].ctx===n)return;a.push(r)}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,n){var i,r,a;if(this._events&&(i=this._events[e]))if(1!==arguments.length)if(n===this&&(n=void 0),"function"===typeof t){for(r=0,a=i.length;r<a;r++){var o=i[r];if(o.ctx===n&&o.fn===t)return this._firingCount&&(o.fn=l,this._events[e]=i=i.slice()),void i.splice(r,1)}console.warn("listener not found")}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(r=0,a=i.length;r<a;r++)i[r].fn=l;delete this._events[e]}},fire:function(e,t,i){if(!this.listens(e,i))return this;var r=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var a=this._events[e];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var u=a[o];u.fn.call(u.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(e,t){"string"!==typeof e&&console.warn('"string" type argument expected');var n=this._events&&this._events[e];if(n&&n.length)return!0;if(t)for(var i in this._eventParents)if(this._eventParents[i].listens(e,t))return!0;return!1},once:function(e,t,n){if("object"===typeof e){for(var i in e)this.once(i,e[i],t);return this}var a=r((function(){this.off(e,t,n).off(e,a,n)}),this);return this.on(e,t,n).on(e,a,n)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[o(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[o(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};A.addEventListener=A.on,A.removeEventListener=A.clearAllEventListeners=A.off,A.addOneTimeEventListener=A.once,A.fireEvent=A.fire,A.hasEventListeners=A.listens;var I=E.extend(A);function R(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var N=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function D(e,t,n){return e instanceof R?e:g(e)?new R(e[0],e[1]):void 0===e||null===e?e:"object"===typeof e&&"x"in e&&"y"in e?new R(e.x,e.y):new R(e,t,n)}function O(e,t){if(e)for(var n=t?[e,t]:e,i=0,r=n.length;i<r;i++)this.extend(n[i])}function z(e,t){return!e||e instanceof O?e:new O(e,t)}function F(e,t){if(e)for(var n=t?[e,t]:e,i=0,r=n.length;i<r;i++)this.extend(n[i])}function B(e,t){return e instanceof F?e:new F(e,t)}function $(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function j(e,t,n){return e instanceof $?e:g(e)&&"object"!==typeof e[0]?3===e.length?new $(e[0],e[1],e[2]):2===e.length?new $(e[0],e[1]):null:void 0===e||null===e?e:"object"===typeof e&&"lat"in e?new $(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new $(e,t,n)}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(e){return this.clone()._add(D(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(D(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new R(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new R(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=N(this.x),this.y=N(this.y),this},distanceTo:function(e){var t=(e=D(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=D(e)).x===this.x&&e.y===this.y},contains:function(e){return e=D(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+c(this.x)+", "+c(this.y)+")"}},O.prototype={extend:function(e){return e=D(e),this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},getCenter:function(e){return new R((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new R(this.min.x,this.max.y)},getTopRight:function(){return new R(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"===typeof e[0]||e instanceof R?D(e):z(e))instanceof O?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=z(e);var t=this.min,n=this.max,i=e.min,r=e.max,a=r.x>=t.x&&i.x<=n.x,o=r.y>=t.y&&i.y<=n.y;return a&&o},overlaps:function(e){e=z(e);var t=this.min,n=this.max,i=e.min,r=e.max,a=r.x>t.x&&i.x<n.x,o=r.y>t.y&&i.y<n.y;return a&&o},isValid:function(){return!(!this.min||!this.max)}},F.prototype={extend:function(e){var t,n,i=this._southWest,r=this._northEast;if(e instanceof $)t=e,n=e;else{if(!(e instanceof F))return e?this.extend(j(e)||B(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return i||r?(i.lat=Math.min(t.lat,i.lat),i.lng=Math.min(t.lng,i.lng),r.lat=Math.max(n.lat,r.lat),r.lng=Math.max(n.lng,r.lng)):(this._southWest=new $(t.lat,t.lng),this._northEast=new $(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,i=Math.abs(t.lat-n.lat)*e,r=Math.abs(t.lng-n.lng)*e;return new F(new $(t.lat-i,t.lng-r),new $(n.lat+i,n.lng+r))},getCenter:function(){return new $((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new $(this.getNorth(),this.getWest())},getSouthEast:function(){return new $(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"===typeof e[0]||e instanceof $||"lat"in e?j(e):B(e);var t,n,i=this._southWest,r=this._northEast;return e instanceof F?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=i.lat&&n.lat<=r.lat&&t.lng>=i.lng&&n.lng<=r.lng},intersects:function(e){e=B(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),r=e.getNorthEast(),a=r.lat>=t.lat&&i.lat<=n.lat,o=r.lng>=t.lng&&i.lng<=n.lng;return a&&o},overlaps:function(e){e=B(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),r=e.getNorthEast(),a=r.lat>t.lat&&i.lat<n.lat,o=r.lng>t.lng&&i.lng<n.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=B(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},$.prototype={equals:function(e,t){return!!e&&(e=j(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+c(this.lat,e)+", "+c(this.lng,e)+")"},distanceTo:function(e){return V.distance(this,j(e))},wrap:function(){return V.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return B([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new $(this.lat,this.lng,this.alt)}};var U={latLngToPoint:function(e,t){var n=this.projection.project(e),i=this.scale(t);return this.transformation._transform(n,i)},pointToLatLng:function(e,t){var n=this.scale(t),i=this.transformation.untransform(e,n);return this.projection.unproject(i)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new O(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?u(e.lng,this.wrapLng,!0):e.lng;return new $(this.wrapLat?u(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),i=t.lat-n.lat,r=t.lng-n.lng;if(0===i&&0===r)return e;var a=e.getSouthWest(),o=e.getNorthEast();return new F(new $(a.lat-i,a.lng-r),new $(o.lat-i,o.lng-r))}},V=n({},U,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,i=e.lat*n,r=t.lat*n,a=Math.sin((t.lat-e.lat)*n/2),o=Math.sin((t.lng-e.lng)*n/2),s=a*a+Math.cos(i)*Math.cos(r)*o*o,u=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*u}}),H=6378137,W={R:H,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,e.lat),-n),r=Math.sin(i*t);return new R(this.R*e.lng*t,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(e){var t=180/Math.PI;return new $((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=H*Math.PI;return new O([-e,-e],[e,e])}()};function G(e,t,n,i){if(g(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=i}function q(e,t,n,i){return new G(e,t,n,i)}G.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new R((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var Z=n({},V,{code:"EPSG:3857",projection:W,transformation:function(){var e=.5/(Math.PI*W.R);return q(e,.5,-e,.5)}()}),X=n({},Z,{code:"EPSG:900913"});function Y(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function K(e,t){var n,i,r,a,o,s,u="";for(n=0,r=e.length;n<r;n++){for(i=0,a=(o=e[n]).length;i<a;i++)u+=(i?"L":"M")+(s=o[i]).x+" "+s.y;u+=t?Ne.svg?"z":"x":""}return u||"M0 0"}var J=document.documentElement.style,Q="ActiveXObject"in window,ee=Q&&!document.addEventListener,te="msLaunchUri"in navigator&&!("documentMode"in document),ne=Re("webkit"),ie=Re("android"),re=Re("android 2")||Re("android 3"),ae=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),oe=ie&&Re("Google")&&ae<537&&!("AudioNode"in window),se=!!window.opera,ue=!te&&Re("chrome"),le=Re("gecko")&&!ne&&!se&&!Q,ce=!ue&&Re("safari"),he=Re("phantom"),de="OTransition"in J,fe=0===navigator.platform.indexOf("Win"),pe=Q&&"transition"in J,ve="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!re,me="MozPerspective"in J,ge=!window.L_DISABLE_3D&&(pe||ve||me)&&!de&&!he,_e="undefined"!==typeof orientation||Re("mobile"),ye=_e&&ne,be=_e&&ve,xe=!window.PointerEvent&&window.MSPointerEvent,we=!(!window.PointerEvent&&!xe),ke="ontouchstart"in window||!!window.TouchEvent,Se=!window.L_NO_TOUCH&&(ke||we),Me=_e&&se,Te=_e&&le,Ce=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ee=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",l,t),window.removeEventListener("testPassiveEventSupport",l,t)}catch(n){}return e}(),Pe=!!document.createElement("canvas").getContext,Le=!(!document.createElementNS||!Y("svg").createSVGRect),Ae=!!Le&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(e.firstChild&&e.firstChild.namespaceURI)}(),Ie=!Le&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(n){return!1}}();function Re(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Ne={ie:Q,ielt9:ee,edge:te,webkit:ne,android:ie,android23:re,androidStock:oe,opera:se,chrome:ue,gecko:le,safari:ce,phantom:he,opera12:de,win:fe,ie3d:pe,webkit3d:ve,gecko3d:me,any3d:ge,mobile:_e,mobileWebkit:ye,mobileWebkit3d:be,msPointer:xe,pointer:we,touch:Se,touchNative:ke,mobileOpera:Me,mobileGecko:Te,retina:Ce,passiveEvents:Ee,canvas:Pe,svg:Le,vml:Ie,inlineSvg:Ae},De=Ne.msPointer?"MSPointerDown":"pointerdown",Oe=Ne.msPointer?"MSPointerMove":"pointermove",ze=Ne.msPointer?"MSPointerUp":"pointerup",Fe=Ne.msPointer?"MSPointerCancel":"pointercancel",Be={touchstart:De,touchmove:Oe,touchend:ze,touchcancel:Fe},$e={touchstart:Ye,touchmove:Xe,touchend:Xe,touchcancel:Xe},je={},Ue=!1;function Ve(e,t,n){return"touchstart"===t&&Ze(),$e[t]?(n=$e[t].bind(this,n),e.addEventListener(Be[t],n,!1),n):(console.warn("wrong event specified:",t),L.Util.falseFn)}function He(e,t,n){Be[t]?e.removeEventListener(Be[t],n,!1):console.warn("wrong event specified:",t)}function We(e){je[e.pointerId]=e}function Ge(e){je[e.pointerId]&&(je[e.pointerId]=e)}function qe(e){delete je[e.pointerId]}function Ze(){Ue||(document.addEventListener(De,We,!0),document.addEventListener(Oe,Ge,!0),document.addEventListener(ze,qe,!0),document.addEventListener(Fe,qe,!0),Ue=!0)}function Xe(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in t.touches=[],je)t.touches.push(je[n]);t.changedTouches=[t],e(t)}}function Ye(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Wt(t),Xe(e,t)}function Ke(e){var t,n,i={};for(n in e)t=e[n],i[n]=t&&t.bind?t.bind(e):t;return e=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var Je=200;function Qe(e,t){e.addEventListener("dblclick",t);var n,i=0;function r(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var r=Date.now();r-i<=Je?2===++n&&t(Ke(e)):n=1,i=r}}else n=e.detail}return e.addEventListener("click",r),{dblclick:t,simDblclick:r}}function et(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var tt,nt,it,rt,at,ot=kt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),st=kt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ut="webkitTransition"===st||"OTransition"===st?st+"End":"transitionend";function lt(e){return"string"===typeof e?document.getElementById(e):e}function ct(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(e,null);n=i?i[t]:null}return"auto"===n?null:n}function ht(e,t,n){var i=document.createElement(e);return i.className=t||"",n&&n.appendChild(i),i}function dt(e){var t=e.parentNode;t&&t.removeChild(e)}function ft(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function pt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function vt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function mt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=bt(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function gt(e,t){if(void 0!==e.classList)for(var n=d(t),i=0,r=n.length;i<r;i++)e.classList.add(n[i]);else if(!mt(e,t)){var a=bt(e);yt(e,(a?a+" ":"")+t)}}function _t(e,t){void 0!==e.classList?e.classList.remove(t):yt(e,h((" "+bt(e)+" ").replace(" "+t+" "," ")))}function yt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function bt(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function xt(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&wt(e,t)}function wt(e,t){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(i)}catch(r){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+i+"(opacity="+t+")"}function kt(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function St(e,t,n){var i=t||new R(0,0);e.style[ot]=(Ne.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function Mt(e,t){e._leaflet_pos=t,Ne.any3d?St(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Tt(e){return e._leaflet_pos||new R(0,0)}if("onselectstart"in document)tt=function(){Dt(window,"selectstart",Wt)},nt=function(){zt(window,"selectstart",Wt)};else{var Ct=kt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);tt=function(){if(Ct){var e=document.documentElement.style;it=e[Ct],e[Ct]="none"}},nt=function(){Ct&&(document.documentElement.style[Ct]=it,it=void 0)}}function Et(){Dt(window,"dragstart",Wt)}function Pt(){zt(window,"dragstart",Wt)}function Lt(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(At(),rt=e,at=e.style.outline,e.style.outline="none",Dt(window,"keydown",At))}function At(){rt&&(rt.style.outline=at,rt=void 0,at=void 0,zt(window,"keydown",At))}function It(e){do{e=e.parentNode}while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Rt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Nt={__proto__:null,TRANSFORM:ot,TRANSITION:st,TRANSITION_END:ut,get:lt,getStyle:ct,create:ht,remove:dt,empty:ft,toFront:pt,toBack:vt,hasClass:mt,addClass:gt,removeClass:_t,setClass:yt,getClass:bt,setOpacity:xt,testProp:kt,setTransform:St,setPosition:Mt,getPosition:Tt,get disableTextSelection(){return tt},get enableTextSelection(){return nt},disableImageDrag:Et,enableImageDrag:Pt,preventOutline:Lt,restoreOutline:At,getSizedParentNode:It,getScale:Rt};function Dt(e,t,n,i){if(t&&"object"===typeof t)for(var r in t)$t(e,r,t[r],n);else for(var a=0,o=(t=d(t)).length;a<o;a++)$t(e,t[a],n,i);return this}var Ot="_leaflet_events";function zt(e,t,n,i){if(1===arguments.length)Ft(e),delete e[Ot];else if(t&&"object"===typeof t)for(var r in t)jt(e,r,t[r],n);else if(t=d(t),2===arguments.length)Ft(e,(function(e){return-1!==_(t,e)}));else for(var a=0,o=t.length;a<o;a++)jt(e,t[a],n,i);return this}function Ft(e,t){for(var n in e[Ot]){var i=n.split(/\d/)[0];t&&!t(i)||jt(e,i,null,null,n)}}var Bt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function $t(e,t,n,i){var r=t+o(n)+(i?"_"+o(i):"");if(e[Ot]&&e[Ot][r])return this;var a=function(t){return n.call(i||e,t||window.event)},s=a;!Ne.touchNative&&Ne.pointer&&0===t.indexOf("touch")?a=Ve(e,t,a):Ne.touch&&"dblclick"===t?a=Qe(e,a):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(Bt[t]||t,a,!!Ne.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(a=function(t){t=t||window.event,Yt(e,t)&&s(t)},e.addEventListener(Bt[t],a,!1)):e.addEventListener(t,s,!1):e.attachEvent("on"+t,a),e[Ot]=e[Ot]||{},e[Ot][r]=a}function jt(e,t,n,i,r){r=r||t+o(n)+(i?"_"+o(i):"");var a=e[Ot]&&e[Ot][r];if(!a)return this;!Ne.touchNative&&Ne.pointer&&0===t.indexOf("touch")?He(e,t,a):Ne.touch&&"dblclick"===t?et(e,a):"removeEventListener"in e?e.removeEventListener(Bt[t]||t,a,!1):e.detachEvent("on"+t,a),e[Ot][r]=null}function Ut(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Vt(e){return $t(e,"wheel",Ut),this}function Ht(e){return Dt(e,"mousedown touchstart dblclick contextmenu",Ut),e._leaflet_disable_click=!0,this}function Wt(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Gt(e){return Wt(e),Ut(e),this}function qt(e,t){if(!t)return new R(e.clientX,e.clientY);var n=Rt(t),i=n.boundingClientRect;return new R((e.clientX-i.left)/n.x-t.clientLeft,(e.clientY-i.top)/n.y-t.clientTop)}var Zt=Ne.win&&Ne.chrome?2*window.devicePixelRatio:Ne.gecko?window.devicePixelRatio:1;function Xt(e){return Ne.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Zt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function Yt(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(i){return!1}return n!==e}var Kt={__proto__:null,on:Dt,off:zt,stopPropagation:Ut,disableScrollPropagation:Vt,disableClickPropagation:Ht,preventDefault:Wt,stop:Gt,getMousePosition:qt,getWheelDelta:Xt,isExternalTarget:Yt,addListener:Dt,removeListener:zt},Jt=I.extend({run:function(e,t,n,i){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=Tt(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=M(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),Mt(this._el,n),this.fire("step")},_complete:function(){T(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),Qt=I.extend({options:{crs:Z,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=f(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(j(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=st&&Ne.any3d&&!Ne.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Dt(this._proxy,ut,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,i){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(j(e),t,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=n({animate:i.animate},i.zoom),i.pan=n({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,i.zoom):this._tryAnimatedPan(e,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var i=this.getZoomScale(t),r=this.getSize().divideBy(2),a=(e instanceof R?e:this.latLngToContainerPoint(e)).subtract(r).multiplyBy(1-1/i),o=this.containerPointToLatLng(r.add(a));return this.setView(o,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():B(e);var n=D(t.paddingTopLeft||t.padding||[0,0]),i=D(t.paddingBottomRight||t.padding||[0,0]),r=this.getBoundsZoom(e,!1,n.add(i));if((r="number"===typeof t.maxZoom?Math.min(t.maxZoom,r):r)===1/0)return{center:e.getCenter(),zoom:r};var a=i.subtract(n).divideBy(2),o=this.project(e.getSouthWest(),r),s=this.project(e.getNorthEast(),r);return{center:this.unproject(o.add(s).divideBy(2).add(a),r),zoom:r}},fitBounds:function(e,t){if(!(e=B(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=D(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Jt,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){gt(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!Ne.any3d)return this.setView(e,t,n);this._stop();var i=this.project(this.getCenter()),r=this.project(e),a=this.getSize(),o=this._zoom;e=j(e),t=void 0===t?o:t;var s=Math.max(a.x,a.y),u=s*this.getZoomScale(o,t),l=r.distanceTo(i)||1,c=1.42,h=c*c;function d(e){var t=(u*u-s*s+(e?-1:1)*h*h*l*l)/(2*(e?u:s)*h*l),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function f(e){return(Math.exp(e)-Math.exp(-e))/2}function p(e){return(Math.exp(e)+Math.exp(-e))/2}function v(e){return f(e)/p(e)}var m=d(0);function g(e){return s*(p(m)/p(m+c*e))}function _(e){return s*(p(m)*v(m+c*e)-f(m))/h}function y(e){return 1-Math.pow(1-e,1.5)}var b=Date.now(),x=(d(1)-m)/c,w=n.duration?1e3*n.duration:1e3*x*.8;function k(){var n=(Date.now()-b)/w,a=y(n)*x;n<=1?(this._flyToFrame=M(k,this),this._move(this.unproject(i.add(r.subtract(i).multiplyBy(_(a)/l)),o),this.getScaleZoom(s/g(a),o),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),k.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return(e=B(e)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,B(e));return n.equals(i)||this.panTo(i,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=D((t=t||{}).paddingTopLeft||t.padding||[0,0]),i=D(t.paddingBottomRight||t.padding||[0,0]),r=this.project(this.getCenter()),a=this.project(e),o=this.getPixelBounds(),s=z([o.min.add(n),o.max.subtract(i)]),u=s.getSize();if(!s.contains(a)){this._enforcingBounds=!0;var l=a.subtract(s.getCenter()),c=s.extend(a).getSize().subtract(u);r.x+=l.x<0?-c.x:c.x,r.y+=l.y<0?-c.y:c.y,this.panTo(this.unproject(r),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),a=t.divideBy(2).round(),o=i.divideBy(2).round(),s=a.subtract(o);return s.x||s.y?(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=r(this._handleGeolocationResponse,this),i=r(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,i,e):navigator.geolocation.getCurrentPosition(t,i,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new $(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),i=this._locateOptions;if(i.setView){var r=this.getBoundsZoom(n);this.setView(t,i.maxZoom?Math.min(r,i.maxZoom):r)}var a={latlng:t,bounds:n,timestamp:e.timestamp};for(var o in e.coords)"number"===typeof e.coords[o]&&(a[o]=e.coords[o]);this.fire("locationfound",a)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),dt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(T(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)dt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=ht("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new F(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=B(e),n=D(n||[0,0]);var i=this.getZoom()||0,r=this.getMinZoom(),a=this.getMaxZoom(),o=e.getNorthWest(),s=e.getSouthEast(),u=this.getSize().subtract(n),l=z(this.project(s,i),this.project(o,i)).getSize(),c=Ne.any3d?this.options.zoomSnap:1,h=u.x/l.x,d=u.y/l.y,f=t?Math.max(h,d):Math.min(h,d);return i=this.getScaleZoom(f,i),c&&(i=Math.round(i/(c/100))*(c/100),i=t?Math.ceil(i/c)*c:Math.floor(i/c)*c),Math.max(r,Math.min(a,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new R(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new O(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"===typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var i=n.zoom(e*n.scale(t));return isNaN(i)?1/0:i},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(j(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(D(e),t)},layerPointToLatLng:function(e){var t=D(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(j(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(j(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(B(e))},distance:function(e,t){return this.options.crs.distance(j(e),j(t))},containerPointToLayerPoint:function(e){return D(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return D(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(D(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(j(e)))},mouseEventToContainerPoint:function(e){return qt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=lt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");Dt(t,"scroll",this._onScroll,this),this._containerId=o(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ne.any3d,gt(e,"leaflet-container"+(Ne.touch?" leaflet-touch":"")+(Ne.retina?" leaflet-retina":"")+(Ne.ielt9?" leaflet-oldie":"")+(Ne.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ct(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Mt(this._mapPane,new R(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(gt(e.markerPane,"leaflet-zoom-hide"),gt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t){Mt(this._mapPane,new R(0,0));var n=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var i=this._zoom!==t;this._moveStart(i,!1)._move(e,t)._moveEnd(i),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n,i){void 0===t&&(t=this._zoom);var r=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),i?n&&n.pinch&&this.fire("zoom",n):((r||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return T(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Mt(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[o(this._container)]=this;var t=e?zt:Dt;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Ne.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){T(this._resizeRequest),this._resizeRequest=M((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,i=[],r="mouseout"===t||"mouseover"===t,a=e.target||e.srcElement,s=!1;a;){if((n=this._targets[o(a)])&&("click"===t||"preclick"===t)&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(t,!0)){if(r&&!Yt(a,e))break;if(i.push(n),r)break}if(a===this._container)break;a=a.parentNode}return i.length||s||r||!this.listens(t,!0)||(i=[this]),i},_isClickDisabled:function(e){for(;e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var n=e.type;"mousedown"===n&&Lt(t),this._fireDOMEvent(e,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,i){if("click"===e.type){var r=n({},e);r.type="preclick",this._fireDOMEvent(r,r.type,i)}var a=this._findEventTargets(e,t);if(i){for(var o=[],s=0;s<i.length;s++)i[s].listens(t,!0)&&o.push(i[s]);a=o.concat(a)}if(a.length){"contextmenu"===t&&Wt(e);var u=a[0],l={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var c=u.getLatLng&&(!u._radius||u._radius<=10);l.containerPoint=c?this.latLngToContainerPoint(u.getLatLng()):this.mouseEventToContainerPoint(e),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=c?u.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(s=0;s<a.length;s++)if(a[s].fire(t,l,!0),l.originalEvent._stopped||!1===a[s].options.bubblingMouseEvents&&-1!==_(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Tt(this._mapPane)||new R(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(i)},_latLngBoundsToNewLayerBounds:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return z([this.project(e.getSouthWest(),t)._subtract(i),this.project(e.getNorthWest(),t)._subtract(i),this.project(e.getSouthEast(),t)._subtract(i),this.project(e.getNorthEast(),t)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var i=this.project(e,t),r=this.getSize().divideBy(2),a=new O(i.subtract(r),i.add(r)),o=this._getBoundsOffset(a,n,t);return o.round().equals([0,0])?e:this.unproject(i.add(o),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),i=new O(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(i,t))},_getBoundsOffset:function(e,t,n){var i=z(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),r=i.min.subtract(e.min),a=i.max.subtract(e.max);return new R(this._rebound(r.x,-a.x),this._rebound(r.y,-a.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),i=Ne.any3d?this.options.zoomSnap:1;return i&&(e=Math.round(e/i)*i),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){_t(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n))&&(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=ht("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",(function(e){var t=ot,n=this._proxy.style[t];St(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){dt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();St(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(t),r=this._getCenterOffset(e)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(r))&&(M((function(){this._moveStart(!0,!1)._animateZoom(e,t,!0)}),this),!0)},_animateZoom:function(e,t,n,i){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,gt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&_t(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function en(e,t){return new Qt(e,t)}var tn=E.extend({options:{position:"topright"},initialize:function(e){f(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),i=e._controlCorners[n];return gt(t,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(t,i.firstChild):i.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(dt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),nn=function(e){return new tn(e)};Qt.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=ht("div",t+"control-container",this._container);function i(i,r){var a=t+i+" "+t+r;e[i+r]=ht("div",a,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)dt(this._controlCorners[e]);dt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var rn=tn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,i){return n<i?-1:i<n?1:0}},initialize:function(e,t,n){for(var i in f(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,e)this._addLayer(e[i],i);for(i in t)this._addLayer(t[i],i,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return tn.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(o(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){gt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(gt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):_t(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return _t(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=ht("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Ht(t),Vt(t);var i=this._section=ht("section",e+"-list");n&&(this._map.on("click",this.collapse,this),Dt(t,{mouseenter:function(){Dt(i,"click",Wt),this.expand(),setTimeout((function(){zt(i,"click",Wt)}))},mouseleave:this.collapse},this));var r=this._layersLink=ht("a",e+"-toggle",t);r.href="#",r.title="Layers",r.setAttribute("role","button"),Dt(r,"click",Wt),Dt(r,"focus",this.expand,this),n||this.expand(),this._baseLayersList=ht("div",e+"-base",i),this._separator=ht("div",e+"-separator",i),this._overlaysList=ht("div",e+"-overlays",i),t.appendChild(i)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&o(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(r((function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)}),this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ft(this._baseLayersList),ft(this._overlaysList),this._layerControlInputs=[];var e,t,n,i,r=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),t=t||i.overlay,e=e||!i.overlay,r+=i.overlay?0:1;return this.options.hideSingleBase&&(e=e&&r>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(o(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(e){var t,n=document.createElement("label"),i=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=i):t=this._createRadioElement("leaflet-base-layers_"+o(this),i),this._layerControlInputs.push(t),t.layerId=o(e.layer),Dt(t,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+e.name;var a=document.createElement("span");return n.appendChild(a),a.appendChild(t),a.appendChild(r),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var e,t,n=this._layerControlInputs,i=[],r=[];this._handlingClick=!0;for(var a=n.length-1;a>=0;a--)e=n[a],t=this._getLayer(e.layerId).layer,e.checked?i.push(t):e.checked||r.push(t);for(a=0;a<r.length;a++)this._map.hasLayer(r[a])&&this._map.removeLayer(r[a]);for(a=0;a<i.length;a++)this._map.hasLayer(i[a])||this._map.addLayer(i[a]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,i=this._map.getZoom(),r=n.length-1;r>=0;r--)e=n[r],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&i<t.options.minZoom||void 0!==t.options.maxZoom&&i>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this}}),an=function(e,t,n){return new rn(e,t,n)},on=tn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=ht("div",t+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,i,r){var a=ht("a",n,i);return a.innerHTML=e,a.href="#",a.title=t,a.setAttribute("role","button"),a.setAttribute("aria-label",t),Ht(a),Dt(a,"click",Gt),Dt(a,"click",r,this),Dt(a,"click",this._refocusOnMap,this),a},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";_t(this._zoomInButton,t),_t(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(gt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(gt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});Qt.mergeOptions({zoomControl:!0}),Qt.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new on,this.addControl(this.zoomControl))}));var sn=function(e){return new on(e)},un=tn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=ht("div",t),i=this.options;return this._addScales(i,t+"-line",n),e.on(i.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=ht("div",t,n)),e.imperial&&(this._iScale=ht("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,i,r=3.2808399*e;r>5280?(t=r/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" ft",i/r))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),ln=function(e){return new un(e)},cn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',hn=tn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ne.inlineSvg?cn+" ":"")+"Leaflet</a>"},initialize:function(e){f(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=ht("div","leaflet-control-attribution"),Ht(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",(function(){this.removeAttribution(e.layer.getAttribution())}),this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});Qt.mergeOptions({attributionControl:!0}),Qt.addInitHook((function(){this.options.attributionControl&&(new hn).addTo(this)}));var dn=function(e){return new hn(e)};tn.Layers=rn,tn.Zoom=on,tn.Scale=un,tn.Attribution=hn,nn.layers=an,nn.zoom=sn,nn.scale=ln,nn.attribution=dn;var fn=E.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});fn.addTo=function(e,t){return e.addHandler(t,this),this};var pn,vn={Events:A},mn=Ne.touch?"touchstart mousedown":"mousedown",gn=I.extend({options:{clickTolerance:3},initialize:function(e,t,n,i){f(this,i),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(Dt(this._dragStartTarget,mn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(gn._dragging===this&&this.finishDrag(!0),zt(this._dragStartTarget,mn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!mt(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)gn._dragging===this&&this.finishDrag();else if(!(gn._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)&&(gn._dragging=this,this._preventOutline&&Lt(this._element),Et(),tt(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,n=It(this._element);this._startPoint=new R(t.clientX,t.clientY),this._startPos=Tt(this._element),this._parentScale=Rt(n);var i="mousedown"===e.type;Dt(document,i?"mousemove":"touchmove",this._onMove,this),Dt(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new R(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Wt(e),this._moved||(this.fire("dragstart"),this._moved=!0,gt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),gt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Mt(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){_t(document.body,"leaflet-dragging"),this._lastTarget&&(_t(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),zt(document,"mousemove touchmove",this._onMove,this),zt(document,"mouseup touchend touchcancel",this._onUp,this),Pt(),nt(),this._moved&&this._moving&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,gn._dragging=!1}});function _n(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=xn(e=kn(e,n),n)}function yn(e,t,n){return Math.sqrt(En(e,t,n,!0))}function bn(e,t,n){return En(e,t,n)}function xn(e,t){var n=e.length,i=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,wn(e,i,t,0,n-1);var r,a=[];for(r=0;r<n;r++)i[r]&&a.push(e[r]);return a}function wn(e,t,n,i,r){var a,o,s,u=0;for(o=i+1;o<=r-1;o++)(s=En(e[o],e[i],e[r],!0))>u&&(a=o,u=s);u>n&&(t[a]=1,wn(e,t,n,i,a),wn(e,t,n,a,r))}function kn(e,t){for(var n=[e[0]],i=1,r=0,a=e.length;i<a;i++)Cn(e[i],e[r])>t&&(n.push(e[i]),r=i);return r<a-1&&n.push(e[a-1]),n}function Sn(e,t,n,i,r){var a,o,s,u=i?pn:Tn(e,n),l=Tn(t,n);for(pn=l;;){if(!(u|l))return[e,t];if(u&l)return!1;s=Tn(o=Mn(e,t,a=u||l,n,r),n),a===u?(e=o,u=s):(t=o,l=s)}}function Mn(e,t,n,i,r){var a,o,s=t.x-e.x,u=t.y-e.y,l=i.min,c=i.max;return 8&n?(a=e.x+s*(c.y-e.y)/u,o=c.y):4&n?(a=e.x+s*(l.y-e.y)/u,o=l.y):2&n?(a=c.x,o=e.y+u*(c.x-e.x)/s):1&n&&(a=l.x,o=e.y+u*(l.x-e.x)/s),new R(a,o,r)}function Tn(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function Cn(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i}function En(e,t,n,i){var r,a=t.x,o=t.y,s=n.x-a,u=n.y-o,l=s*s+u*u;return l>0&&((r=((e.x-a)*s+(e.y-o)*u)/l)>1?(a=n.x,o=n.y):r>0&&(a+=s*r,o+=u*r)),s=e.x-a,u=e.y-o,i?s*s+u*u:new R(a,o)}function Pn(e){return!g(e[0])||"object"!==typeof e[0][0]&&"undefined"!==typeof e[0][0]}function Ln(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Pn(e)}var An={__proto__:null,simplify:_n,pointToSegmentDistance:yn,closestPointOnSegment:bn,clipSegment:Sn,_getEdgeIntersection:Mn,_getBitCode:Tn,_sqClosestPointOnSegment:En,isFlat:Pn,_flat:Ln};function In(e,t,n){var i,r,a,o,s,u,l,c,h,d=[1,4,2,8];for(r=0,l=e.length;r<l;r++)e[r]._code=Tn(e[r],t);for(o=0;o<4;o++){for(c=d[o],i=[],r=0,a=(l=e.length)-1;r<l;a=r++)s=e[r],u=e[a],s._code&c?u._code&c||((h=Mn(u,s,c,t,n))._code=Tn(h,t),i.push(h)):(u._code&c&&((h=Mn(u,s,c,t,n))._code=Tn(h,t),i.push(h)),i.push(s));e=i}return e}var Rn={__proto__:null,clipPolygon:In},Nn={project:function(e){return new R(e.lng,e.lat)},unproject:function(e){return new $(e.y,e.x)},bounds:new O([-180,-90],[180,90])},Dn={R:6378137,R_MINOR:6356752.314245179,bounds:new O([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,i=e.lat*t,r=this.R_MINOR/n,a=Math.sqrt(1-r*r),o=a*Math.sin(i),s=Math.tan(Math.PI/4-i/2)/Math.pow((1-o)/(1+o),a/2);return i=-n*Math.log(Math.max(s,1e-10)),new R(e.lng*t*n,i)},unproject:function(e){for(var t,n=180/Math.PI,i=this.R,r=this.R_MINOR/i,a=Math.sqrt(1-r*r),o=Math.exp(-e.y/i),s=Math.PI/2-2*Math.atan(o),u=0,l=.1;u<15&&Math.abs(l)>1e-7;u++)t=a*Math.sin(s),t=Math.pow((1-t)/(1+t),a/2),s+=l=Math.PI/2-2*Math.atan(o*t)-s;return new $(s*n,e.x*n/i)}},On={__proto__:null,LonLat:Nn,Mercator:Dn,SphericalMercator:W},zn=n({},V,{code:"EPSG:3395",projection:Dn,transformation:function(){var e=.5/(Math.PI*Dn.R);return q(e,.5,-e,.5)}()}),Fn=n({},V,{code:"EPSG:4326",projection:Nn,transformation:q(1/180,1,-1/180,.5)}),Bn=n({},U,{projection:Nn,transformation:q(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,i=t.lat-e.lat;return Math.sqrt(n*n+i*i)},infinite:!0});U.Earth=V,U.EPSG3395=zn,U.EPSG3857=Z,U.EPSG900913=X,U.EPSG4326=Fn,U.Simple=Bn;var $n=I.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[o(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[o(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",(function(){t.off(n,this)}),this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});Qt.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=o(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=o(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return o(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?g(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[o(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=o(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;e=void 0===r.minZoom?e:Math.min(e,r.minZoom),t=void 0===r.maxZoom?t:Math.max(t,r.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var jn=$n.extend({initialize:function(e,t){var n,i;if(f(this,t),this._layers={},e)for(n=0,i=e.length;n<i;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"===typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,i=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,i);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return o(e)}}),Un=function(e,t){return new jn(e,t)},Vn=jn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),jn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),jn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new F;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),Hn=function(e,t){return new Vn(e,t)},Wn=E.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){f(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(i,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(e,t){var n=this.options,i=n[t+"Size"];"number"===typeof i&&(i=[i,i]);var r=D(i),a=D("shadow"===t&&n.shadowAnchor||n.iconAnchor||r&&r.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),a&&(e.style.marginLeft=-a.x+"px",e.style.marginTop=-a.y+"px"),r&&(e.style.width=r.x+"px",e.style.height=r.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return Ne.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Gn(e){return new Wn(e)}var qn=Wn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!==typeof qn.imagePath&&(qn.imagePath=this._detectIconPath()),(this.options.imagePath||qn.imagePath)+Wn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var i=t.exec(e);return i&&i[n]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=ht("div","leaflet-default-icon-path",document.body),t=ct(e,"background-image")||ct(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-"leaflet.css".length-1):""}}),Zn=fn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new gn(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),gt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&_t(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,i=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,a=Tt(t._icon),o=n.getPixelBounds(),s=n.getPixelOrigin(),u=z(o.min._subtract(s).add(r),o.max._subtract(s).subtract(r));if(!u.contains(a)){var l=D((Math.max(u.max.x,a.x)-u.max.x)/(o.max.x-u.max.x)-(Math.min(u.min.x,a.x)-u.min.x)/(o.min.x-u.min.x),(Math.max(u.max.y,a.y)-u.max.y)/(o.max.y-u.max.y)-(Math.min(u.min.y,a.y)-u.min.y)/(o.min.y-u.min.y)).multiplyBy(i);n.panBy(l,{animate:!1}),this._draggable._newPos._add(l),this._draggable._startPos._add(l),Mt(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=M(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(T(this._panRequest),this._panRequest=M(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,i=Tt(t._icon),r=t._map.layerPointToLatLng(i);n&&Mt(n,i),t._latlng=r,e.latlng=r,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){T(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Xn=$n.extend({options:{icon:new qn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){f(this,t),this._latlng=j(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=j(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),gt(n,t),e.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Dt(n,"focus",this._panOnFocus,this);var r=e.icon.createShadow(this._shadow),a=!1;r!==this._shadow&&(this._removeShadow(),a=!0),r&&(gt(r,t),r.alt=""),this._shadow=r,e.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&a&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&zt(this._icon,"focus",this._panOnFocus,this),dt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&dt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Mt(this._icon,e),this._shadow&&Mt(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(gt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Zn)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Zn(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&xt(this._icon,e),this._shadow&&xt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?D(t.iconSize):D(0,0),i=t.iconAnchor?D(t.iconAnchor):D(0,0);e.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:n.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Yn(e,t){return new Xn(e,t)}var Kn=$n.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return f(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Jn=Kn.extend({options:{fill:!0,radius:10},initialize:function(e,t){f(this,t),this._latlng=j(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=j(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return Kn.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),i=[e+n,t+n];this._pxBounds=new O(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Qn(e,t){return new Jn(e,t)}var ei=Jn.extend({initialize:function(e,t,i){if("number"===typeof t&&(t=n({},i,{radius:t})),f(this,t),this._latlng=j(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Kn.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===V.distance){var r=Math.PI/180,a=this._mRadius/V.R/r,o=n.project([t+a,e]),s=n.project([t-a,e]),u=o.add(s).divideBy(2),l=n.unproject(u).lat,c=Math.acos((Math.cos(a*r)-Math.sin(t*r)*Math.sin(l*r))/(Math.cos(t*r)*Math.cos(l*r)))/r;(isNaN(c)||0===c)&&(c=a/Math.cos(Math.PI/180*t)),this._point=u.subtract(n.getPixelOrigin()),this._radius=isNaN(c)?0:u.x-n.project([l,e-c]).x,this._radiusY=u.y-o.y}else{var h=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}});function ti(e,t,n){return new ei(e,t,n)}var ni=Kn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){f(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,i=1/0,r=null,a=En,o=0,s=this._parts.length;o<s;o++)for(var u=this._parts[o],l=1,c=u.length;l<c;l++){var h=a(e,t=u[l-1],n=u[l],!0);h<i&&(i=h,r=a(e,t,n))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,n,i,r,a,o,s=this._rings[0],u=s.length;if(!u)return null;for(e=0,t=0;e<u-1;e++)t+=s[e].distanceTo(s[e+1])/2;if(0===t)return this._map.layerPointToLatLng(s[0]);for(e=0,i=0;e<u-1;e++)if(r=s[e],a=s[e+1],(i+=n=r.distanceTo(a))>t)return o=(i-t)/n,this._map.layerPointToLatLng([a.x-o*(a.x-r.x),a.y-o*(a.y-r.y)])},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=j(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new F,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Pn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=Pn(e),i=0,r=e.length;i<r;i++)n?(t[i]=j(e[i]),this._bounds.extend(t[i])):t[i]=this._convertLatLngs(e[i]);return t},_project:function(){var e=new O;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new R(e,e);this._rawPxBounds&&(this._pxBounds=new O([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var i,r,a=e[0]instanceof $,o=e.length;if(a){for(r=[],i=0;i<o;i++)r[i]=this._map.latLngToLayerPoint(e[i]),n.extend(r[i]);t.push(r)}else for(i=0;i<o;i++)this._projectLatlngs(e[i],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,i,r,a,o,s,u=this._parts;for(t=0,i=0,r=this._rings.length;t<r;t++)for(n=0,a=(s=this._rings[t]).length;n<a-1;n++)(o=Sn(s[n],s[n+1],e,n,!0))&&(u[i]=u[i]||[],u[i].push(o[0]),o[1]===s[n+1]&&n!==a-2||(u[i].push(o[1]),i++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,i=e.length;n<i;n++)e[n]=_n(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,i,r,a,o,s,u=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,a=this._parts.length;n<a;n++)for(i=0,r=(o=(s=this._parts[n]).length)-1;i<o;r=i++)if((t||0!==i)&&yn(e,s[r],s[i])<=u)return!0;return!1}});function ii(e,t){return new ni(e,t)}ni._flat=Ln;var ri=ni.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,n,i,r,a,o,s,u,l=this._rings[0],c=l.length;if(!c)return null;for(a=o=s=0,e=0,t=c-1;e<c;t=e++)n=l[e],i=l[t],r=n.y*i.x-i.y*n.x,o+=(n.x+i.x)*r,s+=(n.y+i.y)*r,a+=3*r;return u=0===a?l[0]:[o/a,s/a],this._map.layerPointToLatLng(u)},_convertLatLngs:function(e){var t=ni.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof $&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){ni.prototype._setLatLngs.call(this,e),Pn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Pn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new R(t,t);if(e=new O(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var i,r=0,a=this._rings.length;r<a;r++)(i=In(this._rings[r],e,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,i,r,a,o,s,u,l=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(r=0,s=this._parts.length;r<s;r++)for(a=0,o=(u=(t=this._parts[r]).length)-1;a<u;o=a++)n=t[a],i=t[o],n.y>e.y!==i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(l=!l);return l||ni.prototype._containsPoint.call(this,e,!0)}});function ai(e,t){return new ri(e,t)}var oi=Vn.extend({initialize:function(e,t){f(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,i,r=g(e)?e:e.features;if(r){for(t=0,n=r.length;t<n;t++)((i=r[t]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var a=this.options;if(a.filter&&!a.filter(e))return this;var o=si(e,a);return o?(o.feature=pi(e),o.defaultOptions=o.options,this.resetStyle(o),a.onEachFeature&&a.onEachFeature(e,o),this.addLayer(o)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer((function(t){this._setLayerStyle(t,e)}),this)},_setLayerStyle:function(e,t){e.setStyle&&("function"===typeof t&&(t=t(e.feature)),e.setStyle(t))}});function si(e,t){var n,i,r,a,o="Feature"===e.type?e.geometry:e,s=o?o.coordinates:null,u=[],l=t&&t.pointToLayer,c=t&&t.coordsToLatLng||li;if(!s&&!o)return null;switch(o.type){case"Point":return ui(l,e,n=c(s),t);case"MultiPoint":for(r=0,a=s.length;r<a;r++)n=c(s[r]),u.push(ui(l,e,n,t));return new Vn(u);case"LineString":case"MultiLineString":return i=ci(s,"LineString"===o.type?0:1,c),new ni(i,t);case"Polygon":case"MultiPolygon":return i=ci(s,"Polygon"===o.type?1:2,c),new ri(i,t);case"GeometryCollection":for(r=0,a=o.geometries.length;r<a;r++){var h=si({geometry:o.geometries[r],type:"Feature",properties:e.properties},t);h&&u.push(h)}return new Vn(u);default:throw new Error("Invalid GeoJSON object.")}}function ui(e,t,n,i){return e?e(t,n):new Xn(n,i&&i.markersInheritOptions&&i)}function li(e){return new $(e[1],e[0],e[2])}function ci(e,t,n){for(var i,r=[],a=0,o=e.length;a<o;a++)i=t?ci(e[a],t-1,n):(n||li)(e[a]),r.push(i);return r}function hi(e,t){return void 0!==(e=j(e)).alt?[c(e.lng,t),c(e.lat,t),c(e.alt,t)]:[c(e.lng,t),c(e.lat,t)]}function di(e,t,n,i){for(var r=[],a=0,o=e.length;a<o;a++)r.push(t?di(e[a],t-1,n,i):hi(e[a],i));return!t&&n&&r.push(r[0]),r}function fi(e,t){return e.feature?n({},e.feature,{geometry:t}):pi(t)}function pi(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var vi={toGeoJSON:function(e){return fi(this,{type:"Point",coordinates:hi(this.getLatLng(),e)})}};function mi(e,t){return new oi(e,t)}Xn.include(vi),ei.include(vi),Jn.include(vi),ni.include({toGeoJSON:function(e){var t=!Pn(this._latlngs);return fi(this,{type:(t?"Multi":"")+"LineString",coordinates:di(this._latlngs,t?1:0,!1,e)})}}),ri.include({toGeoJSON:function(e){var t=!Pn(this._latlngs),n=t&&!Pn(this._latlngs[0]),i=di(this._latlngs,n?2:t?1:0,!0,e);return t||(i=[i]),fi(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),jn.include({toMultiPoint:function(e){var t=[];return this.eachLayer((function(n){t.push(n.toGeoJSON(e).geometry.coordinates)})),fi(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,i=[];return this.eachLayer((function(t){if(t.toGeoJSON){var r=t.toGeoJSON(e);if(n)i.push(r.geometry);else{var a=pi(r);"FeatureCollection"===a.type?i.push.apply(i,a.features):i.push(a)}}})),n?fi(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var gi=mi,_i=$n.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=B(t),f(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(gt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){dt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&pt(this._image),this},bringToBack:function(){return this._map&&vt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=B(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:ht("img");gt(t,"leaflet-image-layer"),this._zoomAnimated&&gt(t,"leaflet-zoom-animated"),this.options.className&&gt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onload=r(this.fire,this,"load"),t.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;St(this._image,n,t)},_reset:function(){var e=this._image,t=new O(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();Mt(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){xt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),yi=function(e,t,n){return new _i(e,t,n)},bi=_i.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:ht("video");if(gt(t,"leaflet-image-layer"),this._zoomAnimated&&gt(t,"leaflet-zoom-animated"),this.options.className&&gt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onloadeddata=r(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),i=[],a=0;a<n.length;a++)i.push(n[a].src);this._url=n.length>0?i:[t.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var o=0;o<this._url.length;o++){var s=ht("source");s.src=this._url[o],t.appendChild(s)}}}});function xi(e,t,n){return new bi(e,t,n)}var wi=_i.extend({_initImage:function(){var e=this._image=this._url;gt(e,"leaflet-image-layer"),this._zoomAnimated&&gt(e,"leaflet-zoom-animated"),this.options.className&&gt(e,this.options.className),e.onselectstart=l,e.onmousemove=l}});function ki(e,t,n){return new wi(e,t,n)}var Si=$n.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0},initialize:function(e,t){f(this,e),this._source=t},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&xt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&xt(this._container,1),this.bringToFront(),this.options.interactive&&(gt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(xt(this._container,0),this._removeTimeout=setTimeout(r(dt,void 0,this._container),200)):dt(this._container),this.options.interactive&&(_t(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=j(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&pt(this._container),this},bringToBack:function(){return this._map&&vt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Vn){t=null;var n=this._source._layers;for(var i in n)if(n[i]._map){t=n[i];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=D(this.options.offset),n=this._getAnchor();this._zoomAnimated?Mt(this._container,e.add(n)):t=t.add(e).add(n);var i=this._containerBottom=-t.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=i+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}});Qt.include({_initOverlay:function(e,t,n,i){var r=t;return r instanceof e||(r=new e(i).setContent(t)),n&&r.setLatLng(n),r}}),$n.include({_initOverlay:function(e,t,n,i){var r=n;return r instanceof e?(f(r,i),r._source=this):(r=t&&!i?t:new e(i,this)).setContent(n),r}});var Mi=Si.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Si.prototype.openOn.call(this,e)},onAdd:function(e){Si.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Kn||this._source.on("preclick",Ut))},onRemove:function(e){Si.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Kn||this._source.off("preclick",Ut))},getEvents:function(){var e=Si.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=ht("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=ht("div",e+"-content-wrapper",t);if(this._contentNode=ht("div",e+"-content",n),Ht(t),Vt(this._contentNode),Dt(t,"contextmenu",Ut),this._tipContainer=ht("div",e+"-tip-container",t),this._tip=ht("div",e+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=ht("a",e+"-close-button",t);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',Dt(i,"click",this.close,this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var i=e.offsetHeight,r=this.options.maxHeight,a="leaflet-popup-scrolled";r&&i>r?(t.height=r+"px",gt(e,a)):_t(e,a),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();Mt(this._container,t.add(n))},_adjustPan:function(e){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var t=this._map,n=parseInt(ct(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+n,r=this._containerWidth,a=new R(this._containerLeft,-i-this._containerBottom);a._add(Tt(this._container));var o=t.layerPointToContainerPoint(a),s=D(this.options.autoPanPadding),u=D(this.options.autoPanPaddingTopLeft||s),l=D(this.options.autoPanPaddingBottomRight||s),c=t.getSize(),h=0,d=0;o.x+r+l.x>c.x&&(h=o.x+r-c.x+l.x),o.x-h-u.x<0&&(h=o.x-u.x),o.y+i+l.y>c.y&&(d=o.y+i-c.y+l.y),o.y-d-u.y<0&&(d=o.y-u.y),(h||d)&&t.fire("autopanstart").panBy([h,d],{animate:e&&"moveend"===e.type})}},_getAnchor:function(){return D(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ti=function(e,t){return new Mi(e,t)};Qt.mergeOptions({closePopupOnClick:!0}),Qt.include({openPopup:function(e,t,n){return this._initOverlay(Mi,e,t,n).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),$n.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Mi,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&this._popup._prepareOpen(e)&&this._popup.openOn(this._map),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Gt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof Kn?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Ci=Si.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Si.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Si.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Si.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ht("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,i=this._map,r=this._container,a=i.latLngToContainerPoint(i.getCenter()),o=i.layerPointToContainerPoint(e),s=this.options.direction,u=r.offsetWidth,l=r.offsetHeight,c=D(this.options.offset),h=this._getAnchor();"top"===s?(t=u/2,n=l):"bottom"===s?(t=u/2,n=0):"center"===s?(t=u/2,n=l/2):"right"===s?(t=0,n=l/2):"left"===s?(t=u,n=l/2):o.x<a.x?(s="right",t=0,n=l/2):(s="left",t=u+2*(c.x+h.x),n=l/2),e=e.subtract(D(t,n,!0)).add(c).add(h),_t(r,"leaflet-tooltip-right"),_t(r,"leaflet-tooltip-left"),_t(r,"leaflet-tooltip-top"),_t(r,"leaflet-tooltip-bottom"),gt(r,"leaflet-tooltip-"+s),Mt(r,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&xt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return D(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Ei=function(e,t){return new Ci(e,t)};Qt.include({openTooltip:function(e,t,n){return this._initOverlay(Ci,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),$n.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ci,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&this._tooltip._prepareOpen(e)&&this._tooltip.openOn(this._map),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_openTooltip:function(e){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0))},_moveTooltip:function(e){var t,n,i=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var Pi=Wn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(ft(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=D(n.bgPos);t.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Li(e){return new Pi(e)}Wn.Default=qn;var Ai=$n.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ne.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){f(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),dt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(pt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(vt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof R?e:new R(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,i=-e(-1/0,1/0),r=0,a=n.length;r<a;r++)t=n[r].style.zIndex,n[r]!==this._container&&t&&(i=e(i,+t));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ne.ielt9){xt(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var i in this._tiles){var r=this._tiles[i];if(r.current&&r.loaded){var a=Math.min(1,(e-r.loaded)/200);xt(r.el,a),a<1?t=!0:(r.active?n=!0:this._onOpaqueTile(r),r.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(T(this._fadeFrame),this._fadeFrame=M(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=ht("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(dt(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[e],r=this._map;return i||((i=this._levels[e]={}).el=ht("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=t,i.origin=r.project(r.unproject(r.getPixelOrigin()),e).round(),i.zoom=e,this._setZoomTransform(i,r.getCenter(),r.getZoom()),l(i.el.offsetWidth),this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var i=t.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)dt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,i){var r=Math.floor(e/2),a=Math.floor(t/2),o=n-1,s=new R(+r,+a);s.z=+o;var u=this._tileCoordsToKey(s),l=this._tiles[u];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),o>i&&this._retainParent(r,a,o,i))},_retainChildren:function(e,t,n,i){for(var r=2*e;r<2*e+2;r++)for(var a=2*t;a<2*t+2;a++){var o=new R(r,a);o.z=n+1;var s=this._tileCoordsToKey(o),u=this._tiles[s];u&&u.active?u.retain=!0:(u&&u.loaded&&(u.retain=!0),n+1<i&&this._retainChildren(r,a,n+1,i))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,i){var r=Math.round(t);r=void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom?void 0:this._clampZoom(r);var a=this.options.updateWhenZooming&&r!==this._tileZoom;i&&!a||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var i=this._map.getZoomScale(n,e.zoom),r=e.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,n)).round();Ne.any3d?St(e.el,r,i):Mt(e.el,r)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],i).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],i).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],i).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),i=t.getZoomScale(n,this._tileZoom),r=t.project(e,this._tileZoom).floor(),a=t.getSize().divideBy(2*i);return new O(r.subtract(a),r.add(a))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(e),r=this._pxBoundsToTileRange(i),a=r.getCenter(),o=[],s=this.options.keepBuffer,u=new O(r.getBottomLeft().subtract([s,-s]),r.getTopRight().add([s,-s]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var l in this._tiles){var c=this._tiles[l].coords;c.z===this._tileZoom&&u.contains(new R(c.x,c.y))||(this._tiles[l].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var h=r.min.y;h<=r.max.y;h++)for(var d=r.min.x;d<=r.max.x;d++){var f=new R(d,h);if(f.z=this._tileZoom,this._isValidTile(f)){var p=this._tiles[this._tileCoordsToKey(f)];p?p.current=!0:o.push(f)}}if(o.sort((function(e,t){return e.distanceTo(a)-t.distanceTo(a)})),0!==o.length){this._loading||(this._loading=!0,this.fire("loading"));var v=document.createDocumentFragment();for(d=0;d<o.length;d++)this._addTile(o[d],v);this._level.el.appendChild(v)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(e);return B(this.options.bounds).overlaps(i)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),i=e.scaleBy(n),r=i.add(n);return[t.unproject(i,e.z),t.unproject(r,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new F(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new R(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(dt(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){gt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=l,e.onmousemove=l,Ne.ielt9&&this.options.opacity<1&&xt(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),i=this._tileCoordsToKey(e),a=this.createTile(this._wrapCoords(e),r(this._tileReady,this,e));this._initTile(a),this.createTile.length<2&&M(r(this._tileReady,this,e,null,a)),Mt(a,n),this._tiles[i]={el:a,coords:e,current:!0},t.appendChild(a),this.fire("tileloadstart",{tile:a,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var i=this._tileCoordsToKey(e);(n=this._tiles[i])&&(n.loaded=+new Date,this._map._fadeAnimated?(xt(n.el,0),T(this._fadeFrame),this._fadeFrame=M(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(gt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ne.ielt9||!this._map._fadeAnimated?M(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new R(this._wrapX?u(e.x,this._wrapX):e.x,this._wrapY?u(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new O(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Ii(e){return new Ai(e)}var Ri=Ai.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=f(this,t)).detectRetina&&Ne.retina&&t.maxZoom>0&&(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom++):(t.zoomOffset++,t.maxZoom--),t.minZoom=Math.max(0,t.minZoom)),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return Dt(n,"load",r(this._tileOnLoad,this,t,n)),Dt(n,"error",r(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:Ne.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=i),t["-y"]=i}return m(this._url,n(t,this.options))},_tileOnLoad:function(e,t){Ne.ielt9?setTimeout(r(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var i=this.options.errorTileUrl;i&&t.getAttribute("src")!==i&&(t.src=i),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=l,t.onerror=l,!t.complete)){t.src=y;var n=this._tiles[e].coords;dt(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",y),Ai.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==y))return Ai.prototype._tileReady.call(this,e,t,n)}});function Ni(e,t){return new Ri(e,t)}var Di=Ri.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var i=n({},this.defaultWmsParams);for(var r in t)r in this.options||(i[r]=t[r]);var a=(t=f(this,t)).detectRetina&&Ne.retina?2:1,o=this.getTileSize();i.width=o.x*a,i.height=o.y*a,this.wmsParams=i},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Ri.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,i=z(n.project(t[0]),n.project(t[1])),r=i.min,a=i.max,o=(this._wmsVersion>=1.3&&this._crs===Fn?[r.y,r.x,a.y,a.x]:[r.x,r.y,a.x,a.y]).join(","),s=Ri.prototype.getTileUrl.call(this,e);return s+p(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function Oi(e,t){return new Di(e,t)}Ri.WMS=Di,Ni.wms=Oi;var zi=$n.extend({options:{padding:.1},initialize:function(e){f(this,e),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&gt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,t),a=i.multiplyBy(-n).add(r).subtract(this._map._getNewPixelOrigin(e,t));Ne.any3d?St(this._container,a,n):Mt(this._container,a)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new O(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Fi=zi.extend({options:{tolerance:0},getEvents:function(){var e=zi.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Dt(e,"mousemove",this._onMouseMove,this),Dt(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Dt(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){T(this._redrawRequest),delete this._ctx,dt(this._container),zt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){zi.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),i=Ne.retina?2:1;Mt(t,e.min),t.width=i*n.x,t.height=i*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",Ne.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){zi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[o(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,i=t.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete e._order,delete this._layers[o(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"===typeof e.options.dashArray){var t,n,i=e.options.dashArray.split(/[, ]+/),r=[];for(n=0;n<i.length;n++){if(t=Number(i[n]),isNaN(t))return;r.push(t)}e.options._dashArray=r}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||M(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new O,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)e=i.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,i,r,a,o=e._parts,s=o.length,u=this._ctx;if(s){for(u.beginPath(),n=0;n<s;n++){for(i=0,r=o[n].length;i<r;i++)a=o[n][i],u[i?"lineTo":"moveTo"](a.x,a.y);t&&u.closePath()}this._fillStroke(u,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,i=Math.max(Math.round(e._radius),1),r=(Math.max(Math.round(e._radiusY),1)||i)/i;1!==r&&(n.save(),n.scale(1,r)),n.beginPath(),n.arc(t.x,t.y/r,i,0,2*Math.PI,!1),1!==r&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,i=this._map.mouseEventToLayerPoint(e),r=this._drawFirst;r;r=r.next)(t=r.layer).options.interactive&&t._containsPoint(i)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(n=t);this._fireEvent(!!n&&[n],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(_t(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,i,a=this._drawFirst;a;a=a.next)(n=a.layer).options.interactive&&n._containsPoint(t)&&(i=n);i!==this._hoveredLayer&&(this._handleMouseOut(e),i&&(gt(this._container,"leaflet-interactive"),this._fireEvent([i],e,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(r((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function Bi(e){return Ne.canvas?new Fi(e):null}var $i=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),ji={_initContainer:function(){this._container=ht("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zi.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=$i("shape");gt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=$i("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;dt(t),e.removeInteractiveTarget(t),delete this._layers[o(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,i=e.options,r=e._container;r.stroked=!!i.stroke,r.filled=!!i.fill,i.stroke?(t||(t=e._stroke=$i("stroke")),r.appendChild(t),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=g(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=i.lineCap.replace("butt","flat"),t.joinstyle=i.lineJoin):t&&(r.removeChild(t),e._stroke=null),i.fill?(n||(n=e._fill=$i("fill")),r.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(r.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),i=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+i+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){pt(e._container)},_bringToBack:function(e){vt(e._container)}},Ui=Ne.vml?$i:Y,Vi=zi.extend({_initContainer:function(){this._container=Ui("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ui("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){dt(this._container),zt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){zi.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),Mt(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Ui("path");e.options.className&&gt(t,e.options.className),e.options.interactive&&gt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){dt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[o(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,K(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),i="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",r=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(e,r)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){pt(e._path)},_bringToBack:function(e){vt(e._path)}});function Hi(e){return Ne.svg||Ne.vml?new Vi(e):null}Ne.vml&&Vi.include(ji),Qt.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Bi(e)||Hi(e)}});var Wi=ri.extend({initialize:function(e,t){ri.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=B(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Gi(e,t){return new Wi(e,t)}Vi.create=Ui,Vi.pointsToPath=K,oi.geometryToLayer=si,oi.coordsToLatLng=li,oi.coordsToLatLngs=ci,oi.latLngToCoords=hi,oi.latLngsToCoords=di,oi.getFeature=fi,oi.asFeature=pi,Qt.mergeOptions({boxZoom:!0});var qi=fn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Dt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){zt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){dt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),tt(),Et(),this._startPoint=this._map.mouseEventToContainerPoint(e),Dt(document,{contextmenu:Gt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=ht("div","leaflet-zoom-box",this._container),gt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new O(this._point,this._startPoint),n=t.getSize();Mt(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(dt(this._box),_t(this._container,"leaflet-crosshair")),nt(),Pt(),zt(document,{contextmenu:Gt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var t=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Qt.addInitHook("addHandler","boxZoom",qi),Qt.mergeOptions({doubleClickZoom:!0});var Zi=fn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),i=t.options.zoomDelta,r=e.originalEvent.shiftKey?n-i:n+i;"center"===t.options.doubleClickZoom?t.setZoom(r):t.setZoomAround(e.containerPoint,r)}});Qt.addInitHook("addHandler","doubleClickZoom",Zi),Qt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Xi=fn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new gn(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}gt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){_t(this._map._container,"leaflet-grab"),_t(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=B(this._map.options.maxBounds);this._offsetLimit=z(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,r=(i-t+n)%e+t-n,a=(i+t+n)%e-t-n,o=Math.abs(r+n)<Math.abs(a+n)?r:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,n=t.options,i=!n.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),i)t.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),a=(this._lastTime-this._times[0])/1e3,o=n.easeLinearity,s=r.multiplyBy(o/a),u=s.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,u),c=s.multiplyBy(l/u),h=l/(n.inertiaDeceleration*o),d=c.multiplyBy(-h/2).round();d.x||d.y?(d=t._limitOffset(d,t.options.maxBounds),M((function(){t.panBy(d,{duration:h,easeLinearity:o,noMoveStart:!0,animate:!0})}))):t.fire("moveend")}}});Qt.addInitHook("addHandler","dragging",Xi),Qt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Yi=fn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Dt(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),zt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,i=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,i=this._panKeys={},r=this.keyCodes;for(t=0,n=r.left.length;t<n;t++)i[r.left[t]]=[-1*e,0];for(t=0,n=r.right.length;t<n;t++)i[r.right[t]]=[e,0];for(t=0,n=r.down.length;t<n;t++)i[r.down[t]]=[0,e];for(t=0,n=r.up.length;t<n;t++)i[r.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,i=this._zoomKeys={},r=this.keyCodes;for(t=0,n=r.zoomIn.length;t<n;t++)i[r.zoomIn[t]]=e;for(t=0,n=r.zoomOut.length;t<n;t++)i[r.zoomOut[t]]=-e},_addHooks:function(){Dt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){zt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,i=this._map;if(n in this._panKeys)i._panAnim&&i._panAnim._inProgress||(t=this._panKeys[n],e.shiftKey&&(t=D(t).multiplyBy(3)),i.panBy(t),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds));else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Gt(e)}}});Qt.addInitHook("addHandler","keyboard",Yi),Qt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ki=fn.extend({addHooks:function(){Dt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){zt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Xt(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var i=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),i),Gt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,a=n?Math.ceil(r/n)*n:r,o=e._limitZoom(t+(this._delta>0?a:-a))-t;this._delta=0,this._startTime=null,o&&("center"===e.options.scrollWheelZoom?e.setZoom(t+o):e.setZoomAround(this._lastMousePos,t+o))}});Qt.addInitHook("addHandler","scrollWheelZoom",Ki);var Ji=600;Qt.mergeOptions({tapHold:Ne.touchNative&&Ne.safari&&Ne.mobile,tapTolerance:15});var Qi=fn.extend({addHooks:function(){Dt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){zt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new R(t.clientX,t.clientY),this._holdTimeout=setTimeout(r((function(){this._cancel(),this._isTapValid()&&(Dt(document,"touchend",Wt),Dt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))}),this),Ji),Dt(document,"touchend touchcancel contextmenu",this._cancel,this),Dt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){zt(document,"touchend",Wt),zt(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),zt(document,"touchend touchcancel contextmenu",this._cancel,this),zt(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new R(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});Qt.addInitHook("addHandler","tapHold",Qi),Qt.mergeOptions({touchZoom:Ne.touch,bounceAtZoomLimits:!0});var er=fn.extend({addHooks:function(){gt(this._map._container,"leaflet-touch-zoom"),Dt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){_t(this._map._container,"leaflet-touch-zoom"),zt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Dt(document,"touchmove",this._onTouchMove,this),Dt(document,"touchend touchcancel",this._onTouchEnd,this),Wt(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]),a=n.distanceTo(i)/this._startDist;if(this._zoom=t.getScaleZoom(a,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&a<1||this._zoom>t.getMaxZoom()&&a>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===a)return}else{var o=n._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===a&&0===o.x&&0===o.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),T(this._animRequest);var s=r(t._move,t,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=M(s,this,!0),Wt(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,T(this._animRequest),zt(document,"touchmove",this._onTouchMove,this),zt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Qt.addInitHook("addHandler","touchZoom",er),Qt.BoxZoom=qi,Qt.DoubleClickZoom=Zi,Qt.Drag=Xi,Qt.Keyboard=Yi,Qt.ScrollWheelZoom=Ki,Qt.TapHold=Qi,Qt.TouchZoom=er,e.Bounds=O,e.Browser=Ne,e.CRS=U,e.Canvas=Fi,e.Circle=ei,e.CircleMarker=Jn,e.Class=E,e.Control=tn,e.DivIcon=Pi,e.DivOverlay=Si,e.DomEvent=Kt,e.DomUtil=Nt,e.Draggable=gn,e.Evented=I,e.FeatureGroup=Vn,e.GeoJSON=oi,e.GridLayer=Ai,e.Handler=fn,e.Icon=Wn,e.ImageOverlay=_i,e.LatLng=$,e.LatLngBounds=F,e.Layer=$n,e.LayerGroup=jn,e.LineUtil=An,e.Map=Qt,e.Marker=Xn,e.Mixin=vn,e.Path=Kn,e.Point=R,e.PolyUtil=Rn,e.Polygon=ri,e.Polyline=ni,e.Popup=Mi,e.PosAnimation=Jt,e.Projection=On,e.Rectangle=Wi,e.Renderer=zi,e.SVG=Vi,e.SVGOverlay=wi,e.TileLayer=Ri,e.Tooltip=Ci,e.Transformation=G,e.Util=C,e.VideoOverlay=bi,e.bind=r,e.bounds=z,e.canvas=Bi,e.circle=ti,e.circleMarker=Qn,e.control=nn,e.divIcon=Li,e.extend=n,e.featureGroup=Hn,e.geoJSON=mi,e.geoJson=gi,e.gridLayer=Ii,e.icon=Gn,e.imageOverlay=yi,e.latLng=j,e.latLngBounds=B,e.layerGroup=Un,e.map=en,e.marker=Yn,e.point=D,e.polygon=ai,e.polyline=ii,e.popup=Ti,e.rectangle=Gi,e.setOptions=f,e.stamp=o,e.svg=Hi,e.svgOverlay=ki,e.tileLayer=Ni,e.tooltip=Ei,e.transformation=q,e.version=t,e.videoOverlay=xi;var tr=window.L;e.noConflict=function(){return window.L=tr,this},window.L=e}(t)},463:function(e,t,n){"use strict";var i=n(791),r=n(296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function v(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function y(e,t,n,i){var r=m.hasOwnProperty(t)?m[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,_);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,_);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,_);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var N=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var O,z=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var B=!1;function $(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var u="\n"+r[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function j(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=$(e.type,!1);case 11:return e=$(e.type.render,!1);case 1:return e=$(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case k:return"Fragment";case w:return"Portal";case M:return"Profiler";case S:return"StrictMode";case P:return"Suspense";case L:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return U(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function J(e,t){K(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Z(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ae(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ce,he=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ve(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ge=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _e(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,ke=null,Se=null;function Me(e){if(e=yr(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=xr(t),we(e.stateNode,e.type,t))}}function Te(e){ke?Se?Se.push(e):Se=[e]:ke=e}function Ce(){if(ke){var e=ke,t=Se;if(Se=ke=null,Me(e),t)for(e=0;e<t.length;e++)Me(t[e])}}function Ee(e,t){return e(t)}function Pe(){}var Le=!1;function Ae(e,t,n){if(Le)return e(t,n);Le=!0;try{return Ee(e,t,n)}finally{Le=!1,(null!==ke||null!==Se)&&(Pe(),Ce())}}function Ie(e,t){var n=e.stateNode;if(null===n)return null;var i=xr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Re=!1;if(c)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Re=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(ce){Re=!1}function De(e,t,n,i,r,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Oe=!1,ze=null,Fe=!1,Be=null,$e={onError:function(e){Oe=!0,ze=e}};function je(e,t,n,i,r,a,o,s,u){Oe=!1,ze=null,De.apply($e,arguments)}function Ue(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ue(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return He(r),e;if(o===i)return He(r),t;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,u=r.child;u;){if(u===n){s=!0,n=r,i=o;break}if(u===i){s=!0,i=r,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,i=r;break}if(u===i){s=!0,i=o,n=r;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var qe=r.unstable_scheduleCallback,Ze=r.unstable_cancelCallback,Xe=r.unstable_shouldYield,Ye=r.unstable_requestPaint,Ke=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,Qe=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var lt=64,ct=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=ht(s):0!==(a&=o)&&(i=ht(a))}else 0!==(o=n&~r)?i=ht(o):0!==a&&(i=ht(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ot(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function _t(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var yt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,kt,St,Mt,Tt=!1,Ct=[],Et=null,Pt=null,Lt=null,At=new Map,It=new Map,Rt=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Lt=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Ot(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=yr(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function zt(e){var t=_r(e.target);if(null!==t){var n=Ue(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void Mt(e.priority,(function(){kt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yr(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);be=i,n.target.dispatchEvent(i),be=null,t.shift()}return!0}function Bt(e,t,n){Ft(e)&&n.delete(t)}function $t(){Tt=!1,null!==Et&&Ft(Et)&&(Et=null),null!==Pt&&Ft(Pt)&&(Pt=null),null!==Lt&&Ft(Lt)&&(Lt=null),At.forEach(Bt),It.forEach(Bt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,$t)))}function Ut(e){function t(t){return jt(t,e)}if(0<Ct.length){jt(Ct[0],e);for(var n=1;n<Ct.length;n++){var i=Ct[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Et&&jt(Et,e),null!==Pt&&jt(Pt,e),null!==Lt&&jt(Lt,e),At.forEach(t),It.forEach(t),n=0;n<Rt.length;n++)(i=Rt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)zt(n),null===n.blockedOn&&Rt.shift()}var Vt=b.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,n,i){var r=yt,a=Vt.transition;Vt.transition=null;try{yt=1,qt(e,t,n,i)}finally{yt=r,Vt.transition=a}}function Gt(e,t,n,i){var r=yt,a=Vt.transition;Vt.transition=null;try{yt=4,qt(e,t,n,i)}finally{yt=r,Vt.transition=a}}function qt(e,t,n,i){if(Ht){var r=Xt(e,t,n,i);if(null===r)Hi(e,t,i,Zt,n),Dt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Et=Ot(Et,e,t,n,i,r),!0;case"dragenter":return Pt=Ot(Pt,e,t,n,i,r),!0;case"mouseover":return Lt=Ot(Lt,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return At.set(a,Ot(At.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,It.set(a,Ot(It.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Dt(e,i),4&t&&-1<Nt.indexOf(e)){for(;null!==r;){var a=yr(r);if(null!==a&&xt(a),null===(a=Xt(e,t,n,i))&&Hi(e,t,i,Zt,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var Zt=null;function Xt(e,t,n,i){if(Zt=null,null!==(e=_r(e=xe(i))))if(null===(t=Ue(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Kt=null,Jt=null,Qt=null;function en(){if(Qt)return Qt;var e,t,n=Jt,i=n.length,r="value"in Kt?Kt.value:Kt.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return Qt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=an(ln),hn=z({},ln,{view:0,detail:0}),dn=an(hn),fn=z({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(fn),vn=an(z({},fn,{dataTransfer:0})),mn=an(z({},hn,{relatedTarget:0})),gn=an(z({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),_n=z({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(_n),bn=an(z({},ln,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function Mn(){return Sn}var Tn=z({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(Tn),En=an(z({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=an(z({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mn})),Ln=an(z({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=z({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),In=an(An),Rn=[9,13,27,32],Nn=c&&"CompositionEvent"in window,Dn=null;c&&"documentMode"in document&&(Dn=document.documentMode);var On=c&&"TextEvent"in window&&!Dn,zn=c&&(!Nn||Dn&&8<Dn&&11>=Dn),Fn=String.fromCharCode(32),Bn=!1;function $n(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Wn(e,t,n,i){Te(i),0<(t=Gi(t,"onChange")).length&&(n=new cn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Gn=null,qn=null;function Zn(e){Fi(e,0)}function Xn(e){if(q(br(e)))return e}function Yn(e,t){if("change"===e)return t}var Kn=!1;if(c){var Jn;if(c){var Qn="oninput"in document;if(!Qn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Qn="function"===typeof ei.oninput}Jn=Qn}else Jn=!1;Kn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Gn&&(Gn.detachEvent("onpropertychange",ni),qn=Gn=null)}function ni(e){if("value"===e.propertyName&&Xn(qn)){var t=[];Wn(t,qn,e,xe(e)),Ae(Zn,t)}}function ii(e,t,n){"focusin"===e?(ti(),qn=n,(Gn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function ai(e,t){if("click"===e)return Xn(t)}function oi(e,t){if("input"===e||"change"===e)return Xn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ui(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!si(e[r],t[r]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ci(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Z((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=ci(n,a);var o=ci(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vi=c&&"documentMode"in document&&11>=document.documentMode,mi=null,gi=null,_i=null,yi=!1;function bi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yi||null==mi||mi!==Z(i)||("selectionStart"in(i=mi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},_i&&ui(_i,i)||(_i=i,0<(i=Gi(gi,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=mi)))}function xi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:xi("Animation","AnimationEnd"),animationiteration:xi("Animation","AnimationIteration"),animationstart:xi("Animation","AnimationStart"),transitionend:xi("Transition","TransitionEnd")},ki={},Si={};function Mi(e){if(ki[e])return ki[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Si)return ki[e]=n[t];return e}c&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ti=Mi("animationend"),Ci=Mi("animationiteration"),Ei=Mi("animationstart"),Pi=Mi("transitionend"),Li=new Map,Ai="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ii(e,t){Li.set(e,t),u(t,[e])}for(var Ri=0;Ri<Ai.length;Ri++){var Ni=Ai[Ri];Ii(Ni.toLowerCase(),"on"+(Ni[0].toUpperCase()+Ni.slice(1)))}Ii(Ti,"onAnimationEnd"),Ii(Ci,"onAnimationIteration"),Ii(Ei,"onAnimationStart"),Ii("dblclick","onDoubleClick"),Ii("focusin","onFocus"),Ii("focusout","onBlur"),Ii(Pi,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Di="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Di));function zi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,s,u,l){if(je.apply(this,arguments),Oe){if(!Oe)throw Error(a(198));var c=ze;Oe=!1,ze=null,Fe||(Fe=!0,Be=c)}}(i,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&r.isPropagationStopped())break e;zi(r,s,l),a=u}else for(o=0;o<i.length;o++){if(u=(s=i[o]).instance,l=s.currentTarget,s=s.listener,u!==a&&r.isPropagationStopped())break e;zi(r,s,l),a=u}}}if(Fe)throw e=Be,Fe=!1,Be=null,e}function Bi(e,t){var n=t[vr];void 0===n&&(n=t[vr]=new Set);var i=e+"__bubble";n.has(i)||(Vi(t,e,2,!1),n.add(i))}function $i(e,t,n){var i=0;t&&(i|=4),Vi(n,e,i,t)}var ji="_reactListening"+Math.random().toString(36).slice(2);function Ui(e){if(!e[ji]){e[ji]=!0,o.forEach((function(t){"selectionchange"!==t&&(Oi.has(t)||$i(t,!1,e),$i(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ji]||(t[ji]=!0,$i("selectionchange",!1,t))}}function Vi(e,t,n,i){switch(Yt(t)){case 1:var r=Wt;break;case 4:r=Gt;break;default:r=qt}n=r.bind(null,t,n,e),r=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===r||8===u.nodeType&&u.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=_r(s)))return;if(5===(u=o.tag)||6===u){i=a=o;continue e}s=s.parentNode}}i=i.return}Ae((function(){var i=a,r=xe(n),o=[];e:{var s=Li.get(e);if(void 0!==s){var u=cn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Cn;break;case"focusin":l="focus",u=mn;break;case"focusout":l="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Pn;break;case Ti:case Ci:case Ei:u=gn;break;case Pi:u=Ln;break;case"scroll":u=dn;break;case"wheel":u=In;break;case"copy":case"cut":case"paste":u=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=En}var c=0!==(4&t),h=!c&&"scroll"===e,d=c?null!==s?s+"Capture":null:s;c=[];for(var f,p=i;null!==p;){var v=(f=p).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==d&&(null!=(v=Ie(p,d))&&c.push(Wi(p,v,f)))),h)break;p=p.return}0<c.length&&(s=new u(s,l,null,n,r),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(l=n.relatedTarget||n.fromElement)||!_r(l)&&!l[pr])&&(u||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=i,null!==(l=(l=n.relatedTarget||n.toElement)?_r(l):null)&&(l!==(h=Ue(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=i),u!==l)){if(c=pn,v="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=En,v="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==u?s:br(u),f=null==l?s:br(l),(s=new c(v,p+"leave",u,n,r)).target=h,s.relatedTarget=f,v=null,_r(r)===i&&((c=new c(d,p+"enter",l,n,r)).target=f,c.relatedTarget=h,v=c),h=v,u&&l)e:{for(d=l,p=0,f=c=u;f;f=qi(f))p++;for(f=0,v=d;v;v=qi(v))f++;for(;0<p-f;)c=qi(c),p--;for(;0<f-p;)d=qi(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=qi(c),d=qi(d)}c=null}else c=null;null!==u&&Zi(o,s,u,c,!1),null!==l&&null!==h&&Zi(o,h,l,c,!0)}if("select"===(u=(s=i?br(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Yn;else if(Hn(s))if(Kn)m=oi;else{m=ri;var g=ii}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ai);switch(m&&(m=m(e,i))?Wn(o,m,n,r):(g&&g(e,s,i),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=i?br(i):window,e){case"focusin":(Hn(g)||"true"===g.contentEditable)&&(mi=g,gi=i,_i=null);break;case"focusout":_i=gi=mi=null;break;case"mousedown":yi=!0;break;case"contextmenu":case"mouseup":case"dragend":yi=!1,bi(o,n,r);break;case"selectionchange":if(vi)break;case"keydown":case"keyup":bi(o,n,r)}var _;if(Nn)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Un?$n(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(zn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==y?"onCompositionEnd"===y&&Un&&(_=en()):(Jt="value"in(Kt=r)?Kt.value:Kt.textContent,Un=!0)),0<(g=Gi(i,y)).length&&(y=new bn(y,e,null,n,r),o.push({event:y,listeners:g}),_?y.data=_:null!==(_=jn(n))&&(y.data=_))),(_=On?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Nn&&$n(e,t)?(e=en(),Qt=Jt=Kt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Gi(i,"onBeforeInput")).length&&(r=new bn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=_))}Fi(o,t)}))}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Ie(e,n))&&i.unshift(Wi(e,a,r)),null!=(a=Ie(e,t))&&i.push(Wi(e,a,r))),e=e.return}return i}function qi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zi(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(u=Ie(n,a))&&o.unshift(Wi(n,u,s)):r||null!=(u=Ie(n,a))&&o.push(Wi(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Xi=/\r\n?/g,Yi=/\u0000|\uFFFD/g;function Ki(e){return("string"===typeof e?e:""+e).replace(Xi,"\n").replace(Yi,"")}function Ji(e,t,n){if(t=Ki(t),Ki(e)!==t&&n)throw Error(a(425))}function Qi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(e){return ar.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function ur(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Ut(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ut(t)}function lr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function cr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,fr="__reactProps$"+hr,pr="__reactContainer$"+hr,vr="__reactEvents$"+hr,mr="__reactListeners$"+hr,gr="__reactHandles$"+hr;function _r(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pr]||n[dr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cr(e);null!==e;){if(n=e[dr])return n;e=cr(e)}return t}n=(e=n).parentNode}return null}function yr(e){return!(e=e[dr]||e[pr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function br(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function xr(e){return e[fr]||null}var wr=[],kr=-1;function Sr(e){return{current:e}}function Mr(e){0>kr||(e.current=wr[kr],wr[kr]=null,kr--)}function Tr(e,t){kr++,wr[kr]=e.current,e.current=t}var Cr={},Er=Sr(Cr),Pr=Sr(!1),Lr=Cr;function Ar(e,t){var n=e.type.contextTypes;if(!n)return Cr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ir(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Rr(){Mr(Pr),Mr(Er)}function Nr(e,t,n){if(Er.current!==Cr)throw Error(a(168));Tr(Er,t),Tr(Pr,n)}function Dr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(a(108,V(e)||"Unknown",r));return z({},n,i)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,Lr=Er.current,Tr(Er,e),Tr(Pr,Pr.current),!0}function zr(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=Dr(e,t,Lr),i.__reactInternalMemoizedMergedChildContext=e,Mr(Pr),Mr(Er),Tr(Er,e)):Mr(Pr),Tr(Pr,n)}var Fr=null,Br=!1,$r=!1;function jr(e){null===Fr?Fr=[e]:Fr.push(e)}function Ur(){if(!$r&&null!==Fr){$r=!0;var e=0,t=yt;try{var n=Fr;for(yt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fr=null,Br=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),qe(Qe,Ur),r}finally{yt=t,$r=!1}}return null}var Vr=[],Hr=0,Wr=null,Gr=0,qr=[],Zr=0,Xr=null,Yr=1,Kr="";function Jr(e,t){Vr[Hr++]=Gr,Vr[Hr++]=Wr,Wr=e,Gr=t}function Qr(e,t,n){qr[Zr++]=Yr,qr[Zr++]=Kr,qr[Zr++]=Xr,Xr=e;var i=Yr;e=Kr;var r=32-ot(i)-1;i&=~(1<<r),n+=1;var a=32-ot(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Yr=1<<32-ot(t)+r|n<<r|i,Kr=a+e}else Yr=1<<a|n<<r|i,Kr=e}function ea(e){null!==e.return&&(Jr(e,1),Qr(e,1,0))}function ta(e){for(;e===Wr;)Wr=Vr[--Hr],Vr[Hr]=null,Gr=Vr[--Hr],Vr[Hr]=null;for(;e===Xr;)Xr=qr[--Zr],qr[Zr]=null,Kr=qr[--Zr],qr[Zr]=null,Yr=qr[--Zr],qr[Zr]=null}var na=null,ia=null,ra=!1,aa=null;function oa(e,t){var n=Al(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ia=lr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ia=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xr?{id:Yr,overflow:Kr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Al(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ia=null,!0);default:return!1}}function ua(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function la(e){if(ra){var t=ia;if(t){var n=t;if(!sa(e,t)){if(ua(e))throw Error(a(418));t=lr(n.nextSibling);var i=na;t&&sa(e,t)?oa(i,n):(e.flags=-4097&e.flags|2,ra=!1,na=e)}}else{if(ua(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,na=e}}}function ca(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ha(e){if(e!==na)return!1;if(!ra)return ca(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=ia)){if(ua(e))throw da(),Error(a(418));for(;t;)oa(e,t),t=lr(t.nextSibling)}if(ca(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ia=lr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ia=null}}else ia=na?lr(e.stateNode.nextSibling):null;return!0}function da(){for(var e=ia;e;)e=lr(e.nextSibling)}function fa(){ia=na=null,ra=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var va=b.ReactCurrentBatchConfig;function ma(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ga=Sr(null),_a=null,ya=null,ba=null;function xa(){ba=ya=_a=null}function wa(e){var t=ga.current;Mr(ga),e._currentValue=t}function ka(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Sa(e,t){_a=e,ba=ya=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Ma(e){var t=e._currentValue;if(ba!==e)if(e={context:e,memoizedValue:t,next:null},null===ya){if(null===_a)throw Error(a(308));ya=e,_a.dependencies={lanes:0,firstContext:e}}else ya=ya.next=e;return t}var Ta=null;function Ca(e){null===Ta?Ta=[e]:Ta.push(e)}function Ea(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ca(t)):(n.next=r.next,r.next=n),t.interleaved=n,Pa(e,i)}function Pa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var La=!1;function Aa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ia(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ra(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Na(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Eu)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Pa(e,n)}return null===(r=i.interleaved)?(t.next=t,Ca(i)):(t.next=r.next,r.next=t),i.interleaved=t,Pa(e,n)}function Da(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,_t(e,n)}}function Oa(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function za(e,t,n,i){var r=e.updateQueue;La=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var u=s,l=u.next;u.next=null,null===o?a=l:o.next=l,o=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var h=r.baseState;for(o=0,c=l=u=null,s=a;;){var d=s.lane,f=s.eventTime;if((i&d)===d){null!==c&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(d=t,f=n,v.tag){case 1:if("function"===typeof(p=v.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=v.payload)?p.call(f,h,d):p)||void 0===d)break e;h=z({},h,d);break e;case 2:La=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=f,u=h):c=c.next=f,o|=d;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(d=s).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===c&&(u=h),r.baseState=u,r.firstBaseUpdate=l,r.lastBaseUpdate=c,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);Ou|=o,e.lanes=o,e.memoizedState=h}}function Fa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Ba=(new i.Component).refs;function $a(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ja={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),a=Ra(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Na(e,a,r))&&(nl(t,e,r,i),Da(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),a=Ra(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Na(e,a,r))&&(nl(t,e,r,i),Da(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),i=tl(e),r=Ra(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Na(e,r,i))&&(nl(t,e,i,n),Da(t,e,i))}};function Ua(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!ui(n,i)||!ui(r,a))}function Va(e,t,n){var i=!1,r=Cr,a=t.contextType;return"object"===typeof a&&null!==a?a=Ma(a):(r=Ir(t)?Lr:Er.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ar(e,r):Cr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ja,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function Ha(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&ja.enqueueReplaceState(t,t.state,null)}function Wa(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Ba,Aa(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Ma(a):(a=Ir(t)?Lr:Er.current,r.context=Ar(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&($a(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&ja.enqueueReplaceState(r,r.state,null),za(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===Ba&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function qa(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Za(e){return(0,e._init)(e._payload)}function Xa(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Rl(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,i){return null===t||6!==t.tag?((t=zl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var a=n.type;return a===k?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===I&&Za(a)===t.type)?((i=r(t,n.props)).ref=Ga(e,t,n),i.return=e,i):((i=Nl(n.type,n.key,n.props,null,e.mode,i)).ref=Ga(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,a){return null===t||7!==t.tag?((t=Dl(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Nl(t.type,t.key,t.props,null,e.mode,n)).ref=Ga(e,null,t),n.return=e,n;case w:return(t=Fl(t,e.mode,n)).return=e,t;case I:return d(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Dl(t,e.mode,n,null)).return=e,t;qa(e,t)}return null}function f(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:u(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===r?l(e,t,n,i):null;case w:return n.key===r?c(e,t,n,i):null;case I:return f(e,t,(r=n._init)(n._payload),i)}if(te(n)||D(n))return null!==r?null:h(e,t,n,i,null);qa(e,n)}return null}function p(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return u(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case x:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case I:return p(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||D(i))return h(t,e=e.get(n)||null,i,r,null);qa(t,i)}return null}function v(r,a,s,u){for(var l=null,c=null,h=a,v=a=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=f(r,h,s[v],u);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(r,h),a=o(g,a,v),null===c?l=g:c.sibling=g,c=g,h=m}if(v===s.length)return n(r,h),ra&&Jr(r,v),l;if(null===h){for(;v<s.length;v++)null!==(h=d(r,s[v],u))&&(a=o(h,a,v),null===c?l=h:c.sibling=h,c=h);return ra&&Jr(r,v),l}for(h=i(r,h);v<s.length;v++)null!==(m=p(h,r,v,s[v],u))&&(e&&null!==m.alternate&&h.delete(null===m.key?v:m.key),a=o(m,a,v),null===c?l=m:c.sibling=m,c=m);return e&&h.forEach((function(e){return t(r,e)})),ra&&Jr(r,v),l}function m(r,s,u,l){var c=D(u);if("function"!==typeof c)throw Error(a(150));if(null==(u=c.call(u)))throw Error(a(151));for(var h=c=null,v=s,m=s=0,g=null,_=u.next();null!==v&&!_.done;m++,_=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var y=f(r,v,_.value,l);if(null===y){null===v&&(v=g);break}e&&v&&null===y.alternate&&t(r,v),s=o(y,s,m),null===h?c=y:h.sibling=y,h=y,v=g}if(_.done)return n(r,v),ra&&Jr(r,m),c;if(null===v){for(;!_.done;m++,_=u.next())null!==(_=d(r,_.value,l))&&(s=o(_,s,m),null===h?c=_:h.sibling=_,h=_);return ra&&Jr(r,m),c}for(v=i(r,v);!_.done;m++,_=u.next())null!==(_=p(v,r,m,_.value,l))&&(e&&null!==_.alternate&&v.delete(null===_.key?m:_.key),s=o(_,s,m),null===h?c=_:h.sibling=_,h=_);return e&&v.forEach((function(e){return t(r,e)})),ra&&Jr(r,m),c}return function e(i,a,o,u){if("object"===typeof o&&null!==o&&o.type===k&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case x:e:{for(var l=o.key,c=a;null!==c;){if(c.key===l){if((l=o.type)===k){if(7===c.tag){n(i,c.sibling),(a=r(c,o.props.children)).return=i,i=a;break e}}else if(c.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===I&&Za(l)===c.type){n(i,c.sibling),(a=r(c,o.props)).ref=Ga(i,c,o),a.return=i,i=a;break e}n(i,c);break}t(i,c),c=c.sibling}o.type===k?((a=Dl(o.props.children,i.mode,u,o.key)).return=i,i=a):((u=Nl(o.type,o.key,o.props,null,i.mode,u)).ref=Ga(i,a,o),u.return=i,i=u)}return s(i);case w:e:{for(c=o.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=Fl(o,i.mode,u)).return=i,i=a}return s(i);case I:return e(i,a,(c=o._init)(o._payload),u)}if(te(o))return v(i,a,o,u);if(D(o))return m(i,a,o,u);qa(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=zl(o,i.mode,u)).return=i,i=a),s(i)):n(i,a)}}var Ya=Xa(!0),Ka=Xa(!1),Ja={},Qa=Sr(Ja),eo=Sr(Ja),to=Sr(Ja);function no(e){if(e===Ja)throw Error(a(174));return e}function io(e,t){switch(Tr(to,t),Tr(eo,e),Tr(Qa,Ja),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Mr(Qa),Tr(Qa,t)}function ro(){Mr(Qa),Mr(eo),Mr(to)}function ao(e){no(to.current);var t=no(Qa.current),n=ue(t,e.type);t!==n&&(Tr(eo,e),Tr(Qa,n))}function oo(e){eo.current===e&&(Mr(Qa),Mr(eo))}var so=Sr(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lo=[];function co(){for(var e=0;e<lo.length;e++)lo[e]._workInProgressVersionPrimary=null;lo.length=0}var ho=b.ReactCurrentDispatcher,fo=b.ReactCurrentBatchConfig,po=0,vo=null,mo=null,go=null,_o=!1,yo=!1,bo=0,xo=0;function wo(){throw Error(a(321))}function ko(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function So(e,t,n,i,r,o){if(po=o,vo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:us,e=n(i,r),yo){o=0;do{if(yo=!1,bo=0,25<=o)throw Error(a(301));o+=1,go=mo=null,t.updateQueue=null,ho.current=ls,e=n(i,r)}while(yo)}if(ho.current=os,t=null!==mo&&null!==mo.next,po=0,go=mo=vo=null,_o=!1,t)throw Error(a(300));return e}function Mo(){var e=0!==bo;return bo=0,e}function To(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?vo.memoizedState=go=e:go=go.next=e,go}function Co(){if(null===mo){var e=vo.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===go?vo.memoizedState:go.next;if(null!==t)go=t,mo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===go?vo.memoizedState=go=e:go=go.next=e}return go}function Eo(e,t){return"function"===typeof t?t(e):t}function Po(e){var t=Co(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=mo,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var u=s=null,l=null,c=o;do{var h=c.lane;if((po&h)===h)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=d,s=i):l=l.next=d,vo.lanes|=h,Ou|=h}c=c.next}while(null!==c&&c!==o);null===l?s=i:l.next=u,si(i,t.memoizedState)||(bs=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,vo.lanes|=o,Ou|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Lo(e){var t=Co(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);si(o,t.memoizedState)||(bs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Ao(){}function Io(e,t){var n=vo,i=Co(),r=t(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,bs=!0),i=i.queue,Ho(Do.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Bo(9,No.bind(null,n,i,r,t),void 0,null),null===Pu)throw Error(a(349));0!==(30&po)||Ro(n,t,r)}return r}function Ro(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function No(e,t,n,i){t.value=n,t.getSnapshot=i,Oo(t)&&zo(e)}function Do(e,t,n){return n((function(){Oo(t)&&zo(e)}))}function Oo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function zo(e){var t=Pa(e,1);null!==t&&nl(t,e,1,-1)}function Fo(e){var t=To();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eo,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,vo,e),[t.memoizedState,e]}function Bo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function $o(){return Co().memoizedState}function jo(e,t,n,i){var r=To();vo.flags|=e,r.memoizedState=Bo(1|t,n,void 0,void 0===i?null:i)}function Uo(e,t,n,i){var r=Co();i=void 0===i?null:i;var a=void 0;if(null!==mo){var o=mo.memoizedState;if(a=o.destroy,null!==i&&ko(i,o.deps))return void(r.memoizedState=Bo(t,n,a,i))}vo.flags|=e,r.memoizedState=Bo(1|t,n,a,i)}function Vo(e,t){return jo(8390656,8,e,t)}function Ho(e,t){return Uo(2048,8,e,t)}function Wo(e,t){return Uo(4,2,e,t)}function Go(e,t){return Uo(4,4,e,t)}function qo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Zo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Uo(4,4,qo.bind(null,t,e),n)}function Xo(){}function Yo(e,t){var n=Co();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ko(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ko(e,t){var n=Co();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ko(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Jo(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(si(n,t)||(n=vt(),vo.lanes|=n,Ou|=n,e.baseState=!0),t)}function Qo(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var i=fo.transition;fo.transition={};try{e(!1),t()}finally{yt=n,fo.transition=i}}function es(){return Co().memoizedState}function ts(e,t,n){var i=tl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},is(e))rs(t,n);else if(null!==(n=Ea(e,t,n,i))){nl(n,e,i,el()),as(n,t,i)}}function ns(e,t,n){var i=tl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(is(e))rs(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var u=t.interleaved;return null===u?(r.next=r,Ca(t)):(r.next=u.next,u.next=r),void(t.interleaved=r)}}catch(l){}null!==(n=Ea(e,t,r,i))&&(nl(n,e,i,r=el()),as(n,t,i))}}function is(e){var t=e.alternate;return e===vo||null!==t&&t===vo}function rs(e,t){yo=_o=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,_t(e,n)}}var os={readContext:Ma,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ma,useCallback:function(e,t){return To().memoizedState=[e,void 0===t?null:t],e},useContext:Ma,useEffect:Vo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,jo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return jo(4194308,4,e,t)},useInsertionEffect:function(e,t){return jo(4,2,e,t)},useMemo:function(e,t){var n=To();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=To();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ts.bind(null,vo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},To().memoizedState=e},useState:Fo,useDebugValue:Xo,useDeferredValue:function(e){return To().memoizedState=e},useTransition:function(){var e=Fo(!1),t=e[0];return e=Qo.bind(null,e[1]),To().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=vo,r=To();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Pu)throw Error(a(349));0!==(30&po)||Ro(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Vo(Do.bind(null,i,o,e),[e]),i.flags|=2048,Bo(9,No.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=To(),t=Pu.identifierPrefix;if(ra){var n=Kr;t=":"+t+"R"+(n=(Yr&~(1<<32-ot(Yr)-1)).toString(32)+n),0<(n=bo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=xo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Ma,useCallback:Yo,useContext:Ma,useEffect:Ho,useImperativeHandle:Zo,useInsertionEffect:Wo,useLayoutEffect:Go,useMemo:Ko,useReducer:Po,useRef:$o,useState:function(){return Po(Eo)},useDebugValue:Xo,useDeferredValue:function(e){return Jo(Co(),mo.memoizedState,e)},useTransition:function(){return[Po(Eo)[0],Co().memoizedState]},useMutableSource:Ao,useSyncExternalStore:Io,useId:es,unstable_isNewReconciler:!1},ls={readContext:Ma,useCallback:Yo,useContext:Ma,useEffect:Ho,useImperativeHandle:Zo,useInsertionEffect:Wo,useLayoutEffect:Go,useMemo:Ko,useReducer:Lo,useRef:$o,useState:function(){return Lo(Eo)},useDebugValue:Xo,useDeferredValue:function(e){var t=Co();return null===mo?t.memoizedState=e:Jo(t,mo.memoizedState,e)},useTransition:function(){return[Lo(Eo)[0],Co().memoizedState]},useMutableSource:Ao,useSyncExternalStore:Io,useId:es,unstable_isNewReconciler:!1};function cs(e,t){try{var n="",i=t;do{n+=j(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Ra(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Hu||(Hu=!0,Wu=i),ds(0,t)},n}function vs(e,t,n){(n=Ra(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ds(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof i&&(null===Gu?Gu=new Set([this]):Gu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new fs;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Ml.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _s(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ra(-1,1)).tag=2,Na(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ys=b.ReactCurrentOwner,bs=!1;function xs(e,t,n,i){t.child=null===e?Ka(t,null,n,i):Ya(t,e.child,n,i)}function ws(e,t,n,i,r){n=n.render;var a=t.ref;return Sa(t,r),i=So(e,t,n,i,a,r),n=Mo(),null===e||bs?(ra&&n&&ea(t),t.flags|=1,xs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Hs(e,t,r))}function ks(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||Il(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nl(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ss(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:ui)(o,i)&&e.ref===t.ref)return Hs(e,t,r)}return t.flags|=1,(e=Rl(a,i)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(ui(a,i)&&e.ref===t.ref){if(bs=!1,t.pendingProps=i=a,0===(e.lanes&r))return t.lanes=e.lanes,Hs(e,t,r);0!==(131072&e.flags)&&(bs=!0)}}return Cs(e,t,n,i,r)}function Ms(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(Ru,Iu),Iu|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tr(Ru,Iu),Iu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Tr(Ru,Iu),Iu|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,Tr(Ru,Iu),Iu|=i;return xs(e,t,r,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,i,r){var a=Ir(n)?Lr:Er.current;return a=Ar(t,a),Sa(t,r),n=So(e,t,n,i,a,r),i=Mo(),null===e||bs?(ra&&i&&ea(t),t.flags|=1,xs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Hs(e,t,r))}function Es(e,t,n,i,r){if(Ir(n)){var a=!0;Or(t)}else a=!1;if(Sa(t,r),null===t.stateNode)Vs(e,t),Va(t,n,i),Wa(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ma(l):l=Ar(t,l=Ir(n)?Lr:Er.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||u!==l)&&Ha(t,o,i,l),La=!1;var d=t.memoizedState;o.state=d,za(t,i,o,r),u=t.memoizedState,s!==i||d!==u||Pr.current||La?("function"===typeof c&&($a(t,n,c,i),u=t.memoizedState),(s=La||Ua(t,n,s,i,d,u,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=u),o.props=i,o.state=u,o.context=l,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,Ia(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ma(t.type,s),o.props=l,h=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ma(u):u=Ar(t,u=Ir(n)?Lr:Er.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==u)&&Ha(t,o,i,u),La=!1,d=t.memoizedState,o.state=d,za(t,i,o,r);var p=t.memoizedState;s!==h||d!==p||Pr.current||La?("function"===typeof f&&($a(t,n,f,i),p=t.memoizedState),(l=La||Ua(t,n,l,i,d,p,u)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=u,i=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Ps(e,t,n,i,a,r)}function Ps(e,t,n,i,r,a){Ts(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&zr(t,n,!1),Hs(e,t,a);i=t.stateNode,ys.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Ya(t,e.child,null,a),t.child=Ya(t,null,s,a)):xs(e,t,s,a),t.memoizedState=i.state,r&&zr(t,n,!0),t.child}function Ls(e){var t=e.stateNode;t.pendingContext?Nr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Nr(0,t.context,!1),io(e,t.containerInfo)}function As(e,t,n,i,r){return fa(),pa(r),t.flags|=256,xs(e,t,n,i),t.child}var Is,Rs,Ns,Ds={dehydrated:null,treeContext:null,retryLane:0};function Os(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var i,r=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((i=u)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Tr(so,1&o),null===e)return la(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=r.children,e=r.fallback,s?(r=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Ol(u,r,0,null),e=Dl(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Os(n),t.memoizedState=Ds,e):Fs(t,u));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,i=hs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Ol({mode:"visible",children:i.children},r,0,null),(o=Dl(o,r,s,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Ya(t,e.child,null,s),t.child.memoizedState=Os(s),t.memoizedState=Ds,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var u=i.dgst;return i=u,Bs(e,t,s,i=hs(o=Error(a(419)),i,void 0))}if(u=0!==(s&e.childLanes),bs||u){if(null!==(i=Pu)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Pa(e,r),nl(i,e,r,-1))}return vl(),Bs(e,t,s,i=hs(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Cl.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ia=lr(r.nextSibling),na=t,ra=!0,aa=null,null!==e&&(qr[Zr++]=Yr,qr[Zr++]=Kr,qr[Zr++]=Xr,Yr=e.id,Kr=e.overflow,Xr=t),(t=Fs(t,i.children)).flags|=4096,t)}(e,t,u,r,i,o,n);if(s){s=r.fallback,u=t.mode,i=(o=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&u)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Rl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Rl(i,s):(s=Dl(s,u,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,u=null===(u=e.child.memoizedState)?Os(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ds,r}return e=(s=e.child).sibling,r=Rl(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Fs(e,t){return(t=Ol({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,i){return null!==i&&pa(i),Ya(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function $s(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),ka(e.return,t,n)}function js(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Us(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(xs(e,t,i.children,n),0!==(2&(i=so.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&$s(e,n,t);else if(19===e.tag)$s(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Tr(so,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),js(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===uo(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}js(t,!0,n,null,a);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Vs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ou|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Rl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function qs(e,t,n){var i=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Ir(t.type)&&Rr(),Gs(t),null;case 3:return i=t.stateNode,ro(),Mr(Pr),Mr(Er),co(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ol(aa),aa=null))),Gs(t),null;case 5:oo(t);var r=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Rs(e,t,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Gs(t),null}if(e=no(Qa.current),ha(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[dr]=t,i[fr]=o,e=0!==(1&t.mode),n){case"dialog":Bi("cancel",i),Bi("close",i);break;case"iframe":case"object":case"embed":Bi("load",i);break;case"video":case"audio":for(r=0;r<Di.length;r++)Bi(Di[r],i);break;case"source":Bi("error",i);break;case"img":case"image":case"link":Bi("error",i),Bi("load",i);break;case"details":Bi("toggle",i);break;case"input":Y(i,o),Bi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Bi("invalid",i);break;case"textarea":re(i,o),Bi("invalid",i)}for(var u in _e(n,o),r=null,o)if(o.hasOwnProperty(u)){var l=o[u];"children"===u?"string"===typeof l?i.textContent!==l&&(!0!==o.suppressHydrationWarning&&Ji(i.textContent,l,e),r=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Ji(i.textContent,l,e),r=["children",""+l]):s.hasOwnProperty(u)&&null!=l&&"onScroll"===u&&Bi("scroll",i)}switch(n){case"input":G(i),Q(i,o,!0);break;case"textarea":G(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Qi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{u=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=u.createElement(n,{is:i.is}):(e=u.createElement(n),"select"===n&&(u=e,i.multiple?u.multiple=!0:i.size&&(u.size=i.size))):e=u.createElementNS(e,n),e[dr]=t,e[fr]=i,Is(e,t),t.stateNode=e;e:{switch(u=ye(n,i),n){case"dialog":Bi("cancel",e),Bi("close",e),r=i;break;case"iframe":case"object":case"embed":Bi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Di.length;r++)Bi(Di[r],e);r=i;break;case"source":Bi("error",e),r=i;break;case"img":case"image":case"link":Bi("error",e),Bi("load",e),r=i;break;case"details":Bi("toggle",e),r=i;break;case"input":Y(e,i),r=X(e,i),Bi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=z({},i,{value:void 0}),Bi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Bi("invalid",e)}for(o in _e(n,r),l=r)if(l.hasOwnProperty(o)){var c=l[o];"style"===o?me(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===o?"string"===typeof c?("textarea"!==n||""!==c)&&de(e,c):"number"===typeof c&&de(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=c&&"onScroll"===o&&Bi("scroll",e):null!=c&&y(e,o,c,u))}switch(n){case"input":G(e),Q(e,i,!1);break;case"textarea":G(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Qi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Ns(0,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(n=no(to.current),no(Qa.current),ha(t)){if(i=t.stateNode,n=t.memoizedProps,i[dr]=t,(o=i.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=t,t.stateNode=i}return Gs(t),null;case 13:if(Mr(so),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==ia&&0!==(1&t.mode)&&0===(128&t.flags))da(),fa(),t.flags|=98560,o=!1;else if(o=ha(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[dr]=t}else fa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),o=!1}else null!==aa&&(ol(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Nu&&(Nu=3):vl())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return ro(),null===e&&Ui(t.stateNode.containerInfo),Gs(t),null;case 10:return wa(t.type._context),Gs(t),null;case 19:if(Mr(so),null===(o=t.memoizedState))return Gs(t),null;if(i=0!==(128&t.flags),null===(u=o.rendering))if(i)Ws(o,!1);else{if(0!==Nu||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,Ws(o,!1),null!==(i=u.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Tr(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Ke()>Uu&&(t.flags|=128,i=!0,Ws(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=uo(u))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ra)return Gs(t),null}else 2*Ke()-o.renderingStartTime>Uu&&1073741824!==n&&(t.flags|=128,i=!0,Ws(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ke(),t.sibling=null,n=so.current,Tr(so,i?1&n|2:1&n),t):(Gs(t),null);case 22:case 23:return hl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Iu)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Zs(e,t){switch(ta(t),t.tag){case 1:return Ir(t.type)&&Rr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),Mr(Pr),Mr(Er),co(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Mr(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));fa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Mr(so),null;case 4:return ro(),null;case 10:return wa(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Is=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Rs=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,no(Qa.current);var a,o=null;switch(n){case"input":r=X(e,r),i=X(e,i),o=[];break;case"select":r=z({},r,{value:void 0}),i=z({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Qi)}for(c in _e(n,i),n=null,r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var u=r[c];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in i){var l=i[c];if(u=null!=r?r[c]:void 0,i.hasOwnProperty(c)&&l!==u&&(null!=l||null!=u))if("style"===c)if(u){for(a in u)!u.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&u[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(o=o||[]).push(c,l)):"children"===c?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Bi("scroll",e),o||u===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Ns=function(e,t,n,i){n!==i&&(t.flags|=4)};var Xs=!1,Ys=!1,Ks="function"===typeof WeakSet?WeakSet:Set,Js=null;function Qs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Sl(e,t,i)}else n.current=null}function eu(e,t,n){try{n()}catch(i){Sl(e,t,i)}}var tu=!1;function nu(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&eu(t,n,a)}r=r.next}while(r!==i)}}function iu(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ru(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[fr],delete t[vr],delete t[mr],delete t[gr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ou(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ou(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Qi));else if(4!==i&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function lu(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var cu=null,hu=!1;function du(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Ys||Qs(n,t);case 6:var i=cu,r=hu;cu=null,du(e,t,n),hu=r,null!==(cu=i)&&(hu?(e=cu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cu.removeChild(n.stateNode));break;case 18:null!==cu&&(hu?(e=cu,n=n.stateNode,8===e.nodeType?ur(e.parentNode,n):1===e.nodeType&&ur(e,n),Ut(e)):ur(cu,n.stateNode));break;case 4:i=cu,r=hu,cu=n.stateNode.containerInfo,hu=!0,du(e,t,n),cu=i,hu=r;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&eu(n,t,o),r=r.next}while(r!==i)}du(e,t,n);break;case 1:if(!Ys&&(Qs(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Sl(n,t,s)}du(e,t,n);break;case 21:du(e,t,n);break;case 22:1&n.mode?(Ys=(i=Ys)||null!==n.memoizedState,du(e,t,n),Ys=i):du(e,t,n);break;default:du(e,t,n)}}function pu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ks),t.forEach((function(t){var i=El.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:cu=u.stateNode,hu=!1;break e;case 3:case 4:cu=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===cu)throw Error(a(160));fu(o,s,r),cu=null,hu=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(c){Sl(r,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mu(t,e),t=t.sibling}function mu(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),gu(e),4&i){try{nu(3,e,e.return),iu(3,e)}catch(m){Sl(e,e.return,m)}try{nu(5,e,e.return)}catch(m){Sl(e,e.return,m)}}break;case 1:vu(t,e),gu(e),512&i&&null!==n&&Qs(n,n.return);break;case 5:if(vu(t,e),gu(e),512&i&&null!==n&&Qs(n,n.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(m){Sl(e,e.return,m)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===u&&"radio"===o.type&&null!=o.name&&K(r,o),ye(u,s);var c=ye(u,o);for(s=0;s<l.length;s+=2){var h=l[s],d=l[s+1];"style"===h?me(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):y(r,h,d,c)}switch(u){case"input":J(r,o);break;case"textarea":ae(r,o);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(r,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(r,!!o.multiple,o.defaultValue,!0):ne(r,!!o.multiple,o.multiple?[]:"",!1))}r[fr]=o}catch(m){Sl(e,e.return,m)}}break;case 6:if(vu(t,e),gu(e),4&i){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(m){Sl(e,e.return,m)}}break;case 3:if(vu(t,e),gu(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(m){Sl(e,e.return,m)}break;case 4:default:vu(t,e),gu(e);break;case 13:vu(t,e),gu(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(ju=Ke())),4&i&&pu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Ys=(c=Ys)||h,vu(t,e),Ys=c):vu(t,e),gu(e),8192&i){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&0!==(1&e.mode))for(Js=e,h=e.child;null!==h;){for(d=Js=h;null!==Js;){switch(p=(f=Js).child,f.tag){case 0:case 11:case 14:case 15:nu(4,f,f.return);break;case 1:Qs(f,f.return);var v=f.stateNode;if("function"===typeof v.componentWillUnmount){i=f,n=f.return;try{t=i,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){Sl(i,n,m)}}break;case 5:Qs(f,f.return);break;case 22:if(null!==f.memoizedState){xu(d);continue}}null!==p?(p.return=f,Js=p):xu(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,c?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=d.stateNode,s=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,u.style.display=ve("display",s))}catch(m){Sl(e,e.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){Sl(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:vu(t,e),gu(e),4&i&&pu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ou(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(de(r,""),i.flags&=-33),lu(e,su(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;uu(e,su(e),o);break;default:throw Error(a(161))}}catch(s){Sl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _u(e,t,n){Js=e,yu(e,t,n)}function yu(e,t,n){for(var i=0!==(1&e.mode);null!==Js;){var r=Js,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Xs;if(!o){var s=r.alternate,u=null!==s&&null!==s.memoizedState||Ys;s=Xs;var l=Ys;if(Xs=o,(Ys=u)&&!l)for(Js=r;null!==Js;)u=(o=Js).child,22===o.tag&&null!==o.memoizedState?wu(r):null!==u?(u.return=o,Js=u):wu(r);for(;null!==a;)Js=a,yu(a,t,n),a=a.sibling;Js=r,Xs=s,Ys=l}bu(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,Js=a):bu(e)}}function bu(e){for(;null!==Js;){var t=Js;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||iu(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ys)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:ma(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Fa(t,o,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fa(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ut(d)}}}break;default:throw Error(a(163))}Ys||512&t.flags&&ru(t)}catch(f){Sl(t,t.return,f)}}if(t===e){Js=null;break}if(null!==(n=t.sibling)){n.return=t.return,Js=n;break}Js=t.return}}function xu(e){for(;null!==Js;){var t=Js;if(t===e){Js=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Js=n;break}Js=t.return}}function wu(e){for(;null!==Js;){var t=Js;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{iu(4,t)}catch(u){Sl(t,n,u)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(u){Sl(t,r,u)}}var a=t.return;try{ru(t)}catch(u){Sl(t,a,u)}break;case 5:var o=t.return;try{ru(t)}catch(u){Sl(t,o,u)}}}catch(u){Sl(t,t.return,u)}if(t===e){Js=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Js=s;break}Js=t.return}}var ku,Su=Math.ceil,Mu=b.ReactCurrentDispatcher,Tu=b.ReactCurrentOwner,Cu=b.ReactCurrentBatchConfig,Eu=0,Pu=null,Lu=null,Au=0,Iu=0,Ru=Sr(0),Nu=0,Du=null,Ou=0,zu=0,Fu=0,Bu=null,$u=null,ju=0,Uu=1/0,Vu=null,Hu=!1,Wu=null,Gu=null,qu=!1,Zu=null,Xu=0,Yu=0,Ku=null,Ju=-1,Qu=0;function el(){return 0!==(6&Eu)?Ke():-1!==Ju?Ju:Ju=Ke()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Eu)&&0!==Au?Au&-Au:null!==va.transition?(0===Qu&&(Qu=vt()),Qu):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nl(e,t,n,i){if(50<Yu)throw Yu=0,Ku=null,Error(a(185));gt(e,n,i),0!==(2&Eu)&&e===Pu||(e===Pu&&(0===(2&Eu)&&(zu|=n),4===Nu&&sl(e,Au)),il(e,i),1===n&&0===Eu&&0===(1&t.mode)&&(Uu=Ke()+500,Br&&Ur()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,u=r[o];-1===u?0!==(s&n)&&0===(s&i)||(r[o]=ft(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=dt(e,e===Pu?Au:0);if(0===i)null!==n&&Ze(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ze(n),1===t)0===e.tag?function(e){Br=!0,jr(e)}(ul.bind(null,e)):jr(ul.bind(null,e)),or((function(){0===(6&Eu)&&Ur()})),n=null;else{switch(bt(i)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Pl(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if(Ju=-1,Qu=0,0!==(6&Eu))throw Error(a(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var i=dt(e,e===Pu?Au:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=ml(e,i);else{t=i;var r=Eu;Eu|=2;var o=pl();for(Pu===e&&Au===t||(Vu=null,Uu=Ke()+500,dl(e,t));;)try{_l();break}catch(u){fl(e,u)}xa(),Mu.current=o,Eu=r,null!==Lu?t=0:(Pu=null,Au=0,t=Nu)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(i=r,t=al(e,r))),1===t)throw n=Du,dl(e,0),sl(e,i),il(e,Ke()),n;if(6===t)sl(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=ml(e,i))&&(0!==(o=pt(e))&&(i=o,t=al(e,o))),1===t))throw n=Du,dl(e,0),sl(e,i),il(e,Ke()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(a(345));case 2:case 5:xl(e,$u,Vu);break;case 3:if(sl(e,i),(130023424&i)===i&&10<(t=ju+500-Ke())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){el(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(xl.bind(null,e,$u,Vu),t);break}xl(e,$u,Vu);break;case 4:if(sl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-ot(i);o=1<<s,(s=t[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Ke()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Su(i/1960))-i)){e.timeoutHandle=ir(xl.bind(null,e,$u,Vu),i);break}xl(e,$u,Vu);break;default:throw Error(a(329))}}}return il(e,Ke()),e.callbackNode===n?rl.bind(null,e):null}function al(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(dl(e,t).flags|=256),2!==(e=ml(e,t))&&(t=$u,$u=n,null!==t&&ol(t)),e}function ol(e){null===$u?$u=e:$u.push.apply($u,e)}function sl(e,t){for(t&=~Fu,t&=~zu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function ul(e){if(0!==(6&Eu))throw Error(a(327));wl();var t=dt(e,0);if(0===(1&t))return il(e,Ke()),null;var n=ml(e,t);if(0!==e.tag&&2===n){var i=pt(e);0!==i&&(t=i,n=al(e,i))}if(1===n)throw n=Du,dl(e,0),sl(e,t),il(e,Ke()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xl(e,$u,Vu),il(e,Ke()),null}function ll(e,t){var n=Eu;Eu|=1;try{return e(t)}finally{0===(Eu=n)&&(Uu=Ke()+500,Br&&Ur())}}function cl(e){null!==Zu&&0===Zu.tag&&0===(6&Eu)&&wl();var t=Eu;Eu|=1;var n=Cu.transition,i=yt;try{if(Cu.transition=null,yt=1,e)return e()}finally{yt=i,Cu.transition=n,0===(6&(Eu=t))&&Ur()}}function hl(){Iu=Ru.current,Mr(Ru)}function dl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Lu)for(n=Lu.return;null!==n;){var i=n;switch(ta(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Rr();break;case 3:ro(),Mr(Pr),Mr(Er),co();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:Mr(so);break;case 10:wa(i.type._context);break;case 22:case 23:hl()}n=n.return}if(Pu=e,Lu=e=Rl(e.current,null),Au=Iu=t,Nu=0,Du=null,Fu=zu=Ou=0,$u=Bu=null,null!==Ta){for(t=0;t<Ta.length;t++)if(null!==(i=(n=Ta[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}Ta=null}return e}function fl(e,t){for(;;){var n=Lu;try{if(xa(),ho.current=os,_o){for(var i=vo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}_o=!1}if(po=0,go=mo=vo=null,yo=!1,bo=0,Tu.current=null,null===n||null===n.return){Nu=1,Du=t,Lu=null;break}e:{var o=e,s=n.return,u=n,l=t;if(t=Au,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,_s(p,s,u,0,t),1&p.mode&&ms(o,c,t),l=c;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(l),t.updateQueue=m}else v.add(l);break e}if(0===(1&t)){ms(o,c,t),vl();break e}l=Error(a(426))}else if(ra&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),_s(g,s,u,0,t),pa(cs(l,u));break e}}o=l=cs(l,u),4!==Nu&&(Nu=2),null===Bu?Bu=[o]:Bu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Oa(o,ps(0,l,t));break e;case 1:u=l;var _=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof _.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Gu||!Gu.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Oa(o,vs(o,u,t));break e}}o=o.return}while(null!==o)}bl(n)}catch(b){t=b,Lu===n&&null!==n&&(Lu=n=n.return);continue}break}}function pl(){var e=Mu.current;return Mu.current=os,null===e?os:e}function vl(){0!==Nu&&3!==Nu&&2!==Nu||(Nu=4),null===Pu||0===(268435455&Ou)&&0===(268435455&zu)||sl(Pu,Au)}function ml(e,t){var n=Eu;Eu|=2;var i=pl();for(Pu===e&&Au===t||(Vu=null,dl(e,t));;)try{gl();break}catch(r){fl(e,r)}if(xa(),Eu=n,Mu.current=i,null!==Lu)throw Error(a(261));return Pu=null,Au=0,Nu}function gl(){for(;null!==Lu;)yl(Lu)}function _l(){for(;null!==Lu&&!Xe();)yl(Lu)}function yl(e){var t=ku(e.alternate,e,Iu);e.memoizedProps=e.pendingProps,null===t?bl(e):Lu=t,Tu.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,Iu)))return void(Lu=n)}else{if(null!==(n=Zs(n,t)))return n.flags&=32767,void(Lu=n);if(null===e)return Nu=6,void(Lu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Lu=t);Lu=t=e}while(null!==t);0===Nu&&(Nu=5)}function xl(e,t,n){var i=yt,r=Cu.transition;try{Cu.transition=null,yt=1,function(e,t,n,i){do{wl()}while(null!==Zu);if(0!==(6&Eu))throw Error(a(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ot(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,o),e===Pu&&(Lu=Pu=null,Au=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qu||(qu=!0,Pl(tt,(function(){return wl(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Cu.transition,Cu.transition=null;var s=yt;yt=1;var u=Eu;Eu|=4,Tu.current=null,function(e,t){if(er=Ht,fi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(x){n=null;break e}var s=0,u=-1,l=-1,c=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==r&&3!==d.nodeType||(u=s+r),d!==o||0!==i&&3!==d.nodeType||(l=s+i),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++c===r&&(u=s),f===o&&++h===i&&(l=s),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Ht=!1,Js=t;null!==Js;)if(e=(t=Js).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Js=e;else for(;null!==Js;){t=Js;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,_=t.stateNode,y=_.getSnapshotBeforeUpdate(t.elementType===t.type?m:ma(t.type,m),g);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(x){Sl(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Js=e;break}Js=t.return}v=tu,tu=!1}(e,n),mu(n,e),pi(tr),Ht=!!er,tr=er=null,e.current=n,_u(n,e,r),Ye(),Eu=u,yt=s,Cu.transition=o}else e.current=n;if(qu&&(qu=!1,Zu=e,Xu=r),0===(o=e.pendingLanes)&&(Gu=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,Ke()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)i((r=t[n]).value,{componentStack:r.stack,digest:r.digest});if(Hu)throw Hu=!1,e=Wu,Wu=null,e;0!==(1&Xu)&&0!==e.tag&&wl(),0!==(1&(o=e.pendingLanes))?e===Ku?Yu++:(Yu=0,Ku=e):Yu=0,Ur()}(e,t,n,i)}finally{Cu.transition=r,yt=i}return null}function wl(){if(null!==Zu){var e=bt(Xu),t=Cu.transition,n=yt;try{if(Cu.transition=null,yt=16>e?16:e,null===Zu)var i=!1;else{if(e=Zu,Zu=null,Xu=0,0!==(6&Eu))throw Error(a(331));var r=Eu;for(Eu|=4,Js=e.current;null!==Js;){var o=Js,s=o.child;if(0!==(16&Js.flags)){var u=o.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for(Js=c;null!==Js;){var h=Js;switch(h.tag){case 0:case 11:case 15:nu(8,h,o)}var d=h.child;if(null!==d)d.return=h,Js=d;else for(;null!==Js;){var f=(h=Js).sibling,p=h.return;if(au(h),h===c){Js=null;break}if(null!==f){f.return=p,Js=f;break}Js=p}}}var v=o.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Js=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Js=s;else e:for(;null!==Js;){if(0!==(2048&(o=Js).flags))switch(o.tag){case 0:case 11:case 15:nu(9,o,o.return)}var _=o.sibling;if(null!==_){_.return=o.return,Js=_;break e}Js=o.return}}var y=e.current;for(Js=y;null!==Js;){var b=(s=Js).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,Js=b;else e:for(s=y;null!==Js;){if(0!==(2048&(u=Js).flags))try{switch(u.tag){case 0:case 11:case 15:iu(9,u)}}catch(w){Sl(u,u.return,w)}if(u===s){Js=null;break e}var x=u.sibling;if(null!==x){x.return=u.return,Js=x;break e}Js=u.return}}if(Eu=r,Ur(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{yt=n,Cu.transition=t}}return!1}function kl(e,t,n){e=Na(e,t=ps(0,t=cs(n,t),1),1),t=el(),null!==e&&(gt(e,1,t),il(e,t))}function Sl(e,t,n){if(3===e.tag)kl(e,e,n);else for(;null!==t;){if(3===t.tag){kl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Gu||!Gu.has(i))){t=Na(t,e=vs(t,e=cs(n,e),1),1),e=el(),null!==t&&(gt(t,1,e),il(t,e));break}}t=t.return}}function Ml(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Pu===e&&(Au&n)===n&&(4===Nu||3===Nu&&(130023424&Au)===Au&&500>Ke()-ju?dl(e,0):Fu|=n),il(e,t)}function Tl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=el();null!==(e=Pa(e,t))&&(gt(e,t,n),il(e,n))}function Cl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tl(e,n)}function El(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(t),Tl(e,n)}function Pl(e,t){return qe(e,t)}function Ll(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Al(e,t,n,i){return new Ll(e,t,n,i)}function Il(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rl(e,t){var n=e.alternate;return null===n?((n=Al(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nl(e,t,n,i,r,o){var s=2;if(i=e,"function"===typeof e)Il(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case k:return Dl(n.children,r,o,t);case S:s=8,r|=8;break;case M:return(e=Al(12,n,t,2|r)).elementType=M,e.lanes=o,e;case P:return(e=Al(13,n,t,r)).elementType=P,e.lanes=o,e;case L:return(e=Al(19,n,t,r)).elementType=L,e.lanes=o,e;case R:return Ol(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case C:s=9;break e;case E:s=11;break e;case A:s=14;break e;case I:s=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Al(s,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Dl(e,t,n,i){return(e=Al(7,e,i,t)).lanes=n,e}function Ol(e,t,n,i){return(e=Al(22,e,i,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function zl(e,t,n){return(e=Al(6,e,null,t)).lanes=n,e}function Fl(e,t,n){return(t=Al(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function $l(e,t,n,i,r,a,o,s,u){return e=new Bl(e,t,n,s,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Al(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Aa(a),e}function jl(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}function Ul(e){if(!e)return Cr;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ir(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ir(n))return Dr(e,n,t)}return t}function Vl(e,t,n,i,r,a,o,s,u){return(e=$l(n,i,!0,e,0,a,0,s,u)).context=Ul(null),n=e.current,(a=Ra(i=el(),r=tl(n))).callback=void 0!==t&&null!==t?t:null,Na(n,a,r),e.current.lanes=r,gt(e,r,i),il(e,i),e}function Hl(e,t,n,i){var r=t.current,a=el(),o=tl(r);return n=Ul(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ra(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Na(r,t,o))&&(nl(e,r,o,a),Da(e,r,o)),o}function Wl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){Gl(e,t),(e=e.alternate)&&Gl(e,t)}ku=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Ls(t),fa();break;case 5:ao(t);break;case 1:Ir(t.type)&&Or(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Tr(ga,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Tr(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?zs(e,t,n):(Tr(so,1&so.current),null!==(e=Hs(e,t,n))?e.sibling:null);Tr(so,1&so.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Us(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Tr(so,so.current),i)break;return null;case 22:case 23:return t.lanes=0,Ms(e,t,n)}return Hs(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,ra&&0!==(1048576&t.flags)&&Qr(t,Gr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Vs(e,t),e=t.pendingProps;var r=Ar(t,Er.current);Sa(t,n),r=So(null,t,i,e,r,n);var o=Mo();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ir(i)?(o=!0,Or(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Aa(t),r.updater=ja,t.stateNode=r,r._reactInternals=t,Wa(t,i,e,n),t=Ps(null,t,i,!0,o,n)):(t.tag=0,ra&&o&&ea(t),xs(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Il(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===A)return 14}return 2}(i),e=ma(i,e),r){case 0:t=Cs(null,t,i,e,n);break e;case 1:t=Es(null,t,i,e,n);break e;case 11:t=ws(null,t,i,e,n);break e;case 14:t=ks(null,t,i,ma(i.type,e),n);break e}throw Error(a(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Cs(e,t,i,r=t.elementType===i?r:ma(i,r),n);case 1:return i=t.type,r=t.pendingProps,Es(e,t,i,r=t.elementType===i?r:ma(i,r),n);case 3:e:{if(Ls(t),null===e)throw Error(a(387));i=t.pendingProps,r=(o=t.memoizedState).element,Ia(e,t),za(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=As(e,t,i,n,r=cs(Error(a(423)),t));break e}if(i!==r){t=As(e,t,i,n,r=cs(Error(a(424)),t));break e}for(ia=lr(t.stateNode.containerInfo.firstChild),na=t,ra=!0,aa=null,n=Ka(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fa(),i===r){t=Hs(e,t,n);break e}xs(e,t,i,n)}t=t.child}return t;case 5:return ao(t),null===e&&la(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==o&&nr(i,o)&&(t.flags|=32),Ts(e,t),xs(e,t,s,n),t.child;case 6:return null===e&&la(t),null;case 13:return zs(e,t,n);case 4:return io(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ya(t,null,i,n):xs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,ws(e,t,i,r=t.elementType===i?r:ma(i,r),n);case 7:return xs(e,t,t.pendingProps,n),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,Tr(ga,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!Pr.current){t=Hs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var l=u.firstContext;null!==l;){if(l.context===i){if(1===o.tag){(l=Ra(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),ka(o.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),ka(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}xs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Sa(t,n),i=i(r=Ma(r)),t.flags|=1,xs(e,t,i,n),t.child;case 14:return r=ma(i=t.type,t.pendingProps),ks(e,t,i,r=ma(i.type,r),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:ma(i,r),Vs(e,t),t.tag=1,Ir(i)?(e=!0,Or(t)):e=!1,Sa(t,n),Va(t,i,r),Wa(t,i,r,n),Ps(null,t,i,!0,e,n);case 19:return Us(e,t,n);case 22:return Ms(e,t,n)}throw Error(a(156,t.tag))};var Zl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function Kl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function ec(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var e=Wl(o);s.call(e)}}Hl(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var e=Wl(o);a.call(e)}}var o=Vl(t,i,e,0,null,!1,0,"",Ql);return e._reactRootContainer=o,e[pr]=o.current,Ui(8===e.nodeType?e.parentNode:e),cl(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Wl(u);s.call(e)}}var u=$l(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=u,e[pr]=u.current,Ui(8===e.nodeType?e.parentNode:e),cl((function(){Hl(t,u,n,i)})),u}(n,t,e,r,i);return Wl(o)}Yl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Hl(e,t,null,null)},Yl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cl((function(){Hl(null,e,null,null)})),t[pr]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&zt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(_t(t,1|n),il(t,Ke()),0===(6&Eu)&&(Uu=Ke()+500,Ur()))}break;case 13:cl((function(){var t=Pa(e,1);if(null!==t){var n=el();nl(t,e,1,n)}})),ql(e,1)}},wt=function(e){if(13===e.tag){var t=Pa(e,134217728);if(null!==t)nl(t,e,134217728,el());ql(e,134217728)}},kt=function(e){if(13===e.tag){var t=tl(e),n=Pa(e,t);if(null!==n)nl(n,e,t,el());ql(e,t)}},St=function(){return yt},Mt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=xr(i);if(!r)throw Error(a(90));q(i),J(i,r)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=ll,Pe=cl;var tc={usingClientEntryPoint:!1,Events:[yr,br,xr,Te,Ce,ll]},nc={findFiberByHostInstance:_r,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ic={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{rt=rc.inject(ic),at=rc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kl(t))throw Error(a(200));return jl(e,t,null,n)},t.createRoot=function(e,t){if(!Kl(e))throw Error(a(299));var n=!1,i="",r=Zl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=$l(e,1,!1,null,0,n,0,i,r),e[pr]=t.current,Ui(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return cl(e)},t.hydrate=function(e,t,n){if(!Jl(t))throw Error(a(200));return ec(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kl(e))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=Zl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vl(t,null,e,1,null!=n?n:null,r,0,o,s),e[pr]=t.current,Ui(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yl(t)},t.render=function(e,t,n){if(!Jl(t))throw Error(a(200));return ec(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jl(e))throw Error(a(40));return!!e._reactRootContainer&&(cl((function(){ec(null,null,e,!1,(function(){e._reactRootContainer=null,e[pr]=null}))})),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Jl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ec(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var i=n(164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:function(e,t,n){"use strict";var i=n(791),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,a={},l=null,c=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!u.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:r,type:e,key:l,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},117:function(e,t){"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function _(){}function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=g.prototype;var b=y.prototype=new _;b.constructor=y,v(b,g.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,k={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,i){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,r)&&!S.hasOwnProperty(r)&&(a[r]=t[r]);var u=arguments.length-2;if(1===u)a.children=i;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===a[r]&&(a[r]=u[r]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:k.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case i:u=!0}}if(u)return o=o(u=e),e=""===a?"."+E(u,0):a,x(o)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),P(o,t,r,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(u=0,a=""===a?".":a+":",x(e))for(var l=0;l<e.length;l++){var c=a+E(s=e[l],l);u+=P(s,t,r,c,o)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=P(s=s.value,t,r,c=a+E(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function L(e,t,n){if(null==e)return e;var i=[],r=0;return P(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function A(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},R={transition:null},N={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:R,ReactCurrentOwner:k};t.Children={map:L,forEach:function(e,t,n){L(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return L(e,(function(){t++})),t},toArray:function(e){return L(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=r,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=v({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=k.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)w.call(t,l)&&!S.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){u=Array(l);for(var c=0;c<l;c++)u[c]=arguments[c+2];r.children=u}return{$$typeof:n,type:e.type,key:a,ref:o,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=M,t.createFactory=function(e){var t=M.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,n){return I.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,n){return I.current.useReducer(e,t,n)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return I.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return I.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<r&&0>a(c,u)?(e[i]=c,e[l]=n,i=l):(e[i]=u,e[s]=n,i=s);else{if(!(l<r&&0>a(c,n)))break e;e[i]=c,e[l]=n,i=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],h=1,d=null,f=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,_="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=i(c);null!==t;){if(null===t.callback)r(c);else{if(!(t.startTime<=e))break;r(c),t.sortIndex=t.expirationTime,n(l,t)}t=i(c)}}function x(e){if(m=!1,b(e),!v)if(null!==i(l))v=!0,R(w);else{var t=i(c);null!==t&&N(x,t.startTime-e)}}function w(e,n){v=!1,m&&(m=!1,_(T),T=-1),p=!0;var a=f;try{for(b(n),d=i(l);null!==d&&(!(d.expirationTime>n)||e&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===i(l)&&r(l),b(n)}else r(l);d=i(l)}if(null!==d)var u=!0;else{var h=i(c);null!==h&&N(x,h.startTime-n),u=!1}return u}finally{d=null,f=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,S=!1,M=null,T=-1,C=5,E=-1;function P(){return!(t.unstable_now()-E<C)}function L(){if(null!==M){var e=t.unstable_now();E=e;var n=!0;try{n=M(!0,e)}finally{n?k():(S=!1,M=null)}}else S=!1}if("function"===typeof y)k=function(){y(L)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,I=A.port2;A.port1.onmessage=L,k=function(){I.postMessage(null)}}else k=function(){g(L,0)};function R(e){M=e,S||(S=!0,k())}function N(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,R(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===i(l)&&e===i(c)&&(m?(_(T),T=-1):m=!0,N(x,a-o))):(e.sortIndex=s,n(l,e),v||p||(v=!0,R(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";var e={};n.r(e),n.d(e,{clientPoint:function(){return li},create:function(){return Nc},creator:function(){return Vt},customEvent:function(){return tn},event:function(){return Xt},local:function(){return Oc},matcher:function(){return nt},mouse:function(){return hi},namespace:function(){return ct},namespaces:function(){return lt},select:function(){return cn},selectAll:function(){return Fc},selection:function(){return ln},selector:function(){return Qe},selectorAll:function(){return tt},style:function(){return xt},touch:function(){return ci},touches:function(){return Bc},window:function(){return gt}});var t,i=n(791),r=n(250);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function o(e,t){if(e){if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(MN){s=!0,r=MN}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},u.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(t||(t={}));var l=function(e){return e};var c="beforeunload",h="popstate";function d(e){e.preventDefault(),e.returnValue=""}function f(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function p(){return Math.random().toString(36).substr(2,8)}function v(e){var t=e.pathname,n=void 0===t?"/":t,i=e.search,r=void 0===i?"":i,a=e.hash,o=void 0===a?"":a;return r&&"?"!==r&&(n+="?"===r.charAt(0)?r:"?"+r),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function m(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}var g=(0,i.createContext)(null);var _=(0,i.createContext)(null);var y=(0,i.createContext)({outlet:null,matches:[]});function b(e,t){if(!e)throw new Error(t)}function x(e,t,n){void 0===n&&(n="/");var i=P(("string"===typeof t?m(t):t).pathname||"/",n);if(null==i)return null;var r=w(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(r);for(var a=null,o=0;null==a&&o<r.length;++o)a=T(r[o],i);return a}function w(e,t,n,i){return void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=""),e.forEach((function(e,r){var a={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(a.relativePath.startsWith(i)||b(!1),a.relativePath=a.relativePath.slice(i.length));var o=L([i,a.relativePath]),s=n.concat(a);e.children&&e.children.length>0&&(!0===e.index&&b(!1),w(e.children,t,s,o)),(null!=e.path||e.index)&&t.push({path:o,score:M(o,e.index),routesMeta:s})})),t}var k=/^:\w+$/,S=function(e){return"*"===e};function M(e,t){var n=e.split("/"),i=n.length;return n.some(S)&&(i+=-2),t&&(i+=2),n.filter((function(e){return!S(e)})).reduce((function(e,t){return e+(k.test(t)?3:""===t?1:10)}),i)}function T(e,t){for(var n=e.routesMeta,i={},r="/",a=[],o=0;o<n.length;++o){var s=n[o],u=o===n.length-1,l="/"===r?t:t.slice(r.length)||"/",c=C({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},l);if(!c)return null;Object.assign(i,c.params);var h=s.route;a.push({params:i,pathname:L([r,c.pathname]),pathnameBase:A(L([r,c.pathnameBase])),route:h}),"/"!==c.pathnameBase&&(r=L([r,c.pathnameBase]))}return a}function C(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);var i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(function(e,t){return i.push(t),"([^\\/]+)"}));e.endsWith("*")?(i.push("*"),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):r+=n?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(r,t?void 0:"i"),i]}(e.path,e.caseSensitive,e.end),i=s(n,2),r=i[0],a=i[1],o=t.match(r);if(!o)return null;var u=o[0],l=u.replace(/(.)\/+$/,"$1"),c=o.slice(1),h=a.reduce((function(e,t,n){if("*"===t){var i=c[n]||"";l=u.slice(0,u.length-i.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return e}}(c[n]||""),e}),{});return{params:h,pathname:u,pathnameBase:l,pattern:e}}function E(e,t,n){var i,r="string"===typeof e?m(e):e,a=""===e||""===r.pathname?"/":r.pathname;if(null==a)i=n;else{var o=t.length-1;if(a.startsWith("..")){for(var s=a.split("/");".."===s[0];)s.shift(),o-=1;r.pathname=s.join("/")}i=o>=0?t[o]:"/"}var u=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?m(e):e,i=n.pathname,r=n.search,a=void 0===r?"":r,o=n.hash,s=void 0===o?"":o,u=i?i.startsWith("/")?i:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(i,t):t;return{pathname:u,search:I(a),hash:R(s)}}(r,i);return a&&"/"!==a&&a.endsWith("/")&&!u.pathname.endsWith("/")&&(u.pathname+="/"),u}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=e.charAt(t.length);return n&&"/"!==n?null:e.slice(t.length)||"/"}var L=function(e){return e.join("/").replace(/\/\/+/g,"/")},A=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},I=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},R=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""};function N(e){D()||b(!1);var t=(0,i.useContext)(g),n=t.basename,r=t.navigator,a=F(e),o=a.hash,s=a.pathname,u=a.search,l=s;if("/"!==n){var c=function(e){return""===e||""===e.pathname?"/":"string"===typeof e?m(e).pathname:e.pathname}(e),h=null!=c&&c.endsWith("/");l="/"===s?n+(h?"/":""):L([n,s])}return r.createHref({pathname:l,search:u,hash:o})}function D(){return null!=(0,i.useContext)(_)}function O(){return D()||b(!1),(0,i.useContext)(_).location}function z(){D()||b(!1);var e=(0,i.useContext)(g),t=e.basename,n=e.navigator,r=(0,i.useContext)(y).matches,a=O().pathname,o=JSON.stringify(r.map((function(e){return e.pathnameBase}))),s=(0,i.useRef)(!1);return(0,i.useEffect)((function(){s.current=!0})),(0,i.useCallback)((function(e,i){if(void 0===i&&(i={}),s.current)if("number"!==typeof e){var r=E(e,JSON.parse(o),a);"/"!==t&&(r.pathname=L([t,r.pathname])),(i.replace?n.replace:n.push)(r,i.state)}else n.go(e)}),[t,n,o,a])}function F(e){var t=(0,i.useContext)(y).matches,n=O().pathname,r=JSON.stringify(t.map((function(e){return e.pathnameBase})));return(0,i.useMemo)((function(){return E(e,JSON.parse(r),n)}),[e,r,n])}function B(e,t){return void 0===t&&(t=[]),null==e?null:e.reduceRight((function(n,r,a){return(0,i.createElement)(y.Provider,{children:void 0!==r.route.element?r.route.element:n,value:{outlet:n,matches:t.concat(e.slice(0,a+1))}})}),null)}function $(e){b(!1)}function j(e){var n=e.basename,r=void 0===n?"/":n,a=e.children,o=void 0===a?null:a,s=e.location,u=e.navigationType,l=void 0===u?t.Pop:u,c=e.navigator,h=e.static,d=void 0!==h&&h;D()&&b(!1);var f=A(r),p=(0,i.useMemo)((function(){return{basename:f,navigator:c,static:d}}),[f,c,d]);"string"===typeof s&&(s=m(s));var v=s,y=v.pathname,x=void 0===y?"/":y,w=v.search,k=void 0===w?"":w,S=v.hash,M=void 0===S?"":S,T=v.state,C=void 0===T?null:T,E=v.key,L=void 0===E?"default":E,I=(0,i.useMemo)((function(){var e=P(x,f);return null==e?null:{pathname:e,search:k,hash:M,state:C,key:L}}),[f,x,k,M,C,L]);return null==I?null:(0,i.createElement)(g.Provider,{value:p},(0,i.createElement)(_.Provider,{children:o,value:{location:I,navigationType:l}}))}function U(e){var t=e.children,n=e.location;return function(e,t){D()||b(!1);var n,r=(0,i.useContext)(y).matches,a=r[r.length-1],o=a?a.params:{},s=(a&&a.pathname,a?a.pathnameBase:"/"),u=(a&&a.route,O());if(t){var l,c="string"===typeof t?m(t):t;"/"===s||(null==(l=c.pathname)?void 0:l.startsWith(s))||b(!1),n=c}else n=u;var h=n.pathname||"/",d=x(e,{pathname:"/"===s?h:h.slice(s.length)||"/"});return B(d&&d.map((function(e){return Object.assign({},e,{params:Object.assign({},o,e.params),pathname:L([s,e.pathname]),pathnameBase:"/"===e.pathnameBase?s:L([s,e.pathnameBase])})})),r)}(V(t),n)}function V(e){var t=[];return i.Children.forEach(e,(function(e){if((0,i.isValidElement)(e))if(e.type!==i.Fragment){e.type!==$&&b(!1);var n={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(n.children=V(e.props.children)),t.push(n)}else t.push.apply(t,V(e.props.children))})),t}function H(){return H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},H.apply(this,arguments)}function W(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}var G=["onClick","reloadDocument","replace","state","target","to"],q=["aria-current","caseSensitive","className","end","style","to","children"];function Z(e){var n=e.basename,r=e.children,a=e.window,o=(0,i.useRef)();null==o.current&&(o.current=function(e){void 0===e&&(e={});var n=e.window,i=void 0===n?document.defaultView:n,r=i.history;function a(){var e=i.location,t=e.pathname,n=e.search,a=e.hash,o=r.state||{};return[o.idx,l({pathname:t,search:n,hash:a,state:o.usr||null,key:o.key||"default"})]}var o=null;i.addEventListener(h,(function(){if(o)x.call(o),o=null;else{var e=t.Pop,n=a(),i=n[0],r=n[1];if(x.length){if(null!=i){var s=_-i;s&&(o={action:e,location:r,retry:function(){C(-1*s)}},C(s))}}else T(e)}}));var s=t.Pop,g=a(),_=g[0],y=g[1],b=f(),x=f();function w(e){return"string"===typeof e?e:v(e)}function k(e,t){return void 0===t&&(t=null),l(u({pathname:y.pathname,hash:"",search:""},"string"===typeof e?m(e):e,{state:t,key:p()}))}function S(e,t){return[{usr:e.state,key:e.key,idx:t},w(e)]}function M(e,t,n){return!x.length||(x.call({action:e,location:t,retry:n}),!1)}function T(e){s=e;var t=a();_=t[0],y=t[1],b.call({action:s,location:y})}function C(e){r.go(e)}null==_&&(_=0,r.replaceState(u({},r.state,{idx:_}),""));var E={get action(){return s},get location(){return y},createHref:w,push:function e(n,a){var o=t.Push,s=k(n,a);if(M(o,s,(function(){e(n,a)}))){var u=S(s,_+1),l=u[0],c=u[1];try{r.pushState(l,"",c)}catch(h){i.location.assign(c)}T(o)}},replace:function e(n,i){var a=t.Replace,o=k(n,i);if(M(a,o,(function(){e(n,i)}))){var s=S(o,_),u=s[0],l=s[1];r.replaceState(u,"",l),T(a)}},go:C,back:function(){C(-1)},forward:function(){C(1)},listen:function(e){return b.push(e)},block:function(e){var t=x.push(e);return 1===x.length&&i.addEventListener(c,d),function(){t(),x.length||i.removeEventListener(c,d)}}};return E}({window:a}));var g=o.current,_=s((0,i.useState)({action:g.action,location:g.location}),2),y=_[0],b=_[1];return(0,i.useLayoutEffect)((function(){return g.listen(b)}),[g]),(0,i.createElement)(j,{basename:n,children:r,location:y.location,navigationType:y.action,navigator:g})}var X=(0,i.forwardRef)((function(e,t){var n=e.onClick,r=e.reloadDocument,a=e.replace,o=void 0!==a&&a,s=e.state,u=e.target,l=e.to,c=W(e,G),h=N(l),d=function(e,t){var n=void 0===t?{}:t,r=n.target,a=n.replace,o=n.state,s=z(),u=O(),l=F(e);return(0,i.useCallback)((function(t){if(0===t.button&&(!r||"_self"===r)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(t)){t.preventDefault();var n=!!a||v(u)===v(l);s(e,{replace:n,state:o})}}),[u,s,l,a,o,r,e])}(l,{replace:o,state:s,target:u});return(0,i.createElement)("a",H({},c,{href:h,onClick:function(e){n&&n(e),e.defaultPrevented||r||d(e)},ref:t,target:u}))}));var Y=(0,i.forwardRef)((function(e,t){var n=e["aria-current"],r=void 0===n?"page":n,a=e.caseSensitive,o=void 0!==a&&a,s=e.className,u=void 0===s?"":s,l=e.end,c=void 0!==l&&l,h=e.style,d=e.to,f=e.children,p=W(e,q),v=O(),m=F(d),g=v.pathname,_=m.pathname;o||(g=g.toLowerCase(),_=_.toLowerCase());var y,b=g===_||!c&&g.startsWith(_)&&"/"===g.charAt(_.length),x=b?r:void 0;y="function"===typeof u?u({isActive:b}):[u,b?"active":null].filter(Boolean).join(" ");var w="function"===typeof h?h({isActive:b}):h;return(0,i.createElement)(X,H({},p,{"aria-current":x,className:y,ref:t,style:w,to:d}),"function"===typeof f?f({isActive:b}):f)}));var K=function(){return K=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},K.apply(this,arguments)};var J="",Q=null,ee=null,te=null;function ne(){J="",null!==Q&&Q.disconnect(),null!==ee&&(window.clearTimeout(ee),ee=null)}function ie(e){return["BUTTON","INPUT","SELECT","TEXTAREA"].includes(e.tagName)&&!e.hasAttribute("disabled")||["A","AREA"].includes(e.tagName)&&e.hasAttribute("href")}function re(){var e=null;if("#"===J)e=document.body;else{var t=J.replace("#","");null===(e=document.getElementById(t))&&"#top"===J&&(e=document.body)}if(null!==e){te(e);var n=e.getAttribute("tabindex");return null!==n||ie(e)||e.setAttribute("tabindex",-1),e.focus({preventScroll:!0}),null!==n||ie(e)||(e.blur(),e.removeAttribute("tabindex")),ne(),!0}return!1}function ae(e){return i.forwardRef((function(t,n){var r="";"string"===typeof t.to&&t.to.includes("#")?r="#"+t.to.split("#").slice(1).join("#"):"object"===typeof t.to&&"string"===typeof t.to.hash&&(r=t.to.hash);var a={};e===Y&&(a.isActive=function(e,t){return e&&e.isExact&&t.hash===r});var o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["scroll","smooth","timeout","elementId"]);return i.createElement(e,K({},a,o,{onClick:function(e){ne(),J=t.elementId?"#"+t.elementId:r,t.onClick&&t.onClick(e),""===J||e.defaultPrevented||0!==e.button||t.target&&"_self"!==t.target||e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(te=t.scroll||function(e){return t.smooth?e.scrollIntoView({behavior:"smooth"}):e.scrollIntoView()},function(e){window.setTimeout((function(){!1===re()&&(null===Q&&(Q=new MutationObserver(re)),Q.observe(document,{attributes:!0,childList:!0,subtree:!0}),ee=window.setTimeout((function(){ne()}),e||1e4))}),0)}(t.timeout))},ref:n}),t.children)}))}var oe=ae(X),se=(ae(Y),n(184)),ue=["btn--primary","btn--outline","btn--clear","btn--gray"],le=["btn--medium","btn--large"],ce=function(e){var t=e.children,n=e.type,i=e.onClick,r=e.buttonStyle,a=e.buttonSize,o=ue.includes(r)?r:ue[0],s=le.includes(a)?a:le[0];return(0,se.jsx)(X,{to:"/application",className:"btn-mobile",children:(0,se.jsx)("button",{className:"btn ".concat(o," ").concat(s),onClick:i,type:n,children:t})})};var he=function(){var e=s((0,i.useState)(!1),2),t=e[0],n=e[1],r=s((0,i.useState)(!0),2),a=r[0],o=r[1],u=function(){return n(!1)},l=function(){window.innerWidth<=960?o(!1):o(!0)};return(0,i.useEffect)((function(){l()}),[]),window.addEventListener("resize",l),(0,se.jsx)(se.Fragment,{children:(0,se.jsx)("nav",{className:"navbar",children:(0,se.jsxs)("div",{className:"navbar-container",children:[(0,se.jsx)(oe,{to:"/",className:"navbar-logo",onClick:u,children:"HSPA"}),(0,se.jsx)("div",{className:"menu-icon",onClick:function(){return n(!t)},children:(0,se.jsx)("i",{className:t?"fas fa-times":"fas fa-bars"})}),(0,se.jsxs)("ul",{className:t?"nav-menu active":"nav-menu",children:[(0,se.jsx)("li",{className:"nav-item",children:(0,se.jsx)(oe,{smooth:!0,to:"/#home",className:"nav-links",onClick:u,children:"Home"})}),(0,se.jsx)("li",{className:"nav-item",children:(0,se.jsx)(oe,{smooth:!0,to:"/application",className:"nav-links",onClick:u,children:"Application"})}),(0,se.jsx)("li",{className:"nav-item",children:(0,se.jsx)(oe,{smooth:!0,to:"/#documentation",className:"nav-links",onClick:u,children:"Documentation"})})]}),a&&(0,se.jsx)(ce,{buttonStyle:"btn--outline",children:"GET STARTED"})]})})})};var de=function(){var e=s((0,i.useState)(0),2),t=(e[0],e[1]),n=function(){return t(window.pageYOffset)};return(0,i.useEffect)((function(){return window.addEventListener("scroll",n),function(){return window.removeEventListener("scroll",n)}}),[]),(0,se.jsx)("div",{className:"hero-background",children:(0,se.jsxs)("div",{className:"hero-container",children:[(0,se.jsx)("h1",{children:"Hillside Street"}),(0,se.jsx)("p",{children:"Prioritization Application"}),(0,se.jsxs)("div",{className:"description-box",children:[(0,se.jsx)("div",{className:"textbox",children:"This application shows prioritized streets in terms of capital improvement given user input data and boundaries"}),(0,se.jsx)("div",{className:"hero-btns",children:(0,se.jsx)(ce,{className:"btns",buttonStyle:"btn--clear",buttonSize:"btn--large",children:"START"})})]})]})})};var fe=function(){return(0,se.jsx)(se.Fragment,{children:(0,se.jsx)("div",{className:"backgroundContainer",children:(0,se.jsxs)("div",{className:"backgroundBox",children:[(0,se.jsx)("h1",{children:"Background"}),(0,se.jsx)("p",{children:"This web application is developed as part of the LA Streets project by City of Los Angeles and UCLA. The following documentation provides background information on the Hillside Street Prioritization Application (HSPA). The LA Streets project aims for maximizing capital improvement by repairing and upgrading streets in the Los Angeles Hillside areas. In the first stage of the project, publicly available data is used to prioritize streets by a combination of rating and importance. The web application enables the user to give weights to specific options and filter out desired streets."})]})})})};var pe=function(){return(0,se.jsx)("div",{className:"docContainer",children:(0,se.jsxs)("div",{className:"docBox",children:[(0,se.jsx)("h1",{children:"Documentation"}),(0,se.jsx)("p",{children:"Following the data crawling and processing will be explained:"}),(0,se.jsx)("h2",{children:"Condition Rating"}),(0,se.jsx)("p",{children:'Condition rating is performed by comparing the condition and features of the streets with the required conditions and features, based on the street designation. The required features based on designation are taken from "City of Los Angeles Complete Street Design Guide". The following images show the standard design for local streets and local hillside streets in Los Angeles.'}),(0,se.jsx)("br",{}),(0,se.jsx)("h4",{children:"Standard Design:"}),(0,se.jsxs)("div",{className:"streetDesign",children:[(0,se.jsx)("h1",{children:"Hillside Local"}),(0,se.jsxs)("div",{className:"designInfo",children:[(0,se.jsx)("img",{src:"/LAStreetimages/Hillside Local Design.png",alt:"Hillside Local Design",width:"350px"}),(0,se.jsxs)("p",{children:["Roadway Width: 36 ft. min ",(0,se.jsx)("br",{}),"Right-of-Way Width: 44ft",(0,se.jsx)("br",{}),"On-Street Parking: both sides of street",(0,se.jsx)("br",{}),"Target Operating Speed: 15mph"]})]})]}),(0,se.jsxs)("div",{className:"streetDesign",children:[(0,se.jsx)("h1",{children:"Local Street Standard"}),(0,se.jsxs)("div",{className:"designInfo",children:[(0,se.jsx)("img",{src:"/LAStreetimages/Local Street Design.png",alt:"Local Street Design",width:"270px"}),(0,se.jsxs)("p",{children:["Roadway Width: 36 ft.",(0,se.jsx)("br",{}),"Right-of-Way Width: 60ft",(0,se.jsx)("br",{}),"Typical Number of Lanes: 1 lane in each direction",(0,se.jsx)("br",{}),"Typical Sidewalk/Border Width: 12 ft",(0,se.jsx)("br",{}),"Target Operating Speed: 20mph"]})]})]}),(0,se.jsx)("br",{}),(0,se.jsx)("h2",{children:"Condition Data Requisition"}),(0,se.jsx)("p",{children:"The data for describing the actual street condition is mainly pulled from four different GIS databases."}),(0,se.jsx)("div",{className:"greyBox",style:{marginLeft:"70px"},children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:"StreetsLA GeoHub Street Inventory as a base dataset"}),(0,se.jsx)("li",{children:"StreetsLA GeoHub PCI for adding PCI information"}),(0,se.jsx)("li",{children:"Street Centerline (data.lacity.org) for adding designation information"}),(0,se.jsx)("li",{children:"Hillside Ordinance Geohub for geometric information of hillside ordinance layers"})]})}),(0,se.jsx)("br",{}),(0,se.jsxs)("div",{className:"designInfo",children:[(0,se.jsx)("img",{src:"/LAStreetimages/Hillside Ordinance Layer.png",alt:"Hillside Ordinance Layer",width:"27%"}),(0,se.jsx)("p",{children:"As the project is only focusing on streets located in the Hillside Ordinance layer, only these streets will be analyzed in terms of a condition rating. The Hillside Ordinance layer can be viewed in the following figure."})]}),(0,se.jsx)("p1",{children:"Hillside Ordinance layer on Los Angeles GeouHub [2]"}),(0,se.jsx)("br",{}),(0,se.jsx)("h3",{children:"Dataset fusion is performed by matching the SECT_IDs across the GIS databases. The following GIS databases are used to receive feature information for all sections:"}),(0,se.jsxs)("div",{className:"thingsInColumn",children:[(0,se.jsx)("div",{className:"greyBox",children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:"Sidewalks Geohub for Sidewalk existence"}),(0,se.jsx)("li",{children:"Curbs Geohub for curb existence"})]})}),(0,se.jsx)("img",{src:"/LAStreetimages/Sidewalk Layers.png",alt:"Sidewalk Layers",width:"500px"}),(0,se.jsx)("p1",{children:"Sidewalk layers on Los Angeles GeoHub [2]"})]}),(0,se.jsx)("br",{}),(0,se.jsx)("h3",{children:"As the sidewalks and curbs are not allocated to any SECT_ID, a manual allocation has to be performed. In the GIS databases, the street geometry is described using line elements, whereas the sidewalk and curb geometries are described as polygon elements. The allocation process for sidewalks/curbs to street segments is described as follows:"}),(0,se.jsx)("div",{className:"greenBox",children:(0,se.jsxs)("ul",{children:[(0,se.jsx)("li",{children:"Interpolate additional points in 1 m distance for all street geometries"}),(0,se.jsx)("li",{children:"Build a KD-tree of all the street points and keep knowledge of associated SECT IDs"}),(0,se.jsx)("li",{children:"For every curb or sidewalk polygon corner point, search the closest street point"}),(0,se.jsx)("li",{children:"If the street points are closer than 0.75 x street width, associate the point to the SECT ID"})]})}),(0,se.jsx)("h3",{children:"This procedure makes sure that every curb/sidewalk is matched to a certain SECT_ID, if the closest point of the SECT_ID is not too far away. If curbs and sidewalks are missing in the GIS database, they will not be accounted for in this procedure."}),(0,se.jsx)("h3",{children:"In communication with CityLA, the following required street widths have been set:"}),(0,se.jsxs)("table",{id:"myTable",children:[(0,se.jsxs)("tr",{children:[(0,se.jsx)("th",{children:"Designation"}),(0,se.jsx)("th",{children:"Required Width"}),(0,se.jsx)("th",{children:"Designation"}),(0,se.jsx)("th",{children:"Required Width"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Avenue I"}),(0,se.jsx)("td",{children:"70"}),(0,se.jsx)("td",{children:"Modified Avenue III"}),(0,se.jsx)("td",{children:"46"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Avenue II"}),(0,se.jsx)("td",{children:"56"}),(0,se.jsx)("td",{children:"Modified Boulevard II"}),(0,se.jsx)("td",{children:"80"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Avenue III"}),(0,se.jsx)("td",{children:"46"}),(0,se.jsx)("td",{children:"Modified Collector"}),(0,se.jsx)("td",{children:"40"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Boulevard I"}),(0,se.jsx)("td",{children:"100"}),(0,se.jsx)("td",{children:"Modified Local Street Standard"}),(0,se.jsx)("td",{children:"28"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Boulevard II"}),(0,se.jsx)("td",{children:"80"}),(0,se.jsx)("td",{children:"Modified Scenic Arterial Mountain"}),(0,se.jsx)("td",{children:"28"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Collector"}),(0,se.jsx)("td",{children:"40"}),(0,se.jsx)("td",{children:"Mountain Collector"}),(0,se.jsx)("td",{children:"40"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Hillside Collector"}),(0,se.jsx)("td",{children:"40"}),(0,se.jsx)("td",{children:"None"}),(0,se.jsx)("td",{children:"28"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Local Street - Standard"}),(0,se.jsx)("td",{children:"28"}),(0,se.jsx)("td",{children:"Private"}),(0,se.jsx)("td",{children:"20"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Modified Avenue I"}),(0,se.jsx)("td",{children:"70"}),(0,se.jsx)("td",{children:"Scenic Parkway"}),(0,se.jsx)("td",{children:"20"})]}),(0,se.jsxs)("tr",{children:[(0,se.jsx)("td",{children:"Modified Avenue II"}),(0,se.jsx)("td",{children:"56"}),(0,se.jsx)("td",{children:"Unidentified"}),(0,se.jsx)("td",{children:"28"})]})]}),(0,se.jsx)("h2",{children:"Sub Condition Rating"}),(0,se.jsx)("p",{children:"The rating process contains 4 different categories: Width, PCI, Sidewalks, and Curbs. For every category, a score from 0.1 to 1 is assigned."}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("p",{children:"Following, the four sub-rating categories are described:"}),(0,se.jsxs)("div",{className:"conditionRating",children:[(0,se.jsxs)("div",{className:"rating",children:[(0,se.jsx)("div",{className:"ratingTitle",children:"Width Rating"}),(0,se.jsx)("div",{className:"ratingDescription",children:"The width rating is dependent on the ratio between the actual street width and the designated street width, which can be seen in the table above. If the ratio is below 0.5, the street section gets the minimum sub-score of 0.1. If the actual width is equal to or greater than the designated width, the street section gets the maximum score of 1.0. The scores in between are connected by a second-order polynomial."})]}),(0,se.jsxs)("div",{className:"rating",children:[(0,se.jsx)("div",{className:"ratingTitle",children:"Curb and Sidewalk Rating"}),(0,se.jsx)("div",{className:"ratingDescription",children:"The curb and sidewalk rating is dependent on the ratio of designated curb or sidewalk points to section length. Street sections get a top score of 1.0 if the desired ratio is equal to or above the average ratio of all sections, excluding the sections with 0 designated sidewalks or curbs. Street sections get the minimum score of 0.1 if the ratio is 0. The scores in between are connected by a second-order polynomial."})]}),(0,se.jsxs)("div",{className:"rating",children:[(0,se.jsx)("div",{className:"ratingTitle",children:"PCI Rating"}),(0,se.jsx)("div",{className:"ratingDescription",children:"The PCI rating can be described as the square of the PCI divided by 100."})]}),(0,se.jsx)("br",{}),(0,se.jsx)("h3",{children:"The following figure shows the rating curves for all sub-ratings except PCI:"}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("img",{src:"/LAStreetimages/Sub-ratings.jpg",alt:"Sub-Ratings for Street Width, Sidewalk, and Curb",width:"80%"})]})]})})};var ve=function(){var e=s((0,i.useState)(0),2),t=(e[0],e[1]),n=function(){return t(window.pageYOffset)};return(0,i.useEffect)((function(){return window.addEventListener("scroll",n),function(){return window.removeEventListener("scroll",n)}}),[]),(0,se.jsxs)("div",{children:[(0,se.jsx)("div",{className:"section",id:"home",children:(0,se.jsx)(de,{})}),(0,se.jsx)("div",{className:"section",id:"infoBox",children:(0,se.jsx)(fe,{})}),(0,se.jsx)("div",{className:"section",id:"documentation",children:(0,se.jsx)(pe,{})})]})};function me(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ge(e){var t;return 1===e.length&&(t=e,e=function(e,n){return me(t(e),n)}),{left:function(t,n,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}var _e=ge(me),ye=_e.right,be=(_e.left,ye),xe=Array.prototype,we=(xe.slice,xe.map,Math.sqrt(50)),ke=Math.sqrt(10),Se=Math.sqrt(2);function Me(e,t,n){var i,r,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(o=Te(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(r=Math.ceil(t-e+1));++s<r;)a[s]=(e+s)*o;else for(e=Math.floor(e*o),t=Math.ceil(t*o),a=new Array(r=Math.ceil(e-t+1));++s<r;)a[s]=(e-s)/o;return i&&a.reverse(),a}function Te(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=we?10:a>=ke?5:a>=Se?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=we?10:a>=ke?5:a>=Se?2:1)}function Ce(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=we?r*=10:a>=ke?r*=5:a>=Se&&(r*=2),t<e?-r:r}function Ee(e,t){var n,i,r=e.length,a=-1;if(null==t){for(;++a<r;)if(null!=(n=e[a])&&n>=n)for(i=n;++a<r;)null!=(n=e[a])&&n>i&&(i=n)}else for(;++a<r;)if(null!=(n=t(e[a],a,e))&&n>=n)for(i=n;++a<r;)null!=(n=t(e[a],a,e))&&n>i&&(i=n);return i}function Pe(e){for(var t,n,i,r=e.length,a=-1,o=0;++a<r;)o+=e[a].length;for(n=new Array(o);--r>=0;)for(t=(i=e[r]).length;--t>=0;)n[--o]=i[t];return n}function Le(e,t){var n,i,r=e.length,a=-1;if(null==t){for(;++a<r;)if(null!=(n=e[a])&&n>=n)for(i=n;++a<r;)null!=(n=e[a])&&i>n&&(i=n)}else for(;++a<r;)if(null!=(n=t(e[a],a,e))&&n>=n)for(i=n;++a<r;)null!=(n=t(e[a],a,e))&&i>n&&(i=n);return i}function Ae(e,t){if(n=e.length){var n,i,r=0,a=0,o=e[a];for(null==t&&(t=me);++r<n;)(t(i=e[r],o)<0||0!==t(o,o))&&(o=i,a=r);return 0===t(o,o)?a:void 0}}var Ie=Array.prototype.slice;function Re(e){return e}var Ne=1e-6;function De(e){return"translate("+(e+.5)+",0)"}function Oe(e){return"translate(0,"+(e+.5)+")"}function ze(e){return function(t){return+e(t)}}function Fe(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(n){return+e(n)+t}}function Be(){return!this.__axis}function $e(e,t){var n=[],i=null,r=null,a=6,o=6,s=3,u=1===e||4===e?-1:1,l=4===e||2===e?"x":"y",c=1===e||3===e?De:Oe;function h(h){var d=null==i?t.ticks?t.ticks.apply(t,n):t.domain():i,f=null==r?t.tickFormat?t.tickFormat.apply(t,n):Re:r,p=Math.max(a,0)+s,v=t.range(),m=+v[0]+.5,g=+v[v.length-1]+.5,_=(t.bandwidth?Fe:ze)(t.copy()),y=h.selection?h.selection():h,b=y.selectAll(".domain").data([null]),x=y.selectAll(".tick").data(d,t).order(),w=x.exit(),k=x.enter().append("g").attr("class","tick"),S=x.select("line"),M=x.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(k),S=S.merge(k.append("line").attr("stroke","currentColor").attr(l+"2",u*a)),M=M.merge(k.append("text").attr("fill","currentColor").attr(l,u*p).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),h!==y&&(b=b.transition(h),x=x.transition(h),S=S.transition(h),M=M.transition(h),w=w.transition(h).attr("opacity",Ne).attr("transform",(function(e){return isFinite(e=_(e))?c(e):this.getAttribute("transform")})),k.attr("opacity",Ne).attr("transform",(function(e){var t=this.parentNode.__axis;return c(t&&isFinite(t=t(e))?t:_(e))}))),w.remove(),b.attr("d",4===e||2==e?o?"M"+u*o+","+m+"H0.5V"+g+"H"+u*o:"M0.5,"+m+"V"+g:o?"M"+m+","+u*o+"V0.5H"+g+"V"+u*o:"M"+m+",0.5H"+g),x.attr("opacity",1).attr("transform",(function(e){return c(_(e))})),S.attr(l+"2",u*a),M.attr(l,u*p).text(f),y.filter(Be).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),y.each((function(){this.__axis=_}))}return h.scale=function(e){return arguments.length?(t=e,h):t},h.ticks=function(){return n=Ie.call(arguments),h},h.tickArguments=function(e){return arguments.length?(n=null==e?[]:Ie.call(e),h):n.slice()},h.tickValues=function(e){return arguments.length?(i=null==e?null:Ie.call(e),h):i&&i.slice()},h.tickFormat=function(e){return arguments.length?(r=e,h):r},h.tickSize=function(e){return arguments.length?(a=o=+e,h):a},h.tickSizeInner=function(e){return arguments.length?(a=+e,h):a},h.tickSizeOuter=function(e){return arguments.length?(o=+e,h):o},h.tickPadding=function(e){return arguments.length?(s=+e,h):s},h}function je(e){return $e(1,e)}function Ue(e){return $e(2,e)}function Ve(e){return $e(3,e)}function He(e){return $e(4,e)}var We={value:function(){}};function Ge(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new qe(i)}function qe(e){this._=e}function Ze(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function Xe(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function Ye(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=We,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}qe.prototype=Ge.prototype={constructor:qe,on:function(e,t){var n,i=this._,r=Ze(e+"",i),a=-1,o=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=r[a]).type)i[n]=Ye(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Ye(i[n],e.name,null);return this}for(;++a<o;)if((n=(e=r[a]).type)&&(n=Xe(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new qe(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(i=this._[e]).length;a<n;++a)i[a].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};var Ke=Ge;function Je(){}function Qe(e){return null==e?Je:function(){return this.querySelector(e)}}function et(){return[]}function tt(e){return null==e?et:function(){return this.querySelectorAll(e)}}function nt(e){return function(){return this.matches(e)}}function it(e){return new Array(e.length)}function rt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}rt.prototype={constructor:rt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function at(e,t,n,i,r,a){for(var o,s=0,u=t.length,l=a.length;s<l;++s)(o=t[s])?(o.__data__=a[s],i[s]=o):n[s]=new rt(e,a[s]);for(;s<u;++s)(o=t[s])&&(r[s]=o)}function ot(e,t,n,i,r,a,o){var s,u,l,c={},h=t.length,d=a.length,f=new Array(h);for(s=0;s<h;++s)(u=t[s])&&(f[s]=l="$"+o.call(u,u.__data__,s,t),l in c?r[s]=u:c[l]=u);for(s=0;s<d;++s)(u=c[l="$"+o.call(e,a[s],s,a)])?(i[s]=u,u.__data__=a[s],c[l]=null):n[s]=new rt(e,a[s]);for(s=0;s<h;++s)(u=t[s])&&c[f[s]]===u&&(r[s]=u)}function st(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var ut="http://www.w3.org/1999/xhtml",lt={svg:"http://www.w3.org/2000/svg",xhtml:ut,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ct(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),lt.hasOwnProperty(t)?{space:lt[t],local:e}:e}function ht(e){return function(){this.removeAttribute(e)}}function dt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ft(e,t){return function(){this.setAttribute(e,t)}}function pt(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function vt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function mt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function gt(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function _t(e){return function(){this.style.removeProperty(e)}}function yt(e,t,n){return function(){this.style.setProperty(e,t,n)}}function bt(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function xt(e,t){return e.style.getPropertyValue(t)||gt(e).getComputedStyle(e,null).getPropertyValue(t)}function wt(e){return function(){delete this[e]}}function kt(e,t){return function(){this[e]=t}}function St(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Mt(e){return e.trim().split(/^|\s+/)}function Tt(e){return e.classList||new Ct(e)}function Ct(e){this._node=e,this._names=Mt(e.getAttribute("class")||"")}function Et(e,t){for(var n=Tt(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Pt(e,t){for(var n=Tt(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Lt(e){return function(){Et(this,e)}}function At(e){return function(){Pt(this,e)}}function It(e,t){return function(){(t.apply(this,arguments)?Et:Pt)(this,e)}}function Rt(){this.textContent=""}function Nt(e){return function(){this.textContent=e}}function Dt(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Ot(){this.innerHTML=""}function zt(e){return function(){this.innerHTML=e}}function Ft(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Bt(){this.nextSibling&&this.parentNode.appendChild(this)}function $t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jt(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ut&&t.documentElement.namespaceURI===ut?t.createElement(e):t.createElementNS(n,e)}}function Ut(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Vt(e){var t=ct(e);return(t.local?Ut:jt)(t)}function Ht(){return null}function Wt(){var e=this.parentNode;e&&e.removeChild(this)}function Gt(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function qt(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}Ct.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Zt={},Xt=null;"undefined"!==typeof document&&("onmouseenter"in document.documentElement||(Zt={mouseenter:"mouseover",mouseleave:"mouseout"}));function Yt(e,t,n){return e=Kt(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function Kt(e,t,n){return function(i){var r=Xt;Xt=i;try{e.call(this,this.__data__,t,n)}finally{Xt=r}}}function Jt(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function Qt(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,a=t.length;i<a;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?t.length=r:delete this.__on}}}function en(e,t,n){var i=Zt.hasOwnProperty(e.type)?Yt:Kt;return function(r,a,o){var s,u=this.__on,l=i(t,a,o);if(u)for(var c=0,h=u.length;c<h;++c)if((s=u[c]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=t);this.addEventListener(e.type,l,n),s={type:e.type,name:e.name,value:t,listener:l,capture:n},u?u.push(s):this.__on=[s]}}function tn(e,t,n,i){var r=Xt;e.sourceEvent=Xt,Xt=e;try{return t.apply(n,i)}finally{Xt=r}}function nn(e,t,n){var i=gt(e),r=i.CustomEvent;"function"===typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function rn(e,t){return function(){return nn(this,e,t)}}function an(e,t){return function(){return nn(this,e,t.apply(this,arguments))}}var on=[null];function sn(e,t){this._groups=e,this._parents=t}function un(){return new sn([[document.documentElement]],on)}sn.prototype=un.prototype={constructor:sn,select:function(e){"function"!==typeof e&&(e=Qe(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var a,o,s=t[r],u=s.length,l=i[r]=new Array(u),c=0;c<u;++c)(a=s[c])&&(o=e.call(a,a.__data__,c,s))&&("__data__"in a&&(o.__data__=a.__data__),l[c]=o);return new sn(i,this._parents)},selectAll:function(e){"function"!==typeof e&&(e=tt(e));for(var t=this._groups,n=t.length,i=[],r=[],a=0;a<n;++a)for(var o,s=t[a],u=s.length,l=0;l<u;++l)(o=s[l])&&(i.push(e.call(o,o.__data__,l,s)),r.push(o));return new sn(i,r)},filter:function(e){"function"!==typeof e&&(e=nt(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var a,o=t[r],s=o.length,u=i[r]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new sn(i,this._parents)},data:function(e,t){if(!e)return f=new Array(this.size()),l=-1,this.each((function(e){f[++l]=e})),f;var n=t?ot:at,i=this._parents,r=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var a=r.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=i[l],h=r[l],d=h.length,f=e.call(c,c&&c.__data__,l,i),p=f.length,v=s[l]=new Array(p),m=o[l]=new Array(p);n(c,h,v,m,u[l]=new Array(d),f,t);for(var g,_,y=0,b=0;y<p;++y)if(g=v[y]){for(y>=b&&(b=y+1);!(_=m[b])&&++b<p;);g._next=_||null}}return(o=new sn(o,i))._enter=s,o._exit=u,o},enter:function(){return new sn(this._enter||this._groups.map(it),this._parents)},exit:function(){return new sn(this._exit||this._groups.map(it),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,a=this.exit();return i="function"===typeof e?e(i):i.append(e+""),null!=t&&(r=t(r)),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(e){for(var t=this._groups,n=e._groups,i=t.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var u,l=t[s],c=n[s],h=l.length,d=o[s]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(d[f]=u);for(;s<i;++s)o[s]=t[s];return new sn(o,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],a=r.length-1,o=r[a];--a>=0;)(i=r[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=st);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var o,s=n[a],u=s.length,l=r[a]=new Array(u),c=0;c<u;++c)(o=s[c])&&(l[c]=o);l.sort(t)}return new sn(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,a=i.length;r<a;++r){var o=i[r];if(o)return o}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,a=t[n],o=0,s=a.length;o<s;++o)(r=a[o])&&e.call(r,r.__data__,o,a);return this},attr:function(e,t){var n=ct(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?dt:ht:"function"===typeof t?n.local?mt:vt:n.local?pt:ft)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?_t:"function"===typeof t?bt:yt)(e,t,null==n?"":n)):xt(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?wt:"function"===typeof t?St:kt)(e,t)):this.node()[e]},classed:function(e,t){var n=Mt(e+"");if(arguments.length<2){for(var i=Tt(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"===typeof t?It:t?Lt:At)(n,t))},text:function(e){return arguments.length?this.each(null==e?Rt:("function"===typeof e?Dt:Nt)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Ot:("function"===typeof e?Ft:zt)(e)):this.node().innerHTML},raise:function(){return this.each(Bt)},lower:function(){return this.each($t)},append:function(e){var t="function"===typeof e?e:Vt(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"===typeof e?e:Vt(e),i=null==t?Ht:"function"===typeof t?t:Qe(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(Wt)},clone:function(e){return this.select(e?qt:Gt)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,a=Jt(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?en:Qt,null==n&&(n=!1),i=0;i<o;++i)this.each(s(a[i],t,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(i=0,u=s[l];i<o;++i)if((r=a[i]).type===u.type&&r.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"===typeof t?an:rn)(e,t))}};var ln=un;function cn(e){return"string"===typeof e?new sn([[document.querySelector(e)]],[document.documentElement]):new sn([[e]],on)}function hn(){Xt.stopImmediatePropagation()}function dn(){Xt.preventDefault(),Xt.stopImmediatePropagation()}function fn(e){var t=e.document.documentElement,n=cn(e).on("dragstart.drag",dn,!0);"onselectstart"in t?n.on("selectstart.drag",dn,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function pn(e,t){var n=e.document.documentElement,i=cn(e).on("dragstart.drag",null);t&&(i.on("click.drag",dn,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function vn(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function mn(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function gn(){}var _n=.7,yn=1/_n,bn="\\s*([+-]?\\d+)\\s*",xn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",wn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kn=/^#([0-9a-f]{3,8})$/,Sn=new RegExp("^rgb\\("+[bn,bn,bn]+"\\)$"),Mn=new RegExp("^rgb\\("+[wn,wn,wn]+"\\)$"),Tn=new RegExp("^rgba\\("+[bn,bn,bn,xn]+"\\)$"),Cn=new RegExp("^rgba\\("+[wn,wn,wn,xn]+"\\)$"),En=new RegExp("^hsl\\("+[xn,wn,wn]+"\\)$"),Pn=new RegExp("^hsla\\("+[xn,wn,wn,xn]+"\\)$"),Ln={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function An(){return this.rgb().formatHex()}function In(){return this.rgb().formatRgb()}function Rn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=kn.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Nn(t):3===n?new Fn(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Dn(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Dn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Sn.exec(e))?new Fn(t[1],t[2],t[3],1):(t=Mn.exec(e))?new Fn(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Tn.exec(e))?Dn(t[1],t[2],t[3],t[4]):(t=Cn.exec(e))?Dn(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=En.exec(e))?Un(t[1],t[2]/100,t[3]/100,1):(t=Pn.exec(e))?Un(t[1],t[2]/100,t[3]/100,t[4]):Ln.hasOwnProperty(e)?Nn(Ln[e]):"transparent"===e?new Fn(NaN,NaN,NaN,0):null}function Nn(e){return new Fn(e>>16&255,e>>8&255,255&e,1)}function Dn(e,t,n,i){return i<=0&&(e=t=n=NaN),new Fn(e,t,n,i)}function On(e){return e instanceof gn||(e=Rn(e)),e?new Fn((e=e.rgb()).r,e.g,e.b,e.opacity):new Fn}function zn(e,t,n,i){return 1===arguments.length?On(e):new Fn(e,t,n,null==i?1:i)}function Fn(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function Bn(){return"#"+jn(this.r)+jn(this.g)+jn(this.b)}function $n(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function jn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Un(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Hn(e,t,n,i)}function Vn(e){if(e instanceof Hn)return new Hn(e.h,e.s,e.l,e.opacity);if(e instanceof gn||(e=Rn(e)),!e)return new Hn;if(e instanceof Hn)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),o=NaN,s=a-r,u=(a+r)/2;return s?(o=t===a?(n-i)/s+6*(n<i):n===a?(i-t)/s+2:(t-n)/s+4,s/=u<.5?a+r:2-a-r,o*=60):s=u>0&&u<1?0:o,new Hn(o,s,u,e.opacity)}function Hn(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function Wn(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Gn(e,t,n,i,r){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*i+o*r)/6}function qn(e){return function(){return e}}function Zn(e,t){return function(n){return e+n*t}}function Xn(e){return 1===(e=+e)?Yn:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):qn(isNaN(t)?n:t)}}function Yn(e,t){var n=t-e;return n?Zn(e,n):qn(isNaN(e)?t:e)}vn(gn,Rn,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:An,formatHex:An,formatHsl:function(){return Vn(this).formatHsl()},formatRgb:In,toString:In}),vn(Fn,zn,mn(gn,{brighter:function(e){return e=null==e?yn:Math.pow(yn,e),new Fn(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?_n:Math.pow(_n,e),new Fn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bn,formatHex:Bn,formatRgb:$n,toString:$n})),vn(Hn,(function(e,t,n,i){return 1===arguments.length?Vn(e):new Hn(e,t,n,null==i?1:i)}),mn(gn,{brighter:function(e){return e=null==e?yn:Math.pow(yn,e),new Hn(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?_n:Math.pow(_n,e),new Hn(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Fn(Wn(e>=240?e-240:e+120,r,i),Wn(e,r,i),Wn(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var Kn=function e(t){var n=Xn(t);function i(e,t){var i=n((e=zn(e)).r,(t=zn(t)).r),r=n(e.g,t.g),a=n(e.b,t.b),o=Yn(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=a(t),e.opacity=o(t),e+""}}return i.gamma=e,i}(1);function Jn(e){return function(t){var n,i,r=t.length,a=new Array(r),o=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=zn(t[n]),a[n]=i.r||0,o[n]=i.g||0,s[n]=i.b||0;return a=e(a),o=e(o),s=e(s),i.opacity=1,function(e){return i.r=a(e),i.g=o(e),i.b=s(e),i+""}}}Jn((function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1],o=i>0?e[i-1]:2*r-a,s=i<t-1?e[i+2]:2*a-r;return Gn((n-i/t)*t,o,r,a,s)}})),Jn((function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],a=e[i%t],o=e[(i+1)%t],s=e[(i+2)%t];return Gn((n-i/t)*t,r,a,o,s)}}));function Qn(e,t){var n,i=t?t.length:0,r=e?Math.min(i,e.length):0,a=new Array(r),o=new Array(i);for(n=0;n<r;++n)a[n]=si(e[n],t[n]);for(;n<i;++n)o[n]=t[n];return function(e){for(n=0;n<r;++n)o[n]=a[n](e);return o}}function ei(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function ti(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ni(e,t){var n,i={},r={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?i[n]=si(e[n],t[n]):r[n]=t[n];return function(e){for(n in i)r[n]=i[n](e);return r}}var ii=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ri=new RegExp(ii.source,"g");function ai(e,t){var n,i,r,a=ii.lastIndex=ri.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=ii.exec(e))&&(i=ri.exec(t));)(r=i.index)>a&&(r=t.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:ti(n,i)})),a=ri.lastIndex;return a<t.length&&(r=t.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,i=0;i<t;++i)s[(n=u[i]).i]=n.x(e);return s.join("")})}function oi(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,r=t.slice();return function(a){for(n=0;n<i;++n)r[n]=e[n]*(1-a)+t[n]*a;return r}}function si(e,t){var n,i=typeof t;return null==t||"boolean"===i?qn(t):("number"===i?ti:"string"===i?(n=Rn(t))?(t=n,Kn):ai:t instanceof Rn?Kn:t instanceof Date?ei:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?oi:Array.isArray(t)?Qn:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?ni:ti)(e,t)}function ui(){for(var e,t=Xt;e=t.sourceEvent;)t=e;return t}function li(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}function ci(e,t,n){arguments.length<3&&(n=t,t=ui().changedTouches);for(var i,r=0,a=t?t.length:0;r<a;++r)if((i=t[r]).identifier===n)return li(e,i);return null}function hi(e){var t=ui();return t.changedTouches&&(t=t.changedTouches[0]),li(e,t)}var di,fi,pi=0,vi=0,mi=0,gi=0,_i=0,yi=0,bi="object"===typeof performance&&performance.now?performance:Date,xi="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function wi(){return _i||(xi(ki),_i=bi.now()+yi)}function ki(){_i=0}function Si(){this._call=this._time=this._next=null}function Mi(e,t,n){var i=new Si;return i.restart(e,t,n),i}function Ti(){_i=(gi=bi.now())+yi,pi=vi=0;try{!function(){wi(),++pi;for(var e,t=di;t;)(e=_i-t._time)>=0&&t._call.call(null,e),t=t._next;--pi}()}finally{pi=0,function(){var e,t,n=di,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:di=t);fi=e,Ei(i)}(),_i=0}}function Ci(){var e=bi.now(),t=e-gi;t>1e3&&(yi-=t,gi=e)}function Ei(e){pi||(vi&&(vi=clearTimeout(vi)),e-_i>24?(e<1/0&&(vi=setTimeout(Ti,e-bi.now()-yi)),mi&&(mi=clearInterval(mi))):(mi||(gi=bi.now(),mi=setInterval(Ci,1e3)),pi=1,xi(Ti)))}function Pi(e,t,n){var i=new Si;return t=null==t?0:+t,i.restart((function(n){i.stop(),e(n+t)}),t,n),i}Si.prototype=Mi.prototype={constructor:Si,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?wi():+n)+(null==t?0:+t),this._next||fi===this||(fi?fi._next=this:di=this,fi=this),this._call=e,this._time=n,Ei()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ei())}};var Li=Ke("start","end","cancel","interrupt"),Ai=[];function Ii(e,t,n,i,r,a){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function a(e){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=e&&o(e-n.delay)}function o(a){var l,c,h,d;if(1!==n.state)return u();for(l in r)if((d=r[l]).name===n.name){if(3===d.state)return Pi(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[l]):+l<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[l])}if(Pi((function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(a))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),l=0,c=-1;l<h;++l)(d=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(i[++c]=d);i.length=c+1}}function s(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(u),n.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=Mi(a,0,n.time)}(e,n,{name:t,index:i,group:r,on:Li,tween:Ai,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function Ri(e,t){var n=Di(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Ni(e,t){var n=Di(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Di(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Oi(e,t){var n,i,r,a=e.__transition,o=!0;if(a){for(r in t=null==t?null:t+"",a)(n=a[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[r]):o=!1;o&&delete e.__transition}}var zi,Fi,Bi,$i,ji=180/Math.PI,Ui={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vi(e,t,n,i,r,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),e*i<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*ji,skewX:Math.atan(u)*ji,scaleX:o,scaleY:s}}function Hi(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],u=[];return a=e(a),o=e(o),function(e,i,r,a,o,s){if(e!==r||i!==a){var u=o.push("translate(",null,t,null,n);s.push({i:u-4,x:ti(e,r)},{i:u-2,x:ti(i,a)})}else(r||a)&&o.push("translate("+r+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:ti(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(a.rotate,o.rotate,s,u),function(e,t,n,a){e!==t?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:ti(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(a.skewX,o.skewX,s,u),function(e,t,n,i,a,o){if(e!==n||t!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:ti(e,n)},{i:s-2,x:ti(t,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(e){for(var t,n=-1,i=u.length;++n<i;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var Wi=Hi((function(e){return"none"===e?Ui:(zi||(zi=document.createElement("DIV"),Fi=document.documentElement,Bi=document.defaultView),zi.style.transform=e,e=Bi.getComputedStyle(Fi.appendChild(zi),null).getPropertyValue("transform"),Fi.removeChild(zi),Vi(+(e=e.slice(7,-1).split(","))[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}),"px, ","px)","deg)"),Gi=Hi((function(e){return null==e?Ui:($i||($i=document.createElementNS("http://www.w3.org/2000/svg","g")),$i.setAttribute("transform",e),(e=$i.transform.baseVal.consolidate())?Vi((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Ui)}),", ",")",")");function qi(e,t){var n,i;return function(){var r=Ni(this,e),a=r.tween;if(a!==n)for(var o=0,s=(i=n=a).length;o<s;++o)if(i[o].name===t){(i=i.slice()).splice(o,1);break}r.tween=i}}function Zi(e,t,n){var i,r;if("function"!==typeof n)throw new Error;return function(){var a=Ni(this,e),o=a.tween;if(o!==i){r=(i=o).slice();for(var s={name:t,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===t){r[u]=s;break}u===l&&r.push(s)}a.tween=r}}function Xi(e,t,n){var i=e._id;return e.each((function(){var e=Ni(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return Di(e,i).value[t]}}function Yi(e,t){var n;return("number"===typeof t?ti:t instanceof Rn?Kn:(n=Rn(t))?(t=n,Kn):ai)(e,t)}function Ki(e){return function(){this.removeAttribute(e)}}function Ji(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Qi(e,t,n){var i,r,a=n+"";return function(){var o=this.getAttribute(e);return o===a?null:o===i?r:r=t(i=o,n)}}function er(e,t,n){var i,r,a=n+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===i?r:r=t(i=o,n)}}function tr(e,t,n){var i,r,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttribute(e))===(s=u+"")?null:o===i&&s===r?a:(r=s,a=t(i=o,u));this.removeAttribute(e)}}function nr(e,t,n){var i,r,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttributeNS(e.space,e.local))===(s=u+"")?null:o===i&&s===r?a:(r=s,a=t(i=o,u));this.removeAttributeNS(e.space,e.local)}}function ir(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function rr(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ar(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&rr(e,r)),n}return r._value=t,r}function or(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&ir(e,r)),n}return r._value=t,r}function sr(e,t){return function(){Ri(this,e).delay=+t.apply(this,arguments)}}function ur(e,t){return t=+t,function(){Ri(this,e).delay=t}}function lr(e,t){return function(){Ni(this,e).duration=+t.apply(this,arguments)}}function cr(e,t){return t=+t,function(){Ni(this,e).duration=t}}function hr(e,t){if("function"!==typeof t)throw new Error;return function(){Ni(this,e).ease=t}}function dr(e,t,n){var i,r,a=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?Ri:Ni;return function(){var o=a(this,e),s=o.on;s!==i&&(r=(i=s).copy()).on(t,n),o.on=r}}var fr=ln.prototype.constructor;function pr(e){return function(){this.style.removeProperty(e)}}function vr(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function mr(e,t,n){var i,r;function a(){var a=t.apply(this,arguments);return a!==r&&(i=(r=a)&&vr(e,a,n)),i}return a._value=t,a}function gr(e){return function(t){this.textContent=e.call(this,t)}}function _r(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&gr(i)),t}return i._value=e,i}var yr=0;function br(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function xr(){return++yr}var wr=ln.prototype;br.prototype=function(e){return ln().transition(e)}.prototype={constructor:br,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=Qe(e));for(var i=this._groups,r=i.length,a=new Array(r),o=0;o<r;++o)for(var s,u,l=i[o],c=l.length,h=a[o]=new Array(c),d=0;d<c;++d)(s=l[d])&&(u=e.call(s,s.__data__,d,l))&&("__data__"in s&&(u.__data__=s.__data__),h[d]=u,Ii(h[d],t,n,d,h,Di(s,n)));return new br(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=tt(e));for(var i=this._groups,r=i.length,a=[],o=[],s=0;s<r;++s)for(var u,l=i[s],c=l.length,h=0;h<c;++h)if(u=l[h]){for(var d,f=e.call(u,u.__data__,h,l),p=Di(u,n),v=0,m=f.length;v<m;++v)(d=f[v])&&Ii(d,t,n,v,f,p);a.push(f),o.push(u)}return new br(a,o,t,n)},filter:function(e){"function"!==typeof e&&(e=nt(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var a,o=t[r],s=o.length,u=i[r]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new br(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var u,l=t[s],c=n[s],h=l.length,d=o[s]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(d[f]=u);for(;s<i;++s)o[s]=t[s];return new br(o,this._parents,this._name,this._id)},selection:function(){return new fr(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=xr(),i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],u=s.length,l=0;l<u;++l)if(o=s[l]){var c=Di(o,t);Ii(o,e,n,l,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new br(i,this._parents,e,n)},call:wr.call,nodes:wr.nodes,node:wr.node,size:wr.size,empty:wr.empty,each:wr.each,on:function(e,t){var n=this._id;return arguments.length<2?Di(this.node(),n).on.on(e):this.each(dr(n,e,t))},attr:function(e,t){var n=ct(e),i="transform"===n?Gi:Yi;return this.attrTween(e,"function"===typeof t?(n.local?nr:tr)(n,i,Xi(this,"attr."+e,t)):null==t?(n.local?Ji:Ki)(n):(n.local?er:Qi)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var i=ct(e);return this.tween(n,(i.local?ar:or)(i,t))},style:function(e,t,n){var i="transform"===(e+="")?Wi:Yi;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var a=xt(this,e),o=(this.style.removeProperty(e),xt(this,e));return a===o?null:a===n&&o===i?r:r=t(n=a,i=o)}}(e,i)).on("end.style."+e,pr(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var i,r,a;return function(){var o=xt(this,e),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(e),u=s=xt(this,e)),o===u?null:o===i&&u===r?a:(r=u,a=t(i=o,s))}}(e,i,Xi(this,"style."+e,t))).each(function(e,t){var n,i,r,a,o="style."+t,s="end."+o;return function(){var u=Ni(this,e),l=u.on,c=null==u.value[o]?a||(a=pr(t)):void 0;l===n&&r===c||(i=(n=l).copy()).on(s,r=c),u.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,a=n+"";return function(){var o=xt(this,e);return o===a?null:o===i?r:r=t(i=o,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!==typeof t)throw new Error;return this.tween(i,mr(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(Xi(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,_r(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=Di(this.node(),n).tween,a=0,o=r.length;a<o;++a)if((i=r[a]).name===e)return i.value;return null}return this.each((null==t?qi:Zi)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?sr:ur)(t,e)):Di(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?lr:cr)(t,e)):Di(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(hr(t,e)):Di(this.node(),t).ease},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise((function(a,o){var s={value:o},u={value:function(){0===--r&&a()}};n.each((function(){var n=Ni(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),n.on=t}))}))}};var kr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Sr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return kr.time=wi(),kr;return n}ln.prototype.interrupt=function(e){return this.each((function(){Oi(this,e)}))},ln.prototype.transition=function(e){var t,n;e instanceof br?(t=e._id,e=e._name):(t=xr(),(n=kr).time=wi(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],u=s.length,l=0;l<u;++l)(o=s[l])&&Ii(o,e,t,l,s,n||Sr(o,t));return new br(i,this._parents,e,t)};function Mr(e){return function(){return e}}function Tr(e,t,n){this.target=e,this.type=t,this.selection=n}function Cr(){Xt.stopImmediatePropagation()}function Er(){Xt.preventDefault(),Xt.stopImmediatePropagation()}var Pr={name:"drag"},Lr={name:"space"},Ar={name:"handle"},Ir={name:"center"};function Rr(e){return[+e[0],+e[1]]}function Nr(e){return[Rr(e[0]),Rr(e[1])]}function Dr(e){return function(t){return ci(t,Xt.touches,e)}}var Or={name:"x",handles:["w","e"].map(Hr),input:function(e,t){return null==e?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},zr={name:"y",handles:["n","s"].map(Hr),input:function(e,t){return null==e?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Fr={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Hr),input:function(e){return null==e?null:Nr(e)},output:function(e){return e}},Br={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},$r={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},jr={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Ur={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Vr={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function Hr(e){return{type:e}}function Wr(){return!Xt.ctrlKey&&!Xt.button}function Gr(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function qr(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zr(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function Xr(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function Yr(){return Kr(Fr)}function Kr(e){var t,n=Gr,i=Wr,r=qr,a=!0,o=Ke("start","brush","end"),s=6;function u(t){var n=t.property("__brush",v).selectAll(".overlay").data([Hr("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Br.overlay).merge(n).each((function(){var e=Zr(this).extent;cn(this).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])})),t.selectAll(".selection").data([Hr("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Br.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var i=t.selectAll(".handle").data(e.handles,(function(e){return e.type}));i.exit().remove(),i.enter().append("rect").attr("class",(function(e){return"handle handle--"+e.type})).attr("cursor",(function(e){return Br[e.type]})),t.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(r).on("touchstart.brush",d).on("touchmove.brush",f).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function l(){var e=cn(this),t=Zr(this).selection;t?(e.selectAll(".selection").style("display",null).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1]),e.selectAll(".handle").style("display",null).attr("x",(function(e){return"e"===e.type[e.type.length-1]?t[1][0]-s/2:t[0][0]-s/2})).attr("y",(function(e){return"s"===e.type[0]?t[1][1]-s/2:t[0][1]-s/2})).attr("width",(function(e){return"n"===e.type||"s"===e.type?t[1][0]-t[0][0]+s:s})).attr("height",(function(e){return"e"===e.type||"w"===e.type?t[1][1]-t[0][1]+s:s}))):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(e,t,n){var i=e.__brush.emitter;return!i||n&&i.clean?new h(e,t,n):i}function h(e,t,n){this.that=e,this.args=t,this.state=e.__brush,this.active=0,this.clean=n}function d(){if((!t||Xt.touches)&&i.apply(this,arguments)){var n,r,o,s,u,h,d,f,p,v,m,g=this,_=Xt.target.__data__.type,y="selection"===(a&&Xt.metaKey?_="overlay":_)?Pr:a&&Xt.altKey?Ir:Ar,b=e===zr?null:Ur[_],x=e===Or?null:Vr[_],w=Zr(g),k=w.extent,S=w.selection,M=k[0][0],T=k[0][1],C=k[1][0],E=k[1][1],P=0,L=0,A=b&&x&&a&&Xt.shiftKey,I=Xt.touches?Dr(Xt.changedTouches[0].identifier):hi,R=I(g),N=R,D=c(g,arguments,!0).beforestart();"overlay"===_?(S&&(p=!0),w.selection=S=[[n=e===zr?M:R[0],o=e===Or?T:R[1]],[u=e===zr?C:n,d=e===Or?E:o]]):(n=S[0][0],o=S[0][1],u=S[1][0],d=S[1][1]),r=n,s=o,h=u,f=d;var O=cn(g).attr("pointer-events","none"),z=O.selectAll(".overlay").attr("cursor",Br[_]);if(Xt.touches)D.moved=B,D.ended=j;else{var F=cn(Xt.view).on("mousemove.brush",B,!0).on("mouseup.brush",j,!0);a&&F.on("keydown.brush",U,!0).on("keyup.brush",V,!0),fn(Xt.view)}Cr(),Oi(g),l.call(g),D.start()}function B(){var e=I(g);!A||v||m||(Math.abs(e[0]-N[0])>Math.abs(e[1]-N[1])?m=!0:v=!0),N=e,p=!0,Er(),$()}function $(){var e;switch(P=N[0]-R[0],L=N[1]-R[1],y){case Lr:case Pr:b&&(P=Math.max(M-n,Math.min(C-u,P)),r=n+P,h=u+P),x&&(L=Math.max(T-o,Math.min(E-d,L)),s=o+L,f=d+L);break;case Ar:b<0?(P=Math.max(M-n,Math.min(C-n,P)),r=n+P,h=u):b>0&&(P=Math.max(M-u,Math.min(C-u,P)),r=n,h=u+P),x<0?(L=Math.max(T-o,Math.min(E-o,L)),s=o+L,f=d):x>0&&(L=Math.max(T-d,Math.min(E-d,L)),s=o,f=d+L);break;case Ir:b&&(r=Math.max(M,Math.min(C,n-P*b)),h=Math.max(M,Math.min(C,u+P*b))),x&&(s=Math.max(T,Math.min(E,o-L*x)),f=Math.max(T,Math.min(E,d+L*x)))}h<r&&(b*=-1,e=n,n=u,u=e,e=r,r=h,h=e,_ in $r&&z.attr("cursor",Br[_=$r[_]])),f<s&&(x*=-1,e=o,o=d,d=e,e=s,s=f,f=e,_ in jr&&z.attr("cursor",Br[_=jr[_]])),w.selection&&(S=w.selection),v&&(r=S[0][0],h=S[1][0]),m&&(s=S[0][1],f=S[1][1]),S[0][0]===r&&S[0][1]===s&&S[1][0]===h&&S[1][1]===f||(w.selection=[[r,s],[h,f]],l.call(g),D.brush())}function j(){if(Cr(),Xt.touches){if(Xt.touches.length)return;t&&clearTimeout(t),t=setTimeout((function(){t=null}),500)}else pn(Xt.view,p),F.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);O.attr("pointer-events","all"),z.attr("cursor",Br.overlay),w.selection&&(S=w.selection),Xr(S)&&(w.selection=null,l.call(g)),D.end()}function U(){switch(Xt.keyCode){case 16:A=b&&x;break;case 18:y===Ar&&(b&&(u=h-P*b,n=r+P*b),x&&(d=f-L*x,o=s+L*x),y=Ir,$());break;case 32:y!==Ar&&y!==Ir||(b<0?u=h-P:b>0&&(n=r-P),x<0?d=f-L:x>0&&(o=s-L),y=Lr,z.attr("cursor",Br.selection),$());break;default:return}Er()}function V(){switch(Xt.keyCode){case 16:A&&(v=m=A=!1,$());break;case 18:y===Ir&&(b<0?u=h:b>0&&(n=r),x<0?d=f:x>0&&(o=s),y=Ar,$());break;case 32:y===Lr&&(Xt.altKey?(b&&(u=h-P*b,n=r+P*b),x&&(d=f-L*x,o=s+L*x),y=Ir):(b<0?u=h:b>0&&(n=r),x<0?d=f:x>0&&(o=s),y=Ar),z.attr("cursor",Br[_]),$());break;default:return}Er()}}function f(){c(this,arguments).moved()}function p(){c(this,arguments).ended()}function v(){var t=this.__brush||{selection:null};return t.extent=Nr(n.apply(this,arguments)),t.dim=e,t}return u.move=function(t,n){t.selection?t.on("start.brush",(function(){c(this,arguments).beforestart().start()})).on("interrupt.brush end.brush",(function(){c(this,arguments).end()})).tween("brush",(function(){var t=this,i=t.__brush,r=c(t,arguments),a=i.selection,o=e.input("function"===typeof n?n.apply(this,arguments):n,i.extent),s=si(a,o);function u(e){i.selection=1===e&&null===o?null:s(e),l.call(t),r.brush()}return null!==a&&null!==o?u:u(1)})):t.each((function(){var t=this,i=arguments,r=t.__brush,a=e.input("function"===typeof n?n.apply(t,i):n,r.extent),o=c(t,i).beforestart();Oi(t),r.selection=null===a?null:a,l.call(t),o.start().brush().end()}))},u.clear=function(e){u.move(e,null)},h.prototype={beforestart:function(){return 1===++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0===--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){tn(new Tr(u,t,e.output(this.state.selection)),o.apply,o,[t,this.that,this.args])}},u.extent=function(e){return arguments.length?(n="function"===typeof e?e:Mr(Nr(e)),u):n},u.filter=function(e){return arguments.length?(i="function"===typeof e?e:Mr(!!e),u):i},u.touchable=function(e){return arguments.length?(r="function"===typeof e?e:Mr(!!e),u):r},u.handleSize=function(e){return arguments.length?(s=+e,u):s},u.keyModifiers=function(e){return arguments.length?(a=!!e,u):a},u.on=function(){var e=o.on.apply(o,arguments);return e===o?u:e},u}Math.cos,Math.sin,Math.PI,Math.max;Array.prototype.slice;var Jr="$";function Qr(){}function ea(e,t){var n=new Qr;if(e instanceof Qr)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var i,r=-1,a=e.length;if(null==t)for(;++r<a;)n.set(r,e[r]);else for(;++r<a;)n.set(t(i=e[r],r,e),i)}else if(e)for(var o in e)n.set(o,e[o]);return n}function ta(){}Qr.prototype=ea.prototype={constructor:Qr,has:function(e){return Jr+e in this},get:function(e){return this[Jr+e]},set:function(e,t){return this[Jr+e]=t,this},remove:function(e){var t=Jr+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Jr&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Jr&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Jr&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Jr&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Jr&&++e;return e},empty:function(){for(var e in this)if(e[0]===Jr)return!1;return!0},each:function(e){for(var t in this)t[0]===Jr&&e(this[t],t.slice(1),this)}};var na=ea.prototype;function ia(e,t){var n=new ta;if(e instanceof ta)e.each((function(e){n.add(e)}));else if(e){var i=-1,r=e.length;if(null==t)for(;++i<r;)n.add(e[i]);else for(;++i<r;)n.add(t(e[i],i,e))}return n}ta.prototype=ia.prototype={constructor:ta,has:na.has,add:function(e){return this[Jr+(e+="")]=e,this},remove:na.remove,clear:na.clear,values:na.keys,size:na.size,empty:na.empty,each:na.each};Array.prototype.slice;function ra(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(204!==e.status&&205!==e.status)return e.json()}Math.PI,Math.sqrt(5);function aa(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function oa(e){return(e=aa(Math.abs(e)))?e[1]:NaN}var sa,ua=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function la(e){if(!(t=ua.exec(e)))throw new Error("invalid format: "+e);var t;return new ca({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ca(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function ha(e,t){var n=aa(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}la.prototype=ca.prototype,ca.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var da={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return ha(100*e,t)},r:ha,s:function(e,t){var n=aa(e,t);if(!n)return e+"";var i=n[0],r=n[1],a=r-(sa=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+aa(e,Math.max(0,t+a-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function fa(e){return e}var pa,va,ma,ga=Array.prototype.map,_a=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function ya(e){var t,n,i=void 0===e.grouping||void 0===e.thousands?fa:(t=ga.call(e.grouping,Number),n=e.thousands+"",function(e,i){for(var r=e.length,a=[],o=0,s=t[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),a.push(e.substring(r-=s,r+s)),!((u+=s+1)>i));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),r=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?fa:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(ga.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=la(e)).fill,n=e.align,h=e.sign,d=e.symbol,f=e.zero,p=e.width,v=e.comma,m=e.precision,g=e.trim,_=e.type;"n"===_?(v=!0,_="g"):da[_]||(void 0===m&&(m=12),g=!0,_="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var y="$"===d?r:"#"===d&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",b="$"===d?a:/[%p]/.test(_)?u:"",x=da[_],w=/[defgprs%]/.test(_);function k(e){var r,a,u,d=y,k=b;if("c"===_)k=x(e)+k,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),m),g&&(e=function(e){e:for(var t,n=e.length,i=1,r=-1;i<n;++i)switch(e[i]){case".":r=t=i;break;case"0":0===r&&(r=i),t=i;break;default:if(!+e[i])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),S&&0===+e&&"+"!==h&&(S=!1),d=(S?"("===h?h:l:"-"===h||"("===h?"":h)+d,k=("s"===_?_a[8+sa/3]:"")+k+(S&&"("===h?")":""),w)for(r=-1,a=e.length;++r<a;)if(48>(u=e.charCodeAt(r))||u>57){k=(46===u?o+e.slice(r+1):e.slice(r))+k,e=e.slice(0,r);break}}v&&!f&&(e=i(e,1/0));var M=d.length+e.length+k.length,T=M<p?new Array(p-M+1).join(t):"";switch(v&&f&&(e=i(T+e,T.length?p-k.length:1/0),T=""),n){case"<":e=d+e+k+T;break;case"=":e=d+T+e+k;break;case"^":e=T.slice(0,M=T.length>>1)+d+e+k+T.slice(M);break;default:e=T+d+e+k}return s(e)}return m=void 0===m?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return e+""},k}return{format:h,formatPrefix:function(e,t){var n=h(((e=la(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(oa(t)/3))),r=Math.pow(10,-i),a=_a[8+i/3];return function(e){return n(r*e)+a}}}}function ba(e){return e}function xa(e,t){e&&ka.hasOwnProperty(e.type)&&ka[e.type](e,t)}pa=ya({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),va=pa.format,ma=pa.formatPrefix;var wa={Feature:function(e,t){xa(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)xa(n[i].geometry,t)}},ka={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Sa(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Sa(n[i],t,0)},Polygon:function(e,t){Ma(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Ma(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)xa(n[i],t)}};function Sa(e,t,n){var i,r=-1,a=e.length-n;for(t.lineStart();++r<a;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function Ma(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Sa(e[n],t,1);t.polygonEnd()}function Ta(e,t){e&&wa.hasOwnProperty(e.type)?wa[e.type](e,t):xa(e,t)}function Ca(){return new Ea}function Ea(){this.reset()}Ea.prototype={constructor:Ea,reset:function(){this.s=this.t=0},add:function(e){La(Pa,e,this.t),La(this,Pa.s,this.s),this.s?this.t+=Pa.t:this.s=Pa.t},valueOf:function(){return this.s}};var Pa=new Ea;function La(e,t,n){var i=e.s=t+n,r=i-t,a=i-r;e.t=t-a+(n-r)}var Aa=1e-6,Ia=Math.PI,Ra=Ia/2,Na=Ia/4,Da=2*Ia,Oa=180/Ia,za=Ia/180,Fa=Math.abs,Ba=Math.atan,$a=Math.atan2,ja=Math.cos,Ua=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),Va=Math.sign||function(e){return e>0?1:e<0?-1:0},Ha=Math.sqrt;Math.tan;function Wa(e){return e>1?Ra:e<-1?-Ra:Math.asin(e)}function Ga(){}var qa,Za,Xa,Ya,Ka=Ca(),Ja=Ca(),Qa={point:Ga,lineStart:Ga,lineEnd:Ga,polygonStart:function(){Qa.lineStart=eo,Qa.lineEnd=io},polygonEnd:function(){Qa.lineStart=Qa.lineEnd=Qa.point=Ga,Ka.add(Fa(Ja)),Ja.reset()},result:function(){var e=Ka/2;return Ka.reset(),e}};function eo(){Qa.point=to}function to(e,t){Qa.point=no,qa=Xa=e,Za=Ya=t}function no(e,t){Ja.add(Ya*e-Xa*t),Xa=e,Ya=t}function io(){no(qa,Za)}var ro=Qa,ao=1/0,oo=ao,so=-ao,uo=so,lo={point:function(e,t){e<ao&&(ao=e);e>so&&(so=e);t<oo&&(oo=t);t>uo&&(uo=t)},lineStart:Ga,lineEnd:Ga,polygonStart:Ga,polygonEnd:Ga,result:function(){var e=[[ao,oo],[so,uo]];return so=uo=-(oo=ao=1/0),e}};var co,ho,fo,po,vo=lo,mo=0,go=0,_o=0,yo=0,bo=0,xo=0,wo=0,ko=0,So=0,Mo={point:To,lineStart:Co,lineEnd:Lo,polygonStart:function(){Mo.lineStart=Ao,Mo.lineEnd=Io},polygonEnd:function(){Mo.point=To,Mo.lineStart=Co,Mo.lineEnd=Lo},result:function(){var e=So?[wo/So,ko/So]:xo?[yo/xo,bo/xo]:_o?[mo/_o,go/_o]:[NaN,NaN];return mo=go=_o=yo=bo=xo=wo=ko=So=0,e}};function To(e,t){mo+=e,go+=t,++_o}function Co(){Mo.point=Eo}function Eo(e,t){Mo.point=Po,To(fo=e,po=t)}function Po(e,t){var n=e-fo,i=t-po,r=Ha(n*n+i*i);yo+=r*(fo+e)/2,bo+=r*(po+t)/2,xo+=r,To(fo=e,po=t)}function Lo(){Mo.point=To}function Ao(){Mo.point=Ro}function Io(){No(co,ho)}function Ro(e,t){Mo.point=No,To(co=fo=e,ho=po=t)}function No(e,t){var n=e-fo,i=t-po,r=Ha(n*n+i*i);yo+=r*(fo+e)/2,bo+=r*(po+t)/2,xo+=r,wo+=(r=po*e-fo*t)*(fo+e),ko+=r*(po+t),So+=3*r,To(fo=e,po=t)}var Do=Mo;function Oo(e){this._context=e}Oo.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Da)}},result:Ga};var zo,Fo,Bo,$o,jo,Uo=Ca(),Vo={point:Ga,lineStart:function(){Vo.point=Ho},lineEnd:function(){zo&&Wo(Fo,Bo),Vo.point=Ga},polygonStart:function(){zo=!0},polygonEnd:function(){zo=null},result:function(){var e=+Uo;return Uo.reset(),e}};function Ho(e,t){Vo.point=Wo,Fo=$o=e,Bo=jo=t}function Wo(e,t){$o-=e,jo-=t,Uo.add(Ha($o*$o+jo*jo)),$o=e,jo=t}var Go=Vo;function qo(){this._string=[]}function Zo(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Xo(e,t){var n,i,r=4.5;function a(e){return e&&("function"===typeof r&&i.pointRadius(+r.apply(this,arguments)),Ta(e,n(i))),i.result()}return a.area=function(e){return Ta(e,n(ro)),ro.result()},a.measure=function(e){return Ta(e,n(Go)),Go.result()},a.bounds=function(e){return Ta(e,n(vo)),vo.result()},a.centroid=function(e){return Ta(e,n(Do)),Do.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,ba):(e=t).stream,a):e},a.context=function(e){return arguments.length?(i=null==e?(t=null,new qo):new Oo(t=e),"function"!==typeof r&&i.pointRadius(r),a):t},a.pointRadius=function(e){return arguments.length?(r="function"===typeof e?e:(i.pointRadius(+e),+e),a):r},a.projection(e).context(t)}function Yo(){var e,t=[];return{point:function(t,n,i){e.push([t,n,i])},lineStart:function(){t.push(e=[])},lineEnd:Ga,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Ko(e,t){return Fa(e[0]-t[0])<Aa&&Fa(e[1]-t[1])<Aa}function Jo(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Qo(e,t,n,i,r){var a,o,s=[],u=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,i=e[0],o=e[t];if(Ko(i,o)){if(!i[2]&&!o[2]){for(r.lineStart(),a=0;a<t;++a)r.point((i=e[a])[0],i[1]);return void r.lineEnd()}o[0]+=2e-6}s.push(n=new Jo(i,e,null,!0)),u.push(n.o=new Jo(i,null,n,!1)),s.push(n=new Jo(o,e,null,!1)),u.push(n.o=new Jo(o,null,n,!0))}})),s.length){for(u.sort(t),es(s),es(u),a=0,o=u.length;a<o;++a)u[a].e=n=!n;for(var l,c,h=s[0];;){for(var d=h,f=!0;d.v;)if((d=d.n)===h)return;l=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(a=0,o=l.length;a<o;++a)r.point((c=l[a])[0],c[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(f)for(l=d.p.z,a=l.length-1;a>=0;--a)r.point((c=l[a])[0],c[1]);else i(d.x,d.p.x,-1,r);d=d.p}l=(d=d.o).z,f=!f}while(!d.v);r.lineEnd()}}}function es(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function ts(e){return[$a(e[1],e[0]),Wa(e[2])]}function ns(e){var t=e[0],n=e[1],i=ja(n);return[i*ja(t),i*Ua(t),Ua(n)]}function is(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rs(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function as(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function os(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function ss(e){var t=Ha(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}qo.prototype={_radius:4.5,_circle:Zo(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=Zo(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var us=Ca();function ls(e){return Fa(e[0])<=Ia?e[0]:Va(e[0])*((Fa(e[0])+Ia)%Da-Ia)}function cs(e,t,n,i){return function(r){var a,o,s,u=t(r),l=Yo(),c=t(l),h=!1,d={point:f,lineStart:v,lineEnd:m,polygonStart:function(){d.point=g,d.lineStart=_,d.lineEnd=y,o=[],a=[]},polygonEnd:function(){d.point=f,d.lineStart=v,d.lineEnd=m,o=Pe(o);var e=function(e,t){var n=ls(t),i=t[1],r=Ua(i),a=[Ua(n),-ja(n),0],o=0,s=0;us.reset(),1===r?i=Ra+Aa:-1===r&&(i=-Ra-Aa);for(var u=0,l=e.length;u<l;++u)if(h=(c=e[u]).length)for(var c,h,d=c[h-1],f=ls(d),p=d[1]/2+Na,v=Ua(p),m=ja(p),g=0;g<h;++g,f=y,v=x,m=w,d=_){var _=c[g],y=ls(_),b=_[1]/2+Na,x=Ua(b),w=ja(b),k=y-f,S=k>=0?1:-1,M=S*k,T=M>Ia,C=v*x;if(us.add($a(C*S*Ua(M),m*w+C*ja(M))),o+=T?k+S*Da:k,T^f>=n^y>=n){var E=rs(ns(d),ns(_));ss(E);var P=rs(a,E);ss(P);var L=(T^k>=0?-1:1)*Wa(P[2]);(i>L||i===L&&(E[0]||E[1]))&&(s+=T^k>=0?1:-1)}}return(o<-1e-6||o<Aa&&us<-1e-6)^1&s}(a,i);o.length?(h||(r.polygonStart(),h=!0),Qo(o,ds,e,n,r)):e&&(h||(r.polygonStart(),h=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),h&&(r.polygonEnd(),h=!1),o=a=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(t,n){e(t,n)&&r.point(t,n)}function p(e,t){u.point(e,t)}function v(){d.point=p,u.lineStart()}function m(){d.point=f,u.lineEnd()}function g(e,t){s.push([e,t]),c.point(e,t)}function _(){c.lineStart(),s=[]}function y(){g(s[0][0],s[0][1]),c.lineEnd();var e,t,n,i,u=c.clean(),d=l.result(),f=d.length;if(s.pop(),a.push(s),s=null,f)if(1&u){if((t=(n=d[0]).length-1)>0){for(h||(r.polygonStart(),h=!0),r.lineStart(),e=0;e<t;++e)r.point((i=n[e])[0],i[1]);r.lineEnd()}}else f>1&&2&u&&d.push(d.pop().concat(d.shift())),o.push(d.filter(hs))}return d}}function hs(e){return e.length>1}function ds(e,t){return((e=e.x)[0]<0?e[1]-Ra-Aa:Ra-e[1])-((t=t.x)[0]<0?t[1]-Ra-Aa:Ra-t[1])}var fs=cs((function(){return!0}),(function(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Ia:-Ia,u=Fa(a-n);Fa(u-Ia)<Aa?(e.point(n,i=(i+o)/2>0?Ra:-Ra),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),e.point(a,i),t=0):r!==s&&u>=Ia&&(Fa(n-r)<Aa&&(n-=r*Aa),Fa(a-s)<Aa&&(a-=s*Aa),i=function(e,t,n,i){var r,a,o=Ua(e-n);return Fa(o)>Aa?Ba((Ua(t)*(a=ja(i))*Ua(n)-Ua(i)*(r=ja(t))*Ua(e))/(r*a*o)):(t+i)/2}(n,i,a,o),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),t=0),e.point(n=a,i=o),r=s},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}),(function(e,t,n,i){var r;if(null==e)r=n*Ra,i.point(-Ia,r),i.point(0,r),i.point(Ia,r),i.point(Ia,0),i.point(Ia,-r),i.point(0,-r),i.point(-Ia,-r),i.point(-Ia,0),i.point(-Ia,r);else if(Fa(e[0]-t[0])>Aa){var a=e[0]<t[0]?Ia:-Ia;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}),[-Ia,-Ra]);function ps(e,t,n,i,r,a){if(n){var o=ja(t),s=Ua(t),u=i*n;null==r?(r=t+i*Da,a=t-u/2):(r=vs(o,r),a=vs(o,a),(i>0?r<a:r>a)&&(r+=i*Da));for(var l,c=r;i>0?c>a:c<a;c-=u)l=ts([o,-s*ja(c),-s*Ua(c)]),e.point(l[0],l[1])}}function vs(e,t){(t=ns(t))[0]-=e,ss(t);var n=function(e){return e>1?0:e<-1?Ia:Math.acos(e)}(-t[1]);return((-t[2]<0?-n:n)+Da-Aa)%Da}function ms(e){var t=ja(e),n=6*za,i=t>0,r=Fa(t)>Aa;function a(e,n){return ja(e)*ja(n)>t}function o(e,n,i){var r=[1,0,0],a=rs(ns(e),ns(n)),o=is(a,a),s=a[0],u=o-s*s;if(!u)return!i&&e;var l=t*o/u,c=-t*s/u,h=rs(r,a),d=os(r,l);as(d,os(a,c));var f=h,p=is(d,f),v=is(f,f),m=p*p-v*(is(d,d)-1);if(!(m<0)){var g=Ha(m),_=os(f,(-p-g)/v);if(as(_,d),_=ts(_),!i)return _;var y,b=e[0],x=n[0],w=e[1],k=n[1];x<b&&(y=b,b=x,x=y);var S=x-b,M=Fa(S-Ia)<Aa;if(!M&&k<w&&(y=w,w=k,k=y),M||S<Aa?M?w+k>0^_[1]<(Fa(_[0]-b)<Aa?w:k):w<=_[1]&&_[1]<=k:S>Ia^(b<=_[0]&&_[0]<=x)){var T=os(f,(-p+g)/v);return as(T,d),[_,ts(T)]}}}function s(t,n){var r=i?e:Ia-e,a=0;return t<-r?a|=1:t>r&&(a|=2),n<-r?a|=4:n>r&&(a|=8),a}return cs(a,(function(e){var t,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(h,d){var f,p=[h,d],v=a(h,d),m=i?v?0:s(h,d):v?s(h+(h<0?Ia:-Ia),d):0;if(!t&&(l=u=v)&&e.lineStart(),v!==u&&(!(f=o(t,p))||Ko(t,f)||Ko(p,f))&&(p[2]=1),v!==u)c=0,v?(e.lineStart(),f=o(p,t),e.point(f[0],f[1])):(f=o(t,p),e.point(f[0],f[1],2),e.lineEnd()),t=f;else if(r&&t&&i^v){var g;m&n||!(g=o(p,t,!0))||(c=0,i?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1],3)))}!v||t&&Ko(t,p)||e.point(p[0],p[1]),t=p,u=v,n=m},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return c|(l&&u)<<1}}}),(function(t,i,r,a){ps(a,e,n,r,t,i)}),i?[0,-e]:[-Ia,e-Ia])}var gs=1e9,_s=-gs;function ys(e,t,n,i){function r(r,a){return e<=r&&r<=n&&t<=a&&a<=i}function a(r,a,s,l){var c=0,h=0;if(null==r||(c=o(r,s))!==(h=o(a,s))||u(r,a)<0^s>0)do{l.point(0===c||3===c?e:n,c>1?i:t)}while((c=(c+s+4)%4)!==h);else l.point(a[0],a[1])}function o(i,r){return Fa(i[0]-e)<Aa?r>0?0:3:Fa(i[0]-n)<Aa?r>0?2:1:Fa(i[1]-t)<Aa?r>0?1:0:r>0?3:2}function s(e,t){return u(e.x,t.x)}function u(e,t){var n=o(e,1),i=o(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var u,l,c,h,d,f,p,v,m,g,_,y=o,b=Yo(),x={point:w,lineStart:function(){x.point=k,l&&l.push(c=[]);g=!0,m=!1,p=v=NaN},lineEnd:function(){u&&(k(h,d),f&&m&&b.rejoin(),u.push(b.result()));x.point=w,m&&y.lineEnd()},polygonStart:function(){y=b,u=[],l=[],_=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=l.length;n<r;++n)for(var a,o,s=l[n],u=1,c=s.length,h=s[0],d=h[0],f=h[1];u<c;++u)a=d,o=f,d=(h=s[u])[0],f=h[1],o<=i?f>i&&(d-a)*(i-o)>(f-o)*(e-a)&&++t:f<=i&&(d-a)*(i-o)<(f-o)*(e-a)&&--t;return t}(),n=_&&t,r=(u=Pe(u)).length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),r&&Qo(u,s,t,a,o),o.polygonEnd());y=o,u=l=c=null}};function w(e,t){r(e,t)&&y.point(e,t)}function k(a,o){var s=r(a,o);if(l&&c.push([a,o]),g)h=a,d=o,f=s,g=!1,s&&(y.lineStart(),y.point(a,o));else if(s&&m)y.point(a,o);else{var u=[p=Math.max(_s,Math.min(gs,p)),v=Math.max(_s,Math.min(gs,v))],b=[a=Math.max(_s,Math.min(gs,a)),o=Math.max(_s,Math.min(gs,o))];!function(e,t,n,i,r,a){var o,s=e[0],u=e[1],l=0,c=1,h=t[0]-s,d=t[1]-u;if(o=n-s,h||!(o>0)){if(o/=h,h<0){if(o<l)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>l&&(l=o)}if(o=r-s,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>l&&(l=o)}else if(h>0){if(o<l)return;o<c&&(c=o)}if(o=i-u,d||!(o>0)){if(o/=d,d<0){if(o<l)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>l&&(l=o)}if(o=a-u,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>l&&(l=o)}else if(d>0){if(o<l)return;o<c&&(c=o)}return l>0&&(e[0]=s+l*h,e[1]=u+l*d),c<1&&(t[0]=s+c*h,t[1]=u+c*d),!0}}}}}(u,b,e,t,n,i)?s&&(y.lineStart(),y.point(a,o),_=!1):(m||(y.lineStart(),y.point(u[0],u[1])),y.point(b[0],b[1]),s||y.lineEnd(),_=!1)}p=a,v=o,m=s}return x}}function bs(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function xs(e,t){return[Fa(e)>Ia?e+Math.round(-e/Da)*Da:e,t]}function ws(e,t,n){return(e%=Da)?t||n?bs(Ss(e),Ms(t,n)):Ss(e):t||n?Ms(t,n):xs}function ks(e){return function(t,n){return[(t+=e)>Ia?t-Da:t<-Ia?t+Da:t,n]}}function Ss(e){var t=ks(e);return t.invert=ks(-e),t}function Ms(e,t){var n=ja(e),i=Ua(e),r=ja(t),a=Ua(t);function o(e,t){var o=ja(t),s=ja(e)*o,u=Ua(e)*o,l=Ua(t),c=l*n+s*i;return[$a(u*r-c*a,s*n-l*i),Wa(c*r+u*a)]}return o.invert=function(e,t){var o=ja(t),s=ja(e)*o,u=Ua(e)*o,l=Ua(t),c=l*r-u*a;return[$a(u*r+l*a,s*n+c*i),Wa(c*n-s*i)]},o}function Ts(e){return{stream:Cs(e)}}function Cs(e){return function(t){var n=new Es;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Es(){}function Ps(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=i&&e.clipExtent(null),Ta(n,e.stream(vo)),t(vo.result()),null!=i&&e.clipExtent(i),e}function Ls(e,t,n){return Ps(e,(function(n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],a=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),o=+t[0][0]+(i-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(r-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}xs.invert=xs,Es.prototype={constructor:Es,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var As=ja(30*za);function Is(e,t){return+t?function(e,t){function n(i,r,a,o,s,u,l,c,h,d,f,p,v,m){var g=l-i,_=c-r,y=g*g+_*_;if(y>4*t&&v--){var b=o+d,x=s+f,w=u+p,k=Ha(b*b+x*x+w*w),S=Wa(w/=k),M=Fa(Fa(w)-1)<Aa||Fa(a-h)<Aa?(a+h)/2:$a(x,b),T=e(M,S),C=T[0],E=T[1],P=C-i,L=E-r,A=_*P-g*L;(A*A/y>t||Fa((g*P+_*L)/y-.5)>.3||o*d+s*f+u*p<As)&&(n(i,r,a,o,s,u,C,E,M,b/=k,x/=k,w,v,m),m.point(C,E),n(C,E,M,b,x,w,l,c,h,d,f,p,v,m))}}return function(t){var i,r,a,o,s,u,l,c,h,d,f,p,v={point:m,lineStart:g,lineEnd:y,polygonStart:function(){t.polygonStart(),v.lineStart=b},polygonEnd:function(){t.polygonEnd(),v.lineStart=g}};function m(n,i){n=e(n,i),t.point(n[0],n[1])}function g(){c=NaN,v.point=_,t.lineStart()}function _(i,r){var a=ns([i,r]),o=e(i,r);n(c,h,l,d,f,p,c=o[0],h=o[1],l=i,d=a[0],f=a[1],p=a[2],16,t),t.point(c,h)}function y(){v.point=m,t.lineEnd()}function b(){g(),v.point=x,v.lineEnd=w}function x(e,t){_(i=e,t),r=c,a=h,o=d,s=f,u=p,v.point=_}function w(){n(c,h,l,d,f,p,r,a,i,o,s,u,16,t),v.lineEnd=y,y()}return v}}(e,t):function(e){return Cs({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var Rs=Cs({point:function(e,t){this.stream.point(e*za,t*za)}});function Ns(e,t,n,i,r){function a(a,o){return[t+e*(a*=i),n-e*(o*=r)]}return a.invert=function(a,o){return[(a-t)/e*i,(n-o)/e*r]},a}function Ds(e,t,n,i,r,a){var o=ja(a),s=Ua(a),u=o*e,l=s*e,c=o/e,h=s/e,d=(s*n-o*t)/e,f=(s*t+o*n)/e;function p(e,a){return[u*(e*=i)-l*(a*=r)+t,n-l*e-u*a]}return p.invert=function(e,t){return[i*(c*e-h*t+d),r*(f-h*e-c*t)]},p}function Os(e){return function(e){var t,n,i,r,a,o,s,u,l,c,h=150,d=480,f=250,p=0,v=0,m=0,g=0,_=0,y=0,b=1,x=1,w=null,k=fs,S=null,M=ba,T=.5;function C(e){return u(e[0]*za,e[1]*za)}function E(e){return(e=u.invert(e[0],e[1]))&&[e[0]*Oa,e[1]*Oa]}function P(){var e=Ds(h,0,0,b,x,y).apply(null,t(p,v)),i=(y?Ds:Ns)(h,d-e[0],f-e[1],b,x,y);return n=ws(m,g,_),s=bs(t,i),u=bs(n,s),o=Is(s,T),L()}function L(){return l=c=null,C}return C.stream=function(e){return l&&c===e?l:l=Rs(function(e){return Cs({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}(n)(k(o(M(c=e)))))},C.preclip=function(e){return arguments.length?(k=e,w=void 0,L()):k},C.postclip=function(e){return arguments.length?(M=e,S=i=r=a=null,L()):M},C.clipAngle=function(e){return arguments.length?(k=+e?ms(w=e*za):(w=null,fs),L()):w*Oa},C.clipExtent=function(e){return arguments.length?(M=null==e?(S=i=r=a=null,ba):ys(S=+e[0][0],i=+e[0][1],r=+e[1][0],a=+e[1][1]),L()):null==S?null:[[S,i],[r,a]]},C.scale=function(e){return arguments.length?(h=+e,P()):h},C.translate=function(e){return arguments.length?(d=+e[0],f=+e[1],P()):[d,f]},C.center=function(e){return arguments.length?(p=e[0]%360*za,v=e[1]%360*za,P()):[p*Oa,v*Oa]},C.rotate=function(e){return arguments.length?(m=e[0]%360*za,g=e[1]%360*za,_=e.length>2?e[2]%360*za:0,P()):[m*Oa,g*Oa,_*Oa]},C.angle=function(e){return arguments.length?(y=e%360*za,P()):y*Oa},C.reflectX=function(e){return arguments.length?(b=e?-1:1,P()):b<0},C.reflectY=function(e){return arguments.length?(x=e?-1:1,P()):x<0},C.precision=function(e){return arguments.length?(o=Is(s,T=e*e),L()):Ha(T)},C.fitExtent=function(e,t){return Ls(C,e,t)},C.fitSize=function(e,t){return function(e,t,n){return Ls(e,[[0,0],t],n)}(C,e,t)},C.fitWidth=function(e,t){return function(e,t,n){return Ps(e,(function(n){var i=+t,r=i/(n[1][0]-n[0][0]),a=(i-r*(n[1][0]+n[0][0]))/2,o=-r*n[0][1];e.scale(150*r).translate([a,o])}),n)}(C,e,t)},C.fitHeight=function(e,t){return function(e,t,n){return Ps(e,(function(n){var i=+t,r=i/(n[1][1]-n[0][1]),a=-r*n[0][0],o=(i-r*(n[1][1]+n[0][1]))/2;e.scale(150*r).translate([a,o])}),n)}(C,e,t)},function(){return t=e.apply(this,arguments),C.invert=t.invert&&E,P()}}((function(){return e}))()}function zs(e,t){return[e,t]}function Fs(){return Os(zs).scale(152.63)}function Bs(){return Math.random()}zs.invert=zs;(function e(t){function n(e,n){return e=null==e?0:+e,n=null==n?1:+n,1===arguments.length?(n=e,e=0):n-=e,function(){return t()*n+e}}return n.source=e,n})(Bs);var $s=function e(t){function n(e,n){var i,r;return e=null==e?0:+e,n=null==n?1:+n,function(){var a;if(null!=i)a=i,i=null;else do{i=2*t()-1,a=2*t()-1,r=i*i+a*a}while(!r||r>1);return e+n*a*Math.sqrt(-2*Math.log(r)/r)}}return n.source=e,n}(Bs),js=(function e(t){function n(){var e=$s.source(t).apply(this,arguments);return function(){return Math.exp(e())}}return n.source=e,n}(Bs),function e(t){function n(e){return function(){for(var n=0,i=0;i<e;++i)n+=t();return n}}return n.source=e,n}(Bs)),Us=(function e(t){function n(e){var n=js.source(t)(e);return function(){return n()/e}}return n.source=e,n}(Bs),function e(t){function n(e){return function(){return-Math.log(1-t())/e}}return n.source=e,n}(Bs),Array.prototype),Vs=Us.map,Hs=Us.slice;function Ws(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Gs(e){return+e}var qs=[0,1];function Zs(e){return e}function Xs(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Ys(e){var t,n=e[0],i=e[e.length-1];return n>i&&(t=n,n=i,i=t),function(e){return Math.max(n,Math.min(i,e))}}function Ks(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];return r<i?(i=Xs(r,i),a=n(o,a)):(i=Xs(i,r),a=n(a,o)),function(e){return a(i(e))}}function Js(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=Xs(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=be(e,t,1,i)-1;return a[n](r[n](t))}}function Qs(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function eu(){var e,t,n,i,r,a,o=qs,s=qs,u=si,l=Zs;function c(){return i=Math.min(o.length,s.length)>2?Js:Ks,r=a=null,h}function h(t){return isNaN(t=+t)?n:(r||(r=i(o.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((a||(a=i(s,o.map(e),ti)))(n)))},h.domain=function(e){return arguments.length?(o=Vs.call(e,Gs),l===Zs||(l=Ys(o)),c()):o.slice()},h.range=function(e){return arguments.length?(s=Hs.call(e),c()):s.slice()},h.rangeRound=function(e){return s=Hs.call(e),u=Ws,c()},h.clamp=function(e){return arguments.length?(l=e?Ys(o):Zs,h):l!==Zs},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,i){return e=n,t=i,c()}}function tu(e,t){return eu()(e,t)}function nu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function iu(e,t,n,i){var r,a=Ce(e,t,n);switch((i=la(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(r=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(oa(t)/3)))-oa(Math.abs(e)))}(a,o))||(i.precision=r),ma(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,oa(t)-oa(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(e){return Math.max(0,-oa(Math.abs(e)))}(a))||(i.precision=r-2*("%"===i.type))}return va(i)}function ru(e){var t=e.domain;return e.ticks=function(e){var n=t();return Me(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return iu(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,r=t(),a=0,o=r.length-1,s=r[a],u=r[o];return u<s&&(i=s,s=u,u=i,i=a,a=o,o=i),(i=Te(s,u,n))>0?i=Te(s=Math.floor(s/i)*i,u=Math.ceil(u/i)*i,n):i<0&&(i=Te(s=Math.ceil(s*i)/i,u=Math.floor(u*i)/i,n)),i>0?(r[a]=Math.floor(s/i)*i,r[o]=Math.ceil(u/i)*i,t(r)):i<0&&(r[a]=Math.ceil(s*i)/i,r[o]=Math.floor(u*i)/i,t(r)),e},e}function au(){var e=tu(Zs,Zs);return e.copy=function(){return Qs(e,au())},nu.apply(e,arguments),ru(e)}function ou(e,t){var n,i=0,r=(e=e.slice()).length-1,a=e[i],o=e[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),e[i]=t.floor(a),e[r]=t.ceil(o),e}function su(e){return Math.log(e)}function uu(e){return Math.exp(e)}function lu(e){return-Math.log(-e)}function cu(e){return-Math.exp(-e)}function hu(e){return isFinite(e)?+("1e"+e):e<0?0:e}function du(e){return function(t){return-e(-t)}}function fu(e){var t,n,i=e(su,uu),r=i.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?hu:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),r()[0]<0?(t=du(t),n=du(n),e(lu,cu)):e(su,uu),i}return i.base=function(e){return arguments.length?(a=+e,o()):a},i.domain=function(e){return arguments.length?(r(e),o()):r()},i.ticks=function(e){var i,o=r(),s=o[0],u=o[o.length-1];(i=u<s)&&(d=s,s=u,u=d);var l,c,h,d=t(s),f=t(u),p=null==e?10:+e,v=[];if(!(a%1)&&f-d<p){if(d=Math.round(d)-1,f=Math.round(f)+1,s>0){for(;d<f;++d)for(c=1,l=n(d);c<a;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;d<f;++d)for(c=a-1,l=n(d);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=Me(d,f,Math.min(f-d,p)).map(n);return i?v.reverse():v},i.tickFormat=function(e,r){if(null==r&&(r=10===a?".0e":","),"function"!==typeof r&&(r=va(r)),e===1/0)return r;null==e&&(e=10);var o=Math.max(1,a*e/i.ticks().length);return function(e){var i=e/n(Math.round(t(e)));return i*a<a-.5&&(i*=a),i<=o?r(e):""}},i.nice=function(){return r(ou(r(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},i}function pu(){var e=fu(eu()).domain([1,10]);return e.copy=function(){return Qs(e,pu()).base(e.base())},nu.apply(e,arguments),e}var vu=new Date,mu=new Date;function gu(e,t,n,i){function r(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return r.floor=function(t){return e(t=new Date(+t)),t},r.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},r.round=function(e){var t=r(e),n=r.ceil(e);return e-t<n-e?t:n},r.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},r.range=function(n,i,a){var o,s=[];if(n=r.ceil(n),a=null==a?1:Math.floor(a),!(n<i)||!(a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<i);return s},r.filter=function(n){return gu((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,i){if(e>=e)if(i<0)for(;++i<=0;)for(;t(e,-1),!n(e););else for(;--i>=0;)for(;t(e,1),!n(e););}))},n&&(r.count=function(t,i){return vu.setTime(+t),mu.setTime(+i),e(vu),e(mu),Math.floor(n(vu,mu))},r.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?r.filter(i?function(t){return i(t)%e===0}:function(t){return r.count(0,t)%e===0}):r:null}),r}var _u=gu((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));_u.every=function(e){return isFinite(e=Math.floor(e))&&e>0?gu((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var yu=_u,bu=(_u.range,gu((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),xu=bu,wu=(bu.range,1e3),ku=6e4,Su=36e5,Mu=864e5,Tu=6048e5;function Cu(e){return gu((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ku)/Tu}))}var Eu=Cu(0),Pu=Cu(1),Lu=Cu(2),Au=Cu(3),Iu=Cu(4),Ru=Cu(5),Nu=Cu(6),Du=(Eu.range,Pu.range,Lu.range,Au.range,Iu.range,Ru.range,Nu.range,gu((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ku)/Mu}),(function(e){return e.getDate()-1}))),Ou=Du,zu=(Du.range,gu((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wu-e.getMinutes()*ku)}),(function(e,t){e.setTime(+e+t*Su)}),(function(e,t){return(t-e)/Su}),(function(e){return e.getHours()}))),Fu=zu,Bu=(zu.range,gu((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wu)}),(function(e,t){e.setTime(+e+t*ku)}),(function(e,t){return(t-e)/ku}),(function(e){return e.getMinutes()}))),$u=Bu,ju=(Bu.range,gu((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*wu)}),(function(e,t){return(t-e)/wu}),(function(e){return e.getUTCSeconds()}))),Uu=ju,Vu=(ju.range,gu((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e})));Vu.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?gu((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Vu:null};var Hu=Vu;Vu.range;function Wu(e){return gu((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Tu}))}var Gu=Wu(0),qu=Wu(1),Zu=Wu(2),Xu=Wu(3),Yu=Wu(4),Ku=Wu(5),Ju=Wu(6),Qu=(Gu.range,qu.range,Zu.range,Xu.range,Yu.range,Ku.range,Ju.range,gu((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Mu}),(function(e){return e.getUTCDate()-1}))),el=Qu,tl=(Qu.range,gu((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));tl.every=function(e){return isFinite(e=Math.floor(e))&&e>0?gu((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var nl=tl;tl.range;function il(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function rl(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function al(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var ol,sl,ul={"-":"",_:" ",0:"0"},ll=/^\s*\d+/,cl=/^%/,hl=/[\\^$*+?|[\]().{}]/g;function dl(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function fl(e){return e.replace(hl,"\\$&")}function pl(e){return new RegExp("^(?:"+e.map(fl).join("|")+")","i")}function vl(e){for(var t={},n=-1,i=e.length;++n<i;)t[e[n].toLowerCase()]=n;return t}function ml(e,t,n){var i=ll.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function gl(e,t,n){var i=ll.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function _l(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function yl(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function bl(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function xl(e,t,n){var i=ll.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function wl(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function kl(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Sl(e,t,n){var i=ll.exec(t.slice(n,n+1));return i?(e.q=3*i[0]-3,n+i[0].length):-1}function Ml(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function Tl(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Cl(e,t,n){var i=ll.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function El(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function Pl(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function Ll(e,t,n){var i=ll.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function Al(e,t,n){var i=ll.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function Il(e,t,n){var i=ll.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Rl(e,t,n){var i=cl.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function Nl(e,t,n){var i=ll.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function Dl(e,t,n){var i=ll.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function Ol(e,t){return dl(e.getDate(),t,2)}function zl(e,t){return dl(e.getHours(),t,2)}function Fl(e,t){return dl(e.getHours()%12||12,t,2)}function Bl(e,t){return dl(1+Ou.count(yu(e),e),t,3)}function $l(e,t){return dl(e.getMilliseconds(),t,3)}function jl(e,t){return $l(e,t)+"000"}function Ul(e,t){return dl(e.getMonth()+1,t,2)}function Vl(e,t){return dl(e.getMinutes(),t,2)}function Hl(e,t){return dl(e.getSeconds(),t,2)}function Wl(e){var t=e.getDay();return 0===t?7:t}function Gl(e,t){return dl(Eu.count(yu(e)-1,e),t,2)}function ql(e){var t=e.getDay();return t>=4||0===t?Iu(e):Iu.ceil(e)}function Zl(e,t){return e=ql(e),dl(Iu.count(yu(e),e)+(4===yu(e).getDay()),t,2)}function Xl(e){return e.getDay()}function Yl(e,t){return dl(Pu.count(yu(e)-1,e),t,2)}function Kl(e,t){return dl(e.getFullYear()%100,t,2)}function Jl(e,t){return dl((e=ql(e)).getFullYear()%100,t,2)}function Ql(e,t){return dl(e.getFullYear()%1e4,t,4)}function ec(e,t){var n=e.getDay();return dl((e=n>=4||0===n?Iu(e):Iu.ceil(e)).getFullYear()%1e4,t,4)}function tc(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+dl(t/60|0,"0",2)+dl(t%60,"0",2)}function nc(e,t){return dl(e.getUTCDate(),t,2)}function ic(e,t){return dl(e.getUTCHours(),t,2)}function rc(e,t){return dl(e.getUTCHours()%12||12,t,2)}function ac(e,t){return dl(1+el.count(nl(e),e),t,3)}function oc(e,t){return dl(e.getUTCMilliseconds(),t,3)}function sc(e,t){return oc(e,t)+"000"}function uc(e,t){return dl(e.getUTCMonth()+1,t,2)}function lc(e,t){return dl(e.getUTCMinutes(),t,2)}function cc(e,t){return dl(e.getUTCSeconds(),t,2)}function hc(e){var t=e.getUTCDay();return 0===t?7:t}function dc(e,t){return dl(Gu.count(nl(e)-1,e),t,2)}function fc(e){var t=e.getUTCDay();return t>=4||0===t?Yu(e):Yu.ceil(e)}function pc(e,t){return e=fc(e),dl(Yu.count(nl(e),e)+(4===nl(e).getUTCDay()),t,2)}function vc(e){return e.getUTCDay()}function mc(e,t){return dl(qu.count(nl(e)-1,e),t,2)}function gc(e,t){return dl(e.getUTCFullYear()%100,t,2)}function _c(e,t){return dl((e=fc(e)).getUTCFullYear()%100,t,2)}function yc(e,t){return dl(e.getUTCFullYear()%1e4,t,4)}function bc(e,t){var n=e.getUTCDay();return dl((e=n>=4||0===n?Yu(e):Yu.ceil(e)).getUTCFullYear()%1e4,t,4)}function xc(){return"+0000"}function wc(){return"%"}function kc(e){return+e}function Sc(e){return Math.floor(+e/1e3)}!function(e){ol=function(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,a=e.days,o=e.shortDays,s=e.months,u=e.shortMonths,l=pl(r),c=vl(r),h=pl(a),d=vl(a),f=pl(o),p=vl(o),v=pl(s),m=vl(s),g=pl(u),_=vl(u),y={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Ol,e:Ol,f:jl,g:Jl,G:ec,H:zl,I:Fl,j:Bl,L:$l,m:Ul,M:Vl,p:function(e){return r[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:kc,s:Sc,S:Hl,u:Wl,U:Gl,V:Zl,w:Xl,W:Yl,x:null,X:null,y:Kl,Y:Ql,Z:tc,"%":wc},b={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:nc,e:nc,f:sc,g:_c,G:bc,H:ic,I:rc,j:ac,L:oc,m:uc,M:lc,p:function(e){return r[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:kc,s:Sc,S:cc,u:hc,U:dc,V:pc,w:vc,W:mc,x:null,X:null,y:gc,Y:yc,Z:xc,"%":wc},x={a:function(e,t,n){var i=f.exec(t.slice(n));return i?(e.w=p[i[0].toLowerCase()],n+i[0].length):-1},A:function(e,t,n){var i=h.exec(t.slice(n));return i?(e.w=d[i[0].toLowerCase()],n+i[0].length):-1},b:function(e,t,n){var i=g.exec(t.slice(n));return i?(e.m=_[i[0].toLowerCase()],n+i[0].length):-1},B:function(e,t,n){var i=v.exec(t.slice(n));return i?(e.m=m[i[0].toLowerCase()],n+i[0].length):-1},c:function(e,n,i){return S(e,t,n,i)},d:Tl,e:Tl,f:Il,g:wl,G:xl,H:El,I:El,j:Cl,L:Al,m:Ml,M:Pl,p:function(e,t,n){var i=l.exec(t.slice(n));return i?(e.p=c[i[0].toLowerCase()],n+i[0].length):-1},q:Sl,Q:Nl,s:Dl,S:Ll,u:gl,U:_l,V:yl,w:ml,W:bl,x:function(e,t,i){return S(e,n,t,i)},X:function(e,t,n){return S(e,i,t,n)},y:wl,Y:xl,Z:kl,"%":Rl};function w(e,t){return function(n){var i,r,a,o=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(r=ul[i=e.charAt(++s)])?i=e.charAt(++s):r="e"===i?" ":"0",(a=t[i])&&(i=a(n,r)),o.push(i),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function k(e,t){return function(n){var i,r,a=al(1900,void 0,1);if(S(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(r=(i=rl(al(a.y,0,1))).getUTCDay(),i=r>4||0===r?qu.ceil(i):qu(i),i=el.offset(i,7*(a.V-1)),a.y=i.getUTCFullYear(),a.m=i.getUTCMonth(),a.d=i.getUTCDate()+(a.w+6)%7):(r=(i=il(al(a.y,0,1))).getDay(),i=r>4||0===r?Pu.ceil(i):Pu(i),i=Ou.offset(i,7*(a.V-1)),a.y=i.getFullYear(),a.m=i.getMonth(),a.d=i.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),r="Z"in a?rl(al(a.y,0,1)).getUTCDay():il(al(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(r+5)%7:a.w+7*a.U-(r+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,rl(a)):il(a)}}function S(e,t,n,i){for(var r,a,o=0,s=t.length,u=n.length;o<s;){if(i>=u)return-1;if(37===(r=t.charCodeAt(o++))){if(r=t.charAt(o++),!(a=x[r in ul?t.charAt(o++):r])||(i=a(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return y.x=w(n,y),y.X=w(i,y),y.c=w(t,y),b.x=w(n,b),b.X=w(i,b),b.c=w(t,b),{format:function(e){var t=w(e+="",y);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}(e),sl=ol.format,ol.parse,ol.utcFormat,ol.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Mc=1e3,Tc=6e4,Cc=36e5,Ec=864e5,Pc=2592e6,Lc=31536e6;function Ac(e){return new Date(e)}function Ic(e){return e instanceof Date?+e:+new Date(+e)}function Rc(e,t,n,i,r,a,o,s,u){var l=tu(Zs,Zs),c=l.invert,h=l.domain,d=u(".%L"),f=u(":%S"),p=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),g=u("%b %d"),_=u("%B"),y=u("%Y"),b=[[o,1,Mc],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,Tc],[a,5,3e5],[a,15,9e5],[a,30,18e5],[r,1,Cc],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,Ec],[i,2,1728e5],[n,1,6048e5],[t,1,Pc],[t,3,7776e6],[e,1,Lc]];function x(s){return(o(s)<s?d:a(s)<s?f:r(s)<s?p:i(s)<s?v:t(s)<s?n(s)<s?m:g:e(s)<s?_:y)(s)}function w(t,n,i,r){if(null==t&&(t=10),"number"===typeof t){var a=Math.abs(i-n)/t,o=ge((function(e){return e[2]})).right(b,a);o===b.length?(r=Ce(n/Lc,i/Lc,t),t=e):o?(r=(o=b[a/b[o-1][2]<b[o][2]/a?o-1:o])[1],t=o[0]):(r=Math.max(Ce(n,i,t),1),t=s)}return null==r?t:t.every(r)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?h(Vs.call(e,Ic)):h().map(Ac)},l.ticks=function(e,t){var n,i=h(),r=i[0],a=i[i.length-1],o=a<r;return o&&(n=r,r=a,a=n),n=(n=w(e,r,a,t))?n.range(r,a+1):[],o?n.reverse():n},l.tickFormat=function(e,t){return null==t?x:u(t)},l.nice=function(e,t){var n=h();return(e=w(e,n[0],n[n.length-1],t))?h(ou(n,e)):l},l.copy=function(){return Qs(l,Rc(e,t,n,i,r,a,o,s,u))},l}function Nc(e){return cn(Vt(e).call(document.documentElement))}var Dc=0;function Oc(){return new zc}function zc(){this._="@"+(++Dc).toString(36)}function Fc(e){return"string"===typeof e?new sn([document.querySelectorAll(e)],[document.documentElement]):new sn([null==e?[]:e],on)}function Bc(e,t){null==t&&(t=ui().touches);for(var n=0,i=t?t.length:0,r=new Array(i);n<i;++n)r[n]=li(e,t[n]);return r}function $c(){this._=null}function jc(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Uc(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function Vc(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function Hc(e){for(;e.L;)e=e.L;return e}zc.prototype=Oc.prototype={constructor:zc,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}},$c.prototype={constructor:$c,insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=Hc(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(i=n.U).L?(r=i.R)&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(Uc(this,n),n=(e=n).U),n.C=!1,i.C=!0,Vc(this,i)):(r=i.L)&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(Vc(this,n),n=(e=n).U),n.C=!1,i.C=!0,Uc(this,i)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,a=e.L,o=e.R;if(n=a?o?Hc(o):a:o,r?r.L===e?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=e.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=o,o.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===r.L){if((t=r.R).C&&(t.C=!1,r.C=!0,Uc(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Vc(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,Uc(this,r),e=this._;break}}else if((t=r.L).C&&(t.C=!1,r.C=!0,Vc(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Uc(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,Vc(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}};var Wc=$c;function Gc(e,t,n,i){var r=[null,null],a=mh.push(r)-1;return r.left=e,r.right=t,n&&Zc(r,e,t,n),i&&Zc(r,t,e,i),ph[e.index].halfedges.push(a),ph[t.index].halfedges.push(a),r}function qc(e,t,n){var i=[t,n];return i.left=e,i}function Zc(e,t,n,i){e[0]||e[1]?e.left===n?e[1]=i:e[0]=i:(e[0]=i,e.left=t,e.right=n)}function Xc(e,t,n,i,r){var a,o=e[0],s=e[1],u=o[0],l=o[1],c=0,h=1,d=s[0]-u,f=s[1]-l;if(a=t-u,d||!(a>0)){if(a/=d,d<0){if(a<c)return;a<h&&(h=a)}else if(d>0){if(a>h)return;a>c&&(c=a)}if(a=i-u,d||!(a<0)){if(a/=d,d<0){if(a>h)return;a>c&&(c=a)}else if(d>0){if(a<c)return;a<h&&(h=a)}if(a=n-l,f||!(a>0)){if(a/=f,f<0){if(a<c)return;a<h&&(h=a)}else if(f>0){if(a>h)return;a>c&&(c=a)}if(a=r-l,f||!(a<0)){if(a/=f,f<0){if(a>h)return;a>c&&(c=a)}else if(f>0){if(a<c)return;a<h&&(h=a)}return!(c>0||h<1)||(c>0&&(e[0]=[u+c*d,l+c*f]),h<1&&(e[1]=[u+h*d,l+h*f]),!0)}}}}}function Yc(e,t,n,i,r){var a=e[1];if(a)return!0;var o,s,u=e[0],l=e.left,c=e.right,h=l[0],d=l[1],f=c[0],p=c[1],v=(h+f)/2,m=(d+p)/2;if(p===d){if(v<t||v>=i)return;if(h>f){if(u){if(u[1]>=r)return}else u=[v,n];a=[v,r]}else{if(u){if(u[1]<n)return}else u=[v,r];a=[v,n]}}else if(s=m-(o=(h-f)/(p-d))*v,o<-1||o>1)if(h>f){if(u){if(u[1]>=r)return}else u=[(n-s)/o,n];a=[(r-s)/o,r]}else{if(u){if(u[1]<n)return}else u=[(r-s)/o,r];a=[(n-s)/o,n]}else if(d<p){if(u){if(u[0]>=i)return}else u=[t,o*t+s];a=[i,o*i+s]}else{if(u){if(u[0]<t)return}else u=[i,o*i+s];a=[t,o*t+s]}return e[0]=u,e[1]=a,!0}function Kc(e,t){var n=e.site,i=t.left,r=t.right;return n===r&&(r=i,i=n),r?Math.atan2(r[1]-i[1],r[0]-i[0]):(n===i?(i=t[1],r=t[0]):(i=t[0],r=t[1]),Math.atan2(i[0]-r[0],r[1]-i[1]))}function Jc(e,t){return t[+(t.left!==e.site)]}function Qc(e,t){return t[+(t.left===e.site)]}var eh,th=[];function nh(){jc(this),this.x=this.y=this.arc=this.site=this.cy=null}function ih(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,a=n.site;if(i!==a){var o=r[0],s=r[1],u=i[0]-o,l=i[1]-s,c=a[0]-o,h=a[1]-s,d=2*(u*h-l*c);if(!(d>=-_h)){var f=u*u+l*l,p=c*c+h*h,v=(h*f-l*p)/d,m=(u*p-c*f)/d,g=th.pop()||new nh;g.arc=e,g.site=r,g.x=v+o,g.y=(g.cy=m+s)+Math.sqrt(v*v+m*m),e.circle=g;for(var _=null,y=vh._;y;)if(g.y<y.y||g.y===y.y&&g.x<=y.x){if(!y.L){_=y.P;break}y=y.L}else{if(!y.R){_=y;break}y=y.R}vh.insert(_,g),_||(eh=g)}}}}function rh(e){var t=e.circle;t&&(t.P||(eh=t.N),vh.remove(t),th.push(t),jc(t),e.circle=null)}var ah=[];function oh(){jc(this),this.edge=this.site=this.circle=null}function sh(e){var t=ah.pop()||new oh;return t.site=e,t}function uh(e){rh(e),fh.remove(e),ah.push(e),jc(e)}function lh(e){var t=e.circle,n=t.x,i=t.cy,r=[n,i],a=e.P,o=e.N,s=[e];uh(e);for(var u=a;u.circle&&Math.abs(n-u.circle.x)<gh&&Math.abs(i-u.circle.cy)<gh;)a=u.P,s.unshift(u),uh(u),u=a;s.unshift(u),rh(u);for(var l=o;l.circle&&Math.abs(n-l.circle.x)<gh&&Math.abs(i-l.circle.cy)<gh;)o=l.N,s.push(l),uh(l),l=o;s.push(l),rh(l);var c,h=s.length;for(c=1;c<h;++c)l=s[c],u=s[c-1],Zc(l.edge,u.site,l.site,r);u=s[0],(l=s[h-1]).edge=Gc(u.site,l.site,null,r),ih(u),ih(l)}function ch(e){for(var t,n,i,r,a=e[0],o=e[1],s=fh._;s;)if((i=hh(s,o)-a)>gh)s=s.L;else{if(!((r=a-dh(s,o))>gh)){i>-gh?(t=s.P,n=s):r>-gh?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}!function(e){ph[e.index]={site:e,halfedges:[]}}(e);var u=sh(e);if(fh.insert(t,u),t||n){if(t===n)return rh(t),n=sh(t.site),fh.insert(u,n),u.edge=n.edge=Gc(t.site,u.site),ih(t),void ih(n);if(n){rh(t),rh(n);var l=t.site,c=l[0],h=l[1],d=e[0]-c,f=e[1]-h,p=n.site,v=p[0]-c,m=p[1]-h,g=2*(d*m-f*v),_=d*d+f*f,y=v*v+m*m,b=[(m*_-f*y)/g+c,(d*y-v*_)/g+h];Zc(n.edge,l,p,b),u.edge=Gc(l,e,null,b),n.edge=Gc(e,p,null,b),ih(t),ih(n)}else u.edge=Gc(t.site,u.site)}}function hh(e,t){var n=e.site,i=n[0],r=n[1],a=r-t;if(!a)return i;var o=e.P;if(!o)return-1/0;var s=(n=o.site)[0],u=n[1],l=u-t;if(!l)return s;var c=s-i,h=1/a-1/l,d=c/l;return h?(-d+Math.sqrt(d*d-2*h*(c*c/(-2*l)-u+l/2+r-a/2)))/h+i:(i+s)/2}function dh(e,t){var n=e.N;if(n)return hh(n,t);var i=e.site;return i[1]===t?i[0]:1/0}var fh,ph,vh,mh,gh=1e-6,_h=1e-12;function yh(e,t){return t[1]-e[1]||t[0]-e[0]}function bh(e,t){var n,i,r,a=e.sort(yh).pop();for(mh=[],ph=new Array(e.length),fh=new Wc,vh=new Wc;;)if(r=eh,a&&(!r||a[1]<r.y||a[1]===r.y&&a[0]<r.x))a[0]===n&&a[1]===i||(ch(a),n=a[0],i=a[1]),a=e.pop();else{if(!r)break;lh(r.arc)}if(function(){for(var e,t,n,i,r=0,a=ph.length;r<a;++r)if((e=ph[r])&&(i=(t=e.halfedges).length)){var o=new Array(i),s=new Array(i);for(n=0;n<i;++n)o[n]=n,s[n]=Kc(e,mh[t[n]]);for(o.sort((function(e,t){return s[t]-s[e]})),n=0;n<i;++n)s[n]=t[o[n]];for(n=0;n<i;++n)t[n]=s[n]}}(),t){var o=+t[0][0],s=+t[0][1],u=+t[1][0],l=+t[1][1];!function(e,t,n,i){for(var r,a=mh.length;a--;)Yc(r=mh[a],e,t,n,i)&&Xc(r,e,t,n,i)&&(Math.abs(r[0][0]-r[1][0])>gh||Math.abs(r[0][1]-r[1][1])>gh)||delete mh[a]}(o,s,u,l),function(e,t,n,i){var r,a,o,s,u,l,c,h,d,f,p,v,m=ph.length,g=!0;for(r=0;r<m;++r)if(a=ph[r]){for(o=a.site,s=(u=a.halfedges).length;s--;)mh[u[s]]||u.splice(s,1);for(s=0,l=u.length;s<l;)p=(f=Qc(a,mh[u[s]]))[0],v=f[1],h=(c=Jc(a,mh[u[++s%l]]))[0],d=c[1],(Math.abs(p-h)>gh||Math.abs(v-d)>gh)&&(u.splice(s,0,mh.push(qc(o,f,Math.abs(p-e)<gh&&i-v>gh?[e,Math.abs(h-e)<gh?d:i]:Math.abs(v-i)<gh&&n-p>gh?[Math.abs(d-i)<gh?h:n,i]:Math.abs(p-n)<gh&&v-t>gh?[n,Math.abs(h-n)<gh?d:t]:Math.abs(v-t)<gh&&p-e>gh?[Math.abs(d-t)<gh?h:e,t]:null))-1),++l);l&&(g=!1)}if(g){var _,y,b,x=1/0;for(r=0,g=null;r<m;++r)(a=ph[r])&&(b=(_=(o=a.site)[0]-e)*_+(y=o[1]-t)*y)<x&&(x=b,g=a);if(g){var w=[e,t],k=[e,i],S=[n,i],M=[n,t];g.halfedges.push(mh.push(qc(o=g.site,w,k))-1,mh.push(qc(o,k,S))-1,mh.push(qc(o,S,M))-1,mh.push(qc(o,M,w))-1)}}for(r=0;r<m;++r)(a=ph[r])&&(a.halfedges.length||delete ph[r])}(o,s,u,l)}this.edges=mh,this.cells=ph,fh=vh=mh=ph=null}bh.prototype={constructor:bh,polygons:function(){var e=this.edges;return this.cells.map((function(t){var n=t.halfedges.map((function(n){return Jc(t,e[n])}));return n.data=t.site.data,n}))},triangles:function(){var e=[],t=this.edges;return this.cells.forEach((function(n,i){if(a=(r=n.halfedges).length)for(var r,a,o,s,u,l,c=n.site,h=-1,d=t[r[a-1]],f=d.left===c?d.right:d.left;++h<a;)o=f,f=(d=t[r[h]]).left===c?d.right:d.left,o&&f&&i<o.index&&i<f.index&&(u=o,l=f,((s=c)[0]-l[0])*(u[1]-s[1])-(s[0]-u[0])*(l[1]-s[1])<0)&&e.push([c.data,o.data,f.data])})),e},links:function(){return this.edges.filter((function(e){return e.right})).map((function(e){return{source:e.left.data,target:e.right.data}}))},find:function(e,t,n){for(var i,r,a=this,o=a._found||0,s=a.cells.length;!(r=a.cells[o]);)if(++o>=s)return null;var u=e-r.site[0],l=t-r.site[1],c=u*u+l*l;do{r=a.cells[i=o],o=null,r.halfedges.forEach((function(n){var i=a.edges[n],s=i.left;if(s!==r.site&&s||(s=i.right)){var u=e-s[0],l=t-s[1],h=u*u+l*l;h<c&&(c=h,o=s.index)}}))}while(null!==o);return a._found=i,null==n||c<=n*n?r.site:null}};var xh=Math.SQRT2;function wh(e){return((e=Math.exp(e))+1/e)/2}function kh(e,t){var n,i,r=e[0],a=e[1],o=e[2],s=t[0],u=t[1],l=t[2],c=s-r,h=u-a,d=c*c+h*h;if(d<1e-12)i=Math.log(l/o)/xh,n=function(e){return[r+e*c,a+e*h,o*Math.exp(xh*e*i)]};else{var f=Math.sqrt(d),p=(l*l-o*o+4*d)/(2*o*2*f),v=(l*l-o*o-4*d)/(2*l*2*f),m=Math.log(Math.sqrt(p*p+1)-p),g=Math.log(Math.sqrt(v*v+1)-v);i=(g-m)/xh,n=function(e){var t=e*i,n=wh(m),s=o/(2*f)*(n*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(xh*t+m)-function(e){return((e=Math.exp(e))-1/e)/2}(m));return[r+s*c,a+s*h,o*n/wh(xh*t+m)]}}return n.duration=1e3*i,n}function Sh(e){return function(){return e}}function Mh(e,t,n){this.target=e,this.type=t,this.transform=n}function Th(e,t,n){this.k=e,this.x=t,this.y=n}Th.prototype={constructor:Th,scale:function(e){return 1===e?this:new Th(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Th(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ch=new Th(1,0,0);function Eh(){Xt.stopImmediatePropagation()}function Ph(){Xt.preventDefault(),Xt.stopImmediatePropagation()}function Lh(){return!Xt.ctrlKey&&!Xt.button}function Ah(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Ih(){return this.__zoom||Ch}function Rh(){return-Xt.deltaY*(1===Xt.deltaMode?.05:Xt.deltaMode?1:.002)}function Nh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Dh(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],a=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function Oh(){var e,t,n=Lh,i=Ah,r=Dh,a=Rh,o=Nh,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],l=250,c=kh,h=Ke("start","zoom","end"),d=500,f=0;function p(e){e.property("__zoom",Ih).on("wheel.zoom",x).on("mousedown.zoom",w).on("dblclick.zoom",k).filter(o).on("touchstart.zoom",S).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(e,t){return(t=Math.max(s[0],Math.min(s[1],t)))===e.k?e:new Th(t,e.x,e.y)}function m(e,t,n){var i=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return i===e.x&&r===e.y?e:new Th(e.k,i,r)}function g(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function _(e,t,n){e.on("start.zoom",(function(){y(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){y(this,arguments).end()})).tween("zoom",(function(){var e=this,r=arguments,a=y(e,r),o=i.apply(e,r),s=null==n?g(o):"function"===typeof n?n.apply(e,r):n,u=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),l=e.__zoom,h="function"===typeof t?t.apply(e,r):t,d=c(l.invert(s).concat(u/l.k),h.invert(s).concat(u/h.k));return function(e){if(1===e)e=h;else{var t=d(e),n=u/t[2];e=new Th(n,s[0]-t[0]*n,s[1]-t[1]*n)}a.zoom(null,e)}}))}function y(e,t,n){return!n&&e.__zooming||new b(e,t)}function b(e,t){this.that=e,this.args=t,this.active=0,this.extent=i.apply(e,t),this.taps=0}function x(){if(n.apply(this,arguments)){var e=y(this,arguments),t=this.__zoom,i=Math.max(s[0],Math.min(s[1],t.k*Math.pow(2,a.apply(this,arguments)))),o=hi(this);if(e.wheel)e.mouse[0][0]===o[0]&&e.mouse[0][1]===o[1]||(e.mouse[1]=t.invert(e.mouse[0]=o)),clearTimeout(e.wheel);else{if(t.k===i)return;e.mouse=[o,t.invert(o)],Oi(this),e.start()}Ph(),e.wheel=setTimeout(l,150),e.zoom("mouse",r(m(v(t,i),e.mouse[0],e.mouse[1]),e.extent,u))}function l(){e.wheel=null,e.end()}}function w(){if(!t&&n.apply(this,arguments)){var e=y(this,arguments,!0),i=cn(Xt.view).on("mousemove.zoom",l,!0).on("mouseup.zoom",c,!0),a=hi(this),o=Xt.clientX,s=Xt.clientY;fn(Xt.view),Eh(),e.mouse=[a,this.__zoom.invert(a)],Oi(this),e.start()}function l(){if(Ph(),!e.moved){var t=Xt.clientX-o,n=Xt.clientY-s;e.moved=t*t+n*n>f}e.zoom("mouse",r(m(e.that.__zoom,e.mouse[0]=hi(e.that),e.mouse[1]),e.extent,u))}function c(){i.on("mousemove.zoom mouseup.zoom",null),pn(Xt.view,e.moved),Ph(),e.end()}}function k(){if(n.apply(this,arguments)){var e=this.__zoom,t=hi(this),a=e.invert(t),o=e.k*(Xt.shiftKey?.5:2),s=r(m(v(e,o),t,a),i.apply(this,arguments),u);Ph(),l>0?cn(this).transition().duration(l).call(_,s,t):cn(this).call(p.transform,s)}}function S(){if(n.apply(this,arguments)){var t,i,r,a,o=Xt.touches,s=o.length,u=y(this,arguments,Xt.changedTouches.length===s);for(Eh(),i=0;i<s;++i)a=[a=ci(this,o,(r=o[i]).identifier),this.__zoom.invert(a),r.identifier],u.touch0?u.touch1||u.touch0[2]===a[2]||(u.touch1=a,u.taps=0):(u.touch0=a,t=!0,u.taps=1+!!e);e&&(e=clearTimeout(e)),t&&(u.taps<2&&(e=setTimeout((function(){e=null}),d)),Oi(this),u.start())}}function M(){if(this.__zooming){var t,n,i,a,o=y(this,arguments),s=Xt.changedTouches,l=s.length;for(Ph(),e&&(e=clearTimeout(e)),o.taps=0,t=0;t<l;++t)i=ci(this,s,(n=s[t]).identifier),o.touch0&&o.touch0[2]===n.identifier?o.touch0[0]=i:o.touch1&&o.touch1[2]===n.identifier&&(o.touch1[0]=i);if(n=o.that.__zoom,o.touch1){var c=o.touch0[0],h=o.touch0[1],d=o.touch1[0],f=o.touch1[1],p=(p=d[0]-c[0])*p+(p=d[1]-c[1])*p,g=(g=f[0]-h[0])*g+(g=f[1]-h[1])*g;n=v(n,Math.sqrt(p/g)),i=[(c[0]+d[0])/2,(c[1]+d[1])/2],a=[(h[0]+f[0])/2,(h[1]+f[1])/2]}else{if(!o.touch0)return;i=o.touch0[0],a=o.touch0[1]}o.zoom("touch",r(m(n,i,a),o.extent,u))}}function T(){if(this.__zooming){var e,n,i=y(this,arguments),r=Xt.changedTouches,a=r.length;for(Eh(),t&&clearTimeout(t),t=setTimeout((function(){t=null}),d),e=0;e<a;++e)n=r[e],i.touch0&&i.touch0[2]===n.identifier?delete i.touch0:i.touch1&&i.touch1[2]===n.identifier&&delete i.touch1;if(i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0)i.touch0[1]=this.__zoom.invert(i.touch0[0]);else if(i.end(),2===i.taps){var o=cn(this).on("dblclick.zoom");o&&o.apply(this,arguments)}}}return p.transform=function(e,t,n){var i=e.selection?e.selection():e;i.property("__zoom",Ih),e!==i?_(e,t,n):i.interrupt().each((function(){y(this,arguments).start().zoom(null,"function"===typeof t?t.apply(this,arguments):t).end()}))},p.scaleBy=function(e,t,n){p.scaleTo(e,(function(){var e=this.__zoom.k,n="function"===typeof t?t.apply(this,arguments):t;return e*n}),n)},p.scaleTo=function(e,t,n){p.transform(e,(function(){var e=i.apply(this,arguments),a=this.__zoom,o=null==n?g(e):"function"===typeof n?n.apply(this,arguments):n,s=a.invert(o),l="function"===typeof t?t.apply(this,arguments):t;return r(m(v(a,l),o,s),e,u)}),n)},p.translateBy=function(e,t,n){p.transform(e,(function(){return r(this.__zoom.translate("function"===typeof t?t.apply(this,arguments):t,"function"===typeof n?n.apply(this,arguments):n),i.apply(this,arguments),u)}))},p.translateTo=function(e,t,n,a){p.transform(e,(function(){var e=i.apply(this,arguments),o=this.__zoom,s=null==a?g(e):"function"===typeof a?a.apply(this,arguments):a;return r(Ch.translate(s[0],s[1]).scale(o.k).translate("function"===typeof t?-t.apply(this,arguments):-t,"function"===typeof n?-n.apply(this,arguments):-n),e,u)}),a)},b.prototype={start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){tn(new Mh(p,e,this.that.__zoom),h.apply,h,[e,this.that,this.args])}},p.wheelDelta=function(e){return arguments.length?(a="function"===typeof e?e:Sh(+e),p):a},p.filter=function(e){return arguments.length?(n="function"===typeof e?e:Sh(!!e),p):n},p.touchable=function(e){return arguments.length?(o="function"===typeof e?e:Sh(!!e),p):o},p.extent=function(e){return arguments.length?(i="function"===typeof e?e:Sh([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),p):i},p.scaleExtent=function(e){return arguments.length?(s[0]=+e[0],s[1]=+e[1],p):[s[0],s[1]]},p.translateExtent=function(e){return arguments.length?(u[0][0]=+e[0][0],u[1][0]=+e[1][0],u[0][1]=+e[0][1],u[1][1]=+e[1][1],p):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},p.constrain=function(e){return arguments.length?(r=e,p):r},p.duration=function(e){return arguments.length?(l=+e,p):l},p.interpolate=function(e){return arguments.length?(c=e,p):c},p.on=function(){var e=h.on.apply(h,arguments);return e===h?p:e},p.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,p):Math.sqrt(f)},p}Th.prototype;var zh="event";function Fh(t){var n=!(zh in e);return function(i,r){n?t.call(this,i,r):t.call(this,e.event,i)}}function Bh(e){return function(){return e}}function $h(e,t,n,i,r,a,o,s,u,l){this.target=e,this.type=t,this.subject=n,this.identifier=i,this.active=r,this.x=a,this.y=o,this.dx=s,this.dy=u,this._=l}function jh(){return!Xt.ctrlKey&&!Xt.button}function Uh(){return this.parentNode}function Vh(e){return null==e?{x:Xt.x,y:Xt.y}:e}function Hh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Wh(e){return e*(2-e)}$h.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Gh(e){return"translate("+e+",0)"}function qh(e){return"translate(0,"+e+")"}function Zh(e,t){t="undefined"!==typeof t?t.copy():null;var n=[0],i=[0],r=[0,10],a=100,o=100,s=!0,u="M-5.5,-5.5v10l6,5.5l6,-5.5v-10z",l=null,c=null,h=3,d=null,f=null,p=null,v=null,m=null,g=Ke("onchange","start","end","drag"),_=null,y=null,b=null,x=1===e||4===e?-1:1,w=4===e||2===e?-1:1,k=4===e||2===e?"y":"x",S=4===e||2===e?"x":"y",M=1===e||3===e?Gh:qh,T=1===e||3===e?qh:Gh,C=null;switch(e){case 1:C=je;break;case 2:C=Ue;break;case 3:C=Ve;break;case 4:C=He}var E=null,P=null,L=null;function A(i){_=i.selection?i.selection():i,t||(t=r[0]instanceof Date?function(){return nu.apply(Rc(yu,xu,Eu,Ou,Fu,$u,Uu,Hu,sl).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}():au(),t=t.domain(r).range(1===e||3===e?[0,a]:[o,0]).clamp(!0)),y=au().range(t.range()).domain(t.range()).clamp(!0),n=n.map((function(e){return au().range(r).domain(r).clamp(!0)(e)})),f=f||t.tickFormat(),v=v||f||t.tickFormat(),_.selectAll(".axis").data([null]).enter().append("g").attr("transform",T(7*x)).attr("class","axis");var O=_.selectAll(".slider").data([null]),z=O.enter().append("g").attr("class","slider").attr("cursor",1===e||3===e?"ew-resize":"ns-resize").call(function(){var e,t,n,i,r=jh,a=Uh,o=Vh,s=Hh,u={},l=Ke("start","drag","end"),c=0,h=0;function d(e){e.on("mousedown.drag",f).filter(s).on("touchstart.drag",m).on("touchmove.drag",g).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(){if(!i&&r.apply(this,arguments)){var o=y("mouse",a.apply(this,arguments),hi,this,arguments);o&&(cn(Xt.view).on("mousemove.drag",p,!0).on("mouseup.drag",v,!0),fn(Xt.view),hn(),n=!1,e=Xt.clientX,t=Xt.clientY,o("start"))}}function p(){if(dn(),!n){var i=Xt.clientX-e,r=Xt.clientY-t;n=i*i+r*r>h}u.mouse("drag")}function v(){cn(Xt.view).on("mousemove.drag mouseup.drag",null),pn(Xt.view,n),dn(),u.mouse("end")}function m(){if(r.apply(this,arguments)){var e,t,n=Xt.changedTouches,i=a.apply(this,arguments),o=n.length;for(e=0;e<o;++e)(t=y(n[e].identifier,i,ci,this,arguments))&&(hn(),t("start"))}}function g(){var e,t,n=Xt.changedTouches,i=n.length;for(e=0;e<i;++e)(t=u[n[e].identifier])&&(dn(),t("drag"))}function _(){var e,t,n=Xt.changedTouches,r=n.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),e=0;e<r;++e)(t=u[n[e].identifier])&&(hn(),t("end"))}function y(e,t,n,i,r){var a,s,h,f=n(t,e),p=l.copy();if(tn(new $h(d,"beforestart",a,e,c,f[0],f[1],0,0,p),(function(){return null!=(Xt.subject=a=o.apply(i,r))&&(s=a.x-f[0]||0,h=a.y-f[1]||0,!0)})))return function o(l){var v,m=f;switch(l){case"start":u[e]=o,v=c++;break;case"end":delete u[e],--c;case"drag":f=n(t,e),v=c}tn(new $h(d,l,a,e,v,f[0]+s,f[1]+h,f[0]-m[0],f[1]-m[1],p),p.apply,p,[l,i,r])}}return d.filter=function(e){return arguments.length?(r="function"===typeof e?e:Bh(!!e),d):r},d.container=function(e){return arguments.length?(a="function"===typeof e?e:Bh(e),d):a},d.subject=function(e){return arguments.length?(o="function"===typeof e?e:Bh(e),d):o},d.touchable=function(e){return arguments.length?(s="function"===typeof e?e:Bh(!!e),d):s},d.on=function(){var e=l.on.apply(l,arguments);return e===l?d:e},d.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,d):Math.sqrt(h)},d}().on("start",Fh((function(i){cn(this).classed("active",!0);var a=y(3===e||1===e?i.x:i.y);b=n[0]===r[0]&&n[1]===r[0]?1:n[0]===r[1]&&n[1]===r[1]?0:Ae(n.map((function(e){return Math.abs(e-R(t.invert(a)))})));var o=n.map((function(e,n){return n===b?R(t.invert(a)):e}));D(o),g.call("start",O,1===o.length?o[0]:o),N(o,!0)}))).on("drag",Fh((function(t){var n=B(y(3===e||1===e?t.x:t.y));D(n),g.call("drag",O,1===n.length?n[0]:n),N(n,!0)}))).on("end",Fh((function(t){cn(this).classed("active",!1);var n=B(y(3===e||1===e?t.x:t.y));D(n),g.call("end",O,1===n.length?n[0]:n),N(n,!0),b=null}))));z.append("line").attr("class","track").attr(k+"1",t.range()[0]-8*w).attr("stroke","#bbb").attr("stroke-width",6).attr("stroke-linecap","round"),z.append("line").attr("class","track-inset").attr(k+"1",t.range()[0]-8*w).attr("stroke","#eee").attr("stroke-width",4).attr("stroke-linecap","round"),m&&z.append("line").attr("class","track-fill").attr(k+"1",1===n.length?t.range()[0]-8*w:t(n[0])).attr("stroke",m).attr("stroke-width",4).attr("stroke-linecap","round"),z.append("line").attr("class","track-overlay").attr(k+"1",t.range()[0]-8*w).attr("stroke","transparent").attr("stroke-width",40).attr("stroke-linecap","round").merge(O.select(".track-overlay")),E=z.selectAll(".parameter-value").data(n.map((function(e,t){return{value:e,index:t}})));var F=E.enter().append("g").attr("class","parameter-value").attr("transform",(function(e){return M(t(e.value))})).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle");function B(e){var i=R(t.invert(e));return n.map((function(e,t){return 2===n.length?t===b?0===b?Math.min(i,R(n[1])):Math.max(i,R(n[0])):e:t===b?i:e}))}F.append("path").attr("transform","rotate("+90*(e+1)+")").attr("d",u).attr("class","handle").attr("aria-label","handle").attr("aria-valuemax",r[1]).attr("aria-valuemin",r[0]).attr("aria-valuenow",(function(e){return e.value})).attr("aria-orientation",4===e||2===e?"vertical":"horizontal").attr("focusable","true").attr("tabindex",0).attr("fill","white").attr("stroke","#777").on("keydown",Fh((function(e,t){var i=l||(r[1]-r[0])/100,a=d?Ae(d.map((function(e){return Math.abs(n[t.index]-e)}))):null;function o(e){return n.map((function(i,r){return 2===n.length?r===t.index?0===t.index?Math.min(e,R(n[1])):Math.max(e,R(n[0])):i:r===t.index?e:i}))}switch(e.key){case"ArrowLeft":case"ArrowDown":d?A.value(o(d[Math.max(0,a-1)])):A.value(o(+n[t.index]-i)),e.preventDefault();break;case"PageDown":d?A.value(o(d[Math.max(0,a-2)])):A.value(o(+n[t.index]-2*i)),e.preventDefault();break;case"ArrowRight":case"ArrowUp":d?A.value(o(d[Math.min(d.length-1,a+1)])):A.value(o(+n[t.index]+i)),e.preventDefault();break;case"PageUp":d?A.value(o(d[Math.min(d.length-1,a+2)])):A.value(o(+n[t.index]+2*i)),e.preventDefault();break;case"Home":A.value(o(r[0])),e.preventDefault();break;case"End":A.value(o(r[1])),e.preventDefault()}}))),s&&F.append("text").attr("font-size",10).attr(S,x*(24+h)).attr("dy",1===e?"0em":3===e?".71em":".32em").attr("transform",n.length>1?"translate(0,0)":null).text((function(e,t){return v(n[t])})),i.select(".track").attr(k+"2",t.range()[1]+8*w),i.select(".track-inset").attr(k+"2",t.range()[1]+8*w),m&&i.select(".track-fill").attr(k+"2",1===n.length?t(n[0]):t(n[1])),i.select(".track-overlay").attr(k+"2",t.range()[1]+8*w),i.select(".axis").call(C(t).tickFormat(f).ticks(p).tickValues(c).tickPadding(h)),_.select(".axis").select(".domain").remove(),i.select(".axis").attr("transform",T(7*x)),i.selectAll(".axis text").attr("fill","#aaa").attr(S,x*(17+h)).attr("dy",1===e?"0em":3===e?".71em":".32em").attr("text-anchor",2===e?"start":4===e?"end":"middle"),i.selectAll(".axis line").attr("stroke","#aaa"),i.selectAll(".parameter-value").attr("transform",(function(e){return M(t(e.value))})),I(),L=_.selectAll(".parameter-value text"),P=_.select(".track-fill")}function I(){if(_&&s){var e=[];if(n.forEach((function(t){var n=[];_.selectAll(".axis .tick").each((function(e){n.push(Math.abs(e-t))})),e.push(Ae(n))})),_.selectAll(".axis .tick text").attr("opacity",(function(t,n){return~e.indexOf(n)?0:1})),L&&n.length>1){var t,i,r=[],a=[];L.nodes().forEach((function(e,n){t=e.getBoundingClientRect(),i=e.getAttribute("transform").split(/[()]/)[1].split(",")["x"===k?0:1],r[n]=t[k]-parseFloat(i),a[n]=t["x"===k?"width":"height"]})),"x"===k?(i=Math.max(0,(r[0]+a[0]-r[1])/2),L.attr("transform",(function(e,t){return"translate("+(1===t?i:-i)+",0)"}))):(i=Math.max(0,(r[1]+a[1]-r[0])/2),L.attr("transform",(function(e,t){return"translate(0,"+(1===t?-i:i)+")"})))}}}function R(e){if(d){var t=Ae(d.map((function(t){return Math.abs(e-t)})));return d[t]}if(l){var n=(e-r[0])%l,i=e-n;return 2*n>l&&(i+=l),e instanceof Date?new Date(i):i}return e}function N(e,t){(n[0]!==e[0]||n.length>1&&n[1]!==e[1])&&(n=e,t&&g.call("onchange",A,1===e.length?e[0]:e),I())}function D(e,i){_&&((i="undefined"!==typeof i&&i)?(_.selectAll(".parameter-value").data(e.map((function(e,t){return{value:e,index:t}}))).transition().ease(Wh).duration(200).attr("transform",(function(e){return M(t(e.value))})).select(".handle").attr("aria-valuenow",(function(e){return e.value})),m&&P.transition().ease(Wh).duration(200).attr(k+"1",1===n.length?t.range()[0]-8*x:t(e[0])).attr(k+"2",1===n.length?t(e[0]):t(e[1]))):(_.selectAll(".parameter-value").data(e.map((function(e,t){return{value:e,index:t}}))).attr("transform",(function(e){return M(t(e.value))})).select(".handle").attr("aria-valuenow",(function(e){return e.value})),m&&P.attr(k+"1",1===n.length?t.range()[0]-8*x:t(e[0])).attr(k+"2",1===n.length?t(e[0]):t(e[1]))),s&&L.text((function(t,n){return v(e[n])})))}return t&&(r=[Le(t.domain()),Ee(t.domain())],1===e||3===e?a=Ee(t.range())-Le(t.range()):o=Ee(t.range())-Le(t.range()),t=t.clamp(!0)),A.min=function(e){return arguments.length?(r[0]=e,t&&t.domain(r),A):r[0]},A.max=function(e){return arguments.length?(r[1]=e,t&&t.domain(r),A):r[1]},A.domain=function(e){return arguments.length?(r=e,t&&t.domain(r),A):r},A.width=function(e){return arguments.length?(a=e,t&&t.range([t.range()[0],t.range()[0]+a]),A):a},A.height=function(e){return arguments.length?(o=e,t&&t.range([t.range()[0],t.range()[0]+o]),A):o},A.tickFormat=function(e){return arguments.length?(f=e,A):f},A.displayFormat=function(e){return arguments.length?(v=e,A):v},A.ticks=function(e){return arguments.length?(p=e,A):p},A.value=function(e){if(!arguments.length)return 1===n.length?n[0]:n;var i=Array.isArray(e)?e:[e];if(i.sort((function(e,t){return e-t})),t){var r=i.map(t).map(y),a=r.map(t.invert).map(R);D(a,!0),N(a,!0)}else n=i;return A},A.silentValue=function(e){if(!arguments.length)return 1===n.length?n[0]:n;var i=Array.isArray(e)?e:[e];if(i.sort((function(e,t){return e-t})),t){var r=i.map(t).map(y),a=r.map(t.invert).map(R);D(a,!1),N(a,!1)}else n=i;return A},A.default=function(e){if(!arguments.length)return 1===i.length?i[0]:i;var t=Array.isArray(e)?e:[e];return t.sort((function(e,t){return e-t})),i=t,n=t,A},A.step=function(e){return arguments.length?(l=e,A):l},A.tickValues=function(e){return arguments.length?(c=e,A):c},A.tickPadding=function(e){return arguments.length?(h=e,A):h},A.marks=function(e){return arguments.length?(d=e,A):d},A.handle=function(e){return arguments.length?(u=e,A):u},A.displayValue=function(e){return arguments.length?(s=e,A):s},A.fill=function(e){return arguments.length?(m=e,A):m},A.on=function(){var e=g.on.apply(g,arguments);return e===g?A:e},A}function Xh(e){return Zh(3,e)}function Yh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Jh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kh(Object(n),!0).forEach((function(t){Yh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qh=(0,i.createContext)(null),ed=Qh.Provider;function td(){var e=(0,i.useContext)(Qh);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function nd(){return td().map}var id=n(559),rd=n.n(id);var ad=function(){function e(e){return fetch(e).then((function(e){return e.json()}))}return(0,i.useEffect)((function(){!function(){cn("#mapContainer").select("svg").remove(),cn("#mapContainer").select("button").remove(),cn("#mapResetButton").append("button").attr("id","resetButton").text("Reset Zoom").on("click",(function(){cn("#mapContainer").select("svg").call(a.transform,Ch.scale(1))}));var e=500,t=600,n=cn("#mapContainer").append("svg").attr("width",e).attr("height",t).attr("style","outline: thick solid lightgrey"),i=(n.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",e).attr("height",t).attr("x",0).attr("y",0),Fs().scale(100*e).center([-118.4,34.03]).translate([e/2,t/2])),r=Xo().projection(i);(function(e,t){return fetch(e,t).then(ra)})("/lacounty.geojson").then((function(e){n.append("g").selectAll("path").data(e.features).join("path").attr("fill","none").style("stroke","black").style("stroke-width","0.2px").attr("d",r).on("mouseover",(function(e,t){cn(this).transition().duration("100").style("stroke","#C6ECFF").style("stroke-width","0.2px")})).on("mouseout",(function(e,t){cn(this).transition().duration("100").style("stroke","black")}))}));var a=Oh().filter((function(){return!Xt.button})).scaleExtent([.8,20]).extent([[0,0],[e,t]]).on("zoom",(function(){n.selectAll("g").attr("transform",Xt.transform)}));cn("#mapContainer").select("svg").call(a).call(a.transform,Ch.scale(1))}()}),[]),e("/hillside_inventory_LA_centrality_full.geojson").then((function(e){e.features.forEach((function(e){var t,n=e.properties.width_ratio;t=n>1?1:n<.5?.1:3.6*Math.pow(n-.5,2)+.1,t=Math.round(1e4*t)/1e4,e.properties.width_rating=t;var i,r=e.properties.pci;i=Math.pow(r/100,2),i=Math.round(1e4*i)/1e4,e.properties.pci_rating=i;var a,o=e.properties.sidewalk_ratio;a=o>.19?1:o<0?.1:24.931*Math.pow(o,2)+.1,a=Math.round(1e4*a)/1e4,e.properties.sidewalk_rating=a;var s,u=e.properties.curb_ratio;s=u>.25?1:u<0?.1:14.4*Math.pow(u,2)+.1,s=Math.round(1e4*s)/1e4,e.properties.curb_rating=s}));var t=e.features,n=[];t.forEach((function(e){n.push(e.properties)})),console.log(t);var i={widthRW:.33,pciRW:.33,curbRW:.26,sidewalkRW:.07,distanceW:.25,populationW:.25,timeW:.25,widthW:.25};function r(e){return n.forEach((function(t){var n=t.width_rating,i=t.pci_rating,r=t.curb_rating,a=t.sidewalk_rating,o=n*e.widthRW+i*e.pciRW+r*e.curbRW+a*e.sidewalkRW;t.condition=o;var s=t.centrality_distance,u=t.centrality_time,l=t.centrality_width,c=t.centrality_population,h=s*e.distanceW+u*e.timeW+l*e.widthW+c*e.populationW;t.importance=h})),n}r(i),console.log(n),cn("#container").select("svg").remove(),cn("#container").select("button").remove(),cn("#container").append("button").attr("id","resetButton").text("Reset Zoom").on("click",(function(){cn("#container").select("svg").call(xe.transform,Ch.scale(1))}));var a,o,s={top:20,right:20,bottom:30,left:40},u=750-s.left-s.right,l=550-s.top-s.bottom,c=u/l,h=window.innerWidth;h/window.innerHeight>c?(a=l,o=u):(s.left=40,a=(o=h-40)/c);var d=o-50-s.right,f=a-s.top-s.bottom,p=cn("#container").append("svg").attr("width",d).attr("height",f).attr("overflow","visible").attr("style","outline: thick solid lightgrey").style("background","white"),v=au().domain([0,1]).range([0,d]),m=pu().domain([1e-10,1]).range([f,0]),g=p.append("g").attr("transform","translate(0, ".concat(f,")")).attr("class","axis").call(Ve(v).ticks(5)),_=p.append("g").attr("class","axis").call(He(m).ticks(5));p.append("text").attr("class","label").attr("x",d/2-30).attr("y",f+50).text("Condition"),p.append("text").attr("class","label").attr("y",f-500).attr("x",-250).attr("transform","rotate(-90)").text("Importance");p.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",d).attr("height",f).attr("x",0).attr("y",0);var y=p.append("g").attr("clip-path","url(#clip)").attr("id","scatter"),b=cn("#container").append("div").attr("class","tooltip").style("opacity",0);y.selectAll().data(n).enter().append("circle").attr("id","dots").attr("cx",(function(e){return v(e.condition)})).attr("cy",(function(e){return m(e.importance)})).attr("r",5).attr("class","non_brushed").on("mouseover",(function(e,t){cn(this).transition().duration("100").attr("r",7),b.transition().duration(100).style("opacity",1),b.html("Street Name: "+e.ST_NAME+" Condition: "+Math.round(1e4*e.condition)/1e4+" Importance: "+Math.round(1e4*e.importance)/1e4).style("left",Xt.pageX+15+"px").style("top",Xt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("200").attr("r",5),b.transition().duration("200").style("opacity",0)}));cn("#multiselect1").select("#selectBox1").remove(),cn("#multiselect2").select("#selectBox2").remove(),cn("#multiselect3").select("#selectBox3").remove(),cn("#multiselect4").select("#selectBox4").remove(),cn("#multiselect5").select("#selectBox5").remove(),cn("#multiselect6").select("#selectBox6").remove();var x=!1;function w(e){var t=document.getElementById(e);x?(t.style.display="none",x=!1):(t.style.display="block",x=!0)}cn("#multiselect1").append("div").attr("id","selectBox1").on("click",(function(){w("checkboxes1")}));var k=cn("#selectBox1").append("select");k.append("option").text("Select community...");cn("#selectBox1").append("div").attr("id","overSelect");var S=cn("#multiselect1").append("div").attr("id","checkboxes1");S.append("label").text("Non disadvantage Community ").append("input").attr("type","checkbox").attr("value","nondisadvantage"),S.append("label").text("Disadvantage Community ").append("input").attr("type","checkbox").attr("value","disadvantage"),S.append("label").text("Low Income ").append("input").attr("type","checkbox").attr("value","lowincome"),S.on("change",(function(e){k.style("background-color","#C6ECFF");var t=[];Fc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(D(n,O,z,t,B,$,j),!1)}));cn("#multiselect2").append("div").attr("id","selectBox2").on("click",(function(){w("checkboxes2")}));var M=cn("#selectBox2").append("select");M.append("option").text("Select withdrawn...");cn("#selectBox2").append("div").attr("id","overSelect");var T=cn("#multiselect2").append("div").attr("id","checkboxes2");T.append("label").text("Withdrawn ").append("input").attr("type","checkbox").attr("value","withdrawn"),T.append("label").text("Not Withdrawn").append("input").attr("type","checkbox").attr("value","notwithdrawn"),T.on("change",(function(e){M.style("background-color","#C6ECFF");var t=[];Fc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(D(n,O,z,F,B,t,j),!1)}));cn("#multiselect3").append("div").attr("id","selectBox3").on("click",(function(){w("checkboxes3")}));var C=cn("#selectBox3").append("select");C.append("option").text("Select maintain...");cn("#selectBox3").append("div").attr("id","overSelect");var E=cn("#multiselect3").append("div").attr("id","checkboxes3");E.append("label").text("Maintained ").append("input").attr("type","checkbox").attr("value","maintain"),E.append("label").text("Not Maintained").append("input").attr("type","checkbox").attr("value","notmaintain"),E.on("change",(function(e){C.style("background-color","#C6ECFF");var t=[];Fc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(D(n,O,z,F,B,$,t),!1)}));cn("#multiselect4").append("div").attr("id","selectBox4").on("click",(function(){w("checkboxes4")}));var P=cn("#selectBox4").append("select");P.append("option").text("Select Location...");cn("#selectBox4").append("div").attr("id","overSelect");var L=cn("#multiselect4").append("div").attr("id","checkboxes4");L.append("label").text("North Los Angeles ").append("input").attr("type","checkbox").attr("value","northla"),L.append("label").text("Central Los Angeles ").append("input").attr("type","checkbox").attr("value","centralla"),L.append("label").text("South Los Angeles ").append("input").attr("type","checkbox").attr("value","southla"),L.on("change",(function(e){P.style("background-color","#C6ECFF");var t=[];Fc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(D(n,O,t,F,B,$,j),!1)}));cn("#multiselect5").append("div").attr("id","selectBox5").on("click",(function(){w("checkboxes5")}));var A=cn("#selectBox5").append("select");A.append("option").text("Select Council District...");cn("#selectBox5").append("div").attr("id","overSelect");var I=cn("#multiselect5").append("div").attr("id","checkboxes5");I.append("label").text("1 ").append("input").attr("type","checkbox").attr("value","1"),I.append("label").text("2 ").append("input").attr("type","checkbox").attr("value","2"),I.append("label").text("3 ").append("input").attr("type","checkbox").attr("value","3"),I.append("label").text("4 ").append("input").attr("type","checkbox").attr("value","4"),I.append("label").text("5 ").append("input").attr("type","checkbox").attr("value","5"),I.append("label").text("6 ").append("input").attr("type","checkbox").attr("value","6"),I.append("label").text("7 ").append("input").attr("type","checkbox").attr("value","7"),I.append("label").text("11 ").append("input").attr("type","checkbox").attr("value","11"),I.append("label").text("12 ").append("input").attr("type","checkbox").attr("value","12"),I.append("label").text("13 ").append("input").attr("type","checkbox").attr("value","13"),I.append("label").text("14 ").append("input").attr("type","checkbox").attr("value","14"),I.append("label").text("15 ").append("input").attr("type","checkbox").attr("value","15"),I.on("change",(function(e){A.style("background-color","#C6ECFF");var t=[];Fc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(D(n,O,z,F,t,$,j),!1)}));cn("#multiselect6").append("div").attr("id","selectBox6").on("click",(function(){w("checkboxes6")}));var R=cn("#selectBox6").append("select");R.append("option").text("Select Designation...");cn("#selectBox6").append("div").attr("id","overSelect");var N=cn("#multiselect6").append("div").attr("id","checkboxes6");function D(e,t,n,i,r,a,o){var s=[],u=U(t,e),l=V(n,e),c=H(i,e),h=W(r,e),d=G(a,e),f=q(o,e);return u.forEach((function(e){l.includes(e)&&c.includes(e)&&h.includes(e)&&d.includes(e)&&f.includes(e)&&s.push(e)})),s}N.append("label").text("Avenue I ").append("input").attr("type","checkbox").attr("value","Avenue I"),N.append("label").text("Avenue II ").append("input").attr("type","checkbox").attr("value","Avenue II"),N.append("label").text("Avenue III ").append("input").attr("type","checkbox").attr("value","Avenue III"),N.append("label").text("Boulevard I ").append("input").attr("type","checkbox").attr("value","Boulevard I"),N.append("label").text("Boulevard II ").append("input").attr("type","checkbox").attr("value","Boulevard II"),N.append("label").text("Collector ").append("input").attr("type","checkbox").attr("value","Collector"),N.append("label").text("Hillside Collector ").append("input").attr("type","checkbox").attr("value","Hillside Collector"),N.append("label").text("Local Street - Standard ").append("input").attr("type","checkbox").attr("value","Local Street - Standard"),N.append("label").text("Modified Avenue I ").append("input").attr("type","checkbox").attr("value","Modified Avenue I"),N.append("label").text("Modified Avenue II ").append("input").attr("type","checkbox").attr("value","Modified Avenue II"),N.append("label").text("Modified Avenue III ").append("input").attr("type","checkbox").attr("value","Modified Avenue III"),N.append("label").text("Modified Boulevard II ").append("input").attr("type","checkbox").attr("value","Modified Boulevard II"),N.append("label").text("Modified Collector ").append("input").attr("type","checkbox").attr("value","Modified Collector"),N.append("label").text("Modified Local Street Standard ").append("input").attr("type","checkbox").attr("value","Modified Local Street Standard"),N.append("label").text("Modified Scenic Arterial Mountain ").append("input").attr("type","checkbox").attr("value","Modified Scenic Arterial Mountain"),N.append("label").text("Mountain Collector ").append("input").attr("type","checkbox").attr("value","Mountain Collector"),N.append("label").text("Private ").append("input").attr("type","checkbox").attr("value","Private"),N.append("label").text("Scenic Parkway ").append("input").attr("type","checkbox").attr("value","Scenic Parkway"),N.append("label").text("Unidentified ").append("input").attr("type","checkbox").attr("value","Unidentified"),N.on("change",(function(e){R.style("background-color","#C6ECFF");var t=[];Fc("input[type=checkbox]:checked").each((function(){t.push(this.value)})),console.log(t),te(D(n,t,z,F,B,$,j),!1)}));var O=["Avenue I","Avenue II","Avenue III","Boulevard I","Boulevard II","Collector","Hillside Collector","Local Street - Standard","Modified Avenue I","Modified Avenue II","Modified Avenue III","Modified Boulevard II","Modified Collector","Modified Local Street Standard","Modified Scenic Arterial Mountain","Mountain Collector","Private","Scenic Parkway","Unidentified"],z=["northla","centralla","southla"],F=["lowincome","disadvantage","nondisadvantage"],B=["1","2","3","4","5","6","7","11","12","13","14","15"],$=["withdrawn","notwithdrawn"],j=["maintain","notmaintain"];function U(e,t){var n=[];return e.indexOf("Avenue I")>-1&&t.forEach((function(e){"Avenue I"==e.Street_Designation&&n.push(e)})),e.indexOf("Avenue II")>-1&&t.forEach((function(e){"Avenue II"==e.Street_Designation&&n.push(e)})),e.indexOf("Avenue III")>-1&&t.forEach((function(e){"Avenue III"==e.Street_Designation&&n.push(e)})),e.indexOf("Boulevard I")>-1&&t.forEach((function(e){"Boulevard I"==e.Street_Designation&&n.push(e)})),e.indexOf("Boulevard II")>-1&&t.forEach((function(e){"Boulevard II"==e.Street_Designation&&n.push(e)})),e.indexOf("Collector")>-1&&t.forEach((function(e){"Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Hillside Collector")>-1&&t.forEach((function(e){"Hillside Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Local Street - Standard")>-1&&t.forEach((function(e){"Local Street - Standard"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Avenue I")>-1&&t.forEach((function(e){"Modified Avenue I"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Avenue II")>-1&&t.forEach((function(e){"Modified Avenue II"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Avenue III")>-1&&t.forEach((function(e){"Modified Avenue III"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Boulevard II")>-1&&t.forEach((function(e){"Modified Boulevard II"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Collector")>-1&&t.forEach((function(e){"Modified Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Local Street Standard")>-1&&t.forEach((function(e){"Modified Local Street Standard"==e.Street_Designation&&n.push(e)})),e.indexOf("Modified Scenic Arterial Mountain")>-1&&t.forEach((function(e){"Modified Scenic Arterial Mountain"==e.Street_Designation&&n.push(e)})),e.indexOf("Mountain Collector")>-1&&t.forEach((function(e){"Mountain Collector"==e.Street_Designation&&n.push(e)})),e.indexOf("Private")>-1&&t.forEach((function(e){"Private"==e.Street_Designation&&n.push(e)})),e.indexOf("Scenic Parkway")>-1&&t.forEach((function(e){"Scenic Parkway"==e.Street_Designation&&n.push(e)})),e.indexOf("Unidentified")>-1&&t.forEach((function(e){"Unidentified"==e.Street_Designation&&n.push(e)})),n}function V(e,t){var n=[];return e.indexOf("northla")>-1&&t.forEach((function(e){e.centroid_lat>34.1935&&n.push(e)})),e.indexOf("centralla")>-1&&t.forEach((function(e){e.centroid_lat>33.911&&e.centroid_lat<34.1935&&n.push(e)})),e.indexOf("southla")>-1&&t.forEach((function(e){e.centroid_lat<33.911&&n.push(e)})),n}function H(e,t){var n=[];return e.indexOf("disadvantage")>-1&&t.forEach((function(e){1==e.DAC&&n.push(e)})),e.indexOf("nondisadvantage")>-1&&t.forEach((function(e){0==e.DAC&&n.push(e)})),e.indexOf("lowincome")>-1&&t.forEach((function(e){1==e.lowincome&&n.push(e)})),n}function W(e,t){var n=[];return e.indexOf("1")>-1&&t.forEach((function(e){1==e.CD&&n.push(e)})),e.indexOf("2")>-1&&t.forEach((function(e){2==e.CD&&n.push(e)})),e.indexOf("3")>-1&&t.forEach((function(e){3==e.CD&&n.push(e)})),e.indexOf("4")>-1&&t.forEach((function(e){4==e.CD&&n.push(e)})),e.indexOf("5")>-1&&t.forEach((function(e){5==e.CD&&n.push(e)})),e.indexOf("6")>-1&&t.forEach((function(e){6==e.CD&&n.push(e)})),e.indexOf("7")>-1&&t.forEach((function(e){7==e.CD&&n.push(e)})),e.indexOf("11")>-1&&t.forEach((function(e){11==e.CD&&n.push(e)})),e.indexOf("12")>-1&&t.forEach((function(e){12==e.CD&&n.push(e)})),e.indexOf("13")>-1&&t.forEach((function(e){13==e.CD&&n.push(e)})),e.indexOf("14")>-1&&t.forEach((function(e){14==e.CD&&n.push(e)})),e.indexOf("15")>-1&&t.forEach((function(e){15==e.CD&&n.push(e)})),n}function G(e,t){var n=[];return e.indexOf("withdrawn")>-1&&t.forEach((function(e){1==e.withdrawn&&n.push(e)})),e.indexOf("notwithdrawn")>-1&&t.forEach((function(e){0==e.withdrawn&&n.push(e)})),n}function q(e,t){var n=[];return e.indexOf("maintain")>-1&&t.forEach((function(e){0==e.Not_maintained&&n.push(e)})),e.indexOf("notmaintain")>-1&&t.forEach((function(e){1==e.Not_maintained&&n.push(e)})),n}var Z=[],X=U(O,n),Y=V(z,n),K=H(F,n),J=W(B,n),Q=G($,n),ee=q(j,n);function te(e,t){cn("#container").selectAll('[id="dots"]').remove(),cn("#container").select('[id="scatter"]').selectAll("circle").data(e).enter().append("circle").attr("id","dots").attr("cx",(function(e){return v(e.condition)})).attr("cy",(function(e){return m(e.importance)})).attr("r",5).attr("class","non_brushed").on("mouseover",(function(e,t){cn(this).transition().duration("100").attr("r",7),b.transition().duration(100).style("opacity",1),b.html("Street Name: "+e.ST_NAME+" Condition: "+Math.round(1e4*e.condition)/1e4+" Importance: "+Math.round(1e4*e.importance)/1e4).style("left",Xt.pageX+15+"px").style("top",Xt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("200").attr("r",5),b.transition().duration("200").style("opacity",0)})),1==t&&ye()}X.forEach((function(e){Y.includes(e)&&K.includes(e)&&J.includes(e)&&Q.includes(e)&&ee.includes(e)&&Z.push(e)})),cn("#sliderContainer1").select("svg").remove(),cn("#sliderContainer2").select("svg").remove(),cn("#sliderContainer3").select("svg").remove(),cn("#sliderContainer4").select("svg").remove(),cn("#sliderContainer5").select("svg").remove(),cn("#sliderContainer6").select("svg").remove(),cn("#sliderContainer7").select("svg").remove(),cn("#sliderContainer8").select("svg").remove(),cn("#sliderValueOne").select("g").remove(),cn("#sliderValueTwo").select("g").remove(),cn("#sliderValueThree").select("g").remove(),cn("#sliderValueFour").select("g").remove(),cn("#sliderValueFive").select("g").remove(),cn("#sliderValueSix").select("g").remove(),cn("#sliderValueSeven").select("g").remove(),cn("#sliderValueEight").select("g").remove();var ne=Xh().min(0).max(1).width(100).ticks(5).default(.33).on("onchange",(function(e){ce.text(va(".2")(e)),i.widthRW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),ie=Xh().min(0).max(1).width(100).ticks(5).default(.33).on("onchange",(function(e){he.text(va(".2")(e)),i.pciRW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),re=Xh().min(0).max(1).width(100).ticks(5).default(.26).on("onchange",(function(e){de.text(va(".2")(e)),i.curbRW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),ae=Xh().min(0).max(1).width(100).ticks(5).default(.07).on("onchange",(function(e){fe.text(va(".2")(e)),i.sidewalkRW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),oe=Xh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){pe.text(va(".2")(e)),i.distanceW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),se=Xh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){ve.text(va(".2")(e)),i.timeW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),ue=Xh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){me.text(va(".2")(e)),i.widthW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),le=Xh().min(0).max(1).width(100).ticks(5).default(.25).on("onchange",(function(e){ge.text(va(".2")(e)),i.populationW=e,p.selectAll('[id="dots"]').remove(),console.log(i),te(D(r(i),O,z,F,B,$,j),!0)})),ce=cn("#sliderValueOne").append("g").append("text"),he=cn("#sliderValueTwo").append("g").append("text"),de=cn("#sliderValueThree").append("g").append("text"),fe=cn("#sliderValueFour").append("g").append("text"),pe=cn("#sliderValueFive").append("g").append("text"),ve=cn("#sliderValueSix").append("g").append("text"),me=cn("#sliderValueSeven").append("g").append("text"),ge=cn("#sliderValueEight").append("g").append("text");cn("#sliderContainer1").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(ne),cn("#sliderContainer2").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(ie),cn("#sliderContainer3").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(re),cn("#sliderContainer4").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(ae),cn("#sliderContainer5").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(oe),cn("#sliderContainer6").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(se),cn("#sliderContainer7").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(ue),cn("#sliderContainer8").append("svg").attr("width",150).attr("height",80).append("g").attr("transform","translate(30,30)").call(le);var _e=Yr().on("brush",(function(){if(null!=Xt.selection){var e=cn("#container").selectAll('[id="dots"]');e.attr("class","non_brushed");var t=function(e){var t=e.__brush;return t?t.dim.output(t.selection):null}(this);e.filter((function(){var e=cn(this).attr("cx"),n=cn(this).attr("cy");return function(e,t,n){var i=e[0][0],r=e[1][0],a=e[0][1],o=e[1][1];return i<=t&&t<=r&&a<=n&&n<=o}(t,e,n)})).attr("class","brushed")}})).on("end",(function(){var t=[],n=[],i=[];if(Xt.selection){cn(this).call(_e.move,null);var r=[],a=[];Fc(".brushed").data().filter((function(e){a.push(e.OBJECTID),r.push(e.ST_NAME),r.push("ID: "+e.OBJECTID)})),console.log(r);var o=[];a.forEach((function(t){var n=e.features.map((function(e){return{OBJECTID:e.properties.OBJECTID,geometry:e.geometry,ST_NAME:e.ST_NAME}}));n.forEach((function(e){if(e.OBJECTID===t){var n={OBJECTID:e.OBJECTID,geometry:e.geometry,ST_NAME:e.ST_NAME};o.push(n)}}))}));var s=Fs().scale(5e4).center([-118.4,34.03]).translate([250,300]),u=Xo().projection(s);if(o.length>0){t=[],n=[],o.forEach((function(e){return t.push(e)})),o.forEach((function(e){return n.push(e.geometry)})),cn("#mapContainer").select('[id="selected_streets"]').remove(),Fc("path[class*='street']").style("stroke","none"),console.log(t),console.log(n);var l=[];n.forEach((function(e){var t={longitude:e.coordinates[0][1],latitude:e.coordinates[0][0]};l.push(t)})),cn("#mapContainer").select("svg").append("g").attr("id","selected_streets").selectAll("circle").data(l).enter().append("circle").attr("cx",(function(e){return s([e.latitude,e.longitude])[0]})).attr("cy",(function(e){return s([e.latitude,e.longitude])[1]})).attr("r",8).style("opacity",.5).style("fill","#B8EC87");var c=cn("#mapContainer").append("div").attr("class","tooltip").style("opacity",0),h=cn("#mapContainer").append("div").attr("class","tooltip").style("opacity",0);cn('[id="selected_streets"]').selectAll("path").data(n).join("path").attr("fill","none").style("stroke","blue").style("r",5).style("stroke-width","0.2px").attr("d",u).on("mouseover",(function(e,t){cn(this).transition().duration("100").style("stroke","grey").style("stroke-width","0.3px"),c.transition().duration(100).style("opacity",1),c.html("Street Name: "+e+" ").style("left",Xt.pageX+15+"px").style("top",Xt.pageY-15+"px")})).on("mouseout",(function(e,t){cn(this).transition().duration("100").style("stroke","blue").style("stroke-width","0.2px"),c.transition().duration("200").style("opacity",0)})),t.forEach((function(e){console.log(e.OBJECTID),cn(".street"+e.OBJECTID).style("stroke","blue").attr("fill","none").style("pointer-events","visible").style("stroke-width","20px").style("stroke-opacity",.7).on("click",(function(){console.log(cn(this).attr("class"))})).on("mouseover",(function(e,t){cn(this).transition().duration("100").style("stroke","red").style("stroke-width","20px"),h.transition().duration(100).style("opacity",1),h.html(cn(this).attr("class")).attr("x",d+50).attr("y",f)})).on("mouseout",(function(e,t){cn(this).transition().duration("100").style("stroke","blue").style("stroke-width","20px"),h.transition().duration("200").style("opacity",0)}))}))}else t=[],cn("#mapContainer").select('[id="selected_streets"]').remove(),Fc("path[class*='street']").style("stroke","none");r.length>0?(i=[],r.forEach((function(e){return i.push(e)})),cn("#selected_regions_title").select("text").remove(),cn("#selected_regions_title").append("text").attr("x",0).attr("y",f+80).html(i.join(", "))):(i=[],cn("#selected_regions_title").select("text").remove())}}));function ye(e){1==e?p.append("g").attr("id","brushrect").call(_e):cn("#brushrect").remove()}var be=!1;cn("#switchModeButton").on("click",(function(e){be?(cn("#switchModeButton").text("Tooltip mode"),be=!1,ye(!1)):(cn("#switchModeButton").text("Brush mode"),ye(!0),be=!0)})),cn("#container").select("svg").append("g").attr("id","selected_regions_title").append("text").style("fill","grey").attr("x",0).attr("y",f+80).html("Brush to select:");var xe=Oh().filter((function(){return!Xt.button})).scaleExtent([.5,20]).extent([[0,0],[d,f]]).on("zoom",(function(){var e=Xt.transform.rescaleX(v),t=Xt.transform.rescaleY(m);g.call(Ve(e)),_.call(He(t)),y.selectAll("circle").attr("cx",(function(t){return e(t.condition)})).attr("cy",(function(e){return t(e.importance)}))}));cn("#container").select("svg").call(xe).call(xe.transform,Ch.scale(1))})),rd().icon({iconSize:[25,41],iconAnchor:[10,41],popupAnchor:[2,-40],iconUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-shadow.png"}),(0,se.jsxs)("div",{id:"bigcontainer",children:[(0,se.jsxs)("div",{id:"filterFamily",children:[(0,se.jsxs)("div",{id:"filterFirstRow",children:[(0,se.jsx)("div",{id:"multiselect1"}),(0,se.jsx)("div",{id:"multiselect2"}),(0,se.jsx)("div",{id:"multiselect3"})]}),(0,se.jsxs)("div",{id:"filterSecondRow",children:[(0,se.jsx)("div",{id:"multiselect4"}),(0,se.jsx)("div",{id:"multiselect5"}),(0,se.jsx)("div",{id:"multiselect6"})]})]}),(0,se.jsxs)("div",{id:"sliderFamily",children:[(0,se.jsxs)("div",{id:"sliderFirstRow",children:[(0,se.jsxs)("div",{id:"sliderContainer1",children:[(0,se.jsx)("p",{children:"Width Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueOne"})]}),(0,se.jsxs)("div",{id:"sliderContainer2",children:[(0,se.jsx)("p",{children:"PCI Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueTwo"})]}),(0,se.jsxs)("div",{id:"sliderContainer3",children:[(0,se.jsx)("p",{children:"Curb Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueThree"})]}),(0,se.jsxs)("div",{id:"sliderContainer4",children:[(0,se.jsx)("p",{children:"Sidewalk Rating Weight"}),(0,se.jsx)("div",{id:"sliderValueFour"})]})]}),(0,se.jsxs)("div",{id:"sliderSecondRow",children:[(0,se.jsxs)("div",{id:"sliderContainer5",children:[(0,se.jsx)("p",{children:"Importance Distance Weight"}),(0,se.jsx)("div",{id:"sliderValueFive"})]}),(0,se.jsxs)("div",{id:"sliderContainer6",children:[(0,se.jsx)("p",{children:"Importance Population Weight"}),(0,se.jsx)("div",{id:"sliderValueSix"})]}),(0,se.jsxs)("div",{id:"sliderContainer7",children:[(0,se.jsx)("p",{children:"Importance Time Weight"}),(0,se.jsx)("div",{id:"sliderValueSeven"})]}),(0,se.jsxs)("div",{id:"sliderContainer8",children:[(0,se.jsx)("p",{children:"Importance Width Weight"}),(0,se.jsx)("div",{id:"sliderValueEight"})]})]})]}),(0,se.jsx)("button",{id:"switchModeButton",children:"Tooltip mode"}),(0,se.jsxs)("div",{id:"chartAndMap",children:[(0,se.jsx)("div",{id:"container"}),(0,se.jsx)("div",{id:"mapResetButton"}),(0,se.jsx)("div",{id:"mapContainer"})]})]})};function od(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var sd=["bounds","boundsOptions","center","children","className","id","placeholder","style","whenReady","zoom"];function ud(){return ud=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ud.apply(this,arguments)}function ld(e,t){var n=e.bounds,r=e.boundsOptions,a=e.center,o=e.children,u=e.className,l=e.id,c=e.placeholder,h=e.style,d=e.whenReady,f=e.zoom,p=od(e,sd),v=s((0,i.useState)({className:u,id:l,style:h}),1)[0],m=s((0,i.useState)(null),2),g=m[0],_=m[1];(0,i.useImperativeHandle)(t,(function(){var e;return null!==(e=null===g||void 0===g?void 0:g.map)&&void 0!==e?e:null}),[g]);var y=(0,i.useCallback)((function(e){if(null!==e&&null===g){var t=new id.Map(e,p);null!=a&&null!=f?t.setView(a,f):null!=n&&t.fitBounds(n,r),null!=d&&t.whenReady(d),_(function(e){return Object.freeze({__version:1,map:e})}(t))}}),[]);(0,i.useEffect)((function(){return function(){null===g||void 0===g||g.map.remove()}}),[g]);var b=g?i.createElement(ed,{value:g},o):null!==c&&void 0!==c?c:null;return i.createElement("div",ud({},v,{ref:y}),b)}var cd=(0,i.forwardRef)(ld);n(164);function hd(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function dd(e,t){return null==t?function(t,n){var r=(0,i.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){var a=(0,i.useRef)();a.current||(a.current=e(n,r));var o=(0,i.useRef)(n),s=a.current.instance;return(0,i.useEffect)((function(){o.current!==n&&(t(s,n,o.current),o.current=n)}),[s,n,r]),a}}function fd(e,t){var n,i=null!==(n=e.pane)&&void 0!==n?n:t.pane;return i?Jh(Jh({},e),{},{pane:i}):e}function pd(e){return function(t){var n=td(),r=e(fd(t,n),n);return function(e,t){var n=(0,i.useRef)(t);(0,i.useEffect)((function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t}),[e,t])}(n.map,t.attribution),function(e,t){var n=(0,i.useRef)();(0,i.useEffect)((function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}}),[e,t])}(r.current,t.eventHandlers),function(e,t){(0,i.useEffect)((function(){var n;return(null!==(n=t.layerContainer)&&void 0!==n?n:t.map).addLayer(e.instance),function(){var n;null===(n=t.layerContainer)||void 0===n||n.removeLayer(e.instance),t.map.removeLayer(e.instance)}}),[t,e])}(r.current,n),r}}var vd=["children"],md=function(e,t){return function(e){function t(t,n){var r=e(t).current,a=r.instance,o=r.context;return(0,i.useImperativeHandle)(n,(function(){return a})),null==t.children?null:i.createElement(ed,{value:o},t.children)}return(0,i.forwardRef)(t)}(pd(dd(e,t)))}((function(e,t){e.children;var n,i,r=od(e,vd),a=new id.LayerGroup([],r);return hd(a,(n=t,i={layerContainer:a},Object.freeze(Jh(Jh({},n),i))))}));var gd=["url"],_d=function(e,t){return function(e){function t(t,n){var r=e(t).current.instance;return(0,i.useImperativeHandle)(n,(function(){return r})),null}return(0,i.forwardRef)(t)}(pd(dd(e,t)))}((function(e,t){var n=e.url,i=od(e,gd);return hd(new id.TileLayer(n,fd(i,t)),t)}),(function(e,t,n){var i=t.opacity,r=t.zIndex;null!=i&&i!==n.opacity&&e.setOpacity(i),null!=r&&r!==n.zIndex&&e.setZIndex(r)}));var yd,bd,xd=function(){function e(){var e,t=nd();console.log("map center: ",t.getCenter()),(e="/hillside_inventory_LA_centrality_full.geojson",fetch(e).then((function(e){return e.json()}))).then((function(e){var n=cn(t.getPanes().overlayPane).append("svg").attr("id","svgleaflet"),i=n.append("g").attr("class","leaflet-zoom-hide"),r=Ts({point:function(e,n){var i=t.latLngToLayerPoint(new(rd().LatLng)(n,e));this.stream.point(i.x,i.y)}}),a=Xo().projection(r);t.on("click",(function(e){var t=e.latlng;console.log(t.lng+" "+t.lat),cn(".mapillary-attribution-container").select("a").attr("xlink:href","https://www.mapillary.com/app/?pKey=259103735961077&focus=photo")}));var o=i.selectAll("path").data(e.features).enter().append("path").attr("class",(function(e){return"street"+e.properties.OBJECTID})).style("fill-opacity",.7).attr("fill","none").style("stroke","none");function s(){var t=a.bounds(e),r=t[0],s=t[1];n.attr("width",s[0]-r[0]).attr("height",s[1]-r[1]).style("left",r[0]+"px").style("top",r[1]+"px"),i.attr("transform","translate("+-r[0]+","+-r[1]+")"),o.attr("d",a)}t.on("zoom",s),s()}))}return(0,se.jsxs)(cd,{center:[34.03,-118.26],zoom:10,style:{height:"700px",width:"40%"},children:[(0,se.jsx)(e,{}),(0,se.jsx)(md,{}),(0,se.jsx)(_d,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})]})};rd().icon({iconSize:[25,41],iconAnchor:[10,41],popupAnchor:[2,-40],iconUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.6/dist/images/marker-shadow.png"});function wd(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kd(e){return kd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kd(e)}function Sd(e,t){return Sd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Sd(e,t)}function Md(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Td(e,t,n){return Td=Md()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&Sd(r,n.prototype),r},Td.apply(null,arguments)}function Cd(e){var t="function"===typeof Map?new Map:void 0;return Cd=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Td(e,arguments,kd(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Sd(i,e)},Cd(e)}function Ed(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(i,r)}function Pd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function Ld(e){return Ld="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ld(e)}function Ad(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Id(e,t){if(t&&("object"===Ld(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ad(e)}function Rd(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=kd(e)););return e}function Nd(){return Nd="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Rd(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Nd.apply(this,arguments)}function Dd(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Sd(e,t)}function Od(e){var t=Md();return function(){var n,i=kd(e);if(t){var r=kd(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Id(this,n)}}function zd(){zd=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(MN){s=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),o=new k(i||[]);return a._invoke=function(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return M()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=b(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var u=l(e,t,n);if("normal"===u.type){if(i=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(MN){return{type:"throw",arg:MN}}}e.wrap=u;var c={};function h(){}function d(){}function f(){}var p={};s(p,r,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(S([])));m&&m!==t&&n.call(m,r)&&(p=m);var g=f.prototype=h.prototype=Object.create(p);function _(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,a,o,s){var u=l(e[r],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Ld(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(u.arg)}var r;this._invoke=function(e,n){function a(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,c;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=f,s(g,"constructor",f),s(f,"constructor",d),d.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},_(y.prototype),s(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new y(u(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(g),s(g,o,"Generator"),s(g,r,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=S,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;w(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}function Fd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bd(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $d(e,t,n){return t&&Bd(e.prototype,t),n&&Bd(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var jd=function(e,t){return jd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},jd(e,t)};function Ud(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}jd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Vd(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{u(i.next(e))}catch(t){a(t)}}function s(e){try{u(i.throw(e))}catch(t){a(t)}}function u(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}u((i=i.apply(e,t||[])).next())}))}function Hd(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Wd(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gd(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o}function qd(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e}function Zd(e){return this instanceof Zd?(this.v=e,this):new Zd(e)}function Xd(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),a=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){r[e]&&(i[e]=function(t){return new Promise((function(n,i){a.push([e,t,n,i])>1||s(e,t)}))})}function s(e,t){try{(n=r[e](t)).value instanceof Zd?Promise.resolve(n.value.v).then(u,l):c(a[0][2],n)}catch(i){c(a[0][3],i)}var n}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function Yd(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Wd(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}function Kd(e){return"function"===typeof e}function Jd(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Qd=Jd((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ef(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var tf=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return e.prototype.unsubscribe=function(){var e,t,n,i,r;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Wd(a),s=o.next();!s.done;s=o.next()){s.value.remove(this)}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(Kd(u))try{u()}catch(p){r=p instanceof Qd?p.errors:[p]}var l=this._teardowns;if(l){this._teardowns=null;try{for(var c=Wd(l),h=c.next();!h.done;h=c.next()){var d=h.value;try{af(d)}catch(MN){r=null!==r&&void 0!==r?r:[],MN instanceof Qd?r=qd(qd([],Gd(r)),Gd(MN.errors)):r.push(MN)}}}catch(v){n={error:v}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}}if(r)throw new Qd(r)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)af(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ef(t,e)},e.prototype.remove=function(t){var n=this._teardowns;n&&ef(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),nf=tf.EMPTY;function rf(e){return e instanceof tf||e&&"closed"in e&&Kd(e.remove)&&Kd(e.add)&&Kd(e.unsubscribe)}function af(e){Kd(e)?e():e.unsubscribe()}var of={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},sf={setTimeout:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=sf.delegate;return((null===n||void 0===n?void 0:n.setTimeout)||setTimeout).apply(void 0,qd([],Gd(e)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=sf.delegate;return((null===t||void 0===t?void 0:t.clearTimeout)||clearTimeout)(e)})),delegate:void 0};function uf(e){sf.setTimeout((function(){throw e}))}function lf(){}var cf=hf("C",void 0,void 0);function hf(e,t,n){return{kind:e,value:t,error:n}}var df=null;function ff(e){if(of.useDeprecatedSynchronousErrorHandling){var t=!df;if(t&&(df={errorThrown:!1,error:null}),e(),t){var n=df,i=n.errorThrown,r=n.error;if(df=null,i)throw r}}else e()}var pf=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,rf(t)&&t.add(n)):n.destination=yf,n}return Ud(t,e),t.create=function(e,t,n){return new vf(e,t,n)},t.prototype.next=function(e){this.isStopped?_f(function(e){return hf("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?_f(hf("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?_f(cf,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(tf),vf=function(e){function t(t,n,i){var r,a=e.call(this)||this;if(Kd(t))r=t;else if(t){var o;r=t.next,n=t.error,i=t.complete,a&&of.useDeprecatedNextContext?(o=Object.create(t)).unsubscribe=function(){return a.unsubscribe()}:o=t,r=null===r||void 0===r?void 0:r.bind(o),n=null===n||void 0===n?void 0:n.bind(o),i=null===i||void 0===i?void 0:i.bind(o)}return a.destination={next:r?mf(r):lf,error:mf(null!==n&&void 0!==n?n:gf),complete:i?mf(i):lf},a}return Ud(t,e),t}(pf);function mf(e,t){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{e.apply(void 0,qd([],Gd(t)))}catch(MN){uf(MN)}}}function gf(e){throw e}function _f(e,t){var n=of.onStoppedNotification;n&&sf.setTimeout((function(){return n(e,t)}))}var yf={closed:!0,next:lf,error:gf,complete:lf},bf="function"===typeof Symbol&&Symbol.observable||"@@observable";function xf(e){return e}function wf(e){return 0===e.length?xf:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var kf=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this,r=function(e){return e&&e instanceof pf||function(e){return e&&Kd(e.next)&&Kd(e.error)&&Kd(e.complete)}(e)&&rf(e)}(e)?e:new vf(e,t,n);return ff((function(){var e=i,t=e.operator,n=e.source;r.add(t?t.call(r,n):n?i._subscribe(r):i._trySubscribe(r))})),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(MN){e.error(MN)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Sf(t))((function(t,i){var r;r=n.subscribe((function(t){try{e(t)}catch(MN){i(MN),null===r||void 0===r||r.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[bf]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return wf(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Sf(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function Sf(e){var t;return null!==(t=null!==e&&void 0!==e?e:of.Promise)&&void 0!==t?t:Promise}function Mf(e){return Kd(null===e||void 0===e?void 0:e.lift)}function Tf(e){return function(t){if(Mf(t))return t.lift((function(t){try{return e(t,this)}catch(MN){this.error(MN)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Cf=function(e){function t(t,n,i,r,a){var o=e.call(this,t)||this;return o.onFinalize=a,o._next=n?function(e){try{n(e)}catch(MN){t.error(MN)}}:e.prototype._next,o._error=r?function(e){try{r(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=i?function(){try{i()}catch(MN){t.error(MN)}finally{this.unsubscribe()}}:e.prototype._complete,o}return Ud(t,e),t.prototype.unsubscribe=function(){var t,n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))},t}(pf);function Ef(){return Tf((function(e,t){var n=null;e._refCount++;var i=new Cf(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var i=e._connection,r=n;n=null,!i||r&&i!==r||i.unsubscribe(),t.unsubscribe()}}));e.subscribe(i),i.closed||(n=e.connect())}))}var Pf=function(e){function t(t,n){var i=e.call(this)||this;return i.source=t,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,Mf(t)&&(i.lift=t.lift),i}return Ud(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null===e||void 0===e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new tf;var n=this.getSubject();t.add(this.source.subscribe(new Cf(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=tf.EMPTY)}return t},t.prototype.refCount=function(){return Ef()(this)},t}(kf),Lf=Jd((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Af=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ud(t,e),t.prototype.lift=function(e){var t=new If(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Lf},t.prototype.next=function(e){var t=this;ff((function(){var n,i;if(t._throwIfClosed(),!t.isStopped){var r=t.observers.slice();try{for(var a=Wd(r),o=a.next();!o.done;o=a.next()){o.value.next(e)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;ff((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;ff((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=t.hasError,i=t.isStopped,r=t.observers;return n||i?nf:(r.push(e),new tf((function(){return ef(r,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,i=t.thrownError,r=t.isStopped;n?e.error(i):r&&e.complete()},t.prototype.asObservable=function(){var e=new kf;return e.source=this,e},t.create=function(e,t){return new If(e,t)},t}(kf),If=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return Ud(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:nf},t}(Af),Rf=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Ud(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,i=e._value;if(t)throw n;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Af),Nf={now:function(){return(Nf.delegate||Date).now()},delegate:void 0},Df=function(e){function t(t,n,i){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===i&&(i=Nf);var r=e.call(this)||this;return r._bufferSize=t,r._windowTime=n,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=n===1/0,r._bufferSize=Math.max(1,t),r._windowTime=Math.max(1,n),r}return Ud(t,e),t.prototype.next=function(t){var n=this,i=n.isStopped,r=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,s=n._windowTime;i||(r.push(t),!a&&r.push(o.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,i=this._buffer.slice(),r=0;r<i.length&&!e.closed;r+=n?1:2)e.next(i[r]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,i=e._buffer,r=e._infiniteTimeWindow,a=(r?1:2)*t;if(t<1/0&&a<i.length&&i.splice(0,i.length-a),!r){for(var o=n.now(),s=0,u=1;u<i.length&&i[u]<=o;u+=2)s=u;s&&i.splice(0,s+1)}},t}(Af),Of=function(e){function t(t,n){return e.call(this)||this}return Ud(t,e),t.prototype.schedule=function(e,t){return this},t}(tf),zf={setInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=zf.delegate;return((null===n||void 0===n?void 0:n.setInterval)||setInterval).apply(void 0,qd([],Gd(e)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=zf.delegate;return((null===t||void 0===t?void 0:t.clearInterval)||clearInterval)(e)})),delegate:void 0},Ff=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return Ud(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),zf.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;zf.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,i=!1;try{this.work(e)}catch(r){i=!0,n=!!r&&r||new Error(r)}if(i)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ef(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Of),Bf=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Nf.now,e}(),$f=function(e){function t(t,n){void 0===n&&(n=Bf.now);var i=e.call(this,t,n)||this;return i.actions=[],i._active=!1,i._scheduled=void 0,i}return Ud(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Bf),jf=new $f(Ff),Uf=jf,Vf=new kf((function(e){return e.complete()}));function Hf(e){return e?function(e){return new kf((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Vf}function Wf(e,t){return new kf((function(n){var i=0;return t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())}))}))}var Gf=function(e){return e&&"number"===typeof e.length&&"function"!==typeof e};function qf(e){return Kd(null===e||void 0===e?void 0:e.then)}var Zf="function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Xf(e,t,n,i){void 0===i&&(i=0);var r=t.schedule((function(){try{n.call(this)}catch(MN){e.error(MN)}}),i);return e.add(r),r}function Yf(e,t){if(!e)throw new Error("Iterable cannot be null");return new kf((function(n){var i=new tf;return i.add(t.schedule((function(){var r=e[Symbol.asyncIterator]();i.add(t.schedule((function(){var e=this;r.next().then((function(t){t.done?n.complete():(n.next(t.value),e.schedule())}))})))}))),i}))}function Kf(e){return Kd(e[bf])}function Jf(e){return Kd(null===e||void 0===e?void 0:e[Zf])}function Qf(e){return Symbol.asyncIterator&&Kd(null===e||void 0===e?void 0:e[Symbol.asyncIterator])}function ep(e){return new TypeError("You provided "+(null!==e&&"object"===typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function tp(e){return Xd(this,arguments,(function(){var t,n,i;return Hd(this,(function(r){switch(r.label){case 0:t=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,Zd(t.read())];case 3:return n=r.sent(),i=n.value,n.done?[4,Zd(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,Zd(i)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function np(e){return Kd(null===e||void 0===e?void 0:e.getReader)}function ip(e,t){if(null!=e){if(Kf(e))return function(e,t){return new kf((function(n){var i=new tf;return i.add(t.schedule((function(){var r=e[bf]();i.add(r.subscribe({next:function(e){i.add(t.schedule((function(){return n.next(e)})))},error:function(e){i.add(t.schedule((function(){return n.error(e)})))},complete:function(){i.add(t.schedule((function(){return n.complete()})))}}))}))),i}))}(e,t);if(Gf(e))return Wf(e,t);if(qf(e))return function(e,t){return new kf((function(n){return t.schedule((function(){return e.then((function(e){n.add(t.schedule((function(){n.next(e),n.add(t.schedule((function(){return n.complete()})))})))}),(function(e){n.add(t.schedule((function(){return n.error(e)})))}))}))}))}(e,t);if(Qf(e))return Yf(e,t);if(Jf(e))return function(e,t){return new kf((function(n){var i;return n.add(t.schedule((function(){i=e[Zf](),Xf(n,t,(function(){var e=i.next(),t=e.value;e.done?n.complete():(n.next(t),this.schedule())}))}))),function(){return Kd(null===i||void 0===i?void 0:i.return)&&i.return()}}))}(e,t);if(np(e))return function(e,t){return Yf(tp(e),t)}(e,t)}throw ep(e)}function rp(e,t){return t?ip(e,t):ap(e)}function ap(e){if(e instanceof kf)return e;if(null!=e){if(Kf(e))return i=e,new kf((function(e){var t=i[bf]();if(Kd(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Gf(e))return op(e);if(qf(e))return n=e,new kf((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,uf)}));if(Qf(e))return sp(e);if(Jf(e))return t=e,new kf((function(e){var n,i;try{for(var r=Wd(t),a=r.next();!a.done;a=r.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()}));if(np(e))return sp(tp(e))}var t,n,i;throw ep(e)}function op(e){return new kf((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function sp(e){return new kf((function(t){(function(e,t){var n,i,r,a;return Vd(this,void 0,void 0,(function(){var o,s;return Hd(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=Yd(e),u.label=1;case 1:return[4,n.next()];case 2:if((i=u.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),r={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),i&&!i.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function up(e,t){return t?Wf(e,t):op(e)}function lp(e){return e&&Kd(e.schedule)}function cp(e){return e[e.length-1]}function hp(e){return Kd(cp(e))?e.pop():void 0}function dp(e){return lp(cp(e))?e.pop():void 0}function fp(e,t){return"number"===typeof cp(e)?e.pop():t}function pp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dp(e);return n?Wf(e,n):up(e)}function vp(e,t){var n=Kd(e)?e:function(){return e},i=function(e){return e.error(n())};return new kf(t?function(e){return t.schedule(i,0,e)}:i)}var mp=Jd((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function gp(e){return e instanceof Date&&!isNaN(e)}var _p=Jd((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function yp(e,t){var n=gp(e)?{first:e}:"number"===typeof e?{each:e}:e,i=n.first,r=n.each,a=n.with,o=void 0===a?bp:a,s=n.scheduler,u=void 0===s?null!==t&&void 0!==t?t:jf:s,l=n.meta,c=void 0===l?null:l;if(null==i&&null==r)throw new TypeError("No timeout provided.");return Tf((function(e,t){var n,a,s=null,l=0,h=function(e){a=Xf(t,u,(function(){n.unsubscribe(),ap(o({meta:c,lastValue:s,seen:l})).subscribe(t)}),e)};n=e.subscribe(new Cf(t,(function(e){null===a||void 0===a||a.unsubscribe(),l++,t.next(s=e),r>0&&h(r)}),void 0,void 0,(function(){(null===a||void 0===a?void 0:a.closed)||null===a||void 0===a||a.unsubscribe(),s=null}))),h(null!=i?"number"===typeof i?i:+i-u.now():r)}))}function bp(e){throw new _p(e)}function xp(e,t){return Tf((function(n,i){var r=0;n.subscribe(new Cf(i,(function(n){i.next(e.call(t,n,r++))})))}))}var wp=Array.isArray;function kp(e){return xp((function(t){return function(e,t){return wp(t)?e.apply(void 0,qd([],Gd(t))):e(t)}(e,t)}))}var Sp=Array.isArray,Mp=Object.getPrototypeOf,Tp=Object.prototype,Cp=Object.keys;function Ep(e){if(1===e.length){var t=e[0];if(Sp(t))return{args:t,keys:null};if((i=t)&&"object"===typeof i&&Mp(i)===Tp){var n=Cp(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var i;return{args:e,keys:null}}function Pp(e,t){return e.reduce((function(e,n,i){return e[n]=t[i],e}),{})}function Lp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dp(e),i=hp(e),r=Ep(e),a=r.args,o=r.keys;if(0===a.length)return rp([],n);var s=new kf(Ap(a,n,o?function(e){return Pp(o,e)}:xf));return i?s.pipe(kp(i)):s}function Ap(e,t,n){return void 0===n&&(n=xf),function(i){Ip(t,(function(){for(var r=e.length,a=new Array(r),o=r,s=r,u=function(r){Ip(t,(function(){var u=rp(e[r],t),l=!1;u.subscribe(new Cf(i,(function(e){a[r]=e,l||(l=!0,s--),s||i.next(n(a.slice()))}),(function(){--o||i.complete()})))}),i)},l=0;l<r;l++)u(l)}),i)}}function Ip(e,t,n){e?n.add(e.schedule(t)):t()}function Rp(e,t,n,i,r,a,o,s){var u=[],l=0,c=0,h=!1,d=function(){!h||u.length||l||t.complete()},f=function(e){return l<i?p(e):u.push(e)},p=function e(s){a&&t.next(s),l++;var h=!1;ap(n(s,c++)).subscribe(new Cf(t,(function(e){null===r||void 0===r||r(e),a?f(e):t.next(e)}),(function(){h=!0}),void 0,(function(){if(h)try{l--;for(var n=function(){var n=u.shift();o?t.add(o.schedule((function(){return e(n)}))):e(n)};u.length&&l<i;)n();d()}catch(MN){t.error(MN)}})))};return e.subscribe(new Cf(t,f,(function(){h=!0,d()}))),function(){null===s||void 0===s||s()}}function Np(e,t,n){return void 0===n&&(n=1/0),Kd(t)?Np((function(n,i){return xp((function(e,r){return t(n,e,i,r)}))(ap(e(n,i)))}),n):("number"===typeof t&&(n=t),Tf((function(t,i){return Rp(t,i,e,n)})))}function Dp(e){return void 0===e&&(e=1/0),Np(xf,e)}function Op(){return Dp(1)}function zp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Op()(up(e,dp(e)))}var Fp=["addListener","removeListener"],Bp=["addEventListener","removeEventListener"],$p=["on","off"];function jp(e,t,n,i){if(Kd(n)&&(i=n,n=void 0),i)return jp(e,t,n).pipe(kp(i));var r=Gd(function(e){return Kd(e.addEventListener)&&Kd(e.removeEventListener)}(e)?Bp.map((function(i){return function(r){return e[i](t,r,n)}})):function(e){return Kd(e.addListener)&&Kd(e.removeListener)}(e)?Fp.map(Up(e,t)):function(e){return Kd(e.on)&&Kd(e.off)}(e)?$p.map(Up(e,t)):[],2),a=r[0],o=r[1];if(!a&&Gf(e))return Np((function(e){return jp(e,t,n)}))(up(e));if(!a)throw new TypeError("Invalid event target");return new kf((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return a(t),function(){return o(t)}}))}function Up(e,t){return function(n){return function(i){return e[n](t,i)}}}function Vp(e,t,n){void 0===e&&(e=0),void 0===n&&(n=Uf);var i=-1;return null!=t&&(lp(t)?n=t:i=t),new kf((function(t){var r=gp(e)?+e-n.now():e;r<0&&(r=0);var a=0;return n.schedule((function(){t.closed||(t.next(a++),0<=i?this.schedule(void 0,i):t.complete())}),r)}))}function Hp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dp(e),i=fp(e,1/0),r=e;return r.length?1===r.length?ap(r[0]):Dp(i)(up(r,n)):Vf}var Wp=Array.isArray;function Gp(e){return 1===e.length&&Wp(e[0])?e[0]:e}function qp(e,t){return Tf((function(n,i){var r=0;n.subscribe(new Cf(i,(function(n){return e.call(t,n,r++)&&i.next(n)})))}))}function Zp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=hp(e),i=Gp(e);return i.length?new kf((function(e){var t=i.map((function(){return[]})),r=i.map((function(){return!1}));e.add((function(){t=r=null}));for(var a=function(a){ap(i[a]).subscribe(new Cf(e,(function(i){if(t[a].push(i),t.every((function(e){return e.length}))){var o=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,qd([],Gd(o))):o),t.some((function(e,t){return!e.length&&r[t]}))&&e.complete()}}),(function(){r[a]=!0,!t[a].length&&e.complete()})))},o=0;!e.closed&&o<i.length;o++)a(o);return function(){t=r=null}})):Vf}function Xp(e,t){return void 0===t&&(t=Uf),n=function(){return Vp(e,t)},Tf((function(e,t){var i=!1,r=null,a=null,o=!1,s=function(){if(null===a||void 0===a||a.unsubscribe(),a=null,i){i=!1;var e=r;r=null,t.next(e)}o&&t.complete()},u=function(){a=null,o&&t.complete()};e.subscribe(new Cf(t,(function(e){i=!0,r=e,a||ap(n(e)).subscribe(a=new Cf(t,s,u))}),(function(){o=!0,(!i||!a||a.closed)&&t.complete()})))}));var n}function Yp(e,t){return void 0===t&&(t=null),t=null!==t&&void 0!==t?t:e,Tf((function(n,i){var r=[],a=0;n.subscribe(new Cf(i,(function(n){var o,s,u,l,c=null;a++%t===0&&r.push([]);try{for(var h=Wd(r),d=h.next();!d.done;d=h.next()){(v=d.value).push(n),e<=v.length&&(c=null!==c&&void 0!==c?c:[]).push(v)}}catch(m){o={error:m}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}if(c)try{for(var f=Wd(c),p=f.next();!p.done;p=f.next()){var v=p.value;ef(r,v),i.next(v)}}catch(g){u={error:g}}finally{try{p&&!p.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}}),(function(){var e,t;try{for(var n=Wd(r),a=n.next();!a.done;a=n.next()){var o=a.value;i.next(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}i.complete()}),void 0,(function(){r=null})))}))}function Kp(e){return Tf((function(t,n){var i,r=null,a=!1;r=t.subscribe(new Cf(n,void 0,void 0,(function(o){i=ap(e(o,Kp(e)(t))),r?(r.unsubscribe(),r=null,i.subscribe(n)):a=!0}))),a&&(r.unsubscribe(),r=null,i.subscribe(n))}))}function Jp(e,t,n,i,r){return function(a,o){var s=n,u=t,l=0;a.subscribe(new Cf(o,(function(t){var n=l++;u=s?e(u,t,n):(s=!0,t),i&&o.next(u)}),r&&function(){s&&o.next(u),o.complete()}))}}function Qp(e,t){return Tf(Jp(e,t,arguments.length>=2,!1,!0))}function ev(e,t){return Kd(t)?Np(e,t,1):Np(e,1)}var tv={connector:function(){return new Af}};function nv(e,t){void 0===t&&(t=tv);var n=t.connector;return Tf((function(t,i){var r,a=n();rp(e((r=a,new kf((function(e){return r.subscribe(e)}))))).subscribe(i),i.add(t.subscribe(a))}))}function iv(e,t){return void 0===t&&(t=jf),Tf((function(n,i){var r=null,a=null,o=null,s=function(){if(r){r.unsubscribe(),r=null;var e=a;a=null,i.next(e)}};function u(){var n=o+e,a=t.now();if(a<n)return r=this.schedule(void 0,n-a),void i.add(r);s()}n.subscribe(new Cf(i,(function(n){a=n,o=t.now(),r||(r=t.schedule(u,e),i.add(r))}),(function(){s(),i.complete()}),void 0,(function(){a=r=null})))}))}function rv(e){return Tf((function(t,n){var i=!1;t.subscribe(new Cf(n,(function(e){i=!0,n.next(e)}),(function(){i||n.next(e),n.complete()})))}))}function av(e){return e<=0?function(){return Vf}:Tf((function(t,n){var i=0;t.subscribe(new Cf(n,(function(t){++i<=e&&(n.next(t),e<=i&&n.complete())})))}))}function ov(e,t){return void 0===t&&(t=xf),e=null!==e&&void 0!==e?e:sv,Tf((function(n,i){var r,a=!0;n.subscribe(new Cf(i,(function(n){var o=t(n);!a&&e(r,o)||(a=!1,r=o,i.next(n))})))}))}function sv(e,t){return e===t}function uv(e){return void 0===e&&(e=lv),Tf((function(t,n){var i=!1;t.subscribe(new Cf(n,(function(e){i=!0,n.next(e)}),(function(){return i?n.complete():n.error(e())})))}))}function lv(){return new mp}function cv(e,t,n){return void 0===t&&(t=1/0),t=(t||0)<1?1/0:t,Tf((function(i,r){return Rp(i,r,e,t,void 0,!0,n)}))}function hv(e){return Tf((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))}function dv(e,t){var n=arguments.length>=2;return function(i){return i.pipe(e?qp((function(t,n){return e(t,n,i)})):xf,av(1),n?rv(t):uv((function(){return new mp})))}}function fv(e){return e<=0?function(){return Vf}:Tf((function(t,n){var i=[];t.subscribe(new Cf(n,(function(t){i.push(t),e<i.length&&i.shift()}),(function(){var e,t;try{for(var r=Wd(i),a=r.next();!a.done;a=r.next()){var o=a.value;n.next(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){i=null})))}))}function pv(e,t){var n=arguments.length>=2;return function(i){return i.pipe(e?qp((function(t,n){return e(t,n,i)})):xf,fv(1),n?rv(t):uv((function(){return new mp})))}}function vv(e,t){var n=Kd(e)?e:function(){return e};return Kd(t)?nv(t,{connector:n}):function(e){return new Pf(e,n)}}function mv(){return Tf((function(e,t){var n,i=!1;e.subscribe(new Cf(t,(function(e){var r=n;n=e,i&&t.next([r,e]),i=!0})))}))}function gv(e){return e?function(t){return nv(e)(t)}:function(e){return vv(new Af)(e)}}function _v(e,t,n,i){n&&!Kd(n)&&(i=n);var r=Kd(n)?n:void 0;return function(n){return vv(new Df(e,t,i),r)(n)}}function yv(e){var t;void 0===e&&(e=1/0);var n=(t=e&&"object"===typeof e?e:{count:e}).count,i=void 0===n?1/0:n,r=t.delay,a=t.resetOnSuccess,o=void 0!==a&&a;return i<=0?xf:Tf((function(e,t){var n,a=0;!function s(){var u=!1;n=e.subscribe(new Cf(t,(function(e){o&&(a=0),t.next(e)}),void 0,(function(e){if(a++<i){var o=function(){n?(n.unsubscribe(),n=null,s()):u=!0};if(null!=r){var l="number"===typeof r?Vp(r):ap(r(e,a)),c=new Cf(t,(function(){c.unsubscribe(),o()}),(function(){t.complete()}));l.subscribe(c)}else o()}else t.error(e)}))),u&&(n.unsubscribe(),n=null,s())}()}))}function bv(e,t){return Tf(Jp(e,t,arguments.length>=2,!0))}function xv(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Af}:t,i=e.resetOnError,r=void 0===i||i,a=e.resetOnComplete,o=void 0===a||a,s=e.resetOnRefCountZero,u=void 0===s||s;return function(e){var t=null,i=null,a=null,s=0,l=!1,c=!1,h=function(){null===i||void 0===i||i.unsubscribe(),i=null},d=function(){h(),t=a=null,l=c=!1},f=function(){var e=t;d(),null===e||void 0===e||e.unsubscribe()};return Tf((function(e,p){s++,c||l||h();var v=a=null!==a&&void 0!==a?a:n();p.add((function(){0!==--s||c||l||(i=wv(f,u))})),v.subscribe(p),t||(t=new vf({next:function(e){return v.next(e)},error:function(e){c=!0,h(),i=wv(d,r,e),v.error(e)},complete:function(){l=!0,h(),i=wv(d,o),v.complete()}}),rp(e).subscribe(t))}))(e)}}function wv(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return!0===t?(e(),null):!1===t?null:t.apply(void 0,qd([],Gd(n))).pipe(av(1)).subscribe((function(){return e()}))}function kv(e){return qp((function(t,n){return e<=n}))}function Sv(e){return Tf((function(t,n){var i=!1,r=0;t.subscribe(new Cf(n,(function(t){return(i||(i=!e(t,r++)))&&n.next(t)})))}))}function Mv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dp(e);return Tf((function(t,i){(n?zp(e,t,n):zp(e,t)).subscribe(i)}))}function Tv(e,t){return Tf((function(n,i){var r=null,a=0,o=!1,s=function(){return o&&!r&&i.complete()};n.subscribe(new Cf(i,(function(n){null===r||void 0===r||r.unsubscribe();var o=0,u=a++;ap(e(n,u)).subscribe(r=new Cf(i,(function(e){return i.next(t?t(n,e,u,o++):e)}),(function(){r=null,s()})))}),(function(){o=!0,s()})))}))}function Cv(e){return Tf((function(t,n){ap(e).subscribe(new Cf(n,(function(){return n.complete()}),lf)),!n.closed&&t.subscribe(n)}))}function Ev(e,t){return void 0===t&&(t=!1),Tf((function(n,i){var r=0;n.subscribe(new Cf(i,(function(n){var a=e(n,r++);(a||t)&&i.next(n),!a&&i.complete()})))}))}function Pv(e,t,n){var i=Kd(e)||t||n?{next:e,error:t,complete:n}:e;return i?Tf((function(e,t){var n;null===(n=i.subscribe)||void 0===n||n.call(i);var r=!0;e.subscribe(new Cf(t,(function(e){var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)}),(function(){var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()}),(function(e){var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)}),(function(){var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)})))})):xf}function Lv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=hp(e);return Tf((function(t,i){for(var r=e.length,a=new Array(r),o=e.map((function(){return!1})),s=!1,u=function(t){ap(e[t]).subscribe(new Cf(i,(function(e){a[t]=e,s||o[t]||(o[t]=!0,(s=o.every(xf))&&(o=null))}),lf))},l=0;l<r;l++)u(l);t.subscribe(new Cf(i,(function(e){if(s){var t=qd([e],Gd(a));i.next(n?n.apply(void 0,qd([],Gd(t))):t)}})))}))}for(var Av=function(){function e(){Fd(this,e)}return $d(e,[{key:"createFilter",value:function(e){return new Function("node","return "+this._compile(e)+";")}},{key:"_compile",value:function(e){if(null==e||e.length<=1)return"true";var t=e[0];return"("+("=="===t?this._compileComparisonOp("===",e[1],e[2],!1):"!="===t?this._compileComparisonOp("!==",e[1],e[2],!1):">"===t||">="===t||"<"===t||"<="===t?this._compileComparisonOp(t,e[1],e[2],!0):"in"===t?this._compileInOp(e[1],e.slice(2)):"!in"===t?this._compileNegation(this._compileInOp(e[1],e.slice(2))):"all"===t?this._compileLogicalOp(e.slice(1),"&&"):"true")+")"}},{key:"_compare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"_compileComparisonOp",value:function(e,t,n,i){var r=this._compilePropertyReference(t),a=JSON.stringify(n);return(i?"typeof "+r+"===typeof "+a+"&&":"")+r+e+a}},{key:"_compileInOp",value:function(e,t){var n=this._compare;return JSON.stringify(t.sort(n))+".indexOf("+this._compilePropertyReference(e)+")!==-1"}},{key:"_compileLogicalOp",value:function(e,t){var n=this._compile.bind(this);return e.map(n).join(t)}},{key:"_compileNegation",value:function(e){return"!("+e+")"}},{key:"_compilePropertyReference",value:function(e){return"node["+JSON.stringify(e)+"]"}}]),e}(),Iv=100,Rv=301,Nv=302,Dv=306,Ov=1e3,zv=1001,Fv=1002,Bv=1003,$v=1006,jv=1008,Uv=1009,Vv=1012,Hv=1014,Wv=1015,Gv=1016,qv=1020,Zv=1022,Xv=1023,Yv=1026,Kv=1027,Jv=2300,Qv=2301,em=2302,tm=2400,nm=2401,im=2402,rm=2500,am=2501,om=3e3,sm=3001,um=3007,lm=3002,cm=7680,hm=35044,dm=35048,fm="300 es",pm=function(){function e(){Fd(this,e)}return $d(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}}]),e}(),vm=1234567,mm=Math.PI/180,gm=180/Math.PI,_m=[],ym=0;ym<256;ym++)_m[ym]=(ym<16?"0":"")+ym.toString(16);var bm="undefined"!==typeof crypto&&"randomUUID"in crypto;function xm(){if(bm)return crypto.randomUUID().toUpperCase();var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(_m[255&e]+_m[e>>8&255]+_m[e>>16&255]+_m[e>>24&255]+"-"+_m[255&t]+_m[t>>8&255]+"-"+_m[t>>16&15|64]+_m[t>>24&255]+"-"+_m[63&n|128]+_m[n>>8&255]+"-"+_m[n>>16&255]+_m[n>>24&255]+_m[255&i]+_m[i>>8&255]+_m[i>>16&255]+_m[i>>24&255]).toUpperCase()}function wm(e,t,n){return Math.max(t,Math.min(n,e))}function km(e,t){return(e%t+t)%t}function Sm(e,t,n){return(1-n)*e+n*t}function Mm(e){return 0===(e&e-1)&&0!==e}function Tm(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Cm=Object.freeze({__proto__:null,DEG2RAD:mm,RAD2DEG:gm,generateUUID:xm,clamp:wm,euclideanModulo:km,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Sm,damp:function(e,t,n,i){return Sm(e,t,1-Math.exp(-n*i))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(km(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(vm=e%2147483647),((vm=16807*vm%2147483647)-1)/2147483646},degToRad:function(e){return e*mm},radToDeg:function(e){return e*gm},isPowerOfTwo:Mm,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:Tm,setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),l=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),d=o((t-i)/2),f=a((i-t)/2),p=o((i-t)/2);switch(r){case"XYX":e.set(s*c,u*h,u*d,s*l);break;case"YZY":e.set(u*d,s*c,u*h,s*l);break;case"ZXZ":e.set(u*h,u*d,s*c,s*l);break;case"XZX":e.set(s*c,u*p,u*f,s*l);break;case"YXY":e.set(u*f,s*c,u*p,s*l);break;case"ZYZ":e.set(u*p,u*f,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}}),Em=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Fd(this,t),this.x=e,this.y=n}return $d(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:zd().mark((function e(){return zd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}();Em.prototype.isVector2=!0;var Pm,Lm=function(){function e(){Fd(this,e),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return $d(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,u){var l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=r,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=i[0],v=i[3],m=i[6],g=i[1],_=i[4],y=i[7],b=i[2],x=i[5],w=i[8];return r[0]=a*p+o*g+s*b,r[3]=a*v+o*_+s*x,r[6]=a*m+o*y+s*w,r[1]=u*p+l*g+c*b,r[4]=u*v+l*_+c*x,r[7]=u*m+l*y+c*w,r[2]=h*p+d*g+f*b,r[5]=h*v+d*_+f*x,r[8]=h*m+d*y+f*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*r*l+n*o*s+i*r*u-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*a-o*u,h=o*s-l*r,d=u*r-a*s,f=t*c+n*h+i*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=c*p,e[1]=(i*u-l*n)*p,e[2]=(o*n-i*a)*p,e[3]=h*p,e[4]=(l*t-i*s)*p,e[5]=(i*r-o*t)*p,e[6]=d*p,e[7]=(n*s-u*t)*p,e[8]=(a*t-n*r)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),u=Math.sin(r);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-i*u,i*s,-i*(-u*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],u=i[4],l=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*u,i[6]=t*o+n*l,i[1]=-n*r+t*s,i[4]=-n*a+t*u,i[7]=-n*o+t*l,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function Am(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function Im(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Rm(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=3735928559^n,r=1103547991^n,a=0;a<e.length;a++)t=e.charCodeAt(a),i=Math.imul(i^t,2654435761),r=Math.imul(r^t,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*(2097151&(r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909)))+(i>>>0)}Lm.prototype.isMatrix3=!0;var Nm=function(){function e(){Fd(this,e)}return $d(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Pm&&(Pm=Im("canvas")),Pm.width=e.width,Pm.height=e.height;var n=Pm.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Pm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}]),e}(),Dm=0,Om=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:zv,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:zv,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$v,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:jv,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Xv,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Uv,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:om;return Fd(this,n),e=t.call(this),Object.defineProperty(Ad(e),"id",{value:Dm++}),e.uuid=xm(),e.name="",e.image=i,e.mipmaps=[],e.mapping=r,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=h,e.format=l,e.internalFormat=null,e.type=c,e.offset=new Em(0,0),e.repeat=new Em(1,1),e.center=new Em(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new Lm,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=d,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e}return $d(n,[{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=xm()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(zm(i[a].image)):r.push(zm(i[a]))}else r=zm(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ov:e.x=e.x-Math.floor(e.x);break;case zv:e.x=e.x<0?0:1;break;case Fv:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ov:e.y=e.y-Math.floor(e.y);break;case zv:e.y=e.y<0?0:1;break;case Fv:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(pm);function zm(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Nm.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Om.DEFAULT_IMAGE=void 0,Om.DEFAULT_MAPPING=300,Om.prototype.isTexture=!0;var Fm=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Fd(this,t),this.x=e,this.y=n,this.z=i,this.w=r}return $d(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],d=s[5],f=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(l-h)<a&&Math.abs(c-p)<a&&Math.abs(f-v)<a){if(Math.abs(l+h)<o&&Math.abs(c+p)<o&&Math.abs(f+v)<o&&Math.abs(u+d+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,_=(d+1)/2,y=(m+1)/2,b=(l+h)/4,x=(c+p)/4,w=(f+v)/4;return g>_&&g>y?g<a?(n=0,i=.707106781,r=.707106781):(i=b/(n=Math.sqrt(g)),r=x/n):_>y?_<a?(n=.707106781,i=0,r=.707106781):(n=b/(i=Math.sqrt(_)),r=w/i):y<a?(n=.707106781,i=.707106781,r=0):(n=x/(r=Math.sqrt(y)),i=w/r),this.set(n,i,r,t),this}var k=Math.sqrt((v-f)*(v-f)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(k)<.001&&(k=1),this.x=(v-f)/k,this.y=(c-p)/k,this.z=(h-l)/k,this.w=Math.acos((u+d+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:zd().mark((function e(){return zd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}();Fm.prototype.isVector4=!0;var Bm=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Fd(this,n),(r=t.call(this)).width=e,r.height=i,r.depth=1,r.scissor=new Fm(0,0,e,i),r.scissorTest=!1,r.viewport=new Fm(0,0,e,i),r.texture=new Om(void 0,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),r.texture.isRenderTargetTexture=!0,r.texture.image={width:e,height:i,depth:1},r.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,r.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,r.texture.minFilter=void 0!==a.minFilter?a.minFilter:$v,r.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,r.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,r.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,r}return $d(n,[{key:"setTexture",value:function(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}},{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Jh({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(pm);Bm.prototype.isWebGLRenderTarget=!0;var $m=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;Fd(this,n);var o=(a=t.call(this,e,i)).texture;a.texture=[];for(var s=0;s<r;s++)a.texture[s]=o.clone();return a}return $d(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}]),n}(Bm);$m.prototype.isWebGLMultipleRenderTargets=!0;var jm=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r)).samples=4,a}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.samples=e.samples,this}}]),n}(Bm);jm.prototype.isWebGLMultisampleRenderTarget=!0;var Um=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Fd(this,e),this._x=t,this._y=n,this._z=i,this._w=r}return $d(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(i/2),c=o(r/2),h=s(n/2),d=s(i/2),f=s(r/2);switch(a){case"XYZ":this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f;break;case"YXZ":this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f;break;case"ZXY":this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f;break;case"ZYX":this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f;break;case"YZX":this._x=h*l*c+u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c-h*d*f;break;case"XZY":this._x=h*l*c-u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(l-s)*d,this._y=(r-u)*d,this._z=(a-i)*d}else if(n>o&&n>c){var f=2*Math.sqrt(1+n-o-c);this._w=(l-s)/f,this._x=.25*f,this._y=(i+a)/f,this._z=(r+u)/f}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(r-u)/p,this._x=(i+a)/p,this._y=.25*p,this._z=(s+l)/p}else{var v=2*Math.sqrt(1+c-n-o);this._w=(a-i)/v,this._x=(r+u)/v,this._y=(s+l)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(wm(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+i*u-r*s,this._y=i*l+a*s+r*o-n*u,this._z=r*l+a*u+n*s-i*o,this._w=a*l-n*o-i*s-r*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*n+t*this._x,this._y=u*i+t*this._y,this._z=u*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],u=n[i+1],l=n[i+2],c=n[i+3],h=r[a+0],d=r[a+1],f=r[a+2],p=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(c!==p||s!==h||u!==d||l!==f){var v=1-o,m=s*h+u*d+l*f+c*p,g=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){var y=Math.sqrt(_),b=Math.atan2(y,m*g);v=Math.sin(v*b)/y,o=Math.sin(o*b)/y}var x=o*g;if(s=s*v+h*x,u=u*v+d*x,l=l*v+f*x,c=c*v+p*x,v===1-o){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],u=n[i+2],l=n[i+3],c=r[a],h=r[a+1],d=r[a+2],f=r[a+3];return e[t]=o*f+l*c+s*d-u*h,e[t+1]=s*f+l*h+u*c-o*d,e[t+2]=u*f+l*d+o*h-s*c,e[t+3]=l*f-o*c-s*h-u*d,e}}]),e}();Um.prototype.isQuaternion=!0;var Vm=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Fd(this,t),this.x=e,this.y=n,this.z=i}return $d(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Wm.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Wm.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*i-o*n,l=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=u*s+h*-r+l*-o-c*-a,this.y=l*s+h*-a+c*-r-u*-o,this.z=c*s+h*-o+u*-a-l*-r,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Hm.copy(this).projectOnVector(e),this.sub(Hm)}},{key:"reflect",value:function(e){return this.sub(Hm.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(wm(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:zd().mark((function e(){return zd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}();Vm.prototype.isVector3=!0;var Hm=new Vm,Wm=new Um,Gm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm(-1/0,-1/0,-1/0);Fd(this,e),this.min=t,this.max=n}return $d(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Zm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Xm.copy(t.boundingBox),Xm.applyMatrix4(e.matrixWorld),this.union(Xm));for(var n=e.children,i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Zm),Zm.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(ng),ig.subVectors(this.max,ng),Ym.subVectors(e.a,ng),Km.subVectors(e.b,ng),Jm.subVectors(e.c,ng),Qm.subVectors(Km,Ym),eg.subVectors(Jm,Km),tg.subVectors(Ym,Jm);var t=[0,-Qm.z,Qm.y,0,-eg.z,eg.y,0,-tg.z,tg.y,Qm.z,0,-Qm.x,eg.z,0,-eg.x,tg.z,0,-tg.x,-Qm.y,Qm.x,0,-eg.y,eg.x,0,-tg.y,tg.x,0];return!!og(t,Ym,Km,Jm,ig)&&(!!og(t=[1,0,0,0,1,0,0,0,1],Ym,Km,Jm,ig)&&(rg.crossVectors(Qm,eg),og(t=[rg.x,rg.y,rg.z],Ym,Km,Jm,ig)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Zm.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Zm).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(qm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),qm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),qm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),qm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),qm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),qm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),qm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),qm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(qm)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();Gm.prototype.isBox3=!0;var qm=[new Vm,new Vm,new Vm,new Vm,new Vm,new Vm,new Vm,new Vm],Zm=new Vm,Xm=new Gm,Ym=new Vm,Km=new Vm,Jm=new Vm,Qm=new Vm,eg=new Vm,tg=new Vm,ng=new Vm,ig=new Vm,rg=new Vm,ag=new Vm;function og(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){ag.fromArray(e,a);var s=r.x*Math.abs(ag.x)+r.y*Math.abs(ag.y)+r.z*Math.abs(ag.z),u=t.dot(ag),l=n.dot(ag),c=i.dot(ag);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var sg=new Gm,ug=new Vm,lg=new Vm,cg=new Vm,hg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Fd(this,e),this.center=t,this.radius=n}return $d(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):sg.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){cg.subVectors(e,this.center);var t=cg.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=.5*(n-this.radius);this.center.add(cg.multiplyScalar(i/n)),this.radius+=i}return this}},{key:"union",value:function(e){return lg.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(ug.copy(e.center).add(lg)),this.expandByPoint(ug.copy(e.center).sub(lg)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),dg=new Vm,fg=new Vm,pg=new Vm,vg=new Vm,mg=new Vm,gg=new Vm,_g=new Vm,yg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm(0,0,-1);Fd(this,e),this.origin=t,this.direction=n}return $d(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,dg)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=dg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dg.copy(this.direction).multiplyScalar(t).add(this.origin),dg.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){fg.copy(e).add(t).multiplyScalar(.5),pg.copy(t).sub(e).normalize(),vg.copy(this.origin).sub(fg);var r,a,o,s,u=.5*e.distanceTo(t),l=-this.direction.dot(pg),c=vg.dot(this.direction),h=-vg.dot(pg),d=vg.lengthSq(),f=Math.abs(1-l*l);if(f>0)if(a=l*c-h,s=u*f,(r=l*h-c)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(r*=p)*(r+l*(a*=p)+2*c)+a*(l*r+a+2*h)+d}else a=u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+d;else a=-u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+d;else a<=-s?o=-(r=Math.max(0,-(-l*u+c)))*r+(a=r>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+d:a<=s?(r=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+d):o=-(r=Math.max(0,-(l*u+c)))*r+(a=r>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+d;else a=l>0?-u:u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(pg).multiplyScalar(a).add(fg),o}},{key:"intersectSphere",value:function(e,t){dg.subVectors(e.center,this.origin);var n=dg.dot(this.direction),i=dg.dot(dg)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,i=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,i=(e.min.x-h.x)*u),l>=0?(r=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||r>i?null:((r>n||n!==n)&&(n=r),(a<i||i!==i)&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,dg)}},{key:"intersectTriangle",value:function(e,t,n,i,r){mg.subVectors(t,e),gg.subVectors(n,e),_g.crossVectors(mg,gg);var a,o=this.direction.dot(_g);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}vg.subVectors(this.origin,e);var s=a*this.direction.dot(gg.crossVectors(vg,gg));if(s<0)return null;var u=a*this.direction.dot(mg.cross(vg));if(u<0)return null;if(s+u>o)return null;var l=-a*vg.dot(_g);return l<0?null:this.at(l/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),bg=function(){function e(){Fd(this,e),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return $d(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,u,l,c,h,d,f,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/xg.setFromMatrixColumn(e,0).length(),r=1/xg.setFromMatrixColumn(e,1).length(),a=1/xg.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*l,d=a*c,f=o*l,p=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=d+f*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=f+d*u,t[10]=a*s}else if("YXZ"===e.order){var v=s*l,m=s*c,g=u*l,_=u*c;t[0]=v+_*o,t[4]=g*o-m,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=m*o-g,t[6]=_+v*o,t[10]=a*s}else if("ZXY"===e.order){var y=s*l,b=s*c,x=u*l,w=u*c;t[0]=y-w*o,t[4]=-a*c,t[8]=x+b*o,t[1]=b+x*o,t[5]=a*l,t[9]=w-y*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var k=a*l,S=a*c,M=o*l,T=o*c;t[0]=s*l,t[4]=M*u-S,t[8]=k*u+T,t[1]=s*c,t[5]=T*u+k,t[9]=S*u-M,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var C=a*s,E=a*u,P=o*s,L=o*u;t[0]=s*l,t[4]=L-C*c,t[8]=P*c+E,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=E*c+P,t[10]=C-L*c}else if("XZY"===e.order){var A=a*s,I=a*u,R=o*s,N=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=A*c+N,t[5]=a*l,t[9]=I*c-R,t[2]=R*c-I,t[6]=o*l,t[10]=N*c+A}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(kg,e,Sg)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return Cg.subVectors(e,t),0===Cg.lengthSq()&&(Cg.z=1),Cg.normalize(),Mg.crossVectors(n,Cg),0===Mg.lengthSq()&&(1===Math.abs(n.z)?Cg.x+=1e-4:Cg.z+=1e-4,Cg.normalize(),Mg.crossVectors(n,Cg)),Mg.normalize(),Tg.crossVectors(Cg,Mg),i[0]=Mg.x,i[4]=Tg.x,i[8]=Cg.x,i[1]=Mg.y,i[5]=Tg.y,i[9]=Cg.y,i[2]=Mg.z,i[6]=Tg.z,i[10]=Cg.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],v=n[10],m=n[14],g=n[3],_=n[7],y=n[11],b=n[15],x=i[0],w=i[4],k=i[8],S=i[12],M=i[1],T=i[5],C=i[9],E=i[13],P=i[2],L=i[6],A=i[10],I=i[14],R=i[3],N=i[7],D=i[11],O=i[15];return r[0]=a*x+o*M+s*P+u*R,r[4]=a*w+o*T+s*L+u*N,r[8]=a*k+o*C+s*A+u*D,r[12]=a*S+o*E+s*I+u*O,r[1]=l*x+c*M+h*P+d*R,r[5]=l*w+c*T+h*L+d*N,r[9]=l*k+c*C+h*A+d*D,r[13]=l*S+c*E+h*I+d*O,r[2]=f*x+p*M+v*P+m*R,r[6]=f*w+p*T+v*L+m*N,r[10]=f*k+p*C+v*A+m*D,r[14]=f*S+p*E+v*I+m*O,r[3]=g*x+_*M+y*P+b*R,r[7]=g*w+_*T+y*L+b*N,r[11]=g*k+_*C+y*A+b*D,r[15]=g*S+_*E+y*I+b*O,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*s*c-i*u*c-r*o*h+n*u*h+i*o*d-n*s*d)+e[7]*(+t*s*d-t*u*h+r*a*h-i*a*d+i*u*l-r*s*l)+e[11]*(+t*u*c-t*o*d-r*a*c+n*a*d+r*o*l-n*u*l)+e[15]*(-i*o*l-t*s*c+t*o*h+i*a*c-n*a*h+n*s*l)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],m=e[15],g=c*v*u-p*h*u+p*s*d-o*v*d-c*s*m+o*h*m,_=f*h*u-l*v*u-f*s*d+a*v*d+l*s*m-a*h*m,y=l*p*u-f*c*u+f*o*d-a*p*d-l*o*m+a*c*m,b=f*c*s-l*p*s-f*o*h+a*p*h+l*o*v-a*c*v,x=t*g+n*_+i*y+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/x;return e[0]=g*w,e[1]=(p*h*r-c*v*r-p*i*d+n*v*d+c*i*m-n*h*m)*w,e[2]=(o*v*r-p*s*r+p*i*u-n*v*u-o*i*m+n*s*m)*w,e[3]=(c*s*r-o*h*r-c*i*u+n*h*u+o*i*d-n*s*d)*w,e[4]=_*w,e[5]=(l*v*r-f*h*r+f*i*d-t*v*d-l*i*m+t*h*m)*w,e[6]=(f*s*r-a*v*r-f*i*u+t*v*u+a*i*m-t*s*m)*w,e[7]=(a*h*r-l*s*r+l*i*u-t*h*u-a*i*d+t*s*d)*w,e[8]=y*w,e[9]=(f*c*r-l*p*r-f*n*d+t*p*d+l*n*m-t*c*m)*w,e[10]=(a*p*r-f*o*r+f*n*u-t*p*u-a*n*m+t*o*m)*w,e[11]=(l*o*r-a*c*r-l*n*u+t*c*u+a*n*d-t*o*d)*w,e[12]=b*w,e[13]=(l*p*i-f*c*i+f*n*h-t*p*h-l*n*v+t*c*v)*w,e[14]=(f*o*i-a*p*i-f*n*s+t*p*s+a*n*v-t*o*v)*w,e[15]=(a*c*i-l*o*i+l*n*s-t*c*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,u=r*a,l=r*o;return this.set(u*a+n,u*o-i*s,u*s+i*o,0,u*o+i*s,l*o+n,l*s-i*a,0,u*s-i*o,l*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,u=r+r,l=a+a,c=o+o,h=r*u,d=r*l,f=r*c,p=a*l,v=a*c,m=o*c,g=s*u,_=s*l,y=s*c,b=n.x,x=n.y,w=n.z;return i[0]=(1-(p+m))*b,i[1]=(d+y)*b,i[2]=(f-_)*b,i[3]=0,i[4]=(d-y)*x,i[5]=(1-(h+m))*x,i[6]=(v+g)*x,i[7]=0,i[8]=(f+_)*w,i[9]=(v-g)*w,i[10]=(1-(h+p))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=xg.set(i[0],i[1],i[2]).length(),a=xg.set(i[4],i[5],i[6]).length(),o=xg.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],wg.copy(this);var s=1/r,u=1/a,l=1/o;return wg.elements[0]*=s,wg.elements[1]*=s,wg.elements[2]*=s,wg.elements[4]*=u,wg.elements[5]*=u,wg.elements[6]*=u,wg.elements[8]*=l,wg.elements[9]*=l,wg.elements[10]*=l,t.setFromRotationMatrix(wg),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),u=2*r/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),u=1/(n-i),l=1/(a-r),c=(t+e)*s,h=(n+i)*u,d=(a+r)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}();bg.prototype.isMatrix4=!0;var xg=new Vm,wg=new bg,kg=new Vm(0,0,0),Sg=new Vm(1,1,1),Mg=new Vm,Tg=new Vm,Cg=new Vm,Eg=new bg,Pg=new Um,Lg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;Fd(this,e),this._x=t,this._y=n,this._z=i,this._order=r}return $d(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],u=i[5],l=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(wm(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-wm(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(wm(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-wm(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(wm(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-wm(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Eg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Eg,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Pg.setFromEuler(this),this.setFromQuaternion(Pg,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new Vm(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}]),e}();Lg.prototype.isEuler=!0,Lg.DefaultOrder="XYZ",Lg.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Ag=function(){function e(){Fd(this,e),this.mask=1}return $d(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}}]),e}(),Ig=0,Rg=new Vm,Ng=new Um,Dg=new bg,Og=new Vm,zg=new Vm,Fg=new Vm,Bg=new Um,$g=new Vm(1,0,0),jg=new Vm(0,1,0),Ug=new Vm(0,0,1),Vg={type:"added"},Hg={type:"removed"},Wg=function(e){Dd(n,e);var t=Od(n);function n(){var e;Fd(this,n),e=t.call(this),Object.defineProperty(Ad(e),"id",{value:Ig++}),e.uuid=xm(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var i=new Vm,r=new Lg,a=new Um,o=new Vm(1,1,1);return r._onChange((function(){a.setFromEuler(r,!1)})),a._onChange((function(){r.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(Ad(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new bg},normalMatrix:{value:new Lm}}),e.matrix=new bg,e.matrixWorld=new bg,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new Ag,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return $d(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Ng.setFromAxisAngle(e,t),this.quaternion.multiply(Ng),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Ng.setFromAxisAngle(e,t),this.quaternion.premultiply(Ng),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis($g,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(jg,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Ug,e)}},{key:"translateOnAxis",value:function(e,t){return Rg.copy(e).applyQuaternion(this.quaternion),this.position.add(Rg.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis($g,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(jg,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Ug,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Dg.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Og.copy(e):Og.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),zg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dg.lookAt(zg,Og,this.up):Dg.lookAt(Og,zg,this.up),this.quaternion.setFromRotationMatrix(Dg),i&&(Dg.extractRotation(i.matrixWorld),Ng.setFromRotationMatrix(Dg),this.quaternion.premultiply(Ng.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Vg)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Hg)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Hg)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Dg.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Dg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Dg),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zg,e,Fg),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zg,Bg,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var l=o[s];r(e.shapes,l)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(r(e.materials,this.material[h]));i.material=c}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var f=0;f<this.children.length;f++)i.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];i.animations.push(r(e.animations,v))}}if(t){var m=k(e.geometries),g=k(e.materials),_=k(e.textures),y=k(e.images),b=k(e.shapes),x=k(e.skeletons),w=k(e.animations);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),_.length>0&&(n.textures=_),y.length>0&&(n.images=y),b.length>0&&(n.shapes=b),x.length>0&&(n.skeletons=x),w.length>0&&(n.animations=w)}return n.object=i,n;function k(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}]),n}(pm);Wg.DefaultUp=new Vm(0,1,0),Wg.DefaultMatrixAutoUpdate=!0,Wg.prototype.isObject3D=!0;var Gg=new Vm,qg=new Vm,Zg=new Vm,Xg=new Vm,Yg=new Vm,Kg=new Vm,Jg=new Vm,Qg=new Vm,e_=new Vm,t_=new Vm,n_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vm;Fd(this,e),this.a=t,this.b=n,this.c=i}return $d(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Gg.subVectors(this.c,this.b),qg.subVectors(this.a,this.b),.5*Gg.cross(qg).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,i,r,a){return e.getUV(t,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,i,r=this.a,a=this.b,o=this.c;Yg.subVectors(a,r),Kg.subVectors(o,r),Qg.subVectors(e,r);var s=Yg.dot(Qg),u=Kg.dot(Qg);if(s<=0&&u<=0)return t.copy(r);e_.subVectors(e,a);var l=Yg.dot(e_),c=Kg.dot(e_);if(l>=0&&c<=l)return t.copy(a);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(r).addScaledVector(Yg,n);t_.subVectors(e,o);var d=Yg.dot(t_),f=Kg.dot(t_);if(f>=0&&d<=f)return t.copy(o);var p=d*u-s*f;if(p<=0&&u>=0&&f<=0)return i=u/(u-f),t.copy(r).addScaledVector(Kg,i);var v=l*f-d*c;if(v<=0&&c-l>=0&&d-f>=0)return Jg.subVectors(o,a),i=(c-l)/(c-l+(d-f)),t.copy(a).addScaledVector(Jg,i);var m=1/(v+p+h);return n=p*m,i=h*m,t.copy(r).addScaledVector(Yg,n).addScaledVector(Kg,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){i.subVectors(n,t),Gg.subVectors(e,t),i.cross(Gg);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){Gg.subVectors(i,t),qg.subVectors(n,t),Zg.subVectors(e,t);var a=Gg.dot(Gg),o=Gg.dot(qg),s=Gg.dot(Zg),u=qg.dot(qg),l=qg.dot(Zg),c=a*u-o*o;if(0===c)return r.set(-2,-1,-1);var h=1/c,d=(u*s-o*l)*h,f=(a*l-o*s)*h;return r.set(1-d-f,f,d)}},{key:"containsPoint",value:function(e,t,n,i){return this.getBarycoord(e,t,n,i,Xg),Xg.x>=0&&Xg.y>=0&&Xg.x+Xg.y<=1}},{key:"getUV",value:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,Xg),s.set(0,0),s.addScaledVector(r,Xg.x),s.addScaledVector(a,Xg.y),s.addScaledVector(o,Xg.z),s}},{key:"isFrontFacing",value:function(e,t,n,i){return Gg.subVectors(n,t),qg.subVectors(e,t),Gg.cross(qg).dot(i)<0}}]),e}(),i_=0,r_=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),e=t.call(this),Object.defineProperty(Ad(e),"id",{value:i_++}),e.uuid=xm(),e.name="",e.type="Material",e.fog=!0,e.blending=1,e.side=0,e.vertexColors=!1,e.opacity=1,e.format=Xv,e.transparent=!1,e.blendSrc=204,e.blendDst=205,e.blendEquation=Iv,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=3,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=cm,e.stencilZFail=cm,e.stencilZPass=cm,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return $d(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==Xv&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(pm);r_.prototype.isMaterial=!0;var a_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},o_={h:0,s:0,l:0},s_={h:0,s:0,l:0};function u_(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function l_(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function c_(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var h_=function(){function e(t,n,i){return Fd(this,e),void 0===n&&void 0===i?this.set(t):this.setRGB(t,n,i)}return $d(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=km(e,1),t=wm(t,0,1),n=wm(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=u_(r,i,e+1/3),this.g=u_(r,i,e),this.b=u_(r,i,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(o,s,u)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=a_[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=l_(e.r),this.g=l_(e.g),this.b=l_(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=c_(e.r),this.g=c_(e.g),this.b=c_(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t,n,i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),s=Math.min(i,r,a),u=(s+o)/2;if(s===o)t=0,n=0;else{var l=o-s;switch(n=u<=.5?l/(o+s):l/(2-o-s),o){case i:t=(r-a)/l+(r<a?6:0);break;case r:t=(a-i)/l+2;break;case a:t=(i-r)/l+4}t/=6}return e.h=t,e.s=n,e.l=u,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(o_),o_.h+=e,o_.s+=t,o_.l+=n,this.setHSL(o_.h,o_.s,o_.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(o_),e.getHSL(s_);var n=Sm(o_.h,s_.h,t),i=Sm(o_.s,s_.s,t),r=Sm(o_.l,s_.l,t);return this.setHSL(n,i,r),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();h_.NAMES=a_,h_.prototype.isColor=!0,h_.prototype.r=1,h_.prototype.g=1,h_.prototype.b=1;var d_=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="MeshBasicMaterial",i.color=new h_(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(r_);d_.prototype.isMeshBasicMaterial=!0;var f_=new Vm,p_=new Em,v_=function(){function e(t,n,i){if(Fd(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===i,this.usage=hm,this.updateRange={offset:0,count:-1},this.version=0}return $d(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new h_),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Em),t[n++]=a.x,t[n++]=a.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new Vm),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new Fm),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)p_.fromBufferAttribute(this,t),p_.applyMatrix3(e),this.setXY(t,p_.x,p_.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)f_.fromBufferAttribute(this,i),f_.applyMatrix3(e),this.setXYZ(i,f_.x,f_.y,f_.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)f_.x=this.getX(t),f_.y=this.getY(t),f_.z=this.getZ(t),f_.applyMatrix4(e),this.setXYZ(t,f_.x,f_.y,f_.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)f_.x=this.getX(t),f_.y=this.getY(t),f_.z=this.getZ(t),f_.applyNormalMatrix(e),this.setXYZ(t,f_.x,f_.y,f_.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)f_.x=this.getX(t),f_.y=this.getY(t),f_.z=this.getZ(t),f_.transformDirection(e),this.setXYZ(t,f_.x,f_.y,f_.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==hm&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}();v_.prototype.isBufferAttribute=!0;var m_=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){return Fd(this,n),t.call(this,new Uint16Array(e),i,r)}return $d(n)}(v_),g_=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){return Fd(this,n),t.call(this,new Uint32Array(e),i,r)}return $d(n)}(v_),__=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){return Fd(this,n),t.call(this,new Uint16Array(e),i,r)}return $d(n)}(v_);__.prototype.isFloat16BufferAttribute=!0;var y_=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){return Fd(this,n),t.call(this,new Float32Array(e),i,r)}return $d(n)}(v_),b_=0,x_=new bg,w_=new Wg,k_=new Vm,S_=new Gm,M_=new Gm,T_=new Vm,C_=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),e=t.call(this),Object.defineProperty(Ad(e),"id",{value:b_++}),e.uuid=xm(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return $d(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(Am(e)>65535?g_:m_)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new Lm).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return x_.makeRotationFromQuaternion(e),this.applyMatrix4(x_),this}},{key:"rotateX",value:function(e){return x_.makeRotationX(e),this.applyMatrix4(x_),this}},{key:"rotateY",value:function(e){return x_.makeRotationY(e),this.applyMatrix4(x_),this}},{key:"rotateZ",value:function(e){return x_.makeRotationZ(e),this.applyMatrix4(x_),this}},{key:"translate",value:function(e,t,n){return x_.makeTranslation(e,t,n),this.applyMatrix4(x_),this}},{key:"scale",value:function(e,t,n){return x_.makeScale(e,t,n),this.applyMatrix4(x_),this}},{key:"lookAt",value:function(e){return w_.lookAt(e),w_.updateMatrix(),this.applyMatrix4(w_.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(k_).negate(),this.translate(k_.x,k_.y,k_.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new y_(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Gm);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vm(-1/0,-1/0,-1/0),new Vm(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];S_.setFromBufferAttribute(r),this.morphTargetsRelative?(T_.addVectors(this.boundingBox.min,S_.min),this.boundingBox.expandByPoint(T_),T_.addVectors(this.boundingBox.max,S_.max),this.boundingBox.expandByPoint(T_)):(this.boundingBox.expandByPoint(S_.min),this.boundingBox.expandByPoint(S_.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new hg);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vm,1/0);if(e){var n=this.boundingSphere.center;if(S_.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];M_.setFromBufferAttribute(a),this.morphTargetsRelative?(T_.addVectors(S_.min,M_.min),S_.expandByPoint(T_),T_.addVectors(S_.max,M_.max),S_.expandByPoint(T_)):(S_.expandByPoint(M_.min),S_.expandByPoint(M_.max))}S_.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)T_.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(T_));if(t)for(var l=0,c=t.length;l<c;l++)for(var h=t[l],d=this.morphTargetsRelative,f=0,p=h.count;f<p;f++)T_.fromBufferAttribute(h,f),d&&(k_.fromBufferAttribute(e,f),T_.add(k_)),o=Math.max(o,n.distanceToSquared(T_));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new v_(new Float32Array(4*o),4));for(var s=t.tangent.array,u=[],l=[],c=0;c<o;c++)u[c]=new Vm,l[c]=new Vm;var h=new Vm,d=new Vm,f=new Vm,p=new Em,v=new Em,m=new Em,g=new Vm,_=new Vm,y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(var b=0,x=y.length;b<x;++b)for(var w=y[b],k=w.start,S=k,M=k+w.count;S<M;S+=3)O(n[S+0],n[S+1],n[S+2]);for(var T=new Vm,C=new Vm,E=new Vm,P=new Vm,L=0,A=y.length;L<A;++L)for(var I=y[L],R=I.start,N=R,D=R+I.count;N<D;N+=3)z(n[N+0]),z(n[N+1]),z(n[N+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function O(e,t,n){h.fromArray(i,3*e),d.fromArray(i,3*t),f.fromArray(i,3*n),p.fromArray(a,2*e),v.fromArray(a,2*t),m.fromArray(a,2*n),d.sub(h),f.sub(h),v.sub(p),m.sub(p);var r=1/(v.x*m.y-m.x*v.y);isFinite(r)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(f,-v.y).multiplyScalar(r),_.copy(f).multiplyScalar(v.x).addScaledVector(d,-m.x).multiplyScalar(r),u[e].add(g),u[t].add(g),u[n].add(g),l[e].add(_),l[t].add(_),l[n].add(_))}function z(e){E.fromArray(r,3*e),P.copy(E);var t=u[e];T.copy(t),T.sub(E.multiplyScalar(E.dot(t))).normalize(),C.crossVectors(P,t);var n=C.dot(l[e])<0?-1:1;s[4*e]=T.x,s[4*e+1]=T.y,s[4*e+2]=T.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new v_(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new Vm,o=new Vm,s=new Vm,u=new Vm,l=new Vm,c=new Vm,h=new Vm,d=new Vm;if(e)for(var f=0,p=e.count;f<p;f+=3){var v=e.getX(f+0),m=e.getX(f+1),g=e.getX(f+2);a.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),u.fromBufferAttribute(n,v),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.add(h),l.add(h),c.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var _=0,y=t.count;_<y;_+=3)a.fromBufferAttribute(t,_+0),o.fromBufferAttribute(t,_+1),s.fromBufferAttribute(t,_+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(_+0,h.x,h.y,h.z),n.setXYZ(_+1,h.x,h.y,h.z),n.setXYZ(_+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,u=Math.min(o.length,r.length-s),l=0,c=s;l<u;l++,c++)r[c]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)T_.fromBufferAttribute(e,t),T_.normalize(),e.setXYZ(t,T_.x,T_.y,T_.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*i;for(var c=0;c<i;c++)a[s++]=n[o++]}return new v_(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,i=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],i);t.setAttribute(a,o)}var s=this.morphAttributes;for(var u in s){for(var l=[],c=s[u],h=0,d=c.length;h<d;h++){var f=e(c[h],i);l.push(f)}t.morphAttributes[u]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},u=!1;for(var l in this.morphAttributes){for(var c=this.morphAttributes[l],h=[],d=0,f=c.length;d<f;d++){var p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],l=o[s],c=0,h=l.length;c<h;c++)u.push(l[c].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,f=0,p=d.length;f<p;f++){var v=d[f];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(pm);C_.prototype.isBufferGeometry=!0;var E_=new bg,P_=new yg,L_=new hg,A_=new Vm,I_=new Vm,R_=new Vm,N_=new Vm,D_=new Vm,O_=new Vm,z_=new Vm,F_=new Vm,B_=new Vm,$_=new Em,j_=new Em,U_=new Em,V_=new Vm,H_=new Vm,W_=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C_,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d_;return Fd(this,n),(e=t.call(this)).type="Mesh",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"raycast",value:function(e,t){var n,i=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),L_.copy(i.boundingSphere),L_.applyMatrix4(a),!1!==e.ray.intersectsSphere(L_)&&(E_.copy(a).invert(),P_.copy(e.ray).applyMatrix4(E_),null===i.boundingBox||!1!==P_.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var o=i.index,s=i.attributes.position,u=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,d=i.groups,f=i.drawRange;if(null!==o)if(Array.isArray(r))for(var p=0,v=d.length;p<v;p++)for(var m=d[p],g=r[m.materialIndex],_=Math.max(m.start,f.start),y=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));_<y;_+=3){var b=o.getX(_),x=o.getX(_+1),w=o.getX(_+2);(n=G_(this,g,e,P_,s,u,l,c,h,b,x,w))&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,t.push(n))}else for(var k=Math.max(0,f.start),S=Math.min(o.count,f.start+f.count);k<S;k+=3){var M=o.getX(k),T=o.getX(k+1),C=o.getX(k+2);(n=G_(this,r,e,P_,s,u,l,c,h,M,T,C))&&(n.faceIndex=Math.floor(k/3),t.push(n))}else if(void 0!==s)if(Array.isArray(r))for(var E=0,P=d.length;E<P;E++)for(var L=d[E],A=r[L.materialIndex],I=Math.max(L.start,f.start),R=Math.min(s.count,Math.min(L.start+L.count,f.start+f.count));I<R;I+=3){(n=G_(this,A,e,P_,s,u,l,c,h,I,I+1,I+2))&&(n.faceIndex=Math.floor(I/3),n.face.materialIndex=L.materialIndex,t.push(n))}else for(var N=Math.max(0,f.start),D=Math.min(s.count,f.start+f.count);N<D;N+=3){(n=G_(this,r,e,P_,s,u,l,c,h,N,N+1,N+2))&&(n.faceIndex=Math.floor(N/3),t.push(n))}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}]),n}(Wg);function G_(e,t,n,i,r,a,o,s,u,l,c,h){A_.fromBufferAttribute(r,l),I_.fromBufferAttribute(r,c),R_.fromBufferAttribute(r,h);var d=e.morphTargetInfluences;if(a&&d){z_.set(0,0,0),F_.set(0,0,0),B_.set(0,0,0);for(var f=0,p=a.length;f<p;f++){var v=d[f],m=a[f];0!==v&&(N_.fromBufferAttribute(m,l),D_.fromBufferAttribute(m,c),O_.fromBufferAttribute(m,h),o?(z_.addScaledVector(N_,v),F_.addScaledVector(D_,v),B_.addScaledVector(O_,v)):(z_.addScaledVector(N_.sub(A_),v),F_.addScaledVector(D_.sub(I_),v),B_.addScaledVector(O_.sub(R_),v)))}A_.add(z_),I_.add(F_),R_.add(B_)}e.isSkinnedMesh&&(e.boneTransform(l,A_),e.boneTransform(c,I_),e.boneTransform(h,R_));var g=function(e,t,n,i,r,a,o,s){if(null===(1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,2!==t.side,s)))return null;H_.copy(s),H_.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(H_);return u<n.near||u>n.far?null:{distance:u,point:H_.clone(),object:e}}(e,t,n,i,A_,I_,R_,V_);if(g){s&&($_.fromBufferAttribute(s,l),j_.fromBufferAttribute(s,c),U_.fromBufferAttribute(s,h),g.uv=n_.getUV(V_,A_,I_,R_,$_,j_,U_,new Em)),u&&($_.fromBufferAttribute(u,l),j_.fromBufferAttribute(u,c),U_.fromBufferAttribute(u,h),g.uv2=n_.getUV(V_,A_,I_,R_,$_,j_,U_,new Em));var _={a:l,b:c,c:h,normal:new Vm,materialIndex:0};n_.getNormal(A_,I_,R_,_.normal),g.face=_}return g}W_.prototype.isMesh=!0;var q_=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Fd(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:u};var l=Ad(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var c=[],h=[],d=[],f=[],p=0,v=0;function m(e,t,n,i,r,a,o,s,u,m,g){for(var _=a/u,y=o/m,b=a/2,x=o/2,w=s/2,k=u+1,S=m+1,M=0,T=0,C=new Vm,E=0;E<S;E++)for(var P=E*y-x,L=0;L<k;L++){var A=L*_-b;C[e]=A*i,C[t]=P*r,C[n]=w,h.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=s>0?1:-1,d.push(C.x,C.y,C.z),f.push(L/u),f.push(1-E/m),M+=1}for(var I=0;I<m;I++)for(var R=0;R<u;R++){var N=p+R+k*I,D=p+R+k*(I+1),O=p+(R+1)+k*(I+1),z=p+(R+1)+k*I;c.push(N,D,z),c.push(D,O,z),T+=6}l.addGroup(v,T,g),v+=T,p+=M}return m("z","y","x",-1,-1,a,r,i,u,s,0),m("z","y","x",1,-1,a,r,-i,u,s,1),m("x","z","y",1,1,i,a,r,o,u,2),m("x","z","y",1,-1,i,a,-r,o,u,3),m("x","y","z",1,-1,i,r,a,o,s,4),m("x","y","z",-1,-1,i,r,-a,o,s,5),e.setIndex(c),e.setAttribute("position",new y_(h,3)),e.setAttribute("normal",new y_(d,3)),e.setAttribute("uv",new y_(f,2)),e}return $d(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(C_);function Z_(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function X_(e){for(var t={},n=0;n<e.length;n++){var i=Z_(e[n]);for(var r in i)t[r]=i[r]}return t}var Y_={clone:Z_,merge:X_},K_=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="ShaderMaterial",i.defines={},i.uniforms={},i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),i.setValues(e)),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Z_(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(r_);K_.prototype.isShaderMaterial=!0;var J_=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this)).type="Camera",e.matrixWorldInverse=new bg,e.projectionMatrix=new bg,e.projectionMatrixInverse=new bg,e}return $d(n,[{key:"copy",value:function(e,t){return Nd(kd(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){Nd(kd(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Nd(kd(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Wg);J_.prototype.isCamera=!0;var Q_=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return Fd(this,n),(e=t.call(this)).type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=r,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return $d(n,[{key:"copy",value:function(e,t){return Nd(kd(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*gm*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*mm*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*gm*Math.atan(Math.tan(.5*mm*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*mm*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(r+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(J_);Q_.prototype.isPerspectiveCamera=!0;var ey=90,ty=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;if(Fd(this,n),(a=t.call(this)).type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),Id(a);a.renderTarget=r;var o=new Q_(ey,1,e,i);o.layers=a.layers,o.up.set(0,-1,0),o.lookAt(new Vm(1,0,0)),a.add(o);var s=new Q_(ey,1,e,i);s.layers=a.layers,s.up.set(0,-1,0),s.lookAt(new Vm(-1,0,0)),a.add(s);var u=new Q_(ey,1,e,i);u.layers=a.layers,u.up.set(0,0,1),u.lookAt(new Vm(0,1,0)),a.add(u);var l=new Q_(ey,1,e,i);l.layers=a.layers,l.up.set(0,0,-1),l.lookAt(new Vm(0,-1,0)),a.add(l);var c=new Q_(ey,1,e,i);c.layers=a.layers,c.up.set(0,-1,0),c.lookAt(new Vm(0,0,1)),a.add(c);var h=new Q_(ey,1,e,i);return h.layers=a.layers,h.up.set(0,-1,0),h.lookAt(new Vm(0,0,-1)),a.add(h),a}return $d(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=s(this.children,6),r=i[0],a=i[1],o=i[2],u=i[3],l=i[4],c=i[5],h=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;var f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,u),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=h}}]),n}(Wg),ny=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o,s,u,l,c,h){var d;return Fd(this,n),e=void 0!==e?e:[],i=void 0!==i?i:Rv,(d=t.call(this,e,i,r,a,o,s,u,l,c,h)).flipY=!1,d}return $d(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Om);ny.prototype.isCubeTexture=!0;var iy=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),Number.isInteger(i)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),i=r),a=t.call(this,e,e,i),i=i||{},a.texture=new ny(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),a.texture.isRenderTargetTexture=!0,a.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,a.texture.minFilter=void 0!==i.minFilter?i.minFilter:$v,a.texture._needsFlipEnvMap=!1,a}return $d(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.format=Xv,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new q_(5,5,5),o=new K_({name:"CubemapFromEquirect",uniforms:Z_(n),vertexShader:i,fragmentShader:r,side:1,blending:0});o.uniforms.tEquirect.value=t;var s=new W_(a,o),u=t.minFilter;return t.minFilter===jv&&(t.minFilter=$v),new ty(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),n}(Bm);iy.prototype.isWebGLCubeRenderTarget=!0;var ry=new Vm,ay=new Vm,oy=new Lm,sy=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Fd(this,e),this.normal=t,this.constant=n}return $d(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=ry.subVectors(n,t).cross(ay.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(ry),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||oy.getNormalMatrix(e),i=this.coplanarPoint(ry).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();sy.prototype.isPlane=!0;var uy=new hg,ly=new Vm,cy=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sy,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sy,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new sy,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new sy,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new sy,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new sy;Fd(this,e),this.planes=[t,n,i,r,a,o]}return $d(e,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],v=n[12],m=n[13],g=n[14],_=n[15];return t[0].setComponents(o-i,c-s,p-h,_-v).normalize(),t[1].setComponents(o+i,c+s,p+h,_+v).normalize(),t[2].setComponents(o+r,c+u,p+d,_+m).normalize(),t[3].setComponents(o-r,c-u,p-d,_-m).normalize(),t[4].setComponents(o-a,c-l,p-f,_-g).normalize(),t[5].setComponents(o+a,c+l,p+f,_+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),uy.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(uy)}},{key:"intersectsSprite",value:function(e){return uy.center.set(0,0,0),uy.radius=.7071067811865476,uy.applyMatrix4(e.matrixWorld),this.intersectsSphere(uy)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(ly.x=i.normal.x>0?e.max.x:e.min.x,ly.y=i.normal.y>0?e.max.y:e.min.y,ly.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ly)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function hy(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function dy(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var a=i.get(t);(!a||a.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=i.get(t);void 0===o?i.set(t,function(t,i){var r=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,a),t.onUploadCallback();var s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(!function(t,i,r){var a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,r),o.version=t.version)}}}}var fy=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Fd(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,u=r/2,l=Math.floor(a),c=Math.floor(o),h=l+1,d=c+1,f=i/l,p=r/c,v=[],m=[],g=[],_=[],y=0;y<d;y++)for(var b=y*p-u,x=0;x<h;x++){var w=x*f-s;m.push(w,-b,0),g.push(0,0,1),_.push(x/l),_.push(1-y/c)}for(var k=0;k<c;k++)for(var S=0;S<l;S++){var M=S+h*k,T=S+h*(k+1),C=S+1+h*(k+1),E=S+1+h*k;v.push(M,T,E),v.push(T,C,E)}return e.setIndex(v),e.setAttribute("position",new y_(m,3)),e.setAttribute("normal",new y_(g,3)),e.setAttribute("uv",new y_(_,2)),e}return $d(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(C_),py={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},vy={common:{diffuse:{value:new h_(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Lm},uv2Transform:{value:new Lm},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Em(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new h_(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new h_(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Lm}},sprite:{diffuse:{value:new h_(16777215)},opacity:{value:1},center:{value:new Em(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Lm}}},my={basic:{uniforms:X_([vy.common,vy.specularmap,vy.envmap,vy.aomap,vy.lightmap,vy.fog]),vertexShader:py.meshbasic_vert,fragmentShader:py.meshbasic_frag},lambert:{uniforms:X_([vy.common,vy.specularmap,vy.envmap,vy.aomap,vy.lightmap,vy.emissivemap,vy.fog,vy.lights,{emissive:{value:new h_(0)}}]),vertexShader:py.meshlambert_vert,fragmentShader:py.meshlambert_frag},phong:{uniforms:X_([vy.common,vy.specularmap,vy.envmap,vy.aomap,vy.lightmap,vy.emissivemap,vy.bumpmap,vy.normalmap,vy.displacementmap,vy.fog,vy.lights,{emissive:{value:new h_(0)},specular:{value:new h_(1118481)},shininess:{value:30}}]),vertexShader:py.meshphong_vert,fragmentShader:py.meshphong_frag},standard:{uniforms:X_([vy.common,vy.envmap,vy.aomap,vy.lightmap,vy.emissivemap,vy.bumpmap,vy.normalmap,vy.displacementmap,vy.roughnessmap,vy.metalnessmap,vy.fog,vy.lights,{emissive:{value:new h_(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:py.meshphysical_vert,fragmentShader:py.meshphysical_frag},toon:{uniforms:X_([vy.common,vy.aomap,vy.lightmap,vy.emissivemap,vy.bumpmap,vy.normalmap,vy.displacementmap,vy.gradientmap,vy.fog,vy.lights,{emissive:{value:new h_(0)}}]),vertexShader:py.meshtoon_vert,fragmentShader:py.meshtoon_frag},matcap:{uniforms:X_([vy.common,vy.bumpmap,vy.normalmap,vy.displacementmap,vy.fog,{matcap:{value:null}}]),vertexShader:py.meshmatcap_vert,fragmentShader:py.meshmatcap_frag},points:{uniforms:X_([vy.points,vy.fog]),vertexShader:py.points_vert,fragmentShader:py.points_frag},dashed:{uniforms:X_([vy.common,vy.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:py.linedashed_vert,fragmentShader:py.linedashed_frag},depth:{uniforms:X_([vy.common,vy.displacementmap]),vertexShader:py.depth_vert,fragmentShader:py.depth_frag},normal:{uniforms:X_([vy.common,vy.bumpmap,vy.normalmap,vy.displacementmap,{opacity:{value:1}}]),vertexShader:py.meshnormal_vert,fragmentShader:py.meshnormal_frag},sprite:{uniforms:X_([vy.sprite,vy.fog]),vertexShader:py.sprite_vert,fragmentShader:py.sprite_frag},background:{uniforms:{uvTransform:{value:new Lm},t2D:{value:null}},vertexShader:py.background_vert,fragmentShader:py.background_frag},cube:{uniforms:X_([vy.envmap,{opacity:{value:1}}]),vertexShader:py.cube_vert,fragmentShader:py.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:py.equirect_vert,fragmentShader:py.equirect_frag},distanceRGBA:{uniforms:X_([vy.common,vy.displacementmap,{referencePosition:{value:new Vm},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:py.distanceRGBA_vert,fragmentShader:py.distanceRGBA_frag},shadow:{uniforms:X_([vy.lights,vy.fog,{color:{value:new h_(0)},opacity:{value:1}}]),vertexShader:py.shadow_vert,fragmentShader:py.shadow_frag}};function gy(e,t,n,i,r){var a,o,s=new h_(0),u=0,l=null,c=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),d(s,u=t)},getClearAlpha:function(){return u},setClearAlpha:function(e){d(s,u=e)},render:function(n,r){var f=!1,p=!0===r.isScene?r.background:null;p&&p.isTexture&&(p=t.get(p));var v=e.xr,m=v.getSession&&v.getSession();m&&"additive"===m.environmentBlendMode&&(p=null),null===p?d(s,u):p&&p.isColor&&(d(p,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.mapping===Dv)?(void 0===o&&((o=new W_(new q_(1,1,1),new K_({name:"BackgroundCubeMaterial",uniforms:Z_(my.cube.uniforms),vertexShader:my.cube.vertexShader,fragmentShader:my.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),o.material.uniforms.envMap.value=p,o.material.uniforms.flipEnvMap.value=p.isCubeTexture&&!1===p.isRenderTargetTexture?-1:1,l===p&&c===p.version&&h===e.toneMapping||(o.material.needsUpdate=!0,l=p,c=p.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):p&&p.isTexture&&(void 0===a&&((a=new W_(new fy(2,2),new K_({name:"BackgroundMaterial",uniforms:Z_(my.background.uniforms),vertexShader:my.background.vertexShader,fragmentShader:my.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),a.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&c===p.version&&h===e.toneMapping||(a.material.needsUpdate=!0,l=p,c=p.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function _y(e,t,n,i){var r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},u=d(null),l=u;function c(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],i=[],a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){for(var e=l.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function p(e){v(e,0)}function v(n,r){var a=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function m(){for(var t=l.newAttributes,n=l.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function g(t,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,o,s):e.vertexAttribIPointer(t,n,r,o,s)}function _(){y(),l!==u&&c((l=u).object)}function y(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(r,u,h,_,y){var b=!1;if(o){var x=function(t,n,r){var o=!0===r.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var l=u[n.id];void 0===l&&(l={},u[n.id]=l);var c=l[o];void 0===c&&(c=d(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),l[o]=c);return c}(_,h,u);l!==x&&c((l=x).object),b=function(e,t){var n=l.attributes,i=e.attributes,r=0;for(var a in i){var o=n[a],s=i[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;r++}return l.attributesNum!==r||l.index!==t}(_,y),b&&function(e,t){var n={},i=e.attributes,r=0;for(var a in i){var o=i[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,r++}l.attributes=n,l.attributesNum=r,l.index=t}(_,y)}else{var w=!0===u.wireframe;l.geometry===_.id&&l.program===h.id&&l.wireframe===w||(l.geometry=_.id,l.program=h.id,l.wireframe=w,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==y&&n.update(y,34963),b&&(!function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();var u=s.attributes,l=o.getAttributes(),c=a.defaultAttributeValues;for(var h in l){var d=l[h];if(d.location>=0){var _=u[h];if(void 0===_&&("instanceMatrix"===h&&r.instanceMatrix&&(_=r.instanceMatrix),"instanceColor"===h&&r.instanceColor&&(_=r.instanceColor)),void 0!==_){var y=_.normalized,b=_.itemSize,x=n.get(_);if(void 0===x)continue;var w=x.buffer,k=x.type,S=x.bytesPerElement;if(_.isInterleavedBufferAttribute){var M=_.data,T=M.stride,C=_.offset;if(M&&M.isInstancedInterleavedBuffer){for(var E=0;E<d.locationSize;E++)v(d.location+E,M.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=M.meshPerAttribute*M.count)}else for(var P=0;P<d.locationSize;P++)p(d.location+P);e.bindBuffer(34962,w);for(var L=0;L<d.locationSize;L++)g(d.location+L,b/d.locationSize,k,y,T*S,(C+b/d.locationSize*L)*S)}else{if(_.isInstancedBufferAttribute){for(var A=0;A<d.locationSize;A++)v(d.location+A,_.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=_.meshPerAttribute*_.count)}else for(var I=0;I<d.locationSize;I++)p(d.location+I);e.bindBuffer(34962,w);for(var R=0;R<d.locationSize;R++)g(d.location+R,b/d.locationSize,k,y,b*S,b/d.locationSize*R*S)}}else if(void 0!==c){var N=c[h];if(void 0!==N)switch(N.length){case 2:e.vertexAttrib2fv(d.location,N);break;case 3:e.vertexAttrib3fv(d.location,N);break;case 4:e.vertexAttrib4fv(d.location,N);break;default:e.vertexAttrib1fv(d.location,N)}}}}m()}(r,u,h,_),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:_,resetDefaultState:y,dispose:function(){for(var e in _(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)h(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:m}}function yy(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var u,l;if(a)u=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](r,i,o,s),n.update(o,r,s)}}}function by(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=a||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),f=e.getParameter(34076),p=e.getParameter(34921),v=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),_=h>0,y=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:_,floatFragmentTextures:y,floatVertexTextures:_&&y,maxSamples:a?e.getParameter(36183):0}}function xy(e){var t=this,n=null,i=0,r=!1,a=!1,o=new sy,s=new Lm,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(e,n,i,r){var a=null!==e?e.length:0,l=null;if(0!==a){if(l=u.value,!0!==r||null===l){var c=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var d=0,f=i;d!==a;++d,f+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(l,f),l[f+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==i||r;return r=t,n=c(e,a,0),i=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,l()},this.setState=function(t,o,s){var h=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!r||null===h||0===h.length||a&&!f)a?c(null):l();else{var v=a?0:i,m=4*v,g=p.clippingState||null;u.value=g,g=c(h,o,m,s);for(var _=0;_!==m;++_)g[_]=n[_];p.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}}}function wy(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=Rv:304===t&&(e.mapping=Nv),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping;if(303===a||304===a){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=e.getRenderTarget(),u=new iy(o.height/2);return u.fromEquirectangularTexture(e,r),t.set(r,u),e.setRenderTarget(s),r.addEventListener("dispose",i),n(u.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}my.physical={uniforms:X_([my.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Em(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new h_(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Em},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new h_(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new h_(1,1,1)},specularColorMap:{value:null}}]),vertexShader:py.meshphysical_vert,fragmentShader:py.meshphysical_frag};var ky=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return Fd(this,n),(e=t.call(this)).type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=r,e.top=a,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return $d(n,[{key:"copy",value:function(e,t){return Nd(kd(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=u*this.view.offsetX)+u*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(J_);ky.prototype.isOrthographicCamera=!0;var Sy=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e)).type="RawShaderMaterial",i}return $d(n)}(K_);Sy.prototype.isRawShaderMaterial=!0;var My=Math.pow(2,8),Ty=[.125,.215,.35,.446,.526,.582],Cy=5+Ty.length,Ey=20,Py=(Yh(yd={},om,0),Yh(yd,sm,1),Yh(yd,lm,2),Yh(yd,3004,3),Yh(yd,3005,4),Yh(yd,3006,5),Yh(yd,um,6),yd),Ly=new ky,Ay=Uy(),Iy=Ay._lodPlanes,Ry=Ay._sizeLods,Ny=Ay._sigmas,Dy=new h_,Oy=null,zy=(1+Math.sqrt(5))/2,Fy=1/zy,By=[new Vm(1,1,1),new Vm(-1,1,1),new Vm(1,1,-1),new Vm(-1,1,-1),new Vm(0,zy,Fy),new Vm(0,zy,-Fy),new Vm(Fy,0,zy),new Vm(-Fy,0,zy),new Vm(zy,Fy,0),new Vm(-zy,Fy,0)],$y=function(){function e(t){Fd(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(e){var t=new Float32Array(e),n=new Vm(0,1,0);return new Sy({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Py[3e3]},outputEncoding:{value:Py[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t".concat("\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t","\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})}(Ey),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}return $d(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Oy=this._renderer.getRenderTarget();var r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function(){null===this._cubemapShader&&(this._cubemapShader=Gy(),this._compileMaterial(this._cubemapShader))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectShader&&(this._equirectShader=Wy(),this._compileMaterial(this._equirectShader))}},{key:"dispose",value:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<Iy.length;e++)Iy[e].dispose()}},{key:"_cleanup",value:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Oy),e.scissorTest=!1,Hy(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e){Oy=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}},{key:"_allocateTargets",value:function(e){var t={magFilter:Bv,minFilter:Bv,generateMipmaps:!1,type:Uv,format:1023,encoding:jy(e)?e.encoding:lm,depthBuffer:!1},n=Vy(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Vy(t),n}},{key:"_compileMaterial",value:function(e){var t=new W_(Iy[0],e);this._renderer.compile(t,Ly)}},{key:"_sceneToCubeUV",value:function(e,t,n,i){var r=new Q_(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.outputEncoding,c=s.toneMapping;s.getClearColor(Dy),s.toneMapping=0,s.outputEncoding=om,s.autoClear=!1;var h=new d_({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new W_(new q_,h),f=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,f=!0):(h.color.copy(Dy),f=!0);for(var v=0;v<6;v++){var m=v%3;0==m?(r.up.set(0,a[v],0),r.lookAt(o[v],0,0)):1==m?(r.up.set(0,0,a[v]),r.lookAt(0,o[v],0)):(r.up.set(0,a[v],0),r.lookAt(0,0,o[v])),Hy(i,m*My,v>2?My:0,My,My),s.setRenderTarget(i),f&&s.render(d,r),s.render(e,r)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.outputEncoding=l,s.autoClear=u,e.background=p}},{key:"_setEncoding",value:function(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===Xv&&t.type===Uv&&t.encoding===sm?e.value=Py[3e3]:e.value=Py[t.encoding]}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,i=e.mapping===Rv||e.mapping===Nv;i?null==this._cubemapShader&&(this._cubemapShader=Gy()):null==this._equirectShader&&(this._equirectShader=Wy());var r=i?this._cubemapShader:this._equirectShader,a=new W_(Iy[0],r),o=r.uniforms;o.envMap.value=e,i||o.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(o.inputEncoding,e),this._setEncoding(o.outputEncoding,t.texture),Hy(t,0,0,3*My,2*My),n.setRenderTarget(t),n.render(a,Ly)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=1;i<Cy;i++){var r=Math.sqrt(Ny[i]*Ny[i]-Ny[i-1]*Ny[i-1]),a=By[(i-1)%By.length];this._blur(e,i-1,i,r,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}},{key:"_halfBlur",value:function(e,t,n,i,r,a,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new W_(Iy[i],u),c=u.uniforms,h=Ry[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,f=r/d,p=isFinite(r)?1+Math.floor(3*f):Ey;p>Ey&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(Ey));for(var v=[],m=0,g=0;g<Ey;++g){var _=g/f,y=Math.exp(-_*_/2);v.push(y),0==g?m+=y:g<p&&(m+=2*y)}for(var b=0;b<v.length;b++)v[b]=v[b]/m;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=v,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=d,c.mipInt.value=8-n,this._setEncoding(c.inputEncoding,e.texture),this._setEncoding(c.outputEncoding,e.texture);var x=Ry[i];Hy(t,3*Math.max(0,My-2*x),(0===i?0:2*My)+2*x*(i>4?i-8+4:0),3*x,2*x),s.setRenderTarget(t),s.render(l,Ly)}}]),e}();function jy(e){return void 0!==e&&e.type===Uv&&(e.encoding===om||e.encoding===sm||e.encoding===um)}function Uy(){for(var e=[],t=[],n=[],i=8,r=0;r<Cy;r++){var a=Math.pow(2,i);t.push(a);var o=1/a;r>4?o=Ty[r-8+4-1]:0==r&&(o=0),n.push(o);for(var s=1/(a-1),u=-s/2,l=1+s/2,c=[u,u,l,u,l,l,u,u,l,l,u,l],h=new Float32Array(108),d=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var v=p%3*2/3-1,m=p>2?0:-1,g=[v,m,0,v+2/3,m,0,v+2/3,m+1,0,v,m,0,v+2/3,m+1,0,v,m+1,0];h.set(g,18*p),d.set(c,12*p);var _=[p,p,p,p,p,p];f.set(_,6*p)}var y=new C_;y.setAttribute("position",new v_(h,3)),y.setAttribute("uv",new v_(d,2)),y.setAttribute("faceIndex",new v_(f,1)),e.push(y),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Vy(e){var t=new Bm(3*My,3*My,e);return t.texture.mapping=Dv,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Hy(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Wy(){var e=new Em(1,1);return new Sy({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Py[3e3]},outputEncoding:{value:Py[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t".concat("\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t","\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})}function Gy(){return new Sy({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Py[3e3]},outputEncoding:{value:Py[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t".concat("\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t","\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})}function qy(e){var t=new WeakMap,n=null;function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping,o=303===a||304===a,s=a===Rv||a===Nv;if(o||s){if(t.has(r))return t.get(r).texture;var u=r.image;if(o&&u&&u.height>0||s&&u&&function(e){for(var t=0,n=6,i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(u)){var l=e.getRenderTarget();null===n&&(n=new $y(e));var c=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,c),e.setRenderTarget(l),r.addEventListener("dispose",i),c.texture}return null}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Zy(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Xy(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete r[s.id];var l=a.get(s);l&&(t.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],d=s[u+2];n.push(c,h,h,d,d,c)}}else{var f=r.array;o=r.version;for(var p=0,v=f.length/3-1;p<v;p+=3){var m=p+0,g=p+1,_=p+2;n.push(m,g,g,_,_,m)}}var y=new(Am(n)>65535?g_:m_)(n,1);y.version=o;var b=a.get(e);b&&t.remove(b),a.set(e,y)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var i in n)t.update(n[i],34962);var r=e.morphAttributes;for(var a in r)for(var o=r[a],s=0,u=o.length;s<u;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Yy(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,u,l){if(0!==l){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,u,a,i*o,l),n.update(u,r,l)}}}function Ky(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}var Jy=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Fd(this,n),(e=t.call(this,null)).image={data:i,width:r,height:a,depth:o},e.magFilter=Bv,e.minFilter=Bv,e.wrapR=zv,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return $d(n)}(Om);function Qy(e,t){return e[0]-t[0]}function eb(e,t){return Math.abs(t[1])-Math.abs(e[1])}function tb(e,t){var n=1,i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),e.divideScalar(n)}function nb(e,t,n){for(var i={},r=new Float32Array(8),a=new WeakMap,o=new Vm,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,l,c,h){var d=u.morphTargetInfluences;if(!0===t.isWebGL2){var f=l.morphAttributes.position.length,p=a.get(l);if(void 0===p||p.count!==f){void 0!==p&&p.texture.dispose();var v=void 0!==l.morphAttributes.normal,m=l.morphAttributes.position,g=l.morphAttributes.normal||[],_=!0===v?2:1,y=l.attributes.position.count*_,b=1;y>t.maxTextureSize&&(b=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);var x=new Float32Array(y*b*4*f),w=new Jy(x,y,b,f);w.format=Xv,w.type=Wv;for(var k=4*_,S=0;S<f;S++)for(var M=m[S],T=g[S],C=y*b*4*S,E=0;E<M.count;E++){o.fromBufferAttribute(M,E),!0===M.normalized&&tb(o,M);var P=E*k;x[C+P+0]=o.x,x[C+P+1]=o.y,x[C+P+2]=o.z,x[C+P+3]=0,!0===v&&(o.fromBufferAttribute(T,E),!0===T.normalized&&tb(o,T),x[C+P+4]=o.x,x[C+P+5]=o.y,x[C+P+6]=o.z,x[C+P+7]=0)}p={count:f,texture:w,size:new Em(y,b)},a.set(l,p)}for(var L=0,A=0;A<d.length;A++)L+=d[A];var I=l.morphTargetsRelative?1:1-L;h.getUniforms().setValue(e,"morphTargetBaseInfluence",I),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{var R=void 0===d?0:d.length,N=i[l.id];if(void 0===N||N.length!==R){N=[];for(var D=0;D<R;D++)N[D]=[D,0];i[l.id]=N}for(var O=0;O<R;O++){var z=N[O];z[0]=O,z[1]=d[O]}N.sort(eb);for(var F=0;F<8;F++)F<R&&N[F][1]?(s[F][0]=N[F][0],s[F][1]=N[F][1]):(s[F][0]=Number.MAX_SAFE_INTEGER,s[F][1]=0);s.sort(Qy);for(var B=l.morphAttributes.position,$=l.morphAttributes.normal,j=0,U=0;U<8;U++){var V=s[U],H=V[0],W=V[1];H!==Number.MAX_SAFE_INTEGER&&W?(B&&l.getAttribute("morphTarget"+U)!==B[H]&&l.setAttribute("morphTarget"+U,B[H]),$&&l.getAttribute("morphNormal"+U)!==$[H]&&l.setAttribute("morphNormal"+U,$[H]),r[U]=W,j+=W):(B&&!0===l.hasAttribute("morphTarget"+U)&&l.deleteAttribute("morphTarget"+U),$&&!0===l.hasAttribute("morphNormal"+U)&&l.deleteAttribute("morphNormal"+U),r[U]=0)}var G=l.morphTargetsRelative?1:1-j;h.getUniforms().setValue(e,"morphTargetBaseInfluence",G),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function ib(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=i.render.frame,s=e.geometry,u=t.get(e,s);return r.get(u)!==o&&(t.update(u),r.set(u,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),u},dispose:function(){r=new WeakMap}}}Jy.prototype.isDataTexture2DArray=!0;var rb=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Fd(this,n),(e=t.call(this,null)).image={data:i,width:r,height:a,depth:o},e.magFilter=Bv,e.minFilter=Bv,e.wrapR=zv,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return $d(n)}(Om);rb.prototype.isDataTexture3D=!0;var ab=new Om,ob=new Jy,sb=new rb,ub=new ny,lb=[],cb=[],hb=new Float32Array(16),db=new Float32Array(9),fb=new Float32Array(4);function pb(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=lb[r];if(void 0===a&&(a=new Float32Array(r),lb[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function vb(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function mb(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function gb(e,t){var n=cb[t];void 0===n&&(n=new Int32Array(t),cb[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function _b(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function yb(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(vb(n,t))return;e.uniform2fv(this.addr,t),mb(n,t)}}function bb(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(vb(n,t))return;e.uniform3fv(this.addr,t),mb(n,t)}}function xb(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(vb(n,t))return;e.uniform4fv(this.addr,t),mb(n,t)}}function wb(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(vb(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),mb(n,t)}else{if(vb(n,i))return;fb.set(i),e.uniformMatrix2fv(this.addr,!1,fb),mb(n,i)}}function kb(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(vb(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),mb(n,t)}else{if(vb(n,i))return;db.set(i),e.uniformMatrix3fv(this.addr,!1,db),mb(n,i)}}function Sb(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(vb(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),mb(n,t)}else{if(vb(n,i))return;hb.set(i),e.uniformMatrix4fv(this.addr,!1,hb),mb(n,i)}}function Mb(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Tb(e,t){var n=this.cache;vb(n,t)||(e.uniform2iv(this.addr,t),mb(n,t))}function Cb(e,t){var n=this.cache;vb(n,t)||(e.uniform3iv(this.addr,t),mb(n,t))}function Eb(e,t){var n=this.cache;vb(n,t)||(e.uniform4iv(this.addr,t),mb(n,t))}function Pb(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Lb(e,t){var n=this.cache;vb(n,t)||(e.uniform2uiv(this.addr,t),mb(n,t))}function Ab(e,t){var n=this.cache;vb(n,t)||(e.uniform3uiv(this.addr,t),mb(n,t))}function Ib(e,t){var n=this.cache;vb(n,t)||(e.uniform4uiv(this.addr,t),mb(n,t))}function Rb(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||ab,r)}function Nb(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||sb,r)}function Db(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||ub,r)}function Ob(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||ob,r)}function zb(e,t){e.uniform1fv(this.addr,t)}function Fb(e,t){var n=pb(t,this.size,2);e.uniform2fv(this.addr,n)}function Bb(e,t){var n=pb(t,this.size,3);e.uniform3fv(this.addr,n)}function $b(e,t){var n=pb(t,this.size,4);e.uniform4fv(this.addr,n)}function jb(e,t){var n=pb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ub(e,t){var n=pb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Vb(e,t){var n=pb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Hb(e,t){e.uniform1iv(this.addr,t)}function Wb(e,t){e.uniform2iv(this.addr,t)}function Gb(e,t){e.uniform3iv(this.addr,t)}function qb(e,t){e.uniform4iv(this.addr,t)}function Zb(e,t){e.uniform1uiv(this.addr,t)}function Xb(e,t){e.uniform2uiv(this.addr,t)}function Yb(e,t){e.uniform3uiv(this.addr,t)}function Kb(e,t){e.uniform4uiv(this.addr,t)}function Jb(e,t,n){var i=t.length,r=gb(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTexture2D(t[a]||ab,r[a])}function Qb(e,t,n){var i=t.length,r=gb(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTextureCube(t[a]||ub,r[a])}function ex(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return _b;case 35664:return yb;case 35665:return bb;case 35666:return xb;case 35674:return wb;case 35675:return kb;case 35676:return Sb;case 5124:case 35670:return Mb;case 35667:case 35671:return Tb;case 35668:case 35672:return Cb;case 35669:case 35673:return Eb;case 5125:return Pb;case 36294:return Lb;case 36295:return Ab;case 36296:return Ib;case 35678:case 36198:case 36298:case 36306:case 35682:return Rb;case 35679:case 36299:case 36307:return Nb;case 35680:case 36300:case 36308:case 36293:return Db;case 36289:case 36303:case 36311:case 36292:return Ob}}(t.type)}function tx(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return zb;case 35664:return Fb;case 35665:return Bb;case 35666:return $b;case 35674:return jb;case 35675:return Ub;case 35676:return Vb;case 5124:case 35670:return Hb;case 35667:case 35671:return Wb;case 35668:case 35672:return Gb;case 35669:case 35673:return qb;case 5125:return Zb;case 36294:return Xb;case 36295:return Yb;case 36296:return Kb;case 35678:case 36198:case 36298:case 36306:case 35682:return Jb;case 35680:case 36300:case 36308:case 36293:return Qb}}(t.type)}function nx(e){this.id=e,this.seq=[],this.map={}}tx.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),mb(t,e)},nx.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}};var ix=/(\w+)(\])?(\[|\.)?/g;function rx(e,t){e.seq.push(t),e.map[t.id]=t}function ax(e,t,n){var i=e.name,r=i.length;for(ix.lastIndex=0;;){var a=ix.exec(i),o=ix.lastIndex,s=a[1],u="]"===a[2],l=a[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===r){rx(n,void 0===l?new ex(s,e,t):new tx(s,e,t));break}var c=n.map[s];void 0===c&&rx(n,c=new nx(s)),n=c}}function ox(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var r=e.getActiveUniform(t,i);ax(r,e.getUniformLocation(t,r.name),this)}}function sx(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}ox.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},ox.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},ox.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},ox.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var ux=0;function lx(e){switch(e){case om:return["Linear","( value )"];case sm:return["sRGB","( value )"];case lm:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case um:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function cx(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function hx(e,t){var n=lx(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function dx(e,t){var n=lx(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function fx(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function px(e){return""!==e}function vx(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mx(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var gx=/^[ \t]*#include +<([\w\d./]+)>/gm;function _x(e){return e.replace(gx,yx)}function yx(e,t){var n=py[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return _x(n)}var bx=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,xx=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function wx(e){return e.replace(xx,Sx).replace(bx,kx)}function kx(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Sx(e,t,n,i)}function Sx(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function Mx(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Tx(e,t,n,i){var r,a,o=e.getContext(),s=n.defines,u=n.vertexShader,l=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Rv:case Nv:t="ENVMAP_TYPE_CUBE";break;case Dv:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Nv:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),p=e.gammaFactor>0?e.gammaFactor:1,v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(px).join("\n")}(n),m=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),g=o.createProgram(),_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[m].filter(px).join("\n")).length>0&&(r+="\n"),(a=[v,m].filter(px).join("\n")).length>0&&(a+="\n")):(r=[Mx(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(px).join("\n"),a=[v,Mx(n),"#define SHADER_NAME "+n.shaderName,m,"#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?py.tonemapping_pars_fragment:"",0!==n.toneMapping?fx("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===Zv?"#define OPAQUE":"",py.encodings_pars_fragment,n.map?hx("mapTexelToLinear",n.mapEncoding):"",n.matcap?hx("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?hx("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?hx("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularColorMap?hx("specularColorMapTexelToLinear",n.specularColorMapEncoding):"",n.sheenColorMap?hx("sheenColorMapTexelToLinear",n.sheenColorMapEncoding):"",n.lightMap?hx("lightMapTexelToLinear",n.lightMapEncoding):"",dx("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(px).join("\n")),u=mx(u=vx(u=_x(u),n),n),l=mx(l=vx(l=_x(l),n),n),u=wx(u),l=wx(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",n.glslVersion===fm?"":"out highp vec4 pc_fragColor;",n.glslVersion===fm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var y,b,x=_+a+l,w=sx(o,35633,_+r+u),k=sx(o,35632,x);if(o.attachShader(g,w),o.attachShader(g,k),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var S=o.getProgramInfoLog(g).trim(),M=o.getShaderInfoLog(w).trim(),T=o.getShaderInfoLog(k).trim(),C=!0,E=!0;if(!1===o.getProgramParameter(g,35714)){C=!1;var P=cx(o,w,"vertex"),L=cx(o,k,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+S+"\n"+P+"\n"+L)}else""!==S?console.warn("THREE.WebGLProgram: Program Info Log:",S):""!==M&&""!==T||(E=!1);E&&(this.diagnostics={runnable:C,programLog:S,vertexShader:{log:M,prefix:r},fragmentShader:{log:T,prefix:a}})}return o.deleteShader(w),o.deleteShader(k),this.getUniforms=function(){return void 0===y&&(y=new ox(o,g)),y},this.getAttributes=function(){return void 0===b&&(b=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),b},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=ux++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=k,this}function Cx(e,t,n,i,r,a,o){var s=[],u=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,h=r.maxVertexUniforms,d=r.vertexTextures,f=r.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function m(e){var t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=om,u&&e&&e.isTexture&&e.format===Xv&&e.type===Uv&&e.encoding===sm&&(t=om),t}return{getParameters:function(a,s,v,g,_){var y,b,x=g.fog,w=a.isMeshStandardMaterial?g.environment:null,k=(a.isMeshStandardMaterial?n:t).get(a.envMap||w),S=p[a.type],M=_.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(c)return 1024;var n=h,i=Math.floor((n-20)/4),r=Math.min(i,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}(_):0;if(null!==a.precision&&(f=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."),S){var T=my[S];y=T.vertexShader,b=T.fragmentShader}else y=a.vertexShader,b=a.fragmentShader;var C=e.getRenderTarget(),E=a.alphaTest>0,P=a.clearcoat>0;return{isWebGL2:u,shaderID:S,shaderName:a.type,vertexShader:y,fragmentShader:b,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:d,outputEncoding:null!==C?m(C.texture):e.outputEncoding,map:!!a.map,mapEncoding:m(a.map),matcap:!!a.matcap,matcapEncoding:m(a.matcap),envMap:!!k,envMapMode:k&&k.mapping,envMapEncoding:m(k),envMapCubeUV:!!k&&(k.mapping===Dv||307===k.mapping),lightMap:!!a.lightMap,lightMapEncoding:m(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:m(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,clearcoat:P,clearcoatMap:P&&!!a.clearcoatMap,clearcoatRoughnessMap:P&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,specularColorMapEncoding:m(a.specularColorMap),alphaMap:!!a.alphaMap,alphaTest:E,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenColorMapEncoding:m(a.sheenColorMap),sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!_.geometry&&!!_.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.geometry&&!!_.geometry.attributes.color&&4===_.geometry.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||!!a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!x,useFog:a.fog,fogExp2:x&&x.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===_.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:!!_.geometry&&!!_.geometry.morphAttributes.position,morphNormals:!!_.geometry&&!!_.geometry.morphAttributes.normal,morphTargetsCount:_.geometry&&_.geometry.morphAttributes.position?_.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&v.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(Rm(t.fragmentShader)),n.push(Rm(t.vertexShader))),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);if(!1===t.isRawShaderMaterial){for(var r=0;r<v.length;r++)n.push(t[v[r]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var i=my[n];t=Y_.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,r=0,o=s.length;r<o;r++){var u=s[r];if(u.cacheKey===n){++(i=u).usedTimes;break}}return void 0===i&&(i=new Tx(e,n,t,a),s.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Ex(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Px(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Lx(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ax(e){var t=[],n=0,i=[],r=[],a=[],o={id:-1};function s(i,r,a,s,u,l){var c=t[n],h=e.get(a);return void 0===c?(c={id:i.id,object:i,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:i.renderOrder,z:u,group:l},t[n]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=a,c.program=h.program||o,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=u,c.group=l),n++,c}return{opaque:i,transmissive:r,transparent:a,init:function(){n=0,i.length=0,r.length=0,a.length=0},push:function(e,t,n,o,u,l){var c=s(e,t,n,o,u,l);n.transmission>0?r.push(c):!0===n.transparent?a.push(c):i.push(c)},unshift:function(e,t,n,o,u,l){var c=s(e,t,n,o,u,l);n.transmission>0?r.unshift(c):!0===n.transparent?a.unshift(c):i.unshift(c)},finish:function(){for(var e=n,i=t.length;e<i;e++){var r=t[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Px),r.length>1&&r.sort(t||Lx),a.length>1&&a.sort(t||Lx)}}}function Ix(e){var t=new WeakMap;return{get:function(n,i){var r;return!1===t.has(n)?(r=new Ax(e),t.set(n,[r])):i>=t.get(n).length?(r=new Ax(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function Rx(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Vm,color:new h_};break;case"SpotLight":n={position:new Vm,direction:new Vm,color:new h_,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Vm,color:new h_,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Vm,skyColor:new h_,groundColor:new h_};break;case"RectAreaLight":n={color:new h_,position:new Vm,halfWidth:new Vm,halfHeight:new Vm}}return e[t.id]=n,n}}}var Nx=0;function Dx(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ox(e,t){for(var n=new Rx,i=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Em};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Em,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)r.probe.push(new Vm);var o=new Vm,s=new bg,u=new bg;return{setup:function(a,o){for(var s=0,u=0,l=0,c=0;c<9;c++)r.probe[c].set(0,0,0);var h=0,d=0,f=0,p=0,v=0,m=0,g=0,_=0;a.sort(Dx);for(var y=!0!==o?Math.PI:1,b=0,x=a.length;b<x;b++){var w=a[b],k=w.color,S=w.intensity,M=w.distance,T=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)s+=k.r*S*y,u+=k.g*S*y,l+=k.b*S*y;else if(w.isLightProbe)for(var C=0;C<9;C++)r.probe[C].addScaledVector(w.sh.coefficients[C],S);else if(w.isDirectionalLight){var E=n.get(w);if(E.color.copy(w.color).multiplyScalar(w.intensity*y),w.castShadow){var P=w.shadow,L=i.get(w);L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,r.directionalShadow[h]=L,r.directionalShadowMap[h]=T,r.directionalShadowMatrix[h]=w.shadow.matrix,m++}r.directional[h]=E,h++}else if(w.isSpotLight){var A=n.get(w);if(A.position.setFromMatrixPosition(w.matrixWorld),A.color.copy(k).multiplyScalar(S*y),A.distance=M,A.coneCos=Math.cos(w.angle),A.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),A.decay=w.decay,w.castShadow){var I=w.shadow,R=i.get(w);R.shadowBias=I.bias,R.shadowNormalBias=I.normalBias,R.shadowRadius=I.radius,R.shadowMapSize=I.mapSize,r.spotShadow[f]=R,r.spotShadowMap[f]=T,r.spotShadowMatrix[f]=w.shadow.matrix,_++}r.spot[f]=A,f++}else if(w.isRectAreaLight){var N=n.get(w);N.color.copy(k).multiplyScalar(S),N.halfWidth.set(.5*w.width,0,0),N.halfHeight.set(0,.5*w.height,0),r.rectArea[p]=N,p++}else if(w.isPointLight){var D=n.get(w);if(D.color.copy(w.color).multiplyScalar(w.intensity*y),D.distance=w.distance,D.decay=w.decay,w.castShadow){var O=w.shadow,z=i.get(w);z.shadowBias=O.bias,z.shadowNormalBias=O.normalBias,z.shadowRadius=O.radius,z.shadowMapSize=O.mapSize,z.shadowCameraNear=O.camera.near,z.shadowCameraFar=O.camera.far,r.pointShadow[d]=z,r.pointShadowMap[d]=T,r.pointShadowMatrix[d]=w.shadow.matrix,g++}r.point[d]=D,d++}else if(w.isHemisphereLight){var F=n.get(w);F.skyColor.copy(w.color).multiplyScalar(S*y),F.groundColor.copy(w.groundColor).multiplyScalar(S*y),r.hemi[v]=F,v++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=vy.LTC_FLOAT_1,r.rectAreaLTC2=vy.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=vy.LTC_HALF_1,r.rectAreaLTC2=vy.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=u,r.ambient[2]=l;var B=r.hash;B.directionalLength===h&&B.pointLength===d&&B.spotLength===f&&B.rectAreaLength===p&&B.hemiLength===v&&B.numDirectionalShadows===m&&B.numPointShadows===g&&B.numSpotShadows===_||(r.directional.length=h,r.spot.length=f,r.rectArea.length=p,r.point.length=d,r.hemi.length=v,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=_,B.directionalLength=h,B.pointLength=d,B.spotLength=f,B.rectAreaLength=p,B.hemiLength=v,B.numDirectionalShadows=m,B.numPointShadows=g,B.numSpotShadows=_,r.version=Nx++)},setupView:function(e,t){for(var n=0,i=0,a=0,l=0,c=0,h=t.matrixWorldInverse,d=0,f=e.length;d<f;d++){var p=e[d];if(p.isDirectionalLight){var v=r.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(p.isSpotLight){var m=r.spot[a];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),a++}else if(p.isRectAreaLight){var g=r.rectArea[l];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(p.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),l++}else if(p.isPointLight){var _=r.point[i];_.position.setFromMatrixPosition(p.matrixWorld),_.position.applyMatrix4(h),i++}else if(p.isHemisphereLight){var y=r.hemi[c];y.direction.setFromMatrixPosition(p.matrixWorld),y.direction.transformDirection(h),y.direction.normalize(),c++}}},state:r}}function zx(e,t){var n=new Ox(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Fx(e,t){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(i)?(r=new zx(e,t),n.set(i,[r])):a>=n.get(i).length?(r=new zx(e,t),n.get(i).push(r)):r=n.get(i)[a],r},dispose:function(){n=new WeakMap}}}var Bx=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="MeshDepthMaterial",i.depthPacking=3200,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(r_);Bx.prototype.isMeshDepthMaterial=!0;var $x=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="MeshDistanceMaterial",i.referencePosition=new Vm,i.nearDistance=1,i.farDistance=1e3,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.fog=!1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(r_);$x.prototype.isMeshDistanceMaterial=!0;function jx(e,t,n){var i=new cy,r=new Em,a=new Em,o=new Fm,s=new Bx({depthPacking:3201}),u=new $x,l={},c=n.maxTextureSize,h={0:1,1:0,2:2},d=new K_({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Em},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;var p=new C_;p.setAttribute("position",new v_(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new W_(p,d),m=this;function g(n,i){var r=t.update(v);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,d,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,f,v,null)}function _(t,n,i,r,a,o,c){var d=null,f=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d=void 0!==f?f:!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){var p=d.uuid,v=i.uuid,m=l[p];void 0===m&&(m={},l[p]=m);var g=m[v];void 0===g&&(g=d.clone(),m[v]=g),d=g}return d.visible=i.visible,d.wireframe=i.wireframe,d.side=3===c?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:h[i.side],d.alphaMap=i.alphaMap,d.alphaTest=i.alphaTest,d.clipShadows=i.clipShadows,d.clippingPlanes=i.clippingPlanes,d.clipIntersection=i.clipIntersection,d.displacementMap=i.displacementMap,d.displacementScale=i.displacementScale,d.displacementBias=i.displacementBias,d.wireframeLinewidth=i.wireframeLinewidth,d.linewidth=i.linewidth,!0===r.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(r.matrixWorld),d.nearDistance=a,d.farDistance=o),d}function y(n,r,a,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var u=t.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=l[f.materialIndex];if(p&&p.visible){var v=_(n,0,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,v,n,f)}}else if(l.visible){var m=_(n,0,l,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,m,n,null)}}for(var g=n.children,b=0,x=g.length;b<x;b++)y(g[b],r,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var v=t[f],_=v.shadow;if(void 0!==_){if(!1!==_.autoUpdate||!1!==_.needsUpdate){r.copy(_.mapSize);var b=_.getFrameExtents();if(r.multiply(b),a.copy(_.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(a.x=Math.floor(c/b.x),r.x=a.x*b.x,_.mapSize.x=a.x),r.y>c&&(a.y=Math.floor(c/b.y),r.y=a.y*b.y,_.mapSize.y=a.y)),null===_.map&&!_.isPointLightShadow&&3===this.type){var x={minFilter:$v,magFilter:$v,format:Xv};_.map=new Bm(r.x,r.y,x),_.map.texture.name=v.name+".shadowMap",_.mapPass=new Bm(r.x,r.y,x),_.camera.updateProjectionMatrix()}if(null===_.map){var w={minFilter:Bv,magFilter:Bv,format:Xv};_.map=new Bm(r.x,r.y,w),_.map.texture.name=v.name+".shadowMap",_.camera.updateProjectionMatrix()}e.setRenderTarget(_.map),e.clear();for(var k=_.getViewportCount(),S=0;S<k;S++){var M=_.getViewport(S);o.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),d.viewport(o),_.updateMatrices(v,S),i=_.getFrustum(),y(n,s,_.camera,v,this.type)}_.isPointLightShadow||3!==this.type||g(_,s),_.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,l,h)}}}function Ux(e,t,n){var i,r,a=n.isWebGL2;var o=new function(){var t=!1,n=new Fm,i=null,r=new Fm(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?B(2929):$(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},u=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?B(2960):$(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&u===i||(e.stencilOp(t,n,i),o=t,s=n,u=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null}}},l={},c=null,h={},d=null,f=!1,p=null,v=null,m=null,g=null,_=null,y=null,b=null,x=!1,w=null,k=null,S=null,M=null,T=null,C=e.getParameter(35661),E=!1,P=0,L=e.getParameter(7938);-1!==L.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(L)[1]),E=P>=1):-1!==L.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),E=P>=2);var A=null,I={},R=e.getParameter(3088),N=e.getParameter(2978),D=(new Fm).fromArray(R),O=(new Fm).fromArray(N);function z(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var F={};function B(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function $(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}F[3553]=z(3553,3553,1),F[34067]=z(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),B(2929),s.setFunc(3),W(!1),G(1),B(2884),H(0);var j=(Yh(i={},Iv,32774),Yh(i,101,32778),Yh(i,102,32779),i);if(a)j[103]=32775,j[104]=32776;else{var U=t.get("EXT_blend_minmax");null!==U&&(j[103]=U.MIN_EXT,j[104]=U.MAX_EXT)}var V=(Yh(r={},200,0),Yh(r,201,1),Yh(r,202,768),Yh(r,204,770),Yh(r,210,776),Yh(r,208,774),Yh(r,206,772),Yh(r,203,769),Yh(r,205,771),Yh(r,209,775),Yh(r,207,773),r);function H(t,n,i,r,a,o,s,u){if(0!==t){if(!1===f&&(B(3042),f=!0),5===t)a=a||n,o=o||i,s=s||r,n===v&&a===_||(e.blendEquationSeparate(j[n],j[a]),v=n,_=a),i===m&&r===g&&o===y&&s===b||(e.blendFuncSeparate(V[i],V[r],V[o],V[s]),m=i,g=r,y=o,b=s),p=t,x=null;else if(t!==p||u!==x){if(v===Iv&&_===Iv||(e.blendEquation(32774),v=Iv,_=Iv),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,b=null,p=t,x=u}}else!0===f&&($(3042),f=!1)}function W(t){w!==t&&(t?e.frontFace(2304):e.frontFace(2305),w=t)}function G(t){0!==t?(B(2884),t!==k&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):$(2884),k=t}function q(t,n,i){t?(B(32823),M===n&&T===i||(e.polygonOffset(n,i),M=n,T=i)):$(32823)}function Z(t){void 0===t&&(t=33984+C-1),A!==t&&(e.activeTexture(t),A=t)}return{buffers:{color:o,depth:s,stencil:u},enable:B,disable:$,bindFramebuffer:function(t,n){return null===n&&null!==c&&(n=c),h[t]!==n&&(e.bindFramebuffer(t,n),h[t]=n,a&&(36009===t&&(h[36160]=n),36160===t&&(h[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==c&&(e.bindFramebuffer(36160,t),c=t)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:H,setMaterial:function(e,t){2===e.side?$(2884):B(2884);var n=1===e.side;t&&(n=!n),W(n),1===e.blending&&!1===e.transparent?H(0):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var i=e.stencilWrite;u.setTest(i),i&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?B(32926):$(32926)},setFlipSided:W,setCullFace:G,setLineWidth:function(t){t!==S&&(E&&e.lineWidth(t),S=t)},setPolygonOffset:q,setScissorTest:function(e){e?B(3089):$(3089)},activeTexture:Z,bindTexture:function(t,n){null===A&&Z();var i=I[A];void 0===i&&(i={type:void 0,texture:void 0},I[A]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||F[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=I[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===D.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),D.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},A=null,I={},c=null,h={},d=null,f=!1,p=null,v=null,m=null,g=null,_=null,y=null,b=null,x=!1,w=null,k=null,S=null,M=null,T=null,D.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function Vx(e,t,n,i,r,a,o){var s,u,l,c=r.isWebGL2,h=r.maxTextures,d=r.maxCubemapSize,f=r.maxTextureSize,p=r.maxSamples,v=new WeakMap,m=!1;try{m="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(MN){}function g(e,t){return m?new OffscreenCanvas(e,t):Im("canvas")}function _(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Tm:Math.floor,o=a(r*e.width),s=a(r*e.height);void 0===l&&(l=g(o,s));var u=n?g(o,s):l;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return Mm(e.width)&&Mm(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==Bv&&e.minFilter!==$v}function x(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.generateMipmap(t);var s=i.get(n);s.__maxMipLevel=Math.log2(Math.max(r,a,o))}function w(n,i,r,a){if(!1===c)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=a===sm?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function k(e){return e===Bv||1004===e||1005===e?9728:9729}function S(t){var n=t.target;n.removeEventListener("dispose",S),function(t){var n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&v.delete(n),o.memory.textures--}function M(t){var n=t.target;n.removeEventListener("dispose",M),function(t){var n=t.texture,r=i.get(t),a=i.get(n);if(!t)return;void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(r.__webglFramebuffer[s]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[s]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(var u=0,l=n.length;u<l;u++){var c=i.get(n[u]);c.__webglTexture&&(e.deleteTexture(c.__webglTexture),o.memory.textures--),i.remove(n[u])}i.remove(n),i.remove(t)}(n)}var T=0;function C(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;v.get(e)!==t&&(v.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void R(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function E(t,r){var o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;I(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);for(var o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),s=i.image[0]&&i.image[0].isDataTexture,u=[],l=0;l<6;l++)u[l]=o||s?s?i.image[l].image:i.image[l]:_(i.image[l],!1,!0,d);var h,f=u[0],p=y(f)||c,v=a.convert(i.format),m=a.convert(i.type),g=w(i.internalFormat,v,m,i.encoding);if(A(34067,i,p),o){for(var k=0;k<6;k++){h=u[k].mipmaps;for(var S=0;S<h.length;S++){var M=h[S];i.format!==Xv&&i.format!==Zv?null!==v?n.compressedTexImage2D(34069+k,S,g,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+k,S,g,M.width,M.height,0,v,m,M.data)}}t.__maxMipLevel=h.length-1}else{h=i.mipmaps;for(var T=0;T<6;T++)if(s){n.texImage2D(34069+T,0,g,u[T].width,u[T].height,0,v,m,u[T].data);for(var C=0;C<h.length;C++){var E=h[C].image[T].image;n.texImage2D(34069+T,C+1,g,E.width,E.height,0,v,m,E.data)}}else{n.texImage2D(34069+T,0,g,v,m,u[T]);for(var P=0;P<h.length;P++){var L=h[P];n.texImage2D(34069+T,P+1,g,v,m,L.image[T])}}t.__maxMipLevel=h.length}b(i,p)&&x(34067,i,f.width,f.height);t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(o,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))}var P=(Yh(s={},Ov,10497),Yh(s,zv,33071),Yh(s,Fv,33648),s),L=(Yh(u={},Bv,9728),Yh(u,1004,9984),Yh(u,1005,9986),Yh(u,$v,9729),Yh(u,1007,9985),Yh(u,jv,9987),u);function A(n,a,o){if(o?(e.texParameteri(n,10242,P[a.wrapS]),e.texParameteri(n,10243,P[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,P[a.wrapR]),e.texParameteri(n,10240,L[a.magFilter]),e.texParameteri(n,10241,L[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===zv&&a.wrapT===zv||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,k(a.magFilter)),e.texParameteri(n,10241,k(a.minFilter)),a.minFilter!==Bv&&a.minFilter!==$v&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.type===Wv&&!1===t.has("OES_texture_float_linear"))return;if(!1===c&&a.type===Gv&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function I(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S),t.__webglTexture=e.createTexture(),o.memory.textures++)}function R(t,i,r){var o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),I(t,i),n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);var s,u=function(e){return!c&&(e.wrapS!==zv||e.wrapT!==zv||e.minFilter!==Bv&&e.minFilter!==$v)}(i)&&!1===y(i.image),l=_(i.image,u,!1,f),h=y(l)||c,d=a.convert(i.format),p=a.convert(i.type),v=w(i.internalFormat,d,p,i.encoding);A(o,i,h);var m=i.mipmaps;if(i.isDepthTexture)v=6402,c?v=i.type===Wv?36012:i.type===Hv?33190:i.type===qv?35056:33189:i.type===Wv&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Yv&&6402===v&&i.type!==Vv&&i.type!==Hv&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Vv,p=a.convert(i.type)),i.format===Kv&&6402===v&&(v=34041,i.type!==qv&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=qv,p=a.convert(i.type))),n.texImage2D(3553,0,v,l.width,l.height,0,d,p,null);else if(i.isDataTexture)if(m.length>0&&h){for(var g=0,k=m.length;g<k;g++)s=m[g],n.texImage2D(3553,g,v,s.width,s.height,0,d,p,s.data);i.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,l.width,l.height,0,d,p,l.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(var S=0,M=m.length;S<M;S++)s=m[S],i.format!==Xv&&i.format!==Zv?null!==d?n.compressedTexImage2D(3553,S,v,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,S,v,s.width,s.height,0,d,p,s.data);t.__maxMipLevel=m.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,v,l.width,l.height,l.depth,0,d,p,l.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,v,l.width,l.height,l.depth,0,d,p,l.data),t.__maxMipLevel=0;else if(m.length>0&&h){for(var T=0,C=m.length;T<C;T++)s=m[T],n.texImage2D(3553,T,v,d,p,s);i.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,d,p,l),t.__maxMipLevel=0;b(i,h)&&x(o,i,l.width,l.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function N(t,r,o,s,u){var l=a.convert(o.format),c=a.convert(o.type),h=w(o.internalFormat,l,c,o.encoding);32879===u||35866===u?n.texImage3D(u,0,h,r.width,r.height,r.depth,0,l,c,null):n.texImage2D(u,0,h,r.width,r.height,0,l,c,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,u,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function D(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===Wv?r=36012:o.type===Hv&&(r=33190));var s=z(n);e.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){var u=z(n);e.renderbufferStorageMultisample(36161,u,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var l=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,c=a.convert(l.format),h=a.convert(l.type),d=w(l.internalFormat,c,h,l.encoding);if(i){var f=z(n);e.renderbufferStorageMultisample(36161,f,d,n.width,n.height)}else e.renderbufferStorage(36161,d,n.width,n.height)}e.bindRenderbuffer(36161,null)}function O(t){var r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),C(r.depthTexture,0);var a=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Yv)e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==Kv)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),D(r.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),D(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function z(e){return c&&e.isWebGLMultisampleRenderTarget?Math.min(p,e.samples):0}var F=!1,B=!1;this.allocateTextureUnit=function(){var e=T;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=C,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){var s=t.texture,u=i.get(t),l=i.get(s);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(l.__webglTexture=e.createTexture(),l.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=!0===t.isWebGLMultisampleRenderTarget,p=s.isDataTexture3D||s.isDataTexture2DArray,v=y(t)||c;if(!c||s.format!==Zv||s.type!==Wv&&s.type!==Gv||(s.format=Xv,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){u.__webglFramebuffer=[];for(var m=0;m<6;m++)u.__webglFramebuffer[m]=e.createFramebuffer()}else if(u.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers)for(var g=t.texture,_=0,k=g.length;_<k;_++){var S=i.get(g[_]);void 0===S.__webglTexture&&(S.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(f)if(c){u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer);var T=a.convert(s.format),C=a.convert(s.type),E=w(s.internalFormat,T,C,s.encoding),P=z(t);e.renderbufferStorageMultisample(36161,P,E,t.width,t.height),n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,u.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),D(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,l.__webglTexture),A(34067,s,v);for(var L=0;L<6;L++)N(u.__webglFramebuffer[L],t,s,36064,34069+L);b(s,v)&&x(34067,s,t.width,t.height),n.unbindTexture()}else if(d){for(var I=t.texture,R=0,F=I.length;R<F;R++){var B=I[R],$=i.get(B);n.bindTexture(3553,$.__webglTexture),A(3553,B,v),N(u.__webglFramebuffer,t,B,36064+R,3553),b(B,v)&&x(3553,B,t.width,t.height)}n.unbindTexture()}else{var j=3553;if(p)if(c)j=s.isDataTexture3D?32879:35866;else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(j,l.__webglTexture),A(j,s,v),N(u.__webglFramebuffer,t,s,36064,j),b(s,v)&&x(j,s,t.width,t.height,t.depth),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){for(var t=y(e)||c,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=r.length;a<o;a++){var s=r[a];if(b(s,t)){var u=e.isWebGLCubeRenderTarget?34067:3553,l=i.get(s).__webglTexture;n.bindTexture(u,l),x(u,s,e.width,e.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(c){var r=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);var s=i.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,r,a,0,0,r,a,o,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),C(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),E(e,t)}}function Hx(e,t,n){var i=n.isWebGL2;return{convert:function(e){var n;if(e===Uv)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===Vv)return 5123;if(1013===e)return 5124;if(e===Hv)return 5125;if(e===Wv)return 5126;if(e===Gv)return i?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(e===Zv)return 6407;if(e===Xv)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===Yv)return 6402;if(e===Kv)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:e===qv?i?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}var Wx=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Fd(this,n),(e=t.call(this)).cameras=i,e}return $d(n)}(Q_);Wx.prototype.isArrayCamera=!0;var Gx=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this)).type="Group",e}return $d(n)}(Wg);Gx.prototype.isGroup=!0;var qx={type:"move"},Zx=function(){function e(){Fd(this,e),this._targetRay=null,this._grip=null,this._hand=null}return $d(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new Gx,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new Gx,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vm,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vm),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new Gx,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vm,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vm),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&null!==(i=t.getPose(e.targetRaySpace,n))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(qx)),u&&e.hand){a=!0;var l,c=Pd(e.hand.values());try{for(c.s();!(l=c.n()).done;){var h=l.value,d=t.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var f=new Gx;f.matrixAutoUpdate=!1,f.visible=!1,u.joints[h.jointName]=f,u.add(f)}var p=u.joints[h.jointName];null!==d&&(p.matrix.fromArray(d.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=d.radius),p.visible=null!==d}}catch(MN){c.e(MN)}finally{c.f()}var v=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],g=v.position.distanceTo(m.position);u.inputState.pinching&&g>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&g<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1);return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==u&&(u.visible=null!==a),this}}]),e}(),Xx=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;Fd(this,n);var a=Ad(r=t.call(this)),o=e.state,s=null,u=1,l=null,c="local-floor",h=null,d=null,f=null,p=null,v=null,m=!1,g=null,_=null,y=null,b=null,x=null,w=null,k=[],S=new Map,M=new Q_;M.layers.enable(1),M.viewport=new Fm;var T=new Q_;T.layers.enable(2),T.viewport=new Fm;var C=[M,T],E=new Wx;E.layers.enable(1),E.layers.enable(2);var P=null,L=null;function A(e){var t=S.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function I(){S.forEach((function(e,t){e.disconnect(t)})),S.clear(),P=null,L=null,o.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),f&&i.deleteFramebuffer(f),g&&i.deleteFramebuffer(g),_&&i.deleteRenderbuffer(_),y&&i.deleteRenderbuffer(y),f=null,g=null,_=null,y=null,v=null,p=null,d=null,s=null,F.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function R(e){for(var t=s.inputSources,n=0;n<k.length;n++)S.set(t[n],k[n]);for(var i=0;i<e.removed.length;i++){var r=e.removed[i],a=S.get(r);a&&(a.dispatchEvent({type:"disconnected",data:r}),S.delete(r))}for(var o=0;o<e.added.length;o++){var u=e.added[o],l=S.get(u);l&&l.dispatchEvent({type:"connected",data:u})}}r.cameraAutoUpdate=!0,r.enabled=!1,r.isPresenting=!1,r.getController=function(e){var t=k[e];return void 0===t&&(t=new Zx,k[e]=t),t.getTargetRaySpace()},r.getControllerGrip=function(e){var t=k[e];return void 0===t&&(t=new Zx,k[e]=t),t.getGripSpace()},r.getHand=function(e){var t=k[e];return void 0===t&&(t=new Zx,k[e]=t),t.getHandSpace()},r.setFramebufferScaleFactor=function(e){u=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},r.setReferenceSpaceType=function(e){c=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},r.getReferenceSpace=function(){return l},r.getBaseLayer=function(){return null!==p?p:v},r.getBinding=function(){return d},r.getFrame=function(){return b},r.getSession=function(){return s},r.setSession=function(){var e,t=(e=zd().mark((function e(t){var n,r,h,b,k;return zd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(s=t)){e.next=22;break}if(s.addEventListener("select",A),s.addEventListener("selectstart",A),s.addEventListener("selectend",A),s.addEventListener("squeeze",A),s.addEventListener("squeezestart",A),s.addEventListener("squeezeend",A),s.addEventListener("end",I),s.addEventListener("inputsourceschange",R),!0===(n=i.getContextAttributes()).xrCompatible){e.next=14;break}return e.next=14,i.makeXRCompatible();case 14:return void 0===s.renderState.layers?(r={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u},v=new XRWebGLLayer(s,i,r),s.updateRenderState({baseLayer:v})):i instanceof WebGLRenderingContext?(h={antialias:!0,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u},v=new XRWebGLLayer(s,i,h),s.updateRenderState({layers:[v]})):(m=n.antialias,b=null,n.depth&&(w=256,n.stencil&&(w|=1024),x=n.stencil?33306:36096,b=n.stencil?35056:33190),k={colorFormat:n.alpha?32856:32849,depthFormat:b,scaleFactor:u},d=new XRWebGLBinding(s,i),p=d.createProjectionLayer(k),f=i.createFramebuffer(),s.updateRenderState({layers:[p]}),m&&(g=i.createFramebuffer(),_=i.createRenderbuffer(),i.bindRenderbuffer(36161,_),i.renderbufferStorageMultisample(36161,4,32856,p.textureWidth,p.textureHeight),o.bindFramebuffer(36160,g),i.framebufferRenderbuffer(36160,36064,36161,_),i.bindRenderbuffer(36161,null),null!==b&&(y=i.createRenderbuffer(),i.bindRenderbuffer(36161,y),i.renderbufferStorageMultisample(36161,4,b,p.textureWidth,p.textureHeight),i.framebufferRenderbuffer(36160,x,36161,y),i.bindRenderbuffer(36161,null)),o.bindFramebuffer(36160,null))),e.next=17,s.requestReferenceSpace(c);case 17:l=e.sent,F.setContext(s),F.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 22:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){Ed(a,i,r,o,s,"next",e)}function s(e){Ed(a,i,r,o,s,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}();var N=new Vm,D=new Vm;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}r.updateCamera=function(e){if(null!==s){E.near=T.near=M.near=e.near,E.far=T.far=M.far=e.far,P===E.near&&L===E.far||(s.updateRenderState({depthNear:E.near,depthFar:E.far}),P=E.near,L=E.far);var t=e.parent,n=E.cameras;O(E,t);for(var i=0;i<n.length;i++)O(n[i],t);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),e.position.copy(E.position),e.quaternion.copy(E.quaternion),e.scale.copy(E.scale),e.matrix.copy(E.matrix),e.matrixWorld.copy(E.matrixWorld);for(var r=e.children,a=0,o=r.length;a<o;a++)r[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){N.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(n.matrixWorld);var i=N.distanceTo(D),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),u=(r[9]+1)/r[5],l=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=o*c,f=o*h,p=i/(-c+h),v=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=s+p,_=d-v,y=f+(i-v),b=u*s/g*m,x=l*s/g*m;e.projectionMatrix.makePerspective(_,y,b,x,m,g)}(E,M,T):E.projectionMatrix.copy(M.projectionMatrix)}},r.getCamera=function(){return E},r.getFoveation=function(){return null!==p?p.fixedFoveation:null!==v?v.fixedFoveation:void 0},r.setFoveation=function(e){null!==p&&(p.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)};var z=null;var F=new hy;return F.setAnimationLoop((function(e,t){if(h=t.getViewerPose(l),b=t,null!==h){var n=h.views;null!==v&&o.bindXRFramebuffer(v.framebuffer);var r=!1;n.length!==E.cameras.length&&(E.cameras.length=0,r=!0);for(var a=0;a<n.length;a++){var u=n[a],c=null;if(null!==v)c=v.getViewport(u);else{var _=d.getViewSubImage(p,u);o.bindXRFramebuffer(f),void 0!==_.depthStencilTexture&&i.framebufferTexture2D(36160,x,3553,_.depthStencilTexture,0),i.framebufferTexture2D(36160,36064,3553,_.colorTexture,0),c=_.viewport}var y=C[a];y.matrix.fromArray(u.transform.matrix),y.projectionMatrix.fromArray(u.projectionMatrix),y.viewport.set(c.x,c.y,c.width,c.height),0===a&&E.matrix.copy(y.matrix),!0===r&&E.cameras.push(y)}m&&(o.bindXRFramebuffer(g),null!==w&&i.clear(w))}for(var S=s.inputSources,M=0;M<k.length;M++){var T=k[M],P=S[M];T.update(P,t,l)}if(z&&z(e,t),m){var L=p.textureWidth,A=p.textureHeight;o.bindFramebuffer(36008,g),o.bindFramebuffer(36009,f),i.invalidateFramebuffer(36008,[x]),i.invalidateFramebuffer(36009,[x]),i.blitFramebuffer(0,0,L,A,0,0,L,A,16384,9728),i.invalidateFramebuffer(36008,[36064]),o.bindFramebuffer(36008,null),o.bindFramebuffer(36009,null),o.bindFramebuffer(36160,g)}b=null})),r.setAnimationLoop=function(e){z=e},r.dispose=function(){},r}return $d(n)}(pm);function Yx(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);var i,r,a=e.get(n).envMap;if(a){t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio;var o=e.get(a).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularColorMap?i=n.specularColorMap:n.transmissionMap?i=n.transmissionMap:n.thicknessMap?i=n.thicknessMap:n.sheenColorMap?i=n.sheenColorMap:n.sheenRoughnessMap&&(i=n.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,a,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,o):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Kx(){var e=Im("canvas");return e.style.display="block",e}function Jx(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=void 0!==e.canvas?e.canvas:Kx(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,d=null,f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=om,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;var v=this,m=!1,g=0,_=0,y=null,b=-1,x=null,w=new Fm,k=new Fm,S=null,M=t.width,T=t.height,C=1,E=null,P=null,L=new Fm(0,0,M,T),A=new Fm(0,0,M,T),I=!1,R=[],N=new cy,D=!1,O=!1,z=null,F=new bg,B=new Vm,$={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===y?C:1}var U,V,H,W,G,q,Z,X,Y,K,J,Q,ee,te,ne,ie,re,ae,oe,se,ue,le,ce,he=n;function de(e,n){for(var i=0;i<e.length;i++){var r=e[i],a=t.getContext(r,n);if(null!==a)return a}return null}try{var fe={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",_e,!1),null===he){var pe=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&pe.shift(),null===(he=de(pe,fe)))throw de(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ze){throw console.error("THREE.WebGLRenderer: "+ze.message),ze}function ve(){U=new Zy(he),V=new by(he,U,e),U.init(V),le=new Hx(he,U,V),H=new Ux(he,U,V),R[0]=1029,W=new Ky(he),G=new Ex,q=new Vx(he,U,H,G,V,le,W),Z=new wy(v),X=new qy(v),Y=new dy(he,V),ce=new _y(he,U,Y,V),K=new Xy(he,Y,W,ce),J=new ib(he,K,Y,W),oe=new nb(he,V,q),ie=new xy(G),Q=new Cx(v,Z,X,U,V,ce,ie),ee=new Yx(G),te=new Ix(G),ne=new Fx(U,V),ae=new gy(v,Z,H,J,s),re=new jx(v,J,V),se=new yy(he,U,W,V),ue=new Yy(he,U,W,V),W.programs=Q.programs,v.capabilities=V,v.extensions=U,v.properties=G,v.renderLists=te,v.shadowMap=re,v.state=H,v.info=W}ve();var me=new Xx(v,he);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;var e=W.autoReset,t=re.enabled,n=re.autoUpdate,i=re.needsUpdate,r=re.type;ve(),W.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=i,re.type=r}function ye(e){var t=e.target;t.removeEventListener("dispose",ye),be(t)}function be(e){xe(e),G.remove(e)}function xe(e){var t=G.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))}this.xr=me,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){var e=U.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=U.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(e){void 0!==e&&(C=e,this.setSize(M,T,!1))},this.getSize=function(e){return e.set(M,T)},this.setSize=function(e,n,i){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,T=n,t.width=Math.floor(e*C),t.height=Math.floor(n*C),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(M*C,T*C).floor()},this.setDrawingBufferSize=function(e,n,i){M=e,T=n,C=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),H.viewport(w.copy(L).multiplyScalar(C).floor())},this.getScissor=function(e){return e.copy(A)},this.setScissor=function(e,t,n,i){e.isVector4?A.set(e.x,e.y,e.z,e.w):A.set(e,t,n,i),H.scissor(k.copy(A).multiplyScalar(C).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(e){H.setScissorTest(I=e)},this.setOpaqueSort=function(e){E=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),he.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",_e,!1),te.dispose(),ne.dispose(),G.dispose(),Z.dispose(),X.dispose(),J.dispose(),ce.dispose(),me.dispose(),me.removeEventListener("sessionstart",Se),me.removeEventListener("sessionend",Me),z&&(z.dispose(),z=null),Te.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=$);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=Ne(e,t,n,i,r);H.setMaterial(i,o);var u=n.index,l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;var c,h=1;!0===i.wireframe&&(u=K.getWireframeAttribute(n),h=2),ce.setup(r,i,s,n,u);var d=se;null!==u&&(c=Y.get(u),(d=ue).setIndex(c));var f=null!==u?u.count:l.count,p=n.drawRange.start*h,v=n.drawRange.count*h,m=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,_=Math.max(p,m),y=Math.min(f,p+v,m+g)-1,b=Math.max(0,y-_+1);if(0!==b){if(r.isMesh)!0===i.wireframe?(H.setLineWidth(i.wireframeLinewidth*j()),d.setMode(1)):d.setMode(4);else if(r.isLine){var x=i.linewidth;void 0===x&&(x=1),H.setLineWidth(x*j()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(_,b,r.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(_,b,w)}else d.render(_,b)}},this.compile=function(e,t){(d=ne.get(e)).init(),p.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(v.physicallyCorrectLights),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++){Ie(n[i],e,t)}else Ie(n,e,t)})),p.pop(),d=null};var we=null;function ke(e){we&&we(e)}function Se(){Te.stop()}function Me(){Te.start()}var Te=new hy;function Ce(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||N.intersectsSprite(e)){i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var r=J.update(e),a=e.material;a.visible&&h.push(e,r,a,n,B.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||N.intersectsObject(e))){i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var o=J.update(e),s=e.material;if(Array.isArray(s))for(var u=o.groups,l=0,c=u.length;l<c;l++){var f=u[l],p=s[f.materialIndex];p&&p.visible&&h.push(e,o,p,n,B.z,f)}else s.visible&&h.push(e,o,s,n,B.z,null)}for(var v=e.children,m=0,g=v.length;m<g;m++)Ce(v[m],t,n,i)}}function Ee(e,t,n,i){var r=e.opaque,a=e.transmissive,o=e.transparent;d.setupLightsView(n),a.length>0&&Pe(r,t,n),i&&H.viewport(w.copy(i)),r.length>0&&Le(r,t,n),a.length>0&&Le(a,t,n),o.length>0&&Le(o,t,n)}function Pe(e,t,n){if(null===z){var i=!0===o&&!0===V.isWebGL2;z=new(i?jm:Bm)(1024,1024,{generateMipmaps:!0,type:null!==le.convert(Gv)?Gv:Uv,minFilter:jv,magFilter:Bv,wrapS:zv,wrapT:zv})}var r=v.getRenderTarget();v.setRenderTarget(z),v.clear();var a=v.toneMapping;v.toneMapping=0,Le(e,t,n),v.toneMapping=a,q.updateMultisampleRenderTarget(z),q.updateRenderTargetMipmap(z),v.setRenderTarget(r)}function Le(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,u=o.geometry,l=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&Ae(s,t,n,u,l,c)}}function Ae(e,t,n,i,r,a){e.onBeforeRender(v,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(v,t,n,i,e,a),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,v.renderBufferDirect(n,t,i,r,e,a),r.side=0,r.needsUpdate=!0,v.renderBufferDirect(n,t,i,r,e,a),r.side=2):v.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(v,t,n,i,r,a)}function Ie(e,t,n){!0!==t.isScene&&(t=$);var i=G.get(e),r=d.state.lights,a=d.state.shadowsArray,o=r.state.version,s=Q.getParameters(e,r.state,a,t,n),u=Q.getProgramCacheKey(s),l=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?X:Z).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",ye),l=new Map,i.programs=l);var c=l.get(u);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===o)return Re(e,s),c}else s.uniforms=Q.getUniforms(e),e.onBuild(n,s,v),e.onBeforeCompile(s,v),c=Q.acquireProgram(s,u),l.set(u,c),i.uniforms=s.uniforms;var h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ie.uniform),Re(e,s),i.needsLights=Oe(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);var f=c.getUniforms(),p=ox.seqWithValue(f.seq,h);return i.currentProgram=c,i.uniformsList=p,c}function Re(e,t){var n=G.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}function Ne(e,t,n,i,r){!0!==t.isScene&&(t=$),q.resetTextureUnits();var a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===y?v.outputEncoding:y.texture.encoding,u=(i.isMeshStandardMaterial?X:Z).get(i.envMap||o),l=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,p=n.morphAttributes.position?n.morphAttributes.position.length:0,m=G.get(i),g=d.state.lights;if(!0===D&&(!0===O||e!==x)){var _=e===x&&i.id===b;ie.setState(i,e,_)}var w=!1;i.version===m.__version?m.needsLights&&m.lightsStateVersion!==g.state.version||m.outputEncoding!==s||r.isInstancedMesh&&!1===m.instancing?w=!0:r.isInstancedMesh||!0!==m.instancing?r.isSkinnedMesh&&!1===m.skinning?w=!0:r.isSkinnedMesh||!0!==m.skinning?m.envMap!==u||i.fog&&m.fog!==a?w=!0:void 0===m.numClippingPlanes||m.numClippingPlanes===ie.numPlanes&&m.numIntersection===ie.numIntersection?(m.vertexAlphas!==l||m.vertexTangents!==c||m.morphTargets!==h||m.morphNormals!==f||!0===V.isWebGL2&&m.morphTargetsCount!==p)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,m.__version=i.version);var k=m.currentProgram;!0===w&&(k=Ie(i,t,r));var S=!1,M=!1,E=!1,P=k.getUniforms(),L=m.uniforms;if(H.useProgram(k.program)&&(S=!0,M=!0,E=!0),i.id!==b&&(b=i.id,M=!0),S||x!==e){if(P.setValue(he,"projectionMatrix",e.projectionMatrix),V.logarithmicDepthBuffer&&P.setValue(he,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),x!==e&&(x=e,M=!0,E=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var A=P.map.cameraPosition;void 0!==A&&A.setValue(he,B.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(he,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&P.setValue(he,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){P.setOptional(he,r,"bindMatrix"),P.setOptional(he,r,"bindMatrixInverse");var I=r.skeleton;I&&(V.floatVertexTextures?(null===I.boneTexture&&I.computeBoneTexture(),P.setValue(he,"boneTexture",I.boneTexture,q),P.setValue(he,"boneTextureSize",I.boneTextureSize)):P.setOptional(he,I,"boneMatrices"))}return!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||oe.update(r,n,i,k),(M||m.receiveShadow!==r.receiveShadow)&&(m.receiveShadow=r.receiveShadow,P.setValue(he,"receiveShadow",r.receiveShadow)),M&&(P.setValue(he,"toneMappingExposure",v.toneMappingExposure),m.needsLights&&De(L,E),a&&i.fog&&ee.refreshFogUniforms(L,a),ee.refreshMaterialUniforms(L,i,C,T,z),ox.upload(he,m.uniformsList,L,q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ox.upload(he,m.uniformsList,L,q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&P.setValue(he,"center",r.center),P.setValue(he,"modelViewMatrix",r.modelViewMatrix),P.setValue(he,"normalMatrix",r.normalMatrix),P.setValue(he,"modelMatrix",r.matrixWorld),k}function De(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Oe(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Te.setAnimationLoop(ke),"undefined"!==typeof window&&Te.setContext(window),this.setAnimationLoop=function(e){we=e,me.setAnimationLoop(e),null===e?Te.stop():Te.start()},me.addEventListener("sessionstart",Se),me.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==m){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,y),(d=ne.get(e,p.length)).init(),p.push(d),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(F),O=this.localClippingEnabled,D=ie.init(this.clippingPlanes,O,t),(h=te.get(e,f.length)).init(),f.push(h),Ce(e,t,0,v.sortObjects),h.finish(),!0===v.sortObjects&&h.sort(E,P),!0===D&&ie.beginShadows();var n=d.state.shadowsArray;if(re.render(n,e,t),!0===D&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(h,e),d.setupLights(v.physicallyCorrectLights),t.isArrayCamera)for(var i=t.cameras,r=0,a=i.length;r<a;r++){var o=i[r];Ee(h,e,o,o.viewport)}else Ee(h,e,t);null!==y&&(q.updateMultisampleRenderTarget(y),q.updateRenderTargetMipmap(y)),!0===e.isScene&&e.onAfterRender(v,e,t),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),ce.resetDefaultState(),b=-1,x=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),h=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return y},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y=e,g=t,_=n,e&&void 0===G.get(e).__webglFramebuffer&&q.setupRenderTarget(e);var i=null,r=!1,a=!1;if(e){var o=e.texture;(o.isDataTexture3D||o.isDataTexture2DArray)&&(a=!0);var s=G.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=s[t],r=!0):i=e.isWebGLMultisampleRenderTarget?G.get(e).__webglMultisampledFramebuffer:s,w.copy(e.viewport),k.copy(e.scissor),S=e.scissorTest}else w.copy(L).multiplyScalar(C).floor(),k.copy(A).multiplyScalar(C).floor(),S=I;var u=H.bindFramebuffer(36160,i);if(u&&V.drawBuffers){var l=!1;if(e)if(e.isWebGLMultipleRenderTargets){var c=e.texture;if(R.length!==c.length||36064!==R[0]){for(var h=0,d=c.length;h<d;h++)R[h]=36064+h;R.length=c.length,l=!0}}else 1===R.length&&36064===R[0]||(R[0]=36064,R.length=1,l=!0);else 1===R.length&&1029===R[0]||(R[0]=1029,R.length=1,l=!0);l&&(V.isWebGL2?he.drawBuffers(R):U.get("WEBGL_draw_buffers").drawBuffersWEBGL(R))}if(H.viewport(w),H.scissor(k),H.setScissorTest(S),r){var f=G.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,f.__webglTexture,n)}else if(a){var p=G.get(e.texture),v=t||0;he.framebufferTextureLayer(36160,36064,p.__webglTexture,n||0,v)}b=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=G.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){H.bindFramebuffer(36160,s);try{var u=e.texture,l=u.format,c=u.type;if(l!==Xv&&le.convert(l)!==he.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=c===Gv&&(U.has("EXT_color_buffer_half_float")||V.isWebGL2&&U.has("EXT_color_buffer_float"));if(c!==Uv&&le.convert(c)!==he.getParameter(35738)&&(c!==Wv||!(V.isWebGL2||U.has("OES_texture_float")||U.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===he.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&he.readPixels(t,n,i,r,le.convert(l),le.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{var d=null!==y?G.get(y).__webglFramebuffer:null;H.bindFramebuffer(36160,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i),o=le.convert(t.format);V.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),q.setTexture2D(t,0),he.copyTexImage2D(3553,n,o,e.x,e.y,r,a,0),H.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,o=le.convert(n.format),s=le.convert(n.type);q.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):he.texSubImage2D(3553,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&he.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,l=le.convert(i.format),c=le.convert(i.type);if(i.isDataTexture3D)q.setTexture3D(i,0),a=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");q.setTexture2DArray(i,0),a=35866}he.pixelStorei(37440,i.flipY),he.pixelStorei(37441,i.premultiplyAlpha),he.pixelStorei(3317,i.unpackAlignment);var h=he.getParameter(3314),d=he.getParameter(32878),f=he.getParameter(3316),p=he.getParameter(3315),m=he.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;he.pixelStorei(3314,g.width),he.pixelStorei(32878,g.height),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?he.texSubImage3D(a,r,t.x,t.y,t.z,o,s,u,l,c,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),he.compressedTexSubImage3D(a,r,t.x,t.y,t.z,o,s,u,l,g.data)):he.texSubImage3D(a,r,t.x,t.y,t.z,o,s,u,l,c,g),he.pixelStorei(3314,h),he.pixelStorei(32878,d),he.pixelStorei(3316,f),he.pixelStorei(3315,p),he.pixelStorei(32877,m),0===r&&i.generateMipmaps&&he.generateMipmap(a),H.unbindTexture()}},this.initTexture=function(e){q.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){g=0,_=0,y=null,H.reset(),ce.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Jx.prototype.isWebGLRenderer=!0;var Qx=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n)}(Jx);Qx.prototype.isWebGL1Renderer=!0;var ew=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this)).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Ad(e)})),e}return $d(n,[{key:"copy",value:function(e,t){return Nd(kd(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(Wg);ew.prototype.isScene=!0;var tw=function(){function e(t,n){Fd(this,e),this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=hm,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xm()}return $d(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xm()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xm()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}();tw.prototype.isInterleavedBuffer=!0;var nw=new Vm,iw=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Fd(this,e),this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=!0===r}return $d(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)nw.x=this.getX(t),nw.y=this.getY(t),nw.z=this.getZ(t),nw.applyMatrix4(e),this.setXYZ(t,nw.x,nw.y,nw.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)nw.x=this.getX(t),nw.y=this.getY(t),nw.z=this.getZ(t),nw.applyNormalMatrix(e),this.setXYZ(t,nw.x,nw.y,nw.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)nw.x=this.getX(t),nw.y=this.getY(t),nw.z=this.getZ(t),nw.transformDirection(e),this.setXYZ(t,nw.x,nw.y,nw.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var n=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[r+a]);return new v_(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}();iw.prototype.isInterleavedBufferAttribute=!0;var rw,aw=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="SpriteMaterial",i.color=new h_(16777215),i.map=null,i.alphaMap=null,i.rotation=0,i.sizeAttenuation=!0,i.transparent=!0,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(r_);aw.prototype.isSpriteMaterial=!0;var ow=new Vm,sw=new Vm,uw=new Vm,lw=new Em,cw=new Em,hw=new bg,dw=new Vm,fw=new Vm,pw=new Vm,vw=new Em,mw=new Em,gw=new Em,_w=function(e){Dd(n,e);var t=Od(n);function n(e){var i;if(Fd(this,n),(i=t.call(this)).type="Sprite",void 0===rw){rw=new C_;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new tw(r,5);rw.setIndex([0,1,2,0,2,3]),rw.setAttribute("position",new iw(a,3,0,!1)),rw.setAttribute("uv",new iw(a,2,3,!1))}return i.geometry=rw,i.material=void 0!==e?e:new aw,i.center=new Em(.5,.5),i}return $d(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),sw.setFromMatrixScale(this.matrixWorld),hw.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),uw.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&sw.multiplyScalar(-uw.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;yw(dw.set(-.5,-.5,0),uw,a,sw,n,i),yw(fw.set(.5,-.5,0),uw,a,sw,n,i),yw(pw.set(.5,.5,0),uw,a,sw,n,i),vw.set(0,0),mw.set(1,0),gw.set(1,1);var o=e.ray.intersectTriangle(dw,fw,pw,!1,ow);if(null!==o||(yw(fw.set(-.5,.5,0),uw,a,sw,n,i),mw.set(0,1),null!==(o=e.ray.intersectTriangle(dw,pw,fw,!1,ow)))){var s=e.ray.origin.distanceTo(ow);s<e.near||s>e.far||t.push({distance:s,point:ow.clone(),uv:n_.getUV(ow,dw,fw,pw,vw,mw,gw,new Em),face:null,object:this})}}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(Wg);function yw(e,t,n,i,r,a){lw.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(cw.x=a*lw.x-r*lw.y,cw.y=r*lw.x+a*lw.y):cw.copy(lw),e.copy(t),e.x+=cw.x,e.y+=cw.y,e.applyMatrix4(hw)}_w.prototype.isSprite=!0;var bw=new Vm,xw=new Fm,ww=new Fm,kw=new Vm,Sw=new bg,Mw=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i)).type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new bg,r.bindMatrixInverse=new bg,r}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Fm,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){Nd(kd(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,i=this.geometry;xw.fromBufferAttribute(i.attributes.skinIndex,e),ww.fromBufferAttribute(i.attributes.skinWeight,e),bw.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var a=ww.getComponent(r);if(0!==a){var o=xw.getComponent(r);Sw.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(kw.copy(bw).applyMatrix4(Sw),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(W_);Mw.prototype.isSkinnedMesh=!0,function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this)).type="Bone",e}return $d(n)}(Wg).prototype.isBone=!0;var Tw=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Bv,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Bv,f=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;return Fd(this,n),(e=t.call(this,null,u,l,c,h,d,o,s,f,p)).image={data:i,width:r,height:a},e.magFilter=h,e.minFilter=d,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return $d(n)}(Om);Tw.prototype.isDataTexture=!0;var Cw=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Fd(this,n),"number"===typeof r&&(o=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(a=t.call(this,e,i,r)).meshPerAttribute=o,a}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(v_);Cw.prototype.isInstancedBufferAttribute=!0;var Ew=new bg,Pw=new bg,Lw=[],Aw=new W_,Iw=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i)).instanceMatrix=new Cw(new Float32Array(16*r),16),a.instanceColor=null,a.count=r,a.frustumCulled=!1,a}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,i=this.count;if(Aw.geometry=this.geometry,Aw.material=this.material,void 0!==Aw.material)for(var r=0;r<i;r++){this.getMatrixAt(r,Ew),Pw.multiplyMatrices(n,Ew),Aw.matrixWorld=Pw,Aw.raycast(e,Lw);for(var a=0,o=Lw.length;a<o;a++){var s=Lw[a];s.instanceId=r,s.object=this,t.push(s)}Lw.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new Cw(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(W_);Iw.prototype.isInstancedMesh=!0;var Rw=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="LineBasicMaterial",i.color=new h_(16777215),i.linewidth=1,i.linecap="round",i.linejoin="round",i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}]),n}(r_);Rw.prototype.isLineBasicMaterial=!0;var Nw=new Vm,Dw=new Vm,Ow=new bg,zw=new yg,Fw=new hg,Bw=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C_,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rw;return Fd(this,n),(e=t.call(this)).type="Line",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)Nw.fromBufferAttribute(t,i-1),Dw.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Nw.distanceTo(Dw);e.setAttribute("lineDistance",new y_(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Fw.copy(n.boundingSphere),Fw.applyMatrix4(i),Fw.radius+=r,!1!==e.ray.intersectsSphere(Fw)){Ow.copy(i).invert(),zw.copy(e.ray).applyMatrix4(Ow);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new Vm,l=new Vm,c=new Vm,h=new Vm,d=this.isLineSegments?2:1;if(n.isBufferGeometry){var f=n.index,p=n.attributes.position;if(null!==f)for(var v=Math.max(0,a.start),m=Math.min(f.count,a.start+a.count)-1;v<m;v+=d){var g=f.getX(v),_=f.getX(v+1);if(u.fromBufferAttribute(p,g),l.fromBufferAttribute(p,_),!(zw.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(h);y<e.near||y>e.far||t.push({distance:y,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var b=Math.max(0,a.start),x=Math.min(p.count,a.start+a.count)-1;b<x;b+=d){if(u.fromBufferAttribute(p,b),l.fromBufferAttribute(p,b+1),!(zw.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(Wg);Bw.prototype.isLine=!0;var $w=new Vm,jw=new Vm,Uw=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i)).type="LineSegments",r}return $d(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)$w.fromBufferAttribute(t,i),jw.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+$w.distanceTo(jw);e.setAttribute("lineDistance",new y_(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}]),n}(Bw);Uw.prototype.isLineSegments=!0,function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i)).type="LineLoop",r}return $d(n)}(Bw).prototype.isLineLoop=!0;var Vw=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="PointsMaterial",i.color=new h_(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(r_);Vw.prototype.isPointsMaterial=!0;var Hw=new bg,Ww=new yg,Gw=new hg,qw=new Vm,Zw=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C_,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vw;return Fd(this,n),(e=t.call(this)).type="Points",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Gw.copy(n.boundingSphere),Gw.applyMatrix4(i),Gw.radius+=r,!1!==e.ray.intersectsSphere(Gw)){Hw.copy(i).invert(),Ww.copy(e.ray).applyMatrix4(Hw);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){var u=n.index,l=n.attributes.position;if(null!==u)for(var c=Math.max(0,a.start),h=Math.min(u.count,a.start+a.count);c<h;c++){var d=u.getX(c);qw.fromBufferAttribute(l,d),Xw(qw,d,s,i,e,t,this)}else for(var f=Math.max(0,a.start),p=Math.min(l.count,a.start+a.count);f<p;f++)qw.fromBufferAttribute(l,f),Xw(qw,f,s,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(Wg);function Xw(e,t,n,i,r,a,o){var s=Ww.distanceSqToPoint(e);if(s<n){var u=new Vm;Ww.closestPointToPoint(e,u),u.applyMatrix4(i);var l=r.ray.origin.distanceTo(u);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:o})}}Zw.prototype.isPoints=!0;var Yw=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o,s,u,l,c){var h;Fd(this,n),(h=t.call(this,e,i,r,a,o,s,u,l,c)).format=void 0!==u?u:Zv,h.minFilter=void 0!==s?s:$v,h.magFilter=void 0!==o?o:$v,h.generateMipmaps=!1;var d=Ad(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){d.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return $d(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(Om);Yw.prototype.isVideoTexture=!0;var Kw=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o,s,u,l,c,h,d,f){var p;return Fd(this,n),(p=t.call(this,null,s,u,l,c,h,a,o,d,f)).image={width:i,height:r},p.mipmaps=e,p.flipY=!1,p.generateMipmaps=!1,p}return $d(n)}(Om);Kw.prototype.isCompressedTexture=!0;var Jw=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o,s,u,l,c){var h;return Fd(this,n),(h=t.call(this,e,i,r,a,o,s,u,l,c)).needsUpdate=!0,h}return $d(n)}(Om);Jw.prototype.isCanvasTexture=!0;var Qw=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o,s,u,l,c,h){var d;if(Fd(this,n),(h=void 0!==h?h:Yv)!==Yv&&h!==Kv)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&h===Yv&&(r=Vv),void 0===r&&h===Kv&&(r=qv),(d=t.call(this,null,a,o,s,u,l,h,r,c)).image={width:e,height:i},d.magFilter=void 0!==u?u:Bv,d.minFilter=void 0!==l?l:Bv,d.flipY=!1,d.generateMipmaps=!1,d}return $d(n)}(Om);Qw.prototype.isDepthTexture=!0;new Vm,new Vm,new Vm,new n_;var ek=function(){function e(){Fd(this,e),this.type="Curve",this.arcLengthDivisions=200}return $d(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)r+=(t=this.getPoint(a/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=i[r=Math.floor(s+(u-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){u=r;break}u=r-1}if(i[r=u]===n)return r/(a-1);var l=i[r];return(r+(n-l)/(i[r+1]-l))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new Em:new Vm);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Vm,i=[],r=[],a=[],o=new Vm,s=new bg,u=0;u<=e;u++){var l=u/e;i[u]=this.getTangentAt(l,new Vm)}r[0]=new Vm,a[0]=new Vm;var c=Number.MAX_VALUE,h=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),f<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var p=1;p<=e;p++){if(r[p]=r[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(i[p-1],i[p]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(wm(i[p-1].dot(i[p]),-1,1));r[p].applyMatrix4(s.makeRotationAxis(o,v))}a[p].crossVectors(i[p],r[p])}if(!0===t){var m=Math.acos(wm(r[0].dot(r[e]),-1,1));m/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(m=-m);for(var g=1;g<=e;g++)r[g].applyMatrix4(s.makeRotationAxis(i[g],m*g)),a[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),tk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return Fd(this,n),(e=t.call(this)).type="EllipseCurve",e.aX=i,e.aY=r,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=u,e.aClockwise=l,e.aRotation=c,e}return $d(n,[{key:"getPoint",value:function(e,t){for(var n=t||new Em,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=u-this.aY;s=h*l-d*c+this.aX,u=h*c+d*l+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(ek);tk.prototype.isEllipseCurve=!0;var nk=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o,s){var u;return Fd(this,n),(u=t.call(this,e,i,r,r,a,o,s)).type="ArcCurve",u}return $d(n)}(tk);function ik(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var u=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,u*=o,l*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}nk.prototype.isArcCurve=!0;var rk=new Vm,ak=new ik,ok=new ik,sk=new ik,uk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return Fd(this,n),(e=t.call(this)).type="CatmullRomCurve3",e.points=i,e.closed=r,e.curveType=a,e.tension=o,e}return $d(n,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,r=i,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,u=Math.floor(s),l=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===l&&u===o-1&&(u=o-2,l=1),this.closed||u>0?t=a[(u-1)%o]:(rk.subVectors(a[0],a[1]).add(a[0]),t=rk);var c=a[u%o],h=a[(u+1)%o];if(this.closed||u+2<o?n=a[(u+2)%o]:(rk.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=rk),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(t.distanceToSquared(c),d),p=Math.pow(c.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(n),d);p<1e-4&&(p=1),f<1e-4&&(f=p),v<1e-4&&(v=p),ak.initNonuniformCatmullRom(t.x,c.x,h.x,n.x,f,p,v),ok.initNonuniformCatmullRom(t.y,c.y,h.y,n.y,f,p,v),sk.initNonuniformCatmullRom(t.z,c.z,h.z,n.z,f,p,v)}else"catmullrom"===this.curveType&&(ak.initCatmullRom(t.x,c.x,h.x,n.x,this.tension),ok.initCatmullRom(t.y,c.y,h.y,n.y,this.tension),sk.initCatmullRom(t.z,c.z,h.z,n.z,this.tension));return r.set(ak.calc(l),ok.calc(l),sk.calc(l)),r}},{key:"copy",value:function(e){Nd(kd(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vm).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(ek);function lk(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function ck(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function hk(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}uk.prototype.isCatmullRomCurve3=!0;var dk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Em,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Em,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Em;return Fd(this,n),(e=t.call(this)).type="CubicBezierCurve",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(hk(e,i.x,r.x,a.x,o.x),hk(e,i.y,r.y,a.y,o.y)),n}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(ek);dk.prototype.isCubicBezierCurve=!0;var fk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vm,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Vm;return Fd(this,n),(e=t.call(this)).type="CubicBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(hk(e,i.x,r.x,a.x,o.x),hk(e,i.y,r.y,a.y,o.y),hk(e,i.z,r.z,a.z,o.z)),n}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(ek);fk.prototype.isCubicBezierCurve3=!0;var pk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Em,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em;return Fd(this,n),(e=t.call(this)).type="LineCurve",e.v1=i,e.v2=r,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new Em;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(ek);pk.prototype.isLineCurve=!0;var vk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm;return Fd(this,n),(e=t.call(this)).type="LineCurve3",e.isLineCurve3=!0,e.v1=i,e.v2=r,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(ek),mk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Em,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Em;return Fd(this,n),(e=t.call(this)).type="QuadraticBezierCurve",e.v0=i,e.v1=r,e.v2=a,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(ck(e,i.x,r.x,a.x),ck(e,i.y,r.y,a.y)),n}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(ek);mk.prototype.isQuadraticBezierCurve=!0;var gk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vm,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vm;return Fd(this,n),(e=t.call(this)).type="QuadraticBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vm,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(ck(e,i.x,r.x,a.x),ck(e,i.y,r.y,a.y),ck(e,i.z,r.z,a.z)),n}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(ek);gk.prototype.isQuadraticBezierCurve3=!0;var _k=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Fd(this,n),(e=t.call(this)).type="SplineCurve",e.points=i,e}return $d(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Em,n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],u=i[a],l=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return n.set(lk(o,s.x,u.x,l.x,c.x),lk(o,s.y,u.y,l.y,c.y)),n}},{key:"copy",value:function(e){Nd(kd(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e}},{key:"fromJSON",value:function(e){Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Em).fromArray(r))}return this}}]),n}(ek);_k.prototype.isSplineCurve=!0;var yk=Object.freeze({__proto__:null,ArcCurve:nk,CatmullRomCurve3:uk,CubicBezierCurve:dk,CubicBezierCurve3:fk,EllipseCurve:tk,LineCurve:pk,LineCurve3:vk,QuadraticBezierCurve:mk,QuadraticBezierCurve3:gk,SplineCurve:_k}),bk=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return $d(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new pk(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var a=i[r]-n,o=this.curves[r],s=o.getLength(),u=0===s?0:1-a/s;return o.getPointAt(u,t)}r++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),u=0;u<s.length;u++){var l=s[u];e&&e.equals(l)||(n.push(l),e=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){Nd(kd(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new yk[r.type]).fromJSON(r))}return this}}]),n}(ek),xk=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="Path",i.currentPoint=new Em,e&&i.setFromPoints(e),i}return $d(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new pk(this.currentPoint.clone(),new Em(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new mk(this.currentPoint.clone(),new Em(e,t),new Em(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new dk(this.currentPoint.clone(),new Em(e,t),new Em(n,i),new Em(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new _k(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+u,t+l,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var u=new tk(e,t,n,i,r,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(bk),wk=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e)).uuid=xm(),i.type="Shape",i.holes=[],i}return $d(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){Nd(kd(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){Nd(kd(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new xk).fromJSON(r))}return this}}]),n}(xk),kk=function(e,t){var n,i,r,a,o,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*l:e.length,d=Sk(e,0,h,l,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=Ak(e,t,d,l)),e.length>80*l){n=r=e[0],i=a=e[1];for(var p=l;p<h;p+=l)(o=e[p])<n&&(n=o),(s=e[p+1])<i&&(i=s),o>r&&(r=o),s>a&&(a=s);u=0!==(u=Math.max(r-n,a-i))?1/u:0}return Tk(d,f,l,n,i,u),f};function Sk(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=Gk(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=Gk(a,e[a],e[a+1],o);return o&&$k(o,o.next)&&(qk(o),o=o.next),o}function Mk(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!$k(i,i.next)&&0!==Bk(i.prev,i,i.next))i=i.next;else{if(qk(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Tk(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Dk(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(e,i,r,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?Ek(e,i,r,a):Ck(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),qk(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?Tk(e=Pk(Mk(e),t,n),t,n,i,r,a,2):2===o&&Lk(e,t,n,i,r,a):Tk(Mk(e),t,n,i,r,a,1);break}}}function Ck(e){var t=e.prev,n=e,i=e.next;if(Bk(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(zk(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Bk(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Ek(e,t,n,i){var r=e.prev,a=e,o=e.next;if(Bk(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=Dk(s,u,t,n,i),d=Dk(l,c,t,n,i),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&zk(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Bk(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&zk(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Bk(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&zk(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Bk(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&zk(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Bk(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Pk(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!$k(r,a)&&jk(r,i,i.next,a)&&Hk(r,a)&&Hk(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),qk(i),qk(i.next),i=e=a),i=i.next}while(i!==e);return Mk(i)}function Lk(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Fk(o,s)){var u=Wk(o,s);return o=Mk(o,o.next),u=Mk(u,u.next),Tk(o,t,n,i,r,a),void Tk(u,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function Ak(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=Sk(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(Ok(o));for(s.sort(Ik),r=0;r<s.length;r++)Rk(s[r],n),n=Mk(n,n.next);return n}function Ik(e,t){return e.x-t.x}function Rk(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var u,l=n,c=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&zk(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(r-i.x),Hk(i,e)&&(u<d||u===d&&(i.x>n.x||i.x===n.x&&Nk(n,i)))&&(n=i,d=u)),i=i.next}while(i!==l);return n}(e,t),t){var n=Wk(t,e);Mk(t,t.next),Mk(n,n.next)}}function Nk(e,t){return Bk(e.prev,e,t.prev)<0&&Bk(t.next,e,e.next)<0}function Dk(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ok(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function zk(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function Fk(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&jk(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Hk(e,t)&&Hk(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Bk(e.prev,e,t.prev)||Bk(e,t.prev,t))||$k(e,t)&&Bk(e.prev,e,e.next)>0&&Bk(t.prev,t,t.next)>0)}function Bk(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function $k(e,t){return e.x===t.x&&e.y===t.y}function jk(e,t,n,i){var r=Vk(Bk(e,t,n)),a=Vk(Bk(e,t,i)),o=Vk(Bk(n,i,e)),s=Vk(Bk(n,i,t));return r!==a&&o!==s||(!(0!==r||!Uk(e,n,t))||(!(0!==a||!Uk(e,i,t))||(!(0!==o||!Uk(n,e,i))||!(0!==s||!Uk(n,t,i)))))}function Uk(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Vk(e){return e>0?1:e<0?-1:0}function Hk(e,t){return Bk(e.prev,e,e.next)<0?Bk(e,t,e.next)>=0&&Bk(e,e.prev,t)>=0:Bk(e,t,e.prev)<0||Bk(e,e.next,t)<0}function Wk(e,t){var n=new Zk(e.i,e.x,e.y),i=new Zk(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Gk(e,t,n,i){var r=new Zk(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function qk(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Zk(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Xk=function(){function e(){Fd(this,e)}return $d(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];Yk(e),Kk(n,e);var a=e.length;t.forEach(Yk);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,Kk(n,t[o]);for(var s=kk(n,i),u=0;u<s.length;u+=3)r.push(s.slice(u,u+3));return r}}]),e}();function Yk(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Kk(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Jk=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wk([new Em(.5,.5),new Em(-.5,.5),new Em(-.5,-.5),new Em(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Fd(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:i,options:r},i=Array.isArray(i)?i:[i];for(var a=Ad(e),o=[],s=[],u=0,l=i.length;u<l;u++){var c=i[u];h(c)}function h(e){var t=[],n=void 0!==r.curveSegments?r.curveSegments:12,i=void 0!==r.steps?r.steps:1,u=void 0!==r.depth?r.depth:1,l=void 0===r.bevelEnabled||r.bevelEnabled,c=void 0!==r.bevelThickness?r.bevelThickness:.2,h=void 0!==r.bevelSize?r.bevelSize:c-.1,d=void 0!==r.bevelOffset?r.bevelOffset:0,f=void 0!==r.bevelSegments?r.bevelSegments:3,p=r.extrudePath,v=void 0!==r.UVGenerator?r.UVGenerator:Qk;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=r.amount);var m,g,_,y,b,x=!1;p&&(m=p.getSpacedPoints(i),x=!0,l=!1,g=p.computeFrenetFrames(i,!1),_=new Vm,y=new Vm,b=new Vm),l||(f=0,c=0,h=0,d=0);var w=e.extractPoints(n),k=w.shape,S=w.holes;if(!Xk.isClockWise(k)){k=k.reverse();for(var M=0,T=S.length;M<T;M++){var C=S[M];Xk.isClockWise(C)&&(S[M]=C.reverse())}}for(var E=Xk.triangulateShape(k,S),P=k,L=0,A=S.length;L<A;L++){var I=S[L];k=k.concat(I)}function R(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var N=k.length,D=E.length;function O(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,u=n.x-e.x,l=n.y-e.y,c=o*o+s*s,h=o*l-s*u;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(u*u+l*l),p=t.x-s/d,v=t.y+o/d,m=((n.x-l/f-p)*l-(n.y+u/f-v)*u)/(o*l-s*u),g=(i=p+o*m-e.x)*i+(r=v+s*m-e.y)*r;if(g<=2)return new Em(i,r);a=Math.sqrt(g/2)}else{var _=!1;o>Number.EPSILON?u>Number.EPSILON&&(_=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(_=!0):Math.sign(s)===Math.sign(l)&&(_=!0),_?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new Em(i/a,r/a)}for(var z=[],F=0,B=P.length,$=B-1,j=F+1;F<B;F++,$++,j++)$===B&&($=0),j===B&&(j=0),z[F]=O(P[F],P[$],P[j]);for(var U,V=[],H=z.concat(),W=0,G=S.length;W<G;W++){var q=S[W];U=[];for(var Z=0,X=q.length,Y=X-1,K=Z+1;Z<X;Z++,Y++,K++)Y===X&&(Y=0),K===X&&(K=0),U[Z]=O(q[Z],q[Y],q[K]);V.push(U),H=H.concat(U)}for(var J=0;J<f;J++){for(var Q=J/f,ee=c*Math.cos(Q*Math.PI/2),te=h*Math.sin(Q*Math.PI/2)+d,ne=0,ie=P.length;ne<ie;ne++){var re=R(P[ne],z[ne],te);Ae(re.x,re.y,-ee)}for(var ae=0,oe=S.length;ae<oe;ae++){var se=S[ae];U=V[ae];for(var ue=0,le=se.length;ue<le;ue++){var ce=R(se[ue],U[ue],te);Ae(ce.x,ce.y,-ee)}}}for(var he=h+d,de=0;de<N;de++){var fe=l?R(k[de],H[de],he):k[de];x?(y.copy(g.normals[0]).multiplyScalar(fe.x),_.copy(g.binormals[0]).multiplyScalar(fe.y),b.copy(m[0]).add(y).add(_),Ae(b.x,b.y,b.z)):Ae(fe.x,fe.y,0)}for(var pe=1;pe<=i;pe++)for(var ve=0;ve<N;ve++){var me=l?R(k[ve],H[ve],he):k[ve];x?(y.copy(g.normals[pe]).multiplyScalar(me.x),_.copy(g.binormals[pe]).multiplyScalar(me.y),b.copy(m[pe]).add(y).add(_),Ae(b.x,b.y,b.z)):Ae(me.x,me.y,u/i*pe)}for(var ge=f-1;ge>=0;ge--){for(var _e=ge/f,ye=c*Math.cos(_e*Math.PI/2),be=h*Math.sin(_e*Math.PI/2)+d,xe=0,we=P.length;xe<we;xe++){var ke=R(P[xe],z[xe],be);Ae(ke.x,ke.y,u+ye)}for(var Se=0,Me=S.length;Se<Me;Se++){var Te=S[Se];U=V[Se];for(var Ce=0,Ee=Te.length;Ce<Ee;Ce++){var Pe=R(Te[Ce],U[Ce],be);x?Ae(Pe.x,Pe.y+m[i-1].y,m[i-1].x+ye):Ae(Pe.x,Pe.y,u+ye)}}}function Le(e,t){for(var n=e.length;--n>=0;){var r=n,a=n-1;a<0&&(a=e.length-1);for(var o=0,s=i+2*f;o<s;o++){var u=N*o,l=N*(o+1);Re(t+r+u,t+a+u,t+a+l,t+r+l)}}}function Ae(e,n,i){t.push(e),t.push(n),t.push(i)}function Ie(e,t,n){Ne(e),Ne(t),Ne(n);var i=o.length/3,r=v.generateTopUV(a,o,i-3,i-2,i-1);De(r[0]),De(r[1]),De(r[2])}function Re(e,t,n,i){Ne(e),Ne(t),Ne(i),Ne(t),Ne(n),Ne(i);var r=o.length/3,s=v.generateSideWallUV(a,o,r-6,r-3,r-2,r-1);De(s[0]),De(s[1]),De(s[3]),De(s[1]),De(s[2]),De(s[3])}function Ne(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function De(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(l){for(var t=0,n=N*t,r=0;r<D;r++){var s=E[r];Ie(s[2]+n,s[1]+n,s[0]+n)}n=N*(t=i+2*f);for(var u=0;u<D;u++){var c=E[u];Ie(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<D;h++){var d=E[h];Ie(d[2],d[1],d[0])}for(var p=0;p<D;p++){var v=E[p];Ie(v[0]+N*i,v[1]+N*i,v[2]+N*i)}}a.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Le(P,t),t+=P.length;for(var n=0,i=S.length;n<i;n++){var r=S[n];Le(r,t),t+=r.length}a.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new y_(o,3)),e.setAttribute("uv",new y_(s,2)),e.computeVertexNormals(),e}return $d(n,[{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new yk[s.type]).fromJSON(s)),new n(i,e.options)}}]),n}(C_),Qk={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],u=t[3*i+1],l=t[3*r],c=t[3*r+1];return[new Em(a,o),new Em(s,u),new Em(l,c)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],u=t[3*n+2],l=t[3*i],c=t[3*i+1],h=t[3*i+2],d=t[3*r],f=t[3*r+1],p=t[3*r+2],v=t[3*a],m=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<Math.abs(o-l)?[new Em(o,1-u),new Em(l,1-h),new Em(d,1-p),new Em(v,1-g)]:[new Em(s,1-u),new Em(c,1-h),new Em(f,1-p),new Em(m,1-g)]}};var eS=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wk([new Em(0,.5),new Em(-.5,-.5),new Em(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Fd(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:i,curveSegments:r};var a=[],o=[],s=[],u=[],l=0,c=0;if(!1===Array.isArray(i))d(i);else for(var h=0;h<i.length;h++)d(i[h]),e.addGroup(l,c,h),l+=c,c=0;function d(e){var t=o.length/3,n=e.extractPoints(r),i=n.shape,l=n.holes;!1===Xk.isClockWise(i)&&(i=i.reverse());for(var h=0,d=l.length;h<d;h++){var f=l[h];!0===Xk.isClockWise(f)&&(l[h]=f.reverse())}for(var p=Xk.triangulateShape(i,l),v=0,m=l.length;v<m;v++){var g=l[v];i=i.concat(g)}for(var _=0,y=i.length;_<y;_++){var b=i[_];o.push(b.x,b.y,0),s.push(0,0,1),u.push(b.x,b.y)}for(var x=0,w=p.length;x<w;x++){var k=p[x],S=k[0]+t,M=k[1]+t,T=k[2]+t;a.push(S,M,T),c+=3}}return e.setIndex(a),e.setAttribute("position",new y_(o,3)),e.setAttribute("normal",new y_(s,3)),e.setAttribute("uv",new y_(u,2)),e}return $d(n,[{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}return new n(i,e.curveSegments)}}]),n}(C_);var tS=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;Fd(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:i,widthSegments:r,heightSegments:a,phiStart:o,phiLength:s,thetaStart:u,thetaLength:l},r=Math.max(3,Math.floor(r)),a=Math.max(2,Math.floor(a));for(var c=Math.min(u+l,Math.PI),h=0,d=[],f=new Vm,p=new Vm,v=[],m=[],g=[],_=[],y=0;y<=a;y++){var b=[],x=y/a,w=0;0==y&&0==u?w=.5/r:y==a&&c==Math.PI&&(w=-.5/r);for(var k=0;k<=r;k++){var S=k/r;f.x=-i*Math.cos(o+S*s)*Math.sin(u+x*l),f.y=i*Math.cos(u+x*l),f.z=i*Math.sin(o+S*s)*Math.sin(u+x*l),m.push(f.x,f.y,f.z),p.copy(f).normalize(),g.push(p.x,p.y,p.z),_.push(S+w,1-x),b.push(h++)}d.push(b)}for(var M=0;M<a;M++)for(var T=0;T<r;T++){var C=d[M][T+1],E=d[M][T],P=d[M+1][T],L=d[M+1][T+1];(0!==M||u>0)&&v.push(C,E,L),(M!==a-1||c<Math.PI)&&v.push(E,P,L)}return e.setIndex(v),e.setAttribute("position",new y_(m,3)),e.setAttribute("normal",new y_(g,3)),e.setAttribute("uv",new y_(_,2)),e}return $d(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(C_);(function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="ShadowMaterial",i.color=new h_(0),i.transparent=!0,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this}}]),n})(r_).prototype.isShadowMaterial=!0;var nS=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new h_(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new h_(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Em(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(r_);nS.prototype.isMeshStandardMaterial=!0;var iS=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).defines={STANDARD:"",PHYSICAL:""},i.type="MeshPhysicalMaterial",i.clearcoatMap=null,i.clearcoatRoughness=0,i.clearcoatRoughnessMap=null,i.clearcoatNormalScale=new Em(1,1),i.clearcoatNormalMap=null,i.ior=1.5,Object.defineProperty(Ad(i),"reflectivity",{get:function(){return wm(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),i.sheenColor=new h_(0),i.sheenColorMap=null,i.sheenRoughness=1,i.sheenRoughnessMap=null,i.transmissionMap=null,i.thickness=.01,i.thicknessMap=null,i.attenuationDistance=0,i.attenuationColor=new h_(1,1,1),i.specularIntensity=1,i.specularIntensityMap=null,i.specularColor=new h_(1,1,1),i.specularColorMap=null,i._sheen=0,i._clearcoat=0,i._transmission=0,i.setValues(e),i}return $d(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(nS);iS.prototype.isMeshPhysicalMaterial=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="MeshPhongMaterial",i.color=new h_(16777215),i.specular=new h_(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new h_(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Em(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(r_).prototype.isMeshPhongMaterial=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).defines={TOON:""},i.type="MeshToonMaterial",i.color=new h_(16777215),i.map=null,i.gradientMap=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new h_(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Em(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(r_).prototype.isMeshToonMaterial=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="MeshNormalMaterial",i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Em(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.flatShading=!1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(r_).prototype.isMeshNormalMaterial=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="MeshLambertMaterial",i.color=new h_(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new h_(0),i.emissiveIntensity=1,i.emissiveMap=null,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(r_).prototype.isMeshLambertMaterial=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).defines={MATCAP:""},i.type="MeshMatcapMaterial",i.color=new h_(16777215),i.matcap=null,i.map=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Em(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.flatShading=!1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}]),n}(r_).prototype.isMeshMatcapMaterial=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="LineDashedMaterial",i.scale=1,i.dashSize=3,i.gapSize=1,i.setValues(e),i}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(Rw).prototype.isLineDashedMaterial=!0;var rS={arraySlice:function(e,t,n){return rS.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,u=0;u!==t;++u)r[o++]=e[s+u];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}},subclip:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var u=a.tracks[s],l=u.getValueSize(),c=[],h=[],d=0;d<u.times.length;++d){var f=u.times[d]*r;if(!(f<n||f>=i)){c.push(u.times[d]);for(var p=0;p<l;++p)h.push(u.values[d*l+p])}}0!==c.length&&(u.times=rS.convertArray(c,u.times.constructor),u.values=rS.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;for(var v=1/0,m=0;m<a.tracks.length;++m)v>a.tracks[m].times[0]&&(v=a.tracks[m].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*v);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);for(var r=n.tracks.length,a=t/i,o=function(t){var i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)return"continue";var o=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===o)return"continue";var s=0,u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);var l=0,c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);var h=i.times.length-1,d=void 0;if(a<=i.times[0]){var f=s,p=u-s;d=rS.arraySlice(i.values,f,p)}else if(a>=i.times[h]){var v=h*u+s,m=v+u-s;d=rS.arraySlice(i.values,v,m)}else{var g=i.createInterpolant(),_=s,y=u-s;g.evaluate(a),d=rS.arraySlice(g.resultBuffer,_,y)}"quaternion"===r&&(new Um).fromArray(d).normalize().conjugate().toArray(d);for(var b=o.times.length,x=0;x<b;++x){var w=x*c+l;if("quaternion"===r)Um.multiplyQuaternionsFlat(o.values,w,d,0,o.values,w);else for(var k=c-2*l,S=0;S<k;++S)o.values[w+S]-=d[S]}},s=0;s<r;++s)o(s);return e.blendMode=am,e}},aS=function(){function e(t,n,i,r){Fd(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return $d(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var u=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===u)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}();aS.prototype.beforeStart_=aS.prototype.copySampleValue_,aS.prototype.afterEnd_=aS.prototype.copySampleValue_;var oS=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:tm,endingEnd:tm},o}return $d(n,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case nm:r=e,o=2*t-n;break;case im:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case nm:a=e,s=2*n-t;break;case im:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=r*l,this._offsetNext=a*l}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(i-t),p=f*f,v=p*f,m=-h*v+2*h*p-h*f,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*f+1,_=(-1-d)*v+(1.5+d)*p+.5*f,y=d*v-d*p,b=0;b!==o;++b)r[b]=m*a[l+b]+g*a[u+b]+_*a[s+b]+y*a[c+b];return r}}]),n}(aS),sS=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){return Fd(this,n),t.call(this,e,i,r,a)}return $d(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(i-t),c=1-l,h=0;h!==o;++h)r[h]=a[u+h]*c+a[s+h]*l;return r}}]),n}(aS),uS=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){return Fd(this,n),t.call(this,e,i,r,a)}return $d(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(aS),lS=function(){function e(t,n,i,r){if(Fd(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=rS.convertArray(n,this.TimeBufferType),this.values=rS.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}return $d(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new uS(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new sS(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new oS(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case Jv:t=this.InterpolantFactoryMethodDiscrete;break;case Qv:t=this.InterpolantFactoryMethodLinear;break;case em:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Jv;case this.InterpolantFactoryMethodLinear:return Qv;case this.InterpolantFactoryMethodSmooth:return em}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=rS.arraySlice(n,r,a),this.values=rS.arraySlice(this.values,r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&rS.isTypedArray(i))for(var u=0,l=i.length;u!==l;++u){var c=i[u];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=rS.arraySlice(this.times),t=rS.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===em,r=e.length-1,a=1,o=1;o<r;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(i)s=!0;else for(var l=o*n,c=l-n,h=l+n,d=0;d!==n;++d){var f=t[l+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,v=a*n,m=0;m!==n;++m)t[v+m]=t[p+m]}++a}}if(r>0){e[a]=e[r];for(var g=r*n,_=a*n,y=0;y!==n;++y)t[_+y]=t[g+y];++a}return a!==e.length?(this.times=rS.arraySlice(e,0,a),this.values=rS.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=rS.arraySlice(this.times,0),t=rS.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:rS.convertArray(e.times,Array),values:rS.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();lS.prototype.TimeBufferType=Float32Array,lS.prototype.ValueBufferType=Float32Array,lS.prototype.DefaultInterpolation=Qv;var cS=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n)}(lS);cS.prototype.ValueTypeName="bool",cS.prototype.ValueBufferType=Array,cS.prototype.DefaultInterpolation=Jv,cS.prototype.InterpolantFactoryMethodLinear=void 0,cS.prototype.InterpolantFactoryMethodSmooth=void 0;var hS=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n)}(lS);hS.prototype.ValueTypeName="color";var dS=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n)}(lS);dS.prototype.ValueTypeName="number";var fS=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){return Fd(this,n),t.call(this,e,i,r,a)}return $d(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),u=e*o,l=u+o;u!==l;u+=4)Um.slerpFlat(r,0,a,u-o,a,u,s);return r}}]),n}(aS),pS=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new fS(this.times,this.values,this.getValueSize(),e)}}]),n}(lS);pS.prototype.ValueTypeName="quaternion",pS.prototype.DefaultInterpolation=Qv,pS.prototype.InterpolantFactoryMethodSmooth=void 0;var vS=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n)}(lS);vS.prototype.ValueTypeName="string",vS.prototype.ValueBufferType=Array,vS.prototype.DefaultInterpolation=Jv,vS.prototype.InterpolantFactoryMethodLinear=void 0,vS.prototype.InterpolantFactoryMethodSmooth=void 0;var mS=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n)}(lS);mS.prototype.ValueTypeName="vector";var gS=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rm;Fd(this,e),this.name=t,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=xm(),this.duration<0&&this.resetDuration()}return $d(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(_S(n[r]).scale(i));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,a=n.length;r!==a;++r)t.push(lS.toJSON(n[r]));return i}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],u=[];s.push((o+r-1)%r,o,(o+1)%r),u.push(0,1,0);var l=rS.getKeyframeOrder(s);s=rS.sortedArray(s,1,l),u=rS.sortedArray(u,1,l),i||0!==s[0]||(s.push(r),u.push(u[0])),a.push(new dS(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],u=s.name.match(r);if(u&&u.length>1){var l=u[1],c=i[l];c||(i[l]=c=[]),c.push(s)}}var h=[];for(var d in i)h.push(this.CreateFromMorphTargetSequence(d,i[d],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];rS.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,u=e.hierarchy||[],l=0;l<u.length;l++){var c=u[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},d=void 0;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(var f=0;f<c[d].morphTargets.length;f++)h[c[d].morphTargets[f]]=-1;for(var p in h){for(var v=[],m=[],g=0;g!==c[d].morphTargets.length;++g){var _=c[d];v.push(_.time),m.push(_.morphTarget===p?1:0)}i.push(new dS(".morphTargetInfluence["+p+"]",v,m))}s=h.length*(a||1)}else{var y=".bones["+t[l].name+"]";n(mS,y+".position",c,"pos",i),n(pS,y+".quaternion",c,"rot",i),n(mS,y+".scale",c,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}}]),e}();function _S(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dS;case"vector":case"vector2":case"vector3":case"vector4":return mS;case"color":return hS;case"quaternion":return pS;case"bool":case"boolean":return cS;case"string":return vS}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];rS.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var yS={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},bS=$d((function e(t,n,i){Fd(this,e);var r=this,a=!1,o=0,s=0,u=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return u?u(e):e},this.setURLModifier=function(e){return u=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}})),xS=new bS,wS=function(){function e(t){Fd(this,e),this.manager=void 0!==t?t:xS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return $d(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),kS={},SS=function(e){Dd(n,e);var t=Od(n);function n(e){return Fd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,i){var r=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=yS.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;if(void 0===kS[e]){kS[e]=[],kS[e].push({onLoad:t,onProgress:n,onError:i});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(o).then((function(t){if(200===t.status||0===t.status){0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");var n=kS[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),a=r?parseInt(r):0,o=0!==a,s=0;return new ReadableStream({start:function(e){!function t(){i.read().then((function(i){var r=i.done,u=i.value;if(r)e.close();else{s+=u.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),c=0,h=n.length;c<h;c++){var d=n[c];d.onProgress&&d.onProgress(l)}e.enqueue(u),t()}}))}()}})}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){var t=new Response(e);switch(r.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((function(e){return(new DOMParser).parseFromString(e,r.mimeType)}));case"json":return t.json();default:return t.text()}})).then((function(t){yS.add(e,t);var n=kS[e];delete kS[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onLoad&&o.onLoad(t)}r.manager.itemEnd(e)})).catch((function(t){var n=kS[e];delete kS[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)})),this.manager.itemStart(e)}else kS[e].push({onLoad:t,onProgress:n,onError:i})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(wS),MS=function(e){Dd(n,e);var t=Od(n);function n(e){return Fd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=yS.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o=Im("img");function s(){l(),yS.add(e,this),t&&t(this),r.manager.itemEnd(e)}function u(t){l(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function l(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),n}(wS),TS=function(e){Dd(n,e);var t=Od(n);function n(e){return Fd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,i){var r=new ny,a=new MS(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(var u=0;u<e.length;++u)s(u);return r}}]),n}(wS),CS=function(e){Dd(n,e);var t=Od(n);function n(e){return Fd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,i){var r=new Om,a=new MS(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}]),n}(wS),ES=function(e){Dd(n,e);var t=Od(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Fd(this,n),(i=t.call(this)).type="Light",i.color=new h_(e),i.intensity=r,i}return $d(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(Wg);ES.prototype.isLight=!0,function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,r)).type="HemisphereLight",a.position.copy(Wg.DefaultUp),a.updateMatrix(),a.groundColor=new h_(i),a}return $d(n,[{key:"copy",value:function(e){return ES.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}]),n}(ES).prototype.isHemisphereLight=!0;var PS=new bg,LS=new Vm,AS=new Vm,IS=function(){function e(t){Fd(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Em(512,512),this.map=null,this.mapPass=null,this.matrix=new bg,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cy,this._frameExtents=new Em(1,1),this._viewportCount=1,this._viewports=[new Fm(0,0,1,1)]}return $d(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;LS.setFromMatrixPosition(e.matrixWorld),t.position.copy(LS),AS.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(AS),t.updateMatrixWorld(),PS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PS),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),RS=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this,new Q_(50,1,.5,500))).focus=1,e}return $d(n,[{key:"updateMatrices",value:function(e){var t=this.camera,i=2*gm*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;i===t.fov&&r===t.aspect&&a===t.far||(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),Nd(kd(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(IS);RS.prototype.isSpotLightShadow=!0;var NS=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Fd(this,n),(r=t.call(this,e,i)).type="SpotLight",r.position.copy(Wg.DefaultUp),r.updateMatrix(),r.target=new Wg,r.distance=a,r.angle=o,r.penumbra=s,r.decay=u,r.shadow=new RS,r}return $d(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(ES);NS.prototype.isSpotLight=!0;var DS=new bg,OS=new Vm,zS=new Vm,FS=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this,new Q_(90,1,.5,500)))._frameExtents=new Em(4,2),e._viewportCount=6,e._viewports=[new Fm(2,1,1,1),new Fm(0,1,1,1),new Fm(3,1,1,1),new Fm(1,1,1,1),new Fm(3,0,1,1),new Fm(1,0,1,1)],e._cubeDirections=[new Vm(1,0,0),new Vm(-1,0,0),new Vm(0,0,1),new Vm(0,0,-1),new Vm(0,1,0),new Vm(0,-1,0)],e._cubeUps=[new Vm(0,1,0),new Vm(0,1,0),new Vm(0,1,0),new Vm(0,1,0),new Vm(0,0,1),new Vm(0,0,-1)],e}return $d(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),OS.setFromMatrixPosition(e.matrixWorld),n.position.copy(OS),zS.copy(n.position),zS.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(zS),n.updateMatrixWorld(),i.makeTranslation(-OS.x,-OS.y,-OS.z),DS.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DS)}}]),n}(IS);FS.prototype.isPointLightShadow=!0;var BS=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Fd(this,n),(r=t.call(this,e,i)).type="PointLight",r.distance=a,r.decay=o,r.shadow=new FS,r}return $d(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(ES);BS.prototype.isPointLight=!0;var $S=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.call(this,new ky(-5,5,5,-5,.5,500))}return $d(n)}(IS);$S.prototype.isDirectionalLightShadow=!0;var jS=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i)).type="DirectionalLight",r.position.copy(Wg.DefaultUp),r.updateMatrix(),r.target=new Wg,r.shadow=new $S,r}return $d(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(ES);jS.prototype.isDirectionalLight=!0;var US=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i)).type="AmbientLight",r}return $d(n)}(ES);US.prototype.isAmbientLight=!0;var VS=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return Fd(this,n),(r=t.call(this,e,i)).type="RectAreaLight",r.width=a,r.height=o,r}return $d(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(ES);VS.prototype.isRectAreaLight=!0;var HS=function(){function e(){Fd(this,e),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Vm)}return $d(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}]),e}();HS.prototype.isSphericalHarmonics3=!0;var WS=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new HS,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Fd(this,n),(e=t.call(this,void 0,r)).sh=i,e}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(ES);WS.prototype.isLightProbe=!0;var GS,qS=function(){function e(){Fd(this,e)}return $d(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(r){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),ZS=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this)).type="InstancedBufferGeometry",e.instanceCount=1/0,e}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=Nd(kd(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(C_);ZS.prototype.isInstancedBufferGeometry=!0,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),i=t.call(this,e),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.options={premultiplyAlpha:"none"},i}return $d(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=yS.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){yS.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}]),n}(wS).prototype.isImageBitmapLoader=!0;var XS=function(){return void 0===GS&&(GS=new(window.AudioContext||window.webkitAudioContext)),GS},YS=function(e){Dd(n,e);var t=Od(n);function n(e){return Fd(this,n),t.call(this,e)}return $d(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new SS(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{var a=n.slice(0);XS().decodeAudioData(a,(function(e){t(e)}))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)}}]),n}(wS),KS=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Fd(this,n),r=t.call(this,void 0,a);var o=(new h_).set(e),s=(new h_).set(i),u=new Vm(o.r,o.g,o.b),l=new Vm(s.r,s.g,s.b),c=Math.sqrt(Math.PI),h=c*Math.sqrt(.75);return r.sh.coefficients[0].copy(u).add(l).multiplyScalar(c),r.sh.coefficients[1].copy(u).sub(l).multiplyScalar(h),r}return $d(n)}(WS);KS.prototype.isHemisphereLightProbe=!0;var JS=function(e){Dd(n,e);var t=Od(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Fd(this,n),i=t.call(this,void 0,r);var a=(new h_).set(e);return i.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),i}return $d(n)}(WS);JS.prototype.isAmbientLightProbe=!0;var QS=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Fd(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return $d(e,[{key:"start",value:function(){this.startTime=eM(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=eM();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function eM(){return("undefined"===typeof performance?Date:performance).now()}var tM=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this)).type="Audio",i.listener=e,i.context=e.context,i.gain=i.context.createGain(),i.gain.connect(e.getInput()),i.autoplay=!1,i.buffer=null,i.detune=0,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.offset=0,i.duration=void 0,i.playbackRate=1,i.isPlaying=!1,i.hasPlaybackControl=!0,i.source=null,i.sourceType="empty",i._startedAt=0,i._progress=0,i._connected=!1,i.filters=[],i}return $d(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(Wg),nM=function(){function e(t,n,i){var r,a,o;switch(Fd(this,e),this.binding=t,this.valueSize=i,n){case"quaternion":r=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return $d(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=t*this._origIndex;this._mixBufferRegion(n,i,s,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var u=t,l=t+t;u!==l;++u)if(n[u]!==n[u+t]){o.setValue(n,i);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,i){Um.slerpFlat(e,t,e,t,e,n,i)}},{key:"_slerpAdditive",value:function(e,t,n,i,r){var a=this._workIndex*r;Um.multiplyQuaternionsFlat(e,a,e,t,e,n),Um.slerpFlat(e,t,e,t,e,a,i)}},{key:"_lerp",value:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}},{key:"_lerpAdditive",value:function(e,t,n,i,r){for(var a=0;a!==r;++a){var o=t+a;e[o]=e[o]+e[n+a]*i}}}]),e}(),iM="\\[\\]\\.:\\/",rM=new RegExp("[\\[\\]\\.:\\/]","g"),aM="[^\\[\\]\\.:\\/]",oM="[^"+iM.replace("\\.","")+"]",sM=/((?:WC+[\/:])*)/.source.replace("WC",aM),uM=/(WCOD+)?/.source.replace("WCOD",oM),lM=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",aM),cM=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",aM),hM=new RegExp("^"+sM+uM+lM+cM+"$"),dM=["material","materials","bones"],fM=function(){function e(t,n,i){Fd(this,e);var r=i||pM.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,r)}return $d(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),pM=function(){function e(t,n,i){Fd(this,e),this.path=n,this.parsedPath=i||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return $d(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[r];if(void 0!==u){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=a}else void 0!==u.fromArray&&void 0!==u.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(c=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,i):new e(t,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(rM,"")}},{key:"parseTrackName",value:function(e){var t=hM.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==dM.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();pM.Composite=fM,pM.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},pM.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},pM.prototype.GetterByBindingType=[pM.prototype._getValue_direct,pM.prototype._getValue_array,pM.prototype._getValue_arrayElement,pM.prototype._getValue_toArray],pM.prototype.SetterByBindingTypeAndVersioning=[[pM.prototype._setValue_direct,pM.prototype._setValue_direct_setNeedsUpdate,pM.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pM.prototype._setValue_array,pM.prototype._setValue_array_setNeedsUpdate,pM.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pM.prototype._setValue_arrayElement,pM.prototype._setValue_arrayElement_setNeedsUpdate,pM.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pM.prototype._setValue_fromArray,pM.prototype._setValue_fromArray_setNeedsUpdate,pM.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var vM=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Fd(this,e),this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),u={endingStart:tm,endingEnd:tm},l=0;l!==o;++l){var c=a[l].createInterpolant(null);s[l]=c,c.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return $d(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=r,s[1]=r+n,u[0]=e/a,u[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var u=this._interpolants,l=this._propertyBindings;if(this.blendMode===am)for(var c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulateAdditive(s);else for(var d=0,f=u.length;d!==f;++d)u[d].evaluate(o),l[d].accumulate(i,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,a=2202===n;if(0===e)return-1===r?i:a&&1===(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){var o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1===(1&r))return t-i}return i}},{key:"_setEndings",value:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=nm,i.endingEnd=nm):(i.endingStart=e?this.zeroSlopeAtStart?nm:tm:im,i.endingEnd=t?this.zeroSlopeAtEnd?nm:tm:im)}},{key:"_scheduleFading",value:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}]),e}(),mM=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this))._root=e,i._initMemoryManager(),i._accuIndex=0,i.time=0,i.timeScale=1,i}return $d(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==r;++c){var h=i[c],d=h.name,f=l[d];if(void 0!==f)a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new nM(pM.create(n,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[c]=f}o[c].resultBuffer=f.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_addInactiveBinding",value:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new sS(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}},{key:"clipAction",value:function(e,t,n){var i=t||this._root,r=i.uuid,a="string"===typeof e?gS.findByName(i,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],u=null;if(void 0===n&&(n=null!==a?a.blendMode:rm),void 0!==s){var l=s.actionByRoot[r];if(void 0!==l&&l.blendMode===n)return l;u=s.knownActions[0],null===a&&(a=u._clip)}if(null===a)return null;var c=new vM(this,a,t,n);return this._bindAction(c,u),this._addInactiveAction(c,o,r),c}},{key:"existingAction",value:function(e,t){var n=t||this._root,i=n.uuid,r="string"===typeof e?gS.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}for(var s=this._bindings,u=this._nActiveBindings,l=0;l!==u;++l)s[l].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var u=a[o];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(pm);mM.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var gM=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Fd(this,n),(r=t.call(this,e,i)).meshPerAttribute=a,r}return $d(n,[{key:"copy",value:function(e){return Nd(kd(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=Nd(kd(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=Nd(kd(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(tw);gM.prototype.isInstancedInterleavedBuffer=!0;var _M=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;Fd(this,e),this.ray=new yg(t,n),this.near=i,this.far=r,this.camera=null,this.layers=new Ag,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return $d(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return bM(e,this,n,t),n.sort(yM),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=0,r=e.length;i<r;i++)bM(e[i],this,n,t);return n.sort(yM),n}}]),e}();function yM(e,t){return e.distance-t.distance}function bM(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i)for(var r=e.children,a=0,o=r.length;a<o;a++)bM(r[a],t,n,!0)}var xM=new Vm,wM=new bg,kM=new bg,SM=function(e){Dd(n,e);var t=Od(n);function n(e){var i;Fd(this,n);for(var r=MM(e),a=new C_,o=[],s=[],u=new h_(0,0,1),l=new h_(0,1,0),c=0;c<r.length;c++){var h=r[c];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(u.r,u.g,u.b),s.push(l.r,l.g,l.b))}a.setAttribute("position",new y_(o,3)),a.setAttribute("color",new y_(s,3));var d=new Rw({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(i=t.call(this,a,d)).type="SkeletonHelper",i.isSkeletonHelper=!0,i.root=e,i.bones=r,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i}return $d(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");kM.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(wM.multiplyMatrices(kM,s.matrixWorld),xM.setFromMatrixPosition(wM),r.setXYZ(o,xM.x,xM.y,xM.z),wM.multiplyMatrices(kM,s.parent.matrixWorld),xM.setFromMatrixPosition(wM),r.setXYZ(o+1,xM.x,xM.y,xM.z),o+=2)}i.getAttribute("position").needsUpdate=!0,Nd(kd(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(Uw);function MM(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,MM(e.children[n]));return t}var TM=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;Fd(this,n),a=new h_(a),o=new h_(o);for(var s=r/2,u=i/r,l=i/2,c=[],h=[],d=0,f=0,p=-l;d<=r;d++,p+=u){c.push(-l,0,p,l,0,p),c.push(p,0,-l,p,0,l);var v=d===s?a:o;v.toArray(h,f),f+=3,v.toArray(h,f),f+=3,v.toArray(h,f),f+=3,v.toArray(h,f),f+=3}var m=new C_;m.setAttribute("position",new y_(c,3)),m.setAttribute("color",new y_(h,3));var g=new Rw({vertexColors:!0,toneMapped:!1});return(e=t.call(this,m,g)).type="GridHelper",e}return $d(n)}(Uw),CM=new Float32Array(1);new Int32Array(CM.buffer),ek.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(ek.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},xk.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},TM.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SM.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},wS.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),qS.extractUrlBase(e)},wS.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Gm.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Gm.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Gm.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Gm.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Gm.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},hg.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},cy.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Lm.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Lm.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Lm.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Lm.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Lm.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Lm.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},bg.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},bg.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},bg.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vm).setFromMatrixColumn(this,3)},bg.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},bg.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},bg.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},bg.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},bg.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},bg.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},bg.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},bg.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},bg.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},bg.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},bg.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},bg.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},bg.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},bg.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},bg.prototype.makeFrustum=function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)},bg.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},sy.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Um.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Um.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},yg.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},yg.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},yg.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},n_.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},n_.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},n_.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},n_.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},n_.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},n_.barycoordFromPoint=function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),n_.getBarycoord(e,t,n,i,r)},n_.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),n_.getNormal(e,t,n,i)},wk.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},wk.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Jk(this,e)},wk.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eS(this,e)},Em.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Em.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Em.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vm.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vm.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vm.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Vm.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Vm.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Vm.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Vm.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Vm.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vm.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Fm.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Fm.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wg.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Wg.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Wg.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Wg.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Wg.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Wg.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),W_.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(W_.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Mw.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Q_.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ES.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(v_.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===dm},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(dm)}}}),v_.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?dm:hm),this},v_.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},v_.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},C_.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},C_.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new v_(arguments[1],arguments[2])))},C_.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},C_.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},C_.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},C_.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},C_.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(C_.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),tw.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?dm:hm),this},tw.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Jk.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Jk.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Jk.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ew.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(r_.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new h_}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(K_.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Jx.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},Jx.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Jx.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Jx.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Jx.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Jx.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Jx.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Jx.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Jx.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Jx.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Jx.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Jx.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Jx.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Jx.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Jx.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Jx.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Jx.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Jx.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Jx.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Jx.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Jx.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Jx.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Jx.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Jx.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Jx.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Jx.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?sm:om}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(jx.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Bm.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),tM.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new YS).load(e,(function(e){t.setBuffer(e)})),this},ty.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},ty.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},Nm.crossOrigin=void 0,Nm.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new CS;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},Nm.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new TS;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},Nm.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Nm.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"134"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="134");var EM=Math.PI/180,PM=180/Math.PI,LM=6378137,AM=6356752.31424518;function IM(e,t,n,i,r,a){var o=NM(e,t,n);return function(e,t,n,i,r,a){var o=NM(i,r,a),s=[e-o[0],t-o[1],n-o[2]];i*=EM,r*=EM;var u=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r),d=-l*s[0]+u*s[1],f=-h*u*s[0]-h*l*s[1]+c*s[2],p=c*u*s[0]+c*l*s[1]+h*s[2];return[d,f,p]}(o[0],o[1],o[2],i,r,a)}function RM(e,t,n,i,r,a){var o=function(e,t,n,i,r,a){var o=NM(i,r,a);i*=EM,r*=EM;var s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r),h=-u*e-c*s*t+l*s*n+o[0],d=s*e-c*u*t+l*u*n+o[1],f=l*t+c*n+o[2];return[h,d,f]}(e,t,n,i,r,a);return function(e,t,n){var i=LM,r=AM,a=i*i,o=r*r,s=a-o,u=Math.sqrt(s/a),l=Math.sqrt(s/o),c=Math.sqrt(e*e+t*t),h=Math.atan2(n*i,c*r),d=Math.sin(h),f=Math.cos(h),p=Math.atan2(t,e),v=Math.atan2(n+l*l*r*d*d*d,c-u*u*i*f*f*f),m=Math.sin(v),g=Math.cos(v),_=i/Math.sqrt(1-u*u*m*m);return[p*PM,v*PM,c/g-_]}(o[0],o[1],o[2])}function NM(e,t,n){var i=LM,r=AM;e*=EM,t*=EM;var a=Math.cos(e),o=Math.sin(e),s=Math.cos(t),u=Math.sin(t),l=i*i,c=r*r,h=1/Math.sqrt(l*s*s+c*u*u),d=(l*h+n)*s;return[d*a,d*o,(c*h+n)*u]}var DM,OM=function(){function e(){Fd(this,e)}return $d(e,[{key:"boundingBoxCorners",value:function(e,t){var n=RM(-t,-t,0,e.lng,e.lat,0),i=RM(t,t,0,e.lng,e.lat,0);return[{lat:n[1],lng:n[0]},{lat:i[1],lng:i[0]}]}},{key:"rotationFromCompass",value:function(e,t){var n=0,i=0,r=0;switch(t){case 1:n=Math.PI/2;break;case 3:n=-Math.PI/2,r=Math.PI;break;case 6:i=-Math.PI/2,r=-Math.PI/2;break;case 8:i=Math.PI/2,r=Math.PI/2}var a=(new bg).makeRotationZ(r),o=new Lg(n,i,e*Math.PI/180,"XYZ"),s=(new bg).makeRotationFromEuler(o),u=(new Fm).setAxisAngleFromRotationMatrix(s.multiply(a));return u.multiplyScalar(u.w).toArray().slice(0,3)}}]),e}(),zM=function(){function e(t){if(Fd(this,e),!t)throw new Error("Incorrect core image data ".concat(t));this._cache=null,this._core=t,this._spatial=null}return $d(e,[{key:"assetsCached",get:function(){return null!=this._core&&null!=this._spatial&&null!=this._cache&&null!=this._cache.image&&null!=this._cache.mesh}},{key:"cameraParameters",get:function(){return this._spatial.camera_parameters}},{key:"cameraType",get:function(){return this._spatial.camera_type}},{key:"capturedAt",get:function(){return this._spatial.captured_at}},{key:"clusterId",get:function(){return this._spatial.cluster?this._spatial.cluster.id:null}},{key:"clusterUrl",get:function(){return this._spatial.cluster?this._spatial.cluster.url:null}},{key:"compassAngle",get:function(){return null!=this._spatial.computed_compass_angle?this._spatial.computed_compass_angle:this._spatial.compass_angle}},{key:"complete",get:function(){return null!=this._spatial}},{key:"computedAltitude",get:function(){return this._spatial.computed_altitude}},{key:"computedCompassAngle",get:function(){return this._spatial.computed_compass_angle}},{key:"computedLngLat",get:function(){return this._core.computed_geometry}},{key:"creatorId",get:function(){return this._spatial.creator.id}},{key:"creatorUsername",get:function(){return this._spatial.creator.username}},{key:"exifOrientation",get:function(){return this._spatial.exif_orientation}},{key:"height",get:function(){return this._spatial.height}},{key:"image",get:function(){return this._cache.image}},{key:"image$",get:function(){return this._cache.image$}},{key:"id",get:function(){return this._core.id}},{key:"lngLat",get:function(){return null!=this._core.computed_geometry?this._core.computed_geometry:this._core.geometry}},{key:"merged",get:function(){return null!=this._spatial&&null!=this._spatial.merge_id}},{key:"mergeId",get:function(){return this._spatial.merge_id}},{key:"mesh",get:function(){return this._cache.mesh}},{key:"originalAltitude",get:function(){return this._spatial.altitude}},{key:"originalCompassAngle",get:function(){return this._spatial.compass_angle}},{key:"originalLngLat",get:function(){return this._core.geometry}},{key:"ownerId",get:function(){return this._spatial.owner?this._spatial.owner.id:null}},{key:"private",get:function(){return this._spatial.private}},{key:"qualityScore",get:function(){return this._spatial.quality_score}},{key:"rotation",get:function(){return this._spatial.computed_rotation}},{key:"scale",get:function(){return this._spatial.atomic_scale}},{key:"sequenceId",get:function(){return this._core.sequence?this._core.sequence.id:null}},{key:"sequenceEdges",get:function(){return this._cache.sequenceEdges}},{key:"sequenceEdges$",get:function(){return this._cache.sequenceEdges$}},{key:"spatialEdges",get:function(){return this._cache.spatialEdges}},{key:"spatialEdges$",get:function(){return this._cache.spatialEdges$}},{key:"width",get:function(){return this._spatial.width}},{key:"cacheAssets$",value:function(){var e=this;return this._cache.cacheAssets$(this._spatial,this.merged).pipe(xp((function(){return e})))}},{key:"cacheImage$",value:function(){var e=this;return this._cache.cacheImage$(this._spatial).pipe(xp((function(){return e})))}},{key:"cacheSequenceEdges",value:function(e){this._cache.cacheSequenceEdges(e)}},{key:"cacheSpatialEdges",value:function(e){this._cache.cacheSpatialEdges(e)}},{key:"dispose",value:function(){null!=this._cache&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}},{key:"initializeCache",value:function(e){if(null!=this._cache)throw new Error("Image cache already initialized (".concat(this.id,")."));this._cache=e}},{key:"makeComplete",value:function(e){if(null==e)throw new Error("Fill can not be null.");this._spatial=e}},{key:"resetSequenceEdges",value:function(){this._cache.resetSequenceEdges()}},{key:"resetSpatialEdges",value:function(){this._cache.resetSpatialEdges()}},{key:"uncache",value:function(){null!=this._cache&&(this._cache.dispose(),this._cache=null)}}]),e}(),FM=function(){function e(t){Fd(this,e),this._disposed=!1,this._provider=t,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new Af,this._image$=this._imageChanged$.pipe(Mv(null),_v(1),Ef()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new Af,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(Mv(this._sequenceEdges),_v(1),Ef()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe((function(){})),this._spatialEdgesChanged$=new Af,this._spatialEdges$=this._spatialEdgesChanged$.pipe(Mv(this._spatialEdges),_v(1),Ef()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe((function(){})),this._cachingAssets$=null}return $d(e,[{key:"image",get:function(){return this._image}},{key:"image$",get:function(){return this._image$}},{key:"mesh",get:function(){return this._mesh}},{key:"sequenceEdges",get:function(){return this._sequenceEdges}},{key:"sequenceEdges$",get:function(){return this._sequenceEdges$}},{key:"spatialEdges",get:function(){return this._spatialEdges}},{key:"spatialEdges$",get:function(){return this._spatialEdges$}},{key:"cacheAssets$",value:function(e,t){var n=this;return null!=this._cachingAssets$||(this._cachingAssets$=Lp(this._cacheImage$(e),this._cacheMesh$(e,t)).pipe(xp((function(e){var t=s(e,2),i=t[0],r=t[1];return n._image=i,n._mesh=r,n})),hv((function(){n._cachingAssets$=null})),_v(1),Ef()),this._cachingAssets$.pipe(dv((function(e){return!!e._image}))).subscribe((function(){n._imageChanged$.next(n._image)}),(function(){}))),this._cachingAssets$}},{key:"cacheImage$",value:function(e){var t=this;if(null!=this._image)return pp(this);var n=this._cacheImage$(e).pipe(dv((function(e){return!!e})),Pv((function(e){t._disposeImage(),t._image=e})),xp((function(){return t})),_v(1),Ef());return n.subscribe((function(){t._imageChanged$.next(t._image)}),(function(){})),n}},{key:"cacheSequenceEdges",value:function(e){this._sequenceEdges={cached:!0,edges:e},this._sequenceEdgesChanged$.next(this._sequenceEdges)}},{key:"cacheSpatialEdges",value:function(e){this._spatialEdges={cached:!0,edges:e},this._spatialEdgesChanged$.next(this._spatialEdges)}},{key:"dispose",value:function(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,null!=this._imageAborter&&(this._imageAborter(),this._imageAborter=null),null!=this._meshAborter&&(this._meshAborter(),this._meshAborter=null)}},{key:"resetSequenceEdges",value:function(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}},{key:"resetSpatialEdges",value:function(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}},{key:"_cacheImage$",value:function(e){var t=this;return kf.create((function(n){var i=new Promise((function(e,n){t._imageAborter=n})),r=e.thumb.url;if(r)t._provider.getImageBuffer(r,i).then((function(e){t._imageAborter=null;var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){if(t._disposed){window.URL.revokeObjectURL(i.src);var e="Image load was aborted (".concat(r,")");n.error(new Error(e))}else n.next(i),n.complete()},i.onerror=function(){t._imageAborter=null,n.error(new Error("Failed to load image (".concat(r,")")))};var a=new Blob([e]);i.src=window.URL.createObjectURL(a)}),(function(e){t._imageAborter=null,n.error(e)}));else{var a=e.thumb.id,o="Incorrect thumb URL for ".concat(e.id," ")+"(".concat(a,", ").concat(r,")");n.error(new Error(o))}}))}},{key:"_cacheMesh$",value:function(e,t){var n=this;return kf.create((function(i){if(!t)return i.next(n._createEmptyMesh()),void i.complete();var r=e.mesh.url;if(!r){var a=e.mesh.id,o="Incorrect mesh URL for ".concat(e.id," ")+"(".concat(a,", ").concat(r,")");return console.warn(o),i.next(n._createEmptyMesh()),void i.complete()}var s=new Promise((function(e,t){n._meshAborter=t}));n._provider.getMesh(r,s).then((function(e){n._meshAborter=null,n._disposed||(i.next(e),i.complete())}),(function(e){n._meshAborter=null,console.error(e),i.next(n._createEmptyMesh()),i.complete()}))}))}},{key:"_createEmptyMesh",value:function(){return{faces:[],vertices:[]}}},{key:"_disposeImage",value:function(){null!=this._image&&window.URL.revokeObjectURL(this._image.src),this._image=null}}]),e}(),BM=function(){function e(t){Fd(this,e),this._id=t.id,this._imageIds=t.image_ids}return $d(e,[{key:"id",get:function(){return this._id}},{key:"imageIds",get:function(){return this._imageIds}},{key:"dispose",value:function(){this._id=null,this._imageIds=null}},{key:"findNext",value:function(e){var t=this._imageIds.indexOf(e);return t+1>=this._imageIds.length||-1===t?null:this._imageIds[t+1]}},{key:"findPrev",value:function(e){var t=this._imageIds.indexOf(e);return 0===t||-1===t?null:this._imageIds[t-1]}}]),e}(),$M=$d((function e(){Fd(this,e),this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}));!function(e){e[e.Next=0]="Next",e[e.Prev=1]="Prev",e[e.StepLeft=2]="StepLeft",e[e.StepRight=3]="StepRight",e[e.StepForward=4]="StepForward",e[e.StepBackward=5]="StepBackward",e[e.TurnLeft=6]="TurnLeft",e[e.TurnRight=7]="TurnRight",e[e.TurnU=8]="TurnU",e[e.Spherical=9]="Spherical",e[e.Similar=10]="Similar"}(DM||(DM={}));var jM=$d((function e(){Fd(this,e),this.steps={},this.turns={},this.spherical={},this.steps[DM.StepForward]={direction:DM.StepForward,motionChange:0,useFallback:!0},this.steps[DM.StepBackward]={direction:DM.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[DM.StepLeft]={direction:DM.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[DM.StepRight]={direction:DM.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[DM.TurnLeft]={direction:DM.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[DM.TurnRight]={direction:DM.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[DM.TurnU]={direction:DM.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[DM.StepForward]={direction:DM.StepForward,directionChange:0,next:DM.StepLeft,prev:DM.StepRight},this.spherical[DM.StepBackward]={direction:DM.StepBackward,directionChange:Math.PI,next:DM.StepRight,prev:DM.StepLeft},this.spherical[DM.StepLeft]={direction:DM.StepLeft,directionChange:Math.PI/2,next:DM.StepBackward,prev:DM.StepForward},this.spherical[DM.StepRight]={direction:DM.StepRight,directionChange:-Math.PI/2,next:DM.StepForward,prev:DM.StepBackward}})),UM=function(){function e(){Fd(this,e),this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=432e5,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}return $d(e,[{key:"maxDistance",get:function(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}]),e}(),VM=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),i=t.call(this,e),Object.setPrototypeOf(Ad(i),n.prototype),i.name="MapillaryError",i}return $d(n)}(Cd(Error)),HM=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),i=t.call(this,null!=e?e:"The argument is not valid."),Object.setPrototypeOf(Ad(i),n.prototype),i.name="ArgumentMapillaryError",i}return $d(n)}(VM),WM=function(){function e(){Fd(this,e),this._epsilon=1e-9}return $d(e,[{key:"azimuthalToBearing",value:function(e){return-e+Math.PI/2}},{key:"degToRad",value:function(e){return Math.PI*e/180}},{key:"radToDeg",value:function(e){return 180*e/Math.PI}},{key:"rotationMatrix",value:function(e){var t=new Vm(e[0],e[1],e[2]),n=t.length();return n>0&&t.normalize(),(new bg).makeRotationAxis(t,n)}},{key:"rotate",value:function(e,t){var n=new Vm(e[0],e[1],e[2]),i=this.rotationMatrix(t);return n.applyMatrix4(i),n}},{key:"opticalCenter",value:function(e,t){var n=[-e[0],-e[1],-e[2]],i=[-t[0],-t[1],-t[2]];return this.rotate(i,n)}},{key:"viewingDirection",value:function(e){var t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)}},{key:"wrap",value:function(e,t,n){if(n<t)throw new Error("Invalid arguments: max must be larger than min.");for(var i=n-t;e>n||e<t;)e>n?e-=i:e<t&&(e+=i);return e}},{key:"wrapAngle",value:function(e){return this.wrap(e,-Math.PI,Math.PI)}},{key:"clamp",value:function(e,t,n){return e<t?t:e>n?n:e}},{key:"angleBetweenVector2",value:function(e,t,n,i){var r=Math.atan2(i,n)-Math.atan2(t,e);return this.wrapAngle(r)}},{key:"angleDifference",value:function(e,t){var n=t-e;return this.wrapAngle(n)}},{key:"relativeRotationAngle",value:function(e,t){var n=this.rotationMatrix([-e[0],-e[1],-e[2]]),i=this.rotationMatrix(t),r=n.multiply(i).elements,a=r[0]+r[5]+r[10];return Math.acos(Math.max(Math.min((a-1)/2,1),-1))}},{key:"angleToPlane",value:function(e,t){var n=(new Vm).fromArray(e),i=n.length();if(i<this._epsilon)return 0;var r=n.dot((new Vm).fromArray(t));return Math.asin(r/i)}},{key:"azimuthal",value:function(e,t){var n=(new Vm).fromArray(e),i=(new Vm).fromArray(t),r=n.clone().dot(i),a=n.clone().sub(i.clone().multiplyScalar(r));return Math.atan2(a.y,a.x)}},{key:"distanceFromLngLat",value:function(e,t,n,i){var r=this.degToRad(i-t),a=this.degToRad(n-e),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.degToRad(t))*Math.cos(this.degToRad(i))*Math.sin(a/2)*Math.sin(a/2);return 12742e3*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}}]),e}(),GM=new WM;function qM(e){return"spherical"===e}function ZM(e){return"fisheye"===e}function XM(e,t,n){var i=IM(e.lng,e.lat,e.alt,n.lng,n.lat,n.alt),r=GM.rotate(i,t);return[-r.x,-r.y,-r.z]}function YM(e,t,n,i,r){for(var a=[],o=0;o<t.length;++o)for(var s=t[o],u=n[o],l=0;l<=i;++l)a.push([s[0]+u[0]*l/i,s[1]+u[1]*l/i]);var c=new J_;return c.up.copy(e.upVector()),c.position.copy((new Vm).fromArray(e.unprojectSfM([0,0],0))),c.lookAt((new Vm).fromArray(e.unprojectSfM([0,0],10))),c.updateMatrix(),c.updateMatrixWorld(!0),a.map((function(t){var n=e.unprojectBasic(t,1e4),i=r.worldToCamera(n,c);return[Math.abs(i[0]/i[2]),Math.abs(i[1]/i[2])]}))}var KM=function(){function e(t,n,i){Fd(this,e),this._spatial=new WM,this._settings=null!=t?t:new UM,this._directions=null!=n?n:new jM,this._coefficients=null!=i?i:new $M}return $d(e,[{key:"getPotentialEdges",value:function(e,t,n){if(!e.complete)throw new HM("Image has to be full.");if(!e.merged)return[];var i,r=this._spatial.viewingDirection(e.rotation),a=this._spatial.angleToPlane(r.toArray(),[0,0,1]),o=[],s=Pd(t);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.merged&&u.id!==e.id){var l=IM(u.lngLat.lng,u.lngLat.lat,u.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude),c=new Vm(l[0],l[1],l[2]),h=c.length();if(!(h>this._settings.maxDistance&&n.indexOf(u.id)<0)){var d=this._spatial.angleBetweenVector2(r.x,r.y,c.x,c.y),f=this._spatial.angleToPlane(c.toArray(),[0,0,1]),p=this._spatial.viewingDirection(u.rotation),v=this._spatial.angleBetweenVector2(r.x,r.y,p.x,p.y),m=this._spatial.angleToPlane(p.toArray(),[0,0,1])-a,g=this._spatial.relativeRotationAngle(e.rotation,u.rotation),_=this._spatial.angleBetweenVector2(1,0,c.x,c.y),y=null!=u.sequenceId&&null!=e.sequenceId&&u.sequenceId===e.sequenceId,b=u.mergeId===e.mergeId,x=u.creatorId===e.creatorId,w={capturedAt:u.capturedAt,directionChange:v,distance:h,spherical:qM(u.cameraType),id:u.id,motionChange:d,rotation:g,sameMergeCC:b,sameSequence:y,sameUser:x,sequenceId:u.sequenceId,verticalDirectionChange:m,verticalMotion:f,worldMotionAzimuth:_};o.push(w)}}}}catch(MN){s.e(MN)}finally{s.f()}return o}},{key:"computeSequenceEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");if(e.sequenceId!==t.id)throw new HM("Image and sequence does not correspond.");var n=[],i=t.findNext(e.id);null!=i&&n.push({data:{direction:DM.Next,worldMotionAzimuth:Number.NaN},source:e.id,target:i});var r=t.findPrev(e.id);return null!=r&&n.push({data:{direction:DM.Prev,worldMotionAzimuth:Number.NaN},source:e.id,target:r}),n}},{key:"computeSimilarEdges",value:function(e,t){var n=this;if(!e.complete)throw new HM("Image has to be full.");var i,r=qM(e.cameraType),a={},o=Pd(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(null!=s.sequenceId&&!s.sameSequence){if(r){if(!s.spherical)continue}else if(!s.spherical&&Math.abs(s.directionChange)>this._settings.similarMaxDirectionChange)continue;s.distance>this._settings.similarMaxDistance||s.sameUser&&Math.abs(s.capturedAt-e.capturedAt)<this._settings.similarMinTimeDifference||(null==a[s.sequenceId]&&(a[s.sequenceId]=[]),a[s.sequenceId].push(s))}}}catch(MN){o.e(MN)}finally{o.f()}var u=[],l=qM(e.cameraType)?function(e){return e.distance}:function(e){return n._coefficients.similarDistance*e.distance+n._coefficients.similarRotation*e.rotation};for(var c in a)if(a.hasOwnProperty(c)){var h,d=Number.MAX_VALUE,f=null,p=Pd(a[c]);try{for(p.s();!(h=p.n()).done;){var v=h.value,m=l(v);m<d&&(d=m,f=v)}}catch(MN){p.e(MN)}finally{p.f()}null!=f&&u.push(f)}return u.map((function(t){return{data:{direction:DM.Similar,worldMotionAzimuth:t.worldMotionAzimuth},source:e.id,target:t.id}}))}},{key:"computeStepEdges",value:function(e,t,n,i){if(!e.complete)throw new HM("Image has to be full.");var r=[];if(qM(e.cameraType))return r;for(var a in this._directions.steps)if(this._directions.steps.hasOwnProperty(a)){var o,s=this._directions.steps[a],u=Number.MAX_VALUE,l=null,c=null,h=Pd(t);try{for(h.s();!(o=h.n()).done;){var d=o.value;if(!d.spherical&&!(Math.abs(d.directionChange)>this._settings.stepMaxDirectionChange)){var f=this._spatial.angleDifference(s.motionChange,d.motionChange),p=this._spatial.angleDifference(d.directionChange,f),v=Math.max(Math.abs(f),Math.abs(p));if(!(Math.abs(v)>this._settings.stepMaxDrift)){var m=d.id;if(!s.useFallback||m!==n&&m!==i||(c=d),!(d.distance>this._settings.stepMaxDistance)){f=Math.sqrt(f*f+d.verticalMotion*d.verticalMotion);var g=this._coefficients.stepPreferredDistance*Math.abs(d.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*f/this._settings.stepMaxDrift+this._coefficients.stepRotation*d.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(d.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(d.sameMergeCC?0:1);g<u&&(u=g,l=d)}}}}}catch(MN){h.e(MN)}finally{h.f()}null!=(l=null==l?c:l)&&r.push({data:{direction:s.direction,worldMotionAzimuth:l.worldMotionAzimuth},source:e.id,target:l.id})}return r}},{key:"computeTurnEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");var n=[];if(qM(e.cameraType))return n;for(var i in this._directions.turns)if(this._directions.turns.hasOwnProperty(i)){var r,a=this._directions.turns[i],o=Number.MAX_VALUE,s=null,u=Pd(t);try{for(u.s();!(r=u.n()).done;){var l=r.value;if(!l.spherical&&!(l.distance>this._settings.turnMaxDistance)){var c=a.direction!==DM.TurnU&&l.distance<this._settings.turnMaxRigDistance&&Math.abs(l.directionChange)>this._settings.turnMinRigDirectionChange,h=this._spatial.angleDifference(a.directionChange,l.directionChange),d=void 0;if(c&&l.directionChange*a.directionChange>0&&Math.abs(l.directionChange)<Math.abs(a.directionChange))d=-Math.PI/2+Math.abs(l.directionChange);else{if(Math.abs(h)>this._settings.turnMaxDirectionChange)continue;var f=a.motionChange?this._spatial.angleDifference(a.motionChange,l.motionChange):0;f=Math.sqrt(f*f+l.verticalMotion*l.verticalMotion),d=this._coefficients.turnDistance*l.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*f/Math.PI+this._coefficients.turnSequencePenalty*(l.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(l.sameMergeCC?0:1)}d<o&&(o=d,s=l)}}}catch(MN){u.e(MN)}finally{u.f()}null!=s&&n.push({data:{direction:a.direction,worldMotionAzimuth:s.worldMotionAzimuth},source:e.id,target:s.id})}return n}},{key:"computePerspectiveToSphericalEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");if(qM(e.cameraType))return[];var n,i=Number.MAX_VALUE,r=null,a=Pd(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.spherical){var s=this._coefficients.sphericalPreferredDistance*Math.abs(o.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(o.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(o.sameMergeCC?0:1);s<i&&(i=s,r=o)}}}catch(MN){a.e(MN)}finally{a.f()}return null==r?[]:[{data:{direction:DM.Spherical,worldMotionAzimuth:r.worldMotionAzimuth},source:e.id,target:r.id}]}},{key:"computeSphericalEdges",value:function(e,t){if(!e.complete)throw new HM("Image has to be full.");if(!qM(e.cameraType))return[];var n,i=[],r=[],a=[],o=Pd(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!(s.distance>this._settings.sphericalMaxDistance))if(s.spherical){if(s.distance<this._settings.sphericalMinDistance)continue;r.push(s)}else for(var u in this._directions.spherical)if(this._directions.spherical.hasOwnProperty(u)){var l=this._directions.spherical[u],c=this._spatial.angleDifference(s.directionChange,s.motionChange),h=this._spatial.angleDifference(l.directionChange,c);if(!(Math.abs(h)>this._settings.sphericalMaxStepTurnChange)){a.push([l.direction,s]);break}}}}catch(MN){o.e(MN)}finally{o.f()}for(var d=Math.PI/this._settings.sphericalMaxItems,f=[],p=[],v=0;v<this._settings.sphericalMaxItems;v++){var m,g=v/this._settings.sphericalMaxItems*2*Math.PI,_=Number.MAX_VALUE,y=null,b=Pd(r);try{for(b.s();!(m=b.n()).done;){var x=m.value,w=this._spatial.angleDifference(g,x.motionChange);if(!(Math.abs(w)>d)){var k,S=Number.MAX_VALUE,M=Pd(f);try{for(M.s();!(k=M.n()).done;){var T=k.value,C=Math.abs(this._spatial.angleDifference(T,x.motionChange));C<S&&(S=C)}}catch(MN){M.e(MN)}finally{M.f()}if(!(S<=d)){var E=this._coefficients.sphericalPreferredDistance*Math.abs(x.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(w)/d+this._coefficients.sphericalSequencePenalty*(x.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(x.sameMergeCC?0:1);E<_&&(_=E,y=x)}}}}catch(MN){b.e(MN)}finally{b.f()}null!=y?(f.push(y.motionChange),i.push({data:{direction:DM.Spherical,worldMotionAzimuth:y.worldMotionAzimuth},source:e.id,target:y.id})):p.push(g)}var P={};P[DM.Spherical]=f,P[DM.StepForward]=[],P[DM.StepLeft]=[],P[DM.StepBackward]=[],P[DM.StepRight]=[];for(var L=0,A=p;L<A.length;L++){var I=A[L],R=[];for(var N in this._directions.spherical)if(this._directions.spherical.hasOwnProperty(N)){var D,O=this._directions.spherical[N],z=P[DM.Spherical].concat(P[O.direction]).concat(P[O.prev]).concat(P[O.next]),F=Number.MAX_VALUE,B=null,$=Pd(a);try{for($.s();!(D=$.n()).done;){var j=D.value;if(j[0]===O.direction){var U=this._spatial.angleDifference(I,j[1].motionChange);if(!(Math.abs(U)>d)){var V,H=Number.MAX_VALUE,W=Pd(z);try{for(W.s();!(V=W.n()).done;){var G=V.value,q=Math.abs(this._spatial.angleDifference(G,j[1].motionChange));q<H&&(H=q)}}catch(MN){W.e(MN)}finally{W.f()}if(!(H<=d)){var Z=this._coefficients.sphericalPreferredDistance*Math.abs(j[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(U)/d+this._coefficients.sphericalMergeCCPenalty*(j[1].sameMergeCC?0:1);Z<F&&(F=Z,B=j)}}}}}catch(MN){$.e(MN)}finally{$.f()}null!=B&&(R.push(B),i.push({data:{direction:B[0],worldMotionAzimuth:B[1].worldMotionAzimuth},source:e.id,target:B[1].id}))}for(var X=0,Y=R;X<Y.length;X++){var K=Y[X];P[K[0]].push(K[1].motionChange)}}return i}}]),e}(),JM=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),i=t.call(this,e),Object.setPrototypeOf(Ad(i),n.prototype),i.name="GraphMapillaryError",i}return $d(n)}(VM),QM=function(){function e(t,n,i,r,a,o){Fd(this,e),this._api=t,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new Af,this._filterCreator=null!==a&&void 0!==a?a:new Av,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new Af,this._filter$=zp(pp(this._filter),this._filterSubject$).pipe(_v(1),Ef()),this._filterSubscription=this._filter$.subscribe((function(){})),this._defaultAlt=2,this._edgeCalculator=null!==r&&void 0!==r?r:new KM,this._graphCalculator=null!==i&&void 0!==i?i:new OM,this._configuration=null!==o&&void 0!==o?o:{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=null!==n&&void 0!==n?n:new e._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}return $d(e,[{key:"api",get:function(){return this._api}},{key:"changed$",get:function(){return this._changed$}},{key:"filter$",get:function(){return this._filter$}},{key:"cacheBoundingBox$",value:function(e,t){var n=this,i=this._api.data.geometry.bboxToCellIds(e,t).filter((function(e){return!(e in n._cachedTiles)})).map((function(e){return e in n._cachingTiles$?n._cachingTiles$[e]:n._cacheTile$(e)}));return 0===i.length&&i.push(pp(this)),rp(i).pipe(Dp(),pv(),Np((function(){var i,r=[],a=[],o=Pd(n._nodeIndex.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map((function(e){return e.node})));try{for(o.s();!(i=o.n()).done;){var s=i.value;s.complete?r.push(s):a.push(s.id)}}catch(MN){o.e(MN)}finally{o.f()}for(var u=[];a.length>0;)u.push(a.splice(0,200));var l=pp(r),c=u.map((function(e){return n._api.getSpatialImages$(e).pipe(xp((function(e){var t,i=[],r=Pd(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(n.hasNode(a.node_id)){var o=n.getNode(a.node_id);o.complete||n._makeFull(o,a.node),i.push(o)}}}catch(MN){r.e(MN)}finally{r.f()}return i})))}));return Hp(l,rp(c).pipe(Dp()))})),Qp((function(e,t){return e.concat(t)})))}},{key:"cacheCell$",value:function(e){var t=this,n=e in this._cachedTiles?pp(this):e in this._cachingTiles$?this._cachingTiles$[e]:this._cacheTile$(e);return n.pipe(Np((function(){var n=t._cachedTiles[e];n.accessed=(new Date).getTime();var i,r=[],a=[],o=Pd(n.nodes);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.complete?r.push(s):a.push(s.id)}}catch(MN){o.e(MN)}finally{o.f()}for(var u=[];a.length>0;)u.push(a.splice(0,200));var l=pp(r),c=u.map((function(e){return t._api.getSpatialImages$(e).pipe(xp((function(e){var n,i=[],r=Pd(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.node){var o=a.node_id;if(t.hasNode(o)){var s=t.getNode(o);s.complete||t._makeFull(s,a.node),i.push(s)}}else console.warn("Image is empty (".concat(a.node,")"))}}catch(MN){r.e(MN)}finally{r.f()}return i})))}));return Hp(l,rp(c).pipe(Dp()))})),Qp((function(e,t){return e.concat(t)})))}},{key:"cacheFill$",value:function(e){var t=this;if(e in this._cachingFull$)throw new JM("Cannot fill node while caching full (".concat(e,")."));if(!this.hasNode(e))throw new JM("Cannot fill node that does not exist in graph (".concat(e,")."));if(e in this._cachingFill$)return this._cachingFill$[e];var n=this.getNode(e);if(n.complete)throw new JM("Cannot fill node that is already full (".concat(e,")."));return this._cachingFill$[e]=this._api.getSpatialImages$([e]).pipe(Pv((function(e){var i,r=Pd(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.node||console.warn("Image is empty ".concat(a.node_id)),n.complete||t._makeFull(n,a.node),delete t._cachingFill$[a.node_id]}}catch(MN){r.e(MN)}finally{r.f()}})),xp((function(){return t})),hv((function(){e in t._cachingFill$&&delete t._cachingFill$[e],t._changed$.next(t)})),gv(),Ef()),this._cachingFill$[e]}},{key:"cacheFull$",value:function(e){var t=this;if(e in this._cachingFull$)return this._cachingFull$[e];if(this.hasNode(e))throw new JM("Cannot cache full node that already exist in graph (".concat(e,")."));return this._cachingFull$[e]=this._api.getImages$([e]).pipe(Pv((function(n){var i,r=Pd(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(!a.node)throw new JM("Image does not exist (".concat(e,", ").concat(a.node,")."));var o=a.node_id;if(t.hasNode(o)){var s=t.getNode(e);s.complete||t._makeFull(s,a.node)}else{if(null==a.node.sequence.id)throw new JM("Image has no sequence key (".concat(e,")."));var u=new zM(a.node);t._makeFull(u,a.node);var l=t._api.data.geometry.lngLatToCellId(u.originalLngLat);t._preStore(l,u),t._setNode(u),delete t._cachingFull$[o]}}}catch(MN){r.e(MN)}finally{r.f()}})),xp((function(){return t})),hv((function(){e in t._cachingFull$&&delete t._cachingFull$[e],t._changed$.next(t)})),gv(),Ef()),this._cachingFull$[e]}},{key:"cacheNodeSequence$",value:function(e){if(!this.hasNode(e))throw new JM("Cannot cache sequence edges of node that does not exist in graph (".concat(e,")."));var t=this.getNode(e);if(t.sequenceId in this._sequences)throw new JM("Sequence already cached (".concat(e,"), (").concat(t.sequenceId,")."));return this._cacheSequence$(t.sequenceId)}},{key:"cacheSequence$",value:function(e){if(e in this._sequences)throw new JM("Sequence already cached (".concat(e,")"));return this._cacheSequence$(e)}},{key:"cacheSequenceEdges",value:function(e){var t=this.getNode(e);if(!(t.sequenceId in this._sequences))throw new JM("Sequence is not cached (".concat(e,"), (").concat(t.sequenceId,")"));var n=this._sequences[t.sequenceId].sequence,i=this._edgeCalculator.computeSequenceEdges(t,n);t.cacheSequenceEdges(i)}},{key:"cacheSequenceNodes$",value:function(e,t){var n=this;if(!this.hasSequence(e))throw new JM("Cannot cache sequence nodes of sequence that does not exist in graph (".concat(e,")."));if(this.hasSequenceNodes(e))throw new JM("Sequence nodes already cached (".concat(e,")."));var i=this.getSequence(e);if(i.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[i.id];var r=[],a=i.imageIds.slice();if(t&&a.length>50){var o=a.indexOf(t),s=Math.max(0,Math.min(o-25,a.length-50));r.push(a.splice(s,50))}for(;a.length>0;)r.push(a.splice(0,200));var u=r.length,l=rp(r).pipe(Np((function(e){return n._api.getImages$(e).pipe(Pv((function(e){var t,i=Pd(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r.node){var a=r.node_id;if(n.hasNode(a)){var o=n.getNode(a);o.complete||n._makeFull(o,r.node)}else{null==r.node.sequence.id&&console.warn("Sequence missing, discarding node (".concat(r.node_id,")"));var s=new zM(r.node);n._makeFull(s,r.node);var l=n._api.data.geometry.lngLatToCellId(s.originalLngLat);n._preStore(l,s),n._setNode(s)}}else console.warn("Image empty (".concat(r.node_id,")"))}}catch(MN){i.e(MN)}finally{i.f()}u--})),xp((function(){return n})))}),6),pv(),hv((function(){delete n._cachingSequenceNodes$[i.id],0===u&&(n._cachedSequenceNodes[i.id]=!0)})),gv(),Ef());return this._cachingSequenceNodes$[i.id]=l,l}},{key:"cacheSpatialArea$",value:function(e){var t=this;if(!this.hasNode(e))throw new JM("Cannot cache spatial area of node that does not exist in graph (".concat(e,")."));if(e in this._cachedSpatialEdges)throw new JM("Image already spatially cached (".concat(e,")."));if(!(e in this._requiredSpatialArea))throw new JM("Spatial area not determined (".concat(e,")."));var n=this._requiredSpatialArea[e];if(0===Object.keys(n.cacheNodes).length)throw new JM("Spatial nodes already cached (".concat(e,")."));if(e in this._cachingSpatialArea$)return this._cachingSpatialArea$[e];for(var i=[];n.cacheKeys.length>0;)i.push(n.cacheKeys.splice(0,200));for(var r=i.length,a=[],o=function(){var i=u[s],o=t._api.getSpatialImages$(i).pipe(Pv((function(i){var a,o=Pd(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.node){var u=s.node_id,l=n.cacheNodes[u];l.complete||t._makeFull(l,s.node),delete n.cacheNodes[u]}else console.warn("Image is empty (".concat(s.node_id,")"))}}catch(MN){o.e(MN)}finally{o.f()}0===--r&&delete t._cachingSpatialArea$[e]})),xp((function(){return t})),Kp((function(a){var o,s=Pd(i);try{for(s.s();!(o=s.n()).done;){var u=o.value;u in n.all&&delete n.all[u],u in n.cacheNodes&&delete n.cacheNodes[u]}}catch(MN){s.e(MN)}finally{s.f()}throw 0===--r&&delete t._cachingSpatialArea$[e],a})),hv((function(){0===Object.keys(n.cacheNodes).length&&t._changed$.next(t)})),gv(),Ef());a.push(o)},s=0,u=i;s<u.length;s++)o();return this._cachingSpatialArea$[e]=a,a}},{key:"cacheSpatialEdges",value:function(e){if(e in this._cachedSpatialEdges)throw new JM("Spatial edges already cached (".concat(e,")."));var t=this.getNode(e),n=this._sequences[t.sequenceId].sequence,i=[],r=n.findPrev(t.id);null!=r&&i.push(r);var a=n.findNext(t.id);null!=a&&i.push(a);var o=this._requiredSpatialArea[e].all,s=[],u=this._filter;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];u(c)&&s.push(c)}var h=this._edgeCalculator.getPotentialEdges(t,s,i),d=this._edgeCalculator.computeStepEdges(t,h,r,a);d=(d=(d=(d=d.concat(this._edgeCalculator.computeTurnEdges(t,h))).concat(this._edgeCalculator.computeSphericalEdges(t,h))).concat(this._edgeCalculator.computePerspectiveToSphericalEdges(t,h))).concat(this._edgeCalculator.computeSimilarEdges(t,h)),t.cacheSpatialEdges(d),this._cachedSpatialEdges[e]=t,delete this._requiredSpatialArea[e],delete this._cachedNodeTiles[e]}},{key:"cacheTiles$",value:function(e){var t=this;if(e in this._cachedNodeTiles)throw new JM("Tiles already cached (".concat(e,")."));if(e in this._cachedSpatialEdges)throw new JM("Spatial edges already cached so tiles considered cached (".concat(e,")."));if(!(e in this._requiredNodeTiles))throw new JM("Tiles have not been determined (".concat(e,")."));var n=this._requiredNodeTiles[e];if(0===n.cache.length&&0===n.caching.length)throw new JM("Tiles already cached (".concat(e,")."));if(!this.hasNode(e))throw new JM("Cannot cache tiles of node that does not exist in graph (".concat(e,")."));var i=n.cache.slice();n.caching=this._requiredNodeTiles[e].caching.concat(i),n.cache=[];var r,a=[],o=Pd(n.caching);try{var s=function(){var i=r.value,o=i in t._cachingTiles$?t._cachingTiles$[i]:t._cacheTile$(i);a.push(o.pipe(Pv((function(r){var a=n.caching.indexOf(i);a>-1&&n.caching.splice(a,1),0===n.caching.length&&0===n.cache.length&&(delete t._requiredNodeTiles[e],t._cachedNodeTiles[e]=!0)})),Kp((function(r){var a=n.caching.indexOf(i);throw a>-1&&n.caching.splice(a,1),0===n.caching.length&&0===n.cache.length&&(delete t._requiredNodeTiles[e],t._cachedNodeTiles[e]=!0),r})),hv((function(){t._changed$.next(t)})),gv(),Ef()))};for(o.s();!(r=o.n()).done;)s()}catch(MN){o.e(MN)}finally{o.f()}return a}},{key:"initializeCache",value:function(e){if(e in this._cachedNodes)throw new JM("Image already in cache (".concat(e,")."));var t=this.getNode(e),n=this._api.data;t.initializeCache(new FM(n));var i=(new Date).getTime();this._cachedNodes[e]={accessed:i,node:t},this._updateCachedTileAccess(e,i)}},{key:"isCachingFill",value:function(e){return e in this._cachingFill$}},{key:"isCachingFull",value:function(e){return e in this._cachingFull$}},{key:"isCachingNodeSequence",value:function(e){return this.getNode(e).sequenceId in this._cachingSequences$}},{key:"isCachingSequence",value:function(e){return e in this._cachingSequences$}},{key:"isCachingSequenceNodes",value:function(e){return e in this._cachingSequenceNodes$}},{key:"isCachingTiles",value:function(e){return e in this._requiredNodeTiles&&0===this._requiredNodeTiles[e].cache.length&&this._requiredNodeTiles[e].caching.length>0}},{key:"hasInitializedCache",value:function(e){return e in this._cachedNodes}},{key:"hasNode",value:function(e){var t=(new Date).getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),e in this._nodes}},{key:"hasNodeSequence",value:function(e){var t=this.getNode(e).sequenceId,n=t in this._sequences;return n&&(this._sequences[t].accessed=(new Date).getTime()),n}},{key:"hasSequence",value:function(e){var t=e in this._sequences;return t&&(this._sequences[e].accessed=(new Date).getTime()),t}},{key:"hasSequenceNodes",value:function(e){return e in this._cachedSequenceNodes}},{key:"hasSpatialArea",value:function(e){if(!this.hasNode(e))throw new JM("Spatial area nodes cannot be determined if node not in graph (".concat(e,")."));if(e in this._cachedSpatialEdges)return!0;if(e in this._requiredSpatialArea)return 0===Object.keys(this._requiredSpatialArea[e].cacheNodes).length;var t,n=this.getNode(e),i=this._graphCalculator.boundingBoxCorners(n.lngLat,this._tileThreshold),r={all:{},cacheKeys:[],cacheNodes:{}},a=Pd(this._nodeIndex.search({maxX:i[1].lng,maxY:i[1].lat,minX:i[0].lng,minY:i[0].lat}));try{for(a.s();!(t=a.n()).done;){var o=t.value;r.all[o.node.id]=o.node,o.node.complete||(r.cacheKeys.push(o.node.id),r.cacheNodes[o.node.id]=o.node)}}catch(MN){a.e(MN)}finally{a.f()}return this._requiredSpatialArea[e]=r,0===r.cacheKeys.length}},{key:"hasTiles",value:function(e){var t=this;if(e in this._cachedNodeTiles)return!0;if(e in this._cachedSpatialEdges)return!0;if(!this.hasNode(e))throw new JM("Image does not exist in graph (".concat(e,")."));var n={cache:[],caching:[]};if(e in this._requiredNodeTiles)n=this._requiredNodeTiles[e];else{var i=this.getNode(e),r=s(this._graphCalculator.boundingBoxCorners(i.lngLat,this._tileThreshold),2),a=r[0],o=r[1];n.cache=this._api.data.geometry.bboxToCellIds(a,o).filter((function(e){return!(e in t._cachedTiles)})),n.cache.length>0&&(this._requiredNodeTiles[e]=n)}return 0===n.cache.length&&0===n.caching.length}},{key:"getNode",value:function(e){var t=(new Date).getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),this._nodes[e]}},{key:"getSequence",value:function(e){var t=this._sequences[e];return t.accessed=(new Date).getTime(),t.sequence}},{key:"resetSpatialEdges",value:function(){for(var e=0,t=Object.keys(this._cachedSpatialEdges);e<t.length;e++){var n=t[e];this._cachedSpatialEdges[n].resetSpatialEdges(),delete this._cachedSpatialEdges[n]}}},{key:"reset",value:function(e){var t,n=[],i=Pd(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(!this.hasNode(r))throw new Error("Image does not exist ".concat(r));var a=this.getNode(r);a.resetSequenceEdges(),a.resetSpatialEdges(),n.push(a)}}catch(MN){i.e(MN)}finally{i.f()}for(var o=0,s=Object.keys(this._cachedNodes);o<s.length;o++){var u=s[o];-1===e.indexOf(u)&&(this._cachedNodes[u].node.dispose(),delete this._cachedNodes[u])}this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(var l=0,c=n;l<c.length;l++){var h=c[l];this._nodes[h.id]=h;var d=this._api.data.geometry.lngLatToCellId(h.originalLngLat);this._preStore(d,h)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}},{key:"setFilter",value:function(e){this._filter=this._filterCreator.createFilter(e),this._filterSubject$.next(this._filter)}},{key:"uncache",value:function(e,t,n){var i={};this._addNewKeys(i,this._cachingFull$),this._addNewKeys(i,this._cachingFill$),this._addNewKeys(i,this._cachingSpatialArea$),this._addNewKeys(i,this._requiredNodeTiles),this._addNewKeys(i,this._requiredSpatialArea);var r,a=Pd(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;o in i||(i[o]=!0)}}catch(MN){a.e(MN)}finally{a.f()}var u=this._tileThreshold,l=this._graphCalculator,c=this._api.data.geometry,h=new Set(t);for(var d in i)if(i.hasOwnProperty(d)){var f,p=this._nodes[d],v=s(l.boundingBoxCorners(p.lngLat,u),2),m=v[0],g=v[1],_=Pd(c.bboxToCellIds(m,g));try{for(_.s();!(f=_.n()).done;){var y=f.value;h.has(y)||h.add(y)}}catch(MN){_.e(MN)}finally{_.f()}}var b=[];for(var x in this._cachedTiles)this._cachedTiles.hasOwnProperty(x)&&!h.has(x)&&b.push([x,this._cachedTiles[x]]);var w,k=b.sort((function(e,t){return t[1].accessed-e[1].accessed})).slice(this._configuration.maxUnusedTiles).map((function(e){return e[0]})),S=Pd(k);try{for(S.s();!(w=S.n()).done;){var M=w.value;this._uncacheTile(M,n)}}catch(MN){S.e(MN)}finally{S.f()}var T=[],C=[];for(var E in this._preStored)if(this._preStored.hasOwnProperty(E)&&!(E in this._cachingTiles$)){var P=this._preStored[E];for(var L in P)P.hasOwnProperty(L)&&!(L in i)&&P[L].sequenceId!==n&&(L in this._cachedNodes?T.push([this._cachedNodes[L],E]):C.push([L,E]))}var A=T.sort((function(e,t){var n=s(e,1)[0];return s(t,1)[0].accessed-n.accessed})).slice(this._configuration.maxUnusedPreStoredImages).map((function(e){var t=s(e,2),n=t[0],i=t[1];return[n.node.id,i]}));this._uncachePreStored(C),this._uncachePreStored(A);var I=[];for(var R in this._cachedNodes)this._cachedNodes.hasOwnProperty(R)&&!(R in i)&&I.push(this._cachedNodes[R]);var N,D=Pd(I.sort((function(e,t){return t.accessed-e.accessed})).slice(this._configuration.maxUnusedImages));try{for(D.s();!(N=D.n()).done;){var O=N.value;O.node.uncache();var z=O.node.id;delete this._cachedNodes[z],z in this._cachedNodeTiles&&delete this._cachedNodeTiles[z],z in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[z]}}catch(MN){D.e(MN)}finally{D.f()}var F=[];for(var B in this._sequences)this._sequences.hasOwnProperty(B)&&!(B in this._cachingSequences$)&&B!==n&&F.push(this._sequences[B]);var $,j=Pd(F.sort((function(e,t){return t.accessed-e.accessed})).slice(this._configuration.maxSequences));try{for(j.s();!($=j.n()).done;){var U=$.value,V=U.sequence.id;delete this._sequences[V],V in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[V],U.sequence.dispose()}}catch(MN){j.e(MN)}finally{j.f()}}},{key:"updateCells$",value:function(e){var t=this,n=this._cachedTiles,i=this._cachingTiles$;return rp(e).pipe(Np((function(e){return e in n?t._updateCell$(e):e in i?i[e].pipe(Kp((function(){return pp(t)})),Np((function(){return t._updateCell$(e)}))):Hf()})))}},{key:"unsubscribe",value:function(){this._filterSubscription.unsubscribe()}},{key:"_addNewKeys",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&this.hasNode(n)&&(n in e||(e[n]=!0))}},{key:"_cacheSequence$",value:function(e){var t=this;return e in this._cachingSequences$||(this._cachingSequences$[e]=this._api.getSequence$(e).pipe(Pv((function(n){n?(n.id in t._sequences||(t._sequences[n.id]={accessed:(new Date).getTime(),sequence:new BM(n)}),delete t._cachingSequences$[e]):console.warn("Sequence does not exist "+"(".concat(e,")"))})),xp((function(){return t})),hv((function(){e in t._cachingSequences$&&delete t._cachingSequences$[e],t._changed$.next(t)})),gv(),Ef())),this._cachingSequences$[e]}},{key:"_cacheTile$",value:function(e){var t=this;return this._cachingTiles$[e]=this._api.getCoreImages$(e).pipe(Pv((function(n){if(!(e in t._cachedTiles)){var i=n.images;t._nodeIndexTiles[e]=[],t._cachedTiles[e]={accessed:(new Date).getTime(),nodes:[]};var r,a=t._cachedTiles[e].nodes,o=t._removeFromPreStore(e),s=Pd(i);try{for(s.s();!(r=s.n()).done;){var u=r.value;if(!u)break;if(null!=u.sequence.id)if(null!=o&&u.id in o){var l=o[u.id];delete o[u.id],a.push(l);var c={lat:l.lngLat.lat,lng:l.lngLat.lng,node:l};t._nodeIndex.insert(c),t._nodeIndexTiles[e].push(c),t._nodeToTile[l.id]=e}else{var h=new zM(u);a.push(h);var d={lat:h.lngLat.lat,lng:h.lngLat.lng,node:h};t._nodeIndex.insert(d),t._nodeIndexTiles[e].push(d),t._nodeToTile[h.id]=e,t._setNode(h)}else console.warn("Sequence missing, discarding "+"node (".concat(u.id,")"))}}catch(MN){s.e(MN)}finally{s.f()}delete t._cachingTiles$[e]}})),xp((function(){return t})),Kp((function(n){throw delete t._cachingTiles$[e],n})),gv(),Ef()),this._cachingTiles$[e]}},{key:"_makeFull",value:function(e,t){null==t.computed_altitude&&(t.computed_altitude=this._defaultAlt),null==t.computed_rotation&&(t.computed_rotation=this._graphCalculator.rotationFromCompass(t.compass_angle,t.exif_orientation)),e.makeComplete(t)}},{key:"_preStore",value:function(e,t){e in this._preStored||(this._preStored[e]={}),this._preStored[e][t.id]=t}},{key:"_removeFromPreStore",value:function(e){var t=null;return e in this._preStored&&(t=this._preStored[e],delete this._preStored[e]),t}},{key:"_setNode",value:function(e){var t=e.id;if(this.hasNode(t))throw new JM("Image already exist (".concat(t,")."));this._nodes[t]=e}},{key:"_uncacheTile",value:function(e,t){var n,i=Pd(this._cachedTiles[e].nodes);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.id;delete this._nodeToTile[a],a in this._cachedNodes&&delete this._cachedNodes[a],a in this._cachedNodeTiles&&delete this._cachedNodeTiles[a],a in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[a],r.sequenceId===t?(this._preStore(e,r),r.uncache()):(delete this._nodes[a],r.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[r.sequenceId],r.dispose())}}catch(MN){i.e(MN)}finally{i.f()}var o,s=Pd(this._nodeIndexTiles[e]);try{for(s.s();!(o=s.n()).done;){var u=o.value;this._nodeIndex.remove(u)}}catch(MN){s.e(MN)}finally{s.f()}delete this._nodeIndexTiles[e],delete this._cachedTiles[e]}},{key:"_uncachePreStored",value:function(e){var t,n={},i=Pd(e);try{for(i.s();!(t=i.n()).done;){var r=s(t.value,2),a=r[0],o=r[1];a in this._nodes&&delete this._nodes[a],a in this._cachedNodes&&delete this._cachedNodes[a];var u=this._preStored[o][a];u.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[u.sequenceId],delete this._preStored[o][a],u.dispose(),n[o]=!0}}catch(MN){i.e(MN)}finally{i.f()}for(var l in n)n.hasOwnProperty(l)&&0===Object.keys(this._preStored[l]).length&&delete this._preStored[l]}},{key:"_updateCachedTileAccess",value:function(e,t){e in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[e]].accessed=t)}},{key:"_updateCachedNodeAccess",value:function(e,t){e in this._cachedNodes&&(this._cachedNodes[e].accessed=t)}},{key:"_updateCell$",value:function(e){var t=this;return this._api.getCoreImages$(e).pipe(Np((function(n){if(!(e in t._cachedTiles))return Hf();var i=t._nodeIndex,r=t._nodeIndexTiles[e],a=t._nodeToTile,o=t._cachedTiles[e];o.accessed=(new Date).getTime();var s,u=o.nodes,l=Pd(n.images);try{for(l.s();!(s=l.n()).done;){var c=s.value;if(null==c)break;if(!t.hasNode(c.id))if(null!=c.sequence.id){var h=new zM(c);u.push(h);var d={lat:h.lngLat.lat,lng:h.lngLat.lng,node:h};i.insert(d),r.push(d),a[h.id]=e,t._setNode(h)}else console.warn("Sequence missing, discarding "+"node (".concat(c.id,")"))}}catch(MN){l.e(MN)}finally{l.f()}return pp(e)})),Kp((function(e){return console.error(e),Hf()})))}}],[{key:"register",value:function(t){e._spatialIndex=t}}]),e}(),eT=function(){function e(){Fd(this,e),this._hash={},this._index=new e._spatialIndex(16),this._indexChanged$=new Af,this._updated$=new Af}return $d(e,[{key:"changed$",get:function(){return this._indexChanged$}},{key:"updated$",get:function(){return this._updated$}},{key:"add",value:function(e){var t,n=[],i=this._hash,r=this._index,a=Pd(e);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.id;s in i&&(r.remove(i[s]),n.push(o));var u={lat:o.lngLat.lat,lng:o.lngLat.lng,marker:o};i[s]=u,r.insert(u)}}catch(MN){a.e(MN)}finally{a.f()}n.length>0&&this._updated$.next(n),e.length>n.length&&this._indexChanged$.next(this)}},{key:"has",value:function(e){return e in this._hash}},{key:"get",value:function(e){return this.has(e)?this._hash[e].marker:void 0}},{key:"getAll",value:function(){return this._index.all().map((function(e){return e.marker}))}},{key:"remove",value:function(e){var t,n=this._hash,i=this._index,r=!1,a=Pd(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o in n){var s=n[o];i.remove(s),delete n[o],r=!0}}}catch(MN){a.e(MN)}finally{a.f()}r&&this._indexChanged$.next(this)}},{key:"removeAll",value:function(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}},{key:"search",value:function(e){var t=s(e,2),n=t[0],i=t[1];return this._index.search({maxX:i.lng,maxY:i.lat,minX:n.lng,minY:n.lat}).map((function(e){return e.marker}))}},{key:"update",value:function(e){var t=this._hash,n=this._index,i=e.id;if(i in t){n.remove(t[i]);var r={lat:e.lngLat.lat,lng:e.lngLat.lng,marker:e};t[i]=r,n.insert(r)}}}],[{key:"register",value:function(t){e._spatialIndex=t}}]),e}();function tT(e,t,n,i,r){nT(e,t,n||0,i||e.length-1,r||rT)}function nT(e,t,n,i,r){for(;i>n;){if(i-n>600){var a=i-n+1,o=t-n+1,s=Math.log(a),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1);nT(e,t,Math.max(n,Math.floor(t-o*u/a+l)),Math.min(i,Math.floor(t+(a-o)*u/a+l)),r)}var c=e[t],h=n,d=i;for(iT(e,n,t),r(e[i],c)>0&&iT(e,n,i);h<d;){for(iT(e,h,d),h++,d--;r(e[h],c)<0;)h++;for(;r(e[d],c)>0;)d--}0===r(e[n],c)?iT(e,n,d):iT(e,++d,i),d<=t&&(n=d+1),t<=d&&(i=d-1)}}function iT(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function rT(e,t){return e<t?-1:e>t?1:0}var aT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;Fd(this,e),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}return $d(e,[{key:"all",value:function(){return this._all(this.data,[])}},{key:"search",value:function(e){var t=this.data,n=[];if(!mT(e,t))return n;for(var i=this.toBBox,r=[];t;){for(var a=0;a<t.children.length;a++){var o=t.children[a],s=t.leaf?i(o):o;mT(e,s)&&(t.leaf?n.push(o):vT(e,s)?this._all(o,n):r.push(o))}t=r.pop()}return n}},{key:"collides",value:function(e){var t=this.data;if(!mT(e,t))return!1;for(var n=[];t;){for(var i=0;i<t.children.length;i++){var r=t.children[i],a=t.leaf?this.toBBox(r):r;if(mT(e,a)){if(t.leaf||vT(e,a))return!0;n.push(r)}}t=n.pop()}return!1}},{key:"load",value:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=gT([]),this}},{key:"remove",value:function(e,t){if(!e)return this;for(var n,i,r,a=this.data,o=this.toBBox(e),s=[],u=[];a||s.length;){if(a||(a=s.pop(),i=s[s.length-1],n=u.pop(),r=!0),a.leaf){var l=oT(e,a.children,t);if(-1!==l)return a.children.splice(l,1),s.push(a),this._condense(s),this}r||a.leaf||!vT(a,o)?i?(n++,a=i.children[n],r=!1):a=null:(s.push(a),u.push(n),n=0,i=a,a=a.children[0])}return this}},{key:"toBBox",value:function(e){return e}},{key:"compareMinX",value:function(e,t){return e.minX-t.minX}},{key:"compareMinY",value:function(e,t){return e.minY-t.minY}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,wd(e.children)):n.push.apply(n,wd(e.children)),e=n.pop();return t}},{key:"_build",value:function(e,t,n,i){var r,a=n-t+1,o=this._maxEntries;if(a<=o)return sT(r=gT(e.slice(t,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(r=gT([])).leaf=!1,r.height=i;var s=Math.ceil(a/o),u=s*Math.ceil(Math.sqrt(o));_T(e,t,n,u,this.compareMinX);for(var l=t;l<=n;l+=u){var c=Math.min(l+u-1,n);_T(e,l,c,s,this.compareMinY);for(var h=l;h<=c;h+=s){var d=Math.min(h+s-1,c);r.children.push(this._build(e,h,d,i-1))}}return sT(r,this.toBBox),r}},{key:"_chooseSubtree",value:function(e,t,n,i){for(;i.push(t),!t.leaf&&i.length-1!==n;){for(var r=1/0,a=1/0,o=void 0,s=0;s<t.children.length;s++){var u=t.children[s],l=dT(u),c=(h=e,d=u,(Math.max(d.maxX,h.maxX)-Math.min(d.minX,h.minX))*(Math.max(d.maxY,h.maxY)-Math.min(d.minY,h.minY))-l);c<a?(a=c,r=l<r?l:r,o=u):c===a&&l<r&&(r=l,o=u)}t=o||t.children[0]}var h,d;return t}},{key:"_insert",value:function(e,t,n){var i=n?e:this.toBBox(e),r=[],a=this._chooseSubtree(i,this.data,t,r);for(a.children.push(e),lT(a,i);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(i,r,t)}},{key:"_split",value:function(e,t){var n=e[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var a=this._chooseSplitIndex(n,r,i),o=gT(n.children.splice(a,n.children.length-a));o.height=n.height,o.leaf=n.leaf,sT(n,this.toBBox),sT(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(n,o)}},{key:"_splitRoot",value:function(e,t){this.data=gT([e,t]),this.data.height=e.height+1,this.data.leaf=!1,sT(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,n){for(var i,r=1/0,a=1/0,o=t;o<=n-t;o++){var s=uT(e,0,o,this.toBBox),u=uT(e,o,n,this.toBBox),l=pT(s,u),c=dT(s)+dT(u);l<r?(r=l,i=o,a=c<a?c:a):l===r&&c<a&&(a=c,i=o)}return i||n-t}},{key:"_chooseSplitAxis",value:function(e,t,n){var i=e.leaf?this.compareMinX:cT,r=e.leaf?this.compareMinY:hT;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)}},{key:"_allDistMargin",value:function(e,t,n,i){e.children.sort(i);for(var r=this.toBBox,a=uT(e,0,t,r),o=uT(e,n-t,n,r),s=fT(a)+fT(o),u=t;u<n-t;u++){var l=e.children[u];lT(a,e.leaf?r(l):l),s+=fT(a)}for(var c=n-t-1;c>=t;c--){var h=e.children[c];lT(o,e.leaf?r(h):h),s+=fT(o)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,n){for(var i=n;i>=0;i--)lT(t[i],e)}},{key:"_condense",value:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():sT(e[n],this.toBBox)}}]),e}();function oT(e,t,n){if(!n)return t.indexOf(e);for(var i=0;i<t.length;i++)if(n(e,t[i]))return i;return-1}function sT(e,t){uT(e,0,e.children.length,t,e)}function uT(e,t,n,i,r){r||(r=gT(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a=t;a<n;a++){var o=e.children[a];lT(r,e.leaf?i(o):o)}return r}function lT(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function cT(e,t){return e.minX-t.minX}function hT(e,t){return e.minY-t.minY}function dT(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function fT(e){return e.maxX-e.minX+(e.maxY-e.minY)}function pT(e,t){var n=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,a-i)}function vT(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function mT(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function gT(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _T(e,t,n,i,r){for(var a=[t,n];a.length;)if(!((n=a.pop())-(t=a.pop())<=i)){var o=t+Math.ceil((n-t)/i/2)*i;tT(e,o,t,n,r),a.push(t,o,o,n)}}var yT=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"compareMinX",value:function(e,t){return e.lng-t.lng}},{key:"compareMinY",value:function(e,t){return e.lat-t.lat}},{key:"toBBox",value:function(e){return{minX:e.lng,minY:e.lat,maxX:e.lng,maxY:e.lat}}}]),n}(aT),bT=function(){function e(t,n){for(var i in Fd(this,e),this._components={},e.registeredComponents)if(e.registeredComponents.hasOwnProperty(i)){var r=e.registeredComponents[i];this._components[i]={active:!1,component:new r(i,t,n)}}this._coverComponent=new e.registeredCoverComponent("cover",t,n),this._coverComponent.activate(),this._coverActivated=!0}return $d(e,[{key:"coverActivated",get:function(){return this._coverActivated}},{key:"activateCover",value:function(){if(!this._coverActivated)for(var e in this._coverActivated=!0,this._components)if(this._components.hasOwnProperty(e)){var t=this._components[e];t.active&&t.component.deactivate()}}},{key:"deactivateCover",value:function(){if(this._coverActivated)for(var e in this._coverActivated=!1,this._components)if(this._components.hasOwnProperty(e)){var t=this._components[e];t.active&&t.component.activate()}}},{key:"activate",value:function(e){this._checkName(e),this._components[e].active=!0,this._coverActivated||this.get(e).activate()}},{key:"configure",value:function(e,t){this._checkName(e),this.get(e).configure(t)}},{key:"deactivate",value:function(e){this._checkName(e),this._components[e].active=!1,this._coverActivated||this.get(e).deactivate()}},{key:"get",value:function(e){return this._components[e].component}},{key:"getCover",value:function(){return this._coverComponent}},{key:"remove",value:function(){for(var e in this._coverComponent.deactivate(),this._components)this._components.hasOwnProperty(e)&&this._components[e].component.deactivate()}},{key:"_checkName",value:function(e){if(!(e in this._components))throw new HM("Component does not exist: ".concat(e))}}],[{key:"register",value:function(t){void 0===e.registeredComponents[t.componentName]&&(e.registeredComponents[t.componentName]=t)}},{key:"registerCover",value:function(t){e.registeredCoverComponent=t}}]),e}();bT.registeredComponents={};var xT="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function wT(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})})),t}var kT=Array.isArray,ST=Object.prototype.toString,MT=kT||function(e){return"[object Array]"===ST.call(e)};CT.NONE=0,CT.VTEXT=1,CT.VNODE=2,CT.WIDGET=3,CT.PROPS=4,CT.ORDER=5,CT.INSERT=6,CT.REMOVE=7,CT.THUNK=8;var TT=CT;function CT(e,t,n){this.type=Number(e),this.vNode=t,this.patch=n}CT.prototype.version="2",CT.prototype.type="VirtualPatch";var ET=function(e){return e&&"VirtualNode"===e.type&&"2"===e.version};var PT=function(e){return e&&"VirtualText"===e.type&&"2"===e.version};var LT=function(e){return e&&"Widget"===e.type};var AT=function(e){return e&&"Thunk"===e.type};var IT=ET,RT=PT,NT=LT,DT=AT,OT=function(e,t){var n=e,i=t;DT(t)&&(i=zT(t,e));DT(e)&&(n=zT(e,null));return{a:n,b:i}};function zT(e,t){var n=e.vnode;if(n||(n=e.vnode=e.render(t)),!(IT(n)||RT(n)||NT(n)))throw new Error("thunk did not return a valid node");return n}var FT=function(e){return"object"===typeof e&&null!==e},BT=function(e){return e&&("function"===typeof e.hook&&!e.hasOwnProperty("hook")||"function"===typeof e.unhook&&!e.hasOwnProperty("unhook"))};var $T=FT,jT=BT,UT=function e(t,n){var i;for(var r in t){r in n||((i=i||{})[r]=void 0);var a=t[r],o=n[r];if(a!==o)if($T(a)&&$T(o))if(VT(o)!==VT(a))(i=i||{})[r]=o;else if(jT(o))(i=i||{})[r]=o;else{var s=e(a,o);s&&((i=i||{})[r]=s)}else(i=i||{})[r]=o}for(var u in n)u in t||((i=i||{})[u]=n[u]);return i};function VT(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var HT=MT,WT=TT,GT=ET,qT=PT,ZT=LT,XT=AT,YT=OT,KT=UT;function JT(e,t){var n={a:e};return QT(e,t,n,0),n}function QT(e,t,n,i){if(e!==t){var r=n[i],a=!1;if(XT(e)||XT(t))nC(e,t,n,i);else if(null==t)ZT(e)||(eC(e,n,i),r=n[i]),r=oC(r,new WT(WT.REMOVE,e,t));else if(GT(t))if(GT(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var o=KT(e.properties,t.properties);o&&(r=oC(r,new WT(WT.PROPS,e,o))),r=function(e,t,n,i,r){for(var a=e.children,o=function(e,t){var n=aC(t),i=n.keys,r=n.free;if(r.length===t.length)return{children:t,moves:null};var a=aC(e),o=a.keys;if(a.free.length===e.length)return{children:t,moves:null};for(var s=[],u=0,l=r.length,c=0,h=0;h<e.length;h++){var d,f=e[h];f.key?i.hasOwnProperty(f.key)?(d=i[f.key],s.push(t[d])):(d=h-c++,s.push(null)):u<l?(d=r[u++],s.push(t[d])):(d=h-c++,s.push(null))}for(var p=u>=r.length?t.length:r[u],v=0;v<t.length;v++){var m=t[v];m.key?o.hasOwnProperty(m.key)||s.push(m):v>=p&&s.push(m)}for(var g,_=s.slice(),y=0,b=[],x=[],w=0;w<t.length;){var k=t[w];for(g=_[y];null===g&&_.length;)b.push(rC(_,y,null)),g=_[y];g&&g.key===k.key?(y++,w++):k.key?(g&&g.key&&i[g.key]!==w+1?(b.push(rC(_,y,g.key)),(g=_[y])&&g.key===k.key?y++:x.push({key:k.key,to:w})):x.push({key:k.key,to:w}),w++):g&&g.key&&b.push(rC(_,y,g.key))}for(;y<_.length;)g=_[y],b.push(rC(_,y,g&&g.key));if(b.length===c&&!x.length)return{children:s,moves:null};return{children:s,moves:{removes:b,inserts:x}}}(a,t.children),s=o.children,u=a.length,l=s.length,c=u>l?u:l,h=0;h<c;h++){var d=a[h],f=s[h];r+=1,d?QT(d,f,n,r):f&&(i=oC(i,new WT(WT.INSERT,null,f))),GT(d)&&d.count&&(r+=d.count)}o.moves&&(i=oC(i,new WT(WT.ORDER,e,o.moves)));return i}(e,t,n,r,i)}else r=oC(r,new WT(WT.VNODE,e,t)),a=!0;else r=oC(r,new WT(WT.VNODE,e,t)),a=!0;else qT(t)?qT(e)?e.text!==t.text&&(r=oC(r,new WT(WT.VTEXT,e,t))):(r=oC(r,new WT(WT.VTEXT,e,t)),a=!0):ZT(t)&&(ZT(e)||(a=!0),r=oC(r,new WT(WT.WIDGET,e,t)));r&&(n[i]=r),a&&eC(e,n,i)}}function eC(e,t,n){iC(e,t,n),tC(e,t,n)}function tC(e,t,n){if(ZT(e))"function"===typeof e.destroy&&(t[n]=oC(t[n],new WT(WT.REMOVE,e,null)));else if(GT(e)&&(e.hasWidgets||e.hasThunks))for(var i=e.children,r=i.length,a=0;a<r;a++){var o=i[a];tC(o,t,n+=1),GT(o)&&o.count&&(n+=o.count)}else XT(e)&&nC(e,null,t,n)}function nC(e,t,n,i){var r=YT(e,t),a=JT(r.a,r.b);(function(e){for(var t in e)if("a"!==t)return!0;return!1})(a)&&(n[i]=new WT(WT.THUNK,null,a))}function iC(e,t,n){if(GT(e)){if(e.hooks&&(t[n]=oC(t[n],new WT(WT.PROPS,e,function(e){var t={};for(var n in e)t[n]=void 0;return t}(e.hooks)))),e.descendantHooks||e.hasThunks)for(var i=e.children,r=i.length,a=0;a<r;a++){var o=i[a];iC(o,t,n+=1),GT(o)&&o.count&&(n+=o.count)}}else XT(e)&&nC(e,null,t,n)}function rC(e,t,n){return e.splice(t,1),{from:t,key:n}}function aC(e){for(var t={},n=[],i=e.length,r=0;r<i;r++){var a=e[r];a.key?t[a.key]=r:n.push(r)}return{keys:t,free:n}}function oC(e,t){return e?(HT(e)?e.push(t):e=[e,t],e):t}var sC=JT,uC=Array.prototype.slice,lC=function(e,t){"length"in e||(e=[e]);e=uC.call(e);for(;e.length;){var n=e.shift(),i=t(n);if(i)return i;n.childNodes&&n.childNodes.length&&(e=uC.call(n.childNodes).concat(e))}};var cC=hC;function hC(e,t){if(!(this instanceof hC))return new hC(e,t);this.data=e,this.nodeValue=e,this.length=e.length,this.ownerDocument=t||null}hC.prototype.nodeType=8,hC.prototype.nodeName="#comment",hC.prototype.toString=function(){return"[object Comment]"};var dC=fC;function fC(e,t){if(!(this instanceof fC))return new fC(e);this.data=e||"",this.length=this.data.length,this.ownerDocument=t||null}fC.prototype.type="DOMTextNode",fC.prototype.nodeType=3,fC.prototype.nodeName="#text",fC.prototype.toString=function(){return this.data},fC.prototype.replaceData=function(e,t,n){var i=this.data,r=i.substring(0,e),a=i.substring(e+t,i.length);this.data=r+n+a,this.length=this.data.length};var pC=function(e){var t=this,n=e.type;e.target||(e.target=t);t.listeners||(t.listeners={});var i=t.listeners[n];if(i)return i.forEach((function(n){e.currentTarget=t,"function"===typeof n?n(e):n.handleEvent(e)}));t.parentNode&&t.parentNode.dispatchEvent(e)};var vC=function(e,t){var n=this;n.listeners||(n.listeners={});n.listeners[e]||(n.listeners[e]=[]);-1===n.listeners[e].indexOf(t)&&n.listeners[e].push(t)};var mC=function(e,t){var n=this;if(!n.listeners)return;if(!n.listeners[e])return;var i=n.listeners[e],r=i.indexOf(t);-1!==r&&i.splice(r,1)};var gC=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function _C(e){switch(e.nodeType){case 3:return xC(e.data);case 8:return"\x3c!--"+e.data+"--\x3e";default:return function(e){var t=[],n=e.tagName;"http://www.w3.org/1999/xhtml"===e.namespaceURI&&(n=n.toLowerCase());t.push("<"+n+function(e){var t=[];for(var n in e)yC(e,n)&&t.push({name:n,value:e[n]});for(var i in e._attributes)for(var r in e._attributes[i]){var a=e._attributes[i][r],o=(a.prefix?a.prefix+":":"")+r;t.push({name:o,value:a.value})}e.className&&t.push({name:"class",value:e.className});return t.length?bC(t):""}(e)+function(e){var t=e.dataset,n=[];for(var i in t)n.push({name:"data-"+i,value:t[i]});return n.length?bC(n):""}(e)),gC.indexOf(n)>-1?t.push(" />"):(t.push(">"),e.childNodes.length?t.push.apply(t,e.childNodes.map(_C)):e.textContent||e.innerText?t.push(xC(e.textContent||e.innerText)):e.innerHTML&&t.push(e.innerHTML),t.push("</"+n+">"));return t.join("")}(e)}}function yC(e,t){var n=typeof e[t];return"style"===t&&Object.keys(e.style).length>0||e.hasOwnProperty(t)&&("string"===n||"boolean"===n||"number"===n)&&"nodeName"!==t&&"className"!==t&&"tagName"!==t&&"textContent"!==t&&"innerText"!==t&&"namespaceURI"!==t&&"innerHTML"!==t}function bC(e){var t=[];return e.forEach((function(e){var n=e.name,i=e.value;"style"===n&&(i=function(e){if("string"===typeof e)return e;var t="";return Object.keys(e).forEach((function(n){var i=e[n];n=n.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),t+=n+":"+i+";"})),t}(i)),t.push(n+'="'+(xC(i).replace(/"/g,"&quot;")+'"'))})),t.length?" "+t.join(" "):""}function xC(e){var t="";return"string"===typeof e?t=e:e&&(t=e.toString()),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var wC=lC,kC=pC,SC=vC,MC=mC,TC=_C,CC="http://www.w3.org/1999/xhtml",EC=PC;function PC(e,t,n){if(!(this instanceof PC))return new PC(e);var i=void 0===n?CC:n||null;this.tagName=i===CC?String(e).toUpperCase():e,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=t||null,this.namespaceURI=i,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}PC.prototype.type="DOMElement",PC.prototype.nodeType=1,PC.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e},PC.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var n=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[n]=e,e.parentNode=this,t},PC.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e},PC.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var n=null===t||void 0===t?-1:this.childNodes.indexOf(t);return n>-1?this.childNodes.splice(n,0,e):this.childNodes.push(e),e.parentNode=this,e},PC.prototype.setAttributeNS=function(e,t,n){var i=null,r=t,a=t.indexOf(":");(a>-1&&(i=t.substr(0,a),r=t.substr(a+1)),"INPUT"===this.tagName&&"type"===t)?this.type=n:(this._attributes[e]||(this._attributes[e]={}))[r]={value:n,prefix:i}},PC.prototype.getAttributeNS=function(e,t){var n=this._attributes[e],i=n&&n[t]&&n[t].value;return"INPUT"===this.tagName&&"type"===t?this.type:"string"!==typeof i?null:i},PC.prototype.removeAttributeNS=function(e,t){var n=this._attributes[e];n&&delete n[t]},PC.prototype.hasAttributeNS=function(e,t){var n=this._attributes[e];return!!n&&t in n},PC.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)},PC.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)},PC.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)},PC.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)},PC.prototype.removeEventListener=MC,PC.prototype.addEventListener=SC,PC.prototype.dispatchEvent=kC,PC.prototype.focus=function(){},PC.prototype.toString=function(){return TC(this)},PC.prototype.getElementsByClassName=function(e){var t=e.split(" "),n=[];return wC(this,(function(e){if(1===e.nodeType){var i=(e.className||"").split(" ");t.every((function(e){return-1!==i.indexOf(e)}))&&n.push(e)}})),n},PC.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return wC(this.childNodes,(function(n){1!==n.nodeType||"*"!==e&&n.tagName.toLowerCase()!==e||t.push(n)})),t},PC.prototype.contains=function(e){return wC(this,(function(t){return e===t}))||!1};var LC=EC,AC=IC;function IC(e){if(!(this instanceof IC))return new IC;this.childNodes=[],this.parentNode=null,this.ownerDocument=e||null}IC.prototype.type="DocumentFragment",IC.prototype.nodeType=11,IC.prototype.nodeName="#document-fragment",IC.prototype.appendChild=LC.prototype.appendChild,IC.prototype.replaceChild=LC.prototype.replaceChild,IC.prototype.removeChild=LC.prototype.removeChild,IC.prototype.toString=function(){return this.childNodes.map((function(e){return String(e)})).join("")};var RC=NC;function NC(e){}NC.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},NC.prototype.preventDefault=function(){};var DC=lC,OC=cC,zC=dC,FC=EC,BC=AC,$C=RC,jC=pC,UC=vC,VC=mC,HC=WC;function WC(){if(!(this instanceof WC))return new WC;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var GC=WC.prototype;GC.createTextNode=function(e){return new zC(e,this)},GC.createElementNS=function(e,t){var n=null===e?null:String(e);return new FC(t,this,n)},GC.createElement=function(e){return new FC(e,this)},GC.createDocumentFragment=function(){return new BC(this)},GC.createEvent=function(e){return new $C(e)},GC.createComment=function(e){return new OC(e,this)},GC.getElementById=function(e){e=String(e);var t=DC(this.childNodes,(function(t){if(String(t.id)===e)return t}));return t||null},GC.getElementsByClassName=FC.prototype.getElementsByClassName,GC.getElementsByTagName=FC.prototype.getElementsByTagName,GC.contains=FC.prototype.contains,GC.removeEventListener=VC,GC.addEventListener=UC,GC.dispatchEvent=jC;var qC,ZC=new HC,XC="undefined"!==typeof xT?xT:"undefined"!==typeof window?window:{},YC=ZC;"undefined"!==typeof document?qC=document:(qC=XC["__GLOBAL_DOCUMENT_CACHE@4"])||(qC=XC["__GLOBAL_DOCUMENT_CACHE@4"]=YC);var KC=FT,JC=BT,QC=function(e,t,n){for(var i in t){var r=t[i];void 0===r?eE(e,i,r,n):JC(r)?(eE(e,i,r,n),r.hook&&r.hook(e,i,n?n[i]:void 0)):KC(r)?tE(e,t,n,i,r):e[i]=r}};function eE(e,t,n,i){if(i){var r=i[t];if(JC(r))r.unhook&&r.unhook(e,t,n);else if("attributes"===t)for(var a in r)e.removeAttribute(a);else if("style"===t)for(var o in r)e.style[o]="";else e[t]="string"===typeof r?"":null}}function tE(e,t,n,i,r){var a=n?n[i]:void 0;if("attributes"!==i)if(a&&KC(a)&&nE(a)!==nE(r))e[i]=r;else{KC(e[i])||(e[i]={});var o="style"===i?"":void 0;for(var s in r){var u=r[s];e[i][s]=void 0===u?o:u}}else for(var l in r){var c=r[l];void 0===c?e.removeAttribute(l):e.setAttribute(l,c)}}function nE(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var iE=qC,rE=QC,aE=ET,oE=PT,sE=LT,uE=OT,lE=function e(t,n){var i=n&&n.document||iE,r=n?n.warn:null;if(t=uE(t).a,sE(t))return t.init();if(oE(t))return i.createTextNode(t.text);if(!aE(t))return r&&r("Item is not a valid virtual dom node",t),null;var a=null===t.namespace?i.createElement(t.tagName):i.createElementNS(t.namespace,t.tagName),o=t.properties;rE(a,o);for(var s=t.children,u=0;u<s.length;u++){var l=e(s[u],n);l&&a.appendChild(l)}return a};var cE={},hE=function(e,t,n,i){return n&&0!==n.length?(n.sort(pE),dE(e,t,n,i,0)):{}};function dE(e,t,n,i,r){if(i=i||{},e){fE(n,r,r)&&(i[r]=e);var a=t.children;if(a)for(var o=e.childNodes,s=0;s<t.children.length;s++){r+=1;var u=a[s]||cE,l=r+(u.count||0);fE(n,r,l)&&dE(o[s],u,n,i,r),r=l}}return i}function fE(e,t,n){if(0===e.length)return!1;for(var i,r,a=0,o=e.length-1;a<=o;){if(r=e[i=(o+a)/2>>0],a===o)return r>=t&&r<=n;if(r<t)a=i+1;else{if(!(r>n))return!0;o=i-1}}return!1}function pE(e,t){return e>t?1:-1}var vE=LT;var mE=QC,gE=LT,_E=TT,yE=function(e,t){if(vE(e)&&vE(t))return"name"in e&&"name"in t?e.id===t.id:e.init===t.init;return!1},bE=function(e,t,n){var i=e.type,r=e.vNode,a=e.patch;switch(i){case _E.REMOVE:return function(e,t){var n=e.parentNode;n&&n.removeChild(e);return xE(e,t),null}(t,r);case _E.INSERT:return function(e,t,n){var i=n.render(t,n);e&&e.appendChild(i);return e}(t,a,n);case _E.VTEXT:return function(e,t,n,i){var r;if(3===e.nodeType)e.replaceData(0,e.length,n.text),r=e;else{var a=e.parentNode;r=i.render(n,i),a&&r!==e&&a.replaceChild(r,e)}return r}(t,0,a,n);case _E.WIDGET:return function(e,t,n,i){var r,a=yE(t,n);r=a?n.update(t,e)||e:i.render(n,i);var o=e.parentNode;o&&r!==e&&o.replaceChild(r,e);a||xE(e,t);return r}(t,r,a,n);case _E.VNODE:return function(e,t,n,i){var r=e.parentNode,a=i.render(n,i);r&&a!==e&&r.replaceChild(a,e);return a}(t,0,a,n);case _E.ORDER:return function(e,t){for(var n,i,r,a=e.childNodes,o={},s=0;s<t.removes.length;s++)n=a[(i=t.removes[s]).from],i.key&&(o[i.key]=n),e.removeChild(n);for(var u=a.length,l=0;l<t.inserts.length;l++)n=o[(r=t.inserts[l]).key],e.insertBefore(n,r.to>=u++?null:a[r.to])}(t,a),t;case _E.PROPS:return mE(t,a,r.properties),t;case _E.THUNK:return function(e,t){e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e);return t}(t,n.patch(t,a,n));default:return t}};function xE(e,t){"function"===typeof t.destroy&&gE(t)&&t.destroy(e)}var wE=qC,kE=MT,SE=lE,ME=hE,TE=bE,CE=function e(t,n,i){return(i=i||{}).patch=i.patch&&i.patch!==e?i.patch:EE,i.render=i.render||SE,i.patch(t,n,i)};function EE(e,t,n){var i=function(e){var t=[];for(var n in e)"a"!==n&&t.push(Number(n));return t}(t);if(0===i.length)return e;var r=ME(e,t.a,i),a=e.ownerDocument;n.document||a===wE||(n.document=a);for(var o=0;o<i.length;o++){var s=i[o];e=PE(e,r[s],t[s],n)}return e}function PE(e,t,n,i){if(!t)return e;var r;if(kE(n))for(var a=0;a<n.length;a++)r=TE(n[a],t,i),t===e&&(e=r);else r=TE(n,t,i),t===e&&(e=r);return e}var LE=CE,AE=ET,IE=LT,RE=AT,NE=BT,DE=FE,OE={},zE=[];function FE(e,t,n,i,r){this.tagName=e,this.properties=t||OE,this.children=n||zE,this.key=null!=i?String(i):void 0,this.namespace="string"===typeof r?r:null;var a,o=n&&n.length||0,s=0,u=!1,l=!1,c=!1;for(var h in t)if(t.hasOwnProperty(h)){var d=t[h];NE(d)&&d.unhook&&(a||(a={}),a[h]=d)}for(var f=0;f<o;f++){var p=n[f];AE(p)?(s+=p.count||0,!u&&p.hasWidgets&&(u=!0),!l&&p.hasThunks&&(l=!0),c||!p.hooks&&!p.descendantHooks||(c=!0)):!u&&IE(p)?"function"===typeof p.destroy&&(u=!0):!l&&RE(p)&&(l=!0)}this.count=o+s,this.hasWidgets=u,this.hasThunks=l,this.hooks=a,this.descendantHooks=c}FE.prototype.version="2",FE.prototype.type="VirtualNode";var BE=$E;function $E(e){this.text=String(e)}$E.prototype.version="2",$E.prototype.type="VirtualText";var jE=function(e){var t,n=String.prototype.split,i=/()??/.exec("")[1]===e;return t=function(t,r,a){if("[object RegExp]"!==Object.prototype.toString.call(r))return n.call(t,r,a);var o,s,u,l,c=[],h=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),d=0;r=new RegExp(r.source,h+"g");for(t+="",i||(o=new RegExp("^"+r.source+"$(?!\\s)",h)),a=a===e?-1>>>0:a>>>0;(s=r.exec(t))&&!((u=s.index+s[0].length)>d&&(c.push(t.slice(d,s.index)),!i&&s.length>1&&s[0].replace(o,(function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(s[t]=e)})),s.length>1&&s.index<t.length&&Array.prototype.push.apply(c,s.slice(1)),l=s[0].length,d=u,c.length>=a));)r.lastIndex===s.index&&r.lastIndex++;return d===t.length?!l&&r.test("")||c.push(""):c.push(t.slice(d)),c.length>a?c.slice(0,a):c},t}(),UE=jE,VE=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,HE=/^\.|#/,WE=function(e,t){if(!e)return"DIV";var n,i,r,a,o=!t.hasOwnProperty("id"),s=UE(e,VE),u=null;HE.test(s[1])&&(u="DIV");for(a=0;a<s.length;a++)(i=s[a])&&(r=i.charAt(0),u?"."===r?(n=n||[]).push(i.substring(1,i.length)):"#"===r&&o&&(t.id=i.substring(1,i.length)):u=i);n&&(t.className&&n.push(t.className),t.className=n.join(" "));return t.namespace?u:u.toUpperCase()};var GE=qE;function qE(e){if(!(this instanceof qE))return new qE(e);this.value=e}qE.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)};var ZE="undefined"!==typeof window?window:"undefined"!==typeof xT?xT:{},XE=function(e,t){if(e in ZE)return ZE[e];return ZE[e]=t,t};var YE=XE,KE=function(e,t,n){var i="__INDIVIDUAL_ONE_VERSION_"+e,r=YE(i+"_ENFORCE_SINGLETON",t);if(r!==t)throw new Error("Can only have one copy of "+e+".\nYou already have version "+r+" installed.\nThis means you cannot install version "+t);return YE(i,n)};KE("ev-store","7");var JE="__EV_STORE_KEY@7";var QE=function(e){var t=e[JE];t||(t=e[JE]={});return t},eP=tP;function tP(e){if(!(this instanceof tP))return new tP(e);this.value=e}tP.prototype.hook=function(e,t){QE(e)[t.substr(3)]=this.value},tP.prototype.unhook=function(e,t){QE(e)[t.substr(3)]=void 0};var nP=MT,iP=DE,rP=BE,aP=ET,oP=PT,sP=LT,uP=BT,lP=AT,cP=WE,hP=GE,dP=eP,fP=function(e,t,n){var i,r,a,o,s=[];!n&&function(e){return"string"===typeof e||nP(e)||vP(e)}(t)&&(n=t,r={});i=cP(e,r=r||t||{}),r.hasOwnProperty("key")&&(a=r.key,r.key=void 0);r.hasOwnProperty("namespace")&&(o=r.namespace,r.namespace=void 0);"INPUT"!==i||o||!r.hasOwnProperty("value")||void 0===r.value||uP(r.value)||(r.value=hP(r.value));(function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(uP(n))continue;"ev-"===t.substr(0,3)&&(e[t]=dP(n))}})(r),void 0!==n&&null!==n&&pP(n,s,i,r);return new iP(i,r,s,a,o)};function pP(e,t,n,i){if("string"===typeof e)t.push(new rP(e));else if("number"===typeof e)t.push(new rP(String(e)));else if(vP(e))t.push(e);else{if(!nP(e)){if(null===e||void 0===e)return;throw function(e){var t=new Error;return t.type="virtual-hyperscript.unexpected.virtual-element",t.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+mP(e.foreignObject)+".\nThe parent vnode is:\n"+mP(e.parentVnode),t.foreignObject=e.foreignObject,t.parentVnode=e.parentVnode,t}({foreignObject:e,parentVnode:{tagName:n,properties:i}})}for(var r=0;r<e.length;r++)pP(e[r],t,n,i)}}function vP(e){return aP(e)||oP(e)||sP(e)||lP(e)}function mP(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}var gP,_P={diff:sC,patch:LE,h:fP,create:lE,VNode:DE,VText:BE},yP=function(){function e(){Fd(this,e),this._events={}}return $d(e,[{key:"fire",value:function(e,t){if(this._listens(e)){var n,i=Pd(this._events[e]);try{for(i.s();!(n=i.n()).done;){(0,n.value)(t)}}catch(MN){i.e(MN)}finally{i.f()}}}},{key:"off",value:function(e,t){if(e){if(this._listens(e)){var n=this._events[e].indexOf(t);n>=0&&this._events[e].splice(n,1),this._events[e].length||delete this._events[e]}}else this._events={}}},{key:"on",value:function(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}},{key:"_listens",value:function(e){return e in this._events}}]),e}(),bP=function(){function e(){Fd(this,e),this._subscriptions=[]}return $d(e,[{key:"push",value:function(e){this._subscriptions.push(e)}},{key:"unsubscribe",value:function(){var e,t=Pd(this._subscriptions);try{for(t.s();!(e=t.n()).done;){e.value.unsubscribe()}}catch(MN){t.e(MN)}finally{t.f()}this._subscriptions=[]}}]),e}(),xP=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this))._activated$=new Rf(!1),a._configurationSubject$=new Af,a._activated=!1,a._container=i,a._name=e,a._navigator=r,a._subscriptions=new bP,a._configuration$=a._configurationSubject$.pipe(Mv(a.defaultConfiguration),bv((function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e})),_v(1),Ef()),a._configuration$.subscribe((function(){})),a}return $d(n,[{key:"activated",get:function(){return this._activated}},{key:"activated$",get:function(){return this._activated$}},{key:"defaultConfiguration",get:function(){return this._getDefaultConfiguration()}},{key:"configuration$",get:function(){return this._configuration$}},{key:"name",get:function(){return this._name}},{key:"activate",value:function(e){this._activated||(void 0!==e&&this._configurationSubject$.next(e),this._activated=!0,this._activate(),this._activated$.next(!0))}},{key:"configure",value:function(e){this._configurationSubject$.next(e)}},{key:"deactivate",value:function(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"resize",value:function(){}}]),n}(yP);!function(e){e[e.Hidden=0]="Hidden",e[e.Loading=1]="Loading",e[e.Visible=2]="Visible"}(gP||(gP={}));var wP=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){return Fd(this,n),t.call(this,e,i,r)}return $d(n,[{key:"_activate",value:function(){var e=this,t=this.configuration$.pipe(dv((function(e){return!!e.id})),qp((function(e){return!e.src})),Tv((function(t){return e._getImageSrc$(t.id).pipe(Kp((function(e){return console.error(e),Hf()})))})),_v(1),Ef()),n=this._subscriptions;n.push(t.pipe(xp((function(e){return{src:e}}))).subscribe((function(t){e._configurationSubject$.next(t)}))),n.push(Lp(this.configuration$,t).pipe(qp((function(e){var t=s(e,2),n=t[0],i=t[1];return!!n.src&&n.src!==i})),dv()).subscribe((function(e){var t=s(e,2)[1];window.URL.revokeObjectURL(t)}))),n.push(this._configuration$.pipe(ov(void 0,(function(e){return e.state})),Tv((function(t){return Lp(pp(t.state),e._navigator.stateService.currentImage$)})),Tv((function(e){var t=s(e,2),n=t[0],i=t[1],r=Lp(pp(i.id),i.image$.pipe(qp((function(e){return!!e})),xp((function(e){return e.src}))));return n===gP.Visible?r.pipe(dv()):r})),ov((function(e,t){var n=s(e,2),i=n[0],r=n[1],a=s(t,2),o=a[0],u=a[1];return i===o&&r===u})),xp((function(e){var t=s(e,2);return{id:t[0],src:t[1]}}))).subscribe(this._configurationSubject$)),n.push(Lp(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(xp((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2];if(!i.src)return{name:e._name,vNode:_P.h("div",[])};var o=a.width<=640||a.height<=480?".mapillary-cover-compact":"";if(i.state===gP.Hidden){var u=_P.h("div.mapillary-cover-container.mapillary-cover-done"+o,[e._getCoverBackgroundVNode(i)]);return{name:e._name,vNode:u}}var l=_P.h("div.mapillary-cover-container"+o,[e._getCoverButtonVNode(i,r)]);return{name:e._name,vNode:l}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{state:gP.Visible}}},{key:"_getCoverButtonVNode",value:function(e,t){var n=this,i=e.state===gP.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",r=_P.h("div.mapillary-cover-button",[_P.h("div.mapillary-cover-button-icon",[])]),a=_P.h("a.mapillary-cover-logo",{href:t,target:"_blank"},[]),o=_P.h("div.mapillary-cover-indicator",{onclick:function(){n.configure({state:gP.Loading})}},[]);return _P.h(i,[this._getCoverBackgroundVNode(e),o,r,a])}},{key:"_getCoverBackgroundVNode",value:function(e){var t={style:{backgroundImage:"url(".concat(e.src,")")}},n=[];return e.state===gP.Loading&&n.push(_P.h("div.mapillary-cover-spinner",{},[])),_P.h("div.mapillary-cover-background",t,n)}},{key:"_getImageSrc$",value:function(e){var t=this;return kf.create((function(n){t._navigator.api.getImages$([e]).subscribe((function(i){var r,a=Pd(i);try{for(a.s();!(r=a.n()).done;){var o=r.value,s="number"===typeof e?e.toString():e;if(o.node_id===s)return void t._navigator.api.data.getImageBuffer(o.node.thumb.url).then((function(t){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){n.next(i.src),n.complete()},i.onerror=function(){n.error(new Error("Failed to load cover "+"image (".concat(e,")")))};var r=new Blob([t]);i.src=window.URL.createObjectURL(r)}),(function(e){n.error(e)}))}}catch(MN){a.e(MN)}finally{a.f()}n.error(new VM("Non existent cover key: ".concat(e)))}),(function(e){n.error(e)}))}))}}]),n}(xP);wP.componentName="cover";var kP=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_activate",value:function(){var e=this;this._subscriptions.push(Lp(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(xp((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2],o=e._makeAttribution(r.creatorUsername,i,r.id,r.capturedAt,a.width);return{name:e._name,vNode:o}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}},{key:"makeImageUrl",value:function(e,t){return"".concat(e,"/app/?pKey=").concat(t,"&focus=photo")}},{key:"_makeAttribution",value:function(e,t,n,i,r){var a=r<=640,o=this._makeDate(i,a),s=this._makeBy(e,t,n,a),u=a?".mapillary-attribution-compact":"";return _P.h("div.mapillary-attribution-container"+u,{},[].concat(wd(s),[o]))}},{key:"_makeBy",value:function(e,t,n,i){var r=_P.h("div.mapillary-attribution-logo",[]);return e?this._makeCreatorBy(r,e,t,n,i):this._makeGeneralBy(r,t,n,i)}},{key:"_makeCreatorBy",value:function(e,t,n,i,r){var a=_P.h("a.mapillary-attribution-icon-container",{href:n,rel:"noreferrer",target:"_blank"},[e]),o=r?"".concat(t):"image by ".concat(t),s=_P.h("div.mapillary-attribution-username",{textContent:o},[]);return[a,_P.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(n,i),rel:"noreferrer",target:"_blank"},[s])]}},{key:"_makeGeneralBy",value:function(e,t,n,i){var r=_P.h("div.mapillary-attribution-username",{textContent:"images by"},[]),a=[_P.h("div.mapillary-attribution-icon-container",{},[e]),_P.h("div.mapillary-attribution-username",{textContent:"contributors"},[])];return i||a.unshift(r),[_P.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(t,n),rel:"noreferrer",target:"_blank"},a)]}},{key:"_makeDate",value:function(e,t){var n=new Date(e).toDateString().split(" "),i=(n.length>3?t?[n[3]]:[n[1],n[2]+",",n[3]]:n).join(" ");return _P.h("div.mapillary-attribution-date",{textContent:i},[])}}]),n}(xP);kP.componentName="attribution";var SP,MP=function(){function e(){Fd(this,e),this._unprojectDepth=200}return $d(e,[{key:"basicToCanvas",value:function(e,t,n,i,r){var a=i.unprojectBasic([e,t],this._unprojectDepth);return this.projectToCanvas(a,n,r)}},{key:"basicToCanvasSafe",value:function(e,t,n,i,r){var a=this.basicToViewportSafe(e,t,i,r);return null===a?null:this.viewportToCanvas(a[0],a[1],n)}},{key:"basicToViewport",value:function(e,t,n,i){var r=n.unprojectBasic([e,t],this._unprojectDepth);return this.projectToViewport(r,i)}},{key:"basicToViewportSafe",value:function(e,t,n,i){var r=n.unprojectBasic([e,t],this._unprojectDepth);return this.worldToCamera(r,i)[2]>0?null:this.projectToViewport(r,i)}},{key:"cameraToViewport",value:function(e,t){var n=(new Vm).fromArray(e).applyMatrix4(t.projectionMatrix);return[n.x,n.y]}},{key:"canvasPosition",value:function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop]}},{key:"canvasToBasic",value:function(e,t,n,i,r){var a=this.unprojectFromCanvas(e,t,n,r).toArray();return i.projectBasic(a)}},{key:"canvasToViewport",value:function(e,t,n){var i=s(this.containerToCanvas(n),2);return[2*e/i[0]-1,1-2*t/i[1]]}},{key:"containerToCanvas",value:function(e){return[e.offsetWidth,e.offsetHeight]}},{key:"getBasicDistances",value:function(e,t){var n=this.viewportToBasic(-1,1,e,t),i=this.viewportToBasic(1,1,e,t),r=this.viewportToBasic(1,-1,e,t),a=this.viewportToBasic(-1,-1,e,t),o=0,s=0,u=0,l=0;return n[1]<0&&i[1]<0&&(o=n[1]>i[1]?-n[1]:-i[1]),i[0]>1&&r[0]>1&&(s=i[0]<r[0]?i[0]-1:r[0]-1),r[1]>1&&a[1]>1&&(u=r[1]<a[1]?r[1]-1:a[1]-1),a[0]<0&&n[0]<0&&(l=a[0]>n[0]?-a[0]:-n[0]),[o,s,u,l]}},{key:"getPixelDistances",value:function(e,t,n){var i=this.viewportToBasic(-1,1,t,n),r=this.viewportToBasic(1,1,t,n),a=this.viewportToBasic(1,-1,t,n),o=this.viewportToBasic(-1,-1,t,n),u=0,l=0,c=0,h=0,d=s(this.containerToCanvas(e),2),f=d[0],p=d[1];if(i[1]<0&&r[1]<0){var v=i[1]>r[1]?i[0]:r[0],m=this.basicToCanvas(v,0,e,t,n);u=m[1]>0?m[1]:0}if(r[0]>1&&a[0]>1){var g=r[0]<a[0]?r[1]:a[1],_=this.basicToCanvas(1,g,e,t,n);l=_[0]<f?f-_[0]:0}if(a[1]>1&&o[1]>1){var y=a[1]<o[1]?a[0]:o[0],b=this.basicToCanvas(y,1,e,t,n);c=b[1]<p?p-b[1]:0}if(o[0]<0&&i[0]<0){var x=o[0]>i[0]?o[1]:i[1],w=this.basicToCanvas(0,x,e,t,n);h=w[0]>0?w[0]:0}return[u,l,c,h]}},{key:"insideElement",value:function(e,t){var n=t.getBoundingClientRect(),i=n.left+t.clientLeft,r=i+t.clientWidth,a=n.top+t.clientTop,o=a+t.clientHeight;return e.clientX>i&&e.clientX<r&&e.clientY>a&&e.clientY<o}},{key:"projectToCanvas",value:function(e,t,n){var i=this.projectToViewport(e,n);return this.viewportToCanvas(i[0],i[1],t)}},{key:"projectToCanvasSafe",value:function(e,t,n){if(this.worldToCamera(e,n)[2]>0)return null;var i=this.projectToViewport(e,n);return this.viewportToCanvas(i[0],i[1],t)}},{key:"projectToViewport",value:function(e,t){var n=new Vm(e[0],e[1],e[2]).project(t);return[n.x,n.y]}},{key:"unprojectFromCanvas",value:function(e,t,n,i){var r=this.canvasToViewport(e,t,n);return this.unprojectFromViewport(r[0],r[1],i)}},{key:"unprojectFromViewport",value:function(e,t,n){return new Vm(e,t,1).unproject(n)}},{key:"viewportToBasic",value:function(e,t,n,i){var r=new Vm(e,t,1).unproject(i).toArray();return n.projectBasic(r)}},{key:"viewportToCanvas",value:function(e,t,n){var i=s(this.containerToCanvas(n),2);return[i[0]*(e+1)/2,-i[1]*(t-1)/2]}},{key:"worldToCamera",value:function(e,t){return new Vm(e[0],e[1],e[2]).applyMatrix4(t.matrixWorldInverse).toArray()}}]),e}();!function(e){e[e.Automatic=0]="Automatic",e[e.Large=1]="Large",e[e.Small=2]="Small"}(SP||(SP={}));var TP=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._spatial=new WM,a._viewportCoords=new MP,a._svgNamespace="http://www.w3.org/2000/svg",a._distinctThreshold=Math.PI/360,a._animationSpeed=.075,a}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions,n=this._container.renderService.renderCamera$.pipe(xp((function(t){var n=e._spatial.degToRad(t.perspective.fov),i=t.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:2*Math.atan(t.perspective.aspect*Math.tan(.5*n));return[e._spatial.azimuthalToBearing(t.rotation.phi),i]})),ov((function(t,n){return Math.abs(n[0]-t[0])<e._distinctThreshold&&Math.abs(n[1]-t[1])<e._distinctThreshold}))),i=Lp(this._navigator.stateService.currentState$.pipe(ov(void 0,(function(e){return e.state.currentImage.id}))),this._navigator.panService.panImages$).pipe(xp((function(t){var n=s(t,2),i=n[0],r=n[1],a=i.state.currentImage,o=i.state.currentTransform;if(qM(a.cameraType))return[Math.PI,Math.PI];var u,l=e._computeProjectedPoints(o),c=e._spatial.degToRad(e._computeHorizontalFov(l)),h=c/2,d=c/2,f=Pd(r);try{for(f.s();!(u=f.n()).done;){var p=s(u.value,3),v=p[0],m=p[2],g=e._spatial.wrap(v.compassAngle-a.compassAngle,-180,180);g<0?h=e._spatial.degToRad(Math.abs(g))+m/2:d=e._spatial.degToRad(Math.abs(g))+m/2}}catch(MN){f.e(MN)}finally{f.f()}return[h,d]})),ov((function(t,n){var i=s(t,2),r=i[0],a=i[1],o=s(n,2),u=o[0],l=o[1];return Math.abs(u-r)<e._distinctThreshold&&Math.abs(l-a)<e._distinctThreshold}))),r=Lp(this._navigator.stateService.currentState$.pipe(ov(void 0,(function(e){return e.state.currentImage.id}))),this._container.renderService.bearing$).pipe(xp((function(t){var n=s(t,2),i=n[0],r=n[1];return e._spatial.degToRad(i.state.currentImage.compassAngle-r)}))),a=new Af,o=a.pipe(bv((function(e,t){return t(e)}),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),xp((function(t){var n=Cm.smootherstep(t.alpha,0,1),i=t.curr,r=t.prev;return[e._interpolate(r[0],i[0],n),e._interpolate(r[1],i[1],n)]})));t.push(i.pipe(xp((function(t){return function(n){var i=Cm.smootherstep(n.alpha,0,1),r=n.curr,a=n.prev,o=[e._interpolate(a[0],r[0],i),e._interpolate(a[1],r[1],i)];return{alpha:0,curr:t.slice(),prev:o}}}))).subscribe(a)),t.push(i.pipe(Tv((function(){return e._container.renderService.renderCameraFrame$.pipe(kv(1),bv((function(t){return t+e._animationSpeed}),0),Ev((function(t){return t<=1+e._animationSpeed})),xp((function(e){return Math.min(e,1)})))})),xp((function(e){return function(t){return{alpha:e,curr:t.curr.slice(),prev:t.prev.slice()}}}))).subscribe(a));var u=Lp(r,o).pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return[n,i[0],i[1]]})));t.push(Lp(n,u,this._configuration$,this._container.renderService.size$).pipe(xp((function(t){var n=s(t,4),i=s(n[0],2),r=i[0],a=i[1],o=s(n[1],3),u=o[0],l=o[1],c=o[2],h=n[2],d=n[3],f=e._createBackground(r),p=e._createFovIndicator(l,c,u),v=e._createNorth(r),m=e._createCircleSectorCompass(e._createCircleSector(Math.max(Math.PI/20,a),"#FFF")),g=h.size===SP.Small||h.size===SP.Automatic&&d.width<640?".mapillary-bearing-compact":"";return{name:e._name,vNode:_P.h("div.mapillary-bearing-indicator-container"+g,{oncontextmenu:function(e){e.preventDefault()}},[f,p,v,m])}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{size:SP.Automatic}}},{key:"_createFovIndicator",value:function(e,t,n){var i=this._createFovArc(e,t),r=_P.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[i]);return _P.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:"rotateZ(".concat(this._spatial.radToDeg(n),"deg)"),width:"36px"}},[r])}},{key:"_createFovArc",value:function(e,t){var n=16.75,i=e+t;if(i>2*Math.PI-Math.PI/90)return _P.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:"".concat(n),stroke:"#FFF","stroke-width":"".concat(2.5)},namespace:this._svgNamespace},[]);var r=-Math.PI/2-e,a=r+i,o=n*Math.cos(r),s=n*Math.sin(r),u=n*Math.cos(a),l=n*Math.sin(a),c=i>=Math.PI?1:0,h="M ".concat(o," ").concat(s," A ").concat(n," ").concat(n," 0 ").concat(c," 1 ").concat(u," ").concat(l);return _P.h("path",{attributes:{d:h,"fill-opacity":"0",stroke:"#FFF","stroke-width":"".concat(2.5)},namespace:this._svgNamespace},[])}},{key:"_createCircleSectorCompass",value:function(e){var t=_P.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[e]);return _P.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[t])}},{key:"_createCircleSector",value:function(e,t){if(e>2*Math.PI-Math.PI/90)return _P.h("circle",{attributes:{cx:"0",cy:"0",fill:t,r:"1"},namespace:this._svgNamespace},[]);var n=-Math.PI/2-e/2,i=n+e,r=Math.cos(n),a=Math.sin(n),o=Math.cos(i),s=Math.sin(i),u=e>=Math.PI?1:0,l="M 0 0 ".concat(r," ").concat(a," A 1 1 0 ").concat(u," 1 ").concat(o," ").concat(s);return _P.h("path",{attributes:{d:l,fill:t},namespace:this._svgNamespace},[])}},{key:"_createNorth",value:function(e){var t=_P.h("div.mapillary-bearing-north",[]);return _P.h("div.mapillary-bearing-north-container",{style:{transform:"rotateZ(".concat(this._spatial.radToDeg(-e),"deg)")}},[t])}},{key:"_createBackground",value:function(e){return _P.h("div.mapillary-bearing-indicator-background",{style:{transform:"rotateZ(".concat(this._spatial.radToDeg(-e),"deg)")}},[_P.h("div.mapillary-bearing-indicator-background-circle",[]),_P.h("div.mapillary-bearing-indicator-background-arrow-container",[_P.h("div.mapillary-bearing-indicator-background-arrow",[])])])}},{key:"_computeProjectedPoints",value:function(e){return YM(e,[[1,0]],[[0,.5]],12,this._viewportCoords)}},{key:"_computeHorizontalFov",value:function(e){var t=this,n=e.map((function(e){return t._coordToFov(e[0])}));return Math.min.apply(Math,wd(n))}},{key:"_coordToFov",value:function(e){return this._spatial.radToDeg(2*Math.atan(e))}},{key:"_interpolate",value:function(e,t,n){return(1-n)*e+n*t}}]),n}(xP);TP.componentName="bearing";var CP=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){return Fd(this,n),t.call(this,e,i,r)}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(Lp(this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$})),qp((function(e){return e.cached}))),this._configuration$).pipe(Tv((function(t){var n=t[0],i=t[1],r=Math.max(0,Math.min(4,i.depth.sequence));return Hp(e._cache$(n.edges,DM.Next,r),e._cache$(n.edges,DM.Prev,r)).pipe(Kp((function(e){return console.error("Failed to cache sequence edges.",e),Hf()})))}))).subscribe((function(){}))),t.push(Lp(this._navigator.stateService.currentImage$.pipe(Tv((function(e){return Lp(pp(e),e.spatialEdges$.pipe(qp((function(e){return e.cached}))))}))),this._configuration$).pipe(Tv((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1],u=a.edges,l=o.depth,c=Math.max(0,Math.min(2,l.spherical)),h=qM(r.cameraType)?0:Math.max(0,Math.min(3,l.step)),d=qM(r.cameraType)?0:Math.max(0,Math.min(1,l.turn)),f=e._cache$(u,DM.Spherical,c);return Hp(e._cache$(u,DM.StepForward,h),e._cache$(u,DM.StepBackward,h),e._cache$(u,DM.StepLeft,h),e._cache$(u,DM.StepRight,h),f,e._cache$(u,DM.TurnLeft,d),e._cache$(u,DM.TurnRight,d),e._cache$(u,DM.TurnU,d)).pipe(Kp((function(e){return console.error("Failed to cache spatial edges.",e),Hf()})))}))).subscribe((function(){})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}},{key:"_cache$",value:function(e,t,n){var i=this;return Zp(pp(e),pp(n)).pipe(cv((function(e){var n=e[0],r=e[1],a=[];if(r>0){var o,s=Pd(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.data.direction===t&&a.push(Zp(i._navigator.graphService.cacheImage$(u.target).pipe(Np((function(e){return i._imageToEdges$(e,t)}))),pp(r-1)))}}catch(MN){s.e(MN)}finally{s.f()}}return rp(a).pipe(Dp())})),kv(1))}},{key:"_imageToEdges$",value:function(e,t){return([DM.Next,DM.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(dv((function(e){return e.cached})),xp((function(e){return e.edges})))}}]),n}(xP);CP.componentName="cache";var EP=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),i=t.call(this,null!=e?e:"The request was cancelled."),Object.setPrototypeOf(Ad(i),n.prototype),i.name="CancelMapillaryError",i}return $d(n)}(VM),PP=function(){function e(t,n){Fd(this,e),this._spatial=new WM,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(t),this._resize(n),this._reset()}return $d(e,[{key:"minWidth",get:function(){return this._minWidth}},{key:"maxWidth",get:function(){return this._maxWidth}},{key:"containerWidth",get:function(){return this._containerWidth}},{key:"containerWidthCss",get:function(){return this._containerWidthCss}},{key:"containerMarginCss",get:function(){return this._containerMarginCss}},{key:"containerLeftCss",get:function(){return this._containerLeftCss}},{key:"containerHeight",get:function(){return this._containerHeight}},{key:"containerHeightCss",get:function(){return this._containerHeightCss}},{key:"containerBottomCss",get:function(){return this._containerBottomCss}},{key:"stepCircleSize",get:function(){return this._stepCircleSize}},{key:"stepCircleSizeCss",get:function(){return this._stepCircleSizeCss}},{key:"stepCircleMarginCss",get:function(){return this._stepCircleMarginCss}},{key:"turnCircleSize",get:function(){return this._turnCircleSize}},{key:"turnCircleSizeCss",get:function(){return this._turnCircleSizeCss}},{key:"outerRadius",get:function(){return this._outerRadius}},{key:"innerRadius",get:function(){return this._innerRadius}},{key:"shadowOffset",get:function(){return this._shadowOffset}},{key:"configure",value:function(e){this._configure(e),this._reset()}},{key:"resize",value:function(e){this._resize(e),this._reset()}},{key:"angleToCoordinates",value:function(e){return[Math.cos(e),Math.sin(e)]}},{key:"relativeAngleToCoordiantes",value:function(e,t){var n=this._spatial.wrapAngle(e-t);return this.angleToCoordinates(n)}},{key:"_configure",value:function(e){this._minWidth=e.minWidth,this._maxWidth=this._getMaxWidth(e.minWidth,e.maxWidth)}},{key:"_resize",value:function(e){this._elementWidth=e.width,this._elementHeight=e.height}},{key:"_reset",value:function(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}},{key:"_getContainerWidth",value:function(e,t){var n=(e-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),i=(t-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),r=Math.max(0,Math.min(1,Math.min(n,i)));return r=.04*Math.round(25*r),this._minWidth+r*(this._maxWidth-this._minWidth)}},{key:"_getContainerHeight",value:function(e){return.77*e}},{key:"_getStepCircleDiameter",value:function(e){return.34*e}},{key:"_getTurnCircleDiameter",value:function(e){return.3*e}},{key:"_getOuterRadius",value:function(e){return.31*e}},{key:"_getInnerRadius",value:function(e){return.125*e}},{key:"_numberToCssPixels",value:function(e){return e+"px"}},{key:"_getMaxWidth",value:function(e,t){return e>t?e:t}}]),e}(),LP=function(){function e(t,n){Fd(this,e),this._isEdge=!1,this._spatial=new WM,this._calculator=new PP(t,n),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[DM.StepForward,DM.StepBackward,DM.StepLeft,DM.StepRight],this._turnDirections=[DM.TurnLeft,DM.TurnRight,DM.TurnU],this._turnNames={},this._turnNames[DM.TurnLeft]="mapillary-direction-turn-left",this._turnNames[DM.TurnRight]="mapillary-direction-turn-right",this._turnNames[DM.TurnU]="mapillary-direction-turn-around";var i=!!document.documentMode;this._isEdge=!i&&!!window.StyleMedia}return $d(e,[{key:"needsRender",get:function(){return this._needsRender}},{key:"render",value:function(e){this._needsRender=!1;var t=this._rotation,n=[],i=[];return qM(this._image.cameraType)?n=n.concat(this._createSphericalArrows(e,t)):(n=(n=n.concat(this._createPerspectiveToSphericalArrows(e,t))).concat(this._createStepArrows(e,t)),i=i.concat(this._createTurnArrows(e))),this._getContainer(n,i,t)}},{key:"setEdges",value:function(e,t){this._setEdges(e,t),this._setNeedsRender()}},{key:"setImage",value:function(e){this._image=e,this._clearEdges(),this._setNeedsRender()}},{key:"setRenderCamera",value:function(e){var t=e.rotation;Math.abs(t.phi-this._rotation.phi)<this._epsilon||(this._rotation=t,this._setNeedsRender())}},{key:"setConfiguration",value:function(e){var t=!1;this._highlightKey===e.highlightId&&this._distinguishSequence===e.distinguishSequence||(this._highlightKey=e.highlightId,this._distinguishSequence=e.distinguishSequence,t=!0),this._calculator.minWidth===e.minWidth&&this._calculator.maxWidth===e.maxWidth||(this._calculator.configure(e),t=!0),t&&this._setNeedsRender()}},{key:"resize",value:function(e){this._calculator.resize(e),this._setNeedsRender()}},{key:"_setNeedsRender",value:function(){null!=this._image&&(this._needsRender=!0)}},{key:"_clearEdges",value:function(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}},{key:"_setEdges",value:function(e,t){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];var n,i=Pd(e.edges);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.data.direction;this._stepDirections.indexOf(a)>-1?this._stepEdges.push(r):this._turnDirections.indexOf(a)>-1?this._turnEdges.push(r):r.data.direction===DM.Spherical&&this._sphericalEdges.push(r)}}catch(MN){i.e(MN)}finally{i.f()}if(this._distinguishSequence&&null!=t){var o,s=Pd(this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges));try{for(s.s();!(o=s.n()).done;){var u,l=o.value.target,c=Pd(t.imageIds);try{for(c.s();!(u=c.n()).done;){if(u.value===l){this._sequenceEdgeKeys.push(l);break}}}catch(MN){c.e(MN)}finally{c.f()}}}catch(MN){s.e(MN)}finally{s.f()}}}},{key:"_createSphericalArrows",value:function(e,t){var n,i=[],r=Pd(this._sphericalEdges);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(this._createVNodeByKey(e,a.target,a.data.worldMotionAzimuth,t,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"))}}catch(MN){r.e(MN)}finally{r.f()}var o,s=Pd(this._stepEdges);try{for(s.s();!(o=s.n()).done;){var u=o.value;i.push(this._createSphericalToPerspectiveArrow(e,u.target,u.data.worldMotionAzimuth,t,u.data.direction))}}catch(MN){s.e(MN)}finally{s.f()}return i}},{key:"_createSphericalToPerspectiveArrow",value:function(e,t,n,i,r){var a=Math.PI/8,o=i.phi;switch(r){case DM.StepBackward:o=i.phi-Math.PI;break;case DM.StepLeft:o=i.phi+Math.PI/2;break;case DM.StepRight:o=i.phi-Math.PI/2}return Math.abs(this._spatial.wrapAngle(n-o))<a?this._createVNodeByKey(e,t,n,i,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(t,n,i)}},{key:"_createPerspectiveToSphericalArrows",value:function(e,t){var n,i=[],r=Pd(this._sphericalEdges);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(this._createVNodeByKey(e,a.target,a.data.worldMotionAzimuth,t,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0))}}catch(MN){r.e(MN)}finally{r.f()}return i}},{key:"_createStepArrows",value:function(e,t){var n,i=[],r=Pd(this._stepEdges);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(this._createVNodeByDirection(e,a.target,a.data.worldMotionAzimuth,t,a.data.direction))}}catch(MN){r.e(MN)}finally{r.f()}return i}},{key:"_createTurnArrows",value:function(e){var t,n=[],i=Pd(this._turnEdges);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=r.data.direction,o=this._turnNames[a];n.push(this._createVNodeByTurn(e,r.target,o,a))}}catch(MN){i.e(MN)}finally{i.f()}return n}},{key:"_createVNodeByKey",value:function(e,t,n,i,r,a,o){return this._createVNode(t,n,i,r,a,"mapillary-direction-circle",(function(n){e.moveTo$(t).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))}),o)}},{key:"_createVNodeByDirection",value:function(e,t,n,i,r){return this._createVNode(t,n,i,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",(function(t){e.moveDir$(r).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))}))}},{key:"_createVNodeByTurn",value:function(e,t,n,i){var r={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(i){case DM.TurnLeft:r.left="5px",r.top="5px";break;case DM.TurnRight:r.right="5px",r.top="5px";break;case DM.TurnU:r.left="5px",r.bottom="5px"}var a={attributes:{"data-id":t},onclick:function(t){e.moveDir$(i).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))},style:r},o="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(t)>-1&&(o+="-sequence"),this._highlightKey===t&&(o+="-highlight");var s=_P.h("div.".concat(n),{},[]);return _P.h("div."+o,a,[s])}},{key:"_createVNodeInactive",value:function(e,t,n){return this._createVNode(e,t,n,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}},{key:"_createVNode",value:function(e,t,n,i,r,a,o,s){var u=this._calculator.angleToCoordinates(t-n.phi),l=Math.round(-i*u[1]+.5*this._calculator.containerWidth),c=Math.round(-i*u[0]+.5*this._calculator.containerHeight),h=this._calculator.relativeAngleToCoordiantes(t,n.phi),d=this._calculator.shadowOffset,f=-d*h[1],p=d*h[0],v="drop-shadow(".concat(f,"px ").concat(p,"px 1px rgba(0,0,0,0.8))"),m={style:{"-webkit-filter":v,filter:v}},g=_P.h("div."+r,m,[]),_=-this._spatial.radToDeg(t-n.phi),y=s?"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(_,"deg) translateZ(-0.01px)"):"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(_,"deg)"),b={attributes:{"data-id":e},onclick:o,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:y,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(e)>-1&&(a+="-sequence"),this._highlightKey===e&&(a+="-highlight"),_P.h("div."+a,b,[g])}},{key:"_getContainer",value:function(e,t,n){var i=this._isEdge?"rotateX(60deg)":"perspective(".concat(this._calculator.containerWidthCss,") rotateX(60deg)"),r={oncontextmenu:function(e){e.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:i,width:this._calculator.containerWidthCss}};return _P.h("div.mapillary-direction-perspective",r,t.concat(e))}}]),e}(),AP=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._renderer=a||new LP(o.defaultConfiguration,{height:i.container.offsetHeight,width:i.container.offsetWidth}),o._hoveredIdSubject$=new Af,o._hoveredId$=o._hoveredIdSubject$.pipe(xv()),o}return $d(n,[{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(this._configuration$.subscribe((function(t){e._renderer.setConfiguration(t)}))),t.push(this._container.renderService.size$.subscribe((function(t){e._renderer.resize(t)}))),t.push(this._navigator.stateService.currentImage$.pipe(Pv((function(t){e._container.domRenderer.render$.next({name:e._name,vNode:_P.h("div",{},[])}),e._renderer.setImage(t)})),Lv(this._configuration$),Tv((function(t){var n=s(t,2),i=n[0],r=n[1];return Lp(i.spatialEdges$,r.distinguishSequence?e._navigator.graphService.cacheSequence$(i.sequenceId).pipe(Kp((function(e){return console.error("Failed to cache sequence (".concat(i.sequenceId,")"),e),pp(null)}))):pp(null))}))).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];e._renderer.setEdges(i,r)}))),t.push(this._container.renderService.renderCameraFrame$.pipe(Pv((function(t){e._renderer.setRenderCamera(t)})),xp((function(){return e._renderer})),qp((function(e){return e.needsRender})),xp((function(t){return{name:e._name,vNode:t.render(e._navigator)}}))).subscribe(this._container.domRenderer.render$)),t.push(Lp(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(Mv(null)),this._container.mouseService.mouseUp$.pipe(Mv(null))).pipe(xp((function(e){for(var t=s(e,1)[0].getElementsByClassName("mapillary-direction-perspective"),n=0;n<t.length;n++){var i=t.item(n).querySelector(":hover");if(null!=i&&i.hasAttribute("data-id"))return i.getAttribute("data-id")}return null})),ov()).subscribe(this._hoveredIdSubject$)),t.push(this._hoveredId$.subscribe((function(t){var n="hover",i={id:t,target:e,type:n};e.fire(n,i)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}]),n}(xP);AP.componentName="direction";var IP=$d((function e(){Fd(this,e)}));IP.fisheye={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.fisheyeCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.perspective={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.perspectiveCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.perspectiveDistorted={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.perspectiveDistortedCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.spherical={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},IP.sphericalCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};var RP,NP=function(){function e(t,n){Fd(this,e),this._imagePlaneDepth=null!=t?t:200,this._imageSphereRadius=null!=n?n:200}return $d(e,[{key:"createMesh",value:function(e,t){return qM(t.cameraType)?this._createImageSphere(e,t):ZM(t.cameraType)?this._createImagePlaneFisheye(e,t):this._createImagePlane(e,t)}},{key:"createFlatMesh",value:function(e,t,n,i,r,a){var o=this._createTexture(e.image),s=this._createDistortedPlaneMaterialParameters(t,o),u=new K_(s),l=this._getFlatImagePlaneGeoFromBasic(t,n,i,r,a);return new W_(l,u)}},{key:"createCurtainMesh",value:function(e,t){return qM(t.cameraType)?this._createSphereCurtainMesh(e,t):ZM(t.cameraType)?this._createCurtainMeshFisheye(e,t):this._createCurtainMesh(e,t)}},{key:"createDistortedCurtainMesh",value:function(e,t){return this._createDistortedCurtainMesh(e,t)}},{key:"_createCurtainMesh",value:function(e,t){var n=this._createTexture(e.image),i=this._createCurtainPlaneMaterialParameters(t,n),r=new K_(i),a=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new W_(a,r)}},{key:"_createCurtainMeshFisheye",value:function(e,t){var n=this._createTexture(e.image),i=this._createCurtainPlaneMaterialParametersFisheye(t,n),r=new K_(i),a=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeo(t);return new W_(a,r)}},{key:"_createDistortedCurtainMesh",value:function(e,t){var n=this._createTexture(e.image),i=this._createDistortedCurtainPlaneMaterialParameters(t,n),r=new K_(i),a=this._getRegularFlatImagePlaneGeo(t);return new W_(a,r)}},{key:"_createSphereCurtainMesh",value:function(e,t){var n=this._createTexture(e.image),i=this._createCurtainSphereMaterialParameters(t,n),r=new K_(i);return this._useMesh(t,e)?new W_(this._getImageSphereGeo(t,e),r):new W_(this._getFlatImageSphereGeo(t),r)}},{key:"_createImageSphere",value:function(e,t){var n=this._createTexture(e.image),i=this._createSphereMaterialParameters(t,n),r=new K_(i);return this._useMesh(t,e)?new W_(this._getImageSphereGeo(t,e),r):new W_(this._getFlatImageSphereGeo(t),r)}},{key:"_createImagePlane",value:function(e,t){var n=this._createTexture(e.image),i=this._createPlaneMaterialParameters(t,n),r=new K_(i),a=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new W_(a,r)}},{key:"_createImagePlaneFisheye",value:function(e,t){var n=this._createTexture(e.image),i=this._createPlaneMaterialParametersFisheye(t,n),r=new K_(i),a=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeoFisheye(t);return new W_(a,r)}},{key:"_createSphereMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.spherical.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:IP.spherical.vertex}}},{key:"_createCurtainSphereMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.sphericalCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:IP.sphericalCurtain.vertex}}},{key:"_createPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.perspective.fragment,side:2,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:IP.perspective.vertex}}},{key:"_createPlaneMaterialParametersFisheye",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.fisheye.fragment,side:2,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:IP.fisheye.vertex}}},{key:"_createCurtainPlaneMaterialParametersFisheye",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.fisheyeCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:IP.fisheyeCurtain.vertex}}},{key:"_createCurtainPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.perspectiveCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:IP.perspectiveCurtain.vertex}}},{key:"_createDistortedCurtainPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.perspectiveDistortedCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:IP.perspectiveDistortedCurtain.vertex}}},{key:"_createDistortedPlaneMaterialParameters",value:function(e,t){return{depthWrite:!1,fragmentShader:IP.perspectiveDistorted.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:IP.perspectiveDistorted.vertex}}},{key:"_createTexture",value:function(e){var t=new Om(e);return t.minFilter=$v,t.needsUpdate=!0,t}},{key:"_useMesh",value:function(e,t){return t.mesh.vertices.length&&e.hasValidScale}},{key:"_getImageSphereGeo",value:function(e,t){for(var n=e.srtInverse,i=5*e.scale,r=this._imageSphereRadius*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],d=a[l+2],f=Math.sqrt(c*c+h*h+d*d),p=Math.max(i,Math.min(f,r))/f,v=new Vm(c*p,h*p,d*p);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=t.mesh.faces,g=new Uint16Array(m.length),_=0;_<m.length;++_)g[_]=m[_];var y=new C_;return y.setAttribute("position",new v_(s,3)),y.setIndex(new v_(g,1)),y}},{key:"_getImagePlaneGeo",value:function(e,t){for(var n=e.srtInverse,i=5*e.scale,r=this._imagePlaneDepth*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],d=a[l+2];u<4&&(c*=3,h*=3);var f=Math.max(i,Math.min(d,r)),p=f/d,v=new Vm(c*p,h*p,f);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=t.mesh.faces,g=new Uint16Array(m.length),_=0;_<m.length;++_)g[_]=m[_];var y=new C_;return y.setAttribute("position",new v_(s,3)),y.setIndex(new v_(g,1)),y}},{key:"_getImagePlaneGeoFisheye",value:function(e,t){for(var n=e.srtInverse,i=5*e.scale,r=this._imagePlaneDepth*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],d=a[l+2],f=Math.sqrt(c*c+h*h+d*d),p=Math.max(i,Math.min(f,r))/f,v=new Vm(c*p,h*p,d*p);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=t.mesh.faces,g=new Uint16Array(m.length),_=0;_<m.length;++_)g[_]=m[_];var y=new C_;return y.setAttribute("position",new v_(s,3)),y.setIndex(new v_(g,1)),y}},{key:"_getFlatImageSphereGeo",value:function(e){var t=new tS(this._imageSphereRadius,20,40),n=e.rt.clone().invert();return t.applyMatrix4(n),t}},{key:"_getRegularFlatImagePlaneGeo",value:function(e){var t=e.width,n=e.height,i=Math.max(t,n),r=t/2/i,a=n/2/i;return this._getFlatImagePlaneGeo(e,r,a)}},{key:"_getFlatImagePlaneGeo",value:function(e,t,n){var i=[];return i.push(e.unprojectSfM([-t,-n],this._imagePlaneDepth)),i.push(e.unprojectSfM([t,-n],this._imagePlaneDepth)),i.push(e.unprojectSfM([t,n],this._imagePlaneDepth)),i.push(e.unprojectSfM([-t,n],this._imagePlaneDepth)),this._createFlatGeometry(i)}},{key:"_getRegularFlatImagePlaneGeoFisheye",value:function(e){var t=e.width,n=e.height,i=Math.max(t,n),r=t/2/i,a=n/2/i;return this._getFlatImagePlaneGeoFisheye(e,r,a)}},{key:"_getFlatImagePlaneGeoFisheye",value:function(e,t,n){var i=[];return i.push(e.unprojectSfM([-t,-n],this._imagePlaneDepth)),i.push(e.unprojectSfM([t,-n],this._imagePlaneDepth)),i.push(e.unprojectSfM([t,n],this._imagePlaneDepth)),i.push(e.unprojectSfM([-t,n],this._imagePlaneDepth)),this._createFlatGeometry(i)}},{key:"_getFlatImagePlaneGeoFromBasic",value:function(e,t,n,i,r){var a=[];return a.push(e.unprojectBasic([t,i],this._imagePlaneDepth)),a.push(e.unprojectBasic([n,i],this._imagePlaneDepth)),a.push(e.unprojectBasic([n,r],this._imagePlaneDepth)),a.push(e.unprojectBasic([t,r],this._imagePlaneDepth)),this._createFlatGeometry(a)}},{key:"_createFlatGeometry",value:function(e){for(var t=new Float32Array(12),n=0;n<e.length;n++){var i=3*n;t[i+0]=e[n][0],t[i+1]=e[n][1],t[i+2]=e[n][2]}var r=new Uint16Array(6);r[0]=0,r[1]=1,r[2]=3,r[3]=1,r[4]=2,r[5]=3;var a=new C_;return a.setAttribute("position",new v_(t,3)),a.setIndex(new v_(r,1)),a}}]),e}(),DP=function(){function e(){Fd(this,e),this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new ew,this._sceneOld=new ew,this._scenePeriphery=new ew}return $d(e,[{key:"planes",get:function(){return this._planes}},{key:"planesOld",get:function(){return this._planesOld}},{key:"planesPeriphery",get:function(){return this._planesPeriphery}},{key:"scene",get:function(){return this._scene}},{key:"sceneOld",get:function(){return this._sceneOld}},{key:"scenePeriphery",get:function(){return this._scenePeriphery}},{key:"updateImagePlanes",value:function(e){for(var t in this._dispose(this._planesOld,this.sceneOld),this._planes)if(this._planes.hasOwnProperty(t)){var n=this._planes[t];this._scene.remove(n),this._sceneOld.add(n)}for(var i in e)e.hasOwnProperty(i)&&this._scene.add(e[i]);this._planesOld=this._planes,this._planes=e}},{key:"addImagePlanes",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._scene.add(n),this._planes[t]=n}}},{key:"addImagePlanesOld",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._sceneOld.add(n),this._planesOld[t]=n}}},{key:"setImagePlanes",value:function(e){this._clear(),this.addImagePlanes(e)}},{key:"addPeripheryPlanes",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._scenePeriphery.add(n),this._planesPeriphery[t]=n}}},{key:"setPeripheryPlanes",value:function(e){this._clearPeriphery(),this.addPeripheryPlanes(e)}},{key:"setImagePlanesOld",value:function(e){this._clearOld(),this.addImagePlanesOld(e)}},{key:"clear",value:function(){this._clear(),this._clearOld()}},{key:"_clear",value:function(){this._dispose(this._planes,this._scene),this._planes={}}},{key:"_clearOld",value:function(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}},{key:"_clearPeriphery",value:function(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}},{key:"_dispose",value:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t.remove(i),i.geometry.dispose(),i.material.dispose();var r=i.material.uniforms.projectorTex.value;null!=r&&r.dispose()}}}]),e}(),OP=function(){function e(){Fd(this,e),this._factory=new NP,this._scene=new DP,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}return $d(e,[{key:"frameId",get:function(){return this._frameId}},{key:"needsRender",get:function(){return this._needsRender}},{key:"indicateNeedsRender",value:function(){this._needsRender=!0}},{key:"addPeripheryPlane",value:function(e,t){var n=this._factory.createMesh(e,t),i={};i[e.id]=n,this._scene.addPeripheryPlanes(i),this._needsRender=!0}},{key:"clearPeripheryPlanes",value:function(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}},{key:"updateFrame",value:function(e){this._updateFrameId(e.id),this._needsRender=this._updateAlpha(e.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(e.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(e.state)||this._needsRender}},{key:"setTextureProvider",value:function(e,t){var n=this;if(e===this._currentKey){var i=t.textureCreated$.subscribe((function(e){n._updateTexture(e)})),r=t.textureUpdated$.subscribe((function(e){n._needsRender=!0}));if(e in this._providerDisposers)(0,this._providerDisposers[e])(),delete this._providerDisposers[e];this._providerDisposers[e]=function(){i.unsubscribe(),r.unsubscribe(),t.dispose()}}}},{key:"updateTextureImage",value:function(e,t){this._needsRender=!0;var n=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(var i in n)if(n.hasOwnProperty(i)&&i===t.id){var r=n[i].material.uniforms.projectorTex.value;r.image=e,r.needsUpdate=!0}}},{key:"render",value:function(e,t){var n=this._scene.planes,i=this._scene.planesOld,r=this._scene.planesPeriphery,a=Object.keys(i).length?1:this._alpha,o=Object.keys(i).length?1:Math.floor(this._alpha);for(var s in n){if(n.hasOwnProperty(s))n[s].material.uniforms.opacity.value=a}for(var u in i){if(i.hasOwnProperty(u))i[u].material.uniforms.opacity.value=this._alphaOld}for(var l in r){if(r.hasOwnProperty(l))r[l].material.uniforms.opacity.value=o}for(var c in t.render(this._scene.scenePeriphery,e),t.render(this._scene.scene,e),t.render(this._scene.sceneOld,e),n){if(n.hasOwnProperty(c))n[c].material.uniforms.opacity.value=this._alpha}t.render(this._scene.scene,e)}},{key:"clearNeedsRender",value:function(){this._needsRender=!1}},{key:"dispose",value:function(){this._scene.clear()}},{key:"_updateFrameId",value:function(e){this._frameId=e}},{key:"_updateAlpha",value:function(e){return e!==this._alpha&&(this._alpha=e,!0)}},{key:"_updateAlphaOld",value:function(e){return!(e<1||0===this._alphaOld)&&(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}},{key:"_updateImagePlanes",value:function(e){if(null==e.currentImage||e.currentImage.id===this._currentKey)return!1;var t=null!=e.previousImage?e.previousImage.id:null,n=e.currentImage.id;this._previousKey!==t&&this._previousKey!==n&&this._previousKey in this._providerDisposers&&((0,this._providerDisposers[this._previousKey])(),delete this._providerDisposers[this._previousKey]);if(null!=t){if(t!==this._currentKey&&t!==this._previousKey){var i=this._factory.createMesh(e.previousImage,e.previousTransform),r={};r[t]=i,this._scene.updateImagePlanes(r)}this._previousKey=t}this._currentKey=n;var a=this._factory.createMesh(e.currentImage,e.currentTransform),o={};return o[n]=a,this._scene.updateImagePlanes(o),this._alphaOld=1,!0}},{key:"_updateTexture",value:function(e){this._needsRender=!0;var t=this._scene.planes;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n].material,r=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null,r.dispose(),i.uniforms.projectorTex.value=e}}},{key:"_extend",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];for(var s in o)o.hasOwnProperty(s)&&(e[s]=o[s])}return e}}]),e}();!function(e){e[e.Background=0]="Background",e[e.Opaque=1]="Opaque"}(RP||(RP={}));var zP=function(){function e(t){Fd(this,e),this._api=t,this._urls$=new Map}return $d(e,[{key:"getImage$",value:function(e){var t,n=this,i=new Promise((function(e,n){t=n}));return[kf.create((function(r){n._api.data.getImageBuffer(e,i).then((function(e){t=null;var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){window.URL.revokeObjectURL(n.src),r.next(n),r.complete()},n.onerror=function(){t=null,window.URL.revokeObjectURL(n.src),r.error(new Error("Failed to load image tile"))};var i=new Blob([e]);n.src=window.URL.createObjectURL(i)}),(function(e){t=null,r.error(e)}))})),function(){t&&t()}]}},{key:"getURLs$",value:function(e,t){var n=this,i=this._inventId(e,t);if(this._urls$.has(i))return this._urls$.get(i);var r={imageId:e,z:t},a=this._api.getImageTiles$(r).pipe(xp((function(e){return e.node})),hv((function(){n._urls$.delete(i)})),gv(),Ef());return this._urls$.set(i,a),a}},{key:"_inventId",value:function(e,t){return"".concat(e,"-").concat(t)}}]),e}(),FP=function(){function e(){Fd(this,e),this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}return $d(e,[{key:"add",value:function(e,t){if(this._tiles.has(e))throw new Error("Image tile already stored (".concat(e,")"));this._tiles.set(e,t)}},{key:"addURLs",value:function(e,t){var n,i=this._urls,r=Pd(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=this.inventId(a);if(this._urls.has(o))throw new Error("URL already stored (".concat(o,")"));i.set(o,a.url)}}catch(MN){r.e(MN)}finally{r.f()}this._urlLevels.add(e)}},{key:"dispose",value:function(){this._tiles.forEach((function(e){return window.URL.revokeObjectURL(e.src)})),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}},{key:"get",value:function(e){return this._tiles.get(e)}},{key:"getURL",value:function(e){return this._urls.get(e)}},{key:"has",value:function(e){return this._tiles.has(e)}},{key:"hasURL",value:function(e){return this._urls.has(e)}},{key:"hasURLLevel",value:function(e){return this._urlLevels.has(e)}},{key:"inventId",value:function(e){return"".concat(e.z,"-").concat(e.x,"-").concat(e.y)}}]),e}(),BP=function(){function e(){Fd(this,e),this._viewportCoords=new MP}return $d(e,[{key:"computeRegionOfInterest",value:function(e,t,n){var i=this._viewportBoundaryPoints(4),r=this._viewportPointsBoundingBox(i,e,n);this._clipBoundingBox(r);var a=2/t.width,o=2/t.height,s=[[-.5*a,.5*o],[.5*a,.5*o],[.5*a,-.5*o],[-.5*a,-.5*o]],u=this._viewportPointsBoundingBox(s,e,n),l=u.minX<u.maxX;return{bbox:r,pixelHeight:u.maxY-u.minY,pixelWidth:u.maxX-u.minX+(l?0:1)}}},{key:"_viewportBoundaryPoints",value:function(e){for(var t=[],n=[[-1,1],[1,1],[1,-1],[-1,-1]],i=[[2,0],[0,-2],[-2,0],[0,2]],r=0;r<4;++r)for(var a=n[r],o=i[r],s=0;s<e;++s)t.push([a[0]+o[0]*s/e,a[1]+o[1]*s/e]);return t}},{key:"_viewportPointsBoundingBox",value:function(e,t,n){var i=this,r=e.map((function(e){return i._viewportCoords.viewportToBasic(e[0],e[1],n,t.perspective)}));return qM(n.cameraType)?this._boundingBoxSpherical(r):this._boundingBox(r)}},{key:"_boundingBox",value:function(e){for(var t={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY},n=0;n<e.length;++n)t.minX=Math.min(t.minX,e[n][0]),t.maxX=Math.max(t.maxX,e[n][0]),t.minY=Math.min(t.minY,e[n][1]),t.maxY=Math.max(t.maxY,e[n][1]);return t}},{key:"_boundingBoxSpherical",value:function(e){for(var t=this,n=[],i=[],r=0;r<e.length;++r)n.push(e[r][0]),i.push(e[r][1]);n.sort((function(e,n){return t._sign(e-n)})),i.sort((function(e,n){return t._sign(e-n)}));var a=this._intervalSpherical(n);return{maxX:a[1],maxY:i[i.length-1],minX:a[0],minY:i[0]}}},{key:"_intervalSpherical",value:function(e){for(var t=0,n=-1,i=0;i<e.length-1;++i){var r=e[i+1]-e[i];r>t&&(t=r,n=i)}return e[0]+1-e[e.length-1]>t?[e[0],e[e.length-1]]:[e[n+1],e[n]]}},{key:"_clipBoundingBox",value:function(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}},{key:"_sign",value:function(e){return e>0?1:e<0?-1:0}}]),e}();function $P(e,t,n){return Math.max(t,Math.min(n,e))}function jP(e){return 1024/UP(e)}function UP(e){return Math.pow(2,e.z-e.max)}function VP(e){return Math.ceil(function(e){var t=Math.max(e.w,e.h);return Math.log(t)/Math.log(2)}(e))}function HP(e,t,n){var i=jP(n),r=t.w,a=t.h,o=Math.ceil(r/i)-1,s=Math.ceil(a/i)-1;return{x:$P(Math.floor(r*e[0]/i),0,o),y:$P(Math.floor(a*e[1]/i),0,s)}}function WP(e,t,n){var i=1024*(1/UP(n)),r=i*e.x,a=i*e.y,o=Math.min(i,t.w-r);return{h:Math.min(i,t.h-a),x:r,y:a,w:o}}function GP(e,t,n){return n*e<=t&&t<n*(e+1)}function qP(e,t){if(e.z===t.z)return e.x===t.x&&e.y===t.y;var n=e.z<t.z?e:t,i=e.z<t.z?t:e,r=1/UP({max:i.z,z:n.z}),a=GP(n.x,i.x,r),o=GP(n.y,i.y,r);return a&&o}function ZP(e){return e.w>0&&e.h>0}var XP,YP=function(){function e(t,n,i,r,a,o,s){Fd(this,e);var u={h:i,w:n};ZP(u)||console.warn("Original image size (".concat(n,", ").concat(i,") ")+"is invalid (".concat(t,"). Tiles will not be loaded.")),this._imageId=t,this._size=u,this._level={max:VP(this._size),z:-1},this._holder=new bP,this._updated$=new Af,this._createdSubject$=new Af,this._created$=this._createdSubject$.pipe(_v(1),Ef()),this._holder.push(this._created$.subscribe((function(){}))),this._hasSubject$=new Af,this._has$=this._hasSubject$.pipe(Mv(!1),_v(1),Ef()),this._holder.push(this._has$.subscribe((function(){}))),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=a,this._store=o,this._background=r,this._renderer=s,this._aborts=[],this._render=null,this._disposed=!1}return $d(e,[{key:"disposed",get:function(){return this._disposed}},{key:"hasTexture$",get:function(){return this._has$}},{key:"id",get:function(){return this._imageId}},{key:"textureUpdated$",get:function(){return this._updated$}},{key:"textureCreated$",get:function(){return this._created$}},{key:"abort",value:function(){this._subscriptions.forEach((function(e){return e.unsubscribe()})),this._subscriptions.clear();var e,t=Pd(this._aborts);try{for(t.s();!(e=t.n()).done;){var n=e.value;n()}}catch(MN){t.e(MN)}finally{t.f()}this._aborts=[]}},{key:"dispose",value:function(){this._disposed?console.warn("Texture already disposed (".concat(this._imageId,")")):(this._urlSubscriptions.forEach((function(e){return e.unsubscribe()})),this._urlSubscriptions.clear(),this.abort(),null!=this._render&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0)}},{key:"setRegionOfInterest",value:function(e){var t=this;if(ZP(this._size)){var n=1/e.pixelWidth,i=function(e,t,n){return Math.max(t,Math.min(n,VP(e)))}({h:1/e.pixelHeight,w:n},11,this._level.max);i!==this._level.z&&(this.abort(),this._level.z=i,this._renderedLevel.clear(),this._rendered.forEach((function(e,n){e.z===i&&t._renderedLevel.add(n)}))),null==this._render&&this._initRender();var r=function(e,t,n,i){var r=[];if(e.x>t.x){for(var a=jP(i),o=Math.ceil(n.w/a)-1,s=e.x;s<=o;s++)r.push(s);for(var u=0;u<=t.x;u++)r.push(u)}else for(var l=e.x;l<=t.x;l++)r.push(l);for(var c=[],h=0,d=r;h<d.length;h++)for(var f=d[h],p=e.y;p<=t.y;p++)c.push({x:f,y:p});return c}(HP([e.bbox.minX,e.bbox.minY],this._size,this._level),HP([e.bbox.maxX,e.bbox.maxY],this._size,this._level),this._size,this._level);this._fetchTiles(i,r)}}},{key:"_fetchTile",value:function(e){var t=this,n=this._loader.getImage$(e.url),i=n[0],r=n[1];this._aborts.push(r);var a=this._store.inventId(e),o=i.subscribe((function(n){var i=WP(e,t._size,t._level);t._renderToTarget(i,n),t._subscriptions.delete(a),t._removeFromArray(r,t._aborts),t._markRendered(e),t._store.add(a,n),t._updated$.next(!0)}),(function(e){t._subscriptions.delete(a),t._removeFromArray(r,t._aborts),console.error(e)}));o.closed||this._subscriptions.set(a,o)}},{key:"_fetchTiles",value:function(e,t){var n=this,i=(this._store.hasURLLevel(e)?pp(void 0):this._loader.getURLs$(this._imageId,e).pipe(Pv((function(t){n._store.hasURLLevel(e)||n._store.addURLs(e,t)})))).subscribe((function(){if(e===n._level.z){var i,r=Pd(t);try{for(r.s();!(i=r.n()).done;){var a=i.value,o={x:a.x,y:a.y,z:e,url:null},s=n._store.inventId(o);if(!n._renderedLevel.has(s)&&!n._subscriptions.has(s))if(n._store.has(s)){var u=WP(a,n._size,n._level);n._renderToTarget(u,n._store.get(s)),n._markRendered(o),n._updated$.next(!0)}else o.url=n._store.getURL(s),n._fetchTile(o)}}catch(MN){r.e(MN)}finally{r.f()}n._urlSubscriptions.delete(e)}}),(function(t){n._urlSubscriptions.delete(e),console.error(t)}));i.closed||this._urlSubscriptions.set(e,i)}},{key:"_initRender",value:function(){var e=this._size.w/2,t=this._size.h/2,n=new ky(-e,e,t,-t,-1,1);n.position.z=1;var i=this._renderer.getContext(),r=i.getParameter(i.MAX_TEXTURE_SIZE),a=Math.max(this._size.w,this._size.h),o=r>a?1:r/a,s=Math.floor(o*this._size.w),u=Math.floor(o*this._size.h),l=new Bm(s,u,{depthBuffer:!1,format:Zv,magFilter:$v,minFilter:$v,stencilBuffer:!1});this._render={camera:n,target:l};var c=WP({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(c,this._background),this._createdSubject$.next(l.texture),this._hasSubject$.next(!0)}},{key:"_markRendered",value:function(e){var t,n=Pd(Array.from(this._rendered.entries()).filter((function(t){var n=s(t,2);n[0];return n[1].z!==e.z})));try{for(n.s();!(t=n.n()).done;){var i=s(t.value,2),r=i[0],a=i[1];qP(e,a)&&this._rendered.delete(r)}}catch(MN){n.e(MN)}finally{n.f()}var o=this._store.inventId(e);this._rendered.set(o,e),this._renderedLevel.add(o)}},{key:"_removeFromArray",value:function(e,t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},{key:"_renderToTarget",value:function(e,t){var n=new Om(t);n.minFilter=$v,n.needsUpdate=!0;var i=new fy(e.w,e.h),r=new d_({map:n,side:0}),a=new W_(i,r);a.position.x=-this._size.w/2+e.x+e.w/2,a.position.y=this._size.h/2-e.y-e.h/2;var o=new ew;o.add(a);var s=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(o,this._render.camera),this._renderer.setRenderTarget(s),o.remove(a),i.dispose(),r.dispose(),n.dispose()}}]),e}();!function(e){e[e.Custom=0]="Custom",e[e.Earth=1]="Earth",e[e.Traversing=2]="Traversing",e[e.Waiting=3]="Waiting",e[e.WaitingInteractively=4]="WaitingInteractively"}(XP||(XP={}));var KP=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._imageTileLoader=new zP(r.api),a._roiCalculator=new BP,a._rendererOperation$=new Af,a._rendererCreator$=new Af,a._rendererDisposer$=new Af,a._renderer$=a._rendererOperation$.pipe(bv((function(e,t){return t(e)}),null),qp((function(e){return null!=e})),ov(void 0,(function(e){return e.frameId}))),a._rendererCreator$.pipe(xp((function(){return function(e){if(null!=e)throw new Error("Multiple image plane states can not be created at the same time");return new OP}}))).subscribe(a._rendererOperation$),a._rendererDisposer$.pipe(xp((function(){return function(e){return e.dispose(),null}}))).subscribe(a._rendererOperation$),a}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(this._renderer$.pipe(xp((function(t){var n={name:e._name,renderer:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),pass:RP.Background}};return t.clearNeedsRender(),n}))).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),t.push(this._navigator.stateService.currentState$.pipe(xp((function(e){return function(t){return t.updateFrame(e),t}}))).subscribe(this._rendererOperation$));var n=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?e._navigator.stateService.currentState$:new Af})),ov(void 0,(function(e){return e.state.currentImage.id})),Lv(this._container.glRenderer.webGLRenderer$),xp((function(t){var n=s(t,2),i=n[0],r=n[1],a=i.state,o=a.currentImage,u=a.currentTransform;return new YP(o.id,u.basicWidth,u.basicHeight,o.image,e._imageTileLoader,new FP,r)})),_v(1),Ef());t.push(n.subscribe((function(){}))),t.push(n.pipe(xp((function(e){return function(t){return t.setTextureProvider(e.id,e),t}}))).subscribe(this._rendererOperation$)),t.push(n.pipe(mv()).subscribe((function(e){e[0].abort()})));var i=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?Lp(e._navigator.stateService.state$,e._navigator.stateService.inTranslation$):new Af})),Tv((function(t){var n=s(t,2),i=n[0],r=n[1];return(i===XP.Traversing||i===XP.Waiting||i===XP.WaitingInteractively)&&!r?e._container.renderService.renderCameraFrame$:Hf()})),xp((function(e){return{camera:e,height:e.size.height.valueOf(),lookat:e.camera.lookat.clone(),width:e.size.width.valueOf(),zoom:e.zoom.valueOf()}})),mv(),xp((function(e){var t=s(e,2),n=t[0],i=t[1],r=n.width===i.width&&n.height===i.height&&n.zoom===i.zoom&&n.lookat.equals(i.lookat);return{camera:i.camera,stalled:r}})),ov((function(e,t){return e.stalled===t.stalled})),qp((function(e){return e.stalled})),Lv(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(n.pipe(Tv((function(t){return i.pipe(xp((function(n){var i=s(n,3),r=i[0],a=i[1],o=i[2],u=r.camera,l=(new MP).viewportToBasic(0,0,o,u.perspective);if(!(l[0]<0||l[1]<0||l[0]>1||l[1]>1))return[e._roiCalculator.computeRegionOfInterest(u,a,o),t]})),qp((function(e){return!!e})))})),qp((function(e){return!e[1].disposed}))).subscribe((function(e){var t=s(e,2),n=t[0];t[1].setRegionOfInterest(n)})));var r=n.pipe(Tv((function(e){return e.hasTexture$})),Mv(!1),_v(1),Ef());t.push(r.subscribe((function(){}))),t.push(this._navigator.panService.panImages$.pipe(qp((function(e){return 0===e.length})),xp((function(){return function(e){return e.clearPeripheryPlanes(),e}}))).subscribe(this._rendererOperation$));var a=this._navigator.panService.panImages$.pipe(Tv((function(t){return rp(t).pipe(Np((function(t){var n=s(t,2),i=n[0],r=n[1];return Lp(e._navigator.graphService.cacheImage$(i.id).pipe(Kp((function(e){return console.error("Failed to cache periphery image (".concat(i.id,")"),e),Hf()}))),pp(r))})))})),xv());t.push(a.pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return function(e){return e.addPeripheryPlane(n,i),e}}))).subscribe(this._rendererOperation$)),t.push(a.pipe(Np((function(e){return s(e,1)[0].cacheImage$().pipe(Kp((function(){return Hf()})))})),xp((function(e){return function(t){return t.updateTextureImage(e.image,e),t}}))).subscribe(this._rendererOperation$));var o=this._navigator.stateService.currentState$.pipe(xp((function(e){return e.state.alpha<1})),ov()),u=Lp(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,o).pipe(xp((function(e){var t=s(e,4),n=t[0],i=t[1],r=t[2],a=t[3];return!(n||i||r||a)})),qp((function(e){return e})));t.push(this._navigator.stateService.state$.pipe(Tv((function(t){return t===XP.Traversing?e._navigator.panService.panImages$:Hf()})),Tv((function(t){return u.pipe(Lv(e._container.renderService.renderCamera$,e._navigator.stateService.currentImage$,e._navigator.stateService.currentTransform$),Np((function(e){var n=s(e,4);return pp([n[1],n[2],n[3],t])})))})),Tv((function(t){var n=s(t,4),i=n[0],r=n[1],a=n[2],o=n[3],u=i.camera.lookat.clone().sub(i.camera.position),l=[(new WM).viewingDirection(r.rotation).angleTo(u),void 0],c=(new MP).viewportToBasic(0,0,a,i.perspective);c[0]>=0&&c[0]<=1&&c[1]>=0&&c[1]<=1&&(l[0]=Number.NEGATIVE_INFINITY);var h,d=Pd(o);try{for(d.s();!(h=d.n()).done;){var f=s(h.value,1)[0],p=(new WM).viewingDirection(f.rotation).angleTo(u);p<l[0]&&(l[0]=p,l[1]=f.id)}}catch(MN){d.e(MN)}finally{d.f()}return l[1]?e._navigator.moveTo$(l[1]).pipe(Kp((function(){return Hf()}))):Hf()}))).subscribe())}},{key:"_deactivate",value:function(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}}]),n}(xP);KP.componentName="image";var JP=function(){function e(t,n,i){Fd(this,e),this._component=t,this._container=n,this._navigator=i,this._enabled=!1}return $d(e,[{key:"isEnabled",get:function(){return this._enabled}},{key:"enable",value:function(){!this._enabled&&this._component.activated&&(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}},{key:"disable",value:function(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}]),e}(),QP=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$})));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(t)).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1],a=null;switch(i.keyCode){case 38:a=DM.Next;break;case 40:a=DM.Prev;break;default:return}if(i.preventDefault(),i.altKey&&!i.shiftKey&&r.cached){var o,u=Pd(r.edges);try{for(u.s();!(o=u.n()).done;){var l=o.value;if(l.data.direction===a)return void e._navigator.moveTo$(l.target).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))}}catch(MN){u.e(MN)}finally{u.f()}}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keySequenceNavigation:e}}}]),n}(JP),eL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._spatial=a,o}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.spatialEdges$})));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(t,this._navigator.stateService.currentState$)).subscribe((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2],o=qM(a.state.currentImage.cameraType),u=null;switch(i.keyCode){case 37:u=i.shiftKey&&!o?DM.TurnLeft:DM.StepLeft;break;case 38:u=i.shiftKey&&!o?DM.Spherical:DM.StepForward;break;case 39:u=i.shiftKey&&!o?DM.TurnRight:DM.StepRight;break;case 40:u=i.shiftKey&&!o?DM.TurnU:DM.StepBackward;break;default:return}if(i.preventDefault(),!(i.altKey||!r.cached||i.shiftKey&&o))if(o){var l={};l[DM.StepBackward]=Math.PI,l[DM.StepForward]=0,l[DM.StepLeft]=Math.PI/2,l[DM.StepRight]=-Math.PI/2;var c,h=e._rotationFromCamera(a.state.camera).phi,d=e._spatial.wrapAngle(h+l[u]),f=Math.PI/4,p=r.edges.filter((function(e){return e.data.direction===DM.Spherical||e.data.direction===u})),v=Number.MAX_VALUE,m=null,g=Pd(p);try{for(g.s();!(c=g.n()).done;){var _=c.value,y=Math.abs(e._spatial.wrapAngle(_.data.worldMotionAzimuth-d));y<Math.min(v,f)&&(v=y,m=_.target)}}catch(MN){g.e(MN)}finally{g.f()}if(null==m)return;e._moveTo(m)}else e._moveDir(u,r)}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keySpatialNavigation:e}}},{key:"_moveDir",value:function(e,t){var n,i=Pd(t.edges);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.data.direction===e)return void this._moveTo(r.target)}}catch(MN){i.e(MN)}finally{i.f()}}},{key:"_moveTo",value:function(e){this._navigator.moveTo$(e).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))}},{key:"_rotationFromCamera",value:function(e){var t=e.lookat.clone().sub(e.position),n=t.clone().dot(e.up),i=t.clone().sub(e.up.clone().multiplyScalar(n));return{phi:Math.atan2(i.y,i.x),theta:Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1])}}}]),n}(JP),tL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._viewportCoords=a,o}return $d(n,[{key:"_enable",value:function(){var e=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2];if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0;switch(i.key){case"+":o=1;break;case"-":o=-1;break;default:return}i.preventDefault();var u=e._viewportCoords.unprojectFromViewport(0,0,r.perspective),l=a.projectBasic(u.toArray());e._navigator.stateService.zoomIn(o,l)}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keyZoom:e}}}]),n}(JP),nL=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enable",value:function(){var e=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Lv(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$}))),this._navigator.stateService.state$.pipe(xp((function(e){return e===XP.Earth})),ov()))).subscribe((function(t){var n=s(t,6),i=n[0],r=n[1],a=n[2],o=n[3],u=n[4],l=n[5];if(!(i.altKey||i.ctrlKey||i.metaKey)){switch(i.key){case"D":if(!i.shiftKey)return;var c=r?null:a===DM.Next?DM.Prev:a===DM.Prev?DM.Next:null;null!=c&&e._navigator.playService.setDirection(c);break;case" ":if(i.shiftKey)return;if(!l)if(r)e._navigator.playService.stop();else{var h,d=Pd(u.edges);try{for(d.s();!(h=d.n()).done;){h.value.data.direction===a&&e._navigator.playService.play()}}catch(MN){d.e(MN)}finally{d.f()}}break;case"<":e._navigator.playService.setSpeed(o-.05);break;case">":e._navigator.playService.setSpeed(o+.05);break;default:return}i.preventDefault()}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(e){return{keyPlay:e}}}]),n}(JP),iL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._keyPlayHandler=new nL(Ad(a),i,r),a._keySequenceNavigationHandler=new QP(Ad(a),i,r),a._keySpatialNavigationHandler=new eL(Ad(a),i,r,new WM),a._keyZoomHandler=new tL(Ad(a),i,r,new MP),a}return $d(n,[{key:"keyPlay",get:function(){return this._keyPlayHandler}},{key:"keySequenceNavigation",get:function(){return this._keySequenceNavigationHandler}},{key:"keySpatialNavigation",get:function(){return this._keySpatialNavigationHandler}},{key:"keyZoom",get:function(){return this._keyZoomHandler}},{key:"_activate",value:function(){var e=this;this._subscriptions.push(this._configuration$.subscribe((function(t){t.keyPlay?e._keyPlayHandler.enable():e._keyPlayHandler.disable(),t.keySequenceNavigation?e._keySequenceNavigationHandler.enable():e._keySequenceNavigationHandler.disable(),t.keySpatialNavigation?e._keySpatialNavigationHandler.enable():e._keySpatialNavigationHandler.disable(),t.keyZoom?e._keyZoomHandler.enable():e._keyZoomHandler.disable()})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}},{key:"_getDefaultConfiguration",value:function(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}]),n}(xP);iL.componentName="keyboard";var rL=function(){function e(t,n){Fd(this,e),this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=n||new _M,this._scene=t||new ew}return $d(e,[{key:"markers",get:function(){return this._markers}},{key:"needsRender",get:function(){return this._needsRender}},{key:"add",value:function(e,t){e.id in this._markers&&this._dispose(e.id),e.createGeometry(t),this._scene.add(e.geometry),this._markers[e.id]=e;var n,i=Pd(e.getInteractiveObjects());try{for(i.s();!(n=i.n()).done;){var r=n.value;this._interactiveObjects.push(r),this._objectMarkers[r.uuid]=e.id}}catch(MN){i.e(MN)}finally{i.f()}this._needsRender=!0}},{key:"clear",value:function(){for(var e in this._markers)this._markers.hasOwnProperty&&this._dispose(e);this._needsRender=!0}},{key:"get",value:function(e){return this._markers[e]}},{key:"getAll",value:function(){var e=this;return Object.keys(this._markers).map((function(t){return e._markers[t]}))}},{key:"has",value:function(e){return e in this._markers}},{key:"intersectObjects",value:function(e,t){var n=s(e,2),i=n[0],r=n[1];this._raycaster.setFromCamera(new Em(i,r),t);var a,o=Pd(this._raycaster.intersectObjects(this._interactiveObjects));try{for(o.s();!(a=o.n()).done;){var u=a.value;if(u.object.uuid in this._objectMarkers)return this._objectMarkers[u.object.uuid]}}catch(MN){o.e(MN)}finally{o.f()}return null}},{key:"lerpAltitude",value:function(e,t,n){e in this._markers&&(this._markers[e].lerpAltitude(t,n),this._needsRender=!0)}},{key:"remove",value:function(e){e in this._markers&&(this._dispose(e),this._needsRender=!0)}},{key:"render",value:function(e,t){t.render(this._scene,e),this._needsRender=!1}},{key:"update",value:function(e,t,n){e in this._markers&&(this._markers[e].updatePosition(t,n),this._needsRender=!0)}},{key:"_dispose",value:function(e){var t=this._markers[e];this._scene.remove(t.geometry);var n,i=Pd(t.getInteractiveObjects());try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this._interactiveObjects.indexOf(r);-1!==a?this._interactiveObjects.splice(a,1):console.warn("Object does not exist (".concat(r.id,") for ").concat(e)),delete this._objectMarkers[r.uuid]}}catch(MN){i.e(MN)}finally{i.f()}t.disposeGeometry(),delete this._markers[e]}}]),e}(),aL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._graphCalculator=new OM,a._markerScene=new rL,a._markerSet=new eT,a._viewportCoords=new MP,a._relativeGroundAltitude=-2,a}return $d(n,[{key:"add",value:function(e){this._markerSet.add(e)}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"get",value:function(e){return this._markerSet.get(e)}},{key:"getAll",value:function(){return this._markerSet.getAll()}},{key:"getMarkerIdAt",value:function(e){var t=this;return new Promise((function(n,i){t._container.renderService.renderCamera$.pipe(dv(),xp((function(n){var i=t._viewportCoords.canvasToViewport(e[0],e[1],t._container.container);return t._markerScene.intersectObjects(i,n.perspective)}))).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"has",value:function(e){return this._markerSet.has(e)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"remove",value:function(e){this._markerSet.remove(e)}},{key:"removeAll",value:function(){this._markerSet.removeAll()}},{key:"_activate",value:function(){var e=this,t=this._navigator.stateService.currentState$.pipe(xp((function(t){return t.state.camera.position.z+e._relativeGroundAltitude})),ov((function(e,t){return Math.abs(e-t)<.01})),_v(1),Ef()),n=Lp(t,this._navigator.stateService.reference$).pipe(dv(),xp((function(){})),_v(1),Ef()),i=this._configuration$.pipe(xp((function(e){return{visibleBBoxSize:Math.max(1,Math.min(200,e.visibleBBoxSize))}}))),r=this._navigator.stateService.currentImage$.pipe(xp((function(e){return e.lngLat})),_v(1),Ef()),a=Lp(i,r).pipe(xp((function(t){var n=s(t,2),i=n[0],r=n[1];return e._graphCalculator.boundingBoxCorners(r,i.visibleBBoxSize/2)})),_v(1),Ef()),o=Lp(zp(pp(this._markerSet),this._markerSet.changed$),a).pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return n.search(i)}))),u=this._subscriptions;u.push(n.pipe(Tv((function(){return o.pipe(Lv(e._navigator.stateService.reference$,t))}))).subscribe((function(t){var n,i=s(t,3),r=i[0],a=i[1],o=i[2],u=e._markerScene,l=u.markers,c=Object.assign({},l),h=Pd(r);try{for(h.s();!(n=h.n()).done;){var d=n.value;if(d.id in l)delete c[d.id];else{var f=IM(d.lngLat.lng,d.lngLat.lat,a.alt+o,a.lng,a.lat,a.alt);u.add(d,f)}}}catch(MN){h.e(MN)}finally{h.f()}for(var p in c)c.hasOwnProperty(p)&&u.remove(p)}))),u.push(n.pipe(Tv((function(){return e._markerSet.updated$.pipe(Lv(a,e._navigator.stateService.reference$,t))}))).subscribe((function(t){var n,i=s(t,4),r=i[0],a=s(i[1],2),o=a[0],u=a[1],l=i[2],c=i[3],h=e._markerScene,d=Pd(r);try{for(d.s();!(n=d.n()).done;){var f=n.value,p=h.has(f.id),v=f.lngLat.lat>o.lat&&f.lngLat.lat<u.lat&&f.lngLat.lng>o.lng&&f.lngLat.lng<u.lng;if(v){var m=IM(f.lngLat.lng,f.lngLat.lat,l.alt+c,l.lng,l.lat,l.alt);h.add(f,m)}else!v&&p&&h.remove(f.id)}}catch(MN){d.e(MN)}finally{d.f()}}))),u.push(this._navigator.stateService.reference$.pipe(kv(1),Lv(t)).subscribe((function(t){var n,i=s(t,2),r=i[0],a=i[1],o=e._markerScene,u=Pd(o.getAll());try{for(u.s();!(n=u.n()).done;){var l=n.value,c=IM(l.lngLat.lng,l.lngLat.lat,r.alt+a,r.lng,r.lat,r.alt);o.update(l.id,c)}}catch(MN){u.e(MN)}finally{u.f()}}))),u.push(t.pipe(kv(1),Lv(this._navigator.stateService.reference$,r)).subscribe((function(t){var n,i=s(t,3),r=i[0],a=i[1],o=i[2],u=e._markerScene,l=IM(o.lng,o.lat,a.alt+r,a.lng,a.lat,a.alt),c=Pd(u.getAll());try{for(c.s();!(n=c.n()).done;){var h=n.value,d=IM(h.lngLat.lng,h.lngLat.lat,a.alt+r,a.lng,a.lat,a.alt),f=d[0]-l[0],p=d[1]-l[1],v=Math.sqrt(f*f+p*p);v>50||u.lerpAltitude(h.id,r,Math.min(1,Math.max(0,1.2-1.2*v/50)))}}catch(MN){c.e(MN)}finally{c.f()}}))),u.push(this._navigator.stateService.currentState$.pipe(xp((function(t){var n=e._markerScene;return{name:e._name,renderer:{frameId:t.id,needsRender:n.needsRender,render:n.render.bind(n),pass:RP.Opaque}}}))).subscribe(this._container.glRenderer.render$));var l=Lp(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(xp((function(t){var n=s(t,2),i=n[0],r=n[1],a=e._container.container,o=s(e._viewportCoords.canvasPosition(r,a),2),u=o[0],l=o[1],c=e._viewportCoords.canvasToViewport(u,l,a);return e._markerScene.intersectObjects(c,i.perspective)})),_v(1),Ef()),c=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(xp((function(){return!0}))),h=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(xp((function(){return!1}))),d=Hp(c,h).pipe(Mv(!1));u.push(Hp(c.pipe(Lv(l)),Lp(h,pp(null))).pipe(Mv([!1,null]),mv()).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1],a=r[0],o=a?"markerdragstart":"markerdragend",u=a?r[1]:i[1],l={marker:e._markerScene.get(u),target:e,type:o};e.fire(o,l)})));var f=Hp(this._container.mouseService.mouseDown$.pipe(xp((function(){return!0}))),this._container.mouseService.documentMouseUp$.pipe(xp((function(){return!1})))).pipe(Mv(!1));u.push(Lp(this._container.mouseService.active$,l.pipe(ov()),f,d).pipe(xp((function(e){var t=s(e,4),n=t[0],i=t[1],r=t[2],a=t[3];return!n&&null!=i&&r||a})),ov()).subscribe((function(t){t?(e._container.mouseService.claimMouse(e._name,1),e._container.mouseService.claimWheel(e._name,1)):(e._container.mouseService.unclaimMouse(e._name),e._container.mouseService.unclaimWheel(e._name))})));var p=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(Lv(l,this._container.renderService.renderCamera$),xp((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2],o=e._markerScene.get(r),u=e._container.container,l=s(e._viewportCoords.projectToCanvas(o.geometry.position.toArray(),u,a.perspective),2),c=l[0],h=l[1],d=s(e._viewportCoords.canvasPosition(i,u),2);return[o,[d[0]-c,d[1]-h],a]})),_v(1),Ef());u.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(Lv(p,this._navigator.stateService.reference$,i)).subscribe((function(t){var n=s(t,4),i=n[0],r=s(n[1],3),a=r[0],o=r[1],u=r[2],l=n[2],c=n[3];if(e._markerScene.has(a.id)){var h=e._container.container,d=s(e._viewportCoords.canvasPosition(i,h),2),f=d[0],p=d[1],v=f-o[0],m=p-o[1],g=s(e._viewportCoords.canvasToViewport(v,m,h),2),_=g[0],y=g[1],b=new Vm(_,y,1).unproject(u.perspective).sub(u.perspective.position).normalize(),x=Math.min(e._relativeGroundAltitude/b.z,c.visibleBBoxSize/2-.1);if(!(x<0)){var w=b.clone().multiplyScalar(x).add(u.perspective.position);w.z=u.perspective.position.z+e._relativeGroundAltitude;var k=s(RM(w.x,w.y,w.z,l.lng,l.lat,l.alt),2),S=k[0],M=k[1];e._markerScene.update(a.id,w.toArray(),{lat:M,lng:S}),e._markerSet.update(a);var T="markerposition",C={marker:a,target:e,type:T};e.fire(T,C)}}})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._markerScene.clear()}},{key:"_getDefaultConfiguration",value:function(){return{visibleBBoxSize:100}}}]),n}(xP);function oL(e,t){return e.x<=Math.max(t.p1.x,t.p2.x)&&e.x>=Math.min(t.p1.x,t.p2.x)&&e.y>=Math.max(t.p1.y,t.p2.y)&&e.y>=Math.min(t.p1.y,t.p2.y)}function sL(e,t){var n=e.p2.x-e.p1.x,i=e.p2.y-e.p1.y,r=t.p2.x-t.p1.x,a=t.p2.y-t.p1.y,o=n*a-i*r;return o*o<1e-10*(n*n+i*i)*(r*r+a*a)}function uL(e,t,n){var i,r=(t.y-e.y)*(n.x-t.x)-(n.y-t.y)*(t.x-e.x);return(i=r)>0?1:i<0?-1:0}function lL(e,t){if(sL(e,t))return!1;var n=uL(e.p1,e.p2,t.p1),i=uL(e.p1,e.p2,t.p2),r=uL(t.p1,t.p2,e.p1),a=uL(t.p1,t.p2,e.p2);return n!==i&&r!==a||(!(0!==n||!oL(t.p1,e))||(!(0!==i||!oL(t.p2,e))||(!(0!==r||!oL(e.p1,t))||!(0!==a||!oL(e.p2,t)))))}function cL(e,t){if(!sL(e,t)){var n=e.p1.x,i=e.p2.x,r=e.p1.y,a=e.p2.y,o=t.p1.x,s=t.p2.x,u=t.p1.y,l=t.p2.y,c=(n-i)*(u-l)-(r-a)*(o-s);return{x:((n*a-r*i)*(o-s)-(n-i)*(o*l-u*s))/c,y:((n*a-r*i)*(u-l)-(r-a)*(o*l-u*s))/c}}}function hL(e,t){return e>=-1&&e<=1&&t>=-1&&t<=1}function dL(e,t){return e>=0&&e<=1&&t>=0&&t<=1}function fL(e,t,n){for(var i=function(e){for(var t=[],n=[[0,0],[1,0],[1,1],[0,1]],i=[[1,0],[0,1],[-1,0],[0,-1]],r=0;r<4;++r)for(var a=n[r],o=i[r],s=0;s<e;++s)t.push([a[0]+o[0]*s/e,a[1]+o[1]*s/e]);return t}(100),r=i.map((function(i){return n.basicToViewportSafe(i[0],i[1],e,t)})),a=[],o=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],u=[!1,!1,!1,!1],l=0;l<r.length;l++){var c=r[l],h=r[(l+1)%r.length];if(null!==c)if(null!==h){var d=s(c,2),f=d[0],p=d[1],v=s(h,2),m=v[0],g=v[1];if(hL(f,p))if(hL(m,g))a.push(c);else for(var _=0;_<4;_++){var y={p1:{x:f,y:p},p2:{x:m,y:g}},b={p1:o[_],p2:o[(_+1)%4]};if(lL(y,b)){var x=cL(y,b);a.push(c,[x.x,x.y]),u[_]=!0}}}else hL(c[0],c[1])&&a.push(c)}var w=s(n.viewportToBasic(-1,1,e,t),2),k=w[0],S=w[1],M=s(n.viewportToBasic(1,1,e,t),2),T=M[0],C=M[1],E=s(n.viewportToBasic(1,-1,e,t),2),P=E[0],L=E[1],A=s(n.viewportToBasic(-1,-1,e,t),2),I=A[0],R=A[1];dL(k,S)&&(u[3]=u[0]=!0),dL(T,C)&&(u[0]=u[1]=!0),dL(P,L)&&(u[1]=u[2]=!0),dL(I,R)&&(u[2]=u[3]=!0);for(var N=[-1,-1,1,1],D=0,O=a;D<O.length;D++){var z=O[D],F=z[0],B=z[1];F>N[1]&&(N[1]=F),F<N[3]&&(N[3]=F),B>N[0]&&(N[0]=B),B<N[2]&&(N[2]=B)}var $=[1,1,-1,-1],j=[];for(_=0;_<4;_++)u[_]?j.push(0):j.push(Math.abs($[_]-N[_]));return j}aL.componentName="marker";var pL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o){var s;return Fd(this,n),(s=t.call(this,e,i,r))._spatial=o,s._viewportCoords=a,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.currentState$.pipe(xp((function(e){return e.state.alpha<1})),ov());this._bounceSubscription=Lp(t,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(xp((function(e){return e[0]||e[1]||e[2]||e[3]})),ov(),Tv((function(t){return t?Hf():Lp(e._container.renderService.renderCamera$,e._navigator.stateService.currentTransform$.pipe(dv()))})),Lv(this._navigator.panService.panImages$)).subscribe((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1];if((a.hasValidScale||!(r.camera.focal<.1))&&0!==r.perspective.aspect&&r.perspective.aspect!==Number.POSITIVE_INFINITY){var u=fL(a,r.perspective,e._viewportCoords),l=e._viewportCoords.viewportToBasic(0,0,a,r.perspective);(l[0]<0||l[0]>1)&&o.length>0&&(u[0]=u[2]=0);var c,h=Pd(o);try{for(h.s();!(c=h.n()).done;)for(var d=fL(s(c.value,2)[1],r.perspective,e._viewportCoords),f=1;f<u.length;f+=2)d[f]<u[f]&&(u[f]=d[f])}catch(MN){h.e(MN)}finally{h.f()}if(!(Math.max.apply(Math,wd(u))<.01)){var p=u[1]-u[3],v=u[0]-u[2],m=e._viewportCoords.unprojectFromViewport(0,0,r.perspective).sub(r.perspective.position),g=e._viewportCoords.unprojectFromViewport(p,0,r.perspective).sub(r.perspective.position),_=e._viewportCoords.unprojectFromViewport(0,v,r.perspective).sub(r.perspective.position),y=(p>0?1:-1)*g.angleTo(m),b=(v>0?1:-1)*_.angleTo(m),x=Math.PI/60;y=e._spatial.clamp(.1*y,-x,x),b=e._spatial.clamp(.1*b,-x,x),e._navigator.stateService.rotateUnbounded({phi:y,theta:b})}}}))}},{key:"_disable",value:function(){this._bounceSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(){return{}}}]),n}(JP),vL=function(){function e(){Fd(this,e)}return $d(e,null,[{key:"filteredPairwiseMouseDrag$",value:function(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseDragStart$,t.mouseDrag$,t.mouseDragEnd$)}},{key:"filteredPairwiseMouseRightDrag$",value:function(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseRightDragStart$,t.mouseRightDrag$,t.mouseRightDragEnd$)}},{key:"_filteredPairwiseMouseDrag$",value:function(e,t,n,i,r){return t.filtered$(e,n).pipe(Tv((function(n){return Hp(zp(pp(n),t.filtered$(e,i)),t.filtered$(e,r).pipe(xp((function(){return null})))).pipe(Ev((function(e){return!!e})),Mv(null))})),mv(),qp((function(e){return null!=e[0]&&null!=e[1]})))}}]),e}(),mL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o){var s;return Fd(this,n),(s=t.call(this,e,i,r))._spatial=o,s._viewportCoords=a,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(xp((function(){return!0})),xv()),n=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(xp((function(){return!1})),xv());this._activeMouseSubscription=Hp(t,n).subscribe(this._container.mouseService.activate$);var i=Hp(t,n).pipe(Tv((function(t){return t?e._container.mouseService.documentMouseMove$:Hf()})));this._preventDefaultSubscription=Hp(i,this._container.touchService.touchMove$).subscribe((function(e){e.preventDefault()}));var r=this._container.touchService.singleTouchDragStart$.pipe(xp((function(){return!0}))),a=this._container.touchService.singleTouchDragEnd$.pipe(xp((function(){return!1})));this._activeTouchSubscription=Hp(r,a).subscribe(this._container.touchService.activate$);var o,u=this._navigator.stateService.currentState$.pipe(xp((function(e){return qM(e.state.currentImage.cameraType)||e.state.imagesAhead<1})),ov(),Tv((function(t){if(!t)return Hf();var n=vL.filteredPairwiseMouseDrag$(e._component.name,e._container.mouseService),i=Hp(e._container.touchService.singleTouchDragStart$,e._container.touchService.singleTouchDrag$,e._container.touchService.singleTouchDragEnd$.pipe(xp((function(){return null})))).pipe(xp((function(e){return null!=e&&e.touches.length>0?e.touches[0]:null})),mv(),qp((function(e){return null!=e[0]&&null!=e[1]})));return Hp(n,i)})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),xp((function(t){var n,i=s(t,4),r=i[0],a=i[1],o=i[2],u=i[3],l=r[0],c=r[1],h=c.clientX-l.clientX,d=c.clientY-l.clientY,f=e._container.container,p=s(e._viewportCoords.canvasPosition(c,f),2),v=p[0],m=p[1],g=e._viewportCoords.unprojectFromCanvas(v,m,f,a.perspective).sub(a.perspective.position),_=e._viewportCoords.unprojectFromCanvas(v-h,m,f,a.perspective).sub(a.perspective.position),y=e._viewportCoords.unprojectFromCanvas(v,m-d,f,a.perspective).sub(a.perspective.position),b=(h>0?1:-1)*_.angleTo(g),x=(d>0?-1:1)*y.angleTo(g),w=fL(o,a.perspective,e._viewportCoords),k=Pd(u);try{for(k.s();!(n=k.n()).done;)for(var S=fL(s(n.value,2)[1],a.perspective,e._viewportCoords),M=0;M<w.length;M++)S[M]<w[M]&&(w[M]=S[M])}catch(MN){k.e(MN)}finally{k.f()}return w[0]>0&&x<0&&(x/=Math.max(1,200*w[0])),w[2]>0&&x>0&&(x/=Math.max(1,200*w[2])),w[1]>0&&b<0&&(b/=Math.max(1,200*w[1])),w[3]>0&&b>0&&(b/=Math.max(1,200*w[3])),{phi:b,theta:x}})),xv());this._rotateWithoutInertiaSubscription=u.subscribe((function(t){e._navigator.stateService.rotateWithoutInertia(t)})),this._rotateSubscription=u.pipe(bv((function(t,n){return e._drainBuffer(t),t.push([Date.now(),n]),t}),[]),(o=Hp(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$),Tf((function(e,t){var n=!1,i=null;e.subscribe(new Cf(t,(function(e){n=!0,i=e}))),o.subscribe(new Cf(t,(function(){if(n){n=!1;var e=i;i=null,t.next(e)}}),lf))}))),xp((function(t){var n,i=e._drainBuffer(t.slice()),r={phi:0,theta:0},a=Pd(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.phi+=o[1].phi,r.theta+=o[1].theta}}catch(MN){a.e(MN)}finally{a.f()}var s=i.length;s>0&&(r.phi/=s,r.theta/=s);var u=Math.PI/18;return r.phi=e._spatial.clamp(r.phi,-u,u),r.theta=e._spatial.clamp(r.theta,-u,u),r}))).subscribe((function(t){e._navigator.stateService.rotate(t)}))}},{key:"_disable",value:function(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}},{key:"_getConfiguration",value:function(e){return{dragPan:e}}},{key:"_drainBuffer",value:function(e){for(var t=Date.now();e.length>0&&t-e[0][0]>50;)e.shift();return e}}]),n}(JP),gL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o){var s;return Fd(this,n),(s=t.call(this,e,i,r))._spatial=o,s._viewportCoords=a,s._subscriptions=new bP,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._navigator.stateService.state$.pipe(xp((function(e){return e===XP.Earth})),_v(1),Ef()),n=this._subscriptions;n.push(t.pipe(Tv((function(t){return t?e._container.mouseService.mouseWheel$:Hf()}))).subscribe((function(e){e.preventDefault()}))),n.push(t.pipe(Tv((function(t){return t?vL.filteredPairwiseMouseDrag$(e._component.name,e._container.mouseService).pipe(qp((function(e){var t=s(e,2),n=t[0],i=t[1];return!(n.ctrlKey&&i.ctrlKey)}))):Hf()})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),xp((function(t){var n=s(t,3),i=s(n[0],2),r=i[0],a=i[1],o=n[1],u=(n[2],[0,0,1]),l=[0,0,-2],c=e._planeIntersection(a,u,l,o.perspective,e._container.container),h=e._planeIntersection(r,u,l,o.perspective,e._container.container);return c&&h?(new Vm).subVectors(c,h).multiplyScalar(-1).toArray():null})),qp((function(e){return!!e}))).subscribe((function(t){e._navigator.stateService.truck(t)}))),n.push(t.pipe(Tv((function(t){return t?vL.filteredPairwiseMouseDrag$(e._component.name,e._container.mouseService).pipe(qp((function(e){var t=s(e,2),n=t[0],i=t[1];return n.ctrlKey&&i.ctrlKey}))):Hf()})),xp((function(t){var n=s(t,2),i=n[0],r=n[1];return e._mousePairToRotation(i,r)}))).subscribe((function(t){e._navigator.stateService.orbit(t)}))),n.push(t.pipe(Tv((function(t){return t?vL.filteredPairwiseMouseRightDrag$(e._component.name,e._container.mouseService).pipe(qp((function(e){var t=s(e,2),n=t[0],i=t[1];return!n.ctrlKey&&!i.ctrlKey}))):Hf()})),xp((function(t){var n=s(t,2),i=n[0],r=n[1];return e._mousePairToRotation(i,r)}))).subscribe((function(t){e._navigator.stateService.orbit(t)}))),n.push(t.pipe(Tv((function(t){return t?e._container.mouseService.filteredWheel$(e._component.name,e._container.mouseService.mouseWheel$):Hf()})),xp((function(t){var n=t.deltaY;return 1===t.deltaMode?n*=40:2===t.deltaMode&&(n*=800),-n/e._viewportCoords.containerToCanvas(e._container.container)[1]}))).subscribe((function(t){e._navigator.stateService.dolly(t)})))}},{key:"_disable",value:function(){this._subscriptions.unsubscribe()}},{key:"_getConfiguration",value:function(){return{}}},{key:"_eventToViewport",value:function(e,t){var n=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToViewport(n[0],n[1],t)}},{key:"_mousePairToRotation",value:function(e,t){var n=s(this._eventToViewport(t,this._container.container),2),i=n[0],r=n[1],a=s(this._eventToViewport(e,this._container.container),2),o=a[0],u=a[1];return{phi:(o-i)*Math.PI,theta:(r-u)*Math.PI/2}}},{key:"_planeIntersection",value:function(e,t,n,i,r){var a=s(this._viewportCoords.canvasPosition(e,r),2),o=a[0],u=a[1],l=this._viewportCoords.unprojectFromCanvas(o,u,r,i).sub(i.position).normalize();if(Math.abs(this._spatial.angleToPlane(l.toArray(),t))<Math.PI/90)return null;var c=i.position.clone(),h=(new Vm).fromArray(t),d=(new Vm).fromArray(n),f=(new Vm).subVectors(d,c).dot(h)/l.clone().dot(h),p=(new Vm).addVectors(c,l.multiplyScalar(f));return this._viewportCoords.worldToCamera(p.toArray(),i)[2]>0?null:p}}]),n}(JP),_L=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._viewportCoords=a,o}return $d(n,[{key:"_enable",value:function(){var e=this;this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe((function(e){e.preventDefault()})),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(Lv(this._navigator.stateService.currentState$,(function(e,t){return[e,t]})),qp((function(e){var t=e[1].state;return qM(t.currentImage.cameraType)||t.imagesAhead<1})),xp((function(e){return e[0]})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,(function(e,t,n){return[e,t,n]}))).subscribe((function(t){var n=t[0],i=t[1],r=t[2],a=e._container.container,o=s(e._viewportCoords.canvasPosition(n,a),2),u=o[0],l=o[1],c=e._viewportCoords.unprojectFromCanvas(u,l,a,i.perspective),h=r.projectBasic(c.toArray()),d=n.deltaY;1===n.deltaMode?d*=40:2===n.deltaMode&&(d*=800);var f=-3*d/e._viewportCoords.containerToCanvas(a)[1];e._navigator.stateService.zoomIn(f,h)}))}},{key:"_disable",value:function(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}},{key:"_getConfiguration",value:function(e){return{scrollZoom:e}}}]),n}(JP),yL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._viewportCoords=a,o}return $d(n,[{key:"_enable",value:function(){var e=this;this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe((function(e){e.originalEvent.preventDefault()}));var t=this._container.touchService.pinchStart$.pipe(xp((function(e){return!0}))),n=this._container.touchService.pinchEnd$.pipe(xp((function(e){return!1})));this._activeSubscription=Hp(t,n).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(Lv(this._navigator.stateService.currentState$),qp((function(e){var t=e[1].state;return qM(t.currentImage.cameraType)||t.imagesAhead<1})),xp((function(e){return e[0]})),Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2],o=e._container.container,u=s(e._viewportCoords.canvasPosition(i,o),2),l=u[0],c=u[1],h=e._viewportCoords.unprojectFromCanvas(l,c,o,r.perspective),d=a.projectBasic(h.toArray()),f=s(e._viewportCoords.containerToCanvas(o),2),p=f[0],v=f[1],m=3*i.distanceChange/Math.min(p,v);e._navigator.stateService.zoomIn(m,d)}))}},{key:"_disable",value:function(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}},{key:"_getConfiguration",value:function(e){return{touchZoom:e}}}]),n}(JP),bL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;Fd(this,n),a=t.call(this,e,i,r);var o=new WM,s=new MP;return a._bounceHandler=new pL(Ad(a),i,r,s,o),a._dragPanHandler=new mL(Ad(a),i,r,s,o),a._earthControlHandler=new gL(Ad(a),i,r,s,o),a._scrollZoomHandler=new _L(Ad(a),i,r,s),a._touchZoomHandler=new yL(Ad(a),i,r,s),a}return $d(n,[{key:"dragPan",get:function(){return this._dragPanHandler}},{key:"earthControl",get:function(){return this._earthControlHandler}},{key:"scrollZoom",get:function(){return this._scrollZoomHandler}},{key:"touchZoom",get:function(){return this._touchZoomHandler}},{key:"_activate",value:function(){var e=this;this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe((function(t){t.dragPan?e._dragPanHandler.enable():e._dragPanHandler.disable(),t.earthControl?e._earthControlHandler.enable():e._earthControlHandler.disable(),t.scrollZoom?e._scrollZoomHandler.enable():e._scrollZoomHandler.disable(),t.touchZoom?e._touchZoomHandler.enable():e._touchZoomHandler.disable()}))),this._container.mouseService.claimMouse(this._name,0)}},{key:"_deactivate",value:function(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}},{key:"_getDefaultConfiguration",value:function(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}]),n}(xP);bL.componentName="pointer";var xL,wL,kL=function(){function e(t){Fd(this,e),this._document=t||document}return $d(e,[{key:"document",get:function(){return this._document}},{key:"createElement",value:function(e,t,n){var i=this._document.createElement(e);return t&&(i.className=t),n&&n.appendChild(i),i}}]),e}(),SL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._dom=a||new kL,o._popups=[],o._added$=new Af,o._popups$=new Af,o}return $d(n,[{key:"add",value:function(e){var t,n=Pd(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;-1===this._popups.indexOf(i)&&(this._popups.push(i),this._activated&&i.setParentContainer(this._popupContainer))}}catch(MN){n.e(MN)}finally{n.f()}this._added$.next(e),this._popups$.next(this._popups)}},{key:"getAll",value:function(){return this._popups.slice()}},{key:"remove",value:function(e){var t,n=Pd(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._remove(i)}}catch(MN){n.e(MN)}finally{n.f()}this._popups$.next(this._popups)}},{key:"removeAll",value:function(){var e,t=Pd(this._popups.slice());try{for(t.s();!(e=t.n()).done;){var n=e.value;this._remove(n)}}catch(MN){t.e(MN)}finally{t.f()}this._popups$.next(this._popups)}},{key:"_activate",value:function(){var e=this;this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);var t,n=Pd(this._popups);try{for(n.s();!(t=n.n()).done;){t.value.setParentContainer(this._popupContainer)}}catch(MN){n.e(MN)}finally{n.f()}var i=this._subscriptions;i.push(Lp(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe((function(t){var n,i=s(t,3),r=i[0],a=i[1],o=i[2],u=Pd(e._popups);try{for(u.s();!(n=u.n()).done;){n.value.update(r,a,o)}}catch(MN){u.e(MN)}finally{u.f()}})));var r=this._popups$.pipe(Mv(this._popups),Tv((function(e){return rp(e).pipe(Np((function(e){return e.changed$})))})),xp((function(e){return[e]})));i.push(Hp(this._added$,r).pipe(Lv(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe((function(e){var t,n=s(e,4),i=n[0],r=n[1],a=n[2],o=n[3],u=Pd(i);try{for(u.s();!(t=u.n()).done;){t.value.update(r,a,o)}}catch(MN){u.e(MN)}finally{u.f()}})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe();var e,t=Pd(this._popups);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(MN){t.e(MN)}finally{t.f()}this._container.container.removeChild(this._popupContainer),delete this._popupContainer}},{key:"_getDefaultConfiguration",value:function(){return{}}},{key:"_remove",value:function(e){var t=this._popups.indexOf(e);if(-1!==t){var n=this._popups.splice(t,1)[0];this._activated&&n.remove()}}}]),n}(xP);SL.componentName="popup",function(e){e[e.Sequence=0]="Sequence",e[e.Spatial=1]="Spatial"}(xL||(xL={})),function(e){e[e.Default=0]="Default",e[e.Playback=1]="Playback",e[e.Timeline=2]="Timeline"}(wL||(wL={}));var ML,TL=function(){function e(t){Fd(this,e),this._container=t,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=wL.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new Af,this._mouseLeaveDirection$=new Af,this._notifyChanged$=new Af,this._notifyChangingPositionChanged$=new Af,this._notifySpeedChanged$=new Af,this._notifyIndexChanged$=new Af}return $d(e,[{key:"changed$",get:function(){return this._notifyChanged$}},{key:"changingPositionChanged$",get:function(){return this._notifyChangingPositionChanged$}},{key:"speed$",get:function(){return this._notifySpeedChanged$}},{key:"index$",get:function(){return this._notifyIndexChanged$}},{key:"mouseEnterDirection$",get:function(){return this._mouseEnterDirection$}},{key:"mouseLeaveDirection$",get:function(){return this._mouseLeaveDirection$}},{key:"activate",value:function(){var e=this;this._changingSubscription||(this._changingSubscription=Hp(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(qp((function(e){return 0===e.touches.length})))).subscribe((function(){e._changingSpeed&&(e._changingSpeed=!1),e._changingPosition&&e._setChangingPosition(!1)})))}},{key:"deactivate",value:function(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=wL.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}},{key:"render",value:function(e,t,n,i,r,a,o,s,u){if(!1===t.visible)return _P.h("div.mapillary-sequence-container",{},[]);var l=this._createStepper(e,t,o,n,s,u),c=this._createSequenceControls(n),h=this._createPlaybackControls(n,i,s,t),d=this._createTimelineControls(n,r,a);return _P.h("div.mapillary-sequence-container",[l,c,h,d])}},{key:"getContainerWidth",value:function(e,t){var n=t.minWidth,i=t.maxWidth;i<n&&(i=n);var r=(e.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),a=(e.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);return n+Math.max(0,Math.min(1,Math.min(r,a)))*(i-n)}},{key:"_createPositionInput",value:function(e,t){var n=this;this._index=e;var i=function(e){n._index=Number(e.target.value),n._notifyIndexChanged$.next(n._index)},r=this._container.domContainer.getBoundingClientRect(),a=Math.max(276,Math.min(410,5+.8*r.width))-65,o=function(e){e.stopPropagation(),n._setChangingPosition(!0)},s=function(e){!0===n._changingPosition&&e.stopPropagation()},u={max:null!=t?t:1,min:0,onchange:i,oninput:i,onkeydown:function(e){"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:o,onpointermove:s,ontouchmove:s,ontouchstart:o,style:{width:"".concat(a,"px")},type:"range",value:null!=e?e:0},l=null==e||null==t||t<=1;l&&(u.disabled="true");var c=_P.h("input.mapillary-sequence-position",u,[]),h=l?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return _P.h("div"+h,[c])}},{key:"_createSpeedInput",value:function(e){var t=this;this._speed=e;var n=function(e){t._speed=Number(e.target.value)/1e3,t._notifySpeedChanged$.next(t._speed)},i=this._container.domContainer.getBoundingClientRect(),r=Math.max(276,Math.min(410,5+.8*i.width))-160,a=function(e){t._changingSpeed=!0,e.stopPropagation()},o=function(e){!0===t._changingSpeed&&e.stopPropagation()},s=_P.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:n,oninput:n,onkeydown:function(e){"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:a,onpointermove:o,ontouchmove:o,ontouchstart:a,style:{width:"".concat(r,"px")},type:"range",value:1e3*e},[]);return _P.h("div.mapillary-sequence-speed-container",[s])}},{key:"_createPlaybackControls",value:function(e,t,n,i){var r=this;if(this._mode!==wL.Playback)return _P.h("div.mapillary-sequence-playback",[]);var a=_P.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),o=i.direction===DM.Next?DM.Prev:DM.Next,s=i.playing,u={onclick:function(){s||n.configure({direction:o})}},l=i.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",c=_P.h("div"+l,u,[a]),h=_P.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),d=_P.h("div.mapillary-sequence-slow-container",[h]),f=_P.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),p=_P.h("div.mapillary-sequence-fast-container",[f]),v=_P.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),m={onclick:function(){r._mode=wL.Default,r._notifyChanged$.next(r)}},g=_P.h("div.mapillary-sequence-close-button",m,[v]),_=[c,d,this._createSpeedInput(t),p,g],y=Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10),b={style:{top:"".concat(y,"px")}};return _P.h("div.mapillary-sequence-playback",b,_)}},{key:"_createPlayingButton",value:function(e,t,n,i,r){var a=i.direction===DM.Next&&null!=e||i.direction===DM.Prev&&null!=t;a=a&&n;var o={onclick:i.playing?function(){r.stop()}:a?function(){r.play()}:null},s={};i.direction===DM.Prev&&(s.style={transform:"rotate(180deg) translate(50%, 50%)"});var u=_P.h("div.mapillary-sequence-icon",s,[]),l=i.playing?"mapillary-sequence-stop":a?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return _P.h("div."+l,o,[u])}},{key:"_createSequenceControls",value:function(e){var t=this,n=Math.round(8/this._stepperDefaultWidth*e),i={onclick:function(){t._expandControls=!t._expandControls,t._mode=wL.Default,t._notifyChanged$.next(t)},style:{"border-bottom-right-radius":"".concat(n,"px"),"border-top-right-radius":"".concat(n,"px")}},r=_P.h("div.mapillary-sequence-expander-bar",[]),a=_P.h("div.mapillary-sequence-expander-button",i,[r]),o=this._mode===wL.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",s=_P.h("div"+o,[]),u={onclick:function(){t._mode=t._mode===wL.Playback?wL.Default:wL.Playback,t._notifyChanged$.next(t)}},l=_P.h("div.mapillary-sequence-playback-button",u,[s]),c=this._mode===wL.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",h=_P.h("div"+c,[]),d={onclick:function(){t._mode=t._mode===wL.Timeline?wL.Default:wL.Timeline,t._notifyChanged$.next(t)}},f=_P.h("div.mapillary-sequence-timeline-button",d,[h]),p={style:{height:this._defaultHeight/this._stepperDefaultWidth*e+"px",transform:"translate(".concat(e/2+2,"px, 0)"),width:this._controlsDefaultWidth/this._stepperDefaultWidth*e+"px"}},v=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return _P.h("div"+v,p,[l,f,a])}},{key:"_createSequenceArrows",value:function(e,t,n,i,r){var a=this,o={onclick:null!=e?function(){r.moveDir$(DM.Next).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))}:null,onpointerenter:function(){a._mouseEnterDirection$.next(DM.Next)},onpointerleave:function(){a._mouseLeaveDirection$.next(DM.Next)}},s=Math.round(8/this._stepperDefaultWidth*n),u={onclick:null!=t?function(){r.moveDir$(DM.Prev).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))}:null,onpointerenter:function(){a._mouseEnterDirection$.next(DM.Prev)},onpointerleave:function(){a._mouseLeaveDirection$.next(DM.Prev)},style:{"border-bottom-left-radius":"".concat(s,"px"),"border-top-left-radius":"".concat(s,"px")}},l=this._getStepClassName(DM.Next,e,i.highlightId),c=this._getStepClassName(DM.Prev,t,i.highlightId),h=_P.h("div.mapillary-sequence-icon",[]),d=_P.h("div.mapillary-sequence-icon",[]);return[_P.h("div."+c,u,[d]),_P.h("div."+l,o,[h])]}},{key:"_createStepper",value:function(e,t,n,i,r,a){var o,s=null,u=null,l=Pd(e.edges);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.data.direction===DM.Next&&(s=c.target),c.data.direction===DM.Prev&&(u=c.target)}}catch(MN){l.e(MN)}finally{l.f()}var h=this._createPlayingButton(s,u,n,t,r),d=this._createSequenceArrows(s,u,i,t,a);d.splice(1,0,h);var f={oncontextmenu:function(e){e.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*i+"px",width:i+"px"}};return _P.h("div.mapillary-sequence-stepper",f,d)}},{key:"_createTimelineControls",value:function(e,t,n){var i=this;if(this._mode!==wL.Timeline)return _P.h("div.mapillary-sequence-timeline",[]);var r=this._createPositionInput(t,n),a=_P.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),o={onclick:function(){i._mode=wL.Default,i._notifyChanged$.next(i)}},s=_P.h("div.mapillary-sequence-close-button",o,[a]),u=Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10),l={style:{top:"".concat(u,"px")}};return _P.h("div.mapillary-sequence-timeline",l,[r,s])}},{key:"_getStepClassName",value:function(e,t,n){var i=e===DM.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return null==t?i+="-inactive":n===t&&(i+="-highlight"),i}},{key:"_setChangingPosition",value:function(e){this._changingPosition=e,this._notifyChangingPositionChanged$.next(e)}}]),e}(),CL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o){var u;return Fd(this,n),(u=t.call(this,e,i,r))._sequenceDOMRenderer=a||new TL(i),u._scheduler=o,u._containerWidth$=new Af,u._hoveredIdSubject$=new Af,u._hoveredId$=u._hoveredIdSubject$.pipe(xv()),u._navigator.playService.playing$.pipe(kv(1),Lv(u._configuration$)).subscribe((function(e){var t=s(e,2),n=t[0],i=t[1],r="playing",a={playing:n,target:Ad(u),type:r};u.fire(r,a),n!==i.playing&&(n?u.play():u.stop())})),u._navigator.playService.direction$.pipe(kv(1),Lv(u._configuration$)).subscribe((function(e){var t=s(e,2),n=t[0];n!==t[1].direction&&u.configure({direction:n})})),u}return $d(n,[{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"play",value:function(){this.configure({playing:!0})}},{key:"stop",value:function(){this.configure({playing:!1})}},{key:"_activate",value:function(){var e=this;this._sequenceDOMRenderer.activate();var t=this._navigator.stateService.currentImage$.pipe(Tv((function(e){return e.sequenceEdges$})),_v(1),Ef()),n=this._navigator.stateService.currentImage$.pipe(ov(void 0,(function(e){return e.sequenceId})),Tv((function(t){return zp(pp(null),e._navigator.graphService.cacheSequence$(t.sequenceId).pipe(yv(3),Kp((function(e){return console.error("Failed to cache sequence",e),pp(null)}))))})),Mv(null),_v(1),Ef()),i=this._subscriptions;i.push(n.subscribe());var r=this._sequenceDOMRenderer.index$.pipe(Lv(n),xp((function(e){var t=s(e,2),n=t[0],i=t[1];return null!=i?i.imageIds[n]:null})),qp((function(e){return!!e})),ov(),gv(),Ef());i.push(Hp(r.pipe(iv(100,this._scheduler)),r.pipe(Xp(400,this._scheduler))).pipe(ov(),Tv((function(t){return e._navigator.moveTo$(t).pipe(Kp((function(){return Hf()})))}))).subscribe()),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(qp((function(e){return e}))).subscribe((function(){e._navigator.graphService.setGraphMode(xL.Sequence)}))),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(qp((function(e){return!e}))).subscribe((function(){e._navigator.graphService.setGraphMode(xL.Spatial)}))),this._navigator.graphService.graphMode$.pipe(Tv((function(t){return t===xL.Spatial?e._navigator.stateService.currentImage$.pipe(av(2)):Hf()})),qp((function(e){return!e.spatialEdges.cached})),Tv((function(t){return e._navigator.graphService.cacheImage$(t.id).pipe(Kp((function(){return Hf()})))}))).subscribe(),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(qp((function(e){return e}))).subscribe((function(){e._navigator.playService.stop()}))),i.push(Lp(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(Mv(!1),ov())).pipe(Lv(this._navigator.stateService.currentImage$),Tv((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1];return a&&r===xL.Sequence?e._navigator.graphService.cacheSequenceImages$(o.sequenceId,o.id).pipe(yv(3),Kp((function(e){return console.error("Failed to cache sequence images.",e),Hf()}))):Hf()}))).subscribe());var a=n.pipe(Tv((function(t){if(!t)return pp({index:null,max:null});var n=!0;return e._sequenceDOMRenderer.changingPositionChanged$.pipe(Mv(!1),ov(),Tv((function(t){var i=!t&&n?0:1;return n=!1,t?r:e._navigator.stateService.currentImage$.pipe(xp((function(e){return e.id})),ov(),kv(i))})),xp((function(e){var n=t.imageIds.indexOf(e);return-1===n?{index:null,max:null}:{index:n,max:t.imageIds.length-1}})))}))),o=this._navigator.stateService.state$.pipe(xp((function(e){return e===XP.Earth})),ov());i.push(Lp(t,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(Mv(this._sequenceDOMRenderer)),this._navigator.playService.speed$,a,o).pipe(xp((function(t){var n=s(t,7),i=n[0],r=n[1],a=n[2],o=n[4],u=n[5],l=n[6],c=e._sequenceDOMRenderer.render(i,r,a,o,u.index,u.max,!l,e,e._navigator);return{name:e._name,vNode:c}}))).subscribe(this._container.domRenderer.render$)),i.push(this._sequenceDOMRenderer.speed$.subscribe((function(t){e._navigator.playService.setSpeed(t)}))),i.push(this._configuration$.pipe(xp((function(e){return e.direction})),ov()).subscribe((function(t){e._navigator.playService.setDirection(t)}))),i.push(Lp(this._container.renderService.size$,this._configuration$.pipe(ov((function(e,t){return e[0]===t[0]&&e[1]===t[1]}),(function(e){return[e.minWidth,e.maxWidth]})))).pipe(xp((function(t){var n=s(t,2),i=n[0],r=n[1];return e._sequenceDOMRenderer.getContainerWidth(i,r)}))).subscribe(this._containerWidth$)),i.push(this._configuration$.pipe(xp((function(e){return e.playing})),ov()).subscribe((function(t){t?e._navigator.playService.play():e._navigator.playService.stop()}))),i.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(Tv((function(n){var i=t.pipe(xp((function(e){var t,i=Pd(e.edges);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r.data.direction===n)return r.target}}catch(MN){i.e(MN)}finally{i.f()}return null})),Cv(e._sequenceDOMRenderer.mouseLeaveDirection$));return zp(i,pp(null))})),ov()).subscribe(this._hoveredIdSubject$)),i.push(this._hoveredId$.subscribe((function(t){var n="hover",i={id:t,target:e,type:n};e.fire(n,i)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}},{key:"_getDefaultConfiguration",value:function(){return{direction:DM.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}]),n}(xP);CL.componentName="sequence",function(e){e[e.Motion=0]="Motion",e[e.Stationary=1]="Stationary"}(ML||(ML={}));var EL=function(){function e(t,n,i,r,a,o,s,u,l,c){Fd(this,e),this._orientation=this._getValue(t,1);var h=null!=s?s.width:4,d=null!=s?s.height:3,f=this._orientation<5;this._width=this._getValue(n,f?h:d),this._height=this._getValue(i,f?d:h),this._basicAspect=f?this._width/this._height:this._height/this._width,this._basicWidth=f?n:i,this._basicHeight=f?i:n;var p=this._getCameraParameters(l,c),v=p[0],m=p[1],g=p[2];this._focal=this._getValue(v,1),this._scale=this._getValue(r,0),this._worldToCamera=this.createWorldToCamera(a,o),this._worldToCameraInverse=(new bg).copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=(new bg).copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,t),this._textureScale=u||[1,1],this._ck1=m||0,this._ck2=g||0,this._cameraType=c||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}return $d(e,[{key:"ck1",get:function(){return this._ck1}},{key:"ck2",get:function(){return this._ck2}},{key:"cameraType",get:function(){return this._cameraType}},{key:"basicAspect",get:function(){return this._basicAspect}},{key:"basicHeight",get:function(){return this._basicHeight}},{key:"basicRt",get:function(){return this._basicWorldToCamera}},{key:"basicWidth",get:function(){return this._basicWidth}},{key:"focal",get:function(){return this._focal}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}},{key:"rt",get:function(){return this._worldToCamera}},{key:"srt",get:function(){return this._scaledWorldToCamera}},{key:"srtInverse",get:function(){return this._scaledWorldToCameraInverse}},{key:"scale",get:function(){return this._scale}},{key:"hasValidScale",get:function(){return this._scale>.01&&this._scale<50}},{key:"radialPeak",get:function(){return this._radialPeak}},{key:"width",get:function(){return this._width}},{key:"upVector",value:function(){var e=this._worldToCamera.elements;switch(this._orientation){case 1:default:return new Vm(-e[1],-e[5],-e[9]);case 3:return new Vm(e[1],e[5],e[9]);case 6:return new Vm(-e[0],-e[4],-e[8]);case 8:return new Vm(e[0],e[4],e[8])}}},{key:"projectorMatrix",value:function(){var e=this._normalizedToTextureMatrix(),t=this._focal,n=(new bg).set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);return e.multiply(n),e.multiply(this._worldToCamera),e}},{key:"projectBasic",value:function(e){var t=this.projectSfM(e);return this._sfmToBasic(t)}},{key:"unprojectBasic",value:function(e,t,n){var i=this._basicToSfm(e);return this.unprojectSfM(i,t,n)}},{key:"projectSfM",value:function(e){var t=new Fm(e[0],e[1],e[2],1);return t.applyMatrix4(this._worldToCamera),this._bearingToSfm([t.x,t.y,t.z])}},{key:"unprojectSfM",value:function(e,t,n){var i=this._sfmToBearing(e),r=(n&&!qM(this._cameraType)?new Fm(t*i[0]/i[2],t*i[1]/i[2],t,1):new Fm(t*i[0],t*i[1],t*i[2],1)).applyMatrix4(this._worldToCameraInverse);return[r.x/r.w,r.y/r.w,r.z/r.w]}},{key:"_sfmToBearing",value:function(e){if(qM(this._cameraType)){var t=2*e[0]*Math.PI,n=2*-e[1]*Math.PI;return[Math.cos(n)*Math.sin(t),-Math.sin(n),Math.cos(n)*Math.cos(t)]}if(ZM(this._cameraType)){var i=e[0]/this._focal,r=e[1]/this._focal,a=Math.sqrt(i*i+r*r),o=a/this._distortionFromDistortedRadius(a,this._ck1,this._ck2,this._radialPeak),s=Math.cos(o),u=Math.sin(o),l=a>1e-8?1/a:1;return[u*i*l,u*r*l,s]}var c=e[0]/this._focal,h=e[1]/this._focal,d=Math.sqrt(c*c+h*h),f=this._distortionFromDistortedRadius(d,this._ck1,this._ck2,this._radialPeak),p=new Vm(c/f,h/f,1);return p.normalize(),[p.x,p.y,p.z]}},{key:"_distortionFromDistortedRadius",value:function(e,t,n,i){for(var r=1,a=0;a<10;a++){var o=e/r;o>i&&(o=i),r=1+t*Math.pow(o,2)+n*Math.pow(o,4)}return r}},{key:"_bearingToSfm",value:function(e){if(qM(this._cameraType)){var t=e[0],n=e[1],i=e[2],r=Math.atan2(t,i),a=Math.atan2(-n,Math.sqrt(t*t+i*i));return[r/(2*Math.PI),-a/(2*Math.PI)]}if(ZM(this._cameraType)){if(e[2]>0){var o=s(e,3),u=o[0],l=o[1],c=o[2],h=Math.sqrt(u*u+l*l),d=Math.atan2(h,c);d>this._radialPeak&&(d=this._radialPeak);var f=1+Math.pow(d,2)*(this._ck1+Math.pow(d,2)*this._ck2),p=this._focal*f*d/h;return[p*u,p*l]}return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}if(e[2]>0){var v=e[0]/e[2],m=e[1]/e[2],g=v*v+m*m,_=Math.pow(this._radialPeak,2);g>_&&(g=_);var y=1+this._ck1*g+this._ck2*Math.pow(g,2);return[this._focal*y*v,this._focal*y*m]}return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}},{key:"_basicToSfm",value:function(e){var t,n;switch(this._orientation){case 1:default:t=e[0],n=e[1];break;case 3:t=1-e[0],n=1-e[1];break;case 6:t=e[1],n=1-e[0];break;case 8:t=1-e[1],n=e[0]}var i=this._width,r=this._height,a=Math.max(i,r);return[t*i/a-i/a/2,n*r/a-r/a/2]}},{key:"_sfmToBasic",value:function(e){var t,n,i=this._width,r=this._height,a=Math.max(i,r),o=(e[0]+i/a/2)/i*a,s=(e[1]+r/a/2)/r*a;switch(this._orientation){case 1:default:t=o,n=s;break;case 3:t=1-o,n=1-s;break;case 6:t=1-s,n=o;break;case 8:t=s,n=1-o}return[t,n]}},{key:"_getValue",value:function(e,t){return null!=e&&e>0?e:t}},{key:"_getCameraParameters",value:function(e,t){if(qM(t))return[];if(!e||0===e.length)return[1,0,0];var n=3-e.length;return n<=0?e:e.concat(new Array(n).fill(0))}},{key:"createWorldToCamera",value:function(e,t){var n=new Vm(e[0],e[1],e[2]),i=n.length();i>0&&n.normalize();var r=new bg;return r.makeRotationAxis(n,i),r.setPosition(new Vm(t[0],t[1],t[2])),r}},{key:"_createScaledWorldToCamera",value:function(e,t){var n=e.clone(),i=n.elements;return i[12]=t*i[12],i[13]=t*i[13],i[14]=t*i[14],n.scale(new Vm(t,t,t)),n}},{key:"_createBasicWorldToCamera",value:function(e,t){var n=new Vm(0,0,1),i=0;switch(t){case 3:i=Math.PI;break;case 6:i=Math.PI/2;break;case 8:i=3*Math.PI/2}return(new bg).makeRotationAxis(n,i).multiply(e)}},{key:"_getRadialPeak",value:function(e,t){var n=5*t,i=3*e,r=Math.pow(i,2)-4*n*1;if(!(r<0)){var a=(-i-Math.sqrt(r))/2/n,o=(-i+Math.sqrt(r))/2/n,s=Math.min(a,o),u=Math.max(a,o);return s>0?Math.sqrt(s):u>0?Math.sqrt(u):void 0}}},{key:"_normalizedToTextureMatrix",value:function(){var e=Math.max(this._width,this._height),t=this._orientation<5?this._textureScale[0]:this._textureScale[1],n=this._orientation<5?this._textureScale[1]:this._textureScale[0],i=e/this._width*t,r=e/this._height*n;switch(this._orientation){case 1:default:return(new bg).set(i,0,0,.5,0,-r,0,.5,0,0,1,0,0,0,0,1);case 3:return(new bg).set(-i,0,0,.5,0,r,0,.5,0,0,1,0,0,0,0,1);case 6:return(new bg).set(0,-r,0,.5,-i,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new bg).set(0,r,0,.5,i,0,0,.5,0,0,1,0,0,0,0,1)}}}]),e}(),PL=function(){function e(){Fd(this,e),this._factory=new NP,this._scene=new DP,this._spatial=new WM,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}return $d(e,[{key:"disabled",get:function(){return this._disabled}},{key:"frameId",get:function(){return this._frameId}},{key:"needsRender",get:function(){return this._needsRender}},{key:"setTextureProvider",value:function(e,t){this._setTextureProvider(e,this._currentKey,t,this._currentProviderDisposers,this._updateTexture.bind(this))}},{key:"setTextureProviderPrev",value:function(e,t){this._setTextureProvider(e,this._previousKey,t,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}},{key:"update",value:function(e,t){this._updateFrameId(e.id),this._updateImagePlanes(e.state,t)}},{key:"updateCurtain",value:function(e){this._curtain!==e&&(this._curtain=e,this._updateCurtain(),this._needsRender=!0)}},{key:"updateTexture",value:function(e,t){var n=t.id===this._currentKey?this._scene.planes:t.id===this._previousKey?this._scene.planesOld:{};if(0!==Object.keys(n).length)for(var i in this._needsRender=!0,n)if(n.hasOwnProperty(i)){var r=n[i].material.uniforms.projectorTex.value;r.image=e,r.needsUpdate=!0}}},{key:"updateTextureImage",value:function(e,t){if(this._currentKey===t.id){this._needsRender=!0;var n=this._scene.planes;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i].material.uniforms.projectorTex.value;r.image=e,r.needsUpdate=!0}}}},{key:"render",value:function(e,t){this.disabled||t.render(this._scene.sceneOld,e),t.render(this._scene.scene,e),this._needsRender=!1}},{key:"dispose",value:function(){for(var e in this._scene.clear(),this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(e)&&this._currentProviderDisposers[e]();for(var t in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(t)&&this._previousProviderDisposers[t]();this._currentProviderDisposers={},this._previousProviderDisposers={}}},{key:"_getBasicCorners",value:function(e,t){var n,i;return e>t?(n=.5,i=.5*e/t):(n=.5*t/e,i=.5),[[.5-n,.5-i],[.5+n,.5+i]]}},{key:"_setDisabled",value:function(e){this._disabled=null==e.currentImage||null==e.previousImage||qM(e.currentImage.cameraType)&&!qM(e.previousImage.cameraType)}},{key:"_setTextureProvider",value:function(e,t,n,i,r){var a=this;if(e===t){var o=n.textureCreated$.subscribe(r),s=n.textureUpdated$.subscribe((function(e){a._needsRender=!0}));if(e in i)(0,i[e])(),delete i[e];i[e]=function(){o.unsubscribe(),s.unsubscribe(),n.dispose()}}}},{key:"_updateCurtain",value:function(){var e=this._scene.planes;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t].material;n.uniforms.curtain&&(n.uniforms.curtain.value=this._curtain)}}},{key:"_updateFrameId",value:function(e){this._frameId=e}},{key:"_updateImagePlanes",value:function(e,t){var n=null!=e.currentImage&&this._currentKey!==e.currentImage.id,i=null!=e.previousImage&&this._previousKey!==e.previousImage.id,r=this._mode!==t;if(n||i||r){this._setDisabled(e),this._needsRender=!0,this._mode=t;var a=e.motionless||t===ML.Stationary||qM(e.currentImage.cameraType);if((this.disabled||i)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(i||r){var o=e.previousImage;this._previousKey=o.id;var u=e.currentTransform.rt.elements,l=[u[12],u[13],u[14]],c=e.currentTransform.basicAspect,h=e.previousTransform.basicAspect,d=c>h?[1,h/c]:[c/h,1],f=e.currentImage.rotation,p=e.currentImage.width,v=e.currentImage.height;qM(o.cameraType)&&(f=e.previousImage.rotation,l=this._spatial.rotate(this._spatial.opticalCenter(e.currentImage.rotation,l).toArray(),f).multiplyScalar(-1).toArray(),p=e.previousImage.width,v=e.previousImage.height);var m=new EL(e.currentImage.exifOrientation,p,v,e.currentImage.scale,f,l,o.image,d,e.currentImage.cameraParameters,e.currentImage.cameraType),g=void 0;if(qM(o.cameraType))g=this._factory.createMesh(o,a||qM(e.currentImage.cameraType)?m:e.previousTransform);else if(a){var _=s(this._getBasicCorners(c,h),2),y=s(_[0],2),b=y[0],x=y[1],w=s(_[1],2),k=w[0],S=w[1];g=this._factory.createFlatMesh(e.previousImage,m,b,k,x,S)}else g=this._factory.createMesh(e.previousImage,e.previousTransform);var M={};M[o.id]=g,this._scene.setImagePlanesOld(M)}if(n||r){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=e.currentImage.id;var T={};qM(e.currentImage.cameraType)?T[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform):T[e.currentImage.id]=a?this._factory.createDistortedCurtainMesh(e.currentImage,e.currentTransform):this._factory.createCurtainMesh(e.currentImage,e.currentTransform),this._scene.setImagePlanes(T),this._updateCurtain()}}}},{key:"_updateTexture",value:function(e){this._needsRender=!0;var t=this._scene.planes;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n].material,r=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null,r.dispose(),i.uniforms.projectorTex.value=e}}},{key:"_updateTexturePrev",value:function(e){this._needsRender=!0;var t=this._scene.planesOld;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n].material,r=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null,r.dispose(),i.uniforms.projectorTex.value=e}}}]),e}(),LL=function(){function e(t){Fd(this,e),this._container=t,this._interacting=!1,this._notifyModeChanged$=new Af,this._notifyPositionChanged$=new Af,this._stopInteractionSubscription=null}return $d(e,[{key:"mode$",get:function(){return this._notifyModeChanged$}},{key:"position$",get:function(){return this._notifyPositionChanged$}},{key:"activate",value:function(){var e=this;this._stopInteractionSubscription||(this._stopInteractionSubscription=Hp(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(qp((function(e){return 0===e.touches.length})))).subscribe((function(t){e._interacting&&(e._interacting=!1)})))}},{key:"deactivate",value:function(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}},{key:"render",value:function(e,t,n,i,r){var a=[];if(r){a.push(_P.h("div.mapillary-slider-border",[]));var o=!(n||i);o&&(a.push(this._createModeButton(t)),a.push(this._createModeButton2d(t))),a.push(this._createPositionInput(e,o))}var s=this._container.domContainer.getBoundingClientRect(),u=Math.max(215,Math.min(400,s.width-100));return _P.h("div.mapillary-slider-container",{style:{width:"".concat(u,"px")}},a)}},{key:"_createModeButton",value:function(e){var t=this,n={onclick:function(){e!==ML.Motion&&t._notifyModeChanged$.next(ML.Motion)}},i=e===ML.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return _P.h("div."+i,n,[_P.h("div.mapillary-slider-mode-icon",[])])}},{key:"_createModeButton2d",value:function(e){var t=this,n={onclick:function(){e!==ML.Stationary&&t._notifyModeChanged$.next(ML.Stationary)}},i=e===ML.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return _P.h("div."+i,n,[_P.h("div.mapillary-slider-mode-icon-2d",[])])}},{key:"_createPositionInput",value:function(e,t){var n=this,i=function(e){n._notifyPositionChanged$.next(Number(e.target.value)/1e3)},r=function(e){n._interacting=!0,e.stopPropagation()},a=function(e){n._interacting&&e.stopPropagation()},o=this._container.domContainer.getBoundingClientRect(),s=Math.max(215,Math.min(400,o.width-105))-84+(t?0:52),u=_P.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:i,oninput:i,onkeydown:function(e){"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:r,onpointermove:a,ontouchmove:a,ontouchstart:r,style:{width:"".concat(s,"px")},type:"range",value:1e3*e},[]);return _P.h("div.mapillary-slider-position-container",[u])}}]),e}(),AL=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._viewportCoords=a||new MP,o._domRenderer=new LL(i),o._imageTileLoader=new zP(r.api),o._roiCalculator=new BP,o._spatial=new WM,o._glRendererOperation$=new Af,o._glRendererCreator$=new Af,o._glRendererDisposer$=new Af,o._glRenderer$=o._glRendererOperation$.pipe(bv((function(e,t){return t(e)}),null),qp((function(e){return null!=e})),ov(void 0,(function(e){return e.frameId}))),o._glRendererCreator$.pipe(xp((function(){return function(e){if(null!=e)throw new Error("Multiple slider states can not be created at the same time");return new PL}}))).subscribe(o._glRendererOperation$),o._glRendererDisposer$.pipe(xp((function(){return function(e){return e.dispose(),null}}))).subscribe(o._glRendererOperation$),o}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(this._domRenderer.mode$.subscribe((function(t){e.configure({mode:t})}))),t.push(this._glRenderer$.pipe(xp((function(t){return{name:e._name,renderer:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),pass:RP.Background}}}))).subscribe(this._container.glRenderer.render$));var n=zp(this.configuration$.pipe(xp((function(e){return null!=e.initialPosition?e.initialPosition:1})),dv()),this._domRenderer.position$),i=this.configuration$.pipe(xp((function(e){return e.mode})),ov()),r=this._navigator.stateService.currentState$.pipe(xp((function(e){return e.state.motionless})),ov()),a=this._navigator.stateService.currentState$.pipe(xp((function(e){return qM(e.state.currentImage.cameraType)})),ov()),o=Lp(this._configuration$.pipe(xp((function(e){return e.sliderVisible}))),this._navigator.stateService.currentState$.pipe(xp((function(e){return!(null==e.state.currentImage||null==e.state.previousImage||qM(e.state.currentImage.cameraType)&&!qM(e.state.previousImage.cameraType))})),ov())).pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return n&&i})),ov());this._waitSubscription=Lp(i,r,a,o).pipe(Lv(this._navigator.stateService.state$)).subscribe((function(t){var n=s(t,2),i=s(n[0],4),r=i[0],a=i[1],o=i[2],u=i[3],l=n[1],c=u&&(a||r===ML.Stationary||o);c&&l!==XP.WaitingInteractively?e._navigator.stateService.waitInteractively():c||l===XP.Waiting||e._navigator.stateService.wait()})),t.push(Lp(n,i,r,a,o).subscribe((function(t){var n=s(t,4),i=n[0],r=n[1],a=n[2],o=n[3];a||r===ML.Stationary||o?e._navigator.stateService.moveTo(1):e._navigator.stateService.moveTo(i)}))),t.push(Lp(n,i,r,a,o,this._container.renderService.size$).pipe(xp((function(t){var n=s(t,5),i=n[0],r=n[1],a=n[2],o=n[3],u=n[4];return{name:e._name,vNode:e._domRenderer.render(i,r,a,o,u)}}))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),t.push(Lp(n,a,o,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(xp((function(t){var n=s(t,5),i=n[0],r=n[1],a=n[2],o=n[3],u=n[4];if(!r)return a?i:1;var l=e._viewportCoords.viewportToBasic(-1.15,0,u,o.perspective),c=e._viewportCoords.viewportToBasic(1.15,0,u,o.perspective),h=c[0]<l[0]?c[0]+1:c[0],d=l[0]+i*(h-l[0]);return d>1?d-1:d})),xp((function(e){return function(t){return t.updateCurtain(e),t}}))).subscribe(this._glRendererOperation$)),t.push(Lp(this._navigator.stateService.currentState$,i).pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return function(e){return e.update(n,i),e}}))).subscribe(this._glRendererOperation$)),t.push(this._configuration$.pipe(qp((function(e){return null!=e.ids})),Tv((function(t){return Zp(Zp(e._catchCacheImage$(t.ids.background),e._catchCacheImage$(t.ids.foreground)).pipe(xp((function(e){return{background:e[0],foreground:e[1]}}))),e._navigator.stateService.currentState$.pipe(dv())).pipe(xp((function(e){return{images:e[0],state:e[1].state}})))}))).subscribe((function(t){null!=t.state.currentImage&&null!=t.state.previousImage&&t.state.currentImage.id===t.images.foreground.id&&t.state.previousImage.id===t.images.background.id||(t.state.currentImage.id!==t.images.background.id?t.state.currentImage.id!==t.images.foreground.id||1!==t.state.trajectory.length?(e._navigator.stateService.setImages([t.images.background]),e._navigator.stateService.setImages([t.images.foreground])):e._navigator.stateService.prependImages([t.images.background]):e._navigator.stateService.setImages([t.images.foreground]))}),(function(e){console.error(e)})));var u=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?e._navigator.stateService.currentState$:new Af})),ov(void 0,(function(e){return e.state.currentImage.id})),Lv(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),xp((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2],o=i.state;Math.max(a.width,a.height);var u=o.currentImage,l=o.currentTransform;return new YP(u.id,l.basicWidth,l.basicHeight,u.image,e._imageTileLoader,new FP,r)})),_v(1),Ef());t.push(u.subscribe((function(){}))),t.push(u.pipe(xp((function(e){return function(t){return t.setTextureProvider(e.id,e),t}}))).subscribe(this._glRendererOperation$)),t.push(u.pipe(mv()).subscribe((function(e){e[0].abort()})));var l=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?Lp(e._container.renderService.renderCameraFrame$,e._container.renderService.size$.pipe(iv(250))):new Af})),xp((function(e){var t=s(e,2),n=t[0],i=t[1];return[n.camera.position.clone(),n.camera.lookat.clone(),n.zoom.valueOf(),i.height.valueOf(),i.width.valueOf()]})),mv(),Sv((function(e){return e[1][2]-e[0][2]<0||0===e[1][2]})),xp((function(e){var t=e[0][0].equals(e[1][0]),n=e[0][1].equals(e[1][1]),i=e[0][2]===e[1][2],r=e[0][3]===e[1][3],a=e[0][4]===e[1][4];return t&&n&&i&&r&&a})),ov(),qp((function(e){return e})),Tv((function(){return e._container.renderService.renderCameraFrame$.pipe(dv())})),Lv(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(u.pipe(Tv((function(t){return l.pipe(xp((function(n){var i=s(n,3),r=i[0],a=i[1],o=i[2];return[e._roiCalculator.computeRegionOfInterest(r,a,o),t]})))})),qp((function(e){return!e[1].disposed}))).subscribe((function(e){var t=e[0];e[1].setRegionOfInterest(t)})));var c=u.pipe(Tv((function(e){return e.hasTexture$})),Mv(!1),_v(1),Ef());t.push(c.subscribe((function(){})));var h=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?e._navigator.stateService.currentState$:new Af})),qp((function(e){return!!e.state.previousImage})),ov(void 0,(function(e){return e.state.previousImage.id})),Lv(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),xp((function(t){var n=s(t,3),i=n[0],r=n[1],a=(n[2],i.state),o=a.previousImage,u=a.previousTransform;return new YP(o.id,u.basicWidth,u.basicHeight,o.image,e._imageTileLoader,new FP,r)})),_v(1),Ef());t.push(h.subscribe((function(){}))),t.push(h.pipe(xp((function(e){return function(t){return t.setTextureProviderPrev(e.id,e),t}}))).subscribe(this._glRendererOperation$)),t.push(h.pipe(mv()).subscribe((function(e){e[0].abort()})));var d=this._container.configurationService.imageTiling$.pipe(Tv((function(t){return t?Lp(e._container.renderService.renderCameraFrame$,e._container.renderService.size$.pipe(iv(250))):new Af})),xp((function(e){var t=s(e,2),n=t[0],i=t[1];return[n.camera.position.clone(),n.camera.lookat.clone(),n.zoom.valueOf(),i.height.valueOf(),i.width.valueOf()]})),mv(),Sv((function(e){return e[1][2]-e[0][2]<0||0===e[1][2]})),xp((function(e){var t=e[0][0].equals(e[1][0]),n=e[0][1].equals(e[1][1]),i=e[0][2]===e[1][2],r=e[0][3]===e[1][3],a=e[0][4]===e[1][4];return t&&n&&i&&r&&a})),ov(),qp((function(e){return e})),Tv((function(){return e._container.renderService.renderCameraFrame$.pipe(dv())})),Lv(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(h.pipe(Tv((function(t){return d.pipe(xp((function(n){var i=s(n,3),r=i[0],a=i[1],o=i[2];return[e._roiCalculator.computeRegionOfInterest(r,a,o),t]})))})),qp((function(e){return!e[1].disposed})),Lv(this._navigator.stateService.currentState$)).subscribe((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1],u=null;if(qM(o.state.previousImage.cameraType))if(qM(o.state.currentImage.cameraType)){var l=e._spatial.viewingDirection(o.state.currentImage.rotation),c=e._spatial.viewingDirection(o.state.previousImage.rotation),h=e._spatial.angleBetweenVector2(l.x,l.y,c.x,c.y)/(2*Math.PI);u={bbox:{maxX:e._spatial.wrap(r.bbox.maxX+h,0,1),maxY:r.bbox.maxY,minX:e._spatial.wrap(r.bbox.minX+h,0,1),minY:r.bbox.minY},pixelHeight:r.pixelHeight,pixelWidth:r.pixelWidth}}else{var d=e._spatial.viewingDirection(o.state.currentImage.rotation),f=e._spatial.viewingDirection(o.state.previousImage.rotation),p=e._spatial.angleBetweenVector2(d.x,d.y,f.x,f.y)/(2*Math.PI),v=e._spatial.angleToPlane(d.toArray(),[0,0,1]),m=(e._spatial.angleToPlane(f.toArray(),[0,0,1])-v)/(2*Math.PI),g=o.state.currentTransform,_=Math.max(g.basicWidth,g.basicHeight),y=_>0?2*Math.atan(.5*g.basicWidth/(_*g.focal)):Math.PI/3,b=_>0?2*Math.atan(.5*g.basicHeight/(_*g.focal)):Math.PI/3,x=y/(2*Math.PI),w=b/Math.PI,k=(r.bbox.maxX-r.bbox.minX)*x,S=(r.bbox.maxY-r.bbox.minY)*w,M=r.pixelWidth*x,T=r.pixelHeight*w,C=(r.bbox.minX+r.bbox.maxX)/2-.5,E=(r.bbox.minY+r.bbox.maxY)/2-.5,P=.5+p+x*C-k/2,L=.5+p+x*C+k/2,A=.5+m+w*E-S/2,I=.5+m+w*E+S/2;u={bbox:{maxX:e._spatial.wrap(L,0,1),maxY:I,minX:e._spatial.wrap(P,0,1),minY:A},pixelHeight:T,pixelWidth:M}}else{var R=o.state.currentTransform.basicAspect,N=o.state.previousTransform.basicAspect,D=s(e._getBasicCorners(R,N),2),O=s(D[0],2),z=O[0],F=O[1],B=s(D[1],2),$=B[0]-z,j=B[1]-F,U=r.pixelWidth/$,V=r.pixelHeight/j,H=($-1)/(2*$)+r.bbox.minX/$,W=($-1)/(2*$)+r.bbox.maxX/$,G=(j-1)/(2*j)+r.bbox.minY/j,q={maxX:W,maxY:(j-1)/(2*j)+r.bbox.maxY/j,minX:H,minY:G};e._clipBoundingBox(q),u={bbox:q,pixelHeight:V,pixelWidth:U}}a.setRegionOfInterest(u)})));var f=h.pipe(Tv((function(e){return e.hasTexture$})),Mv(!1),_v(1),Ef());t.push(f.subscribe((function(){})))}},{key:"_deactivate",value:function(){var e=this;this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(dv()).subscribe((function(t){t!==XP.Traversing&&e._navigator.stateService.traverse()})),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}},{key:"_getDefaultConfiguration",value:function(){return{initialPosition:1,mode:ML.Motion,sliderVisible:!0}}},{key:"_catchCacheImage$",value:function(e){return this._navigator.graphService.cacheImage$(e).pipe(Kp((function(t){return console.error("Failed to cache slider image (".concat(e,")"),t),Hf()})))}},{key:"_getBasicCorners",value:function(e,t){var n,i;return e>t?(n=.5,i=.5*e/t):(n=.5*t/e,i=.5),[[.5-n,.5-i],[.5+n,.5+i]]}},{key:"_clipBoundingBox",value:function(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}}]),n}(xP);AL.componentName="slider";var IL,RL,NL=function(){function e(t,n){Fd(this,e),this._subscriptions=new bP,this._graphService=t,this._stateService=n;var i=this._subscriptions;this._directionSubject$=new Af,this._direction$=this._directionSubject$.pipe(Mv(DM.Next),_v(1),Ef()),i.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new Af,this._playing$=this._playingSubject$.pipe(Mv(this._playing),_v(1),Ef()),i.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new Af,this._speed$=this._speedSubject$.pipe(Mv(this._speed),_v(1),Ef()),i.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}return $d(e,[{key:"playing",get:function(){return this._playing}},{key:"direction$",get:function(){return this._direction$}},{key:"playing$",get:function(){return this._playing$}},{key:"speed$",get:function(){return this._speed$}},{key:"play",value:function(){var t=this;if(!this._playing){this._stateService.cutImages();var n=this._setSpeed(this._speed);this._stateService.setSpeed(n),this._graphModeSubscription=this._speed$.pipe(xp((function(t){return t>e.sequenceSpeed?xL.Sequence:xL.Spatial})),ov()).subscribe((function(e){t._graphService.setGraphMode(e)})),this._cacheSubscription=Lp(this._stateService.currentImage$.pipe(xp((function(e){return[e.sequenceId,e.id]})),ov(void 0,(function(e){return s(e,1)[0]}))),this._graphService.graphMode$,this._direction$).pipe(Tv((function(e){var n=s(e,3),i=s(n[0],2),r=i[0],a=i[1],o=n[1],u=n[2];return u!==DM.Next&&u!==DM.Prev?pp([void 0,u]):Lp((o===xL.Sequence?t._graphService.cacheSequenceImages$(r,a):t._graphService.cacheSequence$(r)).pipe(yv(3),Kp((function(e){return console.error(e),pp(void 0)}))),pp(u))})),Tv((function(e){var n=s(e,2),i=n[0],r=n[1];if(void 0===i)return Hf();var a=i.imageIds.slice();return r===DM.Prev&&a.reverse(),t._stateService.currentState$.pipe(xp((function(e){return[e.state.trajectory[e.state.trajectory.length-1].id,e.state.imagesAhead]})),bv((function(e,n){var i=s(e,2),r=i[0],o=(i[1],s(n,2)),u=o[0],l=o[1];void 0===r&&(r=u);var c=a.length-1;if(l>=t._imagesAhead||a[c]===r)return[r,[]];var h=a.indexOf(u),d=a.indexOf(r)+1,f=Math.min(c,h+t._imagesAhead-l)+1;return f<=d?[r,[]]:[a[f-1],a.slice(d,f)]}),[void 0,[]]),Np((function(e){var t=s(e,2);t[0];return rp(t[1])})))})),Np((function(e){return t._graphService.cacheImage$(e).pipe(Kp((function(){return Hf()})))}),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(qp((function(e){return e.state.imagesAhead<t._imagesAhead})),ov(void 0,(function(e){return e.state.lastImage.id})),xp((function(e){for(var t=e.state.lastImage,n=e.state.trajectory,i=void 0,r=n.length-2;r>=0;r--){var a=n[r];if(a.sequenceId!==t.sequenceId)break;if(a.capturedAt!==t.capturedAt){i=a.capturedAt<t.capturedAt;break}}return[e.state.lastImage,i]})),Lv(this._direction$),Tv((function(e){var n=s(e,2),i=s(n[0],2),r=i[0],a=(i[1],n[1]);return Zp(([DM.Next,DM.Prev].indexOf(a)>-1?r.sequenceEdges$:r.spatialEdges$).pipe(dv((function(e){return e.cached})),yp(15e3)),pp(a)).pipe(xp((function(e){var t,n=s(e,2),i=n[0],r=n[1],a=Pd(i.edges);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o.data.direction===r)return o.target}}catch(MN){a.e(MN)}finally{a.f()}return null})),Tv((function(e){return null!=e?t._graphService.cacheImage$(e):Hf()})))}))).subscribe((function(e){t._stateService.appendImagess([e])}),(function(e){console.error(e),t.stop()})),this._clearSubscription=this._stateService.currentImage$.pipe(Yp(1,10)).subscribe((function(e){t._stateService.clearPriorImages()})),this._setPlaying(!0);var i=this._stateService.currentState$.pipe(xp((function(e){return e.state})),ov((function(e,t){var n=s(e,2),i=n[0],r=n[1],a=s(t,2),o=a[0],u=a[1];return i===o&&r===u}),(function(e){return[e.currentImage.id,e.lastImage.id]})),qp((function(e){return e.currentImage.id===e.lastImage.id&&e.currentIndex===e.trajectory.length-1})),xp((function(e){return e.currentImage})));this._stopSubscription=Lp(i,this._direction$).pipe(Tv((function(e){var t=s(e,2),n=t[0],i=t[1],r=([DM.Next,DM.Prev].indexOf(i)>-1?n.sequenceEdges$:n.spatialEdges$).pipe(dv((function(e){return e.cached})),yp(15e3),Kp((function(e){return console.error(e),pp({cached:!1,edges:[]})})));return Lp(pp(i),r).pipe(xp((function(e){var t,n=s(e,2),i=n[0],r=Pd(n[1].edges);try{for(r.s();!(t=r.n()).done;){if(t.value.data.direction===i)return!0}}catch(MN){r.e(MN)}finally{r.f()}return!1})))})),Np((function(e){return e||!t._bridging$?pp(e):t._bridging$.pipe(xp((function(e){return null!=e})),Kp((function(e){return console.error(e),pp(!1)})))})),dv((function(e){return!e}))).subscribe(void 0,void 0,(function(){t.stop()})),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(xp((function(e){return e===XP.Earth})),ov(),dv((function(e){return e}))).subscribe(void 0,void 0,(function(){t.stop()})),this._earthSubscription.closed&&(this._earthSubscription=null)}}},{key:"dispose",value:function(){this.stop(),this._subscriptions.unsubscribe()}},{key:"setDirection",value:function(e){this._directionSubject$.next(e)}},{key:"setSpeed",value:function(e){if((e=Math.max(0,Math.min(1,e)))!==this._speed){var t=this._setSpeed(e);this._playing&&this._stateService.setSpeed(t),this._speedSubject$.next(this._speed)}}},{key:"stop",value:function(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(xL.Spatial),this._setPlaying(!1))}},{key:"_mapSpeed",value:function(e){var t=2*e-1;return Math.pow(10,t)-.2*t}},{key:"_mapImagesAhead",value:function(e){return Math.round(Math.max(10,Math.min(50,8+6*e)))}},{key:"_setPlaying",value:function(e){this._playing=e,this._playingSubject$.next(e)}},{key:"_setSpeed",value:function(e){this._speed=e;var t=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(t),t}}]),e}();NL.sequenceSpeed=.54,function(e){e[e.Hidden=0]="Hidden",e[e.Homogeneous=1]="Homogeneous",e[e.Cluster=2]="Cluster",e[e.ConnectedComponent=3]="ConnectedComponent",e[e.Sequence=4]="Sequence"}(IL||(IL={})),function(e){e[e.Hidden=0]="Hidden",e[e.Altitude=1]="Altitude",e[e.Flat=2]="Flat"}(RL||(RL={}));var DL=function(e){Dd(n,e);var t=Od(n);function n(e){var i;Fd(this,n),(i=t.call(this))._originalSize=e.originalSize;var r=e.cluster,a=e.color,o=e.scale,s=e.translation;return i._makeAttributes(r),i.material.size=o*i._originalSize,i.setColor(a),i.matrixAutoUpdate=!1,i.position.fromArray(s),i.updateMatrix(),i.updateMatrixWorld(!1),i}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setColor",value:function(e){this.material.vertexColors=null==e,this.material.color=new h_(e),this.material.needsUpdate=!0}},{key:"resize",value:function(e){this.material.size=e*this._originalSize,this.material.needsUpdate=!0}},{key:"_makeAttributes",value:function(e){var t=[],n=[],i=e.points;for(var r in i)if(i.hasOwnProperty(r)){var a=i[r];t.push.apply(t,wd(a.coordinates));var o=a.color;n.push(o[0]),n.push(o[1]),n.push(o[2])}var s=this.geometry;s.setAttribute("position",new v_(new Float32Array(t),3)),s.setAttribute("color",new v_(new Float32Array(n),3))}}]),n}(Zw),OL=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this))._makeAttributes(e),i.matrixAutoUpdate=!1,i.updateMatrix(),i.updateMatrixWorld(!1),i}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"_makeAttributes",value:function(e){var t=e.slice();t.push(e[0]);var n,i=0,r=new Float32Array(3*(e.length+1)),a=Pd(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r[i++]=o[0],r[i++]=o[1],r[i++]=o[2]}}catch(MN){a.e(MN)}finally{a.f()}this.geometry.setAttribute("position",new v_(r,3))}}]),n}(Bw);function zL(e,t){return e===t}function FL(e){var t=function(e){return Math.pow(2,e)}(e),n=t/2;return{min:[-n,-n,-n],max:[n,n,n]}}var BL=function(){function e(t,n,i,r){Fd(this,e),this.level=t,this.leafLevel=n,this.boundingBox=i,this.parent=r,this.children=[],this.items=[],r&&r.children.push(this)}return $d(e,[{key:"isEmpty",get:function(){return!(this.children.length||this.items.length)}},{key:"add",value:function(t){var n=this;if(!n.boundingBox.containsPoint(t.position))throw new Error("Item not contained in node");if(zL(n.level,n.leafLevel))return n.items.push(t),this;var i,r=Pd(n.children);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(a.boundingBox.containsPoint(t.position))return a.add(t)}}catch(MN){r.e(MN)}finally{r.f()}var o,s=Pd(n._generateBoundingBoxes());try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u.containsPoint(t.position))return new e(n.level-1,n.leafLevel,u,n).add(t)}}catch(MN){s.e(MN)}finally{s.f()}throw new Error("Item not contained in children")}},{key:"intersect",value:function(e,t,n){if(e.intersectBox(this.boundingBox,t))if(zL(this.level,this.leafLevel))n.push(this);else{var i,r=Pd(this.children);try{for(r.s();!(i=r.n()).done;){i.value.intersect(e,t,n)}}catch(MN){r.e(MN)}finally{r.f()}}}},{key:"remove",value:function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("Item does not exist ".concat(e.uuid));this.items.splice(t,1)}},{key:"traverse",value:function(){var e=this;if(e.isEmpty){var t=e.parent;if(t){var n=t.children.indexOf(e);if(n<0)throw new Error("Corrupt octree");t.children.splice(n,1),this.parent=null,t.traverse()}}}},{key:"_generateBoundingBoxes",value:function(){for(var e=this.boundingBox.min,t=(this.boundingBox.max.x-e.x)/2,n=[],i=0,r=[[e.x,e.y+t,e.z+t],[e.x+t,e.y+t,e.z+t],[e.x,e.y,e.z+t],[e.x+t,e.y,e.z+t],[e.x,e.y+t,e.z],[e.x+t,e.y+t,e.z],[e.x,e.y,e.z],[e.x+t,e.y,e.z]];i<r.length;i++){var a=s(r[i],3),o=a[0],u=a[1],l=a[2];n.push(new Gm(new Vm(o,u,l),new Vm(o+t,u+t,l+t)))}return n}}]),e}(),$L=function(){function e(t,n){if(Fd(this,e),this.rootLevel=t,this.leafLevel=n,n>t)throw new Error;this._index=new Map,this._root=this._makeRoot()}return $d(e,[{key:"root",get:function(){return this._root}},{key:"add",value:function(e){if(this.root.boundingBox.containsPoint(e.position)){var t=this._root.add(e);this._index.set(e.uuid,t)}else console.warn("Object outside bounding box ".concat(e.uuid))}},{key:"has",value:function(e){return this._index.has(e.uuid)}},{key:"intersect",value:function(e){var t=[],n=new Vm;return this._root.intersect(e,n,t),t.map((function(e){return e.items})).reduce((function(e,t){return e.push.apply(e,wd(t)),e}),[])}},{key:"reset",value:function(){this._root=this._makeRoot(),this._index.clear()}},{key:"remove",value:function(e){if(!this.has(e))throw new Error("Frame does not exist ".concat(e.uuid));var t=this._index.get(e.uuid);t.remove(e),t.traverse(),this._index.delete(e.uuid)}},{key:"_makeRoot",value:function(){var e=this.rootLevel,t=FL(e),n=new Gm((new Vm).fromArray(t.min),(new Vm).fromArray(t.max));return new BL(e,this.leafLevel,n)}}]),e}(),jL=function(){function e(t,n){Fd(this,e),this._objects=[],this._objectImageMap=new Map,this._octree=null!==t&&void 0!==t?t:new $L(14,6),this._raycaster=null!==n&&void 0!==n?n:new _M,this._interactiveLayer=1,this._raycaster=n||new _M(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}return $d(e,[{key:"interactiveLayer",get:function(){return this._interactiveLayer}},{key:"octree",get:function(){return this._octree}},{key:"raycaster",get:function(){return this._raycaster}},{key:"add",value:function(e,t){var n=e.uuid;this._objectImageMap.set(n,t),this._objects.push(e),this._octree.add(e)}},{key:"intersectObjects",value:function(e,t){this._raycaster.setFromCamera((new Em).fromArray(e),t);var n,i=this._octree.intersect(this.raycaster.ray),r=this._raycaster.intersectObjects(i),a=this._objectImageMap,o=Pd(r);try{for(o.s();!(n=o.n()).done;){var s=n.value.object.uuid;if(a.has(s))return a.get(s)}}catch(MN){o.e(MN)}finally{o.f()}return null}},{key:"remove",value:function(e){var t=this._objects,n=t.indexOf(e);if(-1!==n){var i,r=Pd(t.splice(n,1));try{for(r.s();!(i=r.n()).done;){var a=i.value;this._objectImageMap.delete(a.uuid)}}catch(MN){r.e(MN)}finally{r.f()}this._octree.remove(e)}else console.warn("Object does not exist")}},{key:"resetIntersectionThreshold",value:function(e){this._raycaster.params.Line.threshold=e?this._largeLineThreshold:this._lineThreshold}}]),e}(),UL=function(e){Dd(n,e);var t=Od(n);function n(e){var i;Fd(this,n),i=t.call(this,e.geometry,e.material);var r=e.mode,a=e.originalOrigin,o=e.transform.unprojectBasic([0,0],0);return i._relativeAltitude=a[2]-o[2],i._makeAttributes(o,a,r),i.matrixAutoUpdate=!1,i.position.fromArray(o),i.updateMatrix(),i.updateMatrixWorld(!1),i}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setMode",value:function(e){var t=this.geometry.attributes.position;t.array[5]=this._modeToAltitude(e),t.needsUpdate=!0,this.geometry.computeBoundingSphere()}},{key:"_makeAttributes",value:function(e,t,n){var i=new Float32Array(6);i[0]=0,i[1]=0,i[2]=0,i[3]=t[0]-e[0],i[4]=t[1]-e[1],i[5]=this._modeToAltitude(n);var r=new v_(i,3);this.geometry.setAttribute("position",r),r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},{key:"_modeToAltitude",value:function(e){return e===RL.Altitude?this._relativeAltitude:0}}]),n}(Bw),VL=function(e){Dd(n,e);var t=Od(n);function n(e){var i;Fd(this,n),i=t.call(this,e.geometry,e.material);var r=e.color,a=e.size,o=e.scale,s=e.transform,u=s.unprojectBasic([0,0],0),l=i._makePositions(a,s,u);return i._makeAttributes(l,r),i.geometry.computeBoundingSphere(),i.geometry.computeBoundingBox(),i.matrixAutoUpdate=!1,i.position.fromArray(u),i.scale.set(o,o,o),i.updateMatrix(),i.updateMatrixWorld(!1),i}return $d(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setColor",value:function(e){return this._updateColorAttribute(e),this}},{key:"resize",value:function(e){return this.scale.set(e,e,e),this.updateMatrix(),this.updateMatrixWorld(!1),this}},{key:"_makeAttributes",value:function(e,t){var n=this.geometry,i=new v_(new Float32Array(e),3);n.setAttribute("position",i),i.needsUpdate=!0;var r=new v_(new Float32Array(e.length),3);n.setAttribute("color",r),this._updateColorAttribute(t)}},{key:"_updateColorAttribute",value:function(e){for(var t=s(new h_(e).toArray(),3),n=t[0],i=t[1],r=t[2],a=this.geometry.attributes.color,o=a.array,u=o.length,l=0,c=0;c<u;c++)o[l++]=n,o[l++]=i,o[l++]=r;a.needsUpdate=!0}}]),n}(Uw),HL=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_makePositions",value:function(e,t,n){var i=[];i.push.apply(i,wd(this._makeAxis(e,t,n))),i.push.apply(i,wd(this._makeLat(.5,10,e,t,n)));for(var r=0,a=[0,.25,.5,.75];r<a.length;r++){var o=a[r];i.push.apply(i,wd(this._makeLng(o,10,e,t,n)))}return i}},{key:"_makeAxis",value:function(e,t,n){var i=t.unprojectBasic([.5,1],.8*e),r=t.unprojectBasic([.5,0],1.2*e);return[i[0]-n[0],i[1]-n[1],i[2]-n[2],r[0]-n[0],r[1]-n[1],r[2]-n[2]]}},{key:"_makeLat",value:function(e,t,n,i,r){var a=.8*n,o=s(r,3),u=o[0],l=o[1],c=o[2],h=[],d=i.unprojectBasic([0,e],a);d[0]-=u,d[1]-=l,d[2]-=c,h.push.apply(h,wd(d));for(var f=1;f<=t;f++){var p=i.unprojectBasic([f/t,e],a);p[0]-=u,p[1]-=l,p[2]-=c,h.push.apply(h,wd(p).concat(wd(p)))}return h.push.apply(h,wd(d)),h}},{key:"_makeLng",value:function(e,t,n,i,r){var a=.8*n,o=s(r,3),u=o[0],l=o[1],c=o[2],h=[],d=i.unprojectBasic([e,0],a);d[0]-=u,d[1]-=l,d[2]-=c,h.push.apply(h,wd(d));for(var f=0;f<=t;f++){var p=i.unprojectBasic([e,f/t],a);p[0]-=u,p[1]-=l,p[2]-=c,h.push.apply(h,wd(p).concat(wd(p)))}return h.push.apply(h,wd(d)),h}}]),n}(VL),WL=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_makePositions",value:function(e,t,n){var i=[];return i.push.apply(i,wd(this._makeDiags(e,t,n))),i.push.apply(i,wd(this._makeFrame(e,8,t,n))),i}},{key:"_makeDiags",value:function(e,t,n){for(var i=s(n,3),r=i[0],a=i[1],o=i[2],u=[0,0,0],l=[],c=0,h=[[0,0],[1,0],[1,1],[0,1]];c<h.length;c++){var d=h[c],f=t.unprojectBasic(d,e);f[0]-=r,f[1]-=a,f[2]-=o,l.push.apply(l,u.concat(wd(f)))}return l}},{key:"_makeFrame",value:function(e,t,n,i){var r=[];r.push.apply(r,wd(this._subsample([0,1],[0,0],t))),r.push.apply(r,wd(this._subsample([0,0],[1,0],t))),r.push.apply(r,wd(this._subsample([1,0],[1,1],t)));for(var a=s(i,3),o=a[0],u=a[1],l=a[2],c=[],h=0,d=r;h<d.length;h++){var f=d[h],p=n.unprojectBasic(f,e);p[0]-=o,p[1]-=u,p[2]-=l,c.push.apply(c,wd(p))}return c}},{key:"_interpolate",value:function(e,t,n){return e+n*(t-e)}},{key:"_subsample",value:function(e,t,n){if(n<1)return[e,t];var i=[];i.push(e);for(var r=0;r<=n;r++){for(var a=[],o=0;o<3;o++)a.push(this._interpolate(e[o],t[o],r/(n+1)));i.push(a),i.push(a)}return i.push(t),i}}]),n}(VL);function GL(e,t,n){var i=s(t,3),r=s(RM(i[0],i[1],i[2],n.lng,n.lat,n.alt),3);return IM(r[0],r[1],r[2],e.lng,e.lat,e.alt)}var qL,ZL=function(){function e(t,n,i){Fd(this,e),this.id=t,this._scene=n,this._intersection=i,this.cameras=new Wg,this.keys=[],this._positionLines={},this._positions=new Wg,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new Rw({fog:!1,vertexColors:!0}),this._positionMaterial=new Rw({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}return $d(e,[{key:"addImage",value:function(e){var t=e.image,n=t.id;if(this.hasImage(n))throw new Error("Image exists ".concat(n));var i=e.idMap.ccId;this._connectedComponents.has(i)||this._connectedComponents.set(i,[]);var r=e.idMap.clusterId;this._clusters.has(r)||this._clusters.set(r,[]);var a=e.idMap.sequenceId;this._sequences.has(a)||this._sequences.set(a,[]),this._props[n]={image:t,ids:{ccId:i,clusterId:r,sequenceId:a}},this.keys.push(n)}},{key:"applyCameraColor",value:function(e,t){this._cameraFrames[e].setColor(t)}},{key:"applyCameraSize",value:function(e){var t,n=Pd(this.cameras.children);try{for(n.s();!(t=n.n()).done;){t.value.resize(e)}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"applyFilter",value:function(e){var t,n=this.clusterVisibles;for(var i in n)n.hasOwnProperty(i)&&(n[i]=!1);for(var r=this._cameraFrames,a=this._positionLines,o=this._intersection.interactiveLayer,s=0,u=Object.values(this._props);s<u.length;s++){var l=u[s],c=l.image,h=e(c),d=c.id;a[d].visible=h;var f=r[d];this._setCameraVisibility(f,h,o),n[t=l.ids.clusterId]||(n[t]=h)}}},{key:"applyPositionMode",value:function(e){this._positions.visible=e!==RL.Hidden;var t,n=Pd(this._positions.children);try{for(n.s();!(t=n.n()).done;){t.value.setMode(e)}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"dispose",value:function(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}},{key:"getCamerasByMode",value:function(e){if(e===IL.Cluster)return this._clusters;if(e===IL.ConnectedComponent)return this._connectedComponents;if(e===IL.Sequence)return this._sequences;var t=IL[IL.Homogeneous],n=new Map;return n.set(t,this.cameras.children),n}},{key:"getColorId",value:function(e,t){var n=this._props[e],i=IL;switch(t){case i.Cluster:return n.ids.clusterId;case i.ConnectedComponent:return n.ids.ccId;case i.Sequence:return n.ids.sequenceId;default:return i[i.Homogeneous]}}},{key:"hasImage",value:function(e){return-1!==this.keys.indexOf(e)}},{key:"resetReference",value:function(e,t){var n=this._cameraFrames;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];r.position.fromArray(GL(e,r.position.toArray(),t))}var a=this._positionLines;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];s.position.fromArray(GL(e,s.position.toArray(),t))}}},{key:"visualize",value:function(e){var t,n,i=e.id,r=e.visible,a=e.transform,o={color:e.color,material:this._frameMaterial,scale:e.scale,size:e.maxSize,transform:a},s=qM(a.cameraType)?new HL(o):new WL(o),u=this._intersection.interactiveLayer;this._setCameraVisibility(s,r,u),this.cameras.add(s),this._cameraFrames[i]=s,this._intersection.add(s,i);var l=this._props[i].ids;(t=this.clusterVisibles)[n=l.clusterId]||(t[n]=r),this._connectedComponents.get(l.ccId).push(s),this._clusters.get(l.clusterId).push(s),this._sequences.get(l.sequenceId).push(s);var c={material:this._positionMaterial,mode:e.positionMode,originalOrigin:e.originalPosition,transform:a},h=new UL(c);h.visible=r,this._positions.add(h),this._positionLines[i]=h}},{key:"_disposeCameras",value:function(){var e,t=this._intersection,n=this.cameras,i=Pd(n.children.slice());try{for(i.s();!(e=i.n()).done;){var r=e.value;r.dispose(),t.remove(r),n.remove(r)}}catch(MN){i.e(MN)}finally{i.f()}this._scene.remove(this.cameras)}},{key:"_disposePositions",value:function(){var e,t=this._positions,n=Pd(t.children.slice());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.dispose(),t.remove(i)}}catch(MN){n.e(MN)}finally{n.f()}this._scene.remove(this._positions)}},{key:"_setCameraVisibility",value:function(e,t,n){e.visible=t,t?e.layers.enable(n):e.layers.disable(n)}}]),e}(),XL=function(){function e(){Fd(this,e),this._colors=new Map;var t=IL;this._colors.set(t[t.Homogeneous],"#FFFFFF")}return $d(e,[{key:"getColor",value:function(e){var t=this._colors;return t.has(e)||t.set(e,this._randomColor()),t.get(e)}},{key:"_randomColor",value:function(){return"hsl(".concat(Math.floor(360*Math.random()),", 100%, 50%)")}}]),e}();function YL(e){return e!==IL.Hidden}!function(e){e[e.Hidden=0]="Hidden",e[e.Original=1]="Original",e[e.Cluster=2]="Cluster"}(qL||(qL={}));var KL=function(){function e(t,n){Fd(this,e),this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=n||new ew,this._scene.autoUpdate=!1,this._intersection=new jL,this._assets=new XL,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=t.cameraVisualizationMode?t.cameraVisualizationMode:IL.Homogeneous,this._cameraSize=t.cameraSize,this._pointSize=t.pointSize,this._pointVisualizationMode=t.pointVisualizationMode?t.pointVisualizationMode:qL.Original,this._positionMode=t.originalPositionMode,this._cellsVisible=t.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=function(){return!0}}return $d(e,[{key:"needsRender",get:function(){return this._needsRender}},{key:"intersection",get:function(){return this._intersection}},{key:"addCluster",value:function(e,t,n){if(!this.hasCluster(e.id,n)){var i=e.id;if(!(i in this._clusters)){this._clusters[i]={points:new Wg,cellIds:[]};var r=this._getClusterVisible(i),a=this._clusters[i],o=this._pointVisualizationMode===qL.Cluster?this._assets.getColor(i):null,s=new DL({cluster:e,color:o,originalSize:this._originalPointSize,scale:this._pointSize,translation:t});a.points.visible=r,a.points.add(s),this._scene.add(a.points)}-1===this._clusters[i].cellIds.indexOf(n)&&this._clusters[i].cellIds.push(n),n in this._cellClusters||(this._cellClusters[n]={keys:[]}),-1===this._cellClusters[n].keys.indexOf(i)&&this._cellClusters[n].keys.push(i),this._needsRender=!0}}},{key:"addImage",value:function(e,t,n,i){var r,a,o,s=e.id,u={clusterId:null!==(r=e.clusterId)&&void 0!==r?r:"NO_CLUSTER_ID",sequenceId:null!==(a=e.sequenceId)&&void 0!==a?a:"NO_SEQUENCE_ID",ccId:null!==(o=e.mergeId)&&void 0!==o?o:"NO_MERGE_ID"};if(!(i in this._images)){var l=new ZL(i,this._scene,this._intersection);l.cameras.visible=YL(this._cameraVisualizationMode),l.applyPositionMode(this._positionMode),this._images[i]=l}var c=this._images[i];if(!c.hasImage(s)){c.addImage({idMap:u,image:e});var h=c.getColorId(s,this._cameraVisualizationMode),d=this._assets.getColor(h),f=this._filter(e);if(c.visualize({id:s,color:d,positionMode:this._positionMode,scale:this._cameraSize,transform:t,visible:f,maxSize:this._originalCameraSize,originalPosition:n}),this._imageCellMap.set(s,i),s===this._selectedId&&this._highlight(s,this._colors.select,this._cameraVisualizationMode),u.clusterId in this._clusters){var p=this._getClusterVisible(u.clusterId);this._clusters[u.clusterId].points.visible=p}this._needsRender=!0}}},{key:"addCell",value:function(e,t){if(!this.hasCell(t)){var n=new OL(e);this._cells[t]=new Wg,this._cells[t].visible=this._cellsVisible,this._cells[t].add(n),this._scene.add(this._cells[t]),this._needsRender=!0}}},{key:"deactivate",value:function(){this._filter=function(){return!0},this._selectedId=null,this._hoveredId=null,this.uncache()}},{key:"hasCluster",value:function(e,t){return e in this._clusters&&-1!==this._clusters[e].cellIds.indexOf(t)}},{key:"hasCell",value:function(e){return e in this._cells}},{key:"hasImage",value:function(e,t){return t in this._images&&this._images[t].hasImage(e)}},{key:"render",value:function(e,t){t.render(this._scene,e),this._needsRender=!1}},{key:"resetReference",value:function(e,t){var n=this._clusters;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];r.points.position.fromArray(GL(e,r.points.position.toArray(),t))}var a=this._cells;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];s.position.fromArray(GL(e,s.position.toArray(),t))}var u=this._images;for(var l in u){if(u.hasOwnProperty(l))u[l].resetReference(e,t)}}},{key:"setCameraSize",value:function(e){if(!(Math.abs(e-this._cameraSize)<.001)){for(var t=this._images,n=0,i=Object.keys(t);n<i.length;n++){t[i[n]].applyCameraSize(e)}this._intersection.raycaster.near=this._getNear(e),this._cameraSize=e,this._needsRender=!0}}},{key:"setFilter",value:function(e){this._filter=e;for(var t={},n=0,i=Object.values(this._images);n<i.length;n++){var r=i[n];r.applyFilter(e);var a=r.clusterVisibles;for(var o in a)a.hasOwnProperty(o)&&(o in t||(t[o]=!1),t[o]||(t[o]=a[o]))}var s=this._pointVisualizationMode!==qL.Hidden;for(var u in t)if(t.hasOwnProperty(u)){t[u]&&(t[u]=s);var l=t[u];u in this._clusters&&(this._clusters[u].points.visible=l)}this._needsRender=!0}},{key:"setHoveredImage",value:function(e){if(null!=e&&!this._imageCellMap.has(e))throw new VM("Image does not exist: ".concat(e));this._hoveredId!==e&&(this._needsRender=!0,null!=this._hoveredId&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(e,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=e)}},{key:"setNavigationState",value:function(e){this._intersection.resetIntersectionThreshold(e)}},{key:"setPointSize",value:function(e){if(!(Math.abs(e-this._pointSize)<.001)){var t=this._clusters;for(var n in t)if(t.hasOwnProperty(n)){var i,r=Pd(t[n].points.children);try{for(r.s();!(i=r.n()).done;){i.value.resize(e)}}catch(MN){r.e(MN)}finally{r.f()}}this._pointSize=e,this._needsRender=!0}}},{key:"setPointVisualizationMode",value:function(e){if(e!==this._pointVisualizationMode){for(var t in this._pointVisualizationMode=e,this._clusters)if(this._clusters.hasOwnProperty(t)){var n=this._clusters[t];n.points.visible=this._getClusterVisible(t);var i,r=Pd(n.points.children);try{for(r.s();!(i=r.n()).done;){var a=i.value,o=e===qL.Cluster?this._assets.getColor(t):null;a.setColor(o)}}catch(MN){r.e(MN)}finally{r.f()}}this._needsRender=!0}}},{key:"setPositionMode",value:function(e){if(e!==this._positionMode){for(var t=0,n=Object.values(this._images);t<n.length;t++){n[t].applyPositionMode(e)}this._positionMode=e,this._needsRender=!0}}},{key:"setSelectedImage",value:function(e){this._selectedId!==e&&(this._needsRender=!0,null!=this._selectedId&&this._resetCameraColor(this._selectedId),this._highlight(e,this._colors.select,this._cameraVisualizationMode),this._selectedId=e)}},{key:"setCellVisibility",value:function(e){if(e!==this._cellsVisible){for(var t in this._cells)this._cells.hasOwnProperty(t)&&(this._cells[t].visible=e);this._cellsVisible=e,this._needsRender=!0}}},{key:"setCameraVisualizationMode",value:function(e){if(e!==this._cameraVisualizationMode){for(var t=YL(e),n=this._assets,i=0,r=Object.values(this._images);i<r.length;i++){var a=r[i];a.cameras.visible=t,a.getCamerasByMode(e).forEach((function(e,t){var i,r=n.getColor(t),a=Pd(e);try{for(a.s();!(i=a.n()).done;){i.value.setColor(r)}}catch(MN){a.e(MN)}finally{a.f()}}))}this._highlight(this._hoveredId,this._colors.hover,e),this._highlight(this._selectedId,this._colors.select,e),this._cameraVisualizationMode=e,this._needsRender=!0}}},{key:"uncache",value:function(e){for(var t=0,n=Object.keys(this._cellClusters);t<n.length;t++){var i=n[t];e&&-1!==e.indexOf(i)||this._disposeReconstruction(i)}for(var r=0,a=Object.keys(this._images);r<a.length;r++){var o=a[r];if(!e||-1===e.indexOf(o)){var s,u=this._imageCellMap,l=Pd(this._images[o].keys);try{for(l.s();!(s=l.n()).done;){var c=s.value;u.delete(c)}}catch(MN){l.e(MN)}finally{l.f()}this._images[o].dispose(),delete this._images[o]}}for(var h=0,d=Object.keys(this._cells);h<d.length;h++){var f=d[h];e&&-1!==e.indexOf(f)||this._disposeCell(f)}this._needsRender=!0}},{key:"_getClusterVisible",value:function(e){if(this._pointVisualizationMode===qL.Hidden)return!1;for(var t=!1,n=0,i=Object.values(this._images);n<i.length;n++){var r=i[n].clusterVisibles;e in r&&(t||(t=r[e]))}return t}},{key:"_disposePoints",value:function(e){var t,n=Pd(this._cellClusters[e].keys);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i in this._clusters){var r=this._clusters[i].cellIds.indexOf(e);if(-1!==r&&(this._clusters[i].cellIds.splice(r,1),!(this._clusters[i].cellIds.length>0))){var a,o=Pd(this._clusters[i].points.children.slice());try{for(o.s();!(a=o.n()).done;){a.value.dispose()}}catch(MN){o.e(MN)}finally{o.f()}this._scene.remove(this._clusters[i].points),delete this._clusters[i]}}}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"_disposeReconstruction",value:function(e){this._disposePoints(e),delete this._cellClusters[e]}},{key:"_disposeCell",value:function(e){var t,n=this._cells[e],i=Pd(n.children.slice());try{for(i.s();!(t=i.n()).done;){var r=t.value;r.dispose(),n.remove(r)}}catch(MN){i.e(MN)}finally{i.f()}this._scene.remove(n),delete this._cells[e]}},{key:"_getNear",value:function(e){var t=this._rayNearScale*this._originalCameraSize*e;return Math.max(1,t)}},{key:"_resetCameraColor",value:function(e){var t=this._imageCellMap;if(null!=e&&t.has(e)){var n=t.get(e),i=this._images[n],r=i.getColorId(e,this._cameraVisualizationMode),a=this._assets.getColor(r);i.applyCameraColor(e,a)}}},{key:"_highlight",value:function(e,t,n){var i=this._imageCellMap;if(null!=e&&i.has(e)){var r=i.get(e);t=n===IL.Homogeneous?t:"#FFFFFF",this._images[r].applyCameraColor(e,t)}}}]),e}(),JL=function(){function e(t,n){Fd(this,e),this._graphService=t,this._data=n,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}return $d(e,[{key:"cacheClusters$",value:function(e){var t=this;if(!this.hasCell(e))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(e))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(e))return this._cachingClusters$[e];var n,i=this.getCell(e).filter((function(e){return!!e.clusterId&&!!e.clusterUrl})).map((function(e){return{key:e.clusterId,url:e.clusterUrl}})),r=Array.from(new Map(i.map((function(e){return[e.key,e]}))).values());this._cellClusters[e]=r,this._cacheRequests[e]=[];var a=new Promise((function(e,t){n=t}));return this._cacheRequests[e].push(n),this._cachingClusters$[e]=this._cacheClusters$(r,e,a).pipe(hv((function(){e in t._cachingClusters$&&delete t._cachingClusters$[e],e in t._cacheRequests&&delete t._cacheRequests[e]})),gv(),Ef()),this._cachingClusters$[e]}},{key:"cacheCell$",value:function(e){var t=this;if(this.hasCell(e))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(e)||(this._cachingCells$[e]=this._graphService.cacheCell$(e).pipe(Kp((function(e){return console.error(e),Hf()})),qp((function(){return!(e in t._cells)})),Pv((function(n){var i;t._cells[e]=[],(i=t._cells[e]).push.apply(i,wd(n)),delete t._cachingCells$[e]})),hv((function(){e in t._cachingCells$&&delete t._cachingCells$[e]})),gv(),Ef())),this._cachingCells$[e]}},{key:"isCachingClusters",value:function(e){return e in this._cachingClusters$}},{key:"isCachingCell",value:function(e){return e in this._cachingCells$}},{key:"hasClusters",value:function(e){if(e in this._cachingClusters$||!(e in this._cellClusters))return!1;var t,n=Pd(this._cellClusters[e]);try{for(n.s();!(t=n.n()).done;){if(!(t.value.key in this._clusters))return!1}}catch(MN){n.e(MN)}finally{n.f()}return!0}},{key:"hasCell",value:function(e){return!(e in this._cachingCells$)&&e in this._cells}},{key:"getClusters",value:function(e){var t=this;return e in this._cellClusters?this._cellClusters[e].map((function(e){return t._clusters[e.key]})).filter((function(e){return!!e})):[]}},{key:"getCell",value:function(e){return e in this._cells?this._cells[e]:[]}},{key:"uncache",value:function(e){for(var t=0,n=Object.keys(this._cacheRequests);t<n.length;t++){var i=n[t];if(!e||-1===e.indexOf(i)){var r,a=Pd(this._cacheRequests[i]);try{for(a.s();!(r=a.n()).done;){(0,r.value)()}}catch(MN){a.e(MN)}finally{a.f()}delete this._cacheRequests[i]}}for(var o=0,s=Object.keys(this._cellClusters);o<s.length;o++){var u=s[o];if(!e||-1===e.indexOf(u)){var l,c=Pd(this._cellClusters[u]);try{for(c.s();!(l=c.n()).done;){var h=l.value;if(h.key in this._clusterCells){var d=this._clusterCells[h.key].indexOf(u);-1!==d&&(this._clusterCells[h.key].splice(d,1),this._clusterCells[h.key].length>0||(delete this._clusterCells[h.key],delete this._clusters[h.key]))}}}catch(MN){c.e(MN)}finally{c.f()}delete this._cellClusters[u]}}for(var f=0,p=Object.keys(this._cells);f<p.length;f++){var v=p[f];e&&-1!==e.indexOf(v)||delete this._cells[v]}}},{key:"updateCell$",value:function(e){var t=this;if(!this.hasCell(e))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(e).pipe(Kp((function(e){return console.error(e),Hf()})),qp((function(){return e in t._cells})),Pv((function(n){var i;t._cells[e]=[],(i=t._cells[e]).push.apply(i,wd(n))})),gv(),Ef())}},{key:"updateClusters$",value:function(e){var t,n=this;if(!this.hasCell(e))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(e))throw new Error("Cannot update reconstructions for cell that is not cached.");var i=this.getCell(e).filter((function(e){return!!e.clusterId&&!!e.clusterUrl})).map((function(e){return{key:e.clusterId,url:e.clusterUrl}})),r=Array.from(new Map(i.map((function(e){return[e.key,e]}))).values()).filter((function(e){return!(e.key in n._clusters)}));return(t=this._cellClusters[e]).push.apply(t,wd(r)),this._cacheClusters$(r,e,null)}},{key:"_cacheClusters$",value:function(e,t,n){var i=this;return rp(e).pipe(Np((function(e){return i._hasCluster(e.key)?pp(i._getCluster(e.key)):i._getCluster$(e.url,e.key,n).pipe(Kp((function(e){return e instanceof EP||console.error(e),Hf()})))}),6),qp((function(){return t in i._cellClusters})),Pv((function(e){i._hasCluster(e.id)||(i._clusters[e.id]=e),e.id in i._clusterCells||(i._clusterCells[e.id]=[]),-1===i._clusterCells[e.id].indexOf(t)&&i._clusterCells[e.id].push(t)})))}},{key:"_getCluster",value:function(e){return this._clusters[e]}},{key:"_getCluster$",value:function(e,t,n){var i=this;return kf.create((function(r){i._data.getCluster(e,n).then((function(e){e.id=t,r.next(e),r.complete()}),(function(e){r.error(e)}))}))}},{key:"_hasCluster",value:function(e){return e in this._clusters}}]),e}();function QL(e,t,n){var i=new Set;return i.add(e),eA(i,[e],0,t,n),Array.from(i)}function eA(e,t,n,i,r){if(!(n>=i)){var a,o=[],s=Pd(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=r.getAdjacent(u);o.push.apply(o,wd(l))}}catch(MN){s.e(MN)}finally{s.f()}for(var c=[],h=0,d=o;h<d.length;h++){var f=d[h];e.has(f)||(e.add(f),c.push(f))}eA(e,c,n+1,i,r)}}var tA=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._cache=new JL(r.graphService,r.api.data),a._scene=new KL(a._getDefaultConfiguration()),a._viewportCoords=new MP,a._spatial=new WM,a}return $d(n,[{key:"getFrameIdAt",value:function(e){var t=this;return new Promise((function(n,i){t._container.renderService.renderCamera$.pipe(dv(),xp((function(n){var i=t._viewportCoords.canvasToViewport(e[0],e[1],t._container.container);return t._scene.intersection.intersectObjects(i,n.perspective)}))).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"_activate",value:function(){var e=this;this._navigator.cacheService.configure({cellDepth:3});var t=this._subscriptions;t.push(this._navigator.stateService.reference$.pipe(mv()).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];e._scene.resetReference(r,i)}))),t.push(this._navigator.graphService.filter$.subscribe((function(t){e._scene.setFilter(t)})));var n=this._container.renderService.bearing$.pipe(xp((function(e){return 6*Math.floor(e/6)})),ov(),_v(1),Ef()),i=this._navigator.stateService.currentImage$.pipe(xp((function(t){return e._navigator.api.data.geometry.lngLatToCellId(t.originalLngLat)})),ov(),_v(1),Ef()),r=this._configuration$.pipe(xp((function(t){return e._spatial.clamp(t.cellGridDepth,1,3)})),ov(),_v(1),Ef()),a=Lp(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return n&&i>NL.sequenceSpeed})),ov(),_v(1),Ef()),o=this._navigator.stateService.state$.pipe(xp((function(e){return function(e){return e===XP.Custom||e===XP.Earth}(e)})),ov(),_v(1),Ef());t.push(o.subscribe((function(t){e._scene.setNavigationState(t)})));var u=Lp(o,a,n,r,this._navigator.stateService.currentImage$).pipe(ov((function(e,t){var n=s(e,5),i=n[0],r=n[1],a=n[2],o=n[3],u=n[4],l=s(t,5),c=l[0],h=l[1],d=l[2],f=l[3],p=l[4];if(i!==c)return!1;var v=u.id===p.id&&r===h&&o===f;return i?v:v&&a===d})),ev((function(t){var n=s(t,5),i=n[0],r=n[1],a=n[2],o=n[3],u=n[4];if(i){var l=e._navigator.api.data.geometry,c=l.lngLatToCellId(u.originalLngLat);return pp(r?[c]:QL(c,o,l))}var h=r?30:90;return pp(e._cellsInFov(u,a,h))})),Tv((function(t){return rp(t).pipe(Np((function(t){return(e._cache.hasCell(t)?pp(e._cache.getCell(t)):e._cache.cacheCell$(t)).pipe(xp((function(e){return{id:t,images:e}})))}),6))})));t.push(u.pipe(Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];e._scene.hasCell(i.id)||e._scene.addCell(e._cellToTopocentric(i.id,r),i.id)}))),t.push(u.pipe(Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];e._addSceneImages(i,r)}))),t.push(u.pipe(ev((function(t){var n,i=t.id;return n=e._cache.hasClusters(i)?rp(e._cache.getClusters(i)):e._cache.isCachingClusters(i)?e._cache.cacheClusters$(i).pipe(pv(null,{}),Tv((function(){return rp(e._cache.getClusters(i))}))):e._cache.hasCell(i)?e._cache.cacheClusters$(i):Hf(),Lp(pp(i),n)})),Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1];e._scene.hasCluster(a.id,r)||e._scene.addCluster(a,e._computeTranslation(a,o),r)}))),t.push(this._configuration$.pipe(xp((function(t){var n;t.cameraSize=e._spatial.clamp(t.cameraSize,.01,1),t.pointSize=e._spatial.clamp(t.pointSize,.01,1);var i=t.pointsVisible?null!==(n=t.pointVisualizationMode)&&void 0!==n?n:qL.Original:qL.Hidden;return{cameraSize:t.cameraSize,cameraVisualizationMode:t.cameraVisualizationMode,cellsVisible:t.cellsVisible,originalPositionMode:t.originalPositionMode,pointSize:t.pointSize,pointVisualizationMode:i}})),ov((function(e,t){return e.cameraSize===t.cameraSize&&e.cameraVisualizationMode===t.cameraVisualizationMode&&e.cellsVisible===t.cellsVisible&&e.originalPositionMode===t.originalPositionMode&&e.pointSize===t.pointSize&&e.pointVisualizationMode===t.pointVisualizationMode}))).subscribe((function(t){e._scene.setCameraSize(t.cameraSize);var n=t.cameraVisualizationMode;e._scene.setCameraVisualizationMode(n),e._scene.setCellVisibility(t.cellsVisible),e._scene.setPointSize(t.pointSize);var i=t.pointVisualizationMode;e._scene.setPointVisualizationMode(i);var r=t.originalPositionMode;e._scene.setPositionMode(r)}))),t.push(Lp(i,r).subscribe((function(t){var n=s(t,2),i=QL(n[0],n[1],e._navigator.api.data.geometry);e._scene.uncache(i),e._cache.uncache(i)}))),t.push(this._navigator.playService.playing$.pipe(Tv((function(t){return t?Hf():e._container.mouseService.dblClick$})),Lv(this._container.renderService.renderCamera$),Tv((function(t){var n=s(t,2),i=n[0],r=n[1],a=e._container.container,o=s(e._viewportCoords.canvasPosition(i,a),2),u=o[0],l=o[1],c=e._viewportCoords.canvasToViewport(u,l,a),h=e._scene.intersection.intersectObjects(c,r.perspective);return h?e._navigator.moveTo$(h).pipe(Kp((function(){return Hf()}))):Hf()}))).subscribe());var l=Lp(this._configuration$,this._navigator.stateService.state$).pipe(xp((function(t){var n=s(t,2),i=n[0],r=n[1];return i.cameraSize=e._spatial.clamp(i.cameraSize,.01,1),{size:i.cameraSize,visible:YL(i.cameraVisualizationMode),state:r}})),ov((function(e,t){return e.size===t.size&&e.visible===t.visible&&e.state===t.state}))),c=this._container.mouseService.mouseMove$.pipe(_v(1),Ef());t.push(c.subscribe());var h=Hp(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);t.push(Lp(this._navigator.playService.playing$,h,o,this._navigator.graphService.filter$).pipe(Tv((function(t){var n=s(t,2),i=n[0],r=n[1];return i||"pointerenter"!==r.type?Lp(pp(r),pp(null),pp(null)):Lp(zp(c.pipe(av(1)),e._container.mouseService.mouseMove$),e._container.renderService.renderCamera$,l)}))).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];if("pointermove"===i.type){var a=e._container.container,o=s(e._viewportCoords.canvasPosition(i,a),2),u=o[0],l=o[1],c=e._viewportCoords.canvasToViewport(u,l,a),h=e._scene.intersection.intersectObjects(c,r.perspective);e._scene.setHoveredImage(h)}else e._scene.setHoveredImage(null)}))),t.push(this._navigator.stateService.currentId$.subscribe((function(t){e._scene.setSelectedImage(t)}))),t.push(this._navigator.stateService.currentState$.pipe(xp((function(t){var n=e._scene;return{name:e._name,renderer:{frameId:t.id,needsRender:n.needsRender,render:n.render.bind(n),pass:RP.Opaque}}}))).subscribe(this._container.glRenderer.render$));var d=this._navigator.graphService.dataAdded$.pipe(qp((function(t){return e._cache.hasCell(t)})),Np((function(t){return e._cache.updateCell$(t).pipe(xp((function(e){return{id:t,images:e}})),Lv(e._navigator.stateService.reference$))})),gv(),Ef());t.push(d.subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];e._addSceneImages(i,r)}))),t.push(d.pipe(ev((function(t){var n,i=s(t,1)[0].id,r=e._cache;return n=r.hasClusters(i)?r.updateClusters$(i):r.isCachingClusters(i)?e._cache.cacheClusters$(i).pipe(pv(null,{}),Tv((function(){return rp(r.updateClusters$(i))}))):Hf(),Lp(pp(i),n)})),Lv(this._navigator.stateService.reference$)).subscribe((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1];e._scene.hasCluster(a.id,r)||e._scene.addCluster(a,e._computeTranslation(a,o),r)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}},{key:"_getDefaultConfiguration",value:function(){return{cameraSize:.1,cameraVisualizationMode:IL.Homogeneous,cellGridDepth:1,originalPositionMode:RL.Hidden,pointSize:.1,pointsVisible:!0,pointVisualizationMode:qL.Original,cellsVisible:!1}}},{key:"_addSceneImages",value:function(e,t){var n,i=e.id,r=Pd(e.images);try{for(r.s();!(n=r.n()).done;){var a=n.value;this._scene.hasImage(a.id,i)||this._scene.addImage(a,this._createTransform(a,t),this._computeOriginalPosition(a,t),i)}}catch(MN){r.e(MN)}finally{r.f()}}},{key:"_cellsInFov",value:function(e,t,n){var i,r=this._spatial,a=this._navigator.api.data.geometry,o=a.lngLatToCellId(e.originalLngLat),u=[o],l=n/2,c=Pd(a.getAdjacent(o));try{for(c.s();!(i=c.n()).done;){var h,d=i.value,f=Pd(a.getVertices(d));try{for(f.s();!(h=f.n()).done;){var p=h.value,v=s(IM(p.lng,p.lat,0,e.lngLat.lng,e.lngLat.lat,0),2),m=v[0],g=v[1],_=Math.atan2(g,m),y=r.radToDeg(r.azimuthalToBearing(_));Math.abs(y-t)<l&&u.push(d)}}catch(MN){f.e(MN)}finally{f.f()}}}catch(MN){c.e(MN)}finally{c.f()}return u}},{key:"_computeOriginalPosition",value:function(e,t){return IM(e.originalLngLat.lng,e.originalLngLat.lat,null!=e.originalAltitude?e.originalAltitude:e.computedAltitude,t.lng,t.lat,t.alt)}},{key:"_cellToTopocentric",value:function(e,t){var n=this._navigator.api.data.geometry.getVertices(e).map((function(e){return IM(e.lng,e.lat,-2,t.lng,t.lat,t.alt)}));return n}},{key:"_computeTranslation",value:function(e,t){return IM(e.reference.lng,e.reference.lat,e.reference.alt,t.lng,t.lat,t.alt)}},{key:"_createTransform",value:function(e,t){var n=XM({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t);return new EL(e.exifOrientation,e.width,e.height,e.scale,e.rotation,n,void 0,void 0,e.cameraParameters,e.cameraType)}}]),n}(xP);tA.componentName="spatial";var nA=function(){function e(){Fd(this,e),this._notifyChanged$=new Af}return $d(e,[{key:"changed$",get:function(){return this._notifyChanged$}}]),e}(),iA=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),i=t.call(this,null!=e?e:"The provided geometry value is incorrect"),Object.setPrototypeOf(Ad(i),n.prototype),i.name="GeometryTagError",i}return $d(n)}(VM),rA=function(e){Dd(n,e);var t=Od(n);function n(e){var i;if(Fd(this,n),i=t.call(this),e.length<2)throw new iA("A points geometry must have two or more positions.");i._points=[];var r,a=Pd(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o[0]<0||o[0]>1||o[1]<0||o[1]>1)throw new iA("Basic coordinates of points must be on the interval [0, 1].");i._points.push(o.slice())}}catch(MN){a.e(MN)}finally{a.f()}return i}return $d(n,[{key:"points",get:function(){return this._points}},{key:"addPoint2d",value:function(e){var t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points.push(t),this._notifyChanged$.next(this)}},{key:"getPoint2d",value:function(e){return this._points[e].slice()}},{key:"removePoint2d",value:function(e){if(e<0||e>=this._points.length||this._points.length<3)throw new iA("Index for removed point must be valid.");this._points.splice(e,1),this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(e,t,n){this.setPoint2d(e,t,n)}},{key:"setPoint2d",value:function(e,t,n){var i=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points[e]=i,this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(e){return this._getPoints3d(this._points,e)}},{key:"getPoint3d",value:function(e,t){return t.unprojectBasic(this._points[e],200)}},{key:"getPoints2d",value:function(){return this._points.slice()}},{key:"getCentroid2d",value:function(e){if(!e)throw new iA("Get centroid must be called with a transform for points geometries.");var t=s(this.getRect2d(e),4),n=t[0],i=t[1],r=t[2];return[n<r?(n+r)/2:(n+r+1)/2%1,(i+t[3])/2]}},{key:"getCentroid3d",value:function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)}},{key:"getRect2d",value:function(e){var t,n=1,i=0,r=1,a=0,o=this._points,s=Pd(o);try{for(s.s();!(t=s.n()).done;){var u=t.value;u[0]<n&&(n=u[0]),u[0]>i&&(i=u[0]),u[1]<r&&(r=u[1]),u[1]>a&&(a=u[1])}}catch(MN){s.e(MN)}finally{s.f()}if(qM(e.cameraType)){for(var l=[],c=0;c<o.length;c++)l[c]=c;l.sort((function(e,t){return o[e][0]<o[t][0]?-1:o[e][0]>o[t][0]?1:e<t?-1:1}));for(var h=o[l[0]][0]+1-o[l[l.length-1]][0],d=0,f=0;f<l.length-1;f++){var p=l[f],v=l[f+1],m=o[v][0]-o[p][0];m>h&&(h=m,d=f+1)}d>0&&(n=o[l[d]][0],i=o[l[d-1]][0])}return[n,r,i,a]}},{key:"setCentroid2d",value:function(e,t){throw new Error("Not implemented")}},{key:"_getPoints3d",value:function(e,t){return e.map((function(e){return t.unprojectBasic(e,200)}))}}]),n}(nA),aA=function(){function e(t,n,i){var r=this;Fd(this,e),this._geometry=t,this._transform=n,this._viewportCoords=i||new MP,this._aborted$=new Af,this._created$=new Af,this._glObjectsChanged$=new Af,this._geometryChangedSubscription=this._geometry.changed$.subscribe((function(){r._onGeometryChanged(),r._glObjectsChanged$.next(r)}))}return $d(e,[{key:"geometry",get:function(){return this._geometry}},{key:"glObjects",get:function(){return this._glObjects}},{key:"aborted$",get:function(){return this._aborted$}},{key:"created$",get:function(){return this._created$}},{key:"glObjectsChanged$",get:function(){return this._glObjectsChanged$}},{key:"geometryChanged$",get:function(){var e=this;return this._geometry.changed$.pipe(xp((function(){return e})))}},{key:"dispose",value:function(){this._geometryChangedSubscription.unsubscribe()}},{key:"_canvasToTransform",value:function(e){var t=Math.round(e[0]),n=Math.round(e[1]);return"translate(-50%,-50%) translate(".concat(t,"px,").concat(n,"px)")}},{key:"_colorToBackground",value:function(e){return"#"+("000000"+e.toString(16)).substr(-6)}},{key:"_createOutine",value:function(e,t){var n=this._getLinePositions(e),i=new C_;i.setAttribute("position",new v_(n,3));var r=new Rw({color:t,linewidth:1});return new Bw(i,r)}},{key:"_disposeLine",value:function(e){null!=e&&(e.geometry.dispose(),e.material.dispose())}},{key:"_getLinePositions",value:function(e){for(var t=e.length,n=new Float32Array(3*t),i=0;i<t;++i){var r=3*i,a=e[i];n[r]=a[0],n[r+1]=a[1],n[r+2]=a[2]}return n}}]),e}(),oA={exports:{}};function sA(e,t,n){n=n||2;var i,r,a,o,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,d=uA(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=uA(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(yA(o));for(s.sort(vA),r=0;r<s.length;r++)n=lA(n=mA(s[r],n),n.next);return n}(e,t,d,n)),e.length>80*n){i=a=e[0],r=o=e[1];for(var p=n;p<h;p+=n)(s=e[p])<i&&(i=s),(u=e[p+1])<r&&(r=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-i,o-r))?1/l:0}return cA(d,f,n,i,r,l),f}function uA(e,t,n,i,r){var a,o;if(r===IA(e,t,n,i)>0)for(a=t;a<n;a+=i)o=PA(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=PA(a,e[a],e[a+1],o);return o&&kA(o,o.next)&&(LA(o),o=o.next),o}function lA(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!kA(i,i.next)&&0!==wA(i.prev,i,i.next))i=i.next;else{if(LA(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function cA(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=_A(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(e,i,r,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?dA(e,i,r,a):hA(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),LA(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?cA(e=fA(lA(e),t,n),t,n,i,r,a,2):2===o&&pA(e,t,n,i,r,a):cA(lA(e),t,n,i,r,a,1);break}}}function hA(e){var t=e.prev,n=e,i=e.next;if(wA(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(bA(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&wA(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function dA(e,t,n,i){var r=e.prev,a=e,o=e.next;if(wA(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=_A(s,u,t,n,i),d=_A(l,c,t,n,i),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&bA(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&wA(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&bA(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&wA(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&bA(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&wA(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&bA(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&wA(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function fA(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!kA(r,a)&&SA(r,i,i.next,a)&&CA(r,a)&&CA(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),LA(i),LA(i.next),i=e=a),i=i.next}while(i!==e);return lA(i)}function pA(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&xA(o,s)){var u=EA(o,s);return o=lA(o,o.next),u=lA(u,u.next),cA(o,t,n,i,r,a),void cA(u,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function vA(e,t){return e.x-t.x}function mA(e,t){var n=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var u,l=n,c=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&bA(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(r-i.x),CA(i,e)&&(u<d||u===d&&(i.x>n.x||i.x===n.x&&gA(n,i)))&&(n=i,d=u)),i=i.next}while(i!==l);return n}(e,t);if(!n)return t;var i=EA(n,e),r=lA(n,n.next);return lA(i,i.next),t===n?r:t}function gA(e,t){return wA(e.prev,e,t.prev)<0&&wA(t.next,e,e.next)<0}function _A(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function yA(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function bA(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function xA(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&SA(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(CA(e,t)&&CA(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(wA(e.prev,e,t.prev)||wA(e,t.prev,t))||kA(e,t)&&wA(e.prev,e,e.next)>0&&wA(t.prev,t,t.next)>0)}function wA(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function kA(e,t){return e.x===t.x&&e.y===t.y}function SA(e,t,n,i){var r=TA(wA(e,t,n)),a=TA(wA(e,t,i)),o=TA(wA(n,i,e)),s=TA(wA(n,i,t));return r!==a&&o!==s||(!(0!==r||!MA(e,n,t))||(!(0!==a||!MA(e,i,t))||(!(0!==o||!MA(n,e,i))||!(0!==s||!MA(n,t,i)))))}function MA(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function TA(e){return e>0?1:e<0?-1:0}function CA(e,t){return wA(e.prev,e,e.next)<0?wA(e,t,e.next)>=0&&wA(e,e.prev,t)>=0:wA(e,t,e.prev)<0||wA(e,e.next,t)<0}function EA(e,t){var n=new AA(e.i,e.x,e.y),i=new AA(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function PA(e,t,n,i){var r=new AA(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function LA(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function AA(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function IA(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}oA.exports=sA,oA.exports.default=sA,sA.deviation=function(e,t,n,i){var r=t&&t.length,a=r?t[0]*n:e.length,o=Math.abs(IA(e,0,a,n));if(r)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;o-=Math.abs(IA(e,l,c,n))}var h=0;for(s=0;s<i.length;s+=3){var d=i[s]*n,f=i[s+1]*n,p=i[s+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},sA.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[r][a][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n};var RA=oA.exports,NA={exports:{}},DA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:OA;if(Fd(this,e),this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}return $d(e,[{key:"push",value:function(e){this.data.push(e),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,a=t[r];if(n(i,a)>=0)break;t[e]=a,e=r}t[e]=i}},{key:"_down",value:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&n(t[s],o)<0&&(a=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=a}t[e]=r}}]),e}();function OA(e,t){return e<t?-1:e>t?1:0}var zA=wT(Object.freeze({__proto__:null,default:DA}));function FA(e,t,n){var i,r,a,o;t=t||1;for(var s=0;s<e[0].length;s++){var u=e[0][s];(!s||u[0]<i)&&(i=u[0]),(!s||u[1]<r)&&(r=u[1]),(!s||u[0]>a)&&(a=u[0]),(!s||u[1]>o)&&(o=u[1])}var l=a-i,c=o-r,h=Math.min(l,c),d=h/2;if(0===h){var f=[i,r];return f.distance=0,f}for(var p=new zA(void 0,BA),v=i;v<a;v+=h)for(var m=r;m<o;m+=h)p.push(new $A(v+d,m+d,d,e));var g=function(e){for(var t=0,n=0,i=0,r=e[0],a=0,o=r.length,s=o-1;a<o;s=a++){var u=r[a],l=r[s],c=u[0]*l[1]-l[0]*u[1];n+=(u[0]+l[0])*c,i+=(u[1]+l[1])*c,t+=3*c}return 0===t?new $A(r[0][0],r[0][1],0,e):new $A(n/t,i/t,0,e)}(e),_=new $A(i+l/2,r+c/2,0,e);_.d>g.d&&(g=_);for(var y=p.length;p.length;){var b=p.pop();b.d>g.d&&(g=b,n&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(d=b.h/2,p.push(new $A(b.x-d,b.y-d,d,e)),p.push(new $A(b.x+d,b.y-d,d,e)),p.push(new $A(b.x-d,b.y+d,d,e)),p.push(new $A(b.x+d,b.y+d,d,e)),y+=4)}n&&(console.log("num probes: "+y),console.log("best distance: "+g.d));var x=[g.x,g.y];return x.distance=g.d,x}function BA(e,t){return t.max-e.max}function $A(e,t,n,i){this.x=e,this.y=t,this.h=n,this.d=function(e,t,n){for(var i=!1,r=1/0,a=0;a<n.length;a++)for(var o=n[a],s=0,u=o.length,l=u-1;s<u;l=s++){var c=o[s],h=o[l];c[1]>t!==h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(i=!i),r=Math.min(r,jA(e,t,c,h))}return 0===r?0:(i?1:-1)*Math.sqrt(r)}(e,t,i),this.max=this.d+this.h*Math.SQRT2}function jA(e,t,n,i){var r=n[0],a=n[1],o=i[0]-r,s=i[1]-a;if(0!==o||0!==s){var u=((e-r)*o+(t-a)*s)/(o*o+s*s);u>1?(r=i[0],a=i[1]):u>0&&(r+=o*u,a+=s*u)}return(o=e-r)*o+(s=t-a)*s}zA.default&&(zA=zA.default),NA.exports=FA,NA.exports.default=FA;var UA=NA.exports;function VA(e,t){return e>t?1:e<t?-1:0}var HA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VA,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Fd(this,e),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!n}return $d(e,[{key:"rotateLeft",value:function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}},{key:"rotateRight",value:function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}},{key:"_splay",value:function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}},{key:"splay",value:function(e){for(var t,n,i,r,a;e.parent;)(n=(t=e.parent).parent)&&n.parent?((i=n.parent).left===n?i.left=e:i.right=e,e.parent=i):(e.parent=null,this._root=e),r=e.left,a=e.right,e===t.left?(n&&(n.left===t?(t.right?(n.left=t.right,n.left.parent=n):n.left=null,t.right=n,n.parent=t):(r?(n.right=r,r.parent=n):n.right=null,e.left=n,n.parent=e)),a?(t.left=a,a.parent=t):t.left=null,e.right=t,t.parent=e):(n&&(n.right===t?(t.left?(n.right=t.left,n.right.parent=n):n.right=null,t.left=n,n.parent=t):(a?(n.left=a,a.parent=n):n.left=null,e.right=n,n.parent=e)),r?(t.right=r,r.parent=t):t.right=null,e.left=t,t.parent=e)}},{key:"replace",value:function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}},{key:"minNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(e)for(;e.left;)e=e.left;return e}},{key:"maxNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(e)for(;e.right;)e=e.right;return e}},{key:"insert",value:function(e,t){var n=this._root,i=null,r=this._compare;if(this._noDuplicates)for(;n;){if(i=n,0===r(n.key,e))return;n=r(n.key,e)<0?n.right:n.left}else for(;n;)i=n,n=r(n.key,e)<0?n.right:n.left;return n={key:e,data:t,left:null,right:null,parent:i},i?r(i.key,n.key)<0?i.right=n:i.left=n:this._root=n,this.splay(n),this._size++,n}},{key:"find",value:function(e){for(var t=this._root,n=this._compare;t;){var i=n(t.key,e);if(i<0)t=t.right;else{if(!(i>0))return t;t=t.left}}return null}},{key:"contains",value:function(e){for(var t=this._root,n=this._compare;t;){var i=n(e,t.key);if(0===i)return!0;t=i<0?t.left:t.right}return!1}},{key:"remove",value:function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var n=this.minNode(t.right);n.parent!==t&&(this.replace(n,n.right),n.right=t.right,n.right.parent=n),this.replace(t,n),n.left=t.left,n.left.parent=n}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}},{key:"removeNode",value:function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}},{key:"erase",value:function(e){var t=this.find(e);if(t){this.splay(t);var n=t.left,i=t.right,r=null;n&&(n.parent=null,r=this.maxNode(n),this.splay(r),this._root=r),i&&(n?r.right=i:this._root=i,i.parent=r),this._size--}}},{key:"pop",value:function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}},{key:"next",value:function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}},{key:"prev",value:function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}},{key:"forEach",value:function(e){for(var t=this._root,n=[],i=!1,r=0;!i;)t?(n.push(t),t=t.left):n.length>0?(e(t=n.pop(),r++),t=t.right):i=!0;return this}},{key:"range",value:function(e,t,n,i){for(var r=[],a=this._compare,o=this._root;0!==r.length||o;)if(o)r.push(o),o=o.left;else{if(a((o=r.pop()).key,t)>0)break;if(a(o.key,e)>=0&&n.call(i,o))return this;o=o.right}return this}},{key:"keys",value:function(){for(var e=this._root,t=[],n=[],i=!1;!i;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.key),e=e.right):i=!0;return n}},{key:"values",value:function(){for(var e=this._root,t=[],n=[],i=!1;!i;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.data),e=e.right):i=!0;return n}},{key:"at",value:function(e){for(var t=this._root,n=[],i=!1,r=0;!i;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),r===e)return t;r++,t=t.right}else i=!0;return null}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var i=e.length;return n&&GA(e,t,0,i-1,this._compare),this._root=WA(null,e,t,0,i),this._size=i,this}},{key:"min",value:function(){var e=this.minNode(this._root);return e?e.key:null}},{key:"max",value:function(){var e=this.maxNode(this._root);return e?e.key:null}},{key:"isEmpty",value:function(){return null===this._root}},{key:"size",get:function(){return this._size}}],[{key:"createTree",value:function(t,n,i,r,a){return new e(i,a).load(t,n,r)}}]),e}();function WA(e,t,n,i,r){var a=r-i;if(a>0){var o=i+Math.floor(a/2),s={key:t[o],data:n[o],parent:e};return s.left=WA(s,t,n,i,o),s.right=WA(s,t,n,o+1,r),s}return null}function GA(e,t,n,i,r){if(!(n>=i)){for(var a=e[n+i>>1],o=n-1,s=i+1;;){do{o++}while(r(e[o],a)<0);do{s--}while(r(e[s],a)>0);if(o>=s)break;var u=e[o];e[o]=e[s],e[s]=u,u=t[o],t[o]=t[s],t[s]=u}GA(e,t,n,s,r),GA(e,t,s+1,i,r)}}function qA(e,t,n){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!ZA(t,n)||t.isVertical()?t.prevInResult:t));var i=ZA(e,n);e.resultTransition=i?function(e,t){var n,i=!e.inOut,r=!e.otherInOut;switch(t){case 0:n=i&&r;break;case 1:n=i||r;break;case 3:n=i^r;break;case 2:n=e.isSubject?i&&!r:r&&!i}return n?1:-1}(e,n):0}function ZA(e,t){switch(e.type){case 0:switch(t){case 0:return!e.otherInOut;case 1:return e.otherInOut;case 2:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case 3:return!0}break;case 2:return 0===t||1===t;case 3:return 2===t;case 1:return!1}return!1}var XA=function(){function e(t,n,i,r,a){Fd(this,e),this.left=n,this.point=t,this.otherEvent=i,this.isSubject=r,this.type=a||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}return $d(e,[{key:"isBelow",value:function(e){var t=this.point,n=this.otherEvent.point;return this.left?(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])>0:(n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1])>0}},{key:"isAbove",value:function(e){return!this.isBelow(e)}},{key:"isVertical",value:function(){return this.point[0]===this.otherEvent.point[0]}},{key:"inResult",get:function(){return 0!==this.resultTransition}},{key:"clone",value:function(){var t=new e(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}]),e}();function YA(e,t){return e[0]===t[0]&&e[1]===t[1]}var KA=134217729;function JA(e,t,n,i,r){var a,o,s,u,l=t[0],c=i[0],h=0,d=0;c>l===c>-l?(a=l,l=t[++h]):(a=c,c=i[++d]);var f=0;if(h<e&&d<n)for(c>l===c>-l?(s=a-((o=l+a)-l),l=t[++h]):(s=a-((o=c+a)-c),c=i[++d]),a=o,0!==s&&(r[f++]=s);h<e&&d<n;)c>l===c>-l?(s=a-((o=a+l)-(u=o-a))+(l-u),l=t[++h]):(s=a-((o=a+c)-(u=o-a))+(c-u),c=i[++d]),a=o,0!==s&&(r[f++]=s);for(;h<e;)s=a-((o=a+l)-(u=o-a))+(l-u),l=t[++h],a=o,0!==s&&(r[f++]=s);for(;d<n;)s=a-((o=a+c)-(u=o-a))+(c-u),c=i[++d],a=o,0!==s&&(r[f++]=s);return 0===a&&0!==f||(r[f++]=a),f}function QA(e){return new Float64Array(e)}var eI=QA(4),tI=QA(8),nI=QA(12),iI=QA(16),rI=QA(4);function aI(e,t,n,i,r,a){var o=(t-a)*(n-r),s=(e-r)*(i-a),u=o-s;if(0===o||0===s||o>0!==s>0)return u;var l=Math.abs(o+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(e,t,n,i,r,a,o){var s,u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S,M=e-r,T=n-r,C=t-a,E=i-a;h=(x=(p=M-(f=(d=KA*M)-(d-M)))*(m=E-(v=(d=KA*E)-(d-E)))-((b=M*E)-f*v-p*v-f*m))-(g=x-(k=(p=C-(f=(d=KA*C)-(d-C)))*(m=T-(v=(d=KA*T)-(d-T)))-((w=C*T)-f*v-p*v-f*m))),eI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),eI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,eI[2]=_-(S-h)+(g-h),eI[3]=S;var P=function(e,t){for(var n=t[0],i=1;i<e;i++)n+=t[i];return n}(4,eI),L=22204460492503146e-32*o;if(P>=L||-P>=L)return P;if(s=e-(M+(h=e-M))+(h-r),l=n-(T+(h=n-T))+(h-r),u=t-(C+(h=t-C))+(h-a),c=i-(E+(h=i-E))+(h-a),0===s&&0===u&&0===l&&0===c)return P;if(L=11093356479670487e-47*o+33306690738754706e-32*Math.abs(P),(P+=M*c+E*s-(C*l+T*u))>=L||-P>=L)return P;h=(x=(p=s-(f=(d=KA*s)-(d-s)))*(m=E-(v=(d=KA*E)-(d-E)))-((b=s*E)-f*v-p*v-f*m))-(g=x-(k=(p=u-(f=(d=KA*u)-(d-u)))*(m=T-(v=(d=KA*T)-(d-T)))-((w=u*T)-f*v-p*v-f*m))),rI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),rI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,rI[2]=_-(S-h)+(g-h),rI[3]=S;var A=JA(4,eI,4,rI,tI);h=(x=(p=M-(f=(d=KA*M)-(d-M)))*(m=c-(v=(d=KA*c)-(d-c)))-((b=M*c)-f*v-p*v-f*m))-(g=x-(k=(p=C-(f=(d=KA*C)-(d-C)))*(m=l-(v=(d=KA*l)-(d-l)))-((w=C*l)-f*v-p*v-f*m))),rI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),rI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,rI[2]=_-(S-h)+(g-h),rI[3]=S;var I=JA(A,tI,4,rI,nI);h=(x=(p=s-(f=(d=KA*s)-(d-s)))*(m=c-(v=(d=KA*c)-(d-c)))-((b=s*c)-f*v-p*v-f*m))-(g=x-(k=(p=u-(f=(d=KA*u)-(d-u)))*(m=l-(v=(d=KA*l)-(d-l)))-((w=u*l)-f*v-p*v-f*m))),rI[0]=x-(g+h)+(h-k),h=(y=b-((_=b+g)-(h=_-b))+(g-h))-(g=y-w),rI[1]=y-(g+h)+(h-w),h=(S=_+g)-_,rI[2]=_-(S-h)+(g-h),rI[3]=S;var R=JA(I,nI,4,rI,iI);return iI[R-1]}(e,t,n,i,r,a,l)}function oI(e,t,n){var i=aI(e[0],e[1],t[0],t[1],n[0],n[1]);return i>0?-1:i<0?1:0}function sI(e,t){var n=e.point,i=t.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:function(e,t,n,i){if(e.left!==t.left)return e.left?1:-1;if(0!==oI(n,e.otherEvent.point,t.otherEvent.point))return e.isBelow(t.otherEvent.point)?-1:1;return!e.isSubject&&t.isSubject?1:-1}(e,t,n)}function uI(e,t,n){var i=new XA(t,!1,e,e.isSubject),r=new XA(t,!0,e.otherEvent,e.isSubject);return YA(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),i.contourId=r.contourId=e.contourId,sI(r,e.otherEvent)>0&&(e.otherEvent.left=!0,r.left=!1),e.otherEvent.otherEvent=r,e.otherEvent=i,n.push(r),n.push(i),n}function lI(e,t){return e[0]*t[1]-e[1]*t[0]}function cI(e,t){return e[0]*t[0]+e[1]*t[1]}function hI(e,t,n){var i=function(e,t,n,i,r){var a=[t[0]-e[0],t[1]-e[1]],o=[i[0]-n[0],i[1]-n[1]];function s(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}var u=[n[0]-e[0],n[1]-e[1]],l=lI(a,o),c=l*l,h=cI(a,a);if(c>0){var d=lI(u,o)/l;if(d<0||d>1)return null;var f=lI(u,a)/l;return f<0||f>1?null:0===d||1===d?r?null:[s(e,d,a)]:0===f||1===f?r?null:[s(n,f,o)]:[s(e,d,a)]}if((c=(l=lI(u,a))*l)>0)return null;var p=cI(a,u)/h,v=p+cI(a,o)/h,m=Math.min(p,v),g=Math.max(p,v);return m<=1&&g>=0?1===m?r?null:[s(e,m>0?m:0,a)]:0===g?r?null:[s(e,g<1?g:1,a)]:r&&0===m&&1===g?null:[s(e,m>0?m:0,a),s(e,g<1?g:1,a)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),r=i?i.length:0;if(0===r)return 0;if(1===r&&(YA(e.point,t.point)||YA(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===r&&e.isSubject===t.isSubject)return 0;if(1===r)return YA(e.point,i[0])||YA(e.otherEvent.point,i[0])||uI(e,i[0],n),YA(t.point,i[0])||YA(t.otherEvent.point,i[0])||uI(t,i[0],n),1;var a=[],o=!1,s=!1;return YA(e.point,t.point)?o=!0:1===sI(e,t)?a.push(t,e):a.push(e,t),YA(e.otherEvent.point,t.otherEvent.point)?s=!0:1===sI(e.otherEvent,t.otherEvent)?a.push(t.otherEvent,e.otherEvent):a.push(e.otherEvent,t.otherEvent),o&&s||o?(t.type=1,e.type=t.inOut===e.inOut?2:3,o&&!s&&uI(a[1].otherEvent,a[0].point,n),2):s?(uI(a[0],a[1].point,n),3):a[0]!==a[3].otherEvent?(uI(a[0],a[1].point,n),uI(a[1],a[2].point,n),3):(uI(a[0],a[1].point,n),uI(a[3].otherEvent,a[2].point,n),3)}function dI(e,t){if(e===t)return 0;if(0!==oI(e.point,e.otherEvent.point,t.point)||0!==oI(e.point,e.otherEvent.point,t.otherEvent.point))return YA(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===sI(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var n=e.point,i=t.point;return n[0]===i[0]&&n[1]===i[1]?(n=e.otherEvent.point,i=t.otherEvent.point,n[0]===i[0]&&n[1]===i[1]?0:e.contourId>t.contourId?1:-1):1===sI(e,t)?1:-1}var fI=function(){function e(){Fd(this,e),this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}return $d(e,[{key:"isExterior",value:function(){return null==this.holeOf}}]),e}();function pI(e,t,n,i){var r,a=e+1,o=t[e].point,s=t.length;for(a<s&&(r=t[a].point);a<s&&r[0]===o[0]&&r[1]===o[1];){if(!n[a])return a;r=t[++a].point}for(a=e-1;n[a]&&a>i;)a--;return a}function vI(e){var t,n,i=function(e){var t,n,i,r,a=[];for(n=0,i=e.length;n<i;n++)((t=e[n]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&a.push(t);for(var o=!1;!o;)for(o=!0,n=0,i=a.length;n<i;n++)n+1<i&&1===sI(a[n],a[n+1])&&(r=a[n],a[n]=a[n+1],a[n+1]=r,o=!1);for(n=0,i=a.length;n<i;n++)(t=a[n]).otherPos=n;for(n=0,i=a.length;n<i;n++)(t=a[n]).left||(r=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=r);return a}(e),r={},a=[],o=function(){if(r[t])return"continue";var e=a.length,n=function(e,t,n){var i=new fI;if(null!=e.prevInResult){var r=e.prevInResult,a=r.outputContourId;if(r.resultTransition>0){var o=t[a];if(null!=o.holeOf){var s=o.holeOf;t[s].holeIds.push(n),i.holeOf=s,i.depth=t[a].depth}else t[a].holeIds.push(n),i.holeOf=a,i.depth=t[a].depth+1}else i.holeOf=null,i.depth=t[a].depth}else i.holeOf=null,i.depth=0;return i}(i[t],a,e),o=function(t){r[t]=!0,i[t].outputContourId=e},s=t,u=t,l=i[t].point;for(n.points.push(l);o(s),o(s=i[s].otherPos),n.points.push(i[s].point),(s=pI(s,i,r,u))!=u;);a.push(n)};for(t=0,n=i.length;t<n;t++)o();return a}var mI={exports:{}};function gI(e,t){if(!(this instanceof gI))return new gI(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||_I,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function _I(e,t){return e<t?-1:e>t?1:0}mI.exports=gI,mI.exports.default=gI,gI.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,a=t[r];if(n(i,a)>=0)break;t[e]=a,e=r}t[e]=i},_down:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var a=1+(e<<1),o=a+1,s=t[a];if(o<this.length&&n(t[o],s)<0&&(a=o,s=t[o]),n(s,r)>=0)break;t[e]=s,e=a}t[e]=r}};var yI=mI.exports,bI=Math.max,xI=Math.min,wI=0;function kI(e,t,n,i,r,a){var o,s,u,l,c,h;for(o=0,s=e.length-1;o<s;o++)if(u=e[o],l=e[o+1],c=new XA(u,!1,void 0,t),h=new XA(l,!1,c,t),c.otherEvent=h,u[0]!==l[0]||u[1]!==l[1]){c.contourId=h.contourId=n,a||(c.isExteriorRing=!1,h.isExteriorRing=!1),sI(c,h)>0?h.left=!0:c.left=!0;var d=u[0],f=u[1];r[0]=xI(r[0],d),r[1]=xI(r[1],f),r[2]=bI(r[2],d),r[3]=bI(r[3],f),i.push(c),i.push(h)}}var SI=[];function MI(e,t,n){"number"===typeof e[0][0][0]&&(e=[e]),"number"===typeof t[0][0][0]&&(t=[t]);var i=function(e,t,n){var i=null;return e.length*t.length===0&&(0===n?i=SI:2===n?i=e:1!==n&&3!==n||(i=0===e.length?t:e)),i}(e,t,n);if(i)return i===SI?null:i;var r=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],o=function(e,t,n,i,r){var a,o,s,u,l,c,h=new yI(null,sI);for(s=0,u=e.length;s<u;s++)for(l=0,c=(a=e[s]).length;l<c;l++)(o=0===l)&&wI++,kI(a[l],!0,wI,h,n,o);for(s=0,u=t.length;s<u;s++)for(l=0,c=(a=t[s]).length;l<c;l++)o=0===l,2===r&&(o=!1),o&&wI++,kI(a[l],!1,wI,h,i,o);return h}(e,t,r,a,n);if(i=function(e,t,n,i,r){var a=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(0===r?a=SI:2===r?a=e:1!==r&&3!==r||(a=e.concat(t))),a}(e,t,r,a,n),i)return i===SI?null:i;for(var s=function(e,t,n,i,r,a){for(var o,s,u,l=new HA(dI),c=[],h=Math.min(i[2],r[2]);0!==e.length;){var d=e.pop();if(c.push(d),0===a&&d.point[0]>h||2===a&&d.point[0]>i[2])break;if(d.left){s=o=l.insert(d),o=o!==(u=l.minNode())?l.prev(o):null,s=l.next(s);var f=o?o.key:null;if(qA(d,f,a),s&&2===hI(d,s.key,e)&&(qA(d,f,a),qA(d,s.key,a)),o&&2===hI(o.key,d,e)){var p=o;qA(f,(p=p!==u?l.prev(p):null)?p.key:null,a),qA(d,f,a)}}else d=d.otherEvent,s=o=l.find(d),o&&s&&(o=o!==u?l.prev(o):null,s=l.next(s),l.remove(d),s&&o&&hI(o.key,s.key,e))}return c}(o,0,0,r,a,n),u=vI(s),l=[],c=0;c<u.length;c++){var h=u[c];if(h.isExterior()){for(var d=[h.points],f=0;f<h.holeIds.length;f++){var p=h.holeIds[f];d.push(u[p].points)}l.push(d)}}return l}var TI,CI,EI=function(e){Dd(n,e);var t=Od(n);function n(){var e;return Fd(this,n),(e=t.call(this))._subsampleThreshold=.005,e}return $d(n,[{key:"_getPoleOfInaccessibility2d",value:function(e){return UA([e],.03)}},{key:"_project",value:function(e,t){var n=this._createCamera(t.upVector().toArray(),t.unprojectSfM([0,0],0),t.unprojectSfM([0,0],10));return this._deunproject(e,t,n)}},{key:"_subsample",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._subsampleThreshold,n=[],i=e.length,r=0;r<i;r++){var a=e[r],o=e[(r+1)%i];n.push(a);for(var s=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)),u=Math.floor(s/t),l=1/(u+1),c=1;c<=u;c++){var h=c*l,d=[(1-h)*a[0]+h*o[0],(1-h)*a[1]+h*o[1]];n.push(d)}}return n}},{key:"_triangulate",value:function(e,t,n,i){var r,a=[e.slice(0,-1)],o=Pd(null!=n?n:[]);try{for(o.s();!(r=o.n()).done;){var s=r.value;a.push(s.slice(0,-1))}}catch(MN){o.e(MN)}finally{o.f()}var u,l=t.slice(0,-1),c=Pd(null!=i?i:[]);try{for(c.s();!(u=c.n()).done;){var h=u.value;l=l.concat(h.slice(0,-1))}}catch(MN){c.e(MN)}finally{c.f()}for(var d=RA.flatten(a),f=RA(d.vertices,d.holes,d.dimensions),p=[],v=0;v<f.length;++v){var m=l[f[v]];p.push(m[0]),p.push(m[1]),p.push(m[2])}return p}},{key:"_triangulateSpherical",value:function(e,t,n){for(var i=[],r=1e-9,a=0;a<3;a++)for(var o=0;o<3;o++){var s=a/3+(0===a?-1e-9:r),u=o/3+(0===o?-1e-9:r),l=(a+1)/3+r,c=(o+1)/3+r,h=[[s,u],[s,c],[l,c],[l,u],[s,u]],d=[(2*a+1)/6,(2*o+1)/6];i.push.apply(i,wd(this._triangulateSubarea(e,t,h,d,n)))}return i}},{key:"_unproject",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;return e.map((function(e){return t.unprojectBasic(e,n)}))}},{key:"_createCamera",value:function(e,t,n){var i=new J_;return i.up.copy((new Vm).fromArray(e)),i.position.copy((new Vm).fromArray(t)),i.lookAt((new Vm).fromArray(n)),i.updateMatrix(),i.updateMatrixWorld(!0),i}},{key:"_deunproject",value:function(e,t,n){return e.map((function(e){var i=t.unprojectBasic(e,1e4),r=new Vm(i[0],i[1],i[2]).applyMatrix4(n.matrixWorldInverse);return[r.x/r.z,r.y/r.z]}))}},{key:"_triangulateSubarea",value:function(e,t,n,i,r){var a=MI([e].concat(wd(t)),[n],0);if(!a)return[];var o,s=[],u=this._subsampleThreshold,l=this._createCamera(r.upVector().toArray(),r.unprojectSfM([0,0],0),r.unprojectBasic(i,10)),c=Pd(a);try{for(c.s();!(o=c.n()).done;){for(var h=o.value,d=this._subsample(h[0],u),f=this._deunproject(d,r,l),p=this._unproject(d,r),v=[],m=[],g=1;g<h.length;g++){var _=this._subsample(h[g],u),y=this._deunproject(_,r,l),b=this._unproject(_,r);v.push(y),m.push(b)}s.push.apply(s,wd(this._triangulate(f,p,v,m)))}}catch(MN){c.e(MN)}finally{c.f()}return s}}]),n}(nA),PI=function(e){Dd(n,e);var t=Od(n);function n(e){var i;if(Fd(this,n),i=t.call(this),4!==e.length)throw new iA("Rectangle needs to have four values.");if(e[1]>e[3])throw new iA("Basic Y coordinates values can not be inverted.");var r,a=Pd(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o<0||o>1)throw new iA("Basic coordinates must be on the interval [0, 1].")}}catch(MN){a.e(MN)}finally{a.f()}return i._anchorIndex=void 0,i._rect=e.slice(0,4),i._inverted=i._rect[0]>i._rect[2],i}return $d(n,[{key:"anchorIndex",get:function(){return this._anchorIndex}},{key:"inverted",get:function(){return this._inverted}},{key:"rect",get:function(){return this._rect}},{key:"initializeAnchorIndexing",value:function(e){if(void 0!==this._anchorIndex)throw new iA("Anchor indexing is already initialized.");if(e<0||e>3)throw new iA("Invalid anchor index: ".concat(e,"."));this._anchorIndex=void 0===e?0:e}},{key:"terminateAnchorIndexing",value:function(){this._anchorIndex=void 0}},{key:"setOppositeVertex2d",value:function(e,t){if(void 0===this._anchorIndex)throw new iA("Anchor indexing needs to be initialized.");var n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],i=this._rect.slice(),r=0===this._anchorIndex?[i[0],i[3]]:1===this._anchorIndex?[i[0],i[1]]:2===this._anchorIndex?[i[2],i[1]]:[i[2],i[3]];if(qM(t.cameraType)){var a=this._anchorIndex<2?n[0]-i[2]:n[0]-i[0];!this._inverted&&this._anchorIndex<2&&n[0]<.25&&i[2]>.75&&a<-.5||!this._inverted&&this._anchorIndex>=2&&n[0]<.25&&i[2]>.75&&a<-.5?(this._inverted=!0,this._anchorIndex=r[1]>n[1]?0:1):this._inverted&&this._anchorIndex>=2&&n[0]<.25&&i[0]>.75&&a<-.5?(this._inverted=!1,this._anchorIndex=r[0]>n[0]?r[1]>n[1]?3:2:r[1]>n[1]?0:1):!this._inverted&&this._anchorIndex>=2&&n[0]>.75&&i[0]<.25&&a>.5||!this._inverted&&this._anchorIndex<2&&n[0]>.75&&i[0]<.25&&a>.5?(this._inverted=!0,this._anchorIndex=r[1]>n[1]?3:2):this._inverted&&this._anchorIndex<2&&n[0]>.75&&i[2]<.25&&a>.5?(this._inverted=!1,this._anchorIndex=r[0]>n[0]?r[1]>n[1]?3:2:r[1]>n[1]?0:1):this._inverted&&this._anchorIndex<2&&n[0]>i[0]?(this._inverted=!1,this._anchorIndex=r[1]>n[1]?0:1):this._inverted&&this._anchorIndex>=2&&n[0]<i[2]?(this._inverted=!1,this._anchorIndex=r[1]>n[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=r[1]>n[1]?0:1:this._anchorIndex=r[1]>n[1]?3:2:this._anchorIndex=r[0]<=n[0]&&r[1]>n[1]?0:r[0]<=n[0]&&r[1]<=n[1]?1:r[0]>n[0]&&r[1]<=n[1]?2:3;var o=[];0===this._anchorIndex?(o[0]=r[0],o[1]=n[1],o[2]=n[0],o[3]=r[1]):1===this._anchorIndex?(o[0]=r[0],o[1]=r[1],o[2]=n[0],o[3]=n[1]):2===this._anchorIndex?(o[0]=n[0],o[1]=r[1],o[2]=r[0],o[3]=n[1]):(o[0]=n[0],o[1]=n[1],o[2]=r[0],o[3]=r[1]),(!this._inverted&&o[0]>o[2]||this._inverted&&o[0]<o[2])&&(o[0]=i[0],o[2]=i[2]),o[1]>o[3]&&(o[1]=i[1],o[3]=i[3]),this._rect[0]=o[0],this._rect[1]=o[1],this._rect[2]=o[2],this._rect[3]=o[3]}else{this._anchorIndex=r[0]<=n[0]&&r[1]>n[1]?0:r[0]<=n[0]&&r[1]<=n[1]?1:r[0]>n[0]&&r[1]<=n[1]?2:3;var s=[];0===this._anchorIndex?(s[0]=r[0],s[1]=n[1],s[2]=n[0],s[3]=r[1]):1===this._anchorIndex?(s[0]=r[0],s[1]=r[1],s[2]=n[0],s[3]=n[1]):2===this._anchorIndex?(s[0]=n[0],s[1]=r[1],s[2]=r[0],s[3]=n[1]):(s[0]=n[0],s[1]=n[1],s[2]=r[0],s[3]=r[1]),s[0]>s[2]&&(s[0]=i[0],s[2]=i[2]),s[1]>s[3]&&(s[1]=i[1],s[3]=i[3]),this._rect[0]=s[0],this._rect[1]=s[1],this._rect[2]=s[2],this._rect[3]=s[3]}this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(e,t,n){var i=this._rect.slice(),r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],a=[];if(0===e?(a[0]=r[0],a[1]=i[1],a[2]=i[2],a[3]=r[1]):1===e?(a[0]=r[0],a[1]=r[1],a[2]=i[2],a[3]=i[3]):2===e?(a[0]=i[0],a[1]=r[1],a[2]=r[0],a[3]=i[3]):3===e&&(a[0]=i[0],a[1]=i[1],a[2]=r[0],a[3]=r[1]),qM(n.cameraType)){var o=e<2&&r[0]>.75&&i[0]<.25||e>=2&&this._inverted&&r[0]>.75&&i[2]<.25,s=e<2&&this._inverted&&r[0]<.25&&i[0]>.75||e>=2&&r[0]<.25&&i[2]>.75;o||s?this._inverted=!this._inverted:(a[0]-i[0]<-.25&&(a[0]=i[0]),a[2]-i[2]>.25&&(a[2]=i[2])),(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2])&&(a[0]=i[0],a[2]=i[2])}else a[0]>a[2]&&(a[0]=i[0],a[2]=i[2]);a[1]>a[3]&&(a[1]=i[1],a[3]=i[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3],this._notifyChanged$.next(this)}},{key:"setCentroid2d",value:function(e,t){var n=this._rect.slice(),i=n[0],r=this._inverted?n[2]+1:n[2],a=n[1],o=n[3],s=i+(r-i)/2,u=a+(o-a)/2,l=0;if(qM(t.cameraType))l=this._inverted?e[0]+1-s:e[0]-s;else{var c=-i,h=1-r;l=Math.max(c,Math.min(h,e[0]-s))}var d=-a,f=1-o,p=Math.max(d,Math.min(f,e[1]-u));this._rect[0]=n[0]+l,this._rect[1]=n[1]+p,this._rect[2]=n[2]+l,this._rect[3]=n[3]+p,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(e){return this._getPoints2d().map((function(t){return e.unprojectBasic(t,200)}))}},{key:"getVertex2d",value:function(e){return this._rectToVertices2d(this._rect)[e]}},{key:"getNonAdjustedVertex2d",value:function(e){return this._rectToNonAdjustedVertices2d(this._rect)[e]}},{key:"getVertex3d",value:function(e,t){return t.unprojectBasic(this._rectToVertices2d(this._rect)[e],200)}},{key:"getVertices2d",value:function(){return this._rectToVertices2d(this._rect)}},{key:"getVertices3d",value:function(e){return this._rectToVertices2d(this._rect).map((function(t){return e.unprojectBasic(t,200)}))}},{key:"getCentroid2d",value:function(){var e=this._rect;return[(e[0]+(this._inverted?e[2]+1:e[2]))/2,(e[1]+e[3])/2]}},{key:"getCentroid3d",value:function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)}},{key:"getPoleOfInaccessibility2d",value:function(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}},{key:"getPoleOfInaccessibility3d",value:function(e){var t=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return e.unprojectBasic(t,200)}},{key:"getTriangles3d",value:function(e){return qM(e.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),e),this.getPoints3d(e))}},{key:"validate",value:function(e){var t=this._rect;return!(!this._inverted&&e[0]<t[0]||e[0]-t[2]>.25||e[1]<t[1])}},{key:"_getPoints2d",value:function(){for(var e=this._rectToVertices2d(this._rect),t=e.length-1,n=[],i=0;i<t;++i)for(var r=e[i][0],a=e[i][1],o=(e[i+1][0]-r)/9,s=(e[i+1][1]-a)/9,u=0;u<10;++u){var l=[r+u*o,a+u*s];n.push(l)}return n}},{key:"_rectToVertices2d",value:function(e){return[[e[0],e[3]],[e[0],e[1]],[this._inverted?e[2]+1:e[2],e[1]],[this._inverted?e[2]+1:e[2],e[3]],[e[0],e[3]]]}},{key:"_rectToNonAdjustedVertices2d",value:function(e){return[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}}]),n}(EI),LI=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,r,a))._options={color:null==i.color?16777215:i.color,indicateCompleter:null==i.indicateCompleter||i.indicateCompleter},o._rectGeometry=new PI(o._geometry.getRect2d(r)),o._createGlObjects(),o}return $d(n,[{key:"create",value:function(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}},{key:"dispose",value:function(){Nd(kd(n.prototype),"dispose",this).call(this),this._disposeObjects()}},{key:"getDOMObjects",value:function(e,t){for(var n=this,i={offsetHeight:t.height,offsetWidth:t.width},r=[],a=this._geometry.getPoints2d(),o=a.length,u=function(t){var u=t,l=s(a[t],2),c=l[0],h=l[1],d=n._viewportCoords.basicToCanvasSafe(c,h,i,n._transform,e);if(!d)return"continue";var f=n._canvasToTransform(d),p={onclick:0===t&&o<3?function(e){e.stopPropagation(),n._aborted$.next(n)}:function(e){e.stopPropagation(),n._geometry.removePoint2d(u)},style:{transform:f}};r.push(_P.h("div.mapillary-tag-interactor",p,[]));var v={style:{background:n._colorToBackground(n._options.color),transform:f}};r.push(_P.h("div.mapillary-tag-vertex",v,[]))},l=0;l<o-1;l++)u(l);if(o>2&&!0===this._options.indicateCompleter){var c=s(this._geometry.getCentroid2d(this._transform),2),h=c[0],d=c[1],f=this._viewportCoords.basicToCanvasSafe(h,d,i,this._transform,e);if(f){var p=this._canvasToTransform(f),v={onclick:function(e){e.stopPropagation(),n._geometry.removePoint2d(n._geometry.points.length-1),n._created$.next(n)},style:{transform:p}};r.push(_P.h("div.mapillary-tag-completer.mapillary-tag-larger",v,[]));var m={style:{background:this._colorToBackground(this._options.color),transform:p}};r.push(_P.h("div.mapillary-tag-vertex.mapillary-tag-larger",m,[]));var g={style:{transform:p}};r.push(_P.h("div.mapillary-tag-dot",g,[]))}}return r}},{key:"_onGeometryChanged",value:function(){this._disposeObjects(),this._rectGeometry=new PI(this._geometry.getRect2d(this._transform)),this._createGlObjects()}},{key:"_createGlObjects",value:function(){this._glObjects=[];var e=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects.push(this._outline)}},{key:"_disposeObjects",value:function(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}]),n}(aA),AI=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;Fd(this,n),r=t.call(this);var a=e.length;if(a<3)throw new iA("A polygon must have three or more positions.");if(e[0][0]!==e[a-1][0]||e[0][1]!==e[a-1][1])throw new iA("First and last positions must be equivalent.");r._polygon=[];var o,s=Pd(e);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u[0]<0||u[0]>1||u[1]<0||u[1]>1)throw new iA("Basic coordinates of polygon must be on the interval [0, 1].");r._polygon.push(u.slice())}}catch(MN){s.e(MN)}finally{s.f()}if(r._holes=[],null==i)return Id(r);for(var l=0;l<i.length;l++){var c=i[l],h=c.length;if(h<3)throw new iA("A polygon hole must have three or more positions.");if(c[0][0]!==c[h-1][0]||c[0][1]!==c[h-1][1])throw new iA("First and last positions of hole must be equivalent.");r._holes.push([]);var d,f=Pd(c);try{for(f.s();!(d=f.n()).done;){var p=d.value;if(p[0]<0||p[0]>1||p[1]<0||p[1]>1)throw new iA("Basic coordinates of hole must be on the interval [0, 1].");r._holes[l].push(p.slice())}}catch(MN){f.e(MN)}finally{f.f()}}return r}return $d(n,[{key:"polygon",get:function(){return this._polygon}},{key:"holes",get:function(){return this._holes}},{key:"addVertex2d",value:function(e){var t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._polygon.splice(this._polygon.length-1,0,t),this._notifyChanged$.next(this)}},{key:"getVertex2d",value:function(e){return this._polygon[e].slice()}},{key:"removeVertex2d",value:function(e){if(e<0||e>=this._polygon.length||this._polygon.length<4)throw new iA("Index for removed vertex must be valid.");if(e>0&&e<this._polygon.length-1)this._polygon.splice(e,1);else{this._polygon.splice(0,1),this._polygon.pop();var t=this._polygon[0].slice();this._polygon.push(t)}this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(e,t,n){var i=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];0===e||e===this._polygon.length-1?(this._polygon[0]=i.slice(),this._polygon[this._polygon.length-1]=i.slice()):this._polygon[e]=i.slice(),this._notifyChanged$.next(this)}},{key:"setCentroid2d",value:function(e,t){var n,i=this._polygon.map((function(e){return e[0]})),r=this._polygon.map((function(e){return e[1]})),a=Math.min.apply(Math,i),o=Math.max.apply(Math,i),s=Math.min.apply(Math,r),u=Math.max.apply(Math,r),l=this.getCentroid2d(),c=-a,h=1-o,d=-s,f=1-u,p=Math.max(c,Math.min(h,e[0]-l[0])),v=Math.max(d,Math.min(f,e[1]-l[1])),m=Pd(this._polygon);try{for(m.s();!(n=m.n()).done;){var g=n.value;g[0]+=p,g[1]+=v}}catch(MN){m.e(MN)}finally{m.f()}this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(e){return this._getPoints3d(this._subsample(this._polygon),e)}},{key:"getVertex3d",value:function(e,t){return t.unprojectBasic(this._polygon[e],200)}},{key:"getVertices2d",value:function(){return this._polygon.slice()}},{key:"getVertices3d",value:function(e){return this._getPoints3d(this._polygon,e)}},{key:"getHolePoints3d",value:function(e){var t=this;return this._holes.map((function(n){return t._getPoints3d(t._subsample(n),e)}))}},{key:"getHoleVertices3d",value:function(e){var t=this;return this._holes.map((function(n){return t._getPoints3d(n,e)}))}},{key:"getCentroid2d",value:function(){for(var e=this._polygon,t=0,n=0,i=0,r=0;r<e.length-1;r++){var a=e[r][0],o=e[r][1],s=e[r+1][0],u=e[r+1][1],l=a*u-s*o;t+=l,n+=(a+s)*l,i+=(o+u)*l}return[n/=6*(t/=2),i/=6*t]}},{key:"getCentroid3d",value:function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)}},{key:"get3dDomainTriangles3d",value:function(e){var t=this;return this._triangulate(this._project(this._polygon,e),this.getVertices3d(e),this._holes.map((function(n){return t._project(n,e)})),this.getHoleVertices3d(e))}},{key:"getTriangles3d",value:function(e){var t=this;if(qM(e.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),e);var n=this._project(this._subsample(this._polygon),e),i=this.getPoints3d(e),r=this._holes.map((function(n){return t._project(t._subsample(n),e)})),a=this.getHolePoints3d(e);return this._triangulate(n,i,r,a)}},{key:"getPoleOfInaccessibility2d",value:function(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}},{key:"getPoleOfInaccessibility3d",value:function(e){var t=this._getPoleOfInaccessibility2d(this._polygon.slice());return e.unprojectBasic(t,200)}},{key:"_getPoints3d",value:function(e,t){return e.map((function(e){return t.unprojectBasic(e,200)}))}}]),n}(EI),II=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,r,a))._options={color:null==i.color?16777215:i.color},o._createGlObjects(),o}return $d(n,[{key:"create",value:function(){if(this._geometry instanceof PI)this._created$.next(this);else if(this._geometry instanceof AI){var e=this._geometry;e.removeVertex2d(e.polygon.length-2),this._created$.next(this)}}},{key:"dispose",value:function(){Nd(kd(n.prototype),"dispose",this).call(this),this._disposeLine(this._outline),this._disposeObjects()}},{key:"getDOMObjects",value:function(e,t){var n=this,i=[],r={offsetHeight:t.height,offsetWidth:t.width},a=function(e){e.stopPropagation(),n._aborted$.next(n)};if(this._geometry instanceof PI){var o=this._geometry.anchorIndex,u=void 0===o?1:o,l=s(this._geometry.getVertex2d(u),2),c=l[0],h=l[1],d=this._viewportCoords.basicToCanvasSafe(c,h,r,this._transform,e);if(null!=d){var f=this._colorToBackground(this._options.color),p=this._canvasToTransform(d),v={style:{background:f,transform:p}},m={onclick:a,style:{transform:p}};i.push(_P.h("div.mapillary-tag-interactor",m,[])),i.push(_P.h("div.mapillary-tag-vertex",v,[]))}}else if(this._geometry instanceof AI){var g=this._geometry,_=s(g.getVertex2d(0),2),y=_[0],b=_[1],x=this._viewportCoords.basicToCanvasSafe(y,b,r,this._transform,e);if(null!=x){var w={onclick:g.polygon.length>4?function(e){e.stopPropagation(),g.removeVertex2d(g.polygon.length-2),n._created$.next(n)}:a,style:{transform:this._canvasToTransform(x)}},k=g.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";i.push(_P.h("div."+k,w,[]))}if(g.polygon.length>3){var S=s(g.getVertex2d(g.polygon.length-3),2),M=S[0],T=S[1],C=this._viewportCoords.basicToCanvasSafe(M,T,r,this._transform,e);if(null!=C){var E={onclick:function(e){e.stopPropagation(),g.removeVertex2d(g.polygon.length-3)},style:{transform:this._canvasToTransform(C)}};i.push(_P.h("div.mapillary-tag-interactor",E,[]))}}var P=g.polygon.slice();P.splice(-2,2);var L,A=Pd(P);try{for(A.s();!(L=A.n()).done;){var I=L.value,R=this._viewportCoords.basicToCanvasSafe(I[0],I[1],r,this._transform,e);if(null!=R){var N={style:{background:this._colorToBackground(this._options.color),transform:this._canvasToTransform(R)}};i.push(_P.h("div.mapillary-tag-vertex",N,[]))}}}catch(MN){A.e(MN)}finally{A.f()}}return i}},{key:"addPoint",value:function(e){if(this._geometry instanceof PI){if(!this._geometry.validate(e))return;this._created$.next(this)}else if(this._geometry instanceof AI){this._geometry.addVertex2d(e)}}},{key:"_onGeometryChanged",value:function(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}},{key:"_disposeObjects",value:function(){this._outline=null,this._glObjects=[]}},{key:"_createGlObjects",value:function(){var e=this._geometry instanceof PI?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects=[this._outline]}}]),n}(aA),RI=function(){function e(t,n){Fd(this,e),this._component=t,this._navigator=n,this._tagOperation$=new Af,this._createPoints$=new Af,this._createPolygon$=new Af,this._createRect$=new Af,this._delete$=new Af,this._tag$=this._tagOperation$.pipe(bv((function(e,t){return t(e)}),null),xv()),this._replayedTag$=this._tag$.pipe(_v(1),Ef()),this._replayedTag$.subscribe(),this._createPoints$.pipe(Lv(this._component.configuration$,this._navigator.stateService.currentTransform$),xp((function(e){var t=s(e,3),n=t[0],i=t[1],r=t[2];return function(){var e=new rA([[n[0],n[1]],[n[0],n[1]]]);return new LI(e,{color:i.createColor,indicateCompleter:i.indicatePointsCompleter},r)}}))).subscribe(this._tagOperation$),this._createRect$.pipe(Lv(this._component.configuration$,this._navigator.stateService.currentTransform$),xp((function(e){var t=s(e,3),n=t[0],i=t[1],r=t[2];return function(){var e=new PI([n[0],n[1],n[0],n[1]]);return new II(e,{color:i.createColor},r)}}))).subscribe(this._tagOperation$),this._createPolygon$.pipe(Lv(this._component.configuration$,this._navigator.stateService.currentTransform$),xp((function(e){var t=s(e,3),n=t[0],i=t[1],r=t[2];return function(){var e=new AI([[n[0],n[1]],[n[0],n[1]],[n[0],n[1]]]);return new II(e,{color:i.createColor},r)}}))).subscribe(this._tagOperation$),this._delete$.pipe(xp((function(){return function(){return null}}))).subscribe(this._tagOperation$)}return $d(e,[{key:"createRect$",get:function(){return this._createRect$}},{key:"createPolygon$",get:function(){return this._createPolygon$}},{key:"createPoints$",get:function(){return this._createPoints$}},{key:"delete$",get:function(){return this._delete$}},{key:"tag$",get:function(){return this._tag$}},{key:"replayedTag$",get:function(){return this._replayedTag$}}]),e}(),NI=function(){function e(){Fd(this,e)}return $d(e,[{key:"render",value:function(e,t,n,i,r){var a,o=[],s=Pd(e);try{for(s.s();!(a=s.n()).done;){var u=a.value;o=o.concat(u.getDOMObjects(n,i,r))}}catch(MN){s.e(MN)}finally{s.f()}return null!=t&&(o=o.concat(t.getDOMObjects(i,r))),_P.h("div.mapillary-tag-container",{},o)}},{key:"clear",value:function(){return _P.h("div",{},[])}}]),e}(),DI=function(){function e(t,n){Fd(this,e),this._createTag=null,this._needsRender=!1,this._raycaster=n||new _M,this._scene=t||new ew,this._objectTags={},this._retrievableObjects=[],this._tags={}}return $d(e,[{key:"needsRender",get:function(){return this._needsRender}},{key:"add",value:function(e){var t,n=Pd(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.tag.id in this._tags&&this._remove(i.tag.id),this._add(i)}}catch(MN){n.e(MN)}finally{n.f()}this._needsRender=!0}},{key:"addCreateTag",value:function(e){var t,n=Pd(e.glObjects);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._scene.add(i)}}catch(MN){n.e(MN)}finally{n.f()}this._createTag={tag:e,objects:e.glObjects},this._needsRender=!0}},{key:"clear",value:function(){for(var e=0,t=Object.keys(this._tags);e<t.length;e++){var n=t[e];this._remove(n)}this._needsRender=!1}},{key:"get",value:function(e){return this.has(e)?this._tags[e].tag:void 0}},{key:"has",value:function(e){return e in this._tags}},{key:"hasCreateTag",value:function(){return null!=this._createTag}},{key:"intersectObjects",value:function(e,t){var n=s(e,2),i=n[0],r=n[1];this._raycaster.setFromCamera(new Em(i,r),t);var a,o=[],u=Pd(this._raycaster.intersectObjects(this._retrievableObjects));try{for(u.s();!(a=u.n()).done;){var l=a.value;l.object.uuid in this._objectTags&&o.push(this._objectTags[l.object.uuid])}}catch(MN){u.e(MN)}finally{u.f()}return o}},{key:"remove",value:function(e){var t,n=Pd(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._remove(i)}}catch(MN){n.e(MN)}finally{n.f()}this._needsRender=!0}},{key:"removeAll",value:function(){for(var e=0,t=Object.keys(this._tags);e<t.length;e++){var n=t[e];this._remove(n)}this._needsRender=!0}},{key:"removeCreateTag",value:function(){if(null!=this._createTag){var e,t=Pd(this._createTag.objects);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._scene.remove(n)}}catch(MN){t.e(MN)}finally{t.f()}this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}},{key:"render",value:function(e,t){t.render(this._scene,e),this._needsRender=!1}},{key:"update",value:function(){this._needsRender=!0}},{key:"updateCreateTagObjects",value:function(e){if(this._createTag.tag!==e)throw new Error("Create tags do not have the same reference.");var t,n=Pd(this._createTag.objects);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._scene.remove(i)}}catch(MN){n.e(MN)}finally{n.f()}var r,a=Pd(e.glObjects);try{for(a.s();!(r=a.n()).done;){var o=r.value;this._scene.add(o)}}catch(MN){a.e(MN)}finally{a.f()}this._createTag.objects=e.glObjects,this._needsRender=!0}},{key:"updateObjects",value:function(e){var t=e.tag.id;if(this._tags[t].tag!==e)throw new Error("Tags do not have the same reference.");var n=this._tags[t];this._removeObjects(n),delete this._tags[t],this._add(e),this._needsRender=!0}},{key:"_add",value:function(e){var t=e.tag.id,n={tag:e,objects:[],retrievableObjects:[]};this._tags[t]=n;var i,r=Pd(e.getGLObjects());try{for(r.s();!(i=r.n()).done;){var a=i.value;n.objects.push(a),this._scene.add(a)}}catch(MN){r.e(MN)}finally{r.f()}var o,s=Pd(e.getRetrievableObjects());try{for(s.s();!(o=s.n()).done;){var u=o.value;n.retrievableObjects.push(u),this._retrievableObjects.push(u),this._objectTags[u.uuid]=e.tag.id}}catch(MN){s.e(MN)}finally{s.f()}}},{key:"_remove",value:function(e){var t=this._tags[e];this._removeObjects(t),t.tag.dispose(),delete this._tags[e]}},{key:"_removeObjects",value:function(e){var t,n=Pd(e.objects);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._scene.remove(i)}}catch(MN){n.e(MN)}finally{n.f()}var r,a=Pd(e.retrievableObjects);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=this._retrievableObjects.indexOf(o);-1!==s&&this._retrievableObjects.splice(s,1)}}catch(MN){a.e(MN)}finally{a.f()}}}]),e}();!function(e){e[e.Default=0]="Default",e[e.CreatePoint=1]="CreatePoint",e[e.CreatePoints=2]="CreatePoints",e[e.CreatePolygon=3]="CreatePolygon",e[e.CreateRect=4]="CreateRect",e[e.CreateRectDrag=5]="CreateRectDrag"}(TI||(TI={})),function(e){e[e.None=0]="None",e[e.Centroid=1]="Centroid",e[e.Vertex=2]="Vertex"}(CI||(CI={}));var OI,zI=function(){function e(t,n,i){Fd(this,e),this._tag=t,this._transform=n,this._viewportCoords=i||new MP,this._glObjectsChanged$=new Af,this._interact$=new Af}return $d(e,[{key:"glObjectsChanged$",get:function(){return this._glObjectsChanged$}},{key:"interact$",get:function(){return this._interact$}},{key:"tag",get:function(){return this._tag}}]),e}(),FI=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i))._geometryChangedSubscription=r._tag.geometry.changed$.subscribe((function(){r._onGeometryChanged()})),r._changedSubscription=r._tag.changed$.subscribe((function(){r._onTagChanged()&&r._glObjectsChanged$.next(Ad(r))})),r}return $d(n,[{key:"dispose",value:function(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}},{key:"_colorToCss",value:function(e){return"#"+("000000"+e.toString(16)).substr(-6)}},{key:"_createFill",value:function(){var e=this._getTriangles(),t=new Float32Array(e),n=new C_;n.setAttribute("position",new v_(t,3)),n.computeBoundingSphere();var i=new d_({side:2,transparent:!0});return this._updateFillMaterial(i),new W_(n,i)}},{key:"_createLine",value:function(e){var t=this._getLinePositions(e),n=new C_;n.setAttribute("position",new v_(t,3)),n.computeBoundingSphere();var i=new Rw;this._updateLineBasicMaterial(i);var r=new Bw(n,i);return r.renderOrder=1,r}},{key:"_createOutline",value:function(){return this._createLine(this._getPoints3d())}},{key:"_disposeFill",value:function(){null!=this._fill&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}},{key:"_disposeOutline",value:function(){null!=this._outline&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}},{key:"_getLinePositions",value:function(e){for(var t=e.length,n=new Float32Array(3*t),i=0;i<t;++i){var r=3*i,a=e[i];n[r+0]=a[0],n[r+1]=a[1],n[r+2]=a[2]}return n}},{key:"_interact",value:function(e,t,n){var i=this;return function(r){var a=r.offsetX-r.target.offsetWidth/2,o=r.offsetY-r.target.offsetHeight/2;i._interact$.next({cursor:t,offsetX:a,offsetY:o,operation:e,tag:i._tag,vertexIndex:n})}}},{key:"_updateFillGeometry",value:function(){var e=this._getTriangles(),t=new Float32Array(e),n=this._fill.geometry,i=n.getAttribute("position");i.array.length===t.length?(i.set(t),i.needsUpdate=!0):(n.deleteAttribute("position"),n.setAttribute("position",new v_(t,3))),n.computeBoundingSphere()}},{key:"_updateLine",value:function(e,t){var n=this._getLinePositions(t),i=e.geometry,r=i.getAttribute("position");r.set(n),r.needsUpdate=!0,i.computeBoundingSphere()}},{key:"_updateOulineGeometry",value:function(){this._updateLine(this._outline,this._getPoints3d())}}]),n}(zI),BI=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i))._rectGeometry=new PI(r._tag.geometry.getRect2d(i)),r._fill=qM(i.cameraType)?null:r._createFill(),r._outline=r._tag.lineWidth>=1?r._createOutline():null,r}return $d(n,[{key:"dispose",value:function(){Nd(kd(n.prototype),"dispose",this).call(this),this._disposeFill(),this._disposeOutline()}},{key:"getDOMObjects",value:function(e,t,n){var i=[],r={offsetHeight:n.height,offsetWidth:n.width};if(!this._tag.editable)return i;for(var a=this._colorToCss(this._tag.lineColor),o=this._tag.geometry.getPoints2d(),u=0;u<o.length;u++){var l=s(o[u],2),c=l[0],h=l[1],d=this._viewportCoords.basicToCanvasSafe(c,h,r,this._transform,t);if(null!=d){var f="crosshair",p=this._interact(CI.Vertex,f,u),v=Math.round(d[0]),m=Math.round(d[1]),g="translate(-50%, -50%) translate(".concat(v,"px,").concat(m,"px)"),_={onpointerdown:p,style:{background:a,transform:g,cursor:f}};if(i.push(_P.h("div.mapillary-tag-resizer",_,[])),this._tag.indicateVertices){var y={style:{background:a,transform:g}};i.push(_P.h("div.mapillary-tag-vertex",y,[]))}}}return i}},{key:"getGLObjects",value:function(){var e=[];return null!=this._fill&&e.push(this._fill),null!=this._outline&&e.push(this._outline),e}},{key:"getRetrievableObjects",value:function(){return null!=this._fill?[this._fill]:[]}},{key:"_onGeometryChanged",value:function(){this._rectGeometry=new PI(this._tag.geometry.getRect2d(this._transform)),null!=this._fill&&this._updateFillGeometry(),null!=this._outline&&this._updateOulineGeometry()}},{key:"_onTagChanged",value:function(){var e=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),e=!0):this._updateOutlineMaterial(),e}},{key:"_getPoints3d",value:function(){return this._rectGeometry.getPoints3d(this._transform)}},{key:"_getTriangles",value:function(){return this._rectGeometry.getTriangles3d(this._transform)}},{key:"_updateFillMaterial",value:function(e){e.color=new h_(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}},{key:"_updateLineBasicMaterial",value:function(e){e.color=new h_(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}},{key:"_updateOutlineMaterial",value:function(){var e=this._outline.material;this._updateLineBasicMaterial(e)}}]),n}(FI),$I=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this))._id=e,r._geometry=i,r._notifyChanged$=new Af,r._notifyChanged$.subscribe((function(e){var t={target:Ad(r),type:"tag"};r.fire("tag",t)})),r._geometry.changed$.subscribe((function(e){var t="geometry",n={target:Ad(r),type:t};r.fire(t,n)})),r}return $d(n,[{key:"id",get:function(){return this._id}},{key:"geometry",get:function(){return this._geometry}},{key:"changed$",get:function(){return this._notifyChanged$}},{key:"geometryChanged$",get:function(){var e=this;return this._geometry.changed$.pipe(xp((function(){return e})),xv())}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}}]),n}(yP),jI=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),r=r||{},(a=t.call(this,e,i))._editable=null!=r.editable&&r.editable,a._fillColor=null==r.fillColor?16777215:r.fillColor,a._fillOpacity=null==r.fillOpacity?0:r.fillOpacity,a._indicateVertices=null==r.indicateVertices||r.indicateVertices,a._lineColor=null==r.lineColor?16777215:r.lineColor,a._lineOpacity=null==r.lineOpacity?1:r.lineOpacity,a._lineWidth=null==r.lineWidth?1:r.lineWidth,a}return $d(n,[{key:"editable",get:function(){return this._editable},set:function(e){this._editable=e,this._notifyChanged$.next(this)}},{key:"fillColor",get:function(){return this._fillColor},set:function(e){this._fillColor=e,this._notifyChanged$.next(this)}},{key:"fillOpacity",get:function(){return this._fillOpacity},set:function(e){this._fillOpacity=e,this._notifyChanged$.next(this)}},{key:"geometry",get:function(){return this._geometry}},{key:"indicateVertices",get:function(){return this._indicateVertices},set:function(e){this._indicateVertices=e,this._notifyChanged$.next(this)}},{key:"lineColor",get:function(){return this._lineColor},set:function(e){this._lineColor=e,this._notifyChanged$.next(this)}},{key:"lineOpacity",get:function(){return this._lineOpacity},set:function(e){this._lineOpacity=e,this._notifyChanged$.next(this)}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(e){this._lineWidth=e,this._notifyChanged$.next(this)}},{key:"setOptions",value:function(e){this._editable=null==e.editable?this._editable:e.editable,this._indicateVertices=null==e.indicateVertices?this._indicateVertices:e.indicateVertices,this._lineColor=null==e.lineColor?this._lineColor:e.lineColor,this._lineWidth=null==e.lineWidth?this._lineWidth:e.lineWidth,this._fillColor=null==e.fillColor?this._fillColor:e.fillColor,this._fillOpacity=null==e.fillOpacity?this._fillOpacity:e.fillOpacity,this._notifyChanged$.next(this)}}]),n}($I);!function(e){e[e.TwoDimensional=0]="TwoDimensional",e[e.ThreeDimensional=1]="ThreeDimensional"}(OI||(OI={}));var UI,VI=function(e){Dd(n,e);var t=Od(n);function n(e,i){var r;return Fd(this,n),(r=t.call(this,e,i))._fill=qM(i.cameraType)?e.domain===OI.TwoDimensional&&e.geometry instanceof AI?r._createFill():null:r._createFill(),r._holes=r._tag.lineWidth>=1?r._createHoles():[],r._outline=r._tag.lineWidth>=1?r._createOutline():null,r}return $d(n,[{key:"dispose",value:function(){Nd(kd(n.prototype),"dispose",this).call(this),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}},{key:"getDOMObjects",value:function(e,t,n){var i=this,r=[],a=this._tag.geometry instanceof PI,o=!qM(this._transform.cameraType),u={offsetHeight:n.height,offsetWidth:n.width};if(null!=this._tag.icon&&(a||o)){var l=s(this._tag.geometry instanceof PI?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),2),c=l[0],h=l[1],d=this._viewportCoords.basicToCanvasSafe(c,h,u,this._transform,t);if(null!=d){if(e.loaded){var f=e.getDOMSprite(this._tag.icon,this._tag.iconFloat),p=Math.round(d[0]),v=Math.round(d[1]),m={onclick:function(e){e.stopPropagation(),i._tag.click$.next(i._tag)},onpointerdown:function(){i._interact$.next({offsetX:0,offsetY:0,operation:CI.None,tag:i._tag})},style:{transform:"translate(".concat(p,"px,").concat(v,"px)")}};r.push(_P.h("div.mapillary-tag-symbol",m,[f]))}}}else if(null!=this._tag.text&&(a||o)){var g=s(this._tag.geometry instanceof PI?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),2),_=g[0],y=g[1],b=this._viewportCoords.basicToCanvasSafe(_,y,u,this._transform,t);if(null!=b){var x=Math.round(b[0]),w=Math.round(b[1]),k=this._tag.geometry instanceof PI?"translate(".concat(x,"px,").concat(w,"px)"):"translate(-50%, -50%) translate(".concat(x,"px,").concat(w,"px)"),S={onpointerdown:function(){i._interact$.next({offsetX:0,offsetY:0,operation:CI.None,tag:i._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:k},textContent:this._tag.text};r.push(_P.h("span.mapillary-tag-symbol",S,[]))}}if(!this._tag.editable)return r;var M=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof PI){var T=s(this._tag.geometry.getCentroid2d(),2),C=T[0],E=T[1],P=this._viewportCoords.basicToCanvasSafe(C,E,u,this._transform,t);if(null!=P){var L=this._interact(CI.Centroid,"move"),A=Math.round(P[0]),I=Math.round(P[1]),R={onpointerdown:L,style:{background:M,transform:"translate(-50%, -50%) translate(".concat(A,"px,").concat(I,"px)")}};r.push(_P.h("div.mapillary-tag-mover",R,[]))}}for(var N=this._tag.geometry.getVertices2d(),D=0;D<N.length-1;D++)if(!a||!(null!=this._tag.icon&&D===this._tag.iconIndex||null==this._tag.icon&&null!=this._tag.text&&3===D)){var O=s(N[D],2),z=O[0],F=O[1],B=this._viewportCoords.basicToCanvasSafe(z,F,u,this._transform,t);if(null!=B){var $=a?D%2===0?"nesw-resize":"nwse-resize":"crosshair",j=this._interact(CI.Vertex,$,D),U=Math.round(B[0]),V=Math.round(B[1]),H="translate(-50%, -50%) translate(".concat(U,"px,").concat(V,"px)"),W={onpointerdown:j,style:{background:M,transform:H,cursor:$}};if(r.push(_P.h("div.mapillary-tag-resizer",W,[])),this._tag.indicateVertices){var G={style:{background:M,transform:H}};r.push(_P.h("div.mapillary-tag-vertex",G,[]))}}}return r}},{key:"getGLObjects",value:function(){var e=[];null!=this._fill&&e.push(this._fill);var t,n=Pd(this._holes);try{for(n.s();!(t=n.n()).done;){var i=t.value;e.push(i)}}catch(MN){n.e(MN)}finally{n.f()}return null!=this._outline&&e.push(this._outline),e}},{key:"getRetrievableObjects",value:function(){return null!=this._fill?[this._fill]:[]}},{key:"_onGeometryChanged",value:function(){null!=this._fill&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),null!=this._outline&&this._updateOulineGeometry()}},{key:"_onTagChanged",value:function(){var e=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),e=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),e}},{key:"_getPoints3d",value:function(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}},{key:"_getTriangles",value:function(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}},{key:"_updateFillMaterial",value:function(e){e.color=new h_(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}},{key:"_updateLineBasicMaterial",value:function(e){e.color=new h_(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}},{key:"_createHoles",value:function(){var e=[];if(this._tag.geometry instanceof AI){var t,n=Pd(this._getHoles3d());try{for(n.s();!(t=n.n()).done;){var i=t.value,r=this._createLine(i);e.push(r)}}catch(MN){n.e(MN)}finally{n.f()}}return e}},{key:"_disposeHoles",value:function(){var e,t=Pd(this._holes);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.geometry.dispose(),n.material.dispose()}}catch(MN){t.e(MN)}finally{t.f()}this._holes=[]}},{key:"_getHoles3d",value:function(){var e=this._tag.geometry;return this._in3dDomain()?e.getHoleVertices3d(this._transform):e.getHolePoints3d(this._transform)}},{key:"_in3dDomain",value:function(){return this._tag.geometry instanceof AI&&this._tag.domain===OI.ThreeDimensional}},{key:"_updateHoleGeometries",value:function(){var e=this._getHoles3d();if(e.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(var t=0;t<this._holes.length;t++){var n=e[t],i=this._holes[t];this._updateLine(i,n)}}},{key:"_updateHoleMaterials",value:function(){var e,t=Pd(this._holes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._updateLineBasicMaterial(n.material)}}catch(MN){t.e(MN)}finally{t.f()}}},{key:"_updateOutlineMaterial",value:function(){this._updateLineBasicMaterial(this._outline.material)}}]),n}(FI);!function(e){e[e.Bottom=0]="Bottom",e[e.BottomLeft=1]="BottomLeft",e[e.BottomRight=2]="BottomRight",e[e.Center=3]="Center",e[e.Left=4]="Left",e[e.Right=5]="Right",e[e.Top=6]="Top",e[e.TopLeft=7]="TopLeft",e[e.TopRight=8]="TopRight"}(UI||(UI={}));var HI=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;Fd(this,n),a=t.call(this,e,i);var o=null!=(r=r||{}).domain&&i instanceof AI?r.domain:OI.TwoDimensional,s=a._twoDimensionalPolygon(o,i);return a._domain=o,a._editable=null!=r.editable&&!s&&r.editable,a._fillColor=null==r.fillColor?16777215:r.fillColor,a._fillOpacity=null==r.fillOpacity?0:r.fillOpacity,a._icon=void 0===r.icon?null:r.icon,a._iconFloat=null==r.iconFloat?UI.Center:r.iconFloat,a._iconIndex=null==r.iconIndex?3:r.iconIndex,a._indicateVertices=null==r.indicateVertices||r.indicateVertices,a._lineColor=null==r.lineColor?16777215:r.lineColor,a._lineOpacity=null==r.lineOpacity?1:r.lineOpacity,a._lineWidth=null==r.lineWidth?1:r.lineWidth,a._text=void 0===r.text?null:r.text,a._textColor=null==r.textColor?16777215:r.textColor,a._click$=new Af,a._click$.subscribe((function(){var e="click",t={target:Ad(a),type:e};a.fire(e,t)})),a}return $d(n,[{key:"click$",get:function(){return this._click$}},{key:"domain",get:function(){return this._domain}},{key:"editable",get:function(){return this._editable},set:function(e){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=e,this._notifyChanged$.next(this))}},{key:"fillColor",get:function(){return this._fillColor},set:function(e){this._fillColor=e,this._notifyChanged$.next(this)}},{key:"fillOpacity",get:function(){return this._fillOpacity},set:function(e){this._fillOpacity=e,this._notifyChanged$.next(this)}},{key:"geometry",get:function(){return this._geometry}},{key:"icon",get:function(){return this._icon},set:function(e){this._icon=e,this._notifyChanged$.next(this)}},{key:"iconFloat",get:function(){return this._iconFloat},set:function(e){this._iconFloat=e,this._notifyChanged$.next(this)}},{key:"iconIndex",get:function(){return this._iconIndex},set:function(e){this._iconIndex=e,this._notifyChanged$.next(this)}},{key:"indicateVertices",get:function(){return this._indicateVertices},set:function(e){this._indicateVertices=e,this._notifyChanged$.next(this)}},{key:"lineColor",get:function(){return this._lineColor},set:function(e){this._lineColor=e,this._notifyChanged$.next(this)}},{key:"lineOpacity",get:function(){return this._lineOpacity},set:function(e){this._lineOpacity=e,this._notifyChanged$.next(this)}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(e){this._lineWidth=e,this._notifyChanged$.next(this)}},{key:"text",get:function(){return this._text},set:function(e){this._text=e,this._notifyChanged$.next(this)}},{key:"textColor",get:function(){return this._textColor},set:function(e){this._textColor=e,this._notifyChanged$.next(this)}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"setOptions",value:function(e){var t=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=t||null==e.editable?this._editable:e.editable,this._icon=void 0===e.icon?this._icon:e.icon,this._iconFloat=null==e.iconFloat?this._iconFloat:e.iconFloat,this._iconIndex=null==e.iconIndex?this._iconIndex:e.iconIndex,this._indicateVertices=null==e.indicateVertices?this._indicateVertices:e.indicateVertices,this._lineColor=null==e.lineColor?this._lineColor:e.lineColor,this._lineWidth=null==e.lineWidth?this._lineWidth:e.lineWidth,this._fillColor=null==e.fillColor?this._fillColor:e.fillColor,this._fillOpacity=null==e.fillOpacity?this._fillOpacity:e.fillOpacity,this._text=void 0===e.text?this._text:e.text,this._textColor=null==e.textColor?this._textColor:e.textColor,this._notifyChanged$.next(this)}},{key:"_twoDimensionalPolygon",value:function(e,t){return e!==OI.ThreeDimensional&&t instanceof AI}}]),n}($I),WI=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"dispose",value:function(){}},{key:"getDOMObjects",value:function(e,t,n){var i=this,r=this._tag,a={offsetHeight:n.height,offsetWidth:n.width},o=[],u=s(r.geometry.getCentroid2d(),2),l=u[0],c=u[1],h=this._viewportCoords.basicToCanvasSafe(l,c,a,this._transform,t);if(null!=h){var d=function(e){i._interact$.next({offsetX:0,offsetY:0,operation:CI.None,tag:r})},f=Math.round(h[0]),p=Math.round(h[1]);if(null!=r.icon){if(e.loaded){var v=e.getDOMSprite(r.icon,UI.Bottom),m={onpointerdown:d,style:{pointerEvents:"all",transform:"translate(".concat(f,"px,").concat(p+8,"px)")}};o.push(_P.h("div",m,[v]))}}else if(null!=r.text){var g="translate(-50%,0%) translate(".concat(f,"px,").concat(p+8,"px)"),_={onpointerdown:d,style:{color:this._colorToCss(r.textColor),transform:g},textContent:r.text};o.push(_P.h("span.mapillary-tag-symbol",_,[]))}var y=this._interact(CI.Centroid,r,"move"),b=this._colorToCss(r.color),x="translate(-50%,-50%) translate(".concat(f,"px,").concat(p,"px)");if(r.editable){var w={onpointerdown:y,style:{background:b,transform:x}};o.push(_P.h("div.mapillary-tag-spot-interactor",w,[]))}var k={style:{background:b,transform:x}};o.push(_P.h("div.mapillary-tag-vertex",k,[]))}return o}},{key:"getGLObjects",value:function(){return[]}},{key:"getRetrievableObjects",value:function(){return[]}},{key:"_colorToCss",value:function(e){return"#"+("000000"+e.toString(16)).substr(-6)}},{key:"_interact",value:function(e,t,n,i){var r=this;return function(a){var o=a.offsetX-a.target.offsetWidth/2,s=a.offsetY-a.target.offsetHeight/2;r._interact$.next({cursor:n,offsetX:o,offsetY:s,operation:e,tag:t,vertexIndex:i})}}}]),n}(zI),GI=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),r=r||{},(a=t.call(this,e,i))._color=null==r.color?16777215:r.color,a._editable=null!=r.editable&&r.editable,a._icon=void 0===r.icon?null:r.icon,a._text=void 0===r.text?null:r.text,a._textColor=null==r.textColor?16777215:r.textColor,a}return $d(n,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._notifyChanged$.next(this)}},{key:"editable",get:function(){return this._editable},set:function(e){this._editable=e,this._notifyChanged$.next(this)}},{key:"icon",get:function(){return this._icon},set:function(e){this._icon=e,this._notifyChanged$.next(this)}},{key:"text",get:function(){return this._text},set:function(e){this._text=e,this._notifyChanged$.next(this)}},{key:"textColor",get:function(){return this._textColor},set:function(e){this._textColor=e,this._notifyChanged$.next(this)}},{key:"setOptions",value:function(e){this._color=null==e.color?this._color:e.color,this._editable=null==e.editable?this._editable:e.editable,this._icon=void 0===e.icon?this._icon:e.icon,this._text=void 0===e.text?this._text:e.text,this._textColor=null==e.textColor?this._textColor:e.textColor,this._notifyChanged$.next(this)}}]),n}($I),qI=function(){function e(){Fd(this,e),this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new Af}return $d(e,[{key:"active",get:function(){return this._active}},{key:"changed$",get:function(){return this._notifyChanged$}},{key:"activate",value:function(e){if(!this._active){for(var t in this._hashDeactivated)if(this._hashDeactivated.hasOwnProperty(t)){var n=this._hashDeactivated[t];this._add(n,e)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}},{key:"deactivate",value:function(){if(this._active){for(var e in this._hash)this._hash.hasOwnProperty(e)&&(this._hashDeactivated[e]=this._hash[e].tag);this._hash={},this._active=!1}}},{key:"add",value:function(e,t){this._assertActivationState(!0);var n,i=Pd(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;this._add(r,t)}}catch(MN){i.e(MN)}finally{i.f()}this._notifyChanged$.next(this)}},{key:"addDeactivated",value:function(e){this._assertActivationState(!1);var t,n=Pd(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!(i instanceof HI||i instanceof GI||i instanceof jI))throw new Error("Tag type not supported");this._hashDeactivated[i.id]=i}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"get",value:function(e){return this.has(e)?this._hash[e]:void 0}},{key:"getAll",value:function(){var e=this._hash;return Object.keys(e).map((function(t){return e[t]}))}},{key:"getAllDeactivated",value:function(){var e=this._hashDeactivated;return Object.keys(e).map((function(t){return e[t]}))}},{key:"getDeactivated",value:function(e){return this.hasDeactivated(e)?this._hashDeactivated[e]:void 0}},{key:"has",value:function(e){return e in this._hash}},{key:"hasDeactivated",value:function(e){return e in this._hashDeactivated}},{key:"remove",value:function(e){this._assertActivationState(!0);var t,n=this._hash,i=Pd(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;r in n&&delete n[r]}}catch(MN){i.e(MN)}finally{i.f()}this._notifyChanged$.next(this)}},{key:"removeAll",value:function(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}},{key:"removeAllDeactivated",value:function(){this._assertActivationState(!1),this._hashDeactivated={}}},{key:"removeDeactivated",value:function(e){this._assertActivationState(!1);var t,n=this._hashDeactivated,i=Pd(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;r in n&&delete n[r]}}catch(MN){i.e(MN)}finally{i.f()}}},{key:"_add",value:function(e,t){if(e instanceof HI)this._hash[e.id]=new VI(e,t);else if(e instanceof GI)this._hash[e.id]=new WI(e,t);else{if(!(e instanceof jI))throw new Error("Tag type not supported");this._hash[e.id]=new BI(e,t)}}},{key:"_assertActivationState",value:function(e){if(e!==this._active)throw new Error("Tag set not in correct state for operation.")}}]),e}(),ZI=function(e){Dd(n,e);var t=Od(n);function n(e){var i;Fd(this,n),i=t.call(this);var r=e[0],a=e[1];if(r<0||r>1||a<0||a>1)throw new iA("Basic coordinates must be on the interval [0, 1].");return i._point=e.slice(),i}return $d(n,[{key:"point",get:function(){return this._point}},{key:"getCentroid2d",value:function(){return this._point.slice()}},{key:"getCentroid3d",value:function(e){return e.unprojectBasic(this._point,200)}},{key:"setCentroid2d",value:function(e,t){var n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._point[0]=n[0],this._point[1]=n[1],this._notifyChanged$.next(this)}}]),n}(nA),XI=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._name="".concat(o._component.name,"-").concat(o._getNameExtension()),o._viewportCoords=a,o}return $d(n,[{key:"_getConfiguration",value:function(e){return{}}},{key:"_mouseEventToBasic",value:function(e,t,n,i,r,a){r=null!=r?r:0,a=null!=a?a:0;var o=s(this._viewportCoords.canvasPosition(e,t),2),u=o[0],l=o[1];return this._viewportCoords.canvasToBasic(u-r,l-a,t,i,n.perspective)}}]),n}(JP),YI=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o){var s;return Fd(this,n),(s=t.call(this,e,i,r,a))._tagCreator=o,s._geometryCreated$=new Af,s}return $d(n,[{key:"geometryCreated$",get:function(){return this._geometryCreated$}},{key:"_enable",value:function(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}},{key:"_disable",value:function(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}},{key:"_validateBasic",value:function(e){var t=e[0],n=e[1];return 0<=t&&t<=1&&0<=n&&n<=1}},{key:"_mouseEventToBasic$",value:function(e){var t=this;return e.pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),xp((function(e){var n=s(e,3),i=n[0],r=n[1],a=n[2];return t._mouseEventToBasic(i,t._container.container,r,a)})))}}]),n}(XI),KI=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enableCreate",value:function(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(qp(this._validateBasic),xp((function(e){return new ZI(e)}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-point"}}]),n}(YI),JI=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enableCreate",value:function(){var e=this;this._container.mouseService.deferPixels(this._name,4);var t=this._navigator.stateService.currentTransform$.pipe(xp((function(){})),_v(1),Ef());this._deleteSubscription=t.pipe(kv(1)).subscribe(this._tagCreator.delete$);var n=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(xv());this._createSubscription=t.pipe(Tv((function(){return n.pipe(qp(e._validateBasic),av(1))}))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(Tv((function(t){return t?Lp(pp(t),Hp(e._container.mouseService.mouseMove$,e._container.mouseService.domMouseMove$),e._container.renderService.renderCamera$,e._navigator.stateService.currentTransform$):Hf()}))).subscribe((function(t){var n=s(t,4),i=n[0],r=n[1],a=n[2],o=n[3],u=e._mouseEventToBasic(r,e._container.container,a,o);e._setVertex2d(i,u,o)})),this._addPointSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?Lp(pp(e),n):Hf()}))).subscribe((function(t){var n=s(t,2),i=n[0],r=n[1];e._addPoint(i,r)})),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?e.created$.pipe(xp((function(e){return e.geometry}))):Hf()}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}]),n}(YI),QI=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_create$",get:function(){return this._tagCreator.createPoints$}},{key:"_addPoint",value:function(e,t){e.geometry.addPoint2d(t)}},{key:"_getNameExtension",value:function(){return"create-points"}},{key:"_setVertex2d",value:function(e,t,n){e.geometry.setPoint2d(e.geometry.points.length-1,t,n)}}]),n}(JI),eR=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_create$",get:function(){return this._tagCreator.createPolygon$}},{key:"_addPoint",value:function(e,t){e.addPoint(t)}},{key:"_getNameExtension",value:function(){return"create-polygon"}},{key:"_setVertex2d",value:function(e,t,n){e.geometry.setVertex2d(e.geometry.polygon.length-2,t,n)}}]),n}(JI),tR=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_create$",get:function(){return this._tagCreator.createRect$}},{key:"_addPoint",value:function(e,t){var n=e.geometry;n.validate(t)||(t=n.getNonAdjustedVertex2d(3)),e.addPoint(t)}},{key:"_enable",value:function(){Nd(kd(n.prototype),"_enable",this).call(this),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(qp((function(e){return!!e}))).subscribe((function(e){e.geometry.initializeAnchorIndexing()}))}},{key:"_disable",value:function(){Nd(kd(n.prototype),"_disable",this).call(this),this._initializeAnchorIndexingSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-rect"}},{key:"_setVertex2d",value:function(e,t,n){e.geometry.setOppositeVertex2d(t,n)}}]),n}(JI),nR=function(e){Dd(n,e);var t=Od(n);function n(){return Fd(this,n),t.apply(this,arguments)}return $d(n,[{key:"_enableCreate",value:function(){var e=this;this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(xp((function(e){return null})),kv(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(qp(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(qp((function(e){return!!e}))).subscribe((function(e){e.geometry.initializeAnchorIndexing()}));var t=Lp(Hp(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(Lv(this._navigator.stateService.currentTransform$),xp((function(t){var n=s(t,2),i=s(n[0],2),r=i[0],a=i[1],o=n[1];return e._mouseEventToBasic(r,e._container.container,a,o)})));this._setVertexSubscription=this._tagCreator.tag$.pipe(Tv((function(n){return n?Lp(pp(n),t,e._navigator.stateService.currentTransform$):Hf()}))).subscribe((function(e){var t=s(e,3),n=t[0],i=t[1],r=t[2];n.geometry.setOppositeVertex2d(i,r)}));var n=this._container.mouseService.mouseDragEnd$.pipe(Lv(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(qp(this._validateBasic)),(function(e,t){return t})),xv());this._addPointSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?Lp(pp(e),n):Hf()}))).subscribe((function(e){var t=s(e,2),n=t[0],i=t[1],r=n.geometry;r.validate(i)||(i=r.getNonAdjustedVertex2d(3)),n.addPoint(i)})),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(Tv((function(e){return e?e.created$.pipe(xp((function(e){return e.geometry}))):Hf()}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-rect-drag"}}]),n}(YI),iR=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a,o){var s;return Fd(this,n),(s=t.call(this,e,i,r,a))._tagSet=o,s}return $d(n,[{key:"_enable",value:function(){var e=this,t=this._tagSet.changed$.pipe(xp((function(e){return e.getAll()})),Tv((function(e){return rp(e).pipe(Np((function(e){return e.interact$})))})),Tv((function(t){return zp(pp(t),e._container.mouseService.documentMouseUp$.pipe(xp((function(){return{offsetX:0,offsetY:0,operation:CI.None,tag:null}})),dv()))})),xv());Hp(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(xv()),this._claimMouseSubscription=t.pipe(Tv((function(t){return t.tag?e._container.mouseService.domMouseDragStart$:Hf()}))).subscribe((function(){e._container.mouseService.claimMouse(e._name,3)})),this._cursorSubscription=t.pipe(xp((function(e){return e.cursor})),ov()).subscribe((function(t){for(var n=0,i=["crosshair","move","nesw-resize","nwse-resize"];n<i.length;n++){var r=i[n];e._container.container.classList.remove("component-tag-edit-".concat(r))}t&&e._container.container.classList.add("component-tag-edit-".concat(t))})),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe((function(t){e._container.mouseService.unclaimMouse(e._name)})),this._preventDefaultSubscription=t.pipe(Tv((function(t){return t.tag?e._container.mouseService.documentMouseMove$:Hf()}))).subscribe((function(e){e.preventDefault()})),this._updateGeometrySubscription=t.pipe(Tv((function(t){return t.operation!==CI.None&&t.tag?Lp(e._container.mouseService.filtered$(e._name,e._container.mouseService.domMouseDrag$).pipe(qp((function(t){return e._viewportCoords.insideElement(t,e._container.container)}))),e._container.renderService.renderCamera$).pipe(Lv(pp(t),e._navigator.stateService.currentTransform$,(function(e,t,n){var i=s(e,2);return[i[0],i[1],t,n]}))):Hf()}))).subscribe((function(t){var n=s(t,4),i=n[0],r=n[1],a=n[2],o=n[3],u=e._mouseEventToBasic(i,e._container.container,r,o,a.offsetX,a.offsetY),l=a.tag.geometry;a.operation===CI.Centroid?l.setCentroid2d(u,o):a.operation===CI.Vertex&&l.setVertex2d(a.vertexIndex,u,o)}))}},{key:"_disable",value:function(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"edit-vertex"}}]),n}(XI),rR=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._tagDomRenderer=new NI,a._tagScene=new DI,a._tagSet=new qI,a._tagCreator=new RI(Ad(a),r),a._viewportCoords=new MP,a._createHandlers={CreatePoint:new KI(Ad(a),i,r,a._viewportCoords,a._tagCreator),CreatePoints:new QI(Ad(a),i,r,a._viewportCoords,a._tagCreator),CreatePolygon:new eR(Ad(a),i,r,a._viewportCoords,a._tagCreator),CreateRect:new tR(Ad(a),i,r,a._viewportCoords,a._tagCreator),CreateRectDrag:new nR(Ad(a),i,r,a._viewportCoords,a._tagCreator),Default:void 0},a._editVertexHandler=new iR(Ad(a),i,r,a._viewportCoords,a._tagSet),a._renderTags$=a._tagSet.changed$.pipe(xp((function(e){var t=e.getAll();return t.sort((function(e,t){var n=e.tag.id,i=t.tag.id;return n<i?-1:n>i?1:0})),t})),xv()),a._tagChanged$=a._renderTags$.pipe(Tv((function(e){return rp(e).pipe(Np((function(e){return Hp(e.tag.changed$,e.tag.geometryChanged$)})))})),xv()),a._renderTagGLChanged$=a._renderTags$.pipe(Tv((function(e){return rp(e).pipe(Np((function(e){return e.glObjectsChanged$})))})),xv()),a._createGeometryChanged$=a._tagCreator.tag$.pipe(Tv((function(e){return null!=e?e.geometryChanged$:Hf()})),xv()),a._createGLObjectsChanged$=a._tagCreator.tag$.pipe(Tv((function(e){return null!=e?e.glObjectsChanged$:Hf()})),xv()),a._creatingConfiguration$=a._configuration$.pipe(ov((function(e,t){return e.mode===t.mode}),(function(e){return{createColor:e.createColor,mode:e.mode}})),_v(1),Ef()),a._creatingConfiguration$.subscribe((function(e){var t="tagmode",n={mode:e.mode,target:Ad(a),type:t};a.fire(t,n)})),a}return $d(n,[{key:"add",value:function(e){var t=this;this._activated?this._navigator.stateService.currentTransform$.pipe(dv()).subscribe((function(n){t._tagSet.add(e,n);var i=e.map((function(e){return t._tagSet.get(e.id)}));t._tagScene.add(i)})):this._tagSet.addDeactivated(e)}},{key:"calculateRect",value:function(e){var t=this;return new Promise((function(n,i){t._navigator.stateService.currentTransform$.pipe(dv(),xp((function(t){return e.getRect2d(t)}))).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"create",value:function(){this._tagCreator.replayedTag$.pipe(dv(),qp((function(e){return!!e}))).subscribe((function(e){e.create()}))}},{key:"changeMode",value:function(e){this.configure({mode:e})}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"get",value:function(e){if(this._activated){var t=this._tagSet.get(e);return void 0!==t?t.tag:void 0}return this._tagSet.getDeactivated(e)}},{key:"getAll",value:function(){return this.activated?this._tagSet.getAll().map((function(e){return e.tag})):this._tagSet.getAllDeactivated()}},{key:"getTagIdsAt",value:function(e){var t=this;return new Promise((function(n,i){t._container.renderService.renderCamera$.pipe(dv(),xp((function(n){var i=t._viewportCoords.canvasToViewport(e[0],e[1],t._container.container);return t._tagScene.intersectObjects(i,n.perspective)}))).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"has",value:function(e){return this._activated?this._tagSet.has(e):this._tagSet.hasDeactivated(e)}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"remove",value:function(e){this._activated?(this._tagSet.remove(e),this._tagScene.remove(e)):this._tagSet.removeDeactivated(e)}},{key:"removeAll",value:function(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}},{key:"_activate",value:function(){var e=this;this._editVertexHandler.enable();var t=rp(Object.keys(this._createHandlers)).pipe(xp((function(t){return e._createHandlers[t]})),qp((function(e){return!!e})),Np((function(e){return e.geometryCreated$})),xv()),n=this._subscriptions;n.push(t.subscribe((function(t){var n="geometrycreate",i={geometry:t,target:e,type:n};e.fire(n,i)}))),n.push(this._tagCreator.tag$.pipe(Sv((function(e){return null==e})),ov()).subscribe((function(t){var n=null!=t?"tagcreatestart":"tagcreateend",i={target:e,type:n};e.fire(n,i)}))),n.push(t.subscribe((function(){e.changeMode(TI.Default)}))),n.push(this._creatingConfiguration$.subscribe((function(t){e._disableCreateHandlers();var n=TI[t.mode],i=e._createHandlers[n];i&&i.enable()}))),n.push(this._renderTags$.subscribe((function(){var t="tags",n={target:e,type:t};e.fire(t,n)}))),n.push(this._tagCreator.tag$.pipe(Tv((function(e){return null!=e?e.aborted$.pipe(xp((function(){return null}))):Hf()}))).subscribe((function(){e.changeMode(TI.Default)}))),n.push(this._tagCreator.tag$.subscribe((function(t){e._tagScene.hasCreateTag()&&e._tagScene.removeCreateTag(),null!=t&&e._tagScene.addCreateTag(t)}))),n.push(this._createGLObjectsChanged$.subscribe((function(t){e._tagScene.updateCreateTagObjects(t)}))),n.push(this._renderTagGLChanged$.subscribe((function(t){e._tagScene.updateObjects(t)}))),n.push(this._tagChanged$.subscribe((function(){e._tagScene.update()}))),n.push(Lp(this._renderTags$.pipe(Mv([]),Pv((function(){e._container.domRenderer.render$.next({name:e._name,vNode:e._tagDomRenderer.clear()})}))),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(Mv(null)),Hp(this._tagCreator.tag$,this._createGeometryChanged$).pipe(Mv(null))).pipe(xp((function(t){var n=s(t,6),i=n[0],r=n[1],a=n[2],o=n[3],u=n[5];return{name:e._name,vNode:e._tagDomRenderer.render(i,u,a,r.perspective,o)}}))).subscribe(this._container.domRenderer.render$)),n.push(this._navigator.stateService.currentState$.pipe(xp((function(t){var n=e._tagScene;return{name:e._name,renderer:{frameId:t.id,needsRender:n.needsRender,render:n.render.bind(n),pass:RP.Opaque}}}))).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(dv()).subscribe((function(t){e._tagSet.activate(t),e._tagScene.add(e._tagSet.getAll())}))}},{key:"_deactivate",value:function(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}},{key:"_getDefaultConfiguration",value:function(){return{createColor:16777215,indicatePointsCompleter:!0,mode:TI.Default}}},{key:"_disableCreateHandlers",value:function(){var e=this._createHandlers;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];n&&n.disable()}}}]),n}(xP);rR.componentName="tag";var aR=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._viewportCoords=new MP,a._zoomDelta$=new Af,a}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._subscriptions;t.push(Lp(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(xp((function(t){var n=s(t,4),i=n[0],r=n[1],a=n[2],o=n[3],u=i.state.zoom,l=_P.h("div.mapillary-zoom-in-icon",[]),c=u>=3||r===XP.Waiting?_P.h("div.mapillary-zoom-in-button-inactive",[l]):_P.h("div.mapillary-zoom-in-button",{onclick:function(){e._zoomDelta$.next(1)}},[l]),h=_P.h("div.mapillary-zoom-out-icon",[]),d=u<=0||r===XP.Waiting?_P.h("div.mapillary-zoom-out-button-inactive",[h]):_P.h("div.mapillary-zoom-out-button",{onclick:function(){e._zoomDelta$.next(-1)}},[h]),f=a.size===SP.Small||a.size===SP.Automatic&&o.width<640?".mapillary-zoom-compact":"";return{name:e._name,vNode:_P.h("div.mapillary-zoom-container"+f,{oncontextmenu:function(e){e.preventDefault()}},[c,d])}}))).subscribe(this._container.domRenderer.render$)),t.push(this._zoomDelta$.pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var n=s(t,3),i=n[0],r=n[1],a=n[2],o=e._viewportCoords.unprojectFromViewport(0,0,r.perspective),u=a.projectBasic(o.toArray());e._navigator.stateService.zoomIn(i,u)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{size:SP.Automatic}}}]),n}(xP);aR.componentName="zoom";var oR=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o;return Fd(this,n),(o=t.call(this,e,i,r))._canvasId="".concat(i.id,"-").concat(o._name),o._dom=a||new kL,o}return $d(n,[{key:"_activate",value:function(){var e=this,t=this._container.domRenderer.element$.pipe(xp((function(){return e._dom.document.getElementById(e._canvasId)})),qp((function(e){return!!e})),xp((function(e){var t=e.parentElement,n=t.offsetWidth;return[e,{height:t.offsetHeight,width:n}]})),ov((function(e,t){return e.height===t.height&&e.width===t.width}),(function(e){return s(e,2)[1]})));this._subscriptions.push(Lp(t,this._navigator.stateService.currentImage$).subscribe((function(e){var t=s(e,2),n=s(t[0],2),i=n[0],r=n[1],a=t[1];i.width=r.width,i.height=r.height,i.getContext("2d").drawImage(a.image,0,0,r.width,r.height)}))),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:_P.h("canvas#".concat(this._canvasId),[])})}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}}]),n}(xP);oR.componentName="imagefallback";var sR=function(e){Dd(n,e);var t=Od(n);function n(e,i,r){var a;return Fd(this,n),(a=t.call(this,e,i,r))._seqNames={},a._seqNames[DM[DM.Prev]]="-prev",a._seqNames[DM[DM.Next]]="-next",a._spaTopNames={},a._spaTopNames[DM[DM.TurnLeft]]="-turn-left",a._spaTopNames[DM[DM.StepLeft]]="-left",a._spaTopNames[DM[DM.StepForward]]="-forward",a._spaTopNames[DM[DM.StepRight]]="-right",a._spaTopNames[DM[DM.TurnRight]]="-turn-right",a._spaBottomNames={},a._spaBottomNames[DM[DM.TurnU]]="-turn-around",a._spaBottomNames[DM[DM.StepBackward]]="-backward",a}return $d(n,[{key:"_activate",value:function(){var e=this;this._subscriptions.push(Lp(this._navigator.stateService.currentImage$,this._configuration$).pipe(Tv((function(e){var t=s(e,2),n=t[0],i=t[1];return Lp(i.sequence?n.sequenceEdges$.pipe(xp((function(e){return e.edges.map((function(e){return e.data.direction}))}))):pp([]),!qM(n.cameraType)&&i.spatial?n.spatialEdges$.pipe(xp((function(e){return e.edges.map((function(e){return e.data.direction}))}))):pp([])).pipe(xp((function(e){var t=s(e,2),n=t[0],i=t[1];return n.concat(i)})))})),xp((function(t){var n=e._createArrowRow(e._seqNames,t),i=e._createArrowRow(e._spaTopNames,t),r=e._createArrowRow(e._spaBottomNames,t),a=_P.h("div.mapillary-navigation-sequence",n),o=_P.h("div.NavigationSpatialTop",i),s=_P.h("div.mapillary-navigation-spatial-bottom",r),u=_P.h("div.mapillary-navigation-spatial",[o,s]);return{name:e._name,vNode:_P.h("div.NavigationContainer",[a,u])}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{sequence:!0,spatial:!0}}},{key:"_createArrowRow",value:function(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var r=DM[i];-1!==t.indexOf(r)?n.push(this._createVNode(r,e[i],"visible")):n.push(this._createVNode(r,e[i],"hidden"))}return n}},{key:"_createVNode",value:function(e,t,n){var i=this;return _P.h("span.mapillary-navigation-button.mapillary-navigation".concat(t),{onclick:function(){i._navigator.moveDir$(e).subscribe(void 0,(function(e){e instanceof EP||console.error(e)}))},style:{visibility:n}},[])}}]),n}(xP);sR.componentName="navigationfallback";function uR(e){for(var t=e.length;--t>=0;)e[t]=0}var lR=256,cR=286,hR=30,dR=15,fR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),pR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),mR=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gR=new Array(576);uR(gR);var _R=new Array(60);uR(_R);var yR=new Array(512);uR(yR);var bR=new Array(256);uR(bR);var xR=new Array(29);uR(xR);var wR,kR,SR,MR=new Array(hR);function TR(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function CR(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}uR(MR);var ER=function(e){return e<256?yR[e]:yR[256+(e>>>7)]},PR=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},LR=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,PR(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},AR=function(e,t,n){LR(e,n[2*t],n[2*t+1])},IR=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},RR=function(e,t,n){var i,r,a=new Array(16),o=0;for(i=1;i<=dR;i++)a[i]=o=o+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=IR(a[s]++,s))}},NR=function(e){var t;for(t=0;t<cR;t++)e.dyn_ltree[2*t]=0;for(t=0;t<hR;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},DR=function(e){e.bi_valid>8?PR(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},OR=function(e,t,n,i){var r=2*t,a=2*n;return e[r]<e[a]||e[r]===e[a]&&i[t]<=i[n]},zR=function(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&OR(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!OR(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i},FR=function(e,t,n){var i,r,a,o,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?AR(e,r,t):(a=bR[r],AR(e,a+lR+1,t),0!==(o=fR[a])&&(r-=xR[a],LR(e,r,o)),i--,a=ER(i),AR(e,a,n),0!==(o=pR[a])&&(i-=MR[a],LR(e,i,o)))}while(s<e.last_lit);AR(e,256,t)},BR=function(e,t){var n,i,r,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==a[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=o[2*r+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)zR(e,a,n);r=u;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],zR(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,a[2*r]=a[2*n]+a[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,a[2*n+1]=a[2*i+1]=r,e.heap[1]=r++,zR(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,a,o,s,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,v=0;for(a=0;a<=dR;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=u[2*u[2*(i=e.heap[n])+1]+1]+1)>p&&(a=p,v++),u[2*i+1]=a,i>l||(e.bl_count[a]++,o=0,i>=f&&(o=d[i-f]),s=u[2*i],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*i+1]+o)));if(0!==v){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,v-=2}while(v>0);for(a=p;0!==a;a--)for(i=e.bl_count[a];0!==i;)(r=e.heap[--n])>l||(u[2*r+1]!==a&&(e.opt_len+=(a-u[2*r+1])*u[2*r],u[2*r+1]=a),i--)}}(e,t),RR(a,l,e.bl_count)},$R=function(e,t,n){var i,r,a=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=t[2*(i+1)+1],++s<u&&r===o||(s<l?e.bl_tree[2*r]+=s:0!==r?(r!==a&&e.bl_tree[2*r]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=r,0===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4))},jR=function(e,t,n){var i,r,a=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),i=0;i<=n;i++)if(r=o,o=t[2*(i+1)+1],!(++s<u&&r===o)){if(s<l)do{AR(e,r,e.bl_tree)}while(0!==--s);else 0!==r?(r!==a&&(AR(e,r,e.bl_tree),s--),AR(e,16,e.bl_tree),LR(e,s-3,2)):s<=10?(AR(e,17,e.bl_tree),LR(e,s-3,3)):(AR(e,18,e.bl_tree),LR(e,s-11,7));s=0,a=r,0===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4)}},UR=!1,VR=function(e,t,n,i){LR(e,0+(i?1:0),3),function(e,t,n,i){DR(e),i&&(PR(e,n),PR(e,~n)),e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n}(e,t,n,!0)},HR=function(e,t,n,i){var r,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<lR;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),BR(e,e.l_desc),BR(e,e.d_desc),o=function(e){var t;for($R(e,e.dyn_ltree,e.l_desc.max_code),$R(e,e.dyn_dtree,e.d_desc.max_code),BR(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*mR[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=r&&(r=a)):r=a=n+5,n+4<=r&&-1!==t?VR(e,t,n,i):4===e.strategy||a===r?(LR(e,2+(i?1:0),3),FR(e,gR,_R)):(LR(e,4+(i?1:0),3),function(e,t,n,i){var r;for(LR(e,t-257,5),LR(e,n-1,5),LR(e,i-4,4),r=0;r<i;r++)LR(e,e.bl_tree[2*mR[r]+1],3);jR(e,e.dyn_ltree,t-1),jR(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),FR(e,e.dyn_ltree,e.dyn_dtree)),NR(e),i&&DR(e)},WR={_tr_init:function(e){UR||(!function(){var e,t,n,i,r,a=new Array(16);for(n=0,i=0;i<28;i++)for(xR[i]=n,e=0;e<1<<fR[i];e++)bR[n++]=i;for(bR[n-1]=i,r=0,i=0;i<16;i++)for(MR[i]=r,e=0;e<1<<pR[i];e++)yR[r++]=i;for(r>>=7;i<hR;i++)for(MR[i]=r<<7,e=0;e<1<<pR[i]-7;e++)yR[256+r++]=i;for(t=0;t<=dR;t++)a[t]=0;for(e=0;e<=143;)gR[2*e+1]=8,e++,a[8]++;for(;e<=255;)gR[2*e+1]=9,e++,a[9]++;for(;e<=279;)gR[2*e+1]=7,e++,a[7]++;for(;e<=287;)gR[2*e+1]=8,e++,a[8]++;for(RR(gR,287,a),e=0;e<hR;e++)_R[2*e+1]=5,_R[2*e]=IR(e,5);wR=new TR(gR,fR,257,cR,dR),kR=new TR(_R,pR,0,hR,dR),SR=new TR(new Array(0),vR,0,19,7)}(),UR=!0),e.l_desc=new CR(e.dyn_ltree,wR),e.d_desc=new CR(e.dyn_dtree,kR),e.bl_desc=new CR(e.bl_tree,SR),e.bi_buf=0,e.bi_valid=0,NR(e)},_tr_stored_block:VR,_tr_flush_block:HR,_tr_tally:function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(bR[n]+lR+1)]++,e.dyn_dtree[2*ER(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){LR(e,2,3),AR(e,256,gR),function(e){16===e.bi_valid?(PR(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},GR=function(e,t,n,i){for(var r=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(r=r+t[i++]|0)|0}while(--o);r%=65521,a%=65521}return r|a<<16|0},qR=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),ZR=function(e,t,n,i){var r=qR,a=i+n;e^=-1;for(var o=i;o<a;o++)e=e>>>8^r[255&(e^t[o])];return-1^e},XR={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},YR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},KR=WR._tr_init,JR=WR._tr_stored_block,QR=WR._tr_flush_block,eN=WR._tr_tally,tN=WR._tr_align,nN=YR.Z_NO_FLUSH,iN=YR.Z_PARTIAL_FLUSH,rN=YR.Z_FULL_FLUSH,aN=YR.Z_FINISH,oN=YR.Z_BLOCK,sN=YR.Z_OK,uN=YR.Z_STREAM_END,lN=YR.Z_STREAM_ERROR,cN=YR.Z_DATA_ERROR,hN=YR.Z_BUF_ERROR,dN=YR.Z_DEFAULT_COMPRESSION,fN=YR.Z_FILTERED,pN=YR.Z_HUFFMAN_ONLY,vN=YR.Z_RLE,mN=YR.Z_FIXED,gN=YR.Z_DEFAULT_STRATEGY,_N=YR.Z_UNKNOWN,yN=YR.Z_DEFLATED,bN=258,xN=262,wN=103,kN=113,SN=666,MN=function(e,t){return e.msg=XR[t],t},TN=function(e){return(e<<1)-(e>4?9:0)},CN=function(e){for(var t=e.length;--t>=0;)e[t]=0},EN=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},PN=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},LN=function(e,t){QR(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,PN(e.strm)},AN=function(e,t){e.pending_buf[e.pending++]=t},IN=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},RN=function(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),n),1===e.state.wrap?e.adler=GR(e.adler,t,r,n):2===e.state.wrap&&(e.adler=ZR(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)},NN=function(e,t){var n,i,r=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-xN?e.strstart-(e.w_size-xN):0,l=e.window,c=e.w_mask,h=e.prev,d=e.strstart+bN,f=l[a+o-1],p=l[a+o];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+o]===p&&l[n+o-1]===f&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<d);if(i=bN-(d-a),a=d-bN,i>o){if(e.match_start=t,o=i,i>=s)break;f=l[a+o-1],p=l[a+o]}}}while((t=h[t&c])>u&&0!==--r);return o<=e.lookahead?o:e.lookahead},DN=function(e){var t,n,i,r,a,o=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-xN)){e.window.set(e.window.subarray(o,o+o),0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=o?i-o:0}while(--n);t=n=o;do{i=e.prev[--t],e.prev[t]=i>=o?i-o:0}while(--n);r+=o}if(0===e.strm.avail_in)break;if(n=RN(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=EN(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=EN(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<xN&&0!==e.strm.avail_in)},ON=function(e,t){for(var n,i;;){if(e.lookahead<xN){if(DN(e),e.lookahead<xN&&t===nN)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=EN(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-xN&&(e.match_length=NN(e,n)),e.match_length>=3)if(i=eN(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=EN(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=EN(e,e.ins_h,e.window[e.strstart+1]);else i=eN(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(LN(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===aN?(LN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LN(e,!1),0===e.strm.avail_out)?1:2},zN=function(e,t){for(var n,i,r;;){if(e.lookahead<xN){if(DN(e),e.lookahead<xN&&t===nN)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=EN(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-xN&&(e.match_length=NN(e,n),e.match_length<=5&&(e.strategy===fN||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=eN(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=EN(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(LN(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=eN(e,0,e.window[e.strstart-1]))&&LN(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=eN(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===aN?(LN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LN(e,!1),0===e.strm.avail_out)?1:2};function FN(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}var BN=[new FN(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(DN(e),0===e.lookahead&&t===nN)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,LN(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-xN&&(LN(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aN?(LN(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(LN(e,!1),e.strm.avail_out),1)})),new FN(4,4,8,4,ON),new FN(4,5,16,8,ON),new FN(4,6,32,32,ON),new FN(4,4,16,16,zN),new FN(8,16,32,32,zN),new FN(8,16,128,128,zN),new FN(8,32,128,256,zN),new FN(32,128,258,1024,zN),new FN(32,258,258,4096,zN)];function $N(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=yN,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),CN(this.dyn_ltree),CN(this.dyn_dtree),CN(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),CN(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),CN(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var jN=function(e){if(!e||!e.state)return MN(e,lN);e.total_in=e.total_out=0,e.data_type=_N;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:kN,e.adler=2===t.wrap?0:1,t.last_flush=nN,KR(t),sN},UN=function(e){var t,n=jN(e);return n===sN&&((t=e.state).window_size=2*t.w_size,CN(t.head),t.max_lazy_match=BN[t.level].max_lazy,t.good_match=BN[t.level].good_length,t.nice_match=BN[t.level].nice_length,t.max_chain_length=BN[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n},VN=function(e,t,n,i,r,a){if(!e)return lN;var o=1;if(t===dN&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==yN||i<8||i>15||t<0||t>9||a<0||a>mN)return MN(e,lN);8===i&&(i=9);var s=new $N;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,UN(e)},HN=function(e,t){var n,i;if(!e||!e.state||t>oN||t<0)return e?MN(e,lN):lN;var r=e.state;if(!e.output||!e.input&&0!==e.avail_in||r.status===SN&&t!==aN)return MN(e,0===e.avail_out?hN:lN);r.strm=e;var a=r.last_flush;if(r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,AN(r,31),AN(r,139),AN(r,8),r.gzhead?(AN(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),AN(r,255&r.gzhead.time),AN(r,r.gzhead.time>>8&255),AN(r,r.gzhead.time>>16&255),AN(r,r.gzhead.time>>24&255),AN(r,9===r.level?2:r.strategy>=pN||r.level<2?4:0),AN(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(AN(r,255&r.gzhead.extra.length),AN(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=ZR(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(AN(r,0),AN(r,0),AN(r,0),AN(r,0),AN(r,0),AN(r,9===r.level?2:r.strategy>=pN||r.level<2?4:0),AN(r,3),r.status=kN);else{var o=yN+(r.w_bits-8<<4)<<8;o|=(r.strategy>=pN||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(o|=32),o+=31-o%31,r.status=kN,IN(r,o),0!==r.strstart&&(IN(r,e.adler>>>16),IN(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(e.adler=ZR(e.adler,r.pending_buf,r.pending-n,n)),PN(e),n=r.pending,r.pending!==r.pending_buf_size));)AN(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(e.adler=ZR(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=ZR(e.adler,r.pending_buf,r.pending-n,n)),PN(e),n=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,AN(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>n&&(e.adler=ZR(e.adler,r.pending_buf,r.pending-n,n)),0===i&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=ZR(e.adler,r.pending_buf,r.pending-n,n)),PN(e),n=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,AN(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>n&&(e.adler=ZR(e.adler,r.pending_buf,r.pending-n,n)),0===i&&(r.status=wN)}else r.status=wN;if(r.status===wN&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&PN(e),r.pending+2<=r.pending_buf_size&&(AN(r,255&e.adler),AN(r,e.adler>>8&255),e.adler=0,r.status=kN)):r.status=kN),0!==r.pending){if(PN(e),0===e.avail_out)return r.last_flush=-1,sN}else if(0===e.avail_in&&TN(t)<=TN(a)&&t!==aN)return MN(e,hN);if(r.status===SN&&0!==e.avail_in)return MN(e,hN);if(0!==e.avail_in||0!==r.lookahead||t!==nN&&r.status!==SN){var s=r.strategy===pN?function(e,t){for(var n;;){if(0===e.lookahead&&(DN(e),0===e.lookahead)){if(t===nN)return 1;break}if(e.match_length=0,n=eN(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(LN(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aN?(LN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LN(e,!1),0===e.strm.avail_out)?1:2}(r,t):r.strategy===vN?function(e,t){for(var n,i,r,a,o=e.window;;){if(e.lookahead<=bN){if(DN(e),e.lookahead<=bN&&t===nN)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[r=e.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){a=e.strstart+bN;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<a);e.match_length=bN-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=eN(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=eN(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(LN(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aN?(LN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(LN(e,!1),0===e.strm.avail_out)?1:2}(r,t):BN[r.level].func(r,t);if(3!==s&&4!==s||(r.status=SN),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),sN;if(2===s&&(t===iN?tN(r):t!==oN&&(JR(r,0,0,!1),t===rN&&(CN(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),PN(e),0===e.avail_out))return r.last_flush=-1,sN}return t!==aN?sN:r.wrap<=0?uN:(2===r.wrap?(AN(r,255&e.adler),AN(r,e.adler>>8&255),AN(r,e.adler>>16&255),AN(r,e.adler>>24&255),AN(r,255&e.total_in),AN(r,e.total_in>>8&255),AN(r,e.total_in>>16&255),AN(r,e.total_in>>24&255)):(IN(r,e.adler>>>16),IN(r,65535&e.adler)),PN(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?sN:uN)},WN={deflateInit:function(e,t){return VN(e,t,yN,15,8,gN)},deflateInit2:VN,deflateReset:UN,deflateResetKeep:jN,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?lN:(e.state.gzhead=t,sN):lN},deflate:HN,deflateEnd:function(e){if(!e||!e.state)return lN;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==wN&&t!==kN&&t!==SN?MN(e,lN):(e.state=null,t===kN?MN(e,cN):sN)},deflateSetDictionary:function(e,t){var n=t.length;if(!e||!e.state)return lN;var i=e.state,r=i.wrap;if(2===r||1===r&&42!==i.status||i.lookahead)return lN;if(1===r&&(e.adler=GR(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){0===r&&(CN(i.head),i.strstart=0,i.block_start=0,i.insert=0);var a=new Uint8Array(i.w_size);a.set(t.subarray(n-i.w_size,n),0),t=a,n=i.w_size}var o=e.avail_in,s=e.next_in,u=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,DN(i);i.lookahead>=3;){var l=i.strstart,c=i.lookahead-2;do{i.ins_h=EN(i,i.ins_h,i.window[l+3-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++}while(--c);i.strstart=l,i.lookahead=2,DN(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=s,e.input=u,e.avail_in=o,i.wrap=r,sN},deflateInfo:"pako deflate (from Nodeca project)"},GN=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},qN=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var i in n)GN(n,i)&&(e[i]=n[i])}}return e},ZN=function(e){for(var t=0,n=0,i=e.length;n<i;n++)t+=e[n].length;for(var r=new Uint8Array(t),a=0,o=0,s=e.length;a<s;a++){var u=e[a];r.set(u,o),o+=u.length}return r},XN=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Dz){XN=!1}for(var YN=new Uint8Array(256),KN=0;KN<256;KN++)YN[KN]=KN>=252?6:KN>=248?5:KN>=240?4:KN>=224?3:KN>=192?2:1;YN[254]=YN[254]=1;var JN=function(e){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,i,r,a,o=e.length,s=0;for(r=0;r<o;r++)55296===(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320===(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,r=0;a<s;r++)55296===(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320===(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},QN=function(e,t){var n,i,r=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*r);for(i=0,n=0;n<r;){var o=e[n++];if(o<128)a[i++]=o;else{var s=YN[o];if(s>4)a[i++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<r;)o=o<<6|63&e[n++],s--;s>1?a[i++]=65533:o<65536?a[i++]=o:(o-=65536,a[i++]=55296|o>>10&1023,a[i++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&XN)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}(a,i)},eD=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+YN[e[n]]>t?n:t};var tD=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},nD=Object.prototype.toString,iD=YR.Z_NO_FLUSH,rD=YR.Z_SYNC_FLUSH,aD=YR.Z_FULL_FLUSH,oD=YR.Z_FINISH,sD=YR.Z_OK,uD=YR.Z_STREAM_END,lD=YR.Z_DEFAULT_COMPRESSION,cD=YR.Z_DEFAULT_STRATEGY,hD=YR.Z_DEFLATED;function dD(e){this.options=qN({level:lD,method:hD,chunkSize:16384,windowBits:15,memLevel:8,strategy:cD},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tD,this.strm.avail_out=0;var n=WN.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==sD)throw new Error(XR[n]);if(t.header&&WN.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"===typeof t.dictionary?JN(t.dictionary):"[object ArrayBuffer]"===nD.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=WN.deflateSetDictionary(this.strm,i))!==sD)throw new Error(XR[n]);this._dict_set=!0}}dD.prototype.push=function(e,t){var n,i,r=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(i=t===~~t?t:!0===t?oD:iD,"string"===typeof e?r.input=JN(e):"[object ArrayBuffer]"===nD.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(i===rD||i===aD)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if((n=WN.deflate(r,i))===uD)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=WN.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===sD;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},dD.prototype.onData=function(e){this.chunks.push(e)},dD.prototype.onEnd=function(e){e===sD&&(this.result=ZN(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var fD=function(e,t){var n,i,r,a,o,s,u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S,M,T=e.state;n=e.next_in,S=e.input,i=n+(e.avail_in-5),r=e.next_out,M=e.output,a=r-(t-e.avail_out),o=r+(e.avail_out-257),s=T.dmax,u=T.wsize,l=T.whave,c=T.wnext,h=T.window,d=T.hold,f=T.bits,p=T.lencode,v=T.distcode,m=(1<<T.lenbits)-1,g=(1<<T.distbits)-1;e:do{f<15&&(d+=S[n++]<<f,f+=8,d+=S[n++]<<f,f+=8),_=p[d&m];t:for(;;){if(d>>>=y=_>>>24,f-=y,0===(y=_>>>16&255))M[r++]=65535&_;else{if(!(16&y)){if(0===(64&y)){_=p[(65535&_)+(d&(1<<y)-1)];continue t}if(32&y){T.mode=12;break e}e.msg="invalid literal/length code",T.mode=30;break e}b=65535&_,(y&=15)&&(f<y&&(d+=S[n++]<<f,f+=8),b+=d&(1<<y)-1,d>>>=y,f-=y),f<15&&(d+=S[n++]<<f,f+=8,d+=S[n++]<<f,f+=8),_=v[d&g];n:for(;;){if(d>>>=y=_>>>24,f-=y,!(16&(y=_>>>16&255))){if(0===(64&y)){_=v[(65535&_)+(d&(1<<y)-1)];continue n}e.msg="invalid distance code",T.mode=30;break e}if(x=65535&_,f<(y&=15)&&(d+=S[n++]<<f,(f+=8)<y&&(d+=S[n++]<<f,f+=8)),(x+=d&(1<<y)-1)>s){e.msg="invalid distance too far back",T.mode=30;break e}if(d>>>=y,f-=y,x>(y=r-a)){if((y=x-y)>l&&T.sane){e.msg="invalid distance too far back",T.mode=30;break e}if(w=0,k=h,0===c){if(w+=u-y,y<b){b-=y;do{M[r++]=h[w++]}while(--y);w=r-x,k=M}}else if(c<y){if(w+=u+c-y,(y-=c)<b){b-=y;do{M[r++]=h[w++]}while(--y);if(w=0,c<b){b-=y=c;do{M[r++]=h[w++]}while(--y);w=r-x,k=M}}}else if(w+=c-y,y<b){b-=y;do{M[r++]=h[w++]}while(--y);w=r-x,k=M}for(;b>2;)M[r++]=k[w++],M[r++]=k[w++],M[r++]=k[w++],b-=3;b&&(M[r++]=k[w++],b>1&&(M[r++]=k[w++]))}else{w=r-x;do{M[r++]=M[w++],M[r++]=M[w++],M[r++]=M[w++],b-=3}while(b>2);b&&(M[r++]=M[w++],b>1&&(M[r++]=M[w++]))}break}}break}}while(n<i&&r<o);n-=b=f>>3,d&=(1<<(f-=b<<3))-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<o?o-r+257:257-(r-o),T.hold=d,T.bits=f},pD=15,vD=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mD=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gD=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_D=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),yD=function(e,t,n,i,r,a,o,s){var u,l,c,h,d,f,p,v,m,g=s.bits,_=0,y=0,b=0,x=0,w=0,k=0,S=0,M=0,T=0,C=0,E=null,P=0,L=new Uint16Array(16),A=new Uint16Array(16),I=null,R=0;for(_=0;_<=pD;_++)L[_]=0;for(y=0;y<i;y++)L[t[n+y]]++;for(w=g,x=pD;x>=1&&0===L[x];x--);if(w>x&&(w=x),0===x)return r[a++]=20971520,r[a++]=20971520,s.bits=1,0;for(b=1;b<x&&0===L[b];b++);for(w<b&&(w=b),M=1,_=1;_<=pD;_++)if(M<<=1,(M-=L[_])<0)return-1;if(M>0&&(0===e||1!==x))return-1;for(A[1]=0,_=1;_<pD;_++)A[_+1]=A[_]+L[_];for(y=0;y<i;y++)0!==t[n+y]&&(o[A[t[n+y]]++]=y);if(0===e?(E=I=o,f=19):1===e?(E=vD,P-=257,I=mD,R-=257,f=256):(E=gD,I=_D,f=-1),C=0,y=0,_=b,d=a,k=w,S=0,c=-1,h=(T=1<<w)-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){p=_-S,o[y]<f?(v=0,m=o[y]):o[y]>f?(v=I[R+o[y]],m=E[P+o[y]]):(v=96,m=0),u=1<<_-S,b=l=1<<k;do{r[d+(C>>S)+(l-=u)]=p<<24|v<<16|m|0}while(0!==l);for(u=1<<_-1;C&u;)u>>=1;if(0!==u?(C&=u-1,C+=u):C=0,y++,0===--L[_]){if(_===x)break;_=t[n+o[y]]}if(_>w&&(C&h)!==c){for(0===S&&(S=w),d+=b,M=1<<(k=_-S);k+S<x&&!((M-=L[k+S])<=0);)k++,M<<=1;if(T+=1<<k,1===e&&T>852||2===e&&T>592)return 1;r[c=C&h]=w<<24|k<<16|d-a|0}}return 0!==C&&(r[d+C]=_-S<<24|64<<16|0),s.bits=w,0},bD=YR.Z_FINISH,xD=YR.Z_BLOCK,wD=YR.Z_TREES,kD=YR.Z_OK,SD=YR.Z_STREAM_END,MD=YR.Z_NEED_DICT,TD=YR.Z_STREAM_ERROR,CD=YR.Z_DATA_ERROR,ED=YR.Z_MEM_ERROR,PD=YR.Z_BUF_ERROR,LD=YR.Z_DEFLATED,AD=12,ID=30,RD=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function ND(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var DD,OD,zD=function(e){if(!e||!e.state)return TD;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,kD},FD=function(e){if(!e||!e.state)return TD;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,zD(e)},BD=function(e,t){var n;if(!e||!e.state)return TD;var i=e.state;return t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?TD:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,FD(e))},$D=function(e,t){if(!e)return TD;var n=new ND;e.state=n,n.window=null;var i=BD(e,t);return i!==kD&&(e.state=null),i},jD=!0,UD=function(e){if(jD){DD=new Int32Array(512),OD=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(yD(1,e.lens,0,288,DD,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;yD(2,e.lens,0,32,OD,0,e.work,{bits:5}),jD=!1}e.lencode=DD,e.lenbits=9,e.distcode=OD,e.distbits=5},VD=function(e,t,n,i){var r,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):((r=a.wsize-a.wnext)>i&&(r=i),a.window.set(t.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(t.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},HD=function(e,t){var n,i,r,a,o,s,u,l,c,h,d,f,p,v,m,g,_,y,b,x,w,k,S,M,T=0,C=new Uint8Array(4),E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return TD;(n=e.state).mode===AD&&(n.mode=13),o=e.next_out,r=e.output,u=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,l=n.hold,c=n.bits,h=s,d=u,k=kD;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(2&n.wrap&&35615===l){n.check=0,C[0]=255&l,C[1]=l>>>8&255,n.check=ZR(n.check,C,2,0),l=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=ID;break}if((15&l)!==LD){e.msg="unknown compression method",n.mode=ID;break}if(c-=4,w=8+(15&(l>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=ID;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=512&l?10:AD,l=0,c=0;break;case 2:for(;c<16;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(n.flags=l,(255&n.flags)!==LD){e.msg="unknown compression method",n.mode=ID;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ID;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(C[0]=255&l,C[1]=l>>>8&255,n.check=ZR(n.check,C,2,0)),l=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}n.head&&(n.head.time=l),512&n.flags&&(C[0]=255&l,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,n.check=ZR(n.check,C,4,0)),l=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(C[0]=255&l,C[1]=l>>>8&255,n.check=ZR(n.check,C,2,0)),l=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(C[0]=255&l,C[1]=l>>>8&255,n.check=ZR(n.check,C,2,0)),l=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((f=n.length)>s&&(f=s),f&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+f),w)),512&n.flags&&(n.check=ZR(n.check,i,f,a)),s-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;f=0;do{w=i[a+f++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&f<s);if(512&n.flags&&(n.check=ZR(n.check,i,f,a)),s-=f,a+=f,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;f=0;do{w=i[a+f++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&f<s);if(512&n.flags&&(n.check=ZR(n.check,i,f,a)),s-=f,a+=f,w)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ID;break}l=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=AD;break;case 10:for(;c<32;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}e.adler=n.check=RD(l),l=0,c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=c,MD;e.adler=n.check=1,n.mode=AD;case AD:if(t===xD||t===wD)break e;case 13:if(n.last){l>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}switch(n.last=1&l,c-=1,3&(l>>>=1)){case 0:n.mode=14;break;case 1:if(UD(n),n.mode=20,t===wD){l>>>=2,c-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=ID}l>>>=2,c-=2;break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if((65535&l)!==(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ID;break}if(n.length=65535&l,l=0,c=0,n.mode=15,t===wD)break e;case 15:n.mode=16;case 16:if(f=n.length){if(f>s&&(f=s),f>u&&(f=u),0===f)break e;r.set(i.subarray(a,a+f),o),s-=f,a+=f,u-=f,o+=f,n.length-=f;break}n.mode=AD;break;case 17:for(;c<14;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(n.nlen=257+(31&l),l>>>=5,c-=5,n.ndist=1+(31&l),l>>>=5,c-=5,n.ncode=4+(15&l),l>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ID;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}n.lens[E[n.have++]]=7&l,l>>>=3,c-=3}for(;n.have<19;)n.lens[E[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},k=yD(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,k){e.msg="invalid code lengths set",n.mode=ID;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;g=(T=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&T,!((m=T>>>24)<=c);){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(_<16)l>>>=m,c-=m,n.lens[n.have++]=_;else{if(16===_){for(M=m+2;c<M;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(l>>>=m,c-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=ID;break}w=n.lens[n.have-1],f=3+(3&l),l>>>=2,c-=2}else if(17===_){for(M=m+3;c<M;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}c-=m,w=0,f=3+(7&(l>>>=m)),l>>>=3,c-=3}else{for(M=m+7;c<M;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}c-=m,w=0,f=11+(127&(l>>>=m)),l>>>=7,c-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ID;break}for(;f--;)n.lens[n.have++]=w}}if(n.mode===ID)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ID;break}if(n.lenbits=9,S={bits:n.lenbits},k=yD(1,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,k){e.msg="invalid literal/lengths set",n.mode=ID;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},k=yD(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,k){e.msg="invalid distances set",n.mode=ID;break}if(n.mode=20,t===wD)break e;case 20:n.mode=21;case 21:if(s>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=c,fD(e,d),o=e.next_out,r=e.output,u=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,l=n.hold,c=n.bits,n.mode===AD&&(n.back=-1);break}for(n.back=0;g=(T=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&T,!((m=T>>>24)<=c);){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(g&&0===(240&g)){for(y=m,b=g,x=_;g=(T=n.lencode[x+((l&(1<<y+b)-1)>>y)])>>>16&255,_=65535&T,!(y+(m=T>>>24)<=c);){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}l>>>=y,c-=y,n.back+=y}if(l>>>=m,c-=m,n.back+=m,n.length=_,0===g){n.mode=26;break}if(32&g){n.back=-1,n.mode=AD;break}if(64&g){e.msg="invalid literal/length code",n.mode=ID;break}n.extra=15&g,n.mode=22;case 22:if(n.extra){for(M=n.extra;c<M;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;g=(T=n.distcode[l&(1<<n.distbits)-1])>>>16&255,_=65535&T,!((m=T>>>24)<=c);){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(0===(240&g)){for(y=m,b=g,x=_;g=(T=n.distcode[x+((l&(1<<y+b)-1)>>y)])>>>16&255,_=65535&T,!(y+(m=T>>>24)<=c);){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}l>>>=y,c-=y,n.back+=y}if(l>>>=m,c-=m,n.back+=m,64&g){e.msg="invalid distance code",n.mode=ID;break}n.offset=_,n.extra=15&g,n.mode=24;case 24:if(n.extra){for(M=n.extra;c<M;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ID;break}n.mode=25;case 25:if(0===u)break e;if(f=d-u,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ID;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=r,p=o-n.offset,f=n.length;f>u&&(f=u),u-=f,n.length-=f;do{r[o++]=v[p++]}while(--f);0===n.length&&(n.mode=21);break;case 26:if(0===u)break e;r[o++]=n.length,u--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===s)break e;s--,l|=i[a++]<<c,c+=8}if(d-=u,e.total_out+=d,n.total+=d,d&&(e.adler=n.check=n.flags?ZR(n.check,r,d,o-d):GR(n.check,r,d,o-d)),d=u,(n.flags?l:RD(l))!==n.check){e.msg="incorrect data check",n.mode=ID;break}l=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===s)break e;s--,l+=i[a++]<<c,c+=8}if(l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ID;break}l=0,c=0}n.mode=29;case 29:k=SD;break e;case ID:k=CD;break e;case 31:return ED;default:return TD}return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=c,(n.wsize||d!==e.avail_out&&n.mode<ID&&(n.mode<27||t!==bD))&&VD(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?ZR(n.check,r,d,e.next_out-d):GR(n.check,r,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===AD?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===d||t===bD)&&k===kD&&(k=PD),k},WD={inflateReset:FD,inflateReset2:BD,inflateResetKeep:zD,inflateInit:function(e){return $D(e,15)},inflateInit2:$D,inflate:HD,inflateEnd:function(e){if(!e||!e.state)return TD;var t=e.state;return t.window&&(t.window=null),e.state=null,kD},inflateGetHeader:function(e,t){if(!e||!e.state)return TD;var n=e.state;return 0===(2&n.wrap)?TD:(n.head=t,t.done=!1,kD)},inflateSetDictionary:function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?TD:11===n.mode&&GR(1,t,i,0)!==n.check?CD:VD(e,t,i,i)?(n.mode=31,ED):(n.havedict=1,kD):TD},inflateInfo:"pako inflate (from Nodeca project)"};var GD=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},qD=Object.prototype.toString,ZD=YR.Z_NO_FLUSH,XD=YR.Z_FINISH,YD=YR.Z_OK,KD=YR.Z_STREAM_END,JD=YR.Z_NEED_DICT,QD=YR.Z_STREAM_ERROR,eO=YR.Z_DATA_ERROR,tO=YR.Z_MEM_ERROR;function nO(e){this.options=qN({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tD,this.strm.avail_out=0;var n=WD.inflateInit2(this.strm,t.windowBits);if(n!==YD)throw new Error(XR[n]);if(this.header=new GD,WD.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=JN(t.dictionary):"[object ArrayBuffer]"===qD.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=WD.inflateSetDictionary(this.strm,t.dictionary))!==YD))throw new Error(XR[n])}function iO(e,t){var n=new nO(t);if(n.push(e),n.err)throw n.msg||XR[n.err];return n.result}nO.prototype.push=function(e,t){var n,i,r,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(i=t===~~t?t:!0===t?XD:ZD,"[object ArrayBuffer]"===qD.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),(n=WD.inflate(a,i))===JD&&s&&((n=WD.inflateSetDictionary(a,s))===YD?n=WD.inflate(a,i):n===eO&&(n=JD));a.avail_in>0&&n===KD&&a.state.wrap>0&&0!==e[a.next_in];)WD.inflateReset(a),n=WD.inflate(a,i);switch(n){case QD:case eO:case JD:case tO:return this.onEnd(n),this.ended=!0,!1}if(r=a.avail_out,a.next_out&&(0===a.avail_out||n===KD))if("string"===this.options.to){var u=eD(a.output,a.next_out),l=a.next_out-u,c=QN(a.output,u);a.next_out=l,a.avail_out=o-l,l&&a.output.set(a.output.subarray(u,u+l),0),this.onData(c)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==YD||0!==r){if(n===KD)return n=WD.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},nO.prototype.onData=function(e){this.chunks.push(e)},nO.prototype.onEnd=function(e){e===YD&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ZN(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rO={Inflate:nO,inflate:iO,inflateRaw:function(e,t){return(t=t||{}).raw=!0,iO(e,t)},ungzip:iO,constants:YR},aO=rO.inflate,oO={read:function(e,t,n,i,r){var a,o,s=8*r-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?r-1:0,d=n?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=l}return(f?-1:1)*o*Math.pow(2,a-i)},write:function(e,t,n,i,r,a){var o,s,u,l=8*a-r-1,c=(1<<l)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,p=i?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?d/u:d*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*u-1)*Math.pow(2,r),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&s,f+=p,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;e[n+f]=255&o,f+=p,o/=256,l-=8);e[n+f-p]|=128*v}},sO=lO,uO=oO;function lO(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}lO.Varint=0,lO.Fixed64=1,lO.Bytes=2,lO.Fixed32=5;var cO=4294967296,hO=1/cO,dO="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function fO(e){return e.type===lO.Bytes?e.readVarint()+e.pos:e.pos+1}function pO(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function vO(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function mO(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function gO(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function _O(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function yO(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function bO(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function xO(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function wO(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function kO(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function SO(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function MO(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function TO(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function CO(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function EO(e,t){return PO(e,"GET","arraybuffer",[],null,t)}function PO(e,t,n,i,r,a){var o=new XMLHttpRequest,s=new Promise((function(a,s){o.open(t,e,!0);var u,l=Pd(i);try{for(l.s();!(u=l.n()).done;){var c=u.value;o.setRequestHeader(c.name,c.value)}}catch(MN){l.e(MN)}finally{l.f()}o.responseType=n,o.timeout=15e3,o.onload=function(){var t;if(200!==o.status){var n=null!==(t=o.response)&&void 0!==t?t:new VM("Response status error: ".concat(e));s(n)}o.response||s(new VM("Response empty: ".concat(e))),a(o.response)},o.onerror=function(){s(new VM("Request error: ".concat(e)))},o.ontimeout=function(){s(new VM("Request timeout: ".concat(e)))},o.onabort=function(){s(new VM("Request aborted: ".concat(e)))},o.send("POST"===t?r:null)}));return a&&a.catch((function(){o.abort()})),s}function LO(e,t,n){1===e?t.vertices.push(n.readFloat()):2===e?t.faces.push(n.readVarint()):console.warn("Unsupported pbf tag (".concat(e,")"))}lO.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,e(r,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=MO(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=CO(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=MO(this.buf,this.pos)+MO(this.buf,this.pos+4)*cO;return this.pos+=8,e},readSFixed64:function(){var e=MO(this.buf,this.pos)+CO(this.buf,this.pos+4)*cO;return this.pos+=8,e},readFloat:function(){var e=uO.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=uO.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,a=n.buf;if(r=a[n.pos++],i=(112&r)>>4,r<128)return pO(e,i,t);if(r=a[n.pos++],i|=(127&r)<<3,r<128)return pO(e,i,t);if(r=a[n.pos++],i|=(127&r)<<10,r<128)return pO(e,i,t);if(r=a[n.pos++],i|=(127&r)<<17,r<128)return pO(e,i,t);if(r=a[n.pos++],i|=(127&r)<<24,r<128)return pO(e,i,t);if(r=a[n.pos++],i|=(1&r)<<31,r<128)return pO(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&dO?function(e,t,n){return dO.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var i="",r=t;for(;r<n;){var a,o,s,u=e[r],l=null,c=u>239?4:u>223?3:u>191?2:1;if(r+c>n)break;1===c?u<128&&(l=u):2===c?128===(192&(a=e[r+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(a=e[r+1],o=e[r+2],128===(192&a)&&128===(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=e[r+1],o=e[r+2],s=e[r+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==lO.Bytes)return e.push(this.readVarint(t));var n=fO(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==lO.Bytes)return e.push(this.readSVarint());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==lO.Bytes)return e.push(this.readBoolean());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==lO.Bytes)return e.push(this.readFloat());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==lO.Bytes)return e.push(this.readDouble());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==lO.Bytes)return e.push(this.readFixed32());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==lO.Bytes)return e.push(this.readSFixed32());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==lO.Bytes)return e.push(this.readFixed64());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==lO.Bytes)return e.push(this.readSFixed64());var t=fO(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===lO.Varint)for(;this.buf[this.pos++]>127;);else if(t===lO.Bytes)this.pos=this.readVarint()+this.pos;else if(t===lO.Fixed32)this.pos+=4;else{if(t!==lO.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),TO(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),TO(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),TO(this.buf,-1&e,this.pos),TO(this.buf,Math.floor(e*hO),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),TO(this.buf,-1&e,this.pos),TO(this.buf,Math.floor(e*hO),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,a=0;a<t.length;a++){if((i=t.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&vO(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),uO.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),uO.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&vO(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,lO.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,mO,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,gO,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,bO,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,_O,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,yO,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,xO,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,wO,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,kO,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,SO,t)},writeBytesField:function(e,t){this.writeTag(e,lO.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,lO.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,lO.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,lO.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,lO.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,lO.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,lO.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,lO.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,lO.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,lO.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var AO,IO=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this))._geometry=e,i}return $d(n,[{key:"geometry",get:function(){return this._geometry}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"getCoreImages",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getCluster",value:function(e,t){return Promise.reject(new VM("Not implemented"))}},{key:"getSpatialImages",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getImages",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getImageBuffer",value:function(e,t){return Promise.reject(new VM("Not implemented"))}},{key:"getImageTiles",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"getMesh",value:function(e,t){return Promise.reject(new VM("Not implemented"))}},{key:"getSequence",value:function(e){return Promise.reject(new VM("Not implemented"))}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"setAccessToken",value:function(e){throw new VM("Not implemented")}}]),n}(yP),RO=function(){function e(){Fd(this,e)}return $d(e,[{key:"bboxToCellIds",value:function(e,t){throw new VM("Not implemented")}},{key:"getAdjacent",value:function(e){throw new VM("Not implemented")}},{key:"getVertices",value:function(e){throw new VM("Not implemented")}},{key:"lngLatToCellId",value:function(e){throw new VM("Not implemented")}},{key:"_approxBboxToCellIds",value:function(e,t){if(t.lat<=e.lat||t.lng<=e.lng)throw new VM("North east needs to be top right of south west");var n=(e.lat+t.lat)/2,i=(e.lng+t.lng)/2,r=IM(t.lng,t.lat,0,i,n,0),a=Math.max(r[0],r[1]);return this._lngLatToCellIds({lat:n,lng:i},a)}},{key:"_enuToGeodetic",value:function(e,t){var n=s(RM(e[0],e[1],e[2],t.lng,t.lat,0),2),i=n[0];return{lat:n[1],lng:i}}},{key:"_getLngLatBoundingBoxCorners",value:function(e,t){var n=this;return[[-t,t,0],[t,t,0],[t,-t,0],[-t,-t,0]].map((function(t){return n._enuToGeodetic(t,e)}))}},{key:"_lngLatToCellIds",value:function(e,t){var n,i=this.lngLatToCellId(e),r=Pd(this._getLngLatBoundingBoxCorners(e,t));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(this.lngLatToCellId(a)!==i)return[i].concat(wd(this.getAdjacent(i)))}}catch(MN){r.e(MN)}finally{r.f()}return[i]}}]),e}(),NO={exports:{}},DO={exports:{}};AO=DO,function(e,t){AO&&AO.exports?AO.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(xT,(function(){function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var n={},i={};function r(e,t){var r,a,s;return t?(s=0<=(e>>>=0)&&e<256)&&(a=i[e])?a:(r=o(e,(0|e)<0?-1:0,!0),s&&(i[e]=r),r):(s=-128<=(e|=0)&&e<128)&&(a=n[e])?a:(r=o(e,e<0?-1:0,!1),s&&(n[e]=r),r)}function a(e,t){if(isNaN(e)||!isFinite(e))return t?v:p;if(t){if(e<0)return v;if(e>=h)return b}else{if(e<=-d)return x;if(e+1>=d)return y}return e<0?a(-e,t).neg():o(e%c|0,e/c|0,t)}function o(t,n,i){return new e(t,n,i)}e.fromInt=r,e.fromNumber=a,e.fromBits=o;var s=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(e.substring(1),t,n).neg();for(var r=a(s(n,8)),o=p,l=0;l<e.length;l+=8){var c=Math.min(8,e.length-l),h=parseInt(e.substring(l,l+c),n);if(c<8){var d=a(s(n,c));o=o.mul(d).add(a(h))}else o=(o=o.mul(r)).add(a(h))}return o.unsigned=t,o}function l(t){return t instanceof e?t:"number"===typeof t?a(t):"string"===typeof t?u(t):o(t.low,t.high,t.unsigned)}e.fromString=u,e.fromValue=l;var c=4294967296,h=c*c,d=h/2,f=r(1<<24),p=r(0);e.ZERO=p;var v=r(0,!0);e.UZERO=v;var m=r(1);e.ONE=m;var g=r(1,!0);e.UONE=g;var _=r(-1);e.NEG_ONE=_;var y=o(-1,2147483647,!1);e.MAX_VALUE=y;var b=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=b;var x=o(0,-2147483648,!1);e.MIN_VALUE=x;var w=e.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},w.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var t=a(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=a(s(e,6),this.unsigned),o=this,u="";;){var l=o.div(r),c=(o.sub(l.mul(r)).toInt()>>>0).toString(e);if((o=l).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1===(1&this.low)},w.isEven=function(){return 0===(1&this.low)},w.equals=function(e){return t(e)||(e=l(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&this.high===e.high&&this.low===e.low},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.lessThan=function(e){return this.comp(e)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return this.comp(e)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(e){return this.comp(e)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return this.comp(e)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(e){if(t(e)||(e=l(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(m)},w.neg=w.negate,w.add=function(e){t(e)||(e=l(e));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,a=65535&this.low,s=e.high>>>16,u=65535&e.high,c=e.low>>>16,h=0,d=0,f=0,p=0;return f+=(p+=a+(65535&e.low))>>>16,d+=(f+=r+c)>>>16,h+=(d+=i+u)>>>16,h+=n+s,o((f&=65535)<<16|(p&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},w.subtract=function(e){return t(e)||(e=l(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){if(this.isZero())return p;if(t(e)||(e=l(e)),e.isZero())return p;if(this.eq(x))return e.isOdd()?x:p;if(e.eq(x))return this.isOdd()?x:p;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return a(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,u=e.high>>>16,c=65535&e.high,h=e.low>>>16,d=65535&e.low,v=0,m=0,g=0,_=0;return g+=(_+=s*d)>>>16,m+=(g+=r*d)>>>16,g&=65535,m+=(g+=s*h)>>>16,v+=(m+=i*d)>>>16,m&=65535,v+=(m+=r*h)>>>16,m&=65535,v+=(m+=s*c)>>>16,v+=n*d+i*h+r*c+s*u,o((g&=65535)<<16|(_&=65535),(v&=65535)<<16|(m&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(e){if(t(e)||(e=l(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?v:p;var n,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return g;r=v}else{if(this.eq(x))return e.eq(m)||e.eq(_)?x:e.eq(x)?m:(n=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?m:_:(i=this.sub(e.mul(n)),r=n.add(i.div(e)));if(e.eq(x))return this.unsigned?v:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=p}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:s(2,o-48),c=a(n),h=c.mul(e);h.isNegative()||h.gt(i);)h=(c=a(n-=u,this.unsigned)).mul(e);c.isZero()&&(c=m),r=r.add(c),i=i.sub(h)}return r},w.div=w.divide,w.modulo=function(e){return t(e)||(e=l(e)),this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(e){return t(e)||(e=l(e)),o(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return t(e)||(e=l(e)),o(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return t(e)||(e=l(e)),o(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?o(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):o(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?o(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):o(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var n=this.high;return e<32?o(this.low>>>e|n<<32-e,n>>>e,this.unsigned):o(32===e?n:n>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})),function(e){!function(e){var t=e.S2={L:{}};t.L.LatLng=function(e,t,n){var i=parseFloat(e,10),r=parseFloat(t,10);if(isNaN(i)||isNaN(r))throw new Error("Invalid LatLng object: ("+e+", "+t+")");return!0!==n&&(i=Math.max(Math.min(i,90),-90),r=(r+180)%360+(r<-180||180===r?180:-180)),{lat:i,lng:r}},t.L.LatLng.DEG_TO_RAD=Math.PI/180,t.L.LatLng.RAD_TO_DEG=180/Math.PI,t.LatLngToXYZ=function(e){var n=t.L.LatLng.DEG_TO_RAD,i=e.lat*n,r=e.lng*n,a=Math.cos(i);return[Math.cos(r)*a,Math.sin(r)*a,Math.sin(i)]},t.XYZToLatLng=function(e){var n=t.L.LatLng.RAD_TO_DEG,i=Math.atan2(e[2],Math.sqrt(e[0]*e[0]+e[1]*e[1])),r=Math.atan2(e[1],e[0]);return t.L.LatLng(i*n,r*n)};t.XYZToFaceUV=function(e){var t=function(e){var t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t[0]>t[1]?t[0]>t[2]?0:2:t[1]>t[2]?1:2}(e);e[t]<0&&(t+=3);var n=function(e,t){var n,i;switch(e){case 0:n=t[1]/t[0],i=t[2]/t[0];break;case 1:n=-t[0]/t[1],i=t[2]/t[1];break;case 2:n=-t[0]/t[2],i=-t[1]/t[2];break;case 3:n=t[2]/t[0],i=t[1]/t[0];break;case 4:n=t[2]/t[1],i=-t[0]/t[1];break;case 5:n=-t[1]/t[2],i=-t[0]/t[2];break;default:throw{error:"Invalid face"}}return[n,i]}(t,e);return[t,n]},t.FaceUVToXYZ=function(e,t){var n=t[0],i=t[1];switch(e){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw{error:"Invalid face"}}};var n=function(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))};t.STToUV=function(e){return[n(e[0]),n(e[1])]};var i=function(e){return e>=0?.5*Math.sqrt(1+3*e):1-.5*Math.sqrt(1-3*e)};t.UVToST=function(e){return[i(e[0]),i(e[1])]},t.STToIJ=function(e,t){var n=1<<t,i=function(e){var t=Math.floor(e*n);return Math.max(0,Math.min(n-1,t))};return[i(e[0]),i(e[1])]},t.IJToST=function(e,t,n){var i=1<<t;return[(e[0]+n[0])/i,(e[1]+n[1])/i]};var r=function(e,t,n,i){if(0==i){1==n&&(t.x=e-1-t.x,t.y=e-1-t.y);var r=t.x;t.x=t.y,t.y=r}},a=function(e,t,n,i){var r={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};"number"!==typeof i&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var a=i%2?"d":"a",o=[],s=n-1;s>=0;s--){var u=1<<s,l=r[a][2*(e&u?1:0)+(t&u?1:0)];o.push(l[0]),a=l[1]}return o};t.S2Cell=function(){},t.S2Cell.FromHilbertQuadKey=function(e){var n,i,a,o,s,u,l=e.split("/"),c=parseInt(l[0]),h=l[1],d=h.length,f={x:0,y:0};for(n=d-1;n>=0;n--)i=d-n,o=0,s=0,"1"===(a=h[n])?s=1:"2"===a?(o=1,s=1):"3"===a&&(o=1),u=Math.pow(2,i-1),r(u,f,o,s),f.x+=u*o,f.y+=u*s;if(c%2===1){var p=f.x;f.x=f.y,f.y=p}return t.S2Cell.FromFaceIJ(parseInt(c),[f.x,f.y],i)},t.S2Cell.FromLatLng=function(e,n){if(!e.lat&&0!==e.lat||!e.lng&&0!==e.lng)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var i=t.LatLngToXYZ(e),r=t.XYZToFaceUV(i),a=t.UVToST(r[1]),o=t.STToIJ(a,n);return t.S2Cell.FromFaceIJ(r[0],o,n)},t.S2Cell.FromFaceIJ=function(e,n,i){var r=new t.S2Cell;return r.face=e,r.ij=n,r.level=i,r},t.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},t.S2Cell.prototype.getLatLng=function(){var e=t.IJToST(this.ij,this.level,[.5,.5]),n=t.STToUV(e),i=t.FaceUVToXYZ(this.face,n);return t.XYZToLatLng(i)},t.S2Cell.prototype.getCornerLatLngs=function(){for(var e=[],n=[[0,0],[0,1],[1,1],[1,0]],i=0;i<4;i++){var r=t.IJToST(this.ij,this.level,n[i]),a=t.STToUV(r),o=t.FaceUVToXYZ(this.face,a);e.push(t.XYZToLatLng(o))}return e},t.S2Cell.prototype.getFaceAndQuads=function(){var e=a(this.ij[0],this.ij[1],this.level,this.face);return[this.face,e]},t.S2Cell.prototype.toHilbertQuadkey=function(){var e=a(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+e.join("")},t.latLngToNeighborKeys=t.S2Cell.latLngToNeighborKeys=function(e,n,i){return t.S2Cell.FromLatLng({lat:e,lng:n},i).getNeighbors().map((function(e){return e.toHilbertQuadkey()}))},t.S2Cell.prototype.getNeighbors=function(){var e=function(e,n,i){var r=1<<i;if(n[0]>=0&&n[1]>=0&&n[0]<r&&n[1]<r)return t.S2Cell.FromFaceIJ(e,n,i);var a=t.IJToST(n,i,[.5,.5]),o=t.STToUV(a),s=t.FaceUVToXYZ(e,o),u=t.XYZToFaceUV(s);return e=u[0],o=u[1],a=t.UVToST(o),n=t.STToIJ(a,i),t.S2Cell.FromFaceIJ(e,n,i)},n=this.face,i=this.ij[0],r=this.ij[1],a=this.level;return[e(n,[i-1,r],a),e(n,[i,r-1],a),e(n,[i+1,r],a),e(n,[i,r+1],a)]},t.FACE_BITS=3,t.MAX_LEVEL=30,t.POS_BITS=2*t.MAX_LEVEL+1,t.facePosLevelToId=t.S2Cell.facePosLevelToId=t.fromFacePosLevel=function(n,i,r){var a,o,s,u=e.dcodeIO&&e.dcodeIO.Long||DO.exports;for(r||(r=i.length),i.length>r&&(i=i.substr(0,r)),a=u.fromString(n.toString(10),!0,10).toString(2);a.length<t.FACE_BITS;)a="0"+a;for(o=u.fromString(i,!0,4).toString(2);o.length<2*r;)o="0"+o;for(s=a+o,s+="1";s.length<t.FACE_BITS+t.POS_BITS;)s+="0";return u.fromString(s,!0,2).toString(10)},t.keyToId=t.S2Cell.keyToId=t.toId=t.toCellId=t.fromKey=function(e){var n=e.split("/");return t.fromFacePosLevel(n[0],n[1],n[1].length)},t.idToKey=t.S2Cell.idToKey=t.S2Cell.toKey=t.toKey=t.fromId=t.fromCellId=t.S2Cell.toHilbertQuadkey=t.toHilbertQuadkey=function(n){for(var i=e.dcodeIO&&e.dcodeIO.Long||DO.exports,r=i.fromString(n,!0,10).toString(2);r.length<t.FACE_BITS+t.POS_BITS;)r="0"+r;for(var a=r.lastIndexOf("1"),o=r.substring(0,3),s=r.substring(3,a),u=s.length/2,l=i.fromString(o,!0,2).toString(10),c=i.fromString(s,!0,2).toString(4);c.length<u;)c="0"+c;return l+"/"+c},t.keyToLatLng=t.S2Cell.keyToLatLng=function(e){return t.S2Cell.FromHilbertQuadKey(e).getLatLng()},t.idToLatLng=t.S2Cell.idToLatLng=function(e){var n=t.idToKey(e);return t.keyToLatLng(n)},t.S2Cell.latLngToKey=t.latLngToKey=t.latLngToQuadkey=function(e,n,i){if(isNaN(i)||i<1||i>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return t.S2Cell.FromLatLng({lat:e,lng:n},i).toHilbertQuadkey()},t.stepKey=function(t,n){var i,r=e.dcodeIO&&e.dcodeIO.Long||DO.exports,a=t.split("/"),o=a[0],s=a[1],u=a[1].length,l=r.fromString(s,!0,4);n>0?i=l.add(Math.abs(n)):n<0&&(i=l.subtract(Math.abs(n)));var c=i.toString(4);for("0"===c&&console.warning(new Error("face/position wrapping is not yet supported"));c.length<u;)c="0"+c;return o+"/"+c},t.S2Cell.prevKey=t.prevKey=function(e){return t.stepKey(e,-1)},t.S2Cell.nextKey=t.nextKey=function(e){return t.stepKey(e,1)}}(e.exports)}(NO);var OO=function(e){Dd(n,e);var t=Od(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:17;return Fd(this,n),(e=t.call(this))._level=i,e}return $d(n,[{key:"bboxToCellIds",value:function(e,t){return this._approxBboxToCellIds(e,t)}},{key:"getAdjacent",value:function(e){for(var t=NO.exports.S2.idToKey(e),n=t.split("/")[1].length,i=s(this._getNeighbors(t,n),4),r=i[0],a=i[1],o=i[2],u=i[3],l=[t,r,a,o,u],c=[r,a,o,u],h=0,d=Array.from(new Set([].concat(wd(this._getNeighbors(r,n)),wd(this._getNeighbors(a,n)),wd(this._getNeighbors(o,n)),wd(this._getNeighbors(u,n))).filter((function(e){return!l.includes(e)}))));h<d.length;h++){var f,p=d[h],v=0,m=Pd(this._getNeighbors(p,n));try{for(m.s();!(f=m.n()).done;){var g=f.value;l.includes(g)&&v++}}catch(MN){m.e(MN)}finally{m.f()}2===v&&c.push(p)}return c.map((function(e){return NO.exports.S2.keyToId(e)}))}},{key:"getVertices",value:function(e){var t=NO.exports.S2.idToKey(e);return NO.exports.S2.S2Cell.FromHilbertQuadKey(t).getCornerLatLngs().map((function(e){return{lat:e.lat,lng:e.lng}}))}},{key:"lngLatToCellId",value:function(e){return this._lngLatToId(e,this._level)}},{key:"_getNeighbors",value:function(e,t){var n=NO.exports.S2.keyToLatLng(e);return NO.exports.S2.latLngToNeighborKeys(n.lat,n.lng,t)}},{key:"_lngLatToId",value:function(e,t){var n=NO.exports.S2.latLngToKey(e.lat,e.lng,t);return NO.exports.S2.keyToId(n)}}]),n}(RO);var zO=function(){function e(){Fd(this,e)}return $d(e,[{key:"clusterReconstruction",value:function(e){var t=e.points,n=1/255;for(var i in t)if(t.hasOwnProperty(i)){var r=t[i].color;r[0]*=n,r[1]*=n,r[2]*=n}var a=e.reference_lla;return{id:null,points:t,reference:{alt:a.altitude,lat:a.latitude,lng:a.longitude}}}},{key:"coreImage",value:function(e){var t=this._geometry(e.geometry),n=this._geometry(e.computed_geometry),i={id:e.sequence};return{computed_geometry:n,geometry:t,id:e.id,sequence:i}}},{key:"spatialImage",value:function(e){var t,n,i,r;e.camera_type=function(e){switch(e){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}(e.camera_type),e.merge_id=e.merge_cc?e.merge_cc.toString():null,e.private=null;var a="spherical"===e.camera_type?e.thumb_2048_url:e.thumb_1024_url;return e.thumb=null!==(t=e.thumb)&&void 0!==t?t:{id:null,url:a},e.cluster=null!==(n=e.sfm_cluster)&&void 0!==n?n:{id:null,url:null},e.creator={id:null,username:null},e.owner=null!==(i=e.owner)&&void 0!==i?i:{id:null},e.mesh=null!==(r=e.mesh)&&void 0!==r?r:{id:null,url:null},e}},{key:"_geometry",value:function(e){var t=null===e||void 0===e?void 0:e.coordinates;return t?{lat:t[1],lng:t[0]}:null}}]),e}(),FO=function(){function e(){Fd(this,e),this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","exif_orientation","height","merge_cc","mesh","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}return $d(e,[{key:"images",value:function(e,t){return"image_ids=".concat(e.join(","),"&fields=").concat(t.join(","))}},{key:"imagesS2",value:function(e,t){return"s2=".concat(e,"&fields=").concat(t.join(","))}},{key:"imageTiles",value:function(e,t){return"z=".concat(e,"&fields=").concat(t.join(","))}},{key:"imageTilesPath",value:function(e){return"".concat(e,"/").concat(this._imageTilesPath)}},{key:"sequence",value:function(e){return"sequence_id=".concat(e)}}]),e}(),BO=function(e){Dd(n,e);var t=Od(n);function n(e,i,r,a){var o,s;Fd(this,n),(o=t.call(this,null!==i&&void 0!==i?i:new OO))._convert=null!==r&&void 0!==r?r:new zO,o._query=null!==a&&void 0!==a?a:new FO,o._method="GET";var u=null!==e&&void 0!==e?e:{};return o._endpoint=null!==(s=u.endpoint)&&void 0!==s?s:"https://graph.mapillary.com",o._accessToken=u.accessToken,o}return $d(n,[{key:"getCluster",value:function(e,t){var n=this;return EO(e,t).then((function(e){var t=function(e){var t=aO(e,{to:"string"});return JSON.parse(t)}(e);if(t.length<1)throw new Error("Cluster reconstruction empty");return n._convert.clusterReconstruction(t[0])}))}},{key:"getCoreImages",value:function(e){var t=this,n=[].concat(wd(this._query.idFields),wd(this._query.coreFields)),i=this._query.imagesS2(e,n),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((function(n){var i,r={cell_id:e,images:[]},a=Pd(n.data);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=t._convert.coreImage(o);r.images.push(s)}}catch(MN){a.e(MN)}finally{a.f()}return r}))}},{key:"getImageBuffer",value:function(e,t){return EO(e,t)}},{key:"getImages",value:function(e){var t=this,n=[].concat(wd(this._query.idFields),wd(this._query.coreFields),wd(this._query.spatialFields)),i=this._query.images(e,n),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((function(e){var n,i=[],r=Pd(e.data);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=t._convert.coreImage(a),s=t._convert.spatialImage(a),u={node:Object.assign({},s,o),node_id:a.id};i.push(u)}}catch(MN){r.e(MN)}finally{r.f()}return i}))}},{key:"getImageTiles",value:function(e){var t=wd(this._query.imageTileFields),n=this._query.imageTiles(e.z,t),i=new URL(this._query.imageTilesPath(e.imageId),this._endpoint).href;return this._fetchGraphContract(n,i).then((function(t){return{node:t.data,node_id:e.imageId}}))}},{key:"getMesh",value:function(e,t){return EO(e,t).then((function(e){return function(e){return new sO(e).readFields(LO,{faces:[],vertices:[]})}(e)}))}},{key:"getSequence",value:function(e){var t=this._query.sequence(e),n=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(t,n).then((function(t){return{id:e,image_ids:t.data.map((function(e){return e.id}))}}))}},{key:"getSpatialImages",value:function(e){var t=this,n=[].concat(wd(this._query.idFields),wd(this._query.coreFields),wd(this._query.spatialFields)),i=this._query.images(e,n),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((function(e){var n,i=[],r=Pd(e.data);try{for(r.s();!(n=r.n()).done;){var a=n.value,o={node:t._convert.spatialImage(a),node_id:a.id};i.push(o)}}catch(MN){r.e(MN)}finally{r.f()}return i}))}},{key:"setAccessToken",value:function(e){this._accessToken=e}},{key:"_createHeaders",value:function(){var e=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&e.push({name:"Authorization",value:"OAuth ".concat(this._accessToken)}),e}},{key:"_fetchGraphContract",value:function(e,t){var n=this,i=this._method,r=this._createHeaders();return PO("".concat(t,"?").concat(e),i,"json",r,null,null).catch((function(e){var t=n._makeErrorMessage(e);throw new VM(t)}))}},{key:"_makeErrorMessage",value:function(e){var t=e.error;return t?"".concat(t.code," (").concat(t.type,", ").concat(t.fbtrace_id,"): ").concat(t.message):"Failed to fetch data"}}]),n}(IO);var $O,jO,UO,VO;!function(e){e[e.Custom=0]="Custom",e[e.Earth=1]="Earth",e[e.Street=2]="Street"}($O||($O={})),function(e){e[e.Letterbox=0]="Letterbox",e[e.Fill=1]="Fill"}(jO||(jO={})),function(e){e[e.Opaque=0]="Opaque"}(UO||(UO={})),function(e){e[e.Default=0]="Default",e[e.Instantaneous=1]="Instantaneous"}(VO||(VO={}));var HO,WO=function(){function e(t,n,i,r,a,o){var s=this;Fd(this,e),this._container=t,this._observer=i,this._navigator=n,this._options=null!=a?a:{},this._key=r,this._navigable=null==r,this._componentService=o||new bT(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),r?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(dv((function(e){return null!=e}))).subscribe((function(e){s._key=e,s._componentService.deactivateCover(),s._coverComponent.configure({id:s._key,state:gP.Hidden}),s._subscribeCoverComponent(),s._navigator.stateService.start(),s._navigator.cacheService.start(),s._navigator.panService.start(),s._observer.startEmit()}))}return $d(e,[{key:"navigable",get:function(){return this._navigable}},{key:"get",value:function(e){return this._componentService.get(e)}},{key:"activate",value:function(e){this._componentService.activate(e)}},{key:"activateCover",value:function(){this._coverComponent.configure({state:gP.Visible})}},{key:"deactivate",value:function(e){this._componentService.deactivate(e)}},{key:"deactivateCover",value:function(){this._coverComponent.configure({state:gP.Loading})}},{key:"remove",value:function(){this._componentService.remove(),null!=this._configurationSubscription&&this._configurationSubscription.unsubscribe()}},{key:"_initializeComponents",value:function(){var e,t,n=this._options;this._uFalse(null===(e=n.fallback)||void 0===e?void 0:e.image,"imagefallback"),this._uFalse(null===(t=n.fallback)||void 0===t?void 0:t.navigation,"navigationfallback"),this._uFalse(n.marker,"marker"),this._uFalse(n.popup,"popup"),this._uFalse(n.slider,"slider"),this._uFalse(n.spatial,"spatial"),this._uFalse(n.tag,"tag"),this._uTrue(n.attribution,"attribution"),this._uTrue(n.bearing,"bearing"),this._uTrue(n.cache,"cache"),this._uTrue(n.direction,"direction"),this._uTrue(n.image,"image"),this._uTrue(n.keyboard,"keyboard"),this._uTrue(n.pointer,"pointer"),this._uTrue(n.sequence,"sequence"),this._uTrue(n.zoom,"zoom")}},{key:"_initilizeCoverComponent",value:function(){var e=this._options;this._coverComponent.configure({id:this._key}),void 0===e.cover||e.cover?this.activateCover():this.deactivateCover()}},{key:"_setNavigable",value:function(e){this._navigable!==e&&(this._navigable=e,this._observer.navigable$.next(e))}},{key:"_subscribeCoverComponent",value:function(){var e=this;this._configurationSubscription=this._coverComponent.configuration$.pipe(ov(void 0,(function(e){return e.state}))).subscribe((function(t){t.state===gP.Loading?e._navigator.stateService.currentId$.pipe(dv(),Tv((function(n){var i=null==n||n!==t.id;return i&&e._setNavigable(!1),i?e._navigator.moveTo$(t.id):e._navigator.stateService.currentImage$.pipe(dv())}))).subscribe((function(){e._navigator.stateService.start(),e._navigator.cacheService.start(),e._navigator.panService.start(),e._observer.startEmit(),e._coverComponent.configure({state:gP.Hidden}),e._componentService.deactivateCover(),e._setNavigable(!0)}),(function(t){console.error("Failed to deactivate cover.",t),e._coverComponent.configure({state:gP.Visible})})):t.state===gP.Visible&&(e._observer.stopEmit(),e._navigator.stateService.stop(),e._navigator.cacheService.stop(),e._navigator.playService.stop(),e._navigator.panService.stop(),e._componentService.activateCover(),e._setNavigable(null==t.id))}))}},{key:"_uFalse",value:function(e,t){void 0!==e?"boolean"!==typeof e?(this._componentService.configure(t,e),this._componentService.activate(t)):e?this._componentService.activate(t):this._componentService.deactivate(t):this._componentService.deactivate(t)}},{key:"_uTrue",value:function(e,t){void 0!==e?"boolean"!==typeof e?(this._componentService.configure(t,e),this._componentService.activate(t)):e?this._componentService.activate(t):this._componentService.deactivate(t):this._componentService.activate(t)}}]),e}(),GO=function(){function e(t,n,i){Fd(this,e),this._adaptiveOperation$=new Af,this._render$=new Af,this._renderAdaptive$=new Af,this._subscriptions=new bP,this._renderService=n,this._currentFrame$=i;var r=this._subscriptions,a=_P.create(_P.h("div.mapillary-dom-renderer",[]));t.appendChild(a),this._offset$=this._adaptiveOperation$.pipe(bv((function(e,t){return t(e)}),{elementHeight:t.offsetHeight,elementWidth:t.offsetWidth,imageAspect:0,renderMode:jO.Fill}),qp((function(e){return e.imageAspect>0&&e.elementWidth>0&&e.elementHeight>0})),xp((function(e){var t=e.elementWidth/e.elementHeight,n=e.imageAspect/t,i=0,r=0;return e.renderMode===jO.Letterbox?e.imageAspect>t?i=e.elementHeight*(1-1/n)/2:r=e.elementWidth*(1-n)/2:e.imageAspect>t?r=-e.elementWidth*(n-1)/2:i=-e.elementHeight*(1/n-1)/2,{bottom:i,left:r,right:r,top:i}})));var o=this._currentFrame$.pipe(qp((function(e){return null!=e.state.currentImage})),ov((function(e,t){return e===t}),(function(e){return e.state.currentImage.id})),xp((function(e){return e.state.currentTransform.basicAspect})),xp((function(e){return function(t){return t.imageAspect=e,t}}))).subscribe(this._adaptiveOperation$),s=Lp(this._renderAdaptive$.pipe(bv((function(e,t){return null==t.vNode?delete e[t.name]:e[t.name]=t.vNode,e}),{})),this._offset$).pipe(xp((function(e){var t=[],n=e[0];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);var r=e[1],a={style:{bottom:r.bottom+"px",left:r.left+"px","pointer-events":"none",position:"absolute",right:r.right+"px",top:r.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:_P.h("div.mapillary-dom-adaptive-renderer",a,t)}}))).subscribe(this._render$);this._vNode$=this._render$.pipe(bv((function(e,t){return null==t.vNode?delete e[t.name]:e[t.name]=t.vNode,e}),{}),xp((function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return _P.h("div.mapillary-dom-renderer",t)}))),this._vPatch$=this._vNode$.pipe(bv((function(e,t){return e.vpatch=_P.diff(e.vNode,t),e.vNode=t,e}),{vNode:_P.h("div.mapillary-dom-renderer",[]),vpatch:null}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return xp((function(t){for(var i=t,r=0;r<n;r++){var a=null===i||void 0===i?void 0:i[e[r]];if("undefined"===typeof a)return;i=a}return i}))}("vpatch")),this._element$=this._vPatch$.pipe(bv((function(e,t){return _P.patch(e,t)}),a),_v(1),Ef()),r.push(o),r.push(s),r.push(this._element$.subscribe((function(){}))),r.push(this._renderService.size$.pipe(xp((function(e){return function(t){return t.elementWidth=e.width,t.elementHeight=e.height,t}}))).subscribe(this._adaptiveOperation$)),r.push(this._renderService.renderMode$.pipe(xp((function(e){return function(t){return t.renderMode=e,t}}))).subscribe(this._adaptiveOperation$))}return $d(e,[{key:"element$",get:function(){return this._element$}},{key:"render$",get:function(){return this._render$}},{key:"renderAdaptive$",get:function(){return this._renderAdaptive$}},{key:"clear",value:function(e){this._renderAdaptive$.next({name:e,vNode:null}),this._render$.next({name:e,vNode:null})}},{key:"remove",value:function(){this._subscriptions.unsubscribe()}}]),e}(),qO=function(){function e(t,n,i){var r=this;Fd(this,e),this._renderFrame$=new Af,this._renderCameraOperation$=new Af,this._render$=new Af,this._clear$=new Af,this._renderOperation$=new Af,this._rendererOperation$=new Af,this._eraserOperation$=new Af,this._triggerOperation$=new Af,this._subscriptions=new bP,this._opaqueRender$=new Af,this._renderService=i;var a=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(bv((function(e,t){return t(e)}),{needsRender:!1,renderer:null}),qp((function(e){return!!e.renderer}))),this._renderCollection$=this._renderOperation$.pipe(bv((function(e,t){return t(e)}),{}),xv()),this._renderCamera$=this._renderCameraOperation$.pipe(bv((function(e,t){return t(e)}),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(Mv((function(e){return e})),bv((function(e,t){return t(e)}),{needsRender:!1}));var o=this._triggerOperation$.pipe(Mv((function(e){return e})),bv((function(e,t){return t(e)}),{needsRender:!1})),u=new h_(986895),l=Lp(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,o).pipe(xp((function(e){var t=s(e,5),n=t[0],i=t[1];return{camera:t[2],eraser:t[3],trigger:t[4],renderer:n,renders:Object.keys(i).map((function(e){return i[e]}))}})),qp((function(e){var t,n=e.renderer.needsRender||e.camera.needsRender||e.eraser.needsRender||e.trigger.needsRender,i=e.camera.frameId,r=Pd(e.renders);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.frameId!==i)return!1;n=n||a.needsRender}}catch(MN){r.e(MN)}finally{r.f()}return n})),ov((function(e,t){return e===t}),(function(e){return e.eraser.needsRender||e.trigger.needsRender?-e.camera.frameId:e.camera.frameId}))).subscribe((function(e){e.renderer.needsRender=!1,e.camera.needsRender=!1,e.eraser.needsRender=!1,e.trigger.needsRender=!1;var t,n=e.camera.perspective,i=[],a=[],o=Pd(e.renders);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.pass===RP.Background?i.push(s.render):s.pass===RP.Opaque&&a.push(s.render)}}catch(MN){o.e(MN)}finally{o.f()}var l=e.renderer.renderer;l.resetState(),l.setClearColor(u,1),l.clear();for(var c=0,h=i;c<h.length;c++){(0,h[c])(n,l)}l.clearDepth();for(var d=0,f=a;d<f.length;d++){(0,f[d])(n,l)}l.resetState(),r._opaqueRender$.next()}));a.push(l),a.push(this._renderFrame$.pipe(xp((function(e){return function(t){return t.frameId=e.frameId,t.perspective=e.perspective,!0===e.changed&&(t.needsRender=!0),t}}))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();var c=this._render$.pipe(xp((function(e){return function(t){return t[e.name]=e.renderer,t}}))),h=this._clear$.pipe(xp((function(e){return function(t){return delete t[e],t}})));a.push(Hp(c,h).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(dv(),xp((function(){n.appendChild(t);var e=i.element,r=new Jx({canvas:t});return r.setPixelRatio(window.devicePixelRatio),r.setSize(e.offsetWidth,e.offsetHeight),r.autoClear=!1,r})),_v(1),Ef()),a.push(this._webGLRenderer$.subscribe((function(){})));var d=this._webGLRenderer$.pipe(dv(),xp((function(e){return function(t){return t.needsRender=!0,t.renderer=e,t}}))),f=this._renderService.size$.pipe(xp((function(e){return function(t){return null==t.renderer||(t.renderer.setSize(e.width,e.height),t.needsRender=!0),t}}))),p=this._clear$.pipe(xp((function(){return function(e){return null==e.renderer||(e.needsRender=!0),e}})));a.push(Hp(d,f,p).subscribe(this._rendererOperation$));var v=this._renderCollection$.pipe(qp((function(e){return 0===Object.keys(e).length})),xv());a.push(v.subscribe((function(){null!=r._renderFrameSubscription&&(r._renderFrameSubscription.unsubscribe(),r._renderFrameSubscription=null,r._renderFrameSubscribe())}))),a.push(v.pipe(xp((function(){return function(e){return e.needsRender=!0,e}}))).subscribe(this._eraserOperation$))}return $d(e,[{key:"render$",get:function(){return this._render$}},{key:"opaqueRender$",get:function(){return this._opaqueRender$}},{key:"webGLRenderer$",get:function(){return this._webGLRenderer$}},{key:"clear",value:function(e){this._clear$.next(e)}},{key:"remove",value:function(){this._rendererOperation$.next((function(e){if(null!=e.renderer){var t=e.renderer.getContext().getExtension("WEBGL_lose_context");t&&t.loseContext(),e.renderer=null}return e})),null!=this._renderFrameSubscription&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}},{key:"triggerRerender",value:function(){var e=this;this._renderService.renderCameraFrame$.pipe(kv(1),dv()).subscribe((function(){e._triggerOperation$.next((function(e){return e.needsRender=!0,e}))}))}},{key:"_renderFrameSubscribe",value:function(){var e=this;this._render$.pipe(dv(),xp((function(){return function(e){return e.needsRender=!0,e}}))).subscribe((function(t){e._renderCameraOperation$.next(t)})),this._renderFrameSubscription=this._render$.pipe(dv(),Np((function(){return e._renderService.renderCameraFrame$}))).subscribe(this._renderFrame$)}}]),e}(),ZO=function(){function e(t){Fd(this,e),null!=t?(this._position=(new Vm).fromArray(t.unprojectSfM([0,0],0)),this._lookat=(new Vm).fromArray(t.unprojectSfM([0,0],10)),this._up=t.upVector(),this._focal=this._getFocal(t)):(this._position=new Vm(0,0,0),this._lookat=new Vm(1,0,0),this._up=new Vm(0,0,1),this._focal=1)}return $d(e,[{key:"position",get:function(){return this._position}},{key:"lookat",get:function(){return this._lookat}},{key:"up",get:function(){return this._up}},{key:"focal",get:function(){return this._focal},set:function(e){this._focal=e}},{key:"lerpCameras",value:function(e,t,n){this._position.subVectors(t.position,e.position).multiplyScalar(n).add(e.position),this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(n).add(e.lookat),this._up.subVectors(t.up,e.up).multiplyScalar(n).add(e.up),this._focal=(1-n)*e.focal+n*t.focal}},{key:"copy",value:function(e){this._position.copy(e.position),this._lookat.copy(e.lookat),this._up.copy(e.up),this._focal=e.focal}},{key:"clone",value:function(){var t=new e;return t.position.copy(this._position),t.lookat.copy(this._lookat),t.up.copy(this._up),t.focal=this._focal,t}},{key:"diff",value:function(e){var t=this._position.distanceToSquared(e.position),n=this._lookat.distanceToSquared(e.lookat),i=this._up.distanceToSquared(e.up),r=100*Math.abs(this._focal-e.focal);return Math.max(t,n,i,r)}},{key:"_getFocal",value:function(e){return qM(e.cameraType)?.5/Math.tan(Math.PI/2):e.focal}}]),e}(),XO=function(){function e(t,n,i){Fd(this,e),this._spatial=new WM,this._viewportCoords=new MP,this._size={width:t,height:n},this._initialFov=60,this._alpha=-1,this._stateTransitionAlpha=-1,this._stateTransitionFov=-1,this._renderMode=i,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new ZO,this._perspective=new Q_(this._initialFov,this._computeAspect(t,n),.1,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}return $d(e,[{key:"alpha",get:function(){return this._alpha}},{key:"camera",get:function(){return this._camera}},{key:"changed",get:function(){return this._frameId===this._changedForFrame}},{key:"frameId",get:function(){return this._frameId}},{key:"perspective",get:function(){return this._perspective}},{key:"renderMode",get:function(){return this._renderMode}},{key:"rotation",get:function(){return this._rotation}},{key:"zoom",get:function(){return this._zoom}},{key:"size",get:function(){return this._size}},{key:"getTilt",value:function(){return 90-this._spatial.radToDeg(this._rotation.theta)}},{key:"fovToZoom",value:function(e){e=Math.min(90,Math.max(0,e));var t=this._computeCurrentFov(0),n=1===this._alpha?t:this._interpolateFov(t,this._computePreviousFov(0),this._alpha),i=Math.tan(n/2*Math.PI/180),r=Math.tan(e/2*Math.PI/180);return Math.log(i/r)/Math.log(2)}},{key:"setFrame",value:function(e){var t=e.state;if(t.state!==this._state){if(this._state=t.state,this._state!==XP.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._state===XP.Earth){var n=this._fovToY(this._perspective.fov,this._zoom);this._stateTransitionFov=this._yToFov(n,0)}this._changed=!0}var i=t.currentImage.id,r=t.previousImage?t.previousImage.id:null;i!==this._currentImageId&&(this._currentImageId=i,this._currentSpherical=qM(t.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(t.currentTransform),this._changed=!0),r!==this._previousImageId&&(this._previousImageId=r,this._previousSpherical=qM(t.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(t.previousTransform),this._changed=!0);var a=t.zoom;a!==this._zoom&&(this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(a),this._previousFov=this._computePreviousFov(a));var o=t.alpha,s=t.stateTransitionAlpha;if(this._changed||o!==this._alpha||s!==this._stateTransitionAlpha){switch(this._alpha=o,this._stateTransitionAlpha=s,this._state){case XP.Earth:var u=this._stateTransitionFov,l=this._focalToFov(t.camera.focal),c=Cm.lerp(u,l,s),h=this._fovToY(c,0);this._perspective.fov=this._yToFov(h,a);break;case XP.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0}this._zoom=a,this._state!==XP.Custom&&this._perspective.updateProjectionMatrix()}var d=t.camera;this._camera.diff(d)>1e-9&&(this._camera.copy(d),this._rotation=this._computeRotation(d),this._perspective.up.copy(d.up),this._perspective.position.copy(d.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(d.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(e.id)}},{key:"setProjectionMatrix",value:function(e){this._perspective.fov=this._focalToFov(e[5]/2),this._perspective.projectionMatrix.fromArray(e),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}},{key:"setRenderMode",value:function(e){this._renderMode=e,this._state!==XP.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}},{key:"setSize",value:function(e){this._size=e,this._state!==XP.Custom&&(this._perspective.aspect=this._computeAspect(e.width,e.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}},{key:"_computeAspect",value:function(e,t){return 0===e?0:e/t}},{key:"_computeCurrentFov",value:function(e){return 0===this._perspective.aspect?0:this._currentImageId?this._currentSpherical?this._yToFov(1,e):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,e,this.perspective.aspect):this._initialFov}},{key:"_computeFov",value:function(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}},{key:"_computePreviousFov",value:function(e){return 0===this._perspective.aspect?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,e):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,e,this.perspective.aspect):this._currentFov:this._initialFov}},{key:"_computeProjectedPoints",value:function(e){return YM(e,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}},{key:"_computeRequiredVerticalFov",value:function(e,t,n){var i=Math.max(e[0]/n,e[1]);return this._yToFov(i,t)}},{key:"_computeRotation",value:function(e){var t=e.lookat.clone().sub(e.position),n=e.up.clone();return{phi:this._spatial.azimuthal(t.toArray(),n.toArray()),theta:Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1])}}},{key:"_computeVerticalFov",value:function(e,t,n,i){var r=this,a=e.map((function(e){return r._computeRequiredVerticalFov(e,n,i)}));return t===jO.Fill?.995*Math.min.apply(Math,wd(a)):Math.max.apply(Math,wd(a))}},{key:"_yToFov",value:function(e,t){return 2*Math.atan(e/Math.pow(2,t))*180/Math.PI}},{key:"_focalToFov",value:function(e){return 2*Math.atan2(1,2*e)*180/Math.PI}},{key:"_fovToY",value:function(e,t){return Math.pow(2,t)*Math.tan(Math.PI*e/360)}},{key:"_interpolateFov",value:function(e,t,n){return n*e+(1-n)*t}},{key:"_setFrameId",value:function(e){this._frameId=e,this._changed&&(this._changed=!1,this._changedForFrame=e)}}]),e}(),YO=function(){function e(t,n,i,r){var a=this;Fd(this,e),this._subscriptions=new bP,this._element=t,this._currentFrame$=n,this._spatial=new WM,i=null!=i?i:jO.Fill,this._resize$=new Af,this._projectionMatrix$=new Af,this._renderCameraOperation$=new Af,this._size$=new Rf({height:this._element.offsetHeight,width:this._element.offsetWidth});var o=this._subscriptions;o.push(this._resize$.pipe(xp((function(){return{height:a._element.offsetHeight,width:a._element.offsetWidth}}))).subscribe(this._size$)),this._renderMode$=new Rf(i),this._renderCameraHolder$=this._renderCameraOperation$.pipe(Mv((function(e){return e})),bv((function(e,t){return t(e)}),null!==r&&void 0!==r?r:new XO(this._element.offsetWidth,this._element.offsetHeight,i)),_v(1),Ef()),this._renderCameraFrame$=this._currentFrame$.pipe(Lv(this._renderCameraHolder$),Pv((function(e){var t=s(e,2),n=t[0];t[1].setFrame(n)})),xp((function(e){return e[1]})),_v(1),Ef()),this._renderCamera$=this._renderCameraFrame$.pipe(qp((function(e){return e.changed})),_v(1),Ef()),this._bearing$=this._renderCamera$.pipe(xp((function(e){var t=a._spatial.radToDeg(a._spatial.azimuthalToBearing(e.rotation.phi));return a._spatial.wrap(t,0,360)})),_v(1),Ef()),o.push(this._size$.pipe(kv(1),xp((function(e){return function(t){return t.setSize(e),t}}))).subscribe(this._renderCameraOperation$)),o.push(this._renderMode$.pipe(kv(1),xp((function(e){return function(t){return t.setRenderMode(e),t}}))).subscribe(this._renderCameraOperation$)),o.push(this._projectionMatrix$.pipe(xp((function(e){return function(t){return t.setProjectionMatrix(e),t}}))).subscribe(this._renderCameraOperation$)),o.push(this._bearing$.subscribe((function(){}))),o.push(this._renderCameraHolder$.subscribe((function(){}))),o.push(this._size$.subscribe((function(){}))),o.push(this._renderMode$.subscribe((function(){}))),o.push(this._renderCamera$.subscribe((function(){}))),o.push(this._renderCameraFrame$.subscribe((function(){})))}return $d(e,[{key:"bearing$",get:function(){return this._bearing$}},{key:"element",get:function(){return this._element}},{key:"projectionMatrix$",get:function(){return this._projectionMatrix$}},{key:"renderCamera$",get:function(){return this._renderCamera$}},{key:"renderCameraFrame$",get:function(){return this._renderCameraFrame$}},{key:"renderMode$",get:function(){return this._renderMode$}},{key:"resize$",get:function(){return this._resize$}},{key:"size$",get:function(){return this._size$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}}]),e}(),KO=function(){function e(t){Fd(this,e),this._keyDown$=jp(t,"keydown"),this._keyUp$=jp(t,"keyup")}return $d(e,[{key:"keyDown$",get:function(){return this._keyDown$}},{key:"keyUp$",get:function(){return this._keyUp$}}]),e}(),JO=(Yh(bd={},0,1),Yh(bd,2,2),bd),QO=function(){function e(t,n,i,r){var a=this;Fd(this,e),this._subscriptions=new bP;var o=this._subscriptions;this._activeSubject$=new Rf(!1),this._active$=this._activeSubject$.pipe(ov(),_v(1),Ef()),this._claimMouse$=new Af,this._claimWheel$=new Af,this._deferPixelClaims$=new Af,this._deferPixels$=this._deferPixelClaims$.pipe(bv((function(e,t){return null==t.deferPixels?delete e[t.name]:e[t.name]=t.deferPixels,e}),{}),xp((function(e){var t=-1;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i>t&&(t=i)}return t})),Mv(-1),_v(1),Ef()),o.push(this._deferPixels$.subscribe((function(){}))),this._documentMouseMove$=jp(r,"pointermove").pipe(qp(this._isMousePen)),this._documentMouseUp$=jp(r,"pointerup").pipe(qp(this._isMousePen)),this._mouseDown$=jp(n,"pointerdown").pipe(qp(this._isMousePen)),this._mouseEnter$=jp(n,"pointerenter").pipe(qp(this._isMousePen)),this._mouseLeave$=jp(n,"pointerleave").pipe(qp(this._isMousePen)),this._mouseMove$=jp(n,"pointermove").pipe(qp(this._isMousePen)),this._mouseUp$=jp(n,"pointerup").pipe(qp(this._isMousePen)),this._mouseOut$=jp(n,"pointerout").pipe(qp(this._isMousePen)),this._mouseOver$=jp(n,"pointerover").pipe(qp(this._isMousePen)),this._domMouseDown$=jp(i,"pointerdown").pipe(qp(this._isMousePen)),this._domMouseMove$=jp(i,"pointermove").pipe(qp(this._isMousePen)),this._click$=jp(n,"click"),this._contextMenu$=jp(n,"contextmenu"),this._windowBlur$=jp(window,"blur"),this._dblClick$=Hp(jp(t,"click"),jp(n,"dblclick")).pipe(Yp(3,1),qp((function(e){var t=e[0],i=e[1],r=e[2];return"click"===t.type&&"click"===i.type&&"dblclick"===r.type&&t.target.parentNode===n&&i.target.parentNode===n})),xp((function(e){return e[2]})),xv()),o.push(Hp(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe((function(e){e.preventDefault()}))),this._mouseWheel$=Hp(jp(n,"wheel"),jp(i,"wheel")).pipe(xv()),this._consistentContextMenu$=Hp(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(Yp(3,1),qp((function(e){return"pointerdown"===e[0].type&&"contextmenu"===e[1].type&&"pointerup"===e[2].type})),xp((function(e){return e[1]})),xv());var s=Hp(this._windowBlur$,this._documentMouseMove$.pipe(qp((function(e){return a._buttonReleased(e,0)}))),this._documentMouseUp$.pipe(qp((function(e){return 0===a._mouseButton(e)})))).pipe(xv()),u=this._createMouseDragInitiate$(0,this._mouseDown$,s,!0).pipe(xv());this._mouseDragStart$=this._createMouseDragStart$(u).pipe(xv()),this._mouseDrag$=this._createMouseDrag$(u,s).pipe(xv()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,s).pipe(xv());var l=this._createMouseDragInitiate$(0,this._domMouseDown$,s,!1).pipe(xv());this._domMouseDragStart$=this._createMouseDragStart$(l).pipe(xv()),this._domMouseDrag$=this._createMouseDrag$(l,s).pipe(xv()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,s).pipe(xv());var c=Hp(this._windowBlur$,this._documentMouseMove$.pipe(qp((function(e){return a._buttonReleased(e,2)}))),this._documentMouseUp$.pipe(qp((function(e){return 2===a._mouseButton(e)})))).pipe(xv()),h=this._createMouseDragInitiate$(2,this._mouseDown$,c,!0).pipe(xv());this._mouseRightDragStart$=this._createMouseDragStart$(h).pipe(xv()),this._mouseRightDrag$=this._createMouseDrag$(h,c).pipe(xv()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,c).pipe(xv()),this._proximateClick$=this._mouseDown$.pipe(Tv((function(e){return a._click$.pipe(Cv(a._createDeferredMouseMove$(e,a._documentMouseMove$)),av(1))})),xv()),this._staticClick$=this._mouseDown$.pipe(Tv((function(){return a._click$.pipe(Cv(a._documentMouseMove$),av(1))})),xv()),o.push(this._mouseDragStart$.subscribe()),o.push(this._mouseDrag$.subscribe()),o.push(this._mouseDragEnd$.subscribe()),o.push(this._domMouseDragStart$.subscribe()),o.push(this._domMouseDrag$.subscribe()),o.push(this._domMouseDragEnd$.subscribe()),o.push(this._mouseRightDragStart$.subscribe()),o.push(this._mouseRightDrag$.subscribe()),o.push(this._mouseRightDragEnd$.subscribe()),o.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(_v(1),Ef()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(_v(1),Ef()),o.push(this._mouseOwner$.subscribe((function(){}))),o.push(this._wheelOwner$.subscribe((function(){})))}return $d(e,[{key:"active$",get:function(){return this._active$}},{key:"activate$",get:function(){return this._activeSubject$}},{key:"documentMouseMove$",get:function(){return this._documentMouseMove$}},{key:"documentMouseUp$",get:function(){return this._documentMouseUp$}},{key:"domMouseDragStart$",get:function(){return this._domMouseDragStart$}},{key:"domMouseDrag$",get:function(){return this._domMouseDrag$}},{key:"domMouseDragEnd$",get:function(){return this._domMouseDragEnd$}},{key:"domMouseDown$",get:function(){return this._domMouseDown$}},{key:"domMouseMove$",get:function(){return this._domMouseMove$}},{key:"mouseOwner$",get:function(){return this._mouseOwner$}},{key:"mouseDown$",get:function(){return this._mouseDown$}},{key:"mouseEnter$",get:function(){return this._mouseEnter$}},{key:"mouseMove$",get:function(){return this._mouseMove$}},{key:"mouseLeave$",get:function(){return this._mouseLeave$}},{key:"mouseOut$",get:function(){return this._mouseOut$}},{key:"mouseOver$",get:function(){return this._mouseOver$}},{key:"mouseUp$",get:function(){return this._mouseUp$}},{key:"click$",get:function(){return this._click$}},{key:"dblClick$",get:function(){return this._dblClick$}},{key:"contextMenu$",get:function(){return this._consistentContextMenu$}},{key:"mouseWheel$",get:function(){return this._mouseWheel$}},{key:"mouseDragStart$",get:function(){return this._mouseDragStart$}},{key:"mouseDrag$",get:function(){return this._mouseDrag$}},{key:"mouseDragEnd$",get:function(){return this._mouseDragEnd$}},{key:"mouseRightDragStart$",get:function(){return this._mouseRightDragStart$}},{key:"mouseRightDrag$",get:function(){return this._mouseRightDrag$}},{key:"mouseRightDragEnd$",get:function(){return this._mouseRightDragEnd$}},{key:"proximateClick$",get:function(){return this._proximateClick$}},{key:"staticClick$",get:function(){return this._staticClick$}},{key:"windowBlur$",get:function(){return this._windowBlur$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}},{key:"claimMouse",value:function(e,t){this._claimMouse$.next({name:e,zindex:t})}},{key:"unclaimMouse",value:function(e){this._claimMouse$.next({name:e,zindex:null})}},{key:"deferPixels",value:function(e,t){this._deferPixelClaims$.next({name:e,deferPixels:t})}},{key:"undeferPixels",value:function(e){this._deferPixelClaims$.next({name:e,deferPixels:null})}},{key:"claimWheel",value:function(e,t){this._claimWheel$.next({name:e,zindex:t})}},{key:"unclaimWheel",value:function(e){this._claimWheel$.next({name:e,zindex:null})}},{key:"filtered$",value:function(e,t){return this._filtered(e,t,this._mouseOwner$)}},{key:"filteredWheel$",value:function(e,t){return this._filtered(e,t,this._wheelOwner$)}},{key:"_createDeferredMouseMove$",value:function(e,t){return t.pipe(xp((function(t){var n=t.clientX-e.clientX,i=t.clientY-e.clientY;return[t,Math.sqrt(n*n+i*i)]})),Lv(this._deferPixels$),qp((function(e){var t=s(e,2);return s(t[0],2)[1]>t[1]})),xp((function(e){var t=s(e,1);return s(t[0],1)[0]})))}},{key:"_createMouseDrag$",value:function(e,t){var n=this;return e.pipe(xp((function(e){return s(e,2)[1]})),Tv((function(e){return zp(pp(e),n._documentMouseMove$).pipe(Cv(t))})))}},{key:"_createMouseDragEnd$",value:function(e,t){return e.pipe(Tv((function(){return t.pipe(dv())})))}},{key:"_createMouseDragStart$",value:function(e){return e.pipe(xp((function(e){return s(e,1)[0]})))}},{key:"_createMouseDragInitiate$",value:function(e,t,n,i){var r=this;return t.pipe(qp((function(t){return r._mouseButton(t)===e})),Tv((function(e){return Lp(pp(e),i?r._createDeferredMouseMove$(e,r._documentMouseMove$):r._documentMouseMove$).pipe(Cv(n),av(1))})))}},{key:"_createOwner$",value:function(e){return e.pipe(bv((function(e,t){return null==t.zindex?delete e[t.name]:e[t.name]=t.zindex,e}),{}),xp((function(e){var t=null,n=-1;for(var i in e)e.hasOwnProperty(i)&&e[i]>n&&(n=e[i],t=i);return t})),Mv(null))}},{key:"_filtered",value:function(e,t,n){return t.pipe(Lv(n),qp((function(t){return s(t,2)[1]===e})),xp((function(e){return s(e,1)[0]})))}},{key:"_mouseButton",value:function(e){var t="pointerdown"===e.type||"pointerup"===e.type,n=window.InstallTrigger;return t&&"undefined"!==typeof n&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}},{key:"_buttonReleased",value:function(e,t){var n=JO[t];return void 0===e.buttons||(e.buttons&n)!==n}},{key:"_isMousePen",value:function(e){var t=e.pointerType;return"mouse"===t||"pen"===t}}]),e}(),ez=function(){function e(){Fd(this,e)}return $d(e,[{key:"json",set:function(e){this._json=e}},{key:"image",set:function(e){this._image=e,this._texture=new Om(this._image),this._texture.minFilter=Bv}},{key:"loaded",get:function(){return!(!this._image||!this._json)}},{key:"getGLSprite",value:function(e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");var t=this._json[e];if(!t)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),new Wg;var n=this._texture.clone();n.needsUpdate=!0;var i=this._image.width,r=this._image.height;n.offset.x=t.x/i,n.offset.y=(r-t.y-t.height)/r,n.repeat.x=t.width/i,n.repeat.y=t.height/r;var a=new aw({map:n});return new _w(a)}},{key:"getDOMSprite",value:function(e,t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");null==t&&(t=UI.Center);var n=this._json[e];if(!n)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),_P.h("div",{},[]);var i=n.y,r=n.x+n.width,a=n.y+n.height,o=n.x,s=-n.x,u=-n.y,l=this._image.height,c=this._image.width;switch(t){case UI.Bottom:case UI.Center:case UI.Top:s-=n.width/2;break;case UI.BottomLeft:case UI.Left:case UI.TopLeft:s-=n.width;case UI.BottomRight:case UI.Right:case UI.TopRight:}switch(t){case UI.Center:case UI.Left:case UI.Right:u-=n.height/2;break;case UI.Top:case UI.TopLeft:case UI.TopRight:u-=n.height;case UI.Bottom:case UI.BottomLeft:case UI.BottomRight:}var h=1/n.pixelRatio;i*=h,r*=h,a*=h,o*=h,s*=h,u*=h,l*=h,c*=h;var d={src:this._image.src,style:{clip:"rect(".concat(i,"px, ").concat(r,"px, ").concat(a,"px, ").concat(o,"px)"),height:"".concat(l,"px"),left:"".concat(s,"px"),position:"absolute",top:"".concat(u,"px"),width:"".concat(c,"px")}};return _P.h("img",d,[])}}]),e}(),tz=function(){function e(t){var n=this;if(Fd(this,e),this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new Af,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(Mv((function(e){return e})),bv((function(e,t){return t(e)}),new ez),_v(1),Ef()),this._atlasSubscription=this._spriteAtlas$.subscribe((function(){})),null!=t){var i=this._retina?"@2x":"",r=new XMLHttpRequest;r.open("GET",t+i+".png",!0),r.responseType="arraybuffer",r.onload=function(){var e=new Image;e.onload=function(){n._spriteAtlasOperation$.next((function(t){return t.image=e,t}))};var t=new Blob([r.response]);e.src=window.URL.createObjectURL(t)},r.onerror=function(e){console.error(new Error("Failed to fetch sprite sheet (".concat(t).concat(i,".png)")))},r.send();var a=new XMLHttpRequest;a.open("GET",t+i+".json",!0),a.responseType="text",a.onload=function(){var e=JSON.parse(a.response);n._spriteAtlasOperation$.next((function(t){return t.json=e,t}))},a.onerror=function(e){console.error(new Error("Failed to fetch sheet (".concat(t).concat(i,".json)")))},a.send()}}return $d(e,[{key:"spriteAtlas$",get:function(){return this._spriteAtlas$}},{key:"dispose",value:function(){this._atlasSubscription.unsubscribe()}}]),e}(),nz=function(){function e(t,n){var i=this;Fd(this,e),this._subscriptions=new bP;var r=this._subscriptions;this._activeSubject$=new Rf(!1),this._active$=this._activeSubject$.pipe(ov(),_v(1),Ef()),r.push(jp(n,"touchmove").subscribe((function(e){e.preventDefault()}))),this._touchStart$=jp(t,"touchstart"),this._touchMove$=jp(t,"touchmove"),this._touchEnd$=jp(t,"touchend"),this._touchCancel$=jp(t,"touchcancel");var a,o=this._touchStart$.pipe(qp((function(e){return 1===e.touches.length&&1===e.targetTouches.length})),xv());this._doubleTap$=o.pipe((a=function(){return o.pipe(dv(),Tv((function(){return Hp(Vp(300),o).pipe(av(1))})))},Tf((function(e,t){var n=null,i=null;!function e(){null===i||void 0===i||i.unsubscribe();var r=n;n=[],r&&t.next(r),ap(a()).subscribe(i=new Cf(t,e,lf))}(),e.subscribe(new Cf(t,(function(e){return null===n||void 0===n?void 0:n.push(e)}),(function(){n&&t.next(n),t.complete()}),void 0,(function(){return n=i=null})))}))),qp((function(e){return 2===e.length})),xp((function(e){return e[e.length-1]})),xv()),r.push(this._doubleTap$.subscribe((function(e){e.preventDefault()}))),this._singleTouchMove$=this._touchMove$.pipe(qp((function(e){return 1===e.touches.length&&1===e.targetTouches.length})),xv());var s=Hp(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(qp((function(e){return 1===e.touches.length&&1===e.targetTouches.length}))),u=Hp(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(qp((function(e){return e.touches.length>=1}))),l=Hp(this._touchEnd$,this._touchCancel$).pipe(qp((function(e){return 0===e.touches.length})));this._singleTouchDragStart$=s.pipe(Np((function(){return i._singleTouchMove$.pipe(Cv(Hp(l,u)),av(1))}))),this._singleTouchDragEnd$=s.pipe(Np((function(){return Hp(l,u).pipe(dv())}))),this._singleTouchDrag$=s.pipe(Tv((function(){return i._singleTouchMove$.pipe(kv(1),Cv(Hp(u,l)))})));var c=Hp(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=c.pipe(qp((function(e){return 2===e.touches.length&&2===e.targetTouches.length}))),this._pinchEnd$=c.pipe(qp((function(e){return 2!==e.touches.length||2!==e.targetTouches.length}))),this._pinchOperation$=new Af,this._pinch$=this._pinchOperation$.pipe(bv((function(e,t){return t(e)}),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));var h=this._touchMove$.pipe(qp((function(e){return 2===e.touches.length&&2===e.targetTouches.length})),xp((function(e){return function(t){var n=e.touches[0],i=e.touches[1],r=Math.min(n.clientX,i.clientX),a=Math.max(n.clientX,i.clientX),o=Math.min(n.clientY,i.clientY),s=r+(a-r)/2,u=o+(Math.max(n.clientY,i.clientY)-o)/2,l=s+n.pageX-n.clientX,c=u+n.pageY-n.clientY,h=s+n.screenX-n.clientX,d=u+n.screenY-n.clientY,f=Math.abs(n.clientX-i.clientX),p=Math.abs(n.clientY-i.clientY),v=Math.sqrt(f*f+p*p),m=v-t.distance;return{changeX:f-t.distanceX,changeY:p-t.distanceY,clientX:s,clientY:u,distance:v,distanceChange:m,distanceX:f,distanceY:p,originalEvent:e,pageX:l,pageY:c,screenX:h,screenY:d,touch1:n,touch2:i}}}))).subscribe(this._pinchOperation$);r.push(h),this._pinchChange$=this._pinchStart$.pipe(Tv((function(){return i._pinch$.pipe(kv(1),Cv(i._pinchEnd$))})))}return $d(e,[{key:"active$",get:function(){return this._active$}},{key:"activate$",get:function(){return this._activeSubject$}},{key:"doubleTap$",get:function(){return this._doubleTap$}},{key:"touchStart$",get:function(){return this._touchStart$}},{key:"touchMove$",get:function(){return this._touchMove$}},{key:"touchEnd$",get:function(){return this._touchEnd$}},{key:"touchCancel$",get:function(){return this._touchCancel$}},{key:"singleTouchDragStart$",get:function(){return this._singleTouchDragStart$}},{key:"singleTouchDrag$",get:function(){return this._singleTouchDrag$}},{key:"singleTouchDragEnd$",get:function(){return this._singleTouchDragEnd$}},{key:"pinch$",get:function(){return this._pinchChange$}},{key:"pinchStart$",get:function(){return this._pinchStart$}},{key:"pinchEnd$",get:function(){return this._pinchEnd$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}}]),e}(),iz=function(){function e(t){var n,i,r,a;Fd(this,e);var o=null!==(i=null===(n=null===t||void 0===t?void 0:t.url)||void 0===n?void 0:n.exploreHost)&&void 0!==i?i:"www.mapillary.com",s=null!==(a=null===(r=null===t||void 0===t?void 0:t.url)||void 0===r?void 0:r.scheme)&&void 0!==a?a:"https",u="".concat(s,"://").concat(o);this._exploreUrl$=pp(u);var l=!1!==(null===t||void 0===t?void 0:t.imageTiling);this._imageTiling$=pp(l)}return $d(e,[{key:"exploreUrl$",get:function(){return this._exploreUrl$}},{key:"imageTiling$",get:function(){return this._imageTiling$}}]),e}(),rz=function(){function e(t,n,i){var r,a=this;if(Fd(this,e),this._onWindowResize=function(){a._trackResize&&a.renderService.resize$.next()},this._dom=null!==i&&void 0!==i?i:new kL,"string"===typeof t.container){if(this._container=this._dom.document.getElementById(t.container),!this._container)throw new Error('Container "'.concat(t.container,'" not found.'))}else{if(!(t.container instanceof HTMLElement))throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._container=t.container}this._trackResize=!1!==t.trackResize,this.id=null!==(r=this._container.id)&&void 0!==r?r:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new iz(t),this.renderService=new YO(this._container,n.currentState$,t.renderMode),this.glRenderer=new qO(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new GO(this._domContainer,this.renderService,n.currentState$),this.keyboardService=new KO(this._canvasContainer),this.mouseService=new QO(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new nz(this._canvasContainer,this._domContainer),this.spriteService=new tz(t.sprite),window.addEventListener("resize",this._onWindowResize,!1)}return $d(e,[{key:"canvas",get:function(){return this._canvas.parentNode?this._canvas:null}},{key:"canvasContainer",get:function(){return this._canvasContainer}},{key:"container",get:function(){return this._container}},{key:"domContainer",get:function(){return this._domContainer}},{key:"remove",value:function(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}},{key:"_removeNode",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}}]),e}(),az=function(){function e(t,n,i){Fd(this,e),this._graphService=t,this._stateService=n,this._api=i,this._subscriptions=new bP,this._started=!1,this._cellDepth=1}return $d(e,[{key:"started",get:function(){return this._started}},{key:"configure",value:function(e){this._cellDepth=e?Math.max(1,Math.min(3,e.cellDepth)):1}},{key:"start",value:function(){var e=this;if(!this._started){var t=this._subscriptions;t.push(this._stateService.currentState$.pipe(ov(void 0,(function(e){return e.state.currentImage.id})),xp((function(e){var t=e.state,n=t.trajectory,i=n.map((function(e){return e.id})),r=n[n.length-1].sequenceId;return[i,t.currentImage.originalLngLat,r]})),Yp(1,5),Lv(this._graphService.graphMode$),Tv((function(t){var n=s(t,2),i=n[0],r=n[1],a=i[0][0],o=i[0][1],u=e._api.data.geometry,l=QL(u.lngLatToCellId(o),e._cellDepth,u),c=r===xL.Sequence?i[0][2]:void 0;return e._graphService.uncache$(a,l,c)}))).subscribe((function(){}))),t.push(this._graphService.graphMode$.pipe(kv(1),Lv(this._stateService.currentState$),Tv((function(t){var n=s(t,2),i=n[0],r=n[1];return i===xL.Sequence?e._keyToEdges(r.state.currentImage.id,(function(e){return e.sequenceEdges$})):rp(r.state.trajectory.map((function(e){return e.id})).slice(r.state.currentIndex)).pipe(Np((function(t){return e._keyToEdges(t,(function(e){return e.spatialEdges$}))}),6))}))).subscribe((function(){}))),t.push(this._graphService.dataAdded$.pipe(Lv(this._stateService.currentId$),Tv((function(t){var n=s(t,2),i=(n[0],n[1]);return e._graphService.cacheImage$(i)}))).subscribe((function(){}))),this._started=!0}}},{key:"stop",value:function(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}},{key:"_keyToEdges",value:function(e,t){return this._graphService.cacheImage$(e).pipe(Tv(t),dv((function(e){return e.cached})),yp(15e3),Kp((function(t){return console.error("Failed to cache edges (".concat(e,")."),t),Hf()})))}}]),e}(),oz=function(){function e(){Fd(this,e),this._loadersSubject$=new Af,this._loaders$=this._loadersSubject$.pipe(bv((function(e,t){return void 0!==t.task&&(e[t.task]=t.loading),e}),{}),Mv({}),_v(1),Ef())}return $d(e,[{key:"loading$",get:function(){return this._loaders$.pipe(xp((function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return!1})),iv(100),ov())}},{key:"taskLoading$",value:function(e){return this._loaders$.pipe(xp((function(t){return!!t[e]})),iv(100),ov())}},{key:"startLoading",value:function(e){this._loadersSubject$.next({loading:!0,task:e})}},{key:"stopLoading",value:function(e){this._loadersSubject$.next({loading:!1,task:e})}}]),e}();!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.Started=2]="Started"}(HO||(HO={}));var sz=function(){function e(t,n,i,r,a,o){Fd(this,e),this._subscriptions=new bP,this._graphService=t,this._stateService=n,this._graphCalculator=null!==r&&void 0!==r?r:new OM,this._spatial=null!==a&&void 0!==a?a:new WM,this._viewportCoords=null!==o&&void 0!==o?o:new MP,this._mode=!1!==i?HO.Enabled:HO.Disabled,this._panImagesSubject$=new Af,this._panImages$=this._panImagesSubject$.pipe(Mv([]),_v(1),Ef()),this._subscriptions.push(this._panImages$.subscribe())}return $d(e,[{key:"panImages$",get:function(){return this._panImages$}},{key:"dispose",value:function(){this.stop(),null!=this._panImagesSubscription&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}},{key:"enable",value:function(){this._mode===HO.Disabled&&(this._mode=HO.Enabled,this.start())}},{key:"disable",value:function(){this._mode!==HO.Disabled&&(this.stop(),this._mode=HO.Disabled)}},{key:"start",value:function(){var e=this;if(this._mode===HO.Enabled){var t=this._stateService.currentImage$.pipe(Tv((function(t){if(!t.merged||qM(t.cameraType))return pp([]);var n=pp(t),i=e._graphCalculator.boundingBoxCorners(t.lngLat,20),r=e._graphService.cacheBoundingBox$(i[0],i[1]).pipe(Kp((function(e){return console.error("Failed to cache periphery bounding box (".concat(t.id,")"),e),Hf()})),xp((function(n){if(qM(t.cameraType))return[];var i,r=[],a=Pd(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.id!==t.id&&(o.mergeId===t.mergeId&&(qM(o.cameraType)||e._distance(o,t)>4||r.push(o)))}}catch(MN){a.e(MN)}finally{a.f()}return r})));return Lp(n,r).pipe(Lv(e._stateService.reference$),xp((function(t){var n,i=s(t,2),r=s(i[0],2),a=r[0],o=r[1],u=i[1],l=e._spatial.viewingDirection(a.rotation),c=XM({lat:a.lngLat.lat,lng:a.lngLat.lng,alt:a.computedAltitude},a.rotation,u),h=e._createTransform(a,c),d=e._spatial.wrap(e._spatial.azimuthal(l.toArray(),h.upVector().toArray()),0,2*Math.PI),f=e._computeProjectedPoints(h),p=e._computeHorizontalFov(f)/180*Math.PI,v=Math.PI/8,m=void 0,g=void 0,_=Pd(o);try{for(_.s();!(n=_.n()).done;){var y=n.value,b=XM({lat:y.lngLat.lat,lng:y.lngLat.lng,alt:y.computedAltitude},y.rotation,u),x=e._createTransform(y,b),w=e._computeProjectedPoints(x),k=e._computeHorizontalFov(w)/180*Math.PI,S=e._spatial.viewingDirection(y.rotation),M=e._spatial.wrap(e._spatial.azimuthal(S.toArray(),x.upVector().toArray()),0,2*Math.PI),T=e._spatial.angleBetweenVector2(l.x,l.y,S.x,S.y),C=Number.NEGATIVE_INFINITY;C=T>0?d>M?d-2*Math.PI+p/2-(M-k/2):d+p/2-(M-k/2):d<M?M+k/2-(d+2*Math.PI-p/2):M+k/2-(d-p/2);var E=Math.abs(k-C),P=e._distance(y,a)+Math.min(e._timeDifference(y,a),4)+20*Math.abs(C-v)+Math.min(5,1/Math.min(k/p,1))+(C>0?-2*E:0);C>0&&C<.5*p&&C<.5*k&&E>.5*p&&(T>0?m?P<m[0]&&(m=[P,y,x,k]):m=[P,y,x,k]:g?P<g[0]&&(g=[P,y,x,k]):g=[P,y,x,k])}}catch(MN){_.e(MN)}finally{_.f()}var L=[];return m&&L.push([m[1],m[2],m[3]]),g&&L.push([g[1],g[2],g[3]]),L})),Mv([]))})));this._panImagesSubscription=this._stateService.currentState$.pipe(xp((function(e){return e.state.imagesAhead>0})),ov(),Tv((function(e){return e?pp([]):t}))).subscribe((function(t){e._panImagesSubject$.next(t)})),this._mode=HO.Started}}},{key:"stop",value:function(){this._mode===HO.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=HO.Enabled)}},{key:"_distance",value:function(e,t){var n=s(IM(e.lngLat.lng,e.lngLat.lat,e.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude),3),i=n[0],r=n[1],a=n[2];return Math.sqrt(i*i+r*r+a*a)}},{key:"_timeDifference",value:function(e,t){return Math.abs(e.capturedAt-t.capturedAt)/2592e6}},{key:"_createTransform",value:function(e,t){return new EL(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.assetsCached?e.image:void 0,void 0,e.cameraParameters,e.cameraType)}},{key:"_computeProjectedPoints",value:function(e){return YM(e,[[1,0]],[[0,.5]],20,this._viewportCoords)}},{key:"_computeHorizontalFov",value:function(e){var t=this,n=e.map((function(e){return t._coordToFov(e[0])}));return Math.min.apply(Math,wd(n))}},{key:"_coordToFov",value:function(e){return 2*Math.atan(e)*180/Math.PI}}]),e}(),uz=function(){function e(t){Fd(this,e),this._data=t}return $d(e,[{key:"data",get:function(){return this._data}},{key:"getCoreImages$",value:function(e){return this._wrap$(this._data.getCoreImages(e))}},{key:"getImages$",value:function(e){return this._wrap$(this._data.getImages(e))}},{key:"getImageTiles$",value:function(e){return this._wrap$(this._data.getImageTiles(e))}},{key:"getSequence$",value:function(e){return this._wrap$(this._data.getSequence(e))}},{key:"getSpatialImages$",value:function(e){return this._wrap$(this._data.getSpatialImages(e))}},{key:"setAccessToken",value:function(e){this._data.setAccessToken(e)}},{key:"_wrap$",value:function(e){return kf.create((function(t){e.then((function(e){t.next(e),t.complete()}),(function(e){t.error(e)}))}))}}]),e}(),lz=function(){function e(t){var n=this;Fd(this,e),this._dataAdded$=new Af,this._subscriptions=new bP,this._onDataAdded=function(e){n._graph$.pipe(dv(),Np((function(t){return t.updateCells$(e.cellIds).pipe(Pv((function(){t.resetSpatialEdges()})))}))).subscribe((function(e){n._dataAdded$.next(e)}))};var i=this._subscriptions;this._graph$=zp(pp(t),t.changed$).pipe(_v(1),Ef()),i.push(this._graph$.subscribe((function(){}))),this._graphMode=xL.Spatial,this._graphModeSubject$=new Af,this._graphMode$=this._graphModeSubject$.pipe(Mv(this._graphMode),_v(1),Ef()),i.push(this._graphMode$.subscribe((function(){}))),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],t.api.data.on("datacreate",this._onDataAdded)}return $d(e,[{key:"dataAdded$",get:function(){return this._dataAdded$}},{key:"filter$",get:function(){return this._graph$.pipe(dv(),Np((function(e){return e.filter$})))}},{key:"graphMode$",get:function(){return this._graphMode$}},{key:"cacheBoundingBox$",value:function(e,t){return this._graph$.pipe(dv(),Np((function(n){return n.cacheBoundingBox$(e,t)})))}},{key:"cacheCell$",value:function(e){return this._graph$.pipe(dv(),Np((function(t){return t.cacheCell$(e)})))}},{key:"cacheImage$",value:function(e){var t=this,n=new Af;this._firstGraphSubjects$.push(n);var i,r=n.pipe(_v(1),Ef()),a=r.pipe(xp((function(t){return t.getNode(e)})),Np((function(e){return e.assetsCached?pp(e):e.cacheAssets$()})),_v(1),Ef());a.subscribe(void 0,(function(t){console.error("Failed to cache image (".concat(e,")."),t)})),(i=this._graph$.pipe(dv(),Np((function(t){return t.isCachingFull(e)||!t.hasNode(e)?t.cacheFull$(e):t.isCachingFill(e)||!t.getNode(e).complete?t.cacheFill$(e):pp(t)})),Pv((function(t){if(!t.hasNode(e))throw new JM("Failed to cache image (".concat(e,")"));t.hasInitializedCache(e)||t.initializeCache(e)})),hv((function(){null!=i&&(t._removeFromArray(i,t._initializeCacheSubscriptions),t._removeFromArray(n,t._firstGraphSubjects$))}))).subscribe((function(e){n.next(e),n.complete()}),(function(e){n.error(e)}))).closed||this._initializeCacheSubscriptions.push(i);var o,s,u=r.pipe(Kp((function(){return Hf()})),Np((function(t){return t.isCachingNodeSequence(e)||!t.hasNodeSequence(e)?t.cacheNodeSequence$(e):pp(t)})),_v(1),Ef());((o=u.pipe(Pv((function(t){t.getNode(e).sequenceEdges.cached||t.cacheSequenceEdges(e)})),hv((function(){null!=o&&t._removeFromArray(o,t._sequenceSubscriptions)}))).subscribe((function(){}),(function(t){console.error("Failed to cache sequence edges (".concat(e,")."),t)}))).closed||this._sequenceSubscriptions.push(o),this._graphMode===xL.Spatial)&&((s=r.pipe(Kp((function(){return Hf()})),cv((function(t){return t.hasTiles(e)?Hf():rp(t.cacheTiles$(e)).pipe(Np((function(t){return t.pipe(Np((function(t){return t.isCachingTiles(e)?Hf():pp(t)})),Kp((function(t){return console.error("Failed to cache tile data (".concat(e,")."),t),Hf()})))})))})),fv(1),Np((function(t){return t.hasSpatialArea(e)?pp(t):rp(t.cacheSpatialArea$(e)).pipe(Np((function(t){return t.pipe(Kp((function(t){return console.error("Failed to cache spatial images (".concat(e,")."),t),Hf()})))})))})),fv(1),Np((function(t){return t.hasNodeSequence(e)?pp(t):t.cacheNodeSequence$(e)})),Pv((function(t){t.getNode(e).spatialEdges.cached||t.cacheSpatialEdges(e)})),hv((function(){null!=s&&t._removeFromArray(s,t._spatialSubscriptions)}))).subscribe((function(){}),(function(t){var n="Failed to cache spatial edges (".concat(e,").");console.error(n,t)}))).closed||this._spatialSubscriptions.push(s));return a.pipe(dv((function(e){return e.assetsCached})))}},{key:"cacheSequence$",value:function(e){return this._graph$.pipe(dv(),Np((function(t){return t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):pp(t)})),xp((function(t){return t.getSequence(e)})))}},{key:"cacheSequenceImages$",value:function(e,t){return this._graph$.pipe(dv(),Np((function(t){return t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):pp(t)})),Np((function(n){return n.isCachingSequenceNodes(e)||!n.hasSequenceNodes(e)?n.cacheSequenceNodes$(e,t):pp(n)})),xp((function(t){return t.getSequence(e)})))}},{key:"dispose",value:function(){this._graph$.pipe(dv()).subscribe((function(e){e.unsubscribe()})),this._subscriptions.unsubscribe()}},{key:"setFilter$",value:function(e){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(dv(),Pv((function(t){t.resetSpatialEdges(),t.setFilter(e)})),xp((function(){})))}},{key:"setGraphMode",value:function(e){this._graphMode!==e&&(e===xL.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=e,this._graphModeSubject$.next(this._graphMode))}},{key:"reset$",value:function(e){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(dv(),Pv((function(t){t.reset(e)})),xp((function(){})))}},{key:"uncache$",value:function(e,t,n){return this._graph$.pipe(dv(),Pv((function(i){i.uncache(e,t,n)})),xp((function(){})))}},{key:"_abortSubjects",value:function(e){var t,n=Pd(e.slice());try{for(n.s();!(t=n.n()).done;){var i=t.value;this._removeFromArray(i,e),i.error(new Error("Cache image request was aborted."))}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"_removeFromArray",value:function(e,t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},{key:"_resetSubscriptions",value:function(e){var t,n=Pd(e.slice());try{for(n.s();!(t=n.n()).done;){var i=t.value;this._removeFromArray(i,e),i.closed||i.unsubscribe()}}catch(MN){n.e(MN)}finally{n.f()}}}]),e}(),cz=function(){function e(t){Fd(this,e),t.requestAnimationFrame?(this._cancelAnimationFrame=t.cancelAnimationFrame.bind(t),this._requestAnimationFrame=t.requestAnimationFrame.bind(t)):t.mozRequestAnimationFrame?(this._cancelAnimationFrame=t.mozCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.mozRequestAnimationFrame.bind(t)):t.webkitRequestAnimationFrame?(this._cancelAnimationFrame=t.webkitCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.webkitRequestAnimationFrame.bind(t)):t.msRequestAnimationFrame?(this._cancelAnimationFrame=t.msCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.msRequestAnimationFrame.bind(t)):t.oRequestAnimationFrame?(this._cancelAnimationFrame=t.oCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.oRequestAnimationFrame.bind(t)):(this._cancelAnimationFrame=t.clearTimeout.bind(t),this._requestAnimationFrame=function(e){return t.setTimeout(e,1e3/60)})}return $d(e,[{key:"cancelAnimationFrame",get:function(){return this._cancelAnimationFrame}},{key:"requestAnimationFrame",get:function(){return this._requestAnimationFrame}}]),e}(),hz=function(){function e(t){Fd(this,e),this._spatial=new WM,this._referenceThreshold=.01,this._transitionMode=t.transitionMode,this._reference=t.reference,this._alpha=t.alpha,this._stateTransitionAlpha=0,this._camera=t.camera.clone(),this._zoom=t.zoom,this._currentIndex=t.currentIndex,this._trajectory=t.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];var n,i=Pd(this._trajectory);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this._imageToTranslation(r,this._reference),o=new EL(r.exifOrientation,r.width,r.height,r.scale,r.rotation,a,r.image,void 0,r.cameraParameters,r.cameraType);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new ZO(o))}}catch(MN){i.e(MN)}finally{i.f()}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new ZO,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}return $d(e,[{key:"reference",get:function(){return this._reference}},{key:"alpha",get:function(){return this._getAlpha()}},{key:"stateTransitionAlpha",get:function(){return this._getStateTransitionAlpha()}},{key:"camera",get:function(){return this._camera}},{key:"zoom",get:function(){return this._zoom}},{key:"trajectory",get:function(){return this._trajectory}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"currentImage",get:function(){return this._currentImage}},{key:"previousImage",get:function(){return this._previousImage}},{key:"currentCamera",get:function(){return this._currentCamera}},{key:"currentTransform",get:function(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}},{key:"previousTransform",get:function(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}},{key:"motionless",get:function(){return this._motionless}},{key:"transitionMode",get:function(){return this._transitionMode}},{key:"move",value:function(e){}},{key:"moveTo",value:function(e){}},{key:"rotate",value:function(e){}},{key:"rotateUnbounded",value:function(e){}},{key:"rotateWithoutInertia",value:function(e){}},{key:"rotateBasic",value:function(e){}},{key:"rotateBasicUnbounded",value:function(e){}},{key:"rotateBasicWithoutInertia",value:function(e){}},{key:"rotateToBasic",value:function(e){}},{key:"setSpeed",value:function(e){}},{key:"zoomIn",value:function(e,t){}},{key:"update",value:function(e){}},{key:"setCenter",value:function(e){}},{key:"setZoom",value:function(e){}},{key:"dolly",value:function(e){}},{key:"orbit",value:function(e){}},{key:"setViewMatrix",value:function(e){}},{key:"truck",value:function(e){}},{key:"append",value:function(e){if(e.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(e):(this._trajectory=this._trajectory.concat(e),this._appendToTrajectories(e))}},{key:"prepend",value:function(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=e.slice().concat(this._trajectory),this._currentIndex+=e.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(e),this._setCurrentCamera()}},{key:"remove",value:function(e){if(e<0)throw Error("n must be a positive integer");if(this._currentIndex-1<e)throw Error("Current and previous images can not be removed");for(var t=0;t<e;t++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}},{key:"clearPrior",value:function(){this._currentIndex>0&&this.remove(this._currentIndex-1)}},{key:"clear",value:function(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}},{key:"cut",value:function(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}},{key:"set",value:function(e){this._setTrajectory(e),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}},{key:"getCenter",value:function(){return null!=this._currentImage?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}},{key:"setTransitionMode",value:function(e){this._transitionMode=e}},{key:"_getAlpha",value:function(){return 1}},{key:"_getStateTransitionAlpha",value:function(){return 1}},{key:"_setCurrent",value:function(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}},{key:"_setCurrentCamera",value:function(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}},{key:"_motionlessTransition",value:function(){return null!=this._currentImage&&null!=this._previousImage&&(this._transitionMode===VO.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}},{key:"_setReference",value:function(e){return!(Math.abs(e.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(e.lngLat.lng-this.reference.lng)<this._referenceThreshold)&&(!(null!=this._previousImage&&!this._motionlessTransition())&&(this._reference.lat=e.lngLat.lat,this._reference.lng=e.lngLat.lng,this._reference.alt=e.computedAltitude,!0))}},{key:"_setCurrentImage",value:function(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}},{key:"_setTrajectory",value:function(e){if(e.length<1)throw new HM("Trajectory can not be empty");null!=this._currentImage?(this._trajectory=[this._currentImage].concat(e),this._currentIndex=1):(this._trajectory=e.slice(),this._currentIndex=0)}},{key:"_setTrajectories",value:function(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}},{key:"_appendToTrajectories",value:function(e){var t,n=Pd(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!i.assetsCached)throw new HM("Assets must be cached when image is added to trajectory");var r=this._imageToTranslation(i,this.reference),a=new EL(i.exifOrientation,i.width,i.height,i.scale,i.rotation,r,i.image,void 0,i.cameraParameters,i.cameraType);this._trajectoryTransforms.push(a),this._trajectoryCameras.push(new ZO(a))}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"_prependToTrajectories",value:function(e){var t,n=Pd(e.reverse());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!i.assetsCached)throw new HM("Assets must be cached when added to trajectory");var r=this._imageToTranslation(i,this.reference),a=new EL(i.exifOrientation,i.width,i.height,i.scale,i.rotation,r,i.image,void 0,i.cameraParameters,i.cameraType);this._trajectoryTransforms.unshift(a),this._trajectoryCameras.unshift(new ZO(a))}}catch(MN){n.e(MN)}finally{n.f()}}},{key:"_imageToTranslation",value:function(e,t){return XM({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t)}},{key:"_sameConnectedComponent",value:function(){var e=this._currentImage,t=this._previousImage;return!!e&&!!t&&e.mergeId===t.mergeId}},{key:"_withinOriginalDistance",value:function(){var e=this._currentImage,t=this._previousImage;return!e||!t||this._spatial.distanceFromLngLat(e.originalLngLat.lng,e.originalLngLat.lat,t.originalLngLat.lng,t.originalLngLat.lat)<25}}]),e}(),dz=function(e){Dd(n,e);var t=Od(n);function n(e){return Fd(this,n),t.call(this,e)}return $d(n,[{key:"setViewMatrix",value:function(e){var t=(new bg).fromArray(e).invert().elements,n=new Vm(t[12],t[13],t[14]),i=new Vm(-t[8],-t[9],-t[10]),r=new Vm(t[4],t[5],t[6]),a=this._camera;a.position.copy(n),a.lookat.copy(n.clone().add(i)),a.up.copy(r);var o=.5/Math.tan(Math.PI/3);a.focal=o}}]),n}(hz),fz=function(e){Dd(n,e);var t=Od(n);function n(e){var i;Fd(this,n),(i=t.call(this,e))._transition=0;var r=i._camera.position.clone(),a=i._camera.lookat.clone().sub(r).normalize(),o=Math.sqrt(a.x*a.x+a.y*a.y),s=Math.atan2(a.z,o),u=new Vm;if(s>-Math.PI/45)u.copy(r),r.add(new Vm(a.x,a.y,0).multiplyScalar(-50)),r.z=30;else{var l=r.clone(),c=new Vm(0,0,1),h=new Vm(0,0,-2),d=(new Vm).subVectors(h,l).dot(c)/a.dot(c),f=l.clone().add(a.clone().multiplyScalar(Math.min(1e4,d)));u.copy(f);var p=r.clone().sub(f).normalize();r.copy(f.add(p.multiplyScalar(Math.max(50,p.length()))))}var v=i._camera.position.clone(),m=v.clone().add(a.clone().normalize().multiplyScalar(10)),g=i._camera.up.clone(),_=m.clone(),y=_.clone().add(a.clone().normalize().multiplyScalar(10)),b=g.clone(),x=r.clone(),w=u.clone(),k=new Vm(0,0,1),S=r.clone().add(w.clone().sub(x).normalize().multiplyScalar(-10)),M=w.clone(),T=k.clone();return i._curveE=new uk([_,v,x,S]),i._curveL=new uk([y,m,w,M]),i._curveU=new uk([b,g,k,T]),i._zoom0=i._zoom,i._zoom1=0,i._camera.focal=.5/Math.tan(Math.PI/4),i}return $d(n,[{key:"_isTransitioning",get:function(){return this._transition<1}},{key:"dolly",value:function(e){if(!this._isTransitioning){var t=this._camera,n=t.position.clone().sub(t.lookat),i=n.length()*Math.pow(2,-e),r=Math.max(1,Math.min(i,4e3));n.normalize(),n.multiplyScalar(r),t.position.copy(t.lookat).add(n)}}},{key:"orbit",value:function(e){if(!this._isTransitioning){var t=this._camera,n=(new Um).setFromUnitVectors(t.up,new Vm(0,0,1)),i=n.clone().invert(),r=t.position.clone().sub(t.lookat);r.applyQuaternion(n);var a=r.length(),o=Math.atan2(r.y,r.x);o+=e.phi;var s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=e.theta;var u=Math.PI/36;s=Math.max(u,Math.min(Math.PI/2-u,s)),r.x=Math.sin(s)*Math.cos(o),r.y=Math.sin(s)*Math.sin(o),r.z=Math.cos(s),r.applyQuaternion(i),t.position.copy(t.lookat).add(r.multiplyScalar(a))}}},{key:"truck",value:function(e){if(!this._isTransitioning){var t=this._camera;t.position.add((new Vm).fromArray(e)),t.lookat.add((new Vm).fromArray(e))}}},{key:"update",value:function(e){if(this._isTransitioning){this._transition=Math.min(this._transition+2*e/3,1);var t=Cm.smootherstep(this._transition,0,1),n=(t+1)/3,i=this._curveE.getPoint(n),r=this._curveL.getPoint(n),a=this._curveU.getPoint(n);this._camera.position.copy(i),this._camera.lookat.copy(r),this._camera.up.copy(a),this._zoom=Cm.lerp(this._zoom0,this._zoom1,t),this._stateTransitionAlpha=t}}},{key:"_getStateTransitionAlpha",value:function(){return this._stateTransitionAlpha}}]),n}(hz),pz=function(){function e(t,n){Fd(this,e),this._phi=t,this._theta=n}return $d(e,[{key:"phi",get:function(){return this._phi},set:function(e){this._phi=e}},{key:"theta",get:function(){return this._theta},set:function(e){this._theta=e}},{key:"isZero",get:function(){return 0===this._phi&&0===this._theta}},{key:"copy",value:function(e){this._phi=e.phi,this._theta=e.theta}},{key:"lerp",value:function(e,t){this._phi=(1-t)*this._phi+t*e.phi,this._theta=(1-t)*this._theta+t*e.theta}},{key:"multiply",value:function(e){this._phi*=e,this._theta*=e}},{key:"threshold",value:function(e){this._phi=Math.abs(this._phi)>e?this._phi:0,this._theta=Math.abs(this._theta)>e?this._theta:0}},{key:"lengthSquared",value:function(){return this._phi*this._phi+this._theta*this._theta}},{key:"reset",value:function(){this._phi=0,this._theta=0}}]),e}(),vz=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e))._animationSpeed=1/40,i._rotationDelta=new pz(0,0),i._requestedRotationDelta=null,i._basicRotation=[0,0],i._requestedBasicRotation=null,i._requestedBasicRotationUnbounded=null,i._rotationAcceleration=.86,i._rotationIncreaseAlpha=.97,i._rotationDecreaseAlpha=.9,i._rotationThreshold=.001,i._unboundedRotationAlpha=.8,i._desiredZoom=e.zoom,i._minZoom=0,i._maxZoom=3,i._lookatDepth=10,i._desiredLookat=null,i._desiredCenter=null,i}return $d(n,[{key:"rotate",value:function(e){null!=this._currentImage&&(0===e.phi&&0===e.theta||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,null!=this._requestedRotationDelta?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+e.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+e.theta):this._requestedRotationDelta=new pz(e.phi,e.theta)))}},{key:"rotateUnbounded",value:function(e){if(null!=this._currentImage&&(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(e,this._currentCamera),this._applyRotation(e,this._previousCamera),this._desiredLookat)){var t=(new Um).setFromUnitVectors(this._currentCamera.up,new Vm(0,0,1)),n=t.clone().invert(),i=(new Vm).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(t),r=i.length(),a=Math.atan2(i.y,i.x);a+=e.phi;var o=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);o+=e.theta,o=Math.max(.1,Math.min(Math.PI-.1,o)),i.x=Math.sin(o)*Math.cos(a),i.y=Math.sin(o)*Math.sin(a),i.z=Math.cos(o),i.applyQuaternion(n),this._desiredLookat.copy(this._camera.position).add(i.multiplyScalar(r))}}},{key:"rotateWithoutInertia",value:function(e){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;var t=Math.PI/(10*Math.pow(2,this._zoom)),n={phi:this._spatial.clamp(e.phi,-t,t),theta:this._spatial.clamp(e.theta,-t,t)};this._applyRotation(n,this._currentCamera),this._applyRotation(n,this._previousCamera)}}},{key:"rotateBasic",value:function(e){if(null!=this._currentImage)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,null!=this._requestedBasicRotation){this._requestedBasicRotation[0]+=e[0],this._requestedBasicRotation[1]+=e[1];var t=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-t,t),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-t,t)}else this._requestedBasicRotation=e.slice()}},{key:"rotateBasicUnbounded",value:function(e){null!=this._currentImage&&(null!=this._requestedBasicRotationUnbounded?(this._requestedBasicRotationUnbounded[0]+=e[0],this._requestedBasicRotationUnbounded[1]+=e[1]):this._requestedBasicRotationUnbounded=e.slice())}},{key:"rotateBasicWithoutInertia",value:function(e){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;var t=.05/Math.pow(2,this._zoom),n=e.slice();n[0]=this._spatial.clamp(n[0],-t,t),n[1]=this._spatial.clamp(n[1],-t,t),this._applyRotationBasic(n)}}},{key:"rotateToBasic",value:function(e){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,e[0]=this._spatial.clamp(e[0],0,1),e[1]=this._spatial.clamp(e[1],0,1);var t=this.currentTransform.unprojectBasic(e,this._lookatDepth);this._currentCamera.lookat.fromArray(t)}}},{key:"zoomIn",value:function(e,t){if(null!=this._currentImage){this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+e));var n=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),i=n[0],r=n[1],a=Math.pow(2,this._zoom),o=Math.pow(2,this._desiredZoom),s=t[0],u=t[1];qM(this.currentTransform.cameraType)&&(s-i>.5?s-=1:i-s>.5&&(s=1+s));var l=s-a/o*(s-i),c=u-a/o*(u-r);qM(this._currentImage.cameraType)?(l=this._spatial.wrap(l+this._basicRotation[0],0,1),c=this._spatial.clamp(c+this._basicRotation[1],.05,.95)):(l=this._spatial.clamp(l,0,1),c=this._spatial.clamp(c,0,1)),this._desiredLookat=(new Vm).fromArray(this.currentTransform.unprojectBasic([l,c],this._lookatDepth))}}},{key:"setCenter",value:function(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;var t=[this._spatial.clamp(e[0],0,1),this._spatial.clamp(e[1],0,1)];if(null!=this._currentImage){this._desiredCenter=null;var n=(new Vm).fromArray(this.currentTransform.unprojectBasic(t,this._lookatDepth)),i=null!=this.previousTransform?this.previousTransform:this.currentTransform,r=(new Vm).fromArray(i.unprojectBasic(t,this._lookatDepth));this._currentCamera.lookat.copy(n),this._previousCamera.lookat.copy(r)}else this._desiredCenter=t}},{key:"setZoom",value:function(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(e,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}},{key:"_applyRotation",value:function(e,t){if(null!=t){var n=(new Um).setFromUnitVectors(t.up,new Vm(0,0,1)),i=n.clone().invert(),r=new Vm;r.copy(t.lookat).sub(t.position),r.applyQuaternion(n);var a=r.length(),o=Math.atan2(r.y,r.x);o+=e.phi;var s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=e.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),r.x=Math.sin(s)*Math.cos(o),r.y=Math.sin(s)*Math.sin(o),r.z=Math.cos(s),r.applyQuaternion(i),t.lookat.copy(t.position).add(r.multiplyScalar(a))}}},{key:"_applyRotationBasic",value:function(e){var t=this._currentImage,n=null!=this._previousImage?this.previousImage:this.currentImage,i=this._currentCamera,r=this._previousCamera,a=this.currentTransform,o=null!=this.previousTransform?this.previousTransform:this.currentTransform,s=a.projectBasic(i.lookat.toArray()),u=o.projectBasic(r.lookat.toArray());qM(t.cameraType)?(s[0]=this._spatial.wrap(s[0]+e[0],0,1),s[1]=this._spatial.clamp(s[1]+e[1],.05,.95)):(s[0]=this._spatial.clamp(s[0]+e[0],0,1),s[1]=this._spatial.clamp(s[1]+e[1],0,1)),qM(n.cameraType)?(u[0]=this._spatial.wrap(u[0]+e[0],0,1),u[1]=this._spatial.clamp(u[1]+e[1],.05,.95)):(u[0]=this._spatial.clamp(u[0]+e[0],0,1),u[1]=this._spatial.clamp(s[1]+e[1],0,1));var l=a.unprojectBasic(s,this._lookatDepth);i.lookat.fromArray(l);var c=o.unprojectBasic(u,this._lookatDepth);r.lookat.fromArray(c)}},{key:"_updateZoom",value:function(e){var t=this._desiredZoom-this._zoom,n=t>0?1:t<0?-1:0;0!==t&&(Math.abs(t)<.002?(this._zoom=this._desiredZoom,null!=this._desiredLookat&&(this._desiredLookat=null)):this._zoom+=n*Math.max(Math.abs(5*e*t),.002))}},{key:"_updateLookat",value:function(e){if(null!==this._desiredLookat){var t=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(t)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*e)}}},{key:"_updateRotation",value:function(){if(null!=this._requestedRotationDelta){var e=this._rotationDelta.lengthSquared();return this._requestedRotationDelta.lengthSquared()>e?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null)}if(!this._rotationDelta.isZero){var t=qM(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*t),this._rotationDelta.threshold(this._rotationThreshold)}}},{key:"_updateRotationBasic",value:function(){if(null!=this._requestedBasicRotation){var e=this._basicRotation[0],t=this._basicRotation[1],n=this._requestedBasicRotation[0],i=this._requestedBasicRotation[1];return Math.abs(n)>Math.abs(e)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*n:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*n,Math.abs(i)>Math.abs(t)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*i:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*i,void(this._requestedBasicRotation=null)}if(null!=this._requestedBasicRotationUnbounded){var r=this._requestedBasicRotationUnbounded[0],a=this._requestedBasicRotationUnbounded[1];if(Math.abs(r)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*r),Math.abs(a)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*a),null!=this._desiredLookat){var o=this.currentTransform.projectBasic(this._desiredLookat.toArray());o[0]+=r,o[1]+=a,this._desiredLookat=(new Vm).fromArray(this.currentTransform.unprojectBasic(o,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}0===this._basicRotation[0]&&0===this._basicRotation[1]||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}},{key:"_clearRotation",value:function(){qM(this._currentImage.cameraType)||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),null!=this._requestedBasicRotation&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}},{key:"_setDesiredCenter",value:function(){if(null!=this._desiredCenter){var e=(new Vm).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(e)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(e)),this._desiredCenter=null}}},{key:"_setDesiredZoom",value:function(){this._desiredZoom=qM(this._currentImage.cameraType)||null==this._previousImage?this._zoom:0}}]),n}(hz),mz=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e))._adjustCameras(),i._motionless=i._motionlessTransition(),i}return $d(n,[{key:"prepend",value:function(e){Nd(kd(n.prototype),"prepend",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"set",value:function(e){Nd(kd(n.prototype),"set",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"move",value:function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}},{key:"moveTo",value:function(e){this._alpha=Math.max(0,Math.min(1,e))}},{key:"update",value:function(e){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation);var t=this._animationSpeed*e/.1*6;this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.round(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){Nd(kd(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){if(qM(this._currentImage.cameraType)){var e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(qM(this._previousImage.cameraType)){var t=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position))}}}}]),n}(vz),gz=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e))._adjustCameras(),i._motionless=i._motionlessTransition(),i._baseAlpha=i._alpha,i._speedCoefficient=1,i._smoothing=!1,i}return $d(n,[{key:"append",value:function(e){var t=0===this._trajectory.length;t&&this._resetTransition(),Nd(kd(n.prototype),"append",this).call(this,e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}},{key:"prepend",value:function(e){var t=0===this._trajectory.length;t&&this._resetTransition(),Nd(kd(n.prototype),"prepend",this).call(this,e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}},{key:"set",value:function(e){Nd(kd(n.prototype),"set",this).call(this,e),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._smoothing=!0)}},{key:"setSpeed",value:function(e){this._speedCoefficient=this._spatial.clamp(e,0,10)}},{key:"update",value:function(e){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._smoothing=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=qM(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);var t=this._animationSpeed*e/.1*6;this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*t),this._smoothing?this._alpha=Cm.smootherstep(this._baseAlpha,0,1):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation),this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.ceil(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){Nd(kd(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){var e=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position)),qM(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}}},{key:"_resetTransition",value:function(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}]),n}(vz),_z=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e))._zoom=0,i._adjustCameras(),i._motionless=i._motionlessTransition(),i}return $d(n,[{key:"prepend",value:function(e){Nd(kd(n.prototype),"prepend",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"set",value:function(e){Nd(kd(n.prototype),"set",this).call(this,e),this._motionless=this._motionlessTransition()}},{key:"move",value:function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}},{key:"moveTo",value:function(e){this._alpha=Math.max(0,Math.min(1,e))}},{key:"update",value:function(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.round(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){Nd(kd(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){if(qM(this._currentImage.cameraType)){var e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(qM(this._previousImage.cameraType)){var t=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position))}}}}]),n}(hz),yz=function(){function e(){Fd(this,e);var t=XP[XP.Custom],n=XP[XP.Earth],i=XP[XP.Traversing],r=XP[XP.Waiting],a=XP[XP.WaitingInteractively];this._creators=new Map;var o=this._creators;o.set(t,dz),o.set(n,fz),o.set(i,gz),o.set(r,_z),o.set(a,mz),this._transitions=new Map;var s=this._transitions;s.set(t,[n,i]),s.set(n,[t,i]),s.set(i,[t,n,r,a]),s.set(r,[i,a]),s.set(a,[i,r])}return $d(e,[{key:"getState",value:function(e){if(e instanceof dz)return XP.Custom;if(e instanceof fz)return XP.Earth;if(e instanceof gz)return XP.Traversing;if(e instanceof _z)return XP.Waiting;if(e instanceof mz)return XP.WaitingInteractively;throw new Error("Invalid state instance")}},{key:"generate",value:function(e,t){return new(this._creators.get(XP[e]))(t)}},{key:"transition",value:function(e,t){if(!this.validate(e,t))throw new Error("Invalid transition");return this.generate(t,e)}},{key:"validate",value:function(e,t){var n=XP[this.getState(e)],i=XP[t],r=this._transitions;return r.has(n)&&r.get(n).includes(i)}}]),e}(),bz=function(){function e(t,n){Fd(this,e),this._transitions=new yz,this._state=this._transitions.generate(t,{alpha:1,camera:new ZO,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:null==n?VO.Default:n,zoom:0})}return $d(e,[{key:"state",get:function(){return this._transitions.getState(this._state)}},{key:"reference",get:function(){return this._state.reference}},{key:"alpha",get:function(){return this._state.alpha}},{key:"stateTransitionAlpha",get:function(){return this._state.stateTransitionAlpha}},{key:"camera",get:function(){return this._state.camera}},{key:"zoom",get:function(){return this._state.zoom}},{key:"currentImage",get:function(){return this._state.currentImage}},{key:"previousImage",get:function(){return this._state.previousImage}},{key:"currentCamera",get:function(){return this._state.currentCamera}},{key:"currentTransform",get:function(){return this._state.currentTransform}},{key:"previousTransform",get:function(){return this._state.previousTransform}},{key:"trajectory",get:function(){return this._state.trajectory}},{key:"currentIndex",get:function(){return this._state.currentIndex}},{key:"lastImage",get:function(){return this._state.trajectory[this._state.trajectory.length-1]}},{key:"imagesAhead",get:function(){return this._state.trajectory.length-1-this._state.currentIndex}},{key:"motionless",get:function(){return this._state.motionless}},{key:"custom",value:function(){this._transition(XP.Custom)}},{key:"earth",value:function(){this._transition(XP.Earth)}},{key:"traverse",value:function(){this._transition(XP.Traversing)}},{key:"wait",value:function(){this._transition(XP.Waiting)}},{key:"waitInteractively",value:function(){this._transition(XP.WaitingInteractively)}},{key:"getCenter",value:function(){return this._state.getCenter()}},{key:"setCenter",value:function(e){this._state.setCenter(e)}},{key:"setZoom",value:function(e){this._state.setZoom(e)}},{key:"update",value:function(e){this._state.update(e)}},{key:"append",value:function(e){this._state.append(e)}},{key:"prepend",value:function(e){this._state.prepend(e)}},{key:"remove",value:function(e){this._state.remove(e)}},{key:"clear",value:function(){this._state.clear()}},{key:"clearPrior",value:function(){this._state.clearPrior()}},{key:"cut",value:function(){this._state.cut()}},{key:"set",value:function(e){this._state.set(e)}},{key:"setViewMatrix",value:function(e){this._state.setViewMatrix(e)}},{key:"rotate",value:function(e){this._state.rotate(e)}},{key:"rotateUnbounded",value:function(e){this._state.rotateUnbounded(e)}},{key:"rotateWithoutInertia",value:function(e){this._state.rotateWithoutInertia(e)}},{key:"rotateBasic",value:function(e){this._state.rotateBasic(e)}},{key:"rotateBasicUnbounded",value:function(e){this._state.rotateBasicUnbounded(e)}},{key:"rotateBasicWithoutInertia",value:function(e){this._state.rotateBasicWithoutInertia(e)}},{key:"rotateToBasic",value:function(e){this._state.rotateToBasic(e)}},{key:"move",value:function(e){this._state.move(e)}},{key:"moveTo",value:function(e){this._state.moveTo(e)}},{key:"zoomIn",value:function(e,t){this._state.zoomIn(e,t)}},{key:"setSpeed",value:function(e){this._state.setSpeed(e)}},{key:"setTransitionMode",value:function(e){this._state.setTransitionMode(e)}},{key:"dolly",value:function(e){this._state.dolly(e)}},{key:"orbit",value:function(e){this._state.orbit(e)}},{key:"truck",value:function(e){this._state.truck(e)}},{key:"_transition",value:function(e){if(this._transitions.validate(this._state,e)){var t=this._transitions.transition(this._state,e);this._state=t}else{var n=this._transitions.getState(this._state);console.warn("Transition not valid (".concat(XP[n]," - ").concat(XP[e],")"))}}}]),e}(),xz=function(){function e(t,n){var i=this;Fd(this,e),this._appendImage$=new Af,this._clock=new QS,this._subscriptions=new bP;var r=this._subscriptions;this._start$=new Af,this._frame$=new Af,this._contextOperation$=new Rf((function(e){return e})),this._context$=this._contextOperation$.pipe(bv((function(e,t){return t(e)}),new bz(t,n)),_v(1),Ef()),this._state$=this._context$.pipe(xp((function(e){return e.state})),ov(),_v(1),Ef()),this._currentState$=this._frame$.pipe(Lv(this._context$,(function(e,t){return[e,t]})),qp((function(e){return null!=e[1].currentImage})),Pv((function(e){e[1].update(i._clock.getDelta())})),xp((function(e){return{fps:60,id:e[0],state:e[1]}})),xv()),this._lastState$=this._currentState$.pipe(_v(1),Ef());var a=this._currentState$.pipe(ov(void 0,(function(e){return e.state.currentImage.id})),_v(1),Ef()),o=new Af;r.push(a.subscribe(o)),this._currentId$=new Rf(null),r.push(o.pipe(xp((function(e){return e.state.currentImage.id}))).subscribe(this._currentId$)),this._currentImage$=o.pipe(xp((function(e){return e.state.currentImage})),_v(1),Ef()),this._currentCamera$=o.pipe(xp((function(e){return e.state.currentCamera})),_v(1),Ef()),this._currentTransform$=o.pipe(xp((function(e){return e.state.currentTransform})),_v(1),Ef()),this._reference$=o.pipe(xp((function(e){return e.state.reference})),ov((function(e,t){return e.lat===t.lat&&e.lng===t.lng}),(function(e){return{lat:e.lat,lng:e.lng}})),_v(1),Ef()),this._currentImageExternal$=a.pipe(xp((function(e){return e.state.currentImage})),_v(1),Ef()),r.push(this._appendImage$.pipe(xp((function(e){return function(t){return t.append([e]),t}}))).subscribe(this._contextOperation$)),this._inMotionOperation$=new Af,r.push(a.pipe(xp((function(){return!0}))).subscribe(this._inMotionOperation$)),r.push(this._inMotionOperation$.pipe(ov(),qp((function(e){return e})),Tv((function(){return i._currentState$.pipe(qp((function(e){return 0===e.state.imagesAhead})),xp((function(e){return[e.state.camera.clone(),e.state.zoom]})),mv(),xp((function(e){var t=e[0][0],n=e[1][0],i=e[0][1],r=e[1][1];return t.diff(n)>1e-5||Math.abs(i-r)>1e-5})),dv((function(e){return!e})))}))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(ov(),_v(1),Ef()),this._inTranslationOperation$=new Af,r.push(a.pipe(xp((function(){return!0}))).subscribe(this._inTranslationOperation$)),r.push(this._inTranslationOperation$.pipe(ov(),qp((function(e){return e})),Tv((function(){return i._currentState$.pipe(qp((function(e){return 0===e.state.imagesAhead})),xp((function(e){return e.state.camera.position.clone()})),mv(),xp((function(e){return 0!==e[0].distanceToSquared(e[1])})),dv((function(e){return!e})))}))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(ov(),_v(1),Ef()),r.push(this._state$.subscribe((function(){}))),r.push(this._currentImage$.subscribe((function(){}))),r.push(this._currentCamera$.subscribe((function(){}))),r.push(this._currentTransform$.subscribe((function(){}))),r.push(this._reference$.subscribe((function(){}))),r.push(this._currentImageExternal$.subscribe((function(){}))),r.push(this._lastState$.subscribe((function(){}))),r.push(this._inMotion$.subscribe((function(){}))),r.push(this._inTranslation$.subscribe((function(){}))),this._frameId=null,this._frameGenerator=new cz(window)}return $d(e,[{key:"currentState$",get:function(){return this._currentState$}},{key:"currentImage$",get:function(){return this._currentImage$}},{key:"currentId$",get:function(){return this._currentId$}},{key:"currentImageExternal$",get:function(){return this._currentImageExternal$}},{key:"currentCamera$",get:function(){return this._currentCamera$}},{key:"currentTransform$",get:function(){return this._currentTransform$}},{key:"state$",get:function(){return this._state$}},{key:"reference$",get:function(){return this._reference$}},{key:"inMotion$",get:function(){return this._inMotion$}},{key:"inTranslation$",get:function(){return this._inTranslation$}},{key:"appendImage$",get:function(){return this._appendImage$}},{key:"dispose",value:function(){this.stop(),this._subscriptions.unsubscribe()}},{key:"custom",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.custom()}))}},{key:"earth",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.earth()}))}},{key:"traverse",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.traverse()}))}},{key:"wait",value:function(){this._invokeContextOperation((function(e){e.wait()}))}},{key:"waitInteractively",value:function(){this._invokeContextOperation((function(e){e.waitInteractively()}))}},{key:"appendImagess",value:function(e){this._invokeContextOperation((function(t){t.append(e)}))}},{key:"prependImages",value:function(e){this._invokeContextOperation((function(t){t.prepend(e)}))}},{key:"removeImages",value:function(e){this._invokeContextOperation((function(t){t.remove(e)}))}},{key:"clearImages",value:function(){this._invokeContextOperation((function(e){e.clear()}))}},{key:"clearPriorImages",value:function(){this._invokeContextOperation((function(e){e.clearPrior()}))}},{key:"cutImages",value:function(){this._invokeContextOperation((function(e){e.cut()}))}},{key:"setImages",value:function(e){this._invokeContextOperation((function(t){t.set(e)}))}},{key:"setViewMatrix",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.setViewMatrix(e)}))}},{key:"rotate",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotate(e)}))}},{key:"rotateUnbounded",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateUnbounded(e)}))}},{key:"rotateWithoutInertia",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateWithoutInertia(e)}))}},{key:"rotateBasic",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateBasic(e)}))}},{key:"rotateBasicUnbounded",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateBasicUnbounded(e)}))}},{key:"rotateBasicWithoutInertia",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateBasicWithoutInertia(e)}))}},{key:"rotateToBasic",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.rotateToBasic(e)}))}},{key:"move",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.move(e)}))}},{key:"moveTo",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.moveTo(e)}))}},{key:"dolly",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.dolly(e)}))}},{key:"orbit",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.orbit(e)}))}},{key:"truck",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.truck(e)}))}},{key:"zoomIn",value:function(e,t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(n){n.zoomIn(e,t)}))}},{key:"getCenter",value:function(){return this._lastState$.pipe(dv(),xp((function(e){return e.state.getCenter()})))}},{key:"getZoom",value:function(){return this._lastState$.pipe(dv(),xp((function(e){return e.state.zoom})))}},{key:"setCenter",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.setCenter(e)}))}},{key:"setSpeed",value:function(e){this._invokeContextOperation((function(t){t.setSpeed(e)}))}},{key:"setTransitionMode",value:function(e){this._invokeContextOperation((function(t){t.setTransitionMode(e)}))}},{key:"setZoom",value:function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.setZoom(e)}))}},{key:"start",value:function(){this._clock.start(),null==this._frameId&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}},{key:"stop",value:function(){this._clock.stop(),null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}},{key:"_invokeContextOperation",value:function(e){this._contextOperation$.next((function(t){return e(t),t}))}},{key:"_frame",value:function(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}]),e}();function wz(e){switch(e){case $O.Custom:return XP.Custom;case $O.Earth:return XP.Earth;case $O.Street:return XP.Traversing;default:return null}}var kz=function(){function e(t,n,i,r,a,o,s,u){var l;Fd(this,e),n?this._api=n:t.dataProvider?this._api=new uz(t.dataProvider):this._api=new uz(new BO({accessToken:t.accessToken})),this._graphService=null!==i&&void 0!==i?i:new lz(new QM(this.api)),this._loadingName="navigator",this._loadingService=null!==r&&void 0!==r?r:new oz;var c=null!==(l=t.cameraControls)&&void 0!==l?l:$O.Street;this._stateService=null!==a&&void 0!==a?a:new xz(wz(c),t.transitionMode),this._cacheService=null!==o&&void 0!==o?o:new az(this._graphService,this._stateService,this._api),this._playService=null!==s&&void 0!==s?s:new NL(this._graphService,this._stateService),this._panService=null!==u&&void 0!==u?u:new sz(this._graphService,this._stateService,t.combinedPanning),this._idRequested$=new Rf(null),this._movedToId$=new Rf(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}return $d(e,[{key:"api",get:function(){return this._api}},{key:"cacheService",get:function(){return this._cacheService}},{key:"graphService",get:function(){return this._graphService}},{key:"loadingService",get:function(){return this._loadingService}},{key:"movedToId$",get:function(){return this._movedToId$}},{key:"panService",get:function(){return this._panService}},{key:"playService",get:function(){return this._playService}},{key:"stateService",get:function(){return this._stateService}},{key:"dispose",value:function(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}},{key:"moveTo$",value:function(e){this._abortRequest("to id ".concat(e)),this._loadingService.startLoading(this._loadingName);var t=this._moveTo$(e);return this._makeRequest$(t)}},{key:"moveDir$",value:function(e){var t=this;this._abortRequest("in dir ".concat(DM[e])),this._loadingService.startLoading(this._loadingName);var n=this.stateService.currentImage$.pipe(dv(),Np((function(t){return([DM.Next,DM.Prev].indexOf(e)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(dv(),xp((function(t){var n,i=Pd(t.edges);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.data.direction===e)return r.target}}catch(MN){i.e(MN)}finally{i.f()}return null})))})),Np((function(n){return null==n?(t._loadingService.stopLoading(t._loadingName),vp(new Error("Direction (".concat(e,") does not exist for current image.")))):t._moveTo$(n)})));return this._makeRequest$(n)}},{key:"setFilter$",value:function(e){var t=this;return this._stateService.clearImages(),this._movedToId$.pipe(dv(),Np((function(n){return null!=n?t._trajectoryIds$().pipe(Np((function(n){return t._graphService.setFilter$(e).pipe(Np((function(){return t._cacheIds$(n)})))})),pv()):t._idRequested$.pipe(dv(),Np((function(n){return null!=n?t._graphService.setFilter$(e).pipe(Np((function(){return t._graphService.cacheImage$(n)}))):t._graphService.setFilter$(e).pipe(xp((function(){})))})))})),xp((function(){})))}},{key:"setAccessToken$",value:function(e){var t=this;return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(dv(),Pv((function(){t._api.setAccessToken(e)})),Np((function(e){return null==e?t._graphService.reset$([]):t._trajectoryIds$().pipe(Np((function(e){return t._graphService.reset$(e).pipe(Np((function(){return t._cacheIds$(e)})))})),pv(),xp((function(){})))})))}},{key:"_cacheIds$",value:function(e){var t=this,n=e.map((function(e){return t._graphService.cacheImage$(e)}));return rp(n).pipe(Dp())}},{key:"_abortRequest",value:function(e){null!=this._requestSubscription&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),null!=this._imageRequestSubscription&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),null!=this._request$&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new EP("Request aborted by a subsequent request ".concat(e,"."))),this._request$=null)}},{key:"_makeRequest$",value:function(e){var t=this,n=new Df(1);return this._requestSubscription=n.subscribe(void 0,(function(){})),this._request$=n,this._imageRequestSubscription=e.subscribe((function(e){t._request$=null,n.next(e),n.complete()}),(function(e){t._request$=null,n.error(e)})),n}},{key:"_moveTo$",value:function(e){var t=this;return this._idRequested$.next(e),this._graphService.cacheImage$(e).pipe(Pv((function(e){t._stateService.setImages([e]),t._movedToId$.next(e.id)})),hv((function(){t._loadingService.stopLoading(t._loadingName)})))}},{key:"_trajectoryIds$",value:function(){return this._stateService.currentState$.pipe(dv(),xp((function(e){return e.state.trajectory.map((function(e){return e.id}))})))}}]),e}(),Sz=function(){function e(t,n){Fd(this,e),this._spatial=null!==n&&void 0!==n?n:new WM,this._viewportCoords=null!==t&&void 0!==t?t:new MP}return $d(e,[{key:"basicToCanvas",value:function(e,t,n,i){return this._viewportCoords.basicToCanvasSafe(e[0],e[1],t,i,n.perspective)}},{key:"canvasToBasic",value:function(e,t,n,i){var r=this._viewportCoords.canvasToBasic(e[0],e[1],t,i,n.perspective);return(r[0]<0||r[0]>1||r[1]<0||r[1]>1)&&(r=null),r}},{key:"eventToUnprojection",value:function(e,t,n,i,r){var a=this._viewportCoords.canvasPosition(e,t);return this.canvasToUnprojection(a,t,n,i,r)}},{key:"canvasToUnprojection",value:function(e,t,n,i,r){var a=e[0],o=e[1],u=s(this._viewportCoords.canvasToViewport(a,o,t),2),l=u[0],c=u[1],h=new Vm(l,c,1).unproject(n.perspective),d=r.projectBasic(h.toArray());(d[0]<0||d[0]>1||d[1]<0||d[1]>1)&&(d=null);var f=h.clone().sub(n.camera.position).normalize(),p=-2/f.z,v=null;if(p>0&&p<100&&d){var m=f.clone().multiplyScalar(p).add(n.camera.position),g=s(RM(m.x,m.y,m.z,i.lng,i.lat,i.alt),2),_=g[0];v={lat:g[1],lng:_}}return{basicPoint:d,lngLat:v,pixelPoint:[a,o]}}},{key:"cameraToLngLat",value:function(e,t){var n=e.camera.position,i=s(RM(n.x,n.y,n.z,t.lng,t.lat,t.alt),2),r=i[0];return{lat:i[1],lng:r}}},{key:"lngLatToCanvas",value:function(e,t,n,i){var r=IM(e.lng,e.lat,0,i.lng,i.lat,i.alt);return this._viewportCoords.projectToCanvasSafe(r,t,n.perspective)}},{key:"distanceBetweenLngLats",value:function(e,t){return this._spatial.distanceFromLngLat(e.lng,e.lat,t.lng,t.lat)}}]),e}(),Mz=function(){function e(t,n,i){var r=this;Fd(this,e),this._subscriptions=new bP,this._emitSubscriptions=new bP,this._container=i,this._viewer=t,this._navigator=n,this._projection=new Sz,this._started=!1,this._navigable$=new Af;var a=this._subscriptions;a.push(this._navigable$.subscribe((function(e){var t="navigable",n={navigable:e,target:r._viewer,type:t};r._viewer.fire(t,n)}))),a.push(this._navigator.loadingService.loading$.subscribe((function(e){var t="dataloading",n={loading:e,target:r._viewer,type:t};r._viewer.fire(t,n)}))),a.push(this._container.glRenderer.opaqueRender$.pipe(dv()).subscribe((function(){var e="load",t={target:r._viewer,type:e};r._viewer.fire(e,t)})))}return $d(e,[{key:"started",get:function(){return this._started}},{key:"navigable$",get:function(){return this._navigable$}},{key:"projection",get:function(){return this._projection}},{key:"dispose",value:function(){this.stopEmit(),this._subscriptions.unsubscribe()}},{key:"project$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(dv(),xp((function(n){var i=s(n,3),r=i[0],a=i[1],o=i[2];if(t._projection.distanceBetweenLngLats(e,a.lngLat)>1e3)return null;var u=t._projection.lngLatToCanvas(e,t._container.container,r,o);return u?[Math.round(u[0]),Math.round(u[1])]:null})))}},{key:"projectBasic$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(dv(),xp((function(n){var i=s(n,2),r=i[0],a=i[1],o=t._projection.basicToCanvas(e,t._container.container,r,a);return o?[Math.round(o[0]),Math.round(o[1])]:null})))}},{key:"startEmit",value:function(){var e=this;if(!this._started){this._started=!0;var t=this._emitSubscriptions;t.push(this._navigator.stateService.currentImageExternal$.subscribe((function(t){var n="image",i={image:t,target:e._viewer,type:n};e._viewer.fire(n,i)}))),t.push(this._navigator.stateService.currentImageExternal$.pipe(Tv((function(e){return e.sequenceEdges$}))).subscribe((function(t){var n="sequenceedges",i={status:t,target:e._viewer,type:n};e._viewer.fire(n,i)}))),t.push(this._navigator.stateService.currentImageExternal$.pipe(Tv((function(e){return e.spatialEdges$}))).subscribe((function(t){var n="spatialedges",i={status:t,target:e._viewer,type:n};e._viewer.fire(n,i)}))),t.push(this._navigator.stateService.reference$.subscribe((function(t){var n="reference",i={reference:t,target:e._viewer,type:n};e._viewer.fire(n,i)}))),t.push(Lp(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(xp((function(e){return e[0]||e[1]||e[2]})),ov()).subscribe((function(t){var n=t?"movestart":"moveend",i={target:e._viewer,type:n};e._viewer.fire(n,i)}))),t.push(this._container.renderService.bearing$.pipe(Xp(100),ov((function(e,t){return Math.abs(t-e)<1}))).subscribe((function(t){var n="bearing",i={bearing:t,target:e._viewer,type:n};e._viewer.fire(n,i)})));var n=this._container.mouseService.active$.pipe(Tv((function(t){return t?Hf():e._container.mouseService.mouseMove$})));t.push(Hp(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",n),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(Lv(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),xp((function(t){var n=s(t,5),i=s(n[0],2),r=i[0],a=i[1],o=n[1],u=n[2],l=n[3],c=n[4],h=e._projection.eventToUnprojection(a,e._container.container,o,u,l);return{basicPoint:c===XP.Traversing?h.basicPoint:null,lngLat:h.lngLat,originalEvent:a,pixelPoint:h.pixelPoint,target:e._viewer,type:r}}))).subscribe((function(t){e._viewer.fire(t.type,t)}))),t.push(this._container.renderService.renderCamera$.pipe(ov((function(t,n){var i=s(t,2),r=i[0],a=i[1],o=s(n,2),u=o[0],l=o[1];return e._closeTo(r,u,.01)&&e._closeTo(a,l,.01)}),(function(e){return e.camera.position.toArray()}))).subscribe((function(){var t="position",n={target:e._viewer,type:t};e._viewer.fire(t,n)}))),t.push(this._container.renderService.renderCamera$.pipe(ov((function(t,n){var i=s(t,2),r=i[0],a=i[1],o=s(n,2),u=o[0],l=o[1];return e._closeTo(r,u,.001)&&e._closeTo(a,l,.001)}),(function(e){return[e.rotation.phi,e.rotation.theta]}))).subscribe((function(){var t={target:e._viewer,type:"pov"};e._viewer.fire("pov",t)}))),t.push(this._container.renderService.renderCamera$.pipe(ov((function(t,n){return e._closeTo(t,n,.01)}),(function(e){return e.perspective.fov}))).subscribe((function(){var t={target:e._viewer,type:"fov"};e._viewer.fire("fov",t)})))}}},{key:"stopEmit",value:function(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}},{key:"unproject$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(dv(),xp((function(n){var i=s(n,3),r=i[0],a=i[1],o=i[2];return t._projection.canvasToUnprojection(e,t._container.container,r,a,o).lngLat})))}},{key:"unprojectBasic$",value:function(e){var t=this;return Lp(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(dv(),xp((function(n){var i=s(n,2),r=i[0],a=i[1];return t._projection.canvasToBasic(e,t._container.container,r,a)})))}},{key:"_closeTo",value:function(e,t,n){return Math.abs(e-t)<=n}},{key:"_mapMouseEvent$",value:function(e,t){return t.pipe(xp((function(t){return[e,t]})))}}]),e}(),Tz=function(){function e(t,n){Fd(this,e),this._container=t,this._navigator=n,this._renderers={}}return $d(e,[{key:"add",value:function(e,t){var n=new bP;this._renderers[e.id]={subs:n,renderer:e},n.push(Lp([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe(av(1)).subscribe((function(n){var i=s(n,2),r=i[0],a=i[1];e.onAdd(t,a,r.getContext())}))),n.push(this._container.glRenderer.opaqueRender$.pipe(Lv(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe((function(t){var n=s(t,3),i=n[1],r=n[2].getContext(),a=i.perspective.matrixWorldInverse,o=i.perspective.projectionMatrix;e.render(r,a.toArray(),o.toArray())}))),n.push(this._navigator.stateService.reference$.pipe(kv(1)).subscribe((function(n){e.onReference(t,n)})))}},{key:"dispose",value:function(e){for(var t=0,n=Object.keys(this._renderers);t<n.length;t++){var i=n[t];this.remove(i,e)}}},{key:"has",value:function(e){return e in this._renderers}},{key:"remove",value:function(e,t){this._renderers[e].subs.unsubscribe();var n=this._renderers[e].renderer;delete this._renderers[e],this._container.glRenderer.webGLRenderer$.subscribe((function(e){n.onRemove(t,e.getContext())}))}}]),e}(),Cz=function(){function e(t,n){Fd(this,e),this._container=t,this._navigator=n,this._controls=null,this._subscriptions=new bP}return $d(e,[{key:"attach",value:function(e,t){var n=this;if(this._controls)throw new VM("Custom camera controls already attached");this._controls=e;var i=new Af,r=i.pipe(Tv((function(){return n._navigator.stateService.state$})),xp((function(e){return e===XP.Custom})),ov()),a=this._subscriptions;a.push(r.pipe(Mv(!1),mv(),Lv(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe((function(n){var i=s(n,3),r=s(i[0],2),a=r[0],o=r[1],u=i[1],l=i[2];o?e.onActivate(t,l.perspective.matrixWorldInverse.toArray(),l.perspective.projectionMatrix.toArray(),u):a&&e.onDeactivate(t)}))),a.push(r.pipe(Tv((function(e){return e?n._navigator.stateService.currentState$.pipe(kv(1)):Hf()}))).subscribe((function(n){e.onAnimationFrame(t,n.id)}))),a.push(r.pipe(Tv((function(e){return e?n._navigator.stateService.reference$.pipe(kv(1)):Hf()}))).subscribe((function(n){return e.onReference(t,n)}))),a.push(r.pipe(Tv((function(e){return e?n._container.renderService.size$.pipe(kv(1)):Hf()}))).subscribe((function(){return e.onResize(t)}))),a.push(Lp([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(dv()).subscribe((function(){e.onAttach(t,(function(t){n._controls&&e===n._controls&&n._updateViewMatrix(t)}),(function(t){n._controls&&e===n._controls&&n._updateProjectionMatrix(t)})),i.next(),i.complete()})))}},{key:"detach",value:function(e){var t=this,n=this._controls;return this._controls=null,this._subscriptions.unsubscribe(),new Promise((function(i){t._navigator.stateService.state$.pipe(av(1)).subscribe((function(t){n?(t===XP.Custom&&n.onDeactivate(e),n.onDetach(e),i(n)):i(null)}))}))}},{key:"dispose",value:function(e){this.detach(e)}},{key:"has",value:function(e){return!!this._controls&&e===this._controls}},{key:"_updateProjectionMatrix",value:function(e){var t=this;this._navigator.stateService.state$.pipe(dv()).subscribe((function(n){if(n===XP.Custom)t._container.renderService.projectionMatrix$.next(e);else{console.warn("Incorrect camera control mode for projection matrix update")}}))}},{key:"_updateViewMatrix",value:function(e){var t=this;this._navigator.stateService.state$.pipe(dv()).subscribe((function(n){if(n===XP.Custom)t._navigator.stateService.setViewMatrix(e);else{console.warn("Incorrect camera control mode for view matrix update")}}))}}]),e}(),Ez=function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this))._navigator=new kz(e),i._container=new rz(e,i._navigator.stateService),i._observer=new Mz(Ad(i),i._navigator,i._container),i._componentController=new WO(i._container,i._navigator,i._observer,e.imageId,e.component),i._customRenderer=new Tz(i._container,i._navigator),i._customCameraControls=new Cz(i._container,i._navigator),i}return $d(n,[{key:"dataProvider",get:function(){return this._navigator.api.data}},{key:"isNavigable",get:function(){return this._componentController.navigable}},{key:"activateCombinedPanning",value:function(){this._navigator.panService.enable()}},{key:"activateComponent",value:function(e){this._componentController.activate(e)}},{key:"activateCover",value:function(){this._componentController.activateCover()}},{key:"addCustomRenderer",value:function(e){this._customRenderer.add(e,this)}},{key:"attachCustomCameraControls",value:function(e){this._customCameraControls.attach(e,this)}},{key:"deactivateCombinedPanning",value:function(){this._navigator.panService.disable()}},{key:"deactivateComponent",value:function(e){this._componentController.deactivate(e)}},{key:"deactivateCover",value:function(){this._componentController.deactivateCover()}},{key:"detachCustomCameraControls",value:function(){return this._customCameraControls.detach(this)}},{key:"fire",value:function(e,t){Nd(kd(n.prototype),"fire",this).call(this,e,t)}},{key:"getBearing",value:function(){var e=this;return new Promise((function(t,n){e._container.renderService.bearing$.pipe(dv()).subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getCameraControls",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.state$.pipe(dv()).subscribe((function(e){switch(e){case XP.Custom:t($O.Custom);break;case XP.Earth:t($O.Earth);break;default:t($O.Street)}}),(function(e){n(e)}))}))}},{key:"getCanvas",value:function(){return this._container.canvas}},{key:"getCanvasContainer",value:function(){return this._container.canvasContainer}},{key:"getCenter",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.getCenter().subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getComponent",value:function(e){return this._componentController.get(e)}},{key:"getContainer",value:function(){return this._container.container}},{key:"getFieldOfView",value:function(){var e=this;return new Promise((function(t,n){e._container.renderService.renderCamera$.pipe(dv()).subscribe((function(e){t(e.perspective.fov)}),(function(e){n(e)}))}))}},{key:"getImage",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.currentImage$.pipe(dv()).subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getPointOfView",value:function(){var e=this;return new Promise((function(t,n){Lp(e._container.renderService.renderCamera$,e._container.renderService.bearing$).pipe(dv()).subscribe((function(e){var n=s(e,2),i=n[0],r=n[1];t({bearing:r,tilt:i.getTilt()})}),(function(e){n(e)}))}))}},{key:"getPosition",value:function(){var e=this;return new Promise((function(t,n){Lp(e._container.renderService.renderCamera$,e._navigator.stateService.reference$).pipe(dv()).subscribe((function(n){var i=s(n,2),r=i[0],a=i[1];t(e._observer.projection.cameraToLngLat(r,a))}),(function(e){n(e)}))}))}},{key:"getReference",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.reference$.pipe(dv()).subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"getZoom",value:function(){var e=this;return new Promise((function(t,n){e._navigator.stateService.getZoom().subscribe((function(e){t(e)}),(function(e){n(e)}))}))}},{key:"hasCustomCameraControls",value:function(e){return this._customCameraControls.has(e)}},{key:"hasCustomRenderer",value:function(e){return this._customRenderer.has(e)}},{key:"moveDir",value:function(e){var t=this.isNavigable?this._navigator.moveDir$(e):vp(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise((function(e,n){t.subscribe((function(t){e(t)}),(function(e){n(e)}))}))}},{key:"moveTo",value:function(e){var t=this.isNavigable?this._navigator.moveTo$(e):vp(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise((function(e,n){t.subscribe((function(t){e(t)}),(function(e){n(e)}))}))}},{key:"off",value:function(e,t){Nd(kd(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){Nd(kd(n.prototype),"on",this).call(this,e,t)}},{key:"project",value:function(e){var t=this;return new Promise((function(n,i){t._observer.project$(e).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"projectFromBasic",value:function(e){var t=this;return new Promise((function(n,i){t._observer.projectBasic$(e).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"remove",value:function(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();var e="remove",t={target:this,type:e};this.fire(e,t)}},{key:"removeCustomRenderer",value:function(e){this._customRenderer.remove(e,this)}},{key:"resize",value:function(){this._container.renderService.resize$.next()}},{key:"setCameraControls",value:function(e){var t=wz(e);t===XP.Traversing?this._navigator.stateService.traverse():t===XP.Earth?this._navigator.stateService.earth():t===XP.Custom?this._navigator.stateService.custom():console.warn("Unsupported camera control transition (".concat(e,")"))}},{key:"setCenter",value:function(e){this._navigator.stateService.setCenter(e)}},{key:"setFieldOfView",value:function(e){var t=this;this._container.renderService.renderCamera$.pipe(dv()).subscribe((function(n){var i=n.fovToZoom(e);t._navigator.stateService.setZoom(i)}))}},{key:"setFilter",value:function(e){var t=this;return new Promise((function(n,i){t._navigator.setFilter$(e).subscribe((function(){n(void 0)}),(function(e){i(e)}))}))}},{key:"setRenderMode",value:function(e){this._container.renderService.renderMode$.next(e)}},{key:"setTransitionMode",value:function(e){this._navigator.stateService.setTransitionMode(e)}},{key:"setAccessToken",value:function(e){var t=this.isNavigable?this._navigator.setAccessToken$(e):vp(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise((function(e,n){t.subscribe((function(){e(void 0)}),(function(e){n(e)}))}))}},{key:"setZoom",value:function(e){this._navigator.stateService.setZoom(e)}},{key:"triggerRerender",value:function(){this._container.glRenderer.triggerRerender()}},{key:"unproject",value:function(e){var t=this;return new Promise((function(n,i){t._observer.unproject$(e).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}},{key:"unprojectToBasic",value:function(e){var t=this;return new Promise((function(n,i){t._observer.unprojectBasic$(e).subscribe((function(e){n(e)}),(function(e){i(e)}))}))}}]),n}(yP);QM.register(yT),eT.register(yT),bT.registerCover(wP),bT.register(kP),bT.register(TP),bT.register(CP),bT.register(AP),bT.register(KP),bT.register(iL),bT.register(aL),bT.register(bL),bT.register(SL),bT.register(CL),bT.register(AL),bT.register(tA),bT.register(rR),bT.register(aR),bT.register(oR),bT.register(sR);var Pz=function(e){Dd(n,e);var t=Od(n);function n(e){var r;return Fd(this,n),(r=t.call(this,e)).containerRef=i.createRef(),r}return $d(n,[{key:"componentDidMount",value:function(){this.viewer=new Ez({accessToken:this.props.accessToken,container:this.containerRef.current,imageId:this.props.imageId})}},{key:"componentWillUnmount",value:function(){this.viewer&&this.viewer.remove()}},{key:"render",value:function(){return(0,se.jsx)("div",{ref:this.containerRef,style:this.props.style})}}]),n}(i.Component),Lz=(i.Component,i.Component,function(e){Dd(n,e);var t=Od(n);function n(e){var i;return Fd(this,n),(i=t.call(this,e)).state={index:0,test:["145728107523175","179011504107194","259103735961077"]},i.handleClick=i.handleClick.bind(Ad(i)),i}return $d(n,[{key:"handleClick",value:function(){this.setState({index:0})}},{key:"handleClick1",value:function(){this.setState({index:1})}},{key:"handleClick2",value:function(){this.setState({index:2})}},{key:"handleClick3",value:function(){this.setState({index:3})}},{key:"render",value:function(){var e=this;return(0,se.jsxs)("div",{children:[(0,se.jsx)("button",{onClick:function(){return e.handleClick()},children:"Get Next Street View"}),(0,se.jsx)("button",{onClick:function(){return e.handleClick1()},children:"Click me: UCLA Royce Hall"}),(0,se.jsx)("button",{onClick:function(){return e.handleClick2()},children:"Click me: Sepulved Boulevard"}),(0,se.jsx)("button",{onClick:function(){return e.handleClick3()},children:"Click me: Forest Lawn Dr"}),(0,se.jsx)("br",{}),"Let the buttons be coordinates on the map",this.state.test.slice(this.state.index-1,this.state.index).map((function(e){return(0,se.jsx)(Pz,{accessToken:"MLY|5601141439945634|a93d0122bc05efd58fbd9c081cf82b8f",imageId:e,style:{width:"90%",height:"400px"}})}))]})}}]),n}(i.Component)),Az=Lz;var Iz=function(){return(0,se.jsxs)("div",{className:"application",children:[(0,se.jsx)("div",{className:"intro",children:(0,se.jsx)("h1",{children:"Hillside Street Prioritization Application"})}),(0,se.jsx)("div",{className:"charts",children:(0,se.jsx)("div",{className:"chart",children:(0,se.jsx)(ad,{})})}),(0,se.jsxs)("div",{className:"map",children:[(0,se.jsx)(xd,{}),(0,se.jsx)(Az,{})]})]})};var Rz=function(){return(0,se.jsxs)("div",{className:"footerContainer",children:[(0,se.jsxs)("div",{className:"footerInfo",children:[(0,se.jsxs)("div",{className:"InfoItem",children:[(0,se.jsx)("h1",{children:"Engineer Change."}),(0,se.jsx)("p",{children:"UCLA Samueli School of Engineering Department of Civil and Environmental Engineering Los Angeles, CA 90095"})]}),(0,se.jsxs)("div",{className:"InfoItem",children:[(0,se.jsx)("h1",{children:" Contact "}),(0,se.jsxs)("p",{children:["Sriram Narasimhan ",(0,se.jsx)("br",{}),"Email: snarasim@ucla.edu"]})]})]}),(0,se.jsx)("div",{className:"footerBar",children:(0,se.jsx)("div",{className:"website-rights",children:"\xa9 2022 SRI Lab"})})]})};var Nz=function(){return(0,se.jsx)(se.Fragment,{children:(0,se.jsxs)(Z,{children:[(0,se.jsx)(he,{}),(0,se.jsxs)(U,{children:[(0,se.jsx)($,{exact:!0,path:"/",element:(0,se.jsx)(ve,{})}),(0,se.jsx)($,{path:"/application",element:(0,se.jsx)(Iz,{})})]}),(0,se.jsx)(Rz,{})]})})};r.createRoot(document.getElementById("root")).render((0,se.jsx)(Nz,{}))}()}();
//# sourceMappingURL=main.fba6cb83.js.map